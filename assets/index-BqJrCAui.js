(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();function noop$3(){}function run(r){return r()}function blank_object(){return Object.create(null)}function run_all(r){r.forEach(run)}function is_function(r){return typeof r=="function"}function safe_not_equal(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function is_empty(r){return Object.keys(r).length===0}function subscribe(r,...e){if(r==null){for(const n of e)n(void 0);return noop$3}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function component_subscribe(r,e,t){r.$$.on_destroy.push(subscribe(e,t))}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var dist={},bufferPolyfill={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code$3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code$3.length;i<len;++i)lookup[i]=code$3[i],revLookup[code$3.charCodeAt(i)]=i;revLookup[45]=62;revLookup[95]=63;function getLens(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function byteLength(r){var e=getLens(r),t=e[0],n=e[1];return(t+n)*3/4-n}function _byteLength(r,e,t){return(e+t)*3/4-t}function toByteArray(r){var e,t=getLens(r),n=t[0],a=t[1],o=new Arr(_byteLength(r,n,a)),c=0,u=a>0?n-4:n,v;for(v=0;v<u;v+=4)e=revLookup[r.charCodeAt(v)]<<18|revLookup[r.charCodeAt(v+1)]<<12|revLookup[r.charCodeAt(v+2)]<<6|revLookup[r.charCodeAt(v+3)],o[c++]=e>>16&255,o[c++]=e>>8&255,o[c++]=e&255;return a===2&&(e=revLookup[r.charCodeAt(v)]<<2|revLookup[r.charCodeAt(v+1)]>>4,o[c++]=e&255),a===1&&(e=revLookup[r.charCodeAt(v)]<<10|revLookup[r.charCodeAt(v+1)]<<4|revLookup[r.charCodeAt(v+2)]>>2,o[c++]=e>>8&255,o[c++]=e&255),o}function tripletToBase64(r){return lookup[r>>18&63]+lookup[r>>12&63]+lookup[r>>6&63]+lookup[r&63]}function encodeChunk(r,e,t){for(var n,a=[],o=e;o<t;o+=3)n=(r[o]<<16&16711680)+(r[o+1]<<8&65280)+(r[o+2]&255),a.push(tripletToBase64(n));return a.join("")}function fromByteArray(r){for(var e,t=r.length,n=t%3,a=[],o=16383,c=0,u=t-n;c<u;c+=o)a.push(encodeChunk(r,c,c+o>u?u:c+o));return n===1?(e=r[t-1],a.push(lookup[e>>2]+lookup[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],a.push(lookup[e>>10]+lookup[e>>4&63]+lookup[e<<2&63]+"=")),a.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(r,e,t,n,a){var o,c,u=a*8-n-1,v=(1<<u)-1,_=v>>1,x=-7,E=t?a-1:0,M=t?-1:1,C=r[e+E];for(E+=M,o=C&(1<<-x)-1,C>>=-x,x+=u;x>0;o=o*256+r[e+E],E+=M,x-=8);for(c=o&(1<<-x)-1,o>>=-x,x+=n;x>0;c=c*256+r[e+E],E+=M,x-=8);if(o===0)o=1-_;else{if(o===v)return c?NaN:(C?-1:1)*(1/0);c=c+Math.pow(2,n),o=o-_}return(C?-1:1)*c*Math.pow(2,o-n)};ieee754.write=function(r,e,t,n,a,o){var c,u,v,_=o*8-a-1,x=(1<<_)-1,E=x>>1,M=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=n?0:o-1,I=n?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,c=x):(c=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-c))<1&&(c--,v*=2),c+E>=1?e+=M/v:e+=M*Math.pow(2,1-E),e*v>=2&&(c++,v/=2),c+E>=x?(u=0,c=x):c+E>=1?(u=(e*v-1)*Math.pow(2,a),c=c+E):(u=e*Math.pow(2,E-1)*Math.pow(2,a),c=0));a>=8;r[t+C]=u&255,C+=I,u/=256,a-=8);for(c=c<<a|u,_+=a;_>0;r[t+C]=c&255,C+=I,c/=256,_-=8);r[t+C-I]|=D*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=base64Js,t=ieee754,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=u,r.SlowBuffer=q,r.INSPECT_MAX_BYTES=50;const a=2147483647;r.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=o(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{const re=new Uint8Array(1),Y={foo:function(){return 42}};return Object.setPrototypeOf(Y,Uint8Array.prototype),Object.setPrototypeOf(re,Y),re.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function c(re){if(re>a)throw new RangeError('The value "'+re+'" is invalid for option "size"');const Y=new Uint8Array(re);return Object.setPrototypeOf(Y,u.prototype),Y}function u(re,Y,ee){if(typeof re=="number"){if(typeof Y=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(re)}return v(re,Y,ee)}u.poolSize=8192;function v(re,Y,ee){if(typeof re=="string")return M(re,Y);if(ArrayBuffer.isView(re))return I(re);if(re==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof re);if(xe(re,ArrayBuffer)||re&&xe(re.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(xe(re,SharedArrayBuffer)||re&&xe(re.buffer,SharedArrayBuffer)))return D(re,Y,ee);if(typeof re=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const fe=re.valueOf&&re.valueOf();if(fe!=null&&fe!==re)return u.from(fe,Y,ee);const ue=L(re);if(ue)return ue;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof re[Symbol.toPrimitive]=="function")return u.from(re[Symbol.toPrimitive]("string"),Y,ee);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof re)}u.from=function(re,Y,ee){return v(re,Y,ee)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function _(re){if(typeof re!="number")throw new TypeError('"size" argument must be of type number');if(re<0)throw new RangeError('The value "'+re+'" is invalid for option "size"')}function x(re,Y,ee){return _(re),re<=0?c(re):Y!==void 0?typeof ee=="string"?c(re).fill(Y,ee):c(re).fill(Y):c(re)}u.alloc=function(re,Y,ee){return x(re,Y,ee)};function E(re){return _(re),c(re<0?0:N(re)|0)}u.allocUnsafe=function(re){return E(re)},u.allocUnsafeSlow=function(re){return E(re)};function M(re,Y){if((typeof Y!="string"||Y==="")&&(Y="utf8"),!u.isEncoding(Y))throw new TypeError("Unknown encoding: "+Y);const ee=F(re,Y)|0;let fe=c(ee);const ue=fe.write(re,Y);return ue!==ee&&(fe=fe.slice(0,ue)),fe}function C(re){const Y=re.length<0?0:N(re.length)|0,ee=c(Y);for(let fe=0;fe<Y;fe+=1)ee[fe]=re[fe]&255;return ee}function I(re){if(xe(re,Uint8Array)){const Y=new Uint8Array(re);return D(Y.buffer,Y.byteOffset,Y.byteLength)}return C(re)}function D(re,Y,ee){if(Y<0||re.byteLength<Y)throw new RangeError('"offset" is outside of buffer bounds');if(re.byteLength<Y+(ee||0))throw new RangeError('"length" is outside of buffer bounds');let fe;return Y===void 0&&ee===void 0?fe=new Uint8Array(re):ee===void 0?fe=new Uint8Array(re,Y):fe=new Uint8Array(re,Y,ee),Object.setPrototypeOf(fe,u.prototype),fe}function L(re){if(u.isBuffer(re)){const Y=N(re.length)|0,ee=c(Y);return ee.length===0||re.copy(ee,0,0,Y),ee}if(re.length!==void 0)return typeof re.length!="number"||Ve(re.length)?c(0):C(re);if(re.type==="Buffer"&&Array.isArray(re.data))return C(re.data)}function N(re){if(re>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return re|0}function q(re){return+re!=re&&(re=0),u.alloc(+re)}u.isBuffer=function(Y){return Y!=null&&Y._isBuffer===!0&&Y!==u.prototype},u.compare=function(Y,ee){if(xe(Y,Uint8Array)&&(Y=u.from(Y,Y.offset,Y.byteLength)),xe(ee,Uint8Array)&&(ee=u.from(ee,ee.offset,ee.byteLength)),!u.isBuffer(Y)||!u.isBuffer(ee))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Y===ee)return 0;let fe=Y.length,ue=ee.length;for(let ve=0,de=Math.min(fe,ue);ve<de;++ve)if(Y[ve]!==ee[ve]){fe=Y[ve],ue=ee[ve];break}return fe<ue?-1:ue<fe?1:0},u.isEncoding=function(Y){switch(String(Y).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(Y,ee){if(!Array.isArray(Y))throw new TypeError('"list" argument must be an Array of Buffers');if(Y.length===0)return u.alloc(0);let fe;if(ee===void 0)for(ee=0,fe=0;fe<Y.length;++fe)ee+=Y[fe].length;const ue=u.allocUnsafe(ee);let ve=0;for(fe=0;fe<Y.length;++fe){let de=Y[fe];if(xe(de,Uint8Array))ve+de.length>ue.length?(u.isBuffer(de)||(de=u.from(de)),de.copy(ue,ve)):Uint8Array.prototype.set.call(ue,de,ve);else if(u.isBuffer(de))de.copy(ue,ve);else throw new TypeError('"list" argument must be an Array of Buffers');ve+=de.length}return ue};function F(re,Y){if(u.isBuffer(re))return re.length;if(ArrayBuffer.isView(re)||xe(re,ArrayBuffer))return re.byteLength;if(typeof re!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof re);const ee=re.length,fe=arguments.length>2&&arguments[2]===!0;if(!fe&&ee===0)return 0;let ue=!1;for(;;)switch(Y){case"ascii":case"latin1":case"binary":return ee;case"utf8":case"utf-8":return je(re).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ee*2;case"hex":return ee>>>1;case"base64":return Ke(re).length;default:if(ue)return fe?-1:je(re).length;Y=(""+Y).toLowerCase(),ue=!0}}u.byteLength=F;function U(re,Y,ee){let fe=!1;if((Y===void 0||Y<0)&&(Y=0),Y>this.length||((ee===void 0||ee>this.length)&&(ee=this.length),ee<=0)||(ee>>>=0,Y>>>=0,ee<=Y))return"";for(re||(re="utf8");;)switch(re){case"hex":return A(this,Y,ee);case"utf8":case"utf-8":return b(this,Y,ee);case"ascii":return B(this,Y,ee);case"latin1":case"binary":return $(this,Y,ee);case"base64":return p(this,Y,ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,Y,ee);default:if(fe)throw new TypeError("Unknown encoding: "+re);re=(re+"").toLowerCase(),fe=!0}}u.prototype._isBuffer=!0;function j(re,Y,ee){const fe=re[Y];re[Y]=re[ee],re[ee]=fe}u.prototype.swap16=function(){const Y=this.length;if(Y%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let ee=0;ee<Y;ee+=2)j(this,ee,ee+1);return this},u.prototype.swap32=function(){const Y=this.length;if(Y%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let ee=0;ee<Y;ee+=4)j(this,ee,ee+3),j(this,ee+1,ee+2);return this},u.prototype.swap64=function(){const Y=this.length;if(Y%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let ee=0;ee<Y;ee+=8)j(this,ee,ee+7),j(this,ee+1,ee+6),j(this,ee+2,ee+5),j(this,ee+3,ee+4);return this},u.prototype.toString=function(){const Y=this.length;return Y===0?"":arguments.length===0?b(this,0,Y):U.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(Y){if(!u.isBuffer(Y))throw new TypeError("Argument must be a Buffer");return this===Y?!0:u.compare(this,Y)===0},u.prototype.inspect=function(){let Y="";const ee=r.INSPECT_MAX_BYTES;return Y=this.toString("hex",0,ee).replace(/(.{2})/g,"$1 ").trim(),this.length>ee&&(Y+=" ... "),"<Buffer "+Y+">"},n&&(u.prototype[n]=u.prototype.inspect),u.prototype.compare=function(Y,ee,fe,ue,ve){if(xe(Y,Uint8Array)&&(Y=u.from(Y,Y.offset,Y.byteLength)),!u.isBuffer(Y))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Y);if(ee===void 0&&(ee=0),fe===void 0&&(fe=Y?Y.length:0),ue===void 0&&(ue=0),ve===void 0&&(ve=this.length),ee<0||fe>Y.length||ue<0||ve>this.length)throw new RangeError("out of range index");if(ue>=ve&&ee>=fe)return 0;if(ue>=ve)return-1;if(ee>=fe)return 1;if(ee>>>=0,fe>>>=0,ue>>>=0,ve>>>=0,this===Y)return 0;let de=ve-ue,Se=fe-ee;const We=Math.min(de,Se),_e=this.slice(ue,ve),Me=Y.slice(ee,fe);for(let ze=0;ze<We;++ze)if(_e[ze]!==Me[ze]){de=_e[ze],Se=Me[ze];break}return de<Se?-1:Se<de?1:0};function W(re,Y,ee,fe,ue){if(re.length===0)return-1;if(typeof ee=="string"?(fe=ee,ee=0):ee>2147483647?ee=2147483647:ee<-2147483648&&(ee=-2147483648),ee=+ee,Ve(ee)&&(ee=ue?0:re.length-1),ee<0&&(ee=re.length+ee),ee>=re.length){if(ue)return-1;ee=re.length-1}else if(ee<0)if(ue)ee=0;else return-1;if(typeof Y=="string"&&(Y=u.from(Y,fe)),u.isBuffer(Y))return Y.length===0?-1:X(re,Y,ee,fe,ue);if(typeof Y=="number")return Y=Y&255,typeof Uint8Array.prototype.indexOf=="function"?ue?Uint8Array.prototype.indexOf.call(re,Y,ee):Uint8Array.prototype.lastIndexOf.call(re,Y,ee):X(re,[Y],ee,fe,ue);throw new TypeError("val must be string, number or Buffer")}function X(re,Y,ee,fe,ue){let ve=1,de=re.length,Se=Y.length;if(fe!==void 0&&(fe=String(fe).toLowerCase(),fe==="ucs2"||fe==="ucs-2"||fe==="utf16le"||fe==="utf-16le")){if(re.length<2||Y.length<2)return-1;ve=2,de/=2,Se/=2,ee/=2}function We(Me,ze){return ve===1?Me[ze]:Me.readUInt16BE(ze*ve)}let _e;if(ue){let Me=-1;for(_e=ee;_e<de;_e++)if(We(re,_e)===We(Y,Me===-1?0:_e-Me)){if(Me===-1&&(Me=_e),_e-Me+1===Se)return Me*ve}else Me!==-1&&(_e-=_e-Me),Me=-1}else for(ee+Se>de&&(ee=de-Se),_e=ee;_e>=0;_e--){let Me=!0;for(let ze=0;ze<Se;ze++)if(We(re,_e+ze)!==We(Y,ze)){Me=!1;break}if(Me)return _e}return-1}u.prototype.includes=function(Y,ee,fe){return this.indexOf(Y,ee,fe)!==-1},u.prototype.indexOf=function(Y,ee,fe){return W(this,Y,ee,fe,!0)},u.prototype.lastIndexOf=function(Y,ee,fe){return W(this,Y,ee,fe,!1)};function J(re,Y,ee,fe){ee=Number(ee)||0;const ue=re.length-ee;fe?(fe=Number(fe),fe>ue&&(fe=ue)):fe=ue;const ve=Y.length;fe>ve/2&&(fe=ve/2);let de;for(de=0;de<fe;++de){const Se=parseInt(Y.substr(de*2,2),16);if(Ve(Se))return de;re[ee+de]=Se}return de}function G(re,Y,ee,fe){return ye(je(Y,re.length-ee),re,ee,fe)}function oe(re,Y,ee,fe){return ye(we(Y),re,ee,fe)}function O(re,Y,ee,fe){return ye(Ke(Y),re,ee,fe)}function l(re,Y,ee,fe){return ye(pe(Y,re.length-ee),re,ee,fe)}u.prototype.write=function(Y,ee,fe,ue){if(ee===void 0)ue="utf8",fe=this.length,ee=0;else if(fe===void 0&&typeof ee=="string")ue=ee,fe=this.length,ee=0;else if(isFinite(ee))ee=ee>>>0,isFinite(fe)?(fe=fe>>>0,ue===void 0&&(ue="utf8")):(ue=fe,fe=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ve=this.length-ee;if((fe===void 0||fe>ve)&&(fe=ve),Y.length>0&&(fe<0||ee<0)||ee>this.length)throw new RangeError("Attempt to write outside buffer bounds");ue||(ue="utf8");let de=!1;for(;;)switch(ue){case"hex":return J(this,Y,ee,fe);case"utf8":case"utf-8":return G(this,Y,ee,fe);case"ascii":case"latin1":case"binary":return oe(this,Y,ee,fe);case"base64":return O(this,Y,ee,fe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l(this,Y,ee,fe);default:if(de)throw new TypeError("Unknown encoding: "+ue);ue=(""+ue).toLowerCase(),de=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function p(re,Y,ee){return Y===0&&ee===re.length?e.fromByteArray(re):e.fromByteArray(re.slice(Y,ee))}function b(re,Y,ee){ee=Math.min(re.length,ee);const fe=[];let ue=Y;for(;ue<ee;){const ve=re[ue];let de=null,Se=ve>239?4:ve>223?3:ve>191?2:1;if(ue+Se<=ee){let We,_e,Me,ze;switch(Se){case 1:ve<128&&(de=ve);break;case 2:We=re[ue+1],(We&192)===128&&(ze=(ve&31)<<6|We&63,ze>127&&(de=ze));break;case 3:We=re[ue+1],_e=re[ue+2],(We&192)===128&&(_e&192)===128&&(ze=(ve&15)<<12|(We&63)<<6|_e&63,ze>2047&&(ze<55296||ze>57343)&&(de=ze));break;case 4:We=re[ue+1],_e=re[ue+2],Me=re[ue+3],(We&192)===128&&(_e&192)===128&&(Me&192)===128&&(ze=(ve&15)<<18|(We&63)<<12|(_e&63)<<6|Me&63,ze>65535&&ze<1114112&&(de=ze))}}de===null?(de=65533,Se=1):de>65535&&(de-=65536,fe.push(de>>>10&1023|55296),de=56320|de&1023),fe.push(de),ue+=Se}return T(fe)}const S=4096;function T(re){const Y=re.length;if(Y<=S)return String.fromCharCode.apply(String,re);let ee="",fe=0;for(;fe<Y;)ee+=String.fromCharCode.apply(String,re.slice(fe,fe+=S));return ee}function B(re,Y,ee){let fe="";ee=Math.min(re.length,ee);for(let ue=Y;ue<ee;++ue)fe+=String.fromCharCode(re[ue]&127);return fe}function $(re,Y,ee){let fe="";ee=Math.min(re.length,ee);for(let ue=Y;ue<ee;++ue)fe+=String.fromCharCode(re[ue]);return fe}function A(re,Y,ee){const fe=re.length;(!Y||Y<0)&&(Y=0),(!ee||ee<0||ee>fe)&&(ee=fe);let ue="";for(let ve=Y;ve<ee;++ve)ue+=be[re[ve]];return ue}function g(re,Y,ee){const fe=re.slice(Y,ee);let ue="";for(let ve=0;ve<fe.length-1;ve+=2)ue+=String.fromCharCode(fe[ve]+fe[ve+1]*256);return ue}u.prototype.slice=function(Y,ee){const fe=this.length;Y=~~Y,ee=ee===void 0?fe:~~ee,Y<0?(Y+=fe,Y<0&&(Y=0)):Y>fe&&(Y=fe),ee<0?(ee+=fe,ee<0&&(ee=0)):ee>fe&&(ee=fe),ee<Y&&(ee=Y);const ue=this.subarray(Y,ee);return Object.setPrototypeOf(ue,u.prototype),ue};function k(re,Y,ee){if(re%1!==0||re<0)throw new RangeError("offset is not uint");if(re+Y>ee)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(Y,ee,fe){Y=Y>>>0,ee=ee>>>0,fe||k(Y,ee,this.length);let ue=this[Y],ve=1,de=0;for(;++de<ee&&(ve*=256);)ue+=this[Y+de]*ve;return ue},u.prototype.readUintBE=u.prototype.readUIntBE=function(Y,ee,fe){Y=Y>>>0,ee=ee>>>0,fe||k(Y,ee,this.length);let ue=this[Y+--ee],ve=1;for(;ee>0&&(ve*=256);)ue+=this[Y+--ee]*ve;return ue},u.prototype.readUint8=u.prototype.readUInt8=function(Y,ee){return Y=Y>>>0,ee||k(Y,1,this.length),this[Y]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(Y,ee){return Y=Y>>>0,ee||k(Y,2,this.length),this[Y]|this[Y+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(Y,ee){return Y=Y>>>0,ee||k(Y,2,this.length),this[Y]<<8|this[Y+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(Y,ee){return Y=Y>>>0,ee||k(Y,4,this.length),(this[Y]|this[Y+1]<<8|this[Y+2]<<16)+this[Y+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(Y,ee){return Y=Y>>>0,ee||k(Y,4,this.length),this[Y]*16777216+(this[Y+1]<<16|this[Y+2]<<8|this[Y+3])},u.prototype.readBigUInt64LE=Ee(function(Y){Y=Y>>>0,he(Y,"offset");const ee=this[Y],fe=this[Y+7];(ee===void 0||fe===void 0)&&Ae(Y,this.length-8);const ue=ee+this[++Y]*2**8+this[++Y]*2**16+this[++Y]*2**24,ve=this[++Y]+this[++Y]*2**8+this[++Y]*2**16+fe*2**24;return BigInt(ue)+(BigInt(ve)<<BigInt(32))}),u.prototype.readBigUInt64BE=Ee(function(Y){Y=Y>>>0,he(Y,"offset");const ee=this[Y],fe=this[Y+7];(ee===void 0||fe===void 0)&&Ae(Y,this.length-8);const ue=ee*2**24+this[++Y]*2**16+this[++Y]*2**8+this[++Y],ve=this[++Y]*2**24+this[++Y]*2**16+this[++Y]*2**8+fe;return(BigInt(ue)<<BigInt(32))+BigInt(ve)}),u.prototype.readIntLE=function(Y,ee,fe){Y=Y>>>0,ee=ee>>>0,fe||k(Y,ee,this.length);let ue=this[Y],ve=1,de=0;for(;++de<ee&&(ve*=256);)ue+=this[Y+de]*ve;return ve*=128,ue>=ve&&(ue-=Math.pow(2,8*ee)),ue},u.prototype.readIntBE=function(Y,ee,fe){Y=Y>>>0,ee=ee>>>0,fe||k(Y,ee,this.length);let ue=ee,ve=1,de=this[Y+--ue];for(;ue>0&&(ve*=256);)de+=this[Y+--ue]*ve;return ve*=128,de>=ve&&(de-=Math.pow(2,8*ee)),de},u.prototype.readInt8=function(Y,ee){return Y=Y>>>0,ee||k(Y,1,this.length),this[Y]&128?(255-this[Y]+1)*-1:this[Y]},u.prototype.readInt16LE=function(Y,ee){Y=Y>>>0,ee||k(Y,2,this.length);const fe=this[Y]|this[Y+1]<<8;return fe&32768?fe|4294901760:fe},u.prototype.readInt16BE=function(Y,ee){Y=Y>>>0,ee||k(Y,2,this.length);const fe=this[Y+1]|this[Y]<<8;return fe&32768?fe|4294901760:fe},u.prototype.readInt32LE=function(Y,ee){return Y=Y>>>0,ee||k(Y,4,this.length),this[Y]|this[Y+1]<<8|this[Y+2]<<16|this[Y+3]<<24},u.prototype.readInt32BE=function(Y,ee){return Y=Y>>>0,ee||k(Y,4,this.length),this[Y]<<24|this[Y+1]<<16|this[Y+2]<<8|this[Y+3]},u.prototype.readBigInt64LE=Ee(function(Y){Y=Y>>>0,he(Y,"offset");const ee=this[Y],fe=this[Y+7];(ee===void 0||fe===void 0)&&Ae(Y,this.length-8);const ue=this[Y+4]+this[Y+5]*2**8+this[Y+6]*2**16+(fe<<24);return(BigInt(ue)<<BigInt(32))+BigInt(ee+this[++Y]*2**8+this[++Y]*2**16+this[++Y]*2**24)}),u.prototype.readBigInt64BE=Ee(function(Y){Y=Y>>>0,he(Y,"offset");const ee=this[Y],fe=this[Y+7];(ee===void 0||fe===void 0)&&Ae(Y,this.length-8);const ue=(ee<<24)+this[++Y]*2**16+this[++Y]*2**8+this[++Y];return(BigInt(ue)<<BigInt(32))+BigInt(this[++Y]*2**24+this[++Y]*2**16+this[++Y]*2**8+fe)}),u.prototype.readFloatLE=function(Y,ee){return Y=Y>>>0,ee||k(Y,4,this.length),t.read(this,Y,!0,23,4)},u.prototype.readFloatBE=function(Y,ee){return Y=Y>>>0,ee||k(Y,4,this.length),t.read(this,Y,!1,23,4)},u.prototype.readDoubleLE=function(Y,ee){return Y=Y>>>0,ee||k(Y,8,this.length),t.read(this,Y,!0,52,8)},u.prototype.readDoubleBE=function(Y,ee){return Y=Y>>>0,ee||k(Y,8,this.length),t.read(this,Y,!1,52,8)};function H(re,Y,ee,fe,ue,ve){if(!u.isBuffer(re))throw new TypeError('"buffer" argument must be a Buffer instance');if(Y>ue||Y<ve)throw new RangeError('"value" argument is out of bounds');if(ee+fe>re.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(Y,ee,fe,ue){if(Y=+Y,ee=ee>>>0,fe=fe>>>0,!ue){const Se=Math.pow(2,8*fe)-1;H(this,Y,ee,fe,Se,0)}let ve=1,de=0;for(this[ee]=Y&255;++de<fe&&(ve*=256);)this[ee+de]=Y/ve&255;return ee+fe},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(Y,ee,fe,ue){if(Y=+Y,ee=ee>>>0,fe=fe>>>0,!ue){const Se=Math.pow(2,8*fe)-1;H(this,Y,ee,fe,Se,0)}let ve=fe-1,de=1;for(this[ee+ve]=Y&255;--ve>=0&&(de*=256);)this[ee+ve]=Y/de&255;return ee+fe},u.prototype.writeUint8=u.prototype.writeUInt8=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,1,255,0),this[ee]=Y&255,ee+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,2,65535,0),this[ee]=Y&255,this[ee+1]=Y>>>8,ee+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,2,65535,0),this[ee]=Y>>>8,this[ee+1]=Y&255,ee+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,4,4294967295,0),this[ee+3]=Y>>>24,this[ee+2]=Y>>>16,this[ee+1]=Y>>>8,this[ee]=Y&255,ee+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,4,4294967295,0),this[ee]=Y>>>24,this[ee+1]=Y>>>16,this[ee+2]=Y>>>8,this[ee+3]=Y&255,ee+4};function z(re,Y,ee,fe,ue){te(Y,fe,ue,re,ee,7);let ve=Number(Y&BigInt(4294967295));re[ee++]=ve,ve=ve>>8,re[ee++]=ve,ve=ve>>8,re[ee++]=ve,ve=ve>>8,re[ee++]=ve;let de=Number(Y>>BigInt(32)&BigInt(4294967295));return re[ee++]=de,de=de>>8,re[ee++]=de,de=de>>8,re[ee++]=de,de=de>>8,re[ee++]=de,ee}function Q(re,Y,ee,fe,ue){te(Y,fe,ue,re,ee,7);let ve=Number(Y&BigInt(4294967295));re[ee+7]=ve,ve=ve>>8,re[ee+6]=ve,ve=ve>>8,re[ee+5]=ve,ve=ve>>8,re[ee+4]=ve;let de=Number(Y>>BigInt(32)&BigInt(4294967295));return re[ee+3]=de,de=de>>8,re[ee+2]=de,de=de>>8,re[ee+1]=de,de=de>>8,re[ee]=de,ee+8}u.prototype.writeBigUInt64LE=Ee(function(Y,ee=0){return z(this,Y,ee,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Ee(function(Y,ee=0){return Q(this,Y,ee,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(Y,ee,fe,ue){if(Y=+Y,ee=ee>>>0,!ue){const We=Math.pow(2,8*fe-1);H(this,Y,ee,fe,We-1,-We)}let ve=0,de=1,Se=0;for(this[ee]=Y&255;++ve<fe&&(de*=256);)Y<0&&Se===0&&this[ee+ve-1]!==0&&(Se=1),this[ee+ve]=(Y/de>>0)-Se&255;return ee+fe},u.prototype.writeIntBE=function(Y,ee,fe,ue){if(Y=+Y,ee=ee>>>0,!ue){const We=Math.pow(2,8*fe-1);H(this,Y,ee,fe,We-1,-We)}let ve=fe-1,de=1,Se=0;for(this[ee+ve]=Y&255;--ve>=0&&(de*=256);)Y<0&&Se===0&&this[ee+ve+1]!==0&&(Se=1),this[ee+ve]=(Y/de>>0)-Se&255;return ee+fe},u.prototype.writeInt8=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,1,127,-128),Y<0&&(Y=255+Y+1),this[ee]=Y&255,ee+1},u.prototype.writeInt16LE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,2,32767,-32768),this[ee]=Y&255,this[ee+1]=Y>>>8,ee+2},u.prototype.writeInt16BE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,2,32767,-32768),this[ee]=Y>>>8,this[ee+1]=Y&255,ee+2},u.prototype.writeInt32LE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,4,2147483647,-2147483648),this[ee]=Y&255,this[ee+1]=Y>>>8,this[ee+2]=Y>>>16,this[ee+3]=Y>>>24,ee+4},u.prototype.writeInt32BE=function(Y,ee,fe){return Y=+Y,ee=ee>>>0,fe||H(this,Y,ee,4,2147483647,-2147483648),Y<0&&(Y=4294967295+Y+1),this[ee]=Y>>>24,this[ee+1]=Y>>>16,this[ee+2]=Y>>>8,this[ee+3]=Y&255,ee+4},u.prototype.writeBigInt64LE=Ee(function(Y,ee=0){return z(this,Y,ee,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Ee(function(Y,ee=0){return Q(this,Y,ee,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ie(re,Y,ee,fe,ue,ve){if(ee+fe>re.length)throw new RangeError("Index out of range");if(ee<0)throw new RangeError("Index out of range")}function ne(re,Y,ee,fe,ue){return Y=+Y,ee=ee>>>0,ue||ie(re,Y,ee,4),t.write(re,Y,ee,fe,23,4),ee+4}u.prototype.writeFloatLE=function(Y,ee,fe){return ne(this,Y,ee,!0,fe)},u.prototype.writeFloatBE=function(Y,ee,fe){return ne(this,Y,ee,!1,fe)};function Z(re,Y,ee,fe,ue){return Y=+Y,ee=ee>>>0,ue||ie(re,Y,ee,8),t.write(re,Y,ee,fe,52,8),ee+8}u.prototype.writeDoubleLE=function(Y,ee,fe){return Z(this,Y,ee,!0,fe)},u.prototype.writeDoubleBE=function(Y,ee,fe){return Z(this,Y,ee,!1,fe)},u.prototype.copy=function(Y,ee,fe,ue){if(!u.isBuffer(Y))throw new TypeError("argument should be a Buffer");if(fe||(fe=0),!ue&&ue!==0&&(ue=this.length),ee>=Y.length&&(ee=Y.length),ee||(ee=0),ue>0&&ue<fe&&(ue=fe),ue===fe||Y.length===0||this.length===0)return 0;if(ee<0)throw new RangeError("targetStart out of bounds");if(fe<0||fe>=this.length)throw new RangeError("Index out of range");if(ue<0)throw new RangeError("sourceEnd out of bounds");ue>this.length&&(ue=this.length),Y.length-ee<ue-fe&&(ue=Y.length-ee+fe);const ve=ue-fe;return this===Y&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(ee,fe,ue):Uint8Array.prototype.set.call(Y,this.subarray(fe,ue),ee),ve},u.prototype.fill=function(Y,ee,fe,ue){if(typeof Y=="string"){if(typeof ee=="string"?(ue=ee,ee=0,fe=this.length):typeof fe=="string"&&(ue=fe,fe=this.length),ue!==void 0&&typeof ue!="string")throw new TypeError("encoding must be a string");if(typeof ue=="string"&&!u.isEncoding(ue))throw new TypeError("Unknown encoding: "+ue);if(Y.length===1){const de=Y.charCodeAt(0);(ue==="utf8"&&de<128||ue==="latin1")&&(Y=de)}}else typeof Y=="number"?Y=Y&255:typeof Y=="boolean"&&(Y=Number(Y));if(ee<0||this.length<ee||this.length<fe)throw new RangeError("Out of range index");if(fe<=ee)return this;ee=ee>>>0,fe=fe===void 0?this.length:fe>>>0,Y||(Y=0);let ve;if(typeof Y=="number")for(ve=ee;ve<fe;++ve)this[ve]=Y;else{const de=u.isBuffer(Y)?Y:u.from(Y,ue),Se=de.length;if(Se===0)throw new TypeError('The value "'+Y+'" is invalid for argument "value"');for(ve=0;ve<fe-ee;++ve)this[ve+ee]=de[ve%Se]}return this};const se={};function ae(re,Y,ee){se[re]=class extends ee{constructor(){super(),Object.defineProperty(this,"message",{value:Y.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${re}]`,this.stack,delete this.name}get code(){return re}set code(ue){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ue,writable:!0})}toString(){return`${this.name} [${re}]: ${this.message}`}}}ae("ERR_BUFFER_OUT_OF_BOUNDS",function(re){return re?`${re} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ae("ERR_INVALID_ARG_TYPE",function(re,Y){return`The "${re}" argument must be of type number. Received type ${typeof Y}`},TypeError),ae("ERR_OUT_OF_RANGE",function(re,Y,ee){let fe=`The value of "${re}" is out of range.`,ue=ee;return Number.isInteger(ee)&&Math.abs(ee)>2**32?ue=ce(String(ee)):typeof ee=="bigint"&&(ue=String(ee),(ee>BigInt(2)**BigInt(32)||ee<-(BigInt(2)**BigInt(32)))&&(ue=ce(ue)),ue+="n"),fe+=` It must be ${Y}. Received ${ue}`,fe},RangeError);function ce(re){let Y="",ee=re.length;const fe=re[0]==="-"?1:0;for(;ee>=fe+4;ee-=3)Y=`_${re.slice(ee-3,ee)}${Y}`;return`${re.slice(0,ee)}${Y}`}function le(re,Y,ee){he(Y,"offset"),(re[Y]===void 0||re[Y+ee]===void 0)&&Ae(Y,re.length-(ee+1))}function te(re,Y,ee,fe,ue,ve){if(re>ee||re<Y){const de=typeof Y=="bigint"?"n":"";let Se;throw Y===0||Y===BigInt(0)?Se=`>= 0${de} and < 2${de} ** ${(ve+1)*8}${de}`:Se=`>= -(2${de} ** ${(ve+1)*8-1}${de}) and < 2 ** ${(ve+1)*8-1}${de}`,new se.ERR_OUT_OF_RANGE("value",Se,re)}le(fe,ue,ve)}function he(re,Y){if(typeof re!="number")throw new se.ERR_INVALID_ARG_TYPE(Y,"number",re)}function Ae(re,Y,ee){throw Math.floor(re)!==re?(he(re,ee),new se.ERR_OUT_OF_RANGE("offset","an integer",re)):Y<0?new se.ERR_BUFFER_OUT_OF_BOUNDS:new se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${Y}`,re)}const ge=/[^+/0-9A-Za-z-_]/g;function me(re){if(re=re.split("=")[0],re=re.trim().replace(ge,""),re.length<2)return"";for(;re.length%4!==0;)re=re+"=";return re}function je(re,Y){Y=Y||1/0;let ee;const fe=re.length;let ue=null;const ve=[];for(let de=0;de<fe;++de){if(ee=re.charCodeAt(de),ee>55295&&ee<57344){if(!ue){if(ee>56319){(Y-=3)>-1&&ve.push(239,191,189);continue}else if(de+1===fe){(Y-=3)>-1&&ve.push(239,191,189);continue}ue=ee;continue}if(ee<56320){(Y-=3)>-1&&ve.push(239,191,189),ue=ee;continue}ee=(ue-55296<<10|ee-56320)+65536}else ue&&(Y-=3)>-1&&ve.push(239,191,189);if(ue=null,ee<128){if((Y-=1)<0)break;ve.push(ee)}else if(ee<2048){if((Y-=2)<0)break;ve.push(ee>>6|192,ee&63|128)}else if(ee<65536){if((Y-=3)<0)break;ve.push(ee>>12|224,ee>>6&63|128,ee&63|128)}else if(ee<1114112){if((Y-=4)<0)break;ve.push(ee>>18|240,ee>>12&63|128,ee>>6&63|128,ee&63|128)}else throw new Error("Invalid code point")}return ve}function we(re){const Y=[];for(let ee=0;ee<re.length;++ee)Y.push(re.charCodeAt(ee)&255);return Y}function pe(re,Y){let ee,fe,ue;const ve=[];for(let de=0;de<re.length&&!((Y-=2)<0);++de)ee=re.charCodeAt(de),fe=ee>>8,ue=ee%256,ve.push(ue),ve.push(fe);return ve}function Ke(re){return e.toByteArray(me(re))}function ye(re,Y,ee,fe){let ue;for(ue=0;ue<fe&&!(ue+ee>=Y.length||ue>=re.length);++ue)Y[ue+ee]=re[ue];return ue}function xe(re,Y){return re instanceof Y||re!=null&&re.constructor!=null&&re.constructor.name!=null&&re.constructor.name===Y.name}function Ve(re){return re!==re}const be=function(){const re="0123456789abcdef",Y=new Array(256);for(let ee=0;ee<16;++ee){const fe=ee*16;for(let ue=0;ue<16;++ue)Y[fe+ue]=re[ee]+re[ue]}return Y}();function Ee(re){return typeof BigInt>"u"?Ge:re}function Ge(){throw new Error("BigInt not supported")}})(bufferPolyfill);var browser$1$1={exports:{}},process=browser$1$1.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(r){if(cachedSetTimeout===setTimeout)return setTimeout(r,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(r,0);try{return cachedSetTimeout(r,0)}catch{try{return cachedSetTimeout.call(null,r,0)}catch{return cachedSetTimeout.call(this,r,0)}}}function runClearTimeout(r){if(cachedClearTimeout===clearTimeout)return clearTimeout(r);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(r);try{return cachedClearTimeout(r)}catch{try{return cachedClearTimeout.call(null,r)}catch{return cachedClearTimeout.call(this,r)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var r=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(r)}}process.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];queue.push(new Item(r,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(r,e){this.fun=r,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop$1$1(){}process.on=noop$1$1;process.addListener=noop$1$1;process.once=noop$1$1;process.off=noop$1$1;process.removeListener=noop$1$1;process.removeAllListeners=noop$1$1;process.emit=noop$1$1;process.prependListener=noop$1$1;process.prependOnceListener=noop$1$1;process.listeners=function(r){return[]};process.binding=function(r){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(r){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};function noop$2(){}var browser$e=browser$1$1.exports.browser,emitWarning=noop$2,binding=browser$1$1.exports.binding,exit=noop$2,pid=1,features={},kill=noop$2,dlopen=noop$2,uptime=noop$2,memoryUsage=noop$2,uvCounters=noop$2,platform="browser",arch="browser",execPath="browser",execArgv=[],api$1={nextTick:browser$1$1.exports.nextTick,title:browser$1$1.exports.title,browser:browser$e,env:browser$1$1.exports.env,argv:browser$1$1.exports.argv,version:browser$1$1.exports.version,versions:browser$1$1.exports.versions,on:browser$1$1.exports.on,addListener:browser$1$1.exports.addListener,once:browser$1$1.exports.once,off:browser$1$1.exports.off,removeListener:browser$1$1.exports.removeListener,removeAllListeners:browser$1$1.exports.removeAllListeners,emit:browser$1$1.exports.emit,emitWarning,prependListener:browser$1$1.exports.prependListener,prependOnceListener:browser$1$1.exports.prependOnceListener,listeners:browser$1$1.exports.listeners,binding,cwd:browser$1$1.exports.cwd,chdir:browser$1$1.exports.chdir,umask:browser$1$1.exports.umask,exit,pid,features,kill,dlopen,uptime,memoryUsage,uvCounters,platform,arch,execPath,execArgv},addListener$1=browser$1$1.exports.addListener,argv=browser$1$1.exports.argv,chdir=browser$1$1.exports.chdir,cwd=browser$1$1.exports.cwd,emit=browser$1$1.exports.emit,env=browser$1$1.exports.env,listeners=browser$1$1.exports.listeners,nextTick=browser$1$1.exports.nextTick,off=browser$1$1.exports.off,on=browser$1$1.exports.on,once$1=browser$1$1.exports.once,prependListener=browser$1$1.exports.prependListener,prependOnceListener=browser$1$1.exports.prependOnceListener,removeAllListeners=browser$1$1.exports.removeAllListeners,removeListener$1=browser$1$1.exports.removeListener,title=browser$1$1.exports.title,umask=browser$1$1.exports.umask,version$4=browser$1$1.exports.version,versions=browser$1$1.exports.versions;const process$1=Object.freeze(Object.defineProperty({__proto__:null,addListener:addListener$1,arch,argv,binding,browser:browser$e,chdir,cwd,default:api$1,dlopen,emit,emitWarning,env,execArgv,execPath,exit,features,kill,listeners,memoryUsage,nextTick,off,on,once:once$1,pid,platform,prependListener,prependOnceListener,removeAllListeners,removeListener:removeListener$1,title,umask,uptime,uvCounters,version:version$4,versions},Symbol.toStringTag,{value:"Module"})),require$$1$2=getAugmentedNamespace(process$1);(function(r){Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});const e=bufferPolyfill,t=require$$1$2,n=c=>c&&c.__esModule?c:{default:c},a=n(t),o=globalThis||void 0||self;Object.defineProperty(r,"Buffer",{enumerable:!0,get:()=>e.Buffer}),Object.defineProperty(r,"process",{enumerable:!0,get:()=>a.default}),r.global=o})(dist);function append(r,e){r.appendChild(e)}function insert(r,e,t){r.insertBefore(e,t||null)}function detach(r){r.parentNode&&r.parentNode.removeChild(r)}function destroy_each(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function element(r){return document.createElement(r)}function svg_element(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function text(r){return document.createTextNode(r)}function space(){return text(" ")}function empty(){return text("")}function listen(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function attr(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function children(r){return Array.from(r.childNodes)}function set_data(r,e){e=""+e,r.data!==e&&(r.data=e)}function set_style(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,"")}function custom_event(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let current_component;function set_current_component(r){current_component=r}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(r){get_current_component().$$.on_mount.push(r)}function onDestroy(r){get_current_component().$$.on_destroy.push(r)}function createEventDispatcher(){const r=get_current_component();return(e,t,{cancelable:n=!1}={})=>{const a=r.$$.callbacks[e];if(a){const o=custom_event(e,t,{cancelable:n});return a.slice().forEach(c=>{c.call(r,o)}),!o.defaultPrevented}return!0}}const dirty_components=[],binding_callbacks=[];let render_callbacks=[];const flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(r){render_callbacks.push(r)}const seen_callbacks=new Set;let flushidx=0;function flush(){if(flushidx!==0)return;const r=current_component;do{try{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}}catch(e){throw dirty_components.length=0,flushidx=0,e}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(r)}function update(r){if(r.fragment!==null){r.update(),run_all(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(add_render_callback)}}function flush_render_callbacks(r){const e=[],t=[];render_callbacks.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),render_callbacks=e}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(r,e){r&&r.i&&(outroing.delete(r),r.i(e))}function transition_out(r,e,t,n){if(r&&r.o){if(outroing.has(r))return;outroing.add(r),outros.c.push(()=>{outroing.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function ensure_array_like(r){return r?.length!==void 0?r:Array.from(r)}function destroy_block(r,e){r.d(1),e.delete(r.key)}function update_keyed_each(r,e,t,n,a,o,c,u,v,_,x,E){let M=r.length,C=o.length,I=M;const D={};for(;I--;)D[r[I].key]=I;const L=[],N=new Map,q=new Map,F=[];for(I=C;I--;){const X=E(a,o,I),J=t(X);let G=c.get(J);G?F.push(()=>G.p(X,e)):(G=_(J,X),G.c()),N.set(J,L[I]=G),J in D&&q.set(J,Math.abs(I-D[J]))}const U=new Set,j=new Set;function W(X){transition_in(X,1),X.m(u,x),c.set(X.key,X),x=X.first,C--}for(;M&&C;){const X=L[C-1],J=r[M-1],G=X.key,oe=J.key;X===J?(x=X.first,M--,C--):N.has(oe)?!c.has(G)||U.has(G)?W(X):j.has(oe)?M--:q.get(G)>q.get(oe)?(j.add(G),W(X)):(U.add(oe),M--):(v(J,c),M--)}for(;M--;){const X=r[M];N.has(X.key)||v(X,c)}for(;C;)W(L[C-1]);return run_all(F),L}function create_component(r){r&&r.c()}function mount_component(r,e,t){const{fragment:n,after_update:a}=r.$$;n&&n.m(e,t),add_render_callback(()=>{const o=r.$$.on_mount.map(run).filter(is_function);r.$$.on_destroy?r.$$.on_destroy.push(...o):run_all(o),r.$$.on_mount=[]}),a.forEach(add_render_callback)}function destroy_component(r,e){const t=r.$$;t.fragment!==null&&(flush_render_callbacks(t.after_update),run_all(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function make_dirty(r,e){r.$$.dirty[0]===-1&&(dirty_components.push(r),schedule_update(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function init(r,e,t,n,a,o,c=null,u=[-1]){const v=current_component;set_current_component(r);const _=r.$$={fragment:null,ctx:[],props:o,update:noop$3,not_equal:a,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(v?v.$$.context:[])),callbacks:blank_object(),dirty:u,skip_bound:!1,root:e.target||v.$$.root};c&&c(_.root);let x=!1;if(_.ctx=t?t(r,e.props||{},(E,M,...C)=>{const I=C.length?C[0]:M;return _.ctx&&a(_.ctx[E],_.ctx[E]=I)&&(!_.skip_bound&&_.bound[E]&&_.bound[E](I),x&&make_dirty(r,E)),M}):[],_.update(),x=!0,run_all(_.before_update),_.fragment=n?n(_.ctx):!1,e.target){if(e.hydrate){const E=children(e.target);_.fragment&&_.fragment.l(E),E.forEach(detach)}else _.fragment&&_.fragment.c();e.intro&&transition_in(r.$$.fragment),mount_component(r,e.target,e.anchor),flush()}set_current_component(v)}class SvelteComponent{$$=void 0;$$set=void 0;$destroy(){destroy_component(this,1),this.$destroy=noop$3}$on(e,t){if(!is_function(t))return noop$3;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const a=n.indexOf(t);a!==-1&&n.splice(a,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const PUBLIC_VERSION="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(PUBLIC_VERSION);const subscriber_queue=[];function writable(r,e=noop$3){let t;const n=new Set;function a(u){if(safe_not_equal(r,u)&&(r=u,t)){const v=!subscriber_queue.length;for(const _ of n)_[1](),subscriber_queue.push(_,r);if(v){for(let _=0;_<subscriber_queue.length;_+=2)subscriber_queue[_][0](subscriber_queue[_+1]);subscriber_queue.length=0}}}function o(u){a(u(r))}function c(u,v=noop$3){const _=[u,v];return n.add(_),n.size===1&&(t=e(a,o)||noop$3),u(r),()=>{n.delete(_),n.size===0&&t&&(t(),t=null)}}return{set:a,update:o,subscribe:c}}function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var gun$1={exports:{}};gun$1.exports;(function(r){(function(){function e(n,a){return a?commonjsRequire(n):n.slice?e[o(n)]:function(c,u){n(c={exports:{}}),e[o(u)]=c.exports};function o(c){return c.split("/").slice(-1).toString().replace(".js","")}}var t=r;e(function(n){String.random=function(o,c){var u="";for(o=o||24,c=c||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";o-- >0;)u+=c.charAt(Math.floor(Math.random()*c.length));return u},String.match=function(o,c){var u,v;return typeof o!="string"?!1:(typeof c=="string"&&(c={"=":c}),c=c||{},u=c["="]||c["*"]||c[">"]||c["<"],o===u?!0:v!==c["="]?!1:(u=c["*"]||c[">"],o.slice(0,(u||"").length)===u?!0:v!==c["*"]?!1:v!==c[">"]&&v!==c["<"]?o>=c[">"]&&o<=c["<"]:v!==c[">"]&&o>=c[">"]||v!==c["<"]&&o<=c["<"]))},String.hash=function(o,c){if(typeof o=="string"){if(c=c||0,!o.length)return c;for(var u=0,v=o.length,_;u<v;++u)_=o.charCodeAt(u),c=(c<<5)-c+_,c|=0;return c}};var a=Object.prototype.hasOwnProperty;Object.plain=function(o){return o?o instanceof Object&&o.constructor===Object||Object.prototype.toString.call(o).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(o,c){for(var u in o)if(a.call(o,u)&&(!c||c.indexOf(u)==-1))return!1;return!0},Object.keys=Object.keys||function(o){var c=[];for(var u in o)a.call(o,u)&&c.push(u);return c},function(){var o,c=setTimeout,u=0,v=0,_=typeof setImmediate!=""+o&&setImmediate||function(E,M){return typeof MessageChannel==""+o?c:((E=new MessageChannel).port1.onmessage=function(C){C.data==""&&M()},function(C){M=C,E.port2.postMessage("")})}(),x=c.check=c.check||typeof performance!=""+o&&performance||{now:function(){return+new Date}};c.hold=c.hold||9,c.poll=c.poll||function(E){if(c.hold>=x.now()-u&&v++<3333){E();return}_(function(){u=x.now(),E()},v=0)}}(),function(){var o=setTimeout,c=o.turn=o.turn||function(M){u.push(M)==1&&v(E)},u=c.s=[],v=o.poll,_=0,x,E=function(){(x=u[_++])&&x(),(_==u.length||_==99)&&(u=c.s=u.slice(_),_=0),u.length&&v(E)}}(),function(){var o,c=setTimeout,u=c.turn;(c.each=c.each||function(v,_,x,E){E=E||9,function M(C,I,D){if(I=(C=(v||[]).splice(0,E)).length){for(var L=0;L<I&&o===(D=_(C[L]));L++);if(o===D){u(M);return}}x&&x(D)}()})()}()})(e,"./shim"),e(function(n){n.exports=function a(x,c,u){if(!x)return{to:a};var v,_=typeof c=="function",x=(this.tag||(this.tag={}))[x]||_&&(this.tag[x]={tag:x,to:a._={next:function(M){var C;(C=this.to)&&C.next(M)}}});if(_){var E={off:a.off||(a.off=function(){if(this.next===a._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=a._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:a._,next:c,the:x,on:this,as:u};return(E.back=x.last||x).to=E,x.last=E}return(x=x.to)&&v!==c&&x.next(c),x}})(e,"./onto"),e(function(n){n.exports=function(a){return a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"&&a!=1/0&&a!=-1/0&&a===a||!!a&&typeof a["#"]=="string"&&Object.keys(a).length===1&&a["#"]}})(e,"./valid"),e(function(n){e("./shim");function a(){var x=+new Date;return v<x?(c=0,v=x+a.drift):v=x+(c+=1)/u+a.drift}a.drift=0;var o=-1/0,c=0,u=999,v=o,_;a.is=function(x,E,M){var C=E&&x&&x._&&x._[">"]||M;if(C)return typeof(C=C[E])=="number"?C:o},a.ify=function(x,E,M,C,I){(x=x||{})._=x._||{},I&&(x._["#"]=I);var D=x._[">"]||(x._[">"]={});return _!==E&&E!=="_"&&(typeof M=="number"&&(D[E]=M),_!==C&&(x[E]=C)),x},n.exports=a})(e,"./state"),e(function(n){e("./shim");function a(o){var c={s:{}},u=c.s;o=o||{max:999,age:1e3*9},c.check=function(_){return u[_]?v(_):!1};var v=c.track=function(_){var x=u[_]||(u[_]={});return x.was=c.now=+new Date,c.to||(c.to=setTimeout(c.drop,o.age+9)),v.ed&&v.ed(_),x};return c.drop=function(_){c.to=null,c.now=+new Date;var x=Object.keys(u);console.STAT&&console.STAT(c.now,+new Date-c.now,"dup drop keys"),setTimeout.each(x,function(E){var M=u[E];M&&(_||o.age)>c.now-M.was||delete u[E]},0,99)},c}n.exports=a})(e,"./dup"),e(function(n){e("./onto"),n.exports=function(c,u){if(this.on){var v=(this.opt||{}).lack||9e3;if(typeof c!="function"){if(!c)return;var x=c["#"]||c,_=(this.tag||"")[x];return _?(u&&(_=this.on(x,u),clearTimeout(_.err),_.err=setTimeout(function(){_.off()},v)),!0):void 0}var x=u&&u["#"]||a(9);if(!c)return x;var E=this.on(x,c,u);return E.err=E.err||setTimeout(function(){E.off(),E.next({err:"Error: No ACK yet.",lack:!0})},v),x}};var a=String.random||function(){return Math.random().toString(36).slice(2)}})(e,"./ask"),e(function(n){function a(I){return I instanceof a?(this._={$:this}).$:this instanceof a?a.create(this._={$:this,opt:I}):new a(I)}a.is=function(I){return I instanceof a||I&&I._&&I===I._.$||!1},a.version=.202,a.chain=a.prototype,a.chain.toJSON=function(){},e("./shim"),a.valid=e("./valid"),a.state=e("./state"),a.on=e("./onto"),a.dup=e("./dup"),a.ask=e("./ask"),function(){a.create=function(p){p.root=p.root||p,p.graph=p.graph||{},p.on=p.on||a.on,p.ask=p.ask||a.ask,p.dup=p.dup||a.dup();var b=p.$.opt(p.opt);return p.once||(p.on("in",I,p),p.on("out",I,p),p.on("put",N,p),a.on("create",p),p.on("create",p)),p.once=1,b};function I(p){if(p){if(p.out===I){this.to.next(p);return}var b=this,S=b.as,T=S.at||S,B=T.$,$=T.dup,A,g=p.DBG;if((A=p["#"])||(A=p["#"]=c(9)),!$.check(A)){if($.track(A),A=p._,p._=typeof A=="function"?A:function(){},p.$&&p.$===(p.$._||"").$||(p.$=B),p["@"]&&!p.put&&F(p),!T.ask(p["@"],p))if(g&&(g.u=+new Date),p.put){D(p);return}else p.get&&a.on.get(p,B);g&&(g.uc=+new Date),b.to.next(p),g&&(g.ua=+new Date),!(p.nts||p.NTS)&&(p.out=I,T.on("out",p),g&&(g.ue=+new Date))}}}function D(p){if(p){var b=p._||"",S=b.root=((b.$=p.$||"")._||"").root;if(p["@"]&&b.faith&&!b.miss){p.out=I,S.on("out",p);return}b.latch=S.hatch,b.match=S.hatch=[];var T=p.put,B=b.DBG=p.DBG,$=+new Date;if(O=O||$,!(T["#"]&&T["."])){B&&(B.p=$),b["#"]=p["#"],b.msg=p,b.all=0,b.stun=1;var A=Object.keys(T);console.STAT&&console.STAT($,((B||b).pk=+new Date)-$,"put sort");var g=0,k,H,z,Q,ie,ne,Z;(function se(ae){if(k!=g){if(k=g,!(z=A[g])){console.STAT&&console.STAT($,((B||b).pd=+new Date)-$,"put"),q(b);return}(Q=T[z])?(Z=Q._)?z!==Z["#"]?ne=j+W(z)+"soul not same.":(ie=Z[">"])||(ne=j+W(z)+"no state."):ne=j+W(z)+"no meta.":ne=j+W(z)+"no node.",H=Object.keys(Q||{})}if(ne){p.err=b.err=ne,q(b);return}var ce=0,le;for(ae=ae||0;ae++<9&&(le=H[ce++]);)if(le!=="_"){var te=Q[le],he=ie[le];if(E===he){ne=j+W(le)+"on"+W(z)+"no state.";break}if(!v(te)){ne=j+W(le)+"on"+W(z)+"bad "+typeof te+W(te);break}L(te,le,z,he,p),++oe}if((H=H.slice(ce)).length){u(se);return}++g,H=null,se(ae)})()}}}a.on.put=D;function L(p,b,S,T,B){var $=B._||"",A=$.root,g=A.graph,k,H=g[S]||M,z=_(H,b,1),Q=H[b],ie=$.DBG;(k=console.STAT)&&(!g[S]||!Q)&&(k.has=(k.has||0)+1);var ne=G();if(T>ne){setTimeout(function(){L(p,b,S,T,B)},(k=T-ne)>J?J:k),console.STAT&&console.STAT((ie||$).Hf=+new Date,k,"future");return}if(!(T<z)&&!(!$.faith&&T===z&&(p===Q||X(p)<=X(Q))&&!$.miss)){$.stun++;var Z=B["#"]+$.all++,se={toString:function(){return Z},_:$};se.toJSON=se.toString,A.dup.track(se)["#"]=B["#"],ie&&(ie.ph=ie.ph||+new Date),A.on("put",{"#":se,"@":B["@"],put:{"#":S,".":b,":":p,">":T},ok:B.ok,_:$})}}function N(p){var b;(b=(p._||"").DBG)&&(b.pa=+new Date,b.pm=b.pm||+new Date);var S=this,T=S.as,B=T.graph,$=p._,A=p.put,g=A["#"],k=A["."],H=A[":"],z=A[">"];p["#"];var Q;(Q=$.msg)&&(Q=Q.put)&&(Q=Q[g])&&x(Q,k,z,H,g),B[g]=x(B[g],k,z,H,g),(Q=(T.next||"")[g])&&Q.on("in",p),q($),S.to.next(p)}function q(p,b){var S;if(!p.stop&&!(!p.err&&0<--p.stun)&&(p.stop=1,!!(S=p.root))){var T=p.match;T.end=1,T===S.hatch&&(!(T=p.latch)||T.end?delete S.hatch:S.hatch=T),p.hatch&&p.hatch(),setTimeout.each(p.match,function(B){B&&B()}),!(!(b=p.msg)||p.err||b.err)&&(b.out=I,p.root.on("out",b),l())}}function F(p){var b=p["@"]||"",S;if(!(S=b._)){var T=(T=p.$)&&(T=T._)&&(T=T.root)&&(T=T.dup);if(!(T=T.check(b)))return;p["@"]=T["#"]||p["@"];return}S.acks=(S.acks||0)+1,(S.err=p.err)&&(p["@"]=S["#"],q(S)),S.ok=p.ok||S.ok,!S.stop&&!S.crack&&(S.crack=S.match&&S.match.push(function(){U(S)})),U(S)}function U(p){!p||!p.root||p.stun||p.acks!==p.all||p.root.on("in",{"@":p["#"],err:p.err,ok:p.err?E:p.ok||{"":1}})}var j="Error: Invalid graph!",W=function(p){return" '"+(""+p).slice(0,9)+"...' "},X=JSON.stringify,J=2147483647,G=a.state,oe=0,O,l=function(){oe>999&&oe/-(O-(O=+new Date))>1&&(a.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),l=function(){oe=0})}}(),function(){a.on.get=function(D,L){var N=L._,q=D.get,F=q["#"],U=N.graph[F],j=q["."],W=N.next||(N.next={}),X=W[F],J=D._||{},G=J.DBG=D.DBG;if(G&&(G.g=+new Date),!U)return N.on("get",D);if(j){if((typeof j!="string"||E===U[j])&&!((X||"").next||"")[j]){N.on("get",D);return}U=x({},j,_(U,j),U[j],F)}U&&I(D,U),N.on("get",D)};function I(D,L){var N=+new Date,q=D._||{},F=q.DBG=D.DBG,U=D["#"],j=c(9),W=Object.keys(L||"").sort(),X=((L||"")._||"")["#"];W.length;var J=D.$._.root,G=L===J.graph[X];console.STAT&&console.STAT(N,((F||q).gk=+new Date)-N,"got keys"),L&&function oe(){N=+new Date;for(var O=0,l,p={},b;O<9&&(l=W[O++]);)x(p,l,_(L,l),L[l],X);W=W.slice(O),(b={})[X]=p,p=b;var S;G&&(S=function(){},S.ram=S.faith=!0),b=W.length,console.STAT&&console.STAT(N,-(N-(N=+new Date)),"got copied some"),F&&(F.ga=+new Date),J.on("in",{"@":U,"#":j,put:p,"%":b?j=c(9):E,$:J.$,_:S,DBG:F,FOO:1}),console.STAT&&console.STAT(N,+new Date-N,"got in"),b&&setTimeout.turn(oe)}(),L||J.on("in",{"@":D["#"]})}a.on.get.ack=I}(),function(){a.chain.opt=function(I){I=I||{};var D=this,L=D._,N=I.peers||I;return Object.plain(I)||(I={}),Object.plain(L.opt)||(L.opt=I),typeof N=="string"&&(N=[N]),Object.plain(L.opt.peers)||(L.opt.peers={}),N instanceof Array&&(I.peers={},N.forEach(function(q){var F={};F.id=F.url=q,I.peers[q]=L.opt.peers[q]=L.opt.peers[q]||F})),o(I,function q(F){var U=this[F];if(this&&this.hasOwnProperty(F)||typeof U=="string"||Object.empty(U)){this[F]=U;return}U&&U.constructor!==Object&&!(U instanceof Array)||o(U,q)}),L.opt.from=I,a.on("opt",L),L.opt.uuid=L.opt.uuid||function(F){return a.state().toString(36).replace(".","")+String.random(F||12)},D}}();var o=function(I,D){Object.keys(I).forEach(D,I)},c=String.random,u=setTimeout.turn,v=a.valid,_=a.state.is,x=a.state.ify,E,M={},C;a.log=function(){return!a.log.off&&C.log.apply(C,arguments),[].slice.call(arguments).join(" ")},a.log.once=function(I,D,L){return(L=a.log.once)[I]=L[I]||0,L[I]++||a.log(D)},typeof window<"u"&&((window.GUN=window.Gun=a).window=window);try{typeof t<"u"&&(t.exports=a)}catch{}n.exports=a,(a.window||{}).console=(a.window||{}).console||{log:function(){}},(C=console).only=function(I,D){return C.only.i&&I===C.only.i&&C.only.i++&&(C.log.apply(C,arguments)||D)},a.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(e,"./root"),e(function(n){var a=e("./root");a.chain.back=function(u,v){var _;if(u=u||1,u===-1||u===1/0)return this._.root.$;if(u===1)return(this._.back||this._).$;var x=this,E=x._;if(typeof u=="string"&&(u=u.split(".")),u instanceof Array){var M=0,C=u.length,_=E;for(M;M<C;M++)_=(_||o)[u[M]];return c!==_?v?x:_:(_=E.back)?_.$.back(u,v):void 0}if(typeof u=="function"){for(var I,_={back:E};(_=_.back)&&c===(I=u(_,v)););return I}return typeof u=="number"?(E.back||E).$.back(u-1):this};var o={},c})(e,"./back"),e(function(n){var a=e("./root");a.chain.chain=function(q){var F=this,U=F._,j=new(q||F).constructor(F),W=j._,X;return W.root=X=U.root,W.id=++X.once,W.back=F._,W.on=a.on,W.on("in",a.on.in,W),W.on("out",a.on.out,W),j};function o(q){var F,U=this.as,j=U.back,W=U.root,X;if(q.$||(q.$=U.$),this.to.next(q),U.err){U.on("in",{put:U.put=E,$:U.$});return}if(F=q.get){if(W.pass&&(W.pass[U.id]=U),U.lex&&Object.keys(U.lex).forEach(function(J){X[J]=U.lex[J]},X=q.get=q.get||{}),F["#"]||U.soul){if(F["#"]=F["#"]||U.soul,q["#"]||(q["#"]=M(9)),j=W.$.get(F["#"])._,F=F["."]){if(I(j.put,F)&&(X=j.ask&&j.ask[F],(j.ask||(j.ask={}))[F]=j.$.get(F)._,j.on("in",{get:F,put:{"#":j.soul,".":F,":":j.put[F],">":L(W.graph[j.soul],F)}}),X))return}else{if(X=j.ask&&j.ask[""],(j.ask||(j.ask={}))[""]=j,E!==j.put&&(j.on("in",j),X))return;q.$=j.$}return W.ask(_,q),W.on("in",q)}if(F["."])return U.get?(q={get:{".":U.get},$:U.$},(j.ask||(j.ask={}))[U.get]=q.$._,j.on("out",q)):(q={get:U.lex?q.get:{},$:U.$},j.on("out",q));if((U.ask||(U.ask={}))[""]=U,U.get)return F["."]=U.get,(j.ask||(j.ask={}))[U.get]=q.$._,j.on("out",q)}return j.on("out",q)}a.on.out=o;function c(q,F){F=F||this.as;var U=F.root,j=q.$||(q.$=F.$),W=(j||"")._||x,X=q.put||"",J=X["#"],G=X["."],oe=E!==X["="]?X["="]:X[":"],O=X[">"]||-1/0,l;if(E!==q.put&&(E===X["#"]||E===X["."]||E===X[":"]&&E===X["="]||E===X[">"])){if(!C(X)){if(!(J=((X||"")._||"")["#"])){console.log("chain not yet supported for",X,"...",q,F);return}return j=F.root.$.get(J),setTimeout.each(Object.keys(X).sort(),function(p){p=="_"||E===(O=L(X,p))||F.on("in",{$:j,put:{"#":J,".":p,"=":X[p],">":O},VIA:q})})}F.on("in",{$:W.back.$,put:{"#":J=W.back.soul,".":G=W.has||W.get,"=":X,">":L(W.back.put,G)},via:q});return}(q.seen||"")[F.id]||((q.seen||(q.seen=function(){}))[F.id]=F,F!==W&&(Object.keys(q).forEach(function(p){X[p]=q[p]},X={}),X.get=F.get||X.get,!F.soul&&!F.has?X.$$$=X.$$$||F.$:W.soul&&(X.$=F.$,X.$$=X.$$||W.$),q=X),v(q,F),(F.soul||q.$$)&&O>=L(U.graph[J],G)&&((X=U.$.get(J)._).put=N(X.put,G,O,oe,J)),!W.soul&&O>=L(U.graph[J],G)&&(l=(U.$.get(J)._.next||"")[G])&&(l.put=oe,typeof(X=C(oe))=="string"&&(l.put=U.$.get(X)._.put||oe)),this.to&&this.to.next(q),F.any&&setTimeout.each(Object.keys(F.any),function(p){(p=F.any[p])&&p(q)},0,99),F.echo&&setTimeout.each(Object.keys(F.echo),function(p){(p=F.echo[p])&&p.on("in",q)},0,99),((q.$$||"")._||W).soul&&(l=F.next)&&(l=l[G])&&(X={},Object.keys(q).forEach(function(p){X[p]=q[p]}),X.$=(q.$$||q.$).get(X.get=G),delete X.$$,delete X.$$$,l.on("in",X)),u(q,F))}a.on.in=c;function u(q,F){if(F=F||this.as||q.$._,!(q.$$&&this!==a.on)&&!(!q.put||F.soul)){var U=q.put||"",j=U["="]||U[":"],G,W=F.root,X=W.$.get(U["#"]).get(U["."])._;if(typeof(j=C(j))!="string"){this===a.on&&((X.echo||(X.echo={}))[F.id]=F);return}if(!((X.echo||(X.echo={}))[F.id]&&!(W.pass||"")[F.id])){if(G=W.pass){if(G[j+F.id])return;G[j+F.id]=1}(X.echo||(X.echo={}))[F.id]=F,F.has&&(F.link=j);var J=W.$.get(X.link=j)._;(J.echo||(J.echo={}))[X.id]=X;var G=F.ask||"";(G[""]||F.lex)&&J.on("out",{get:{"#":j}}),setTimeout.each(Object.keys(G),function(oe,O){!oe||!(O=G[oe])||O.on("out",{get:{"#":j,".":oe}})},0,99)}}}a.on.link=u;function v(q,F){var U=q.put||"",j=E!==U["="]?U["="]:U[":"],W=F.root,X,J;if(E===j){if(F.soul&&E!==F.put||(J=(q.$$||q.$||"")._||"",q["@"]&&(E!==J.put||E!==F.put)))return;(X=F.link||q.linked)&&delete(W.$.get(X)._.echo||"")[F.id],F.has&&(F.link=null),F.put=E,setTimeout.each(Object.keys(F.next||""),function(G,oe){(oe=F.next[G])&&(X&&delete(W.$.get(X).get(G)._.echo||"")[oe.id],oe.on("in",{get:G,put:E,$:oe.$}))},0,99);return}F.soul||q.$$||(X=C(j),J=q.$._||"",!((X===J.link||F.has&&!J.link)&&!((W.pass||"")[F.id]&&typeof X!="string"))&&(delete(J.echo||"")[F.id],v({get:F.get,put:E,$:q.$,linked:q.linked=q.linked||J.link},F)))}a.on.unlink=v;function _(q,F){var U=this.as,j=U.$._;j.root;var W=U.get||"",X=(q.put||"")[W["#"]]||"";if(!q.put||typeof W["."]=="string"&&E===X[W["."]]){if(E!==j.put||!j.soul&&!j.has)return;j.ack=(j.ack||0)+1,j.on("in",{get:j.get,put:j.put=E,$:j.$,"@":q["@"]});return}(q._||{}).miss=1,a.on.put(q)}var x={},E,M=String.random,C=a.valid,I=function(q,F){return q&&Object.prototype.hasOwnProperty.call(q,F)},D=a.state,L=D.is,N=D.ify})(e,"./chain"),e(function(n){var a=e("./root");a.chain.get=function(E,M,C){var I,D;if(typeof E=="string"){if(E.length==0)return(I=this.chain())._.err={err:a.log("0 length key!",E)},M&&M.call(I,I._.err),I;var L=this,N=L._,q=N.next||v;(I=q[E])||(I=E&&o(E,L)),I=I&&I.$}else if(typeof E=="function"){let G=function(oe,O,l){if(!G.stun&&!(($=U.pass)&&!$[j])){var p=oe.$._,b=(oe.$$||"")._,S=(b||p).put,T=!p.has&&!p.soul,B={},$;if((T||x===S)&&(S=x===(($=oe.put)||"")["="]?x===($||"")[":"]?$:$[":"]:$["="]),typeof($=a.valid(S))=="string"&&(S=x===($=U.$.get($)._.put)?F.not?x:S:$),!(F.not&&x===S)){if(x===F.stun){if(($=U.stun)&&$.on&&(N.$.back(function(A){if($.on(""+A.id,B={}),(B.run||0)<G.id)return B}),!B.run&&$.on(""+p.id,B={}),!B.run&&b&&$.on(""+b.id,B={}),G.id>B.run&&((!B.stun||B.stun.end)&&(B.stun=$.on("stun"),B.stun=B.stun&&B.stun.last),B.stun&&!B.stun.end))){(B.stun.add||(B.stun.add={}))[j]=function(){G(oe,O,1)};return}if(x===S&&(l=0),($=U.hatch)&&!$.end&&x===F.hatch&&!l){if(W[p.$._.id])return;W[p.$._.id]=1,$.push(function(){G(oe,O,1)});return}W={}}if(U.pass){if(U.pass[j+p.id])return;U.pass[j+p.id]=1}if(F.on){F.ok.call(p.$,S,p.get,oe,O||G);return}if(F.v2020){F.ok(oe,O||G);return}Object.keys(oe).forEach(function(A){$[A]=oe[A]},$={}),oe=$,oe.put=S,F.ok.call(F.as,oe,O||G)}}};var X=G;if(M===!0)return c(this,E,M,C),this;I=this;var N=I._,F=M||{},U=N.root,j;F.at=N,F.ok=E;var W={};return G.at=N,(N.any||(N.any={}))[j=String.random(7)]=G,G.off=function(){G.stun=1,N.any&&delete N.any[j]},G.rid=u,G.id=F.run||++U.once,D=U.pass,(U.pass={})[j]=1,F.out=F.out||{get:{}},N.on("out",F.out),U.pass=D,I}else{if(typeof E=="number")return this.get(""+E,M,C);if(typeof(D=_(E))=="string")return this.get(D,M,C);(D=this.get.next)&&(I=D(this,E))}return I?(M&&typeof M=="function"&&I.get(M,C),I):((I=this.chain())._.err={err:a.log("Invalid get request!",E)},M&&M.call(I,I._.err),I)};function o(E,M){var C=M._,I=C.next,D=M.chain(),L=D._;return I||(I=C.next={}),I[L.get=E]=L,M===C.root.$?L.soul=E:(C.soul||C.has)&&(L.has=E),L}function c(E,M,C,I){var D=E._,L=0,N;return(N=D.soul||D.link)?M(N,I,D):D.jam?D.jam.push([M,I]):(D.jam=[[M,I]],E.get(function(F,U){if(!(x===F.put&&!D.root.opt.super&&(N=Object.keys(D.root.opt.peers).length)&&++L<=N)){U.rid(F);var j=(j=F.$)&&j._||{},W=0,X;for(N=D.jam,delete D.jam;X=N[W++];){var J=X[0];X=X[1],J&&J(j.link||j.soul||a.valid(F.put)||((F.put||{})._||{})["#"],X,F,U)}}},{out:{get:{".":!0}}}),E)}function u(E){var M=this.at||this.on;if(!E||M.soul||M.has)return this.off();if(E=(E=(E=E.$||E)._||E).id){M.map;var C;if((C=this.seen||(this.seen={}))[E])return!0;C[E]=!0}}var v={},_=a.valid,x})(e,"./get"),e(function(n){var a=e("./root");a.chain.put=function(I,D,L){var N=this,q=N._,F=q.root;L=L||{},L.root=q.root,L.run||(L.run=F.once),o(L,q.id),L.ack=L.ack||D,L.via=L.via||N,L.data=L.data||I,L.soul||(L.soul=q.soul||typeof D=="string"&&D);var U=L.state=L.state||a.state();return typeof I=="function"?(I(function(j){L.data=j,N.put(_,_,L)}),N):L.soul?(L.$=F.$.get(L.soul),L.todo=[{it:L.data,ref:L.$}],L.turn=L.turn||E,L.ran=L.ran||c,function j(){var W=L.todo,X=W.pop(),J=X.it;X.ref&&X.ref._.id;var G,oe,O,l,p;if(o(L,X.ref),(l=X.todo)&&(oe=l.pop(),J=J[oe],l.length&&W.push(X)),oe&&(W.path||(W.path=[])).push(oe),!(G=M(J))&&!(p=a.is(J))){if(!Object.plain(J)){c.err(L,"Invalid data: "+v(J)+" at "+(L.via.back(function($){$.get&&l.push($.get)},l=[])||l.join("."))+"."+(W.path||[]).join("."));return}for(var b=L.seen||(L.seen=[]),S=b.length;S--;)if(J===(l=b[S]).it){G=J=l.link;break}}if(oe&&G)X.node=C(X.node,oe,U,J);else{let $=function(A,g){var k=O.link["#"];g&&(g.off(),g.rid(A));var H=k||A.soul||(l=(A.$$||A.$)._||"").soul||l.link||((l=l.put||"")._||"")["#"]||l["#"]||((l=A.put||"")&&A.$$?l["#"]:(l["="]||l[":"]||"")["#"]);if(!k&&o(L,A.$),!H&&!X.link["#"]){(X.wait||(X.wait=[])).push(function(){$(A,g)});return}H||(H=[],(A.$$||A.$).back(function(z){if(l=z.soul||z.link)return H.push(l);H.push(z.get)}),H=H.reverse().join("/")),O.link["#"]=H,!p&&(((L.graph||(L.graph={}))[H]=O.node||(O.node={_:{}}))._["#"]=H),delete L.wait[T],O.wait&&setTimeout.each(O.wait,function(z){z&&z()}),L.ran(L)};var B=$;if(!L.seen){c.err(L,"Data at root of graph must be a node (an object).");return}L.seen.push(O={it:J,link:{},todo:p?[]:Object.keys(J).sort().reverse(),path:(W.path||[]).slice(),up:X}),X.node=C(X.node,oe,U,O.link),!p&&O.todo.length&&W.push(O);var T=L.seen.length;(L.wait||(L.wait={}))[T]="",l=(O.ref=p?J:oe?X.ref.get(oe):X.ref)._,(l=J&&(J._||"")["#"]||l.soul||l.link)?$({soul:l}):O.ref.get($,{run:L.run,v2020:1,out:{get:{".":" "}}})}if(!W.length)return L.ran(L);L.turn(j)}(),N):(u(L),N)};function o(I,D){if(D){D=(D._||"").id||D;var L=I.root.stun||(I.root.stun={on:a.on}),N={},q;I.stun||(I.stun=L.on("stun",function(){})),(q=L.on(""+D))&&q.the.last.next(N),!(N.run>=I.run)&&L.on(""+D,function(F){if(I.stun.end){this.off(),this.to.next(F);return}F.run=F.run||I.run,F.stun=F.stun||I.stun})}}function c(I){if(I.err){c.end(I.stun,I.root);return}if(!(I.todo.length||I.end||!Object.empty(I.wait))){I.end=1;var D=I.$.back(-1)._,L=D.root,N=D.ask(function(j){L.on("ack",j),j.err&&!j.lack&&a.log(j),++q>(I.acks||0)&&this.off(),I.ack&&I.ack(j,this)},I.opt),q=0,F=I.stun,U;(U=function(){F&&(c.end(F,L),setTimeout.each(Object.keys(F=F.add||""),function(j){(j=F[j])&&j()}))}).hatch=U,I.ack&&!I.ok&&(I.ok=I.acks||9),I.via._.on("out",{put:I.out=I.graph,ok:I.ok&&{"@":I.ok+1},opt:I.opt,"#":N,_:U})}}c.end=function(I,D){I.end=x,I.the.to===I&&I===I.the.last&&delete D.stun,I.off()},c.err=function(I,D){(I.ack||x).call(I,I.out={err:I.err=a.log(D)}),I.ran(I)};function u(I){var D=I.via._,L;I.via=I.via.back(function(N){if(N.soul||!N.get)return N.$;L=I.data,(I.data={})[N.get]=L}),(!I.via||!I.via._.soul)&&(I.via=D.root.$.get(((I.data||"")._||"")["#"]||D.$.back("opt.uuid")())),I.via.put(I.data,I.ack,I)}function v(I,D){return I&&(D=I.constructor)&&D.name||typeof I}var _,x=function(){},E=setTimeout.turn,M=a.valid,C=a.state.ify})(e,"./put"),e(function(n){var a=e("./root");e("./chain"),e("./back"),e("./put"),e("./get"),n.exports=a})(e,"./index"),e(function(n){var a=e("./index");a.chain.on=function(u,v,_,x){var E=this,M=E._;M.root;var C;if(typeof u=="string")return v?(C=M.on(u,v,_||M,x),_&&_.$&&(_.subs||(_.subs=[])).push(C),E):M.on(u);var I=v;return(I=I===!0?{change:!0}:I||{}).not=1,I.on=1,E.get(u,I),E},a.chain.once=function(u,v){if(v=v||{},!u)return o(this);var _=this,x=_._,E=x.root;x.put;var M=String.random(7),C;return _.get(function(I,D,L,N){var q=this,F=q._,U=F.one||(F.one={});if(N.stun||U[M]==="")return;if((C=a.valid(I))===!0){j();return}if(typeof C=="string")return;clearTimeout((x.one||"")[M]),clearTimeout(U[M]),U[M]=setTimeout(j,v.wait||99);function j(W){if(!F.has&&!F.soul&&(F={put:I,get:D}),c===(C=F.put)&&(C=((L.$$||"")._||"").put),typeof a.valid(C)=="string"&&(C=E.$.get(C)._.put,C===c&&!W)){U[M]=setTimeout(function(){j(1)},v.wait||99);return}N.stun||U[M]!==""&&(U[M]="",(x.soul||x.has)&&N.off(),u.call(q,C,F.get),clearTimeout(U[M]))}},{on:1}),_};function o(u,v,_){return a.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(_=u.chain())._.nix=u.once(function(x,E){_._.on("in",this._)}),_._.lex=u._.lex,_}a.chain.off=function(){var u=this,v=u._,_,x=v.back;if(x)return v.ack=0,(_=x.next)&&_[v.get]&&delete _[v.get],(_=x.any)&&(delete x.any,x.any={}),(_=x.ask)&&delete _[v.get],(_=x.put)&&delete _[v.get],(_=v.soul)&&delete x.root.graph[_],(_=v.map)&&Object.keys(_).forEach(function(E,M){M=_[E],M.link&&x.root.$.get(M.link).off()}),(_=v.next)&&Object.keys(_).forEach(function(E,M){M=_[E],M.$.off()}),v.on("off",{}),u};var c})(e,"./on"),e(function(n){var a=e("./index"),o=a.chain.get.next;a.chain.get.next=function(_,x){var E;return Object.plain(x)?(E=((E=x["#"])||"")["="]||E)?_.get(E):((E=_.chain()._).lex=x,_.on("in",function(M){String.match(M.get||(M.put||"")["."],x["."]||x["#"]||x)&&E.on("in",M),this.to.next(M)}),E.$):(o||u)(_,x)},a.chain.map=function(_,x,E){var M=this,C=M._,I,D;return Object.plain(_)&&(I=_["."]?_:{".":_},_=v),_?(a.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),D=M.chain(),M.map().on(function(L,N,q,F){var U=(_||u).call(this,L,N,q,F);if(v!==U){if(L===U)return D._.on("in",q);if(a.is(U))return D._.on("in",U._);var j={};Object.keys(q.put).forEach(function(W){j[W]=q.put[W]},j),j["="]=U,D._.on("in",{get:N,put:j})}}),D):((D=C.each)||((C.each=D=M.chain())._.lex=I||D._.lex||C.lex,D._.nix=M.back("nix"),M.on("in",c,D._)),D)};function c(_){this.to.next(_);var x=this.as,E=_.$,M=E._,C=_.put,I;!M.soul&&!_.$$||(I=x.lex)&&!String.match(_.get||(C||"")["."],I["."]||I["#"]||I)||a.on.link(_,x)}var u=function(){},v})(e,"./map"),e(function(n){var a=e("./index");a.chain.set=function(o,c,u){var v=this,_=v.back(-1),x,E;return c=c||function(){},u=u||{},u.item=u.item||o,(x=((o||"")._||"")["#"])&&((o={})["#"]=x),typeof(E=a.valid(o))=="string"?v.get(x=E).put(o,c,u):a.is(o)?(v.put(function(M){o.get(function(C,I,D){if(!C)return c.call(v,{err:a.log('Only a node can be linked! Not "'+D.put+'"!')});(E={})[C]={"#":C},M(E)},!0)}),o):(Object.plain(o)&&(o=_.get(x=v.back("opt.uuid")()).put(o)),v.get(x||_.back("opt.uuid")(7)).put(o,c,u))}})(e,"./set"),e(function(n){e("./shim");var a=function(){},o=JSON.parseAsync||function(_,x,E){var M,C=+new Date;try{x(M,JSON.parse(_,E),c.sucks(+new Date-C))}catch(I){x(I)}},c=JSON.stringifyAsync||function(_,x,E,M){var C,I=+new Date;try{x(C,JSON.stringify(_,E,M),c.sucks(+new Date-I))}catch(D){x(D)}};c.sucks=function(_){_>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),c.sucks=a)};function u(_){var x=function(){},E=_.opt||{};E.log=E.log||console.log,E.gap=E.gap||E.wait||0,E.max=E.max||(E.memory?E.memory*999*999:3e8)*.3,E.pack=E.pack||E.max*.01*.01,E.puff=E.puff||9;var M=setTimeout.turn||setTimeout,C=_.dup,I=C.check,D=C.track,L=x.hear=function(F,U){if(F){if(E.max<=F.length)return x.say({dam:"!",err:"Message too big!"},U);x===this&&(L.d+=F.length||0,++L.c);var j=U.SH=+new Date,W=F[0],X;if(W==="["){o(F,function(J,G){if(J||!G)return x.say({dam:"!",err:"DAM JSON parse error."},U);console.STAT&&console.STAT(+new Date,G.length,"# on hear batch");var oe=E.puff;(function O(){for(var l=+new Date,p=0,b;p<oe&&(b=G[p++]);)x.hear(b,U);G=G.slice(p),console.STAT&&console.STAT(l,+new Date-l,"hear loop"),N(U),G.length&&M(O,0)})()}),F="";return}if(W==="{"||(F["#"]||Object.plain(F))&&(X=F)){if(X)return L.one(X,U,j);o(F,function(J,G){if(J||!G)return x.say({dam:"!",err:"DAM JSON parse error."},U);L.one(G,U,j)});return}}};L.one=function(F,U,O){var W,X,J,G,oe;if(F.DBG&&(F.DBG=oe={DBG:F.DBG}),oe&&(oe.h=O),oe&&(oe.hp=+new Date),(W=F["#"])||(W=F["#"]=String.random(9)),!(J=I(W))&&(X=F["##"],!(X&&(J=F["@"]||F.get&&W)&&C.check(G=J+X)))){if((F._=function(){}).via=x.leap=U,(J=F["><"])&&typeof J=="string"&&J.slice(0,99).split(",").forEach(function(l){this[l]=1},F._.yo={}),J=F.dam){(J=x.hear[J])&&J(F,U,_),D(W);return}(J=F.ok)&&(F._.near=J["/"]);var O=+new Date;oe&&(oe.is=O),U.SI=W,D.ed=function(l){W===l&&(D.ed=0,(l=C.s[W])&&(l.via=U,F.get&&(l.it=F)))},_.on("in",x.last=F),oe&&(oe.hd=+new Date),console.STAT&&console.STAT(O,+new Date-O,F.get?"msg get":F.put?"msg put":"msg"),D(W),G&&D(G),x.leap=x.last=null}},L.c=L.d=0,function(){var F=0,U;x.hash=function(X,J){var G,oe,O,l=+new Date;c(X.put,function p(b,S){var T=(oe||(oe=O=S||"")).slice(0,32768);if(G=String.hash(T,G),oe=oe.slice(32768),oe){M(p,0);return}console.STAT&&console.STAT(l,+new Date-l,"say json+hash"),X._.$put=O,X["##"]=G,x.say(X,J),delete X._.$put},j)};function j(X,J){var G;return J instanceof Object?(Object.keys(J).sort().forEach(W,{to:G={},on:J}),G):J}function W(X){this.to[X]=this.on[X]}x.say=function(X,J){var G;if((G=this)&&(G=G.to)&&G.next&&G.next(X),!X)return!1;var oe,O,l,p=X["@"],b=X._||(X._=function(){}),S=X.DBG,T=+new Date;if(b.y=b.y||T,J||S&&(S.y=T),(oe=X["#"])||(oe=X["#"]=String.random(9)),!U&&D(oe),!(O=X["##"])&&v!==X.put&&!b.via&&p){x.hash(X,J);return}if(!J&&p&&(J=(G=C.s[p])&&(G.via||(G=G.it)&&(G=G._)&&G.via)||(G=x.last)&&p===G["#"]&&x.leap),!J&&p)return C.s[p]?void 0:(console.STAT&&console.STAT(+new Date,++F,"total no peer to ack to"),!1);if(p&&!X.put&&!O&&((C.s[p]||"").it||"")["##"])return!1;if(!J&&x.way)return x.way(X);if(S&&(S.yh=+new Date),!(l=b.raw)){x.raw(X,J);return}if(S&&(S.yr=+new Date),!J||!J.id){if(!Object.plain(J||E.peers))return!1;var T=+new Date;E.puff;var B=E.peers,$=Object.keys(J||E.peers||{});console.STAT&&console.STAT(T,+new Date-T,"peer keys"),function k(){var H=+new Date;U=1;var z=b.raw;b.raw=l;for(var Q=0,ie;Q<9&&(ie=($||"")[Q++]);)(ie=B[ie]||(J||"")[ie])&&x.say(X,ie);b.raw=z,U=0,$=$.slice(Q),console.STAT&&console.STAT(H,+new Date-H,"say loop"),$.length&&(M(k,0),p&&D(p))}();return}if(!J.wire&&x.wire&&x.wire(J),oe!==J.last){if(J.last=oe,J===b.via||(G=b.yo)&&(G[J.url]||G[J.pid]||G[J.id]))return!1;if(console.STAT&&console.STAT(T,((S||b).yp=+new Date)-(b.y||T),"say prep"),!U&&p&&D(p),J.batch){if(J.tail=(G=J.tail||0)+l.length,J.tail<=E.pack){J.batch+=(G?",":"")+l;return}N(J)}J.batch="[";var A=+new Date;setTimeout(function(){console.STAT&&console.STAT(A,+new Date-A,"0ms TO"),N(J)},E.gap),q(l,J),console.STAT&&p===J.SI&&console.STAT(T,+new Date-J.SH,"say ack")}},x.say.c=x.say.d=0,x.raw=function(X,J){if(!X)return"";var G=X._||{},oe,O;if(O=G.raw)return O;if(typeof X=="string")return X;var l=X["##"],p=X["@"];if(l&&p){if(!G.via&&I(p+l))return!1;if(O=(C.s[p]||"").it){if(l===O["##"])return!1;O["##"]||(O["##"]=l)}}if(!X.dam&&!X["@"]){var b=0,S=[];O=E.peers;for(var T in O){var B=O[T];if(S.push(B.url||B.pid||B.id),++b>6)break}b>1&&(X["><"]=S.join())}if(X.put&&(O=X.ok)&&(X.ok={"@":(O["@"]||1)-1,"/":O["/"]==X._.near?x.near:O["/"]}),oe=G.$put){O={},Object.keys(X).forEach(function(A){O[A]=X[A]}),O.put=":])([:",c(O,function(A,g){if(!A){var k=+new Date;O=g.indexOf('"put":":])([:"'),$(v,g=g.slice(0,O+6)+oe+g.slice(O+14)),console.STAT&&console.STAT(k,+new Date-k,"say slice")}});return}c(X,$);function $(A,g){A||(G.raw=g,x.say(X,J))}}}();function N(F){var U=F.batch,j=typeof U=="string";if(j&&(U+="]"),F.batch=F.tail=null,!!U&&!(j?3>U.length:!U.length)){if(!j)try{U=U.length===1?U[0]:JSON.stringify(U)}catch(W){return E.log("DAM JSON stringify error",W)}U&&q(U,F)}}function q(F,U){try{var j=U.wire;U.say?U.say(F):j.send&&j.send(F),x.say.d+=F.length||0,++x.say.c}catch{(U.queue=U.queue||[]).push(F)}}return x.near=0,x.hi=function(F){var U=F.wire,j;if(!U){x.wire(F.length&&{url:F,id:F}||F);return}F.id?E.peers[F.url||F.id]=F:(j=F.id=F.id||F.url||String.random(9),x.say({dam:"?",pid:_.opt.pid},E.peers[j]=F),delete C.s[F.last]),F.met||(x.near++,F.met=+new Date,_.on("hi",F)),j=F.queue,F.queue=[],setTimeout.each(j||[],function(W){q(W,F)},0,9)},x.bye=function(F){F.met&&--x.near,delete F.met,_.on("bye",F);var U=+new Date;U=U-(F.met||U),x.bye.time=((x.bye.time||U)+U)/2},x.hear["!"]=function(F,U){E.log("Error:",F.err)},x.hear["?"]=function(F,U){F.pid&&(U.pid||(U.pid=F.pid),F["@"])||(x.say({dam:"?",pid:E.pid,"@":F["#"]},U),delete C.s[U.last])},x.hear.mob=function(F,U){if(F.peers){var j=Object.keys(F.peers),W=j[Math.random()*j.length>>0];W&&(x.bye(U),x.hi(W))}},_.on("create",function(F){F.opt.pid=F.opt.pid||String.random(9),this.to.next(F),F.on("out",x.say)}),_.on("bye",function(F,U){F=E.peers[F.id||F]||F,this.to.next(F),F.bye?F.bye():(U=F.wire)&&U.close&&U.close(),delete E.peers[F.id],F.wire=null}),_.on("bye",function(F,U){this.to.next(F),(U=console.STAT)&&(U.peers=x.near),(U=F.url)&&setTimeout(function(){},E.lack||9e3)}),_.on("hi",function(F,U){if(this.to.next(F),(U=console.STAT)&&(U.peers=x.near),!E.super){var j=Object.keys(_.next||"");j.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(j,function(W){var X=_.next[W];if(E.super||(X.ask||"")[""]){x.say({get:{"#":W}},F);return}setTimeout.each(Object.keys(X.ask||""),function(J){J&&x.say({"##":String.hash((_.graph[W]||"")[J]),get:{"#":W,".":J}},F)})})}}),x}var v;try{n.exports=u}catch{}})(e,"./mesh"),e(function(n){var a=e("./index");a.Mesh=e("./mesh"),a.on("opt",function(c){if(this.to.next(c),c.once)return;var u=c.opt;if(u.WebSocket===!1)return;var v=a.window||{},_=u.WebSocket||v.WebSocket||v.webkitWebSocket||v.mozWebSocket;if(!_)return;u.WebSocket=_;var x=u.mesh=u.mesh||a.Mesh(c);x.wire||u.wire,x.wire=u.wire=E;function E(D){try{if(!D||!D.url)return N&&N(D);var L=D.url.replace(/^http/,"ws"),N=D.wire=new u.WebSocket(L);return N.onclose=function(){C(D),u.mesh.bye(D)},N.onerror=function(q){C(D)},N.onopen=function(){u.mesh.hi(D)},N.onmessage=function(q){q&&u.mesh.hear(q.data||q,D)},N}catch{u.mesh.bye(D)}}setTimeout(function(){!u.super&&c.on("out",{dam:"hi"})},1);var M=2*999;function C(D){clearTimeout(D.defer),u.peers[D.url]&&(I&&D.retry<=0||(D.retry=(D.retry||u.retry+1||60)-(-D.tried+(D.tried=+new Date)<M*4?1:0),D.defer=setTimeout(function L(){if(I&&I.hidden)return setTimeout(L,M);E(D)},M)))}var I=""+o!=typeof document&&document});var o})(e,"./websocket"),e(function(n){if(!(typeof Gun>"u")){var a=function(){},o;try{o=(Gun.window||a).localStorage}catch{}o||(Gun.log("Warning: No localStorage exists to persist data to!"),o={setItem:function(u,v){this[u]=v},removeItem:function(u){delete this[u]},getItem:function(u){return this[u]}});var c=JSON.stringifyAsync||function(u,v,_,x){var E;try{v(E,JSON.stringify(u,_,x))}catch(M){v(M)}};Gun.on("create",function u(v){this.to.next(v);var _=v.opt;v.graph;var x=[],E,M,C,I;if(_.localStorage===!1)return;_.prefix=_.file||"gun/";try{E=u[_.prefix]=u[_.prefix]||JSON.parse(C=o.getItem(_.prefix))||{}}catch{E=u[_.prefix]={}}C=(C||"").length,v.on("get",function(L){this.to.next(L);var N=L.get,q,F,U,j;!N||!(q=N["#"])||(F=E[q]||j,F&&(U=N["."])&&!Object.plain(U)&&(F=Gun.state.ify({},U,Gun.state.is(F,U),F[U],q)),Gun.on.get.ack(L,F))}),v.on("put",function(L){this.to.next(L);var N=L.put,q=N["#"],F=N["."],U=L["#"],j=L.ok||"";if(E[q]=Gun.state.ify(E[q],F,N[">"],N[":"],q),I&&C>4999880){v.on("in",{"@":U,err:"localStorage max!"});return}!L["@"]&&(!L._.via||Math.random()<j["@"]/j["/"])&&x.push(U),!M&&(M=setTimeout(D,9+C/333))});function D(){if(!x.length&&((setTimeout.turn||"").s||"").length){setTimeout(D,99);return}var L=x;clearTimeout(M),M=!1,x=[],c(E,function(N,q){try{!N&&o.setItem(_.prefix,q)}catch(F){N=I=F||"localStorage failure"}N&&(Gun.log(N+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),v.on("localStorage:error",{err:N,get:_.prefix,put:E})),C=q.length,setTimeout.each(L,function(F){v.on("in",{"@":F,err:N,ok:0})},0,99)})}})}})(e,"./localStorage")})(),function(){var O;if(""+O!=typeof Gun){var e=function(l){console.warn("Warning! Deprecated internal utility will break in next version:",l)},t=Gun;t.fn=t.fn||{is:function(l){return e("fn"),!!l&&typeof l=="function"}},t.bi=t.bi||{is:function(l){return e("bi"),l instanceof Boolean||typeof l=="boolean"}},t.num=t.num||{is:function(l){return e("num"),!n(l)&&(l-parseFloat(l)+1>=0||l===1/0||l===-1/0)}},t.text=t.text||{is:function(l){return e("text"),typeof l=="string"}},t.text.ify=t.text.ify||function(l){return e("text.ify"),t.text.is(l)?l:typeof JSON<"u"?JSON.stringify(l):l&&l.toString?l.toString():l},t.text.random=t.text.random||function(l,p){e("text.random");var b="";for(l=l||24,p=p||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";l>0;)b+=p.charAt(Math.floor(Math.random()*p.length)),l--;return b},t.text.match=t.text.match||function(l,p){var b,S;return e("text.match"),typeof l!="string"?!1:(typeof p=="string"&&(p={"=":p}),p=p||{},b=p["="]||p["*"]||p[">"]||p["<"],l===b?!0:S!==p["="]?!1:(b=p["*"]||p[">"]||p["<"],l.slice(0,(b||"").length)===b?!0:S!==p["*"]?!1:S!==p[">"]&&S!==p["<"]?l>=p[">"]&&l<=p["<"]:S!==p[">"]&&l>=p[">"]||S!==p["<"]&&l<=p["<"]))},t.text.hash=t.text.hash||function(l,p){if(e("text.hash"),typeof l=="string"){if(p=p||0,!l.length)return p;for(var b=0,S=l.length,T;b<S;++b)T=l.charCodeAt(b),p=(p<<5)-p+T,p|=0;return p}},t.list=t.list||{is:function(l){return e("list"),l instanceof Array}},t.list.slit=t.list.slit||Array.prototype.slice,t.list.sort=t.list.sort||function(l){return e("list.sort"),function(p,b){return!p||!b?0:(p=p[l],b=b[l],p<b?-1:p>b?1:0)}},t.list.map=t.list.map||function(l,p,b){return e("list.map"),G(l,p,b)},t.list.index=1,t.obj=t.boj||{is:function(l){return e("obj"),l?l instanceof Object&&l.constructor===Object||Object.prototype.toString.call(l).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},t.obj.put=t.obj.put||function(l,p,b){return e("obj.put"),(l||{})[p]=b,l},t.obj.has=t.obj.has||function(l,p){return e("obj.has"),l&&Object.prototype.hasOwnProperty.call(l,p)},t.obj.del=t.obj.del||function(l,p){if(e("obj.del"),!!l)return l[p]=null,delete l[p],l},t.obj.as=t.obj.as||function(l,p,b,S){return e("obj.as"),l[p]=l[p]||(S===b?{}:b)},t.obj.ify=t.obj.ify||function(l){if(e("obj.ify"),U(l))return l;try{l=JSON.parse(l)}catch{l={}}return l},function(){var l;function p(b,S){W(this,S)&&l!==this[S]||(this[S]=b)}t.obj.to=t.obj.to||function(b,S){return e("obj.to"),S=S||{},G(b,p,S),S}}(),t.obj.copy=t.obj.copy||function(l){return e("obj.copy"),l&&JSON.parse(JSON.stringify(l))},function(){function l(p,b){var S=this.n,T;if(!(S&&(b===S||U(S)&&W(S,b)))&&T!==b)return!0}t.obj.empty=t.obj.empty||function(p,b){return e("obj.empty"),p?!G(p,l,{n:b}):!0}}(),function(){function l(S,T){if(arguments.length===2){l.r=l.r||{},l.r[S]=T;return}l.r=l.r||[],l.r.push(S)}var p=Object.keys,b;Object.keys=Object.keys||function(S){return b(S,function(T,B,$){$(B)})},t.obj.map=b=t.obj.map||function(S,T,B){e("obj.map");var $,A=0,g,k,H,z,Q=typeof T=="function";if(l.r=$,p&&U(S)&&(H=p(S),z=!0),B=B||{},n(S)||H)for(g=(H||S).length;A<g;A++){var ie=A+t.list.index;if(Q){if(k=z?T.call(B,S[H[A]],H[A],l):T.call(B,S[A],ie,l),k!==$)return k}else if(T===S[z?H[A]:A])return H?H[A]:ie}else for(A in S)if(Q){if(W(S,A)&&(k=B?T.call(B,S[A],A,l):T(S[A],A,l),k!==$))return k}else if(T===S[A])return A;return Q?l.r:t.list.index?0:-1}}(),t.time=t.time||{},t.time.is=t.time.is||function(l){return e("time"),l?l instanceof Date:+new Date().getTime()};var q=t.fn.is,n=t.list.is,F=t.obj,U=F.is,W=F.has,G=F.map,a={};a.is=function(l){return e("val.is"),l===O?!1:l===null?!0:l===1/0?!1:u(l)||c(l)||I(l)?!0:a.link.is(l)||!1},a.link=a.rel={_:"#"},function(){a.link.is=function(p){if(e("val.link.is"),p&&p[o]&&!p._&&U(p)){var b={};if(G(p,l,b),b.id)return b.id}return!1};function l(p,b){var S=this;if(S.id)return S.id=!1;if(b==o&&u(p))S.id=p;else return S.id=!1}}(),a.link.ify=function(l){return e("val.link.ify"),J({},o,l)},t.obj.has._=".";var o=a.link._,O,c=t.bi.is,I=t.num.is,u=t.text.is,F=t.obj,U=F.is,J=F.put,G=F.map;t.val=t.val||a;var v={_:"_"};v.soul=function(l,p){return e("node.soul"),l&&l._&&l._[p||E]},v.soul.ify=function(l,p){return e("node.soul.ify"),p=typeof p=="string"?{soul:p}:p||{},l=l||{},l._=l._||{},l._[E]=p.soul||l._[E]||x(),l},v.soul._=a.link._,function(){v.is=function(p,b,S){e("node.is");var T;return U(p)&&(T=v.soul(p))?!G(p,l,{as:S,cb:b,s:T,n:p}):!1};function l(p,b){if(b!==v._){if(!a.is(p))return!0;this.cb&&this.cb.call(this.as,p,b,this.n,this.s)}}}(),function(){v.ify=function(p,b,S){return e("node.ify"),b?typeof b=="string"?b={soul:b}:typeof b=="function"&&(b={map:b}):b={},b.map&&(b.node=b.map.call(S,p,O,b.node||{})),(b.node=v.soul.ify(b.node||{},b))&&G(p,l,{o:b,as:S}),b.node};function l(p,b){var S=this.o,T,B;if(S.map){T=S.map.call(this.as,p,""+b,S.node),B===T?j(S.node,b):S.node&&(S.node[b]=T);return}a.is(p)&&(S.node[b]=p)}}();var F=t.obj,U=F.is,j=F.del,G=F.map,_=t.text,x=_.random,E=v.soul._,O;t.node=t.node||v;var M=t.state;M.lex=function(){return e("state.lex"),M().toString(36).replace(".","")},M.to=function(l,p,b){e("state.to");var S=(l||{})[p];return U(S)&&(S=oe(S)),M.ify(b,p,M.is(l,p),S,v.soul(l))},function(){M.map=function(p,b,S){e("state.map");var T,B=U(B=p||b)?B:null;return p=q(p=p||b)?p:null,B&&!p?(b=I(b)?b:M(),B[L]=B[L]||{},G(B,l,{o:B,s:b}),B):(S=S||U(b)?b:T,b=I(b)?b:M(),function($,A,g,k){if(!p)return l.call({o:g,s:b},$,A),$;p.call(S||this||{},$,A,g,k),!(W(g,A)&&T===g[A])&&l.call({o:g,s:b},$,A)})};function l(p,b){L!==b&&M.ify(this.o,b,this.s)}}();var F=t.obj;F.as;var W=F.has,U=F.is,G=F.map,oe=F.copy,C=t.num,I=C.is,D=t.fn,q=D.is,L=v._,O,N={};(function(){N.is=function(b,S,T,B){return e("graph.is"),!b||!U(b)||X(b)?!1:!G(b,l,{cb:S,fn:T,as:B})};function l(b,S){if(!b||S!==v.soul(b)||!v.is(b,this.fn,this.as))return!0;this.cb&&(p.n=b,p.as=this.as,this.cb.call(p.as,b,S,p))}function p(b){b&&v.is(p.n,b,p.as)}})(),function(){N.ify=function(B,$,A){e("graph.ify");var g={path:[],obj:B};return $?typeof $=="string"?$={soul:$}:typeof $=="function"&&($.map=$):$={},typeof A=="string"&&($.soul=$.soul||A,A=O),$.soul&&(g.link=a.link.ify($.soul)),$.shell=(A||{}).shell,$.graph=$.graph||{},$.seen=$.seen||[],$.as=$.as||A,l($,g),$.root=g.node,$.graph};function l(B,$){var A;return(A=T(B,$))?A:($.env=B,$.soul=b,v.ify($.obj,p,$)&&($.link=$.link||a.link.ify(v.soul($.node)),$.obj!==B.shell&&(B.graph[a.link.is($.link)]=$.node)),$)}function p(B,$,A){var g=this,k=g.env,H,z;if(v._===$&&W(B,a.link._))return A._;if(H=S(B,$,A,g,k)){if($||(g.node=g.node||A||{},W(B,v._)&&v.soul(B)&&(g.node._=oe(B._)),g.node=v.soul.ify(g.node,a.link.is(g.link)),g.link=g.link||a.link.ify(v.soul(g.node))),(z=k.map)&&(z.call(k.as||{},B,$,A,g),W(A,$))){if(B=A[$],O===B){j(A,$);return}if(!(H=S(B,$,A,g,k)))return}if(!$)return g.node;if(H===!0)return B;if(z=l(k,{obj:B,path:g.path.concat($)}),!!z.node)return z.link}}function b(B){var $=this,A=a.link.is($.link),g=$.env.graph;$.link=$.link||a.link.ify(B),$.link[a.link._]=B,$.node&&$.node[v._]&&($.node[v._][a.link._]=B),W(g,A)&&(g[B]=g[A],j(g,A))}function S(B,$,A,g,k){var H;if(a.is(B))return!0;if(U(B))return 1;if(H=k.invalid)return B=H.call(k.as||{},B,$,A),S(B,$,A,g,k);k.err="Invalid value at '"+g.path.concat($).join(".")+"'!",t.list.is(B)&&(k.err+=" Use `.set(item)` instead of an Array.")}function T(B,$){for(var A=B.seen,g=A.length,k;g--;)if(k=A[g],$.obj===k.obj)return k;A.push($)}}(),N.node=function(l){e("graph.node");var p=v.soul(l);if(p)return J({},p,l)},function(){N.to=function(p,b,S){if(e("graph.to"),!!p){var T={};return S=S||{seen:{}},G(p[b],l,{obj:T,graph:p,opt:S}),T}};function l(p,b){var S,T;if(v._===b){if(X(p,a.link._))return;this.obj[b]=oe(p);return}if(!(S=a.link.is(p))){this.obj[b]=p;return}if(T=this.opt.seen[S]){this.obj[b]=T;return}this.obj[b]=this.opt.seen[S]=N.to(this.graph,S,this.opt)}}();var q=t.fn.is,F=t.obj,U=F.is,j=F.del,W=F.has,X=F.empty,J=F.put,G=F.map,oe=F.copy,O;t.graph=t.graph||N}}()})(gun$1);var gunExports=gun$1.exports;const Gun$2=getDefaultExportFromCjs(gunExports);class GunDB{constructor(){this.gun=Gun$2({}),this.censusData=this.gun.get("census-data"),console.log("GunDB initialized")}async get(e){return new Promise(t=>{if(!e){console.warn("UserId is required for retrieval"),t(null);return}this.censusData.get(e).once(n=>{if(console.log("Raw GunDB data retrieved:",n),!n){console.log("No data found for user:",e),t(null);return}try{const a=this.fromGunFormat(n);console.log("Formatted data for form:",a),t(a)}catch(a){console.error("Error formatting retrieved data:",a),t(null)}})})}async put(e,t){return new Promise((n,a)=>{if(!e){a(new Error("UserId is required"));return}try{console.log("Saving data for user:",e);const o=this.toGunFormat(t);this.censusData.get(e).put(o,c=>{c.err?(console.error("Save error:",c.err),a(new Error(c.err))):this.censusData.get(e).once(u=>{u?(console.log("Save verified:",u),n({success:!0,data:u})):a(new Error("Save verification failed"))})})}catch(o){console.error("Error during save:",o),a(o)}})}toGunFormat(e){try{return console.log("Converting to GunDB format, input:",e),JSON.stringify(e)}catch(t){throw console.error("Error converting to GunDB format:",t),t}}fromGunFormat(e){try{return console.log("Converting from GunDB format, input:",e),e?JSON.parse(e):null}catch(t){return console.error("Error converting from GunDB format:",t),null}}}const gunDB=new GunDB;class EncryptionManager{constructor(){this.available=typeof window<"u"&&window.crypto&&window.crypto.subtle}async encryptData(e){if(!this.available)return{data:e};try{const t=await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=window.crypto.getRandomValues(new Uint8Array(12)),a=new TextEncoder().encode(JSON.stringify(e)),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,a),c=await window.crypto.subtle.exportKey("raw",t),u=btoa(String.fromCharCode.apply(null,new Uint8Array(c)));return{encrypted:Array.from(new Uint8Array(o)),iv:Array.from(n),key:u}}catch(t){return console.error("Encryption failed:",t),{data:e}}}async decryptData(e){if(!this.available)return console.warn("Decryption not available in this environment"),e;try{if(!e||e.payload==="[null]"||e.payload===null)return console.warn("Skipping decryption for null payload"),null;let t,n,a;if(typeof e.encrypted=="string")try{t=JSON.parse(e.encrypted)}catch{t=e.encrypted.replace(/[\[\]\s]/g,"").split(",").map(Number)}else t=e.encrypted;if(typeof e.iv=="string")try{n=JSON.parse(e.iv)}catch{n=e.iv.replace(/[\[\]\s]/g,"").split(",").map(Number)}else n=e.iv;if(!t||!n||!e.key)return console.warn("Invalid or incomplete encrypted data"),null;const o=new Uint8Array(t),c=new Uint8Array(n),u=Uint8Array.from(atob(e.key),E=>E.charCodeAt(0)),v=await window.crypto.subtle.importKey("raw",u,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),_=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c},v,o),x=new TextDecoder().decode(_);return JSON.parse(x)}catch{return console.warn("Unable to decrypt data - This is normal for some entries"),e.data?e.data:null}}}const encryption=new EncryptionManager,initialFormData={white:[],black:[],nativeAmerican:[],africanDiaspora:[],asian:[],pacificIslander:[],other:[],delineation:[]},initialOtherValues={white:"",black:"",nativeAmerican:"",africanDiaspora:"",asian:"",pacificIslander:"",other:"",delineation:""},sectionTitles={white:"1. White or European American (50) - 1000-1999:",black:"2. Black or American Negro (Americas/Tri-Racials) (9) - 3000-3099:",nativeAmerican:"3. American Indian or Alaska Native (64) - 5000-6999:",africanDiaspora:"4. African Diaspora (54) - 3100-3404:",asian:"5. Asian (please specify sub-group if known) (32) - 4000-4999:",pacificIslander:"6. Native Hawaiian and Other Pacific Islander (9) - 7500-7999:",other:"7. Some other race - 8000-8999:",delineation:"Preferred Disaggration(s) or Delineation(s)?"},ETHNICITY_DATA={white:[{label:"German (Germanic-1180, Vandili-1180, Suebi-1180, Istvaeones-1180, Irminones-1180, Basternae-1180)",value:"1171"},{label:"Irish (Anglo-Normans, Gaelic people)",value:"1201"},{label:"Scottish (Celtic peoples-1080, the Picts and Gaels)",value:"1320"},{label:"English (Angles-1840, Saxons-1174, and Jutes)",value:"1121"},{label:"French (Belgae, Celtic-1080, Italic, Gauls, Romans)",value:"1156"},{label:"Dutch (Franks, Alamanni, Batavi, Chauci, Chamavi and Chattuarii, Vandals & Saxons)",value:"1115"},{label:"Spanish (Sephardic Jews, Suebi, Alans and Vandals & Visigoths)",value:"2000"},{label:"Latin American (Latin-2600-2609, Latino-2620, Latinx-2621, Mesoamerican Indian/Hispanic-2690, Mestizo-2791)",value:"2600"},{label:"Portuguese (Suebi, Visigoths and Buri)",value:"1290"},{label:"Italian (Etruscans, Latin, Sicilian, Italics, Gallic, Greeks & Romans)",value:"1206"},{label:"Polish (Polans, Goplans, Lendions, Masovians, Visutulons)",value:"1286"},{label:"Scandinavian (Swedes, Danes, Geats, Gutes and Rugii)",value:"1310"},{label:"Russian (Ukrainias-1375, Tatars-1365, Chechens, Bashkirs, Chuvash, Avars)",value:"1305"}],black:[{label:"Descendants of the Transatlantic Slave Trade (American Black-3020)",value:"3020"},{label:"Descendants of Intra-American Slave Trade (American Negro-3025, American Gullah Geechee-3030, Yamasee)",value:"3025"},{label:"American Creole",value:"8130"},{label:"Arawak (e.g. Meso-American-2690)",value:"6919"},{label:"Carib (e.g., Jamaican-3446, Haitian-3441)",value:"6961"},{label:"Taino (e.g., Afro.Latino-2500, Garifuna-2510)",value:"6962"},{label:"Cuban",value:"6965"}],nativeAmerican:[{label:"Na-Dene - (Navajo-5999, White Mountain-5261, Mescalero-5519, Jicarilla-5517, San Carlos-5520)",value:"5999"},{label:"Iroquoian - (Cherokee-5599, Tuscarora-5874, Erie, Susquehanna-5806)",value:"5599"},{label:"Algonkian - (Powhatan-6162, Shawnee-6269, Cahokia, Miami-5952, Kickapoo-5886, Ojibwa-6521)",value:"6162"},{label:"Gulf - (Choctaw-5689, Chickasaw-5635, Tohome, Chatot, Coweta, Muscogee-5735, Atakapa-5786, Natchez-5796, Alabama-5743)",value:"5689"},{label:"Caddoan - (Pawnee-6085, Wichita-6395, Caddo-5551, Tawakoni, Hasinai)",value:"6085"},{label:"Aztec-Tanoan - (Comanche-5716, Kiowa-5891, Hopi-5851, Pima-6102, Ute, Shoshoni-6283)",value:"5716"},{label:"Floridan - (Timucua, Calusa)",value:"5000"},{label:"Timucua - (Cheyenne-5619, Arapaho-5524, Blackfoot-5536, Gros Ventre-5833)",value:"5619"},{label:"Salish (Plateau/NW) - (Spokane-6322, Kalispel-5880, Flathead-6238, Columbia-6015)",value:"6322"},{label:"Siouan-Yuchi - (Osage-6029, Quapaw-6214, Catawba-5586, Crow-5752, Yanktonai-6318, Santee-5804, Yankton-6318, Iowa-5858)",value:"6029"},{label:"Pentu (Californian) - (Miwok-5969, Cotanoan, Maidu-5926, Yokuts-6430, Modoc-5979, Klamath-5896, Yakima, Cayuse-5588, Palus)",value:"5969"},{label:"Hokan-Coahuiltecan (Californian) - (Yavapai-6451, Chumash-5701, Achomawi, Pomo-6117)",value:"6451"}],africanDiaspora:[{label:"Moroccan (Riffians, the Zayanes, and the Cheluh/Shilhah)",value:"7181"},{label:"Nigerians (Hausa, Yoruba-3237, Igbo-3238, Fulani-3400, Ibibio, Ijaw, Kanuri, Tiv, Awori)",value:"3236"},{label:"Ghanaians (Akan, Mole-Dagbon, Ewe, Ga-Dangme, Gurma, Guan, Grusi, Mande-Busanga)",value:"3180"},{label:"Senegalese (Wolof, Fula, Serer, Jola, Mandinka, Soninke, Bassari)",value:"3255"},{label:"Congolese (Bantu, Nilotic, Sudanese, and Pygmy)",value:"3145"},{label:"Liberians (Kpelle, Bassa, Grebo, Krahn, Vai, Dan, Mano, Gio)",value:"3200"},{label:"Ethiopians (Oromo, Amhara, Somali-3266, Tigrayans, Gurage, Sidama, Welayta, Afra, Hadiya, Gamo)",value:"3166"},{label:"South African (Zulu, Xhosa, Khoi, San)",value:"3270"}],asian:[{label:"Chinese (Han, Zhuang, Uyghur, Hui, Miao, Cantonese, Hakka)",value:"4020"},{label:"Bhrat (Hindi, Bengali, Marathi, Telugu, Tamil, Gujarati, Kannada, Punjabi-4224, Malayalam-4480)",value:"4220"},{label:"Korean (Goguryeo, Baekje, and Sill)",value:"4050"},{label:"Vietnamese (Tay, Muong, Cham, Nng, Brau, Bru, Hmong, Kinh, Hoa)",value:"4520"},{label:"Japanese (Yamoto, Ainu, Ryukyuan, Emishi, Hayato)",value:"4040"}],pacificIslander:[{label:"Samoan (Upolu, Savai'i, Manono, Apolima)",value:"7550"},{label:"Hawaiian",value:"7530"},{label:"Tongan (BaTonga, Niuatoputapu)",value:"7561"},{label:"Fijian (Indo-Fijians-7712, Rotumans)",value:"7711"}],other:[{label:"Middle Eastern (Arab-8100, Persian-8200, Turkish-8300)",value:"8100"},{label:"North African (Egyptian-8400, Libyan-8500, Tunisian-8600)",value:"8400"},{label:"Central Asian (Kazakh-8700, Uzbek-8800, Kyrgyz-8900)",value:"8700"}]},DELINEATION_OPTIONS=[{label:"By fingerprint (300,000,000+ ->billions)",value:"300000000"},{label:"By family (85,000,000+)",value:"85000000"},{label:"By surnames (150,000+)",value:"150000"},{label:"By neighborhoods (26,000+)",value:"26000"},{label:"By counties (3,000+)",value:"3000"},{label:"By ideology (1,000+)",value:"1000"},{label:"By tribes (575+)",value:"575"},{label:"By ethnicities/ancestry (225+)",value:"225"},{label:"By religion/denominations (200+)",value:"200"},{label:"By nations/countries (195+)",value:"195"},{label:"By age group (100+)",value:"100"},{label:"By phenotypes/skintones (66)",value:"66"},{label:"By state (50+)",value:"50"},{label:"By haplogroups (18yDNA+26mtDNA)=(44+)",value:"44"},{label:"By education attainment levels (9+)",value:"9"},{label:"By race (outside of human) (7+)",value:"7"},{label:"By citizen status (5+)",value:"5"},{label:"By marital status (4+)",value:"4"},{label:"By voter status (2+)",value:"2v"},{label:"By gender (2+)",value:"2g"},{label:"By human race (1)",value:"1"}],COLORS=["#EDD3BA","#F2D2B9","#F4D1BE","#F7D0C1","#FBCFC2","#FDCEC6","#E6C3A3","#E8C1A2","#EEC0A8","#EFBFA8","#F5BCAB","#F7BBB1","#D9B38C","#DEB08E","#E4AF8F","#E9AD95","#EAAC97","#EEAA9D","#CDA275","#D2A179","#D99E76","#DD9C80","#E09985","#E59989","#BC9260","#C48F63","#CA8C67","#CF896F","#D38970","#D8867A","#AE804F","#B27D51","#B97B56","#BC7A5A","#C2785D","#C77665","#9A713D","#9F6F3F","#A76B46","#AB6B48","#B06850","#B06454","#8A602E","#8D5E34","#925A35","#995A39","#9A563F","#9F5645","#755024","#7A4C28","#7D4B28","#80492B","#844732","#884535","#5F3F19","#613D1B","#643B1D","#6A3B21","#703827","#71372B","#492F14","#4A2F14","#4D2D16","#512A19","#532919","#572822"];function get_each_context$2(r,e,t){const n=r.slice();return n[3]=e[t],n}function create_each_block$2(r,e){let t,n,a,o,c,u,v,_,x,E;return{key:r,first:null,c(){t=element("label"),n=element("div"),n.innerHTML="",a=space(),o=element("span"),o.textContent=`${e[3]}`,c=space(),u=element("input"),_=space(),attr(n,"class","w-[50px] h-[25px] border border-gray-300 hover:opacity-90 transition-opacity"),set_style(n,"background-color",e[3]),attr(o,"class","text-xs font-bold relative -top-[7px]"),set_style(o,"color",e[3]),set_style(o,"text-shadow","0.5px 0.5px #888"),attr(u,"type","radio"),attr(u,"name","phenotype"),u.value=e[3],u.checked=v=e[0]===e[3],attr(u,"class","phenotype-radio svelte-rff93w"),set_style(u,"--color",e[3]),attr(t,"class","flex flex-col items-center gap-2 cursor-pointer"),attr(t,"title",e[3]),this.first=t},m(M,C){insert(M,t,C),append(t,n),append(t,a),append(t,o),append(t,c),append(t,u),append(t,_),x||(E=listen(u,"change",e[1]),x=!0)},p(M,C){e=M,C&1&&v!==(v=e[0]===e[3])&&(u.checked=v)},d(M){M&&detach(t),x=!1,E()}}}function create_fragment$4(r){let e,t=[],n=new Map,a=ensure_array_like(COLORS);const o=c=>c[3];for(let c=0;c<a.length;c+=1){let u=get_each_context$2(r,a,c),v=o(u);n.set(v,t[c]=create_each_block$2(v,u))}return{c(){e=element("div");for(let c=0;c<t.length;c+=1)t[c].c();attr(e,"class","grid grid-cols-6 gap-0.5 mb-8 max-w-full")},m(c,u){insert(c,e,u);for(let v=0;v<t.length;v+=1)t[v]&&t[v].m(e,null)},p(c,[u]){u&3&&(a=ensure_array_like(COLORS),t=update_keyed_each(t,u,o,1,c,a,n,e,destroy_block,create_each_block$2,null,get_each_context$2))},i:noop$3,o:noop$3,d(c){c&&detach(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function instance$4(r,e,t){let{phenotype:n}=e;const a=createEventDispatcher();function o(c){a("change",c.target.value)}return r.$$set=c=>{"phenotype"in c&&t(0,n=c.phenotype)},[n,o]}class ColorPicker extends SvelteComponent{constructor(e){super(),init(this,e,instance$4,create_fragment$4,safe_not_equal,{phenotype:0})}}function get_each_context$1(r,e,t){const n=r.slice();return n[18]=e[t],n}function create_if_block$1(r){let e,t,n,a,o,c,u,v,_,x,E,M,C=ensure_array_like(r[1]),I=[];for(let L=0;L<C.length;L+=1)I[L]=create_each_block$1(get_each_context$1(r,C,L));let D=r[7]&&create_if_block_1$2(r);return{c(){e=element("div");for(let L=0;L<I.length;L+=1)I[L].c();t=space(),n=element("label"),a=element("input"),o=space(),c=element("span"),u=text("Other "),v=text(r[3]),_=text(" option"),x=space(),D&&D.c(),attr(a,"type","checkbox"),a.checked=r[7],attr(a,"class","form-checkbox svelte-1afjrwe"),set_style(a,"--color",r[2]),attr(c,"class","ml-2 text-sm text-gray-700"),attr(n,"class","flex items-center mb-2 cursor-pointer hover:bg-gray-50 p-1 rounded"),attr(e,"class","p-4 space-y-2")},m(L,N){insert(L,e,N);for(let q=0;q<I.length;q+=1)I[q]&&I[q].m(e,null);append(e,t),append(e,n),append(n,a),append(n,o),append(n,c),append(c,u),append(c,v),append(c,_),append(e,x),D&&D.m(e,null),E||(M=listen(a,"change",r[9]),E=!0)},p(L,N){if(N&294){C=ensure_array_like(L[1]);let q;for(q=0;q<C.length;q+=1){const F=get_each_context$1(L,C,q);I[q]?I[q].p(F,N):(I[q]=create_each_block$1(F),I[q].c(),I[q].m(e,t))}for(;q<I.length;q+=1)I[q].d(1);I.length=C.length}N&128&&(a.checked=L[7]),N&4&&set_style(a,"--color",L[2]),N&8&&set_data(v,L[3]),L[7]?D?D.p(L,N):(D=create_if_block_1$2(L),D.c(),D.m(e,null)):D&&(D.d(1),D=null)},d(L){L&&detach(e),destroy_each(I,L),D&&D.d(),E=!1,M()}}}function create_each_block$1(r){let e,t,n,a,o,c=r[18].label+"",u,v,_;function x(...E){return r[16](r[18],...E)}return{c(){e=element("label"),t=element("input"),a=space(),o=element("span"),u=text(c),attr(t,"type","checkbox"),t.checked=n=r[5].includes(r[18].value),attr(t,"class","form-checkbox svelte-1afjrwe"),set_style(t,"--color",r[2]),attr(o,"class","ml-2 text-sm text-gray-700"),attr(e,"class","flex items-center mb-2 cursor-pointer hover:bg-gray-50 p-1 rounded")},m(E,M){insert(E,e,M),append(e,t),append(e,a),append(e,o),append(o,u),v||(_=listen(t,"change",x),v=!0)},p(E,M){r=E,M&34&&n!==(n=r[5].includes(r[18].value))&&(t.checked=n),M&4&&set_style(t,"--color",r[2]),M&2&&c!==(c=r[18].label+"")&&set_data(u,c)},d(E){E&&detach(e),v=!1,_()}}}function create_if_block_1$2(r){let e,t,n,a;return{c(){e=element("input"),attr(e,"type","text"),e.value=r[6],attr(e,"class","w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-opacity-50 transition-shadow svelte-1afjrwe"),set_style(e,"--phenotype",r[2]),attr(e,"placeholder",t=`Specify other ${r[3]} option`)},m(o,c){insert(o,e,c),n||(a=listen(e,"input",r[10]),n=!0)},p(o,c){c&64&&e.value!==o[6]&&(e.value=o[6]),c&4&&set_style(e,"--phenotype",o[2]),c&8&&t!==(t=`Specify other ${o[3]} option`)&&attr(e,"placeholder",t)},d(o){o&&detach(e),n=!1,a()}}}function create_fragment$3(r){let e,t,n,a,o,c,u,v,_,x,E,M=r[4]&&create_if_block$1(r);return{c(){e=element("div"),t=element("button"),n=element("span"),a=text(r[0]),o=space(),c=svg_element("svg"),u=svg_element("path"),_=space(),M&&M.c(),attr(n,"class","font-medium text-shadow svelte-1afjrwe"),attr(u,"stroke-linecap","round"),attr(u,"stroke-linejoin","round"),attr(u,"stroke-width","2"),attr(u,"d","M19 9l-7 7-7-7"),attr(c,"class",v="w-5 h-5 transition-transform duration-200 "+(r[4]?"rotate-180":"")),attr(c,"fill","none"),attr(c,"stroke","currentColor"),attr(c,"viewBox","0 0 24 24"),attr(t,"type","button"),attr(t,"class","w-full text-left p-4 flex justify-between items-center text-white transition-colors rounded-t-lg"),set_style(t,"background",r[2]),attr(e,"class","border border-gray-200 rounded-lg shadow-sm")},m(C,I){insert(C,e,I),append(e,t),append(t,n),append(n,a),append(t,o),append(t,c),append(c,u),append(e,_),M&&M.m(e,null),x||(E=listen(t,"click",r[15]),x=!0)},p(C,[I]){I&1&&set_data(a,C[0]),I&16&&v!==(v="w-5 h-5 transition-transform duration-200 "+(C[4]?"rotate-180":""))&&attr(c,"class",v),I&4&&set_style(t,"background",C[2]),C[4]?M?M.p(C,I):(M=create_if_block$1(C),M.c(),M.m(e,null)):M&&(M.d(1),M=null)},i:noop$3,o:noop$3,d(C){C&&detach(e),M&&M.d(),x=!1,E()}}}function instance$3(r,e,t){let n,a,{title:o=""}=e,{options:c=[]}=e,{phenotype:u="#888"}=e,{isArray:v=!0}=e,{key:_=""}=e,{selectedValues:x=[]}=e,{otherChecked:E=!1}=e,{otherValue:M=""}=e;const C=createEventDispatcher();let I=!1,D=[];function L(j,W){let X=[...D];W?v?X.push(j):X=j:v?X=X.filter(J=>J!==j):X=null,C("change",{key:_,values:X})}function N(j){C("otherChange",{key:_,checked:j.target.checked})}function q(j){C("otherValueChange",{key:_,value:j.target.value})}onMount(()=>{t(5,D=x),t(7,n=E),t(6,a=M)});const F=()=>t(4,I=!I),U=(j,W)=>L(j.value,W.target.checked);return r.$$set=j=>{"title"in j&&t(0,o=j.title),"options"in j&&t(1,c=j.options),"phenotype"in j&&t(2,u=j.phenotype),"isArray"in j&&t(11,v=j.isArray),"key"in j&&t(3,_=j.key),"selectedValues"in j&&t(12,x=j.selectedValues),"otherChecked"in j&&t(13,E=j.otherChecked),"otherValue"in j&&t(14,M=j.otherValue)},r.$$.update=()=>{r.$$.dirty&4096&&t(5,D=x||[]),r.$$.dirty&8192&&t(7,n=E),r.$$.dirty&16384&&t(6,a=M)},[o,c,u,_,I,D,a,n,L,N,q,v,x,E,M,F,U]}class EthnicitySection extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{title:0,options:1,phenotype:2,isArray:11,key:3,selectedValues:12,otherChecked:13,otherValue:14})}}function _catch(r,e){try{var t=r()}catch(n){return e(n)}return t&&t.then?t.then(void 0,e):t}function inMemoryCache(){const r=new Map;return function(e,t){try{let o=function(u){if(a)return u;const v=r.get(e.didUrl);return v!==void 0?v:Promise.resolve(t()).then(function(_){var x;return((x=_.didResolutionMetadata)==null?void 0:x.error)!=="notFound"&&r.set(e.didUrl,_),_})};var n=o;let a;const c=function(){if(e.params&&e.params["no-cache"]==="true")return Promise.resolve(t()).then(function(u){return a=1,u})}();return Promise.resolve(c&&c.then?c.then(o):o(c))}catch(a){return Promise.reject(a)}}}function noCache(r,e){return e()}const PCT_ENCODED="(?:%[0-9a-fA-F]{2})",ID_CHAR=`(?:[a-zA-Z0-9._-]|${PCT_ENCODED})`,METHOD="([a-z0-9]+)",METHOD_ID=`((?:${ID_CHAR}*:)*(${ID_CHAR}+))`,PARAM_CHAR="[a-zA-Z0-9_.:%-]",PARAM=`;${PARAM_CHAR}+=${PARAM_CHAR}*`,PARAMS=`((${PARAM})*)`,PATH="(/[^#?]*)?",QUERY="([?][^#]*)?",FRAGMENT="(#.*)?",DID_MATCHER=new RegExp(`^did:${METHOD}:${METHOD_ID}${PARAMS}${PATH}${QUERY}${FRAGMENT}$`);function parse$2(r){if(r===""||!r)return null;const e=r.match(DID_MATCHER);if(e){const t={did:`did:${e[1]}:${e[2]}`,method:e[1],id:e[2],didUrl:r};if(e[4]){const n=e[4].slice(1).split(";");t.params={};for(const a of n){const o=a.split("=");t.params[o[0]]=o[1]}}return e[6]&&(t.path=e[6]),e[7]&&(t.query=e[7].slice(1)),e[8]&&(t.fragment=e[8].slice(1)),t}return null}const EMPTY_RESULT={didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};function wrapLegacyResolver(r){return function(e,t,n){try{return Promise.resolve(_catch(function(){return Promise.resolve(r(e,t,n)).then(function(a){return{...EMPTY_RESULT,didResolutionMetadata:{contentType:"application/did+ld+json"},didDocument:a}})},function(a){return{...EMPTY_RESULT,didResolutionMetadata:{error:"notFound",message:a.toString()}}}))}catch(a){return Promise.reject(a)}}}class Resolver{constructor(e={},t={}){this.registry=void 0,this.cache=void 0,this.registry=e,this.cache=t.cache===!0?inMemoryCache():t.cache||noCache,t.legacyResolvers&&Object.keys(t.legacyResolvers).map(n=>{this.registry[n]||(this.registry[n]=wrapLegacyResolver(t.legacyResolvers[n]))})}resolve(e,t={}){try{const n=this,a=parse$2(e);if(a===null)return Promise.resolve({...EMPTY_RESULT,didResolutionMetadata:{error:"invalidDid"}});const o=n.registry[a.method];return o?Promise.resolve(n.cache(a,()=>o(a.did,a,n,t))):Promise.resolve({...EMPTY_RESULT,didResolutionMetadata:{error:"unsupportedDidMethod"}})}catch(n){return Promise.reject(n)}}}function asUint8Array$1(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function allocUnsafe$1(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?asUint8Array$1(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function concat$4(r,e){e||(e=r.reduce((a,o)=>a+o.length,0));const t=allocUnsafe$1(e);let n=0;for(const a of r)t.set(a,n),n+=a.length;return asUint8Array$1(t)}function base$6(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var a=0;a<r.length;a++){var o=r.charAt(a),c=o.charCodeAt(0);if(t[c]!==255)throw new TypeError(o+" is ambiguous");t[c]=a}var u=r.length,v=r.charAt(0),_=Math.log(u)/Math.log(256),x=Math.log(256)/Math.log(u);function E(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var D=0,L=0,N=0,q=I.length;N!==q&&I[N]===0;)N++,D++;for(var F=(q-N)*x+1>>>0,U=new Uint8Array(F);N!==q;){for(var j=I[N],W=0,X=F-1;(j!==0||W<L)&&X!==-1;X--,W++)j+=256*U[X]>>>0,U[X]=j%u>>>0,j=j/u>>>0;if(j!==0)throw new Error("Non-zero carry");L=W,N++}for(var J=F-L;J!==F&&U[J]===0;)J++;for(var G=v.repeat(D);J<F;++J)G+=r.charAt(U[J]);return G}function M(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var D=0;if(I[D]!==" "){for(var L=0,N=0;I[D]===v;)L++,D++;for(var q=(I.length-D)*_+1>>>0,F=new Uint8Array(q);I[D];){var U=t[I.charCodeAt(D)];if(U===255)return;for(var j=0,W=q-1;(U!==0||j<N)&&W!==-1;W--,j++)U+=u*F[W]>>>0,F[W]=U%256>>>0,U=U/256>>>0;if(U!==0)throw new Error("Non-zero carry");N=j,D++}if(I[D]!==" "){for(var X=q-N;X!==q&&F[X]===0;)X++;for(var J=new Uint8Array(L+(q-X)),G=L;X!==q;)J[G++]=F[X++];return J}}}function C(I){var D=M(I);if(D)return D;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:M,decode:C}}var src$3=base$6,_brrp__multiformats_scope_baseX$1=src$3;const coerce$1=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$5=r=>new TextEncoder().encode(r),toString$6=r=>new TextDecoder().decode(r);let Encoder$2=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$3(this,e)}},ComposedDecoder$1=class{constructor(e){this.decoders=e}or(e){return or$3(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$3=(r,e)=>new ComposedDecoder$1({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Codec$2=class{constructor(e,t,n,a){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=a,this.encoder=new Encoder$2(e,t,n),this.decoder=new Decoder$2(e,t,a)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$3=({name:r,prefix:e,encode:t,decode:n})=>new Codec$2(r,e,t,n),baseX$2=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:a}=_brrp__multiformats_scope_baseX$1(t,e);return from$3({prefix:r,name:e,encode:n,decode:o=>coerce$1(a(o))})},decode$g=(r,e,t,n)=>{const a={};for(let x=0;x<e.length;++x)a[e[x]]=x;let o=r.length;for(;r[o-1]==="=";)--o;const c=new Uint8Array(o*t/8|0);let u=0,v=0,_=0;for(let x=0;x<o;++x){const E=a[r[x]];if(E===void 0)throw new SyntaxError(`Non-${n} character`);v=v<<t|E,u+=t,u>=8&&(u-=8,c[_++]=255&v>>u)}if(u>=t||255&v<<8-u)throw new SyntaxError("Unexpected end of data");return c},encode$e=(r,e,t)=>{const n=e[e.length-1]==="=",a=(1<<t)-1;let o="",c=0,u=0;for(let v=0;v<r.length;++v)for(u=u<<8|r[v],c+=8;c>t;)c-=t,o+=e[a&u>>c];if(c&&(o+=e[a&u<<t-c]),n)for(;o.length*t&7;)o+="=";return o},rfc4648$3=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$3({prefix:e,name:r,encode(a){return encode$e(a,n,t)},decode(a){return decode$g(a,n,t,r)}}),identity$4=from$3({prefix:"\0",name:"identity",encode:r=>toString$6(r),decode:r=>fromString$5(r)}),identityBase$1=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$4},Symbol.toStringTag,{value:"Module"})),base2$2=rfc4648$3({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$3=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$2},Symbol.toStringTag,{value:"Module"})),base8$2=rfc4648$3({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$3=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$2},Symbol.toStringTag,{value:"Module"})),base10$2=baseX$2({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$3=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$2},Symbol.toStringTag,{value:"Module"})),base16$2=rfc4648$3({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$1=rfc4648$3({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$3=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$2,base16upper:base16upper$1},Symbol.toStringTag,{value:"Module"})),base32$2=rfc4648$3({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$1=rfc4648$3({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$1=rfc4648$3({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$1=rfc4648$3({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$1=rfc4648$3({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$1=rfc4648$3({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$1=rfc4648$3({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$1=rfc4648$3({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$1=rfc4648$3({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$3=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$2,base32hex:base32hex$1,base32hexpad:base32hexpad$1,base32hexpadupper:base32hexpadupper$1,base32hexupper:base32hexupper$1,base32pad:base32pad$1,base32padupper:base32padupper$1,base32upper:base32upper$1,base32z:base32z$1},Symbol.toStringTag,{value:"Module"})),base36$2=baseX$2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$1=baseX$2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$3=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$2,base36upper:base36upper$1},Symbol.toStringTag,{value:"Module"})),base58btc$1=baseX$2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$1=baseX$2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$1,base58flickr:base58flickr$1},Symbol.toStringTag,{value:"Module"})),base64$2=rfc4648$3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$1=rfc4648$3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$1=rfc4648$3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$1=rfc4648$3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$3=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$2,base64pad:base64pad$1,base64url:base64url$1,base64urlpad:base64urlpad$1},Symbol.toStringTag,{value:"Module"})),alphabet$2=Array.from(""),alphabetBytesToChars$1=alphabet$2.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes$1=alphabet$2.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$d(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars$1[t],e),"")}function decode$f(r){const e=[];for(const t of r){const n=alphabetCharsToBytes$1[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji$2=from$3({prefix:"",name:"base256emoji",encode:encode$d,decode:decode$f}),base256emoji$3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$2},Symbol.toStringTag,{value:"Module"}));var encode_1$2=encode$c,MSB$5=128,MSBALL$2=-128,INT$2=Math.pow(2,31);function encode$c(r,e,t){e=e||[],t=t||0;for(var n=t;r>=INT$2;)e[t++]=r&255|MSB$5,r/=128;for(;r&MSBALL$2;)e[t++]=r&255|MSB$5,r>>>=7;return e[t]=r|0,encode$c.bytes=t-n+1,e}var decode$e=read$4,MSB$1$2=128,REST$1$2=127;function read$4(r,n){var t=0,n=n||0,a=0,o=n,c,u=r.length;do{if(o>=u)throw read$4.bytes=0,new RangeError("Could not decode varint");c=r[o++],t+=a<28?(c&REST$1$2)<<a:(c&REST$1$2)*Math.pow(2,a),a+=7}while(c>=MSB$1$2);return read$4.bytes=o-n,t}var N1$3=Math.pow(2,7),N2$3=Math.pow(2,14),N3$3=Math.pow(2,21),N4$3=Math.pow(2,28),N5$3=Math.pow(2,35),N6$3=Math.pow(2,42),N7$3=Math.pow(2,49),N8$2=Math.pow(2,56),N9$2=Math.pow(2,63),length$4=function(r){return r<N1$3?1:r<N2$3?2:r<N3$3?3:r<N4$3?4:r<N5$3?5:r<N6$3?6:r<N7$3?7:r<N8$2?8:r<N9$2?9:10},varint$3={encode:encode_1$2,decode:decode$e,encodingLength:length$4},_brrp_varint$1=varint$3;const decode$d=(r,e=0)=>[_brrp_varint$1.decode(r,e),_brrp_varint$1.decode.bytes];new TextEncoder;new TextDecoder;const bases$1={...identityBase$1,...base2$3,...base8$3,...base10$3,...base16$3,...base32$3,...base36$3,...base58$1,...base64$3,...base256emoji$3};function createCodec$2(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const string$2=createCodec$2("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ascii$1=createCodec$2("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=allocUnsafe$1(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BASES$1={utf8:string$2,"utf-8":string$2,hex:bases$1.base16,latin1:ascii$1,ascii:ascii$1,binary:ascii$1,...bases$1};function fromString$4(r,e="utf8"){const t=BASES$1[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array$1(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function toString$5(r,e="utf8"){const t=BASES$1[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function anumber$1(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function isBytes$5(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function abytes$1(r,...e){if(!isBytes$5(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function ahash(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");anumber$1(r.outputLen),anumber$1(r.blockLen)}function aexists(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function aoutput(r,e){abytes$1(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function u32$3(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function createView$2(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function rotr(r,e){return r<<32-e|r>>>e}function rotl$2(r,e){return r<<e|r>>>32-e>>>0}const isLE$3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function byteSwap(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function byteSwap32(r){for(let e=0;e<r.length;e++)r[e]=byteSwap(r[e])}const hexes$1=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(r){abytes$1(r);let e="";for(let t=0;t<r.length;t++)e+=hexes$1[r[t]];return e}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(r){if(r>=asciis$1._0&&r<=asciis$1._9)return r-asciis$1._0;if(r>=asciis$1.A&&r<=asciis$1.F)return r-(asciis$1.A-10);if(r>=asciis$1.a&&r<=asciis$1.f)return r-(asciis$1.a-10)}function hexToBytes$3(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let a=0,o=0;a<t;a++,o+=2){const c=asciiToBase16$1(r.charCodeAt(o)),u=asciiToBase16$1(r.charCodeAt(o+1));if(c===void 0||u===void 0){const v=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+v+'" at index '+o)}n[a]=c*16+u}return n}function utf8ToBytes$5(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$5(r){return typeof r=="string"&&(r=utf8ToBytes$5(r)),abytes$1(r),r}function concatBytes$1(...r){let e=0;for(let n=0;n<r.length;n++){const a=r[n];abytes$1(a),e+=a.length}const t=new Uint8Array(e);for(let n=0,a=0;n<r.length;n++){const o=r[n];t.set(o,a),a+=o.length}return t}let Hash$1=class{clone(){return this._cloneInto()}};function wrapConstructor$1(r){const e=n=>r().update(toBytes$5(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function randomBytes$1(r=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(r));if(crypto$1&&typeof crypto$1.randomBytes=="function")return crypto$1.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$2(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const a=BigInt(32),o=BigInt(4294967295),c=Number(t>>a&o),u=Number(t&o),v=n?4:0,_=n?0:4;r.setUint32(e+v,c,n),r.setUint32(e+_,u,n)}function Chi(r,e,t){return r&e^~r&t}function Maj(r,e,t){return r&e^r&t^e&t}class HashMD extends Hash$1{constructor(e,t,n,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){aexists(this);const{view:t,buffer:n,blockLen:a}=this;e=toBytes$5(e);const o=e.length;for(let c=0;c<o;){const u=Math.min(a-this.pos,o-c);if(u===a){const v=createView$2(e);for(;a<=o-c;c+=a)this.process(v,c);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists(this),aoutput(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:a,isLE:o}=this;let{pos:c}=this;t[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>a-c&&(this.process(n,0),c=0);for(let E=c;E<a;E++)t[E]=0;setBigUint64$2(n,a-8,BigInt(this.length*8),o),this.process(n,0);const u=createView$2(e),v=this.outputLen;if(v%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const _=v/4,x=this.get();if(_>x.length)throw new Error("_sha2: outputLen bigger than state");for(let E=0;E<_;E++)u.setUint32(4*E,x[E],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:a,finished:o,destroyed:c,pos:u}=this;return e.length=a,e.pos=u,e.finished=o,e.destroyed=c,a%t&&e.buffer.set(n),e}}const U32_MASK64$1=BigInt(2**32-1),_32n$1=BigInt(32);function fromBig$1(r,e=!1){return e?{h:Number(r&U32_MASK64$1),l:Number(r>>_32n$1&U32_MASK64$1)}:{h:Number(r>>_32n$1&U32_MASK64$1)|0,l:Number(r&U32_MASK64$1)|0}}function split$1(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:o,l:c}=fromBig$1(r[a],e);[t[a],n[a]]=[o,c]}return[t,n]}const toBig=(r,e)=>BigInt(r>>>0)<<_32n$1|BigInt(e>>>0),shrSH=(r,e,t)=>r>>>t,shrSL=(r,e,t)=>r<<32-t|e>>>t,rotrSH=(r,e,t)=>r>>>t|e<<32-t,rotrSL=(r,e,t)=>r<<32-t|e>>>t,rotrBH=(r,e,t)=>r<<64-t|e>>>t-32,rotrBL=(r,e,t)=>r>>>t-32|e<<64-t,rotr32H=(r,e)=>e,rotr32L=(r,e)=>r,rotlSH$1=(r,e,t)=>r<<t|e>>>32-t,rotlSL$1=(r,e,t)=>e<<t|r>>>32-t,rotlBH$1=(r,e,t)=>e<<t-32|r>>>64-t,rotlBL$1=(r,e,t)=>r<<t-32|e>>>64-t;function add(r,e,t,n){const a=(e>>>0)+(n>>>0);return{h:r+t+(a/2**32|0)|0,l:a|0}}const add3L=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),add3H=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,add4L=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),add4H=(r,e,t,n,a)=>e+t+n+a+(r/2**32|0)|0,add5L=(r,e,t,n,a)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(a>>>0),add5H=(r,e,t,n,a,o)=>e+t+n+a+o+(r/2**32|0)|0,u64={fromBig:fromBig$1,split:split$1,toBig,shrSH,shrSL,rotrSH,rotrSL,rotrBH,rotrBL,rotr32H,rotr32L,rotlSH:rotlSH$1,rotlSL:rotlSL$1,rotlBH:rotlBH$1,rotlBL:rotlBL$1,add,add3L,add3H,add4L,add4H,add5H,add5L},[SHA512_Kh,SHA512_Kl]=u64.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:a,Ch:o,Cl:c,Dh:u,Dl:v,Eh:_,El:x,Fh:E,Fl:M,Gh:C,Gl:I,Hh:D,Hl:L}=this;return[e,t,n,a,o,c,u,v,_,x,E,M,C,I,D,L]}set(e,t,n,a,o,c,u,v,_,x,E,M,C,I,D,L){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=a|0,this.Ch=o|0,this.Cl=c|0,this.Dh=u|0,this.Dl=v|0,this.Eh=_|0,this.El=x|0,this.Fh=E|0,this.Fl=M|0,this.Gh=C|0,this.Gl=I|0,this.Hh=D|0,this.Hl=L|0}process(e,t){for(let F=0;F<16;F++,t+=4)SHA512_W_H[F]=e.getUint32(t),SHA512_W_L[F]=e.getUint32(t+=4);for(let F=16;F<80;F++){const U=SHA512_W_H[F-15]|0,j=SHA512_W_L[F-15]|0,W=u64.rotrSH(U,j,1)^u64.rotrSH(U,j,8)^u64.shrSH(U,j,7),X=u64.rotrSL(U,j,1)^u64.rotrSL(U,j,8)^u64.shrSL(U,j,7),J=SHA512_W_H[F-2]|0,G=SHA512_W_L[F-2]|0,oe=u64.rotrSH(J,G,19)^u64.rotrBH(J,G,61)^u64.shrSH(J,G,6),O=u64.rotrSL(J,G,19)^u64.rotrBL(J,G,61)^u64.shrSL(J,G,6),l=u64.add4L(X,O,SHA512_W_L[F-7],SHA512_W_L[F-16]),p=u64.add4H(l,W,oe,SHA512_W_H[F-7],SHA512_W_H[F-16]);SHA512_W_H[F]=p|0,SHA512_W_L[F]=l|0}let{Ah:n,Al:a,Bh:o,Bl:c,Ch:u,Cl:v,Dh:_,Dl:x,Eh:E,El:M,Fh:C,Fl:I,Gh:D,Gl:L,Hh:N,Hl:q}=this;for(let F=0;F<80;F++){const U=u64.rotrSH(E,M,14)^u64.rotrSH(E,M,18)^u64.rotrBH(E,M,41),j=u64.rotrSL(E,M,14)^u64.rotrSL(E,M,18)^u64.rotrBL(E,M,41),W=E&C^~E&D,X=M&I^~M&L,J=u64.add5L(q,j,X,SHA512_Kl[F],SHA512_W_L[F]),G=u64.add5H(J,N,U,W,SHA512_Kh[F],SHA512_W_H[F]),oe=J|0,O=u64.rotrSH(n,a,28)^u64.rotrBH(n,a,34)^u64.rotrBH(n,a,39),l=u64.rotrSL(n,a,28)^u64.rotrBL(n,a,34)^u64.rotrBL(n,a,39),p=n&o^n&u^o&u,b=a&c^a&v^c&v;N=D|0,q=L|0,D=C|0,L=I|0,C=E|0,I=M|0,{h:E,l:M}=u64.add(_|0,x|0,G|0,oe|0),_=u|0,x=v|0,u=o|0,v=c|0,o=n|0,c=a|0;const S=u64.add3L(oe,l,b);n=u64.add3H(S,G,O,p),a=S|0}({h:n,l:a}=u64.add(this.Ah|0,this.Al|0,n|0,a|0)),{h:o,l:c}=u64.add(this.Bh|0,this.Bl|0,o|0,c|0),{h:u,l:v}=u64.add(this.Ch|0,this.Cl|0,u|0,v|0),{h:_,l:x}=u64.add(this.Dh|0,this.Dl|0,_|0,x|0),{h:E,l:M}=u64.add(this.Eh|0,this.El|0,E|0,M|0),{h:C,l:I}=u64.add(this.Fh|0,this.Fl|0,C|0,I|0),{h:D,l:L}=u64.add(this.Gh|0,this.Gl|0,D|0,L|0),{h:N,l:q}=u64.add(this.Hh|0,this.Hl|0,N|0,q|0),this.set(n,a,o,c,u,v,_,x,E,M,C,I,D,L,N,q)}roundClean(){SHA512_W_H.fill(0),SHA512_W_L.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class SHA384 extends SHA512{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}const sha512$2=wrapConstructor$1(()=>new SHA512),sha384$2=wrapConstructor$1(()=>new SHA384);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$9=BigInt(1),_2n$6=BigInt(2);function isBytes$4(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function abytes(r){if(!isBytes$4(r))throw new Error("Uint8Array expected")}function abool(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const hexes=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1(r){abytes(r);let e="";for(let t=0;t<r.length;t++)e+=hexes[r[t]];return e}function numberToHexUnpadded(r){const e=r.toString(16);return e.length&1?"0"+e:e}function hexToNumber(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?_0n$7:BigInt("0x"+r)}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(r){if(r>=asciis._0&&r<=asciis._9)return r-asciis._0;if(r>=asciis.A&&r<=asciis.F)return r-(asciis.A-10);if(r>=asciis.a&&r<=asciis.f)return r-(asciis.a-10)}function hexToBytes$2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let a=0,o=0;a<t;a++,o+=2){const c=asciiToBase16(r.charCodeAt(o)),u=asciiToBase16(r.charCodeAt(o+1));if(c===void 0||u===void 0){const v=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+v+'" at index '+o)}n[a]=c*16+u}return n}function bytesToNumberBE(r){return hexToNumber(bytesToHex$1(r))}function bytesToNumberLE(r){return abytes(r),hexToNumber(bytesToHex$1(Uint8Array.from(r).reverse()))}function numberToBytesBE(r,e){return hexToBytes$2(r.toString(16).padStart(e*2,"0"))}function numberToBytesLE(r,e){return numberToBytesBE(r,e).reverse()}function numberToVarBytesBE(r){return hexToBytes$2(numberToHexUnpadded(r))}function ensureBytes$1(r,e,t){let n;if(typeof e=="string")try{n=hexToBytes$2(e)}catch(o){throw new Error(r+" must be hex string or Uint8Array, cause: "+o)}else if(isBytes$4(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const a=n.length;if(typeof t=="number"&&a!==t)throw new Error(r+" of length "+t+" expected, got "+a);return n}function concatBytes(...r){let e=0;for(let n=0;n<r.length;n++){const a=r[n];abytes(a),e+=a.length}const t=new Uint8Array(e);for(let n=0,a=0;n<r.length;n++){const o=r[n];t.set(o,a),a+=o.length}return t}function equalBytes$2(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}function utf8ToBytes$4(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}const isPosBig=r=>typeof r=="bigint"&&_0n$7<=r;function inRange$2(r,e,t){return isPosBig(r)&&isPosBig(e)&&isPosBig(t)&&e<=r&&r<t}function aInRange(r,e,t,n){if(!inRange$2(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function bitLen(r){let e;for(e=0;r>_0n$7;r>>=_1n$9,e+=1);return e}function bitGet(r,e){return r>>BigInt(e)&_1n$9}function bitSet(r,e,t){return r|(t?_1n$9:_0n$7)<<BigInt(e)}const bitMask=r=>(_2n$6<<BigInt(r-1))-_1n$9,u8n=r=>new Uint8Array(r),u8fr=r=>Uint8Array.from(r);function createHmacDrbg(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=u8n(r),a=u8n(r),o=0;const c=()=>{n.fill(1),a.fill(0),o=0},u=(...E)=>t(a,n,...E),v=(E=u8n())=>{a=u(u8fr([0]),E),n=u(),E.length!==0&&(a=u(u8fr([1]),E),n=u())},_=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let E=0;const M=[];for(;E<e;){n=u();const C=n.slice();M.push(C),E+=n.length}return concatBytes(...M)};return(E,M)=>{c(),v(E);let C;for(;!(C=M(_()));)v();return c(),C}}const validatorFns={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||isBytes$4(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function validateObject(r,e,t={}){const n=(a,o,c)=>{const u=validatorFns[o];if(typeof u!="function")throw new Error("invalid validator function");const v=r[a];if(!(c&&v===void 0)&&!u(v,r))throw new Error("param "+String(a)+" is invalid. Expected "+o+", got "+v)};for(const[a,o]of Object.entries(e))n(a,o,!1);for(const[a,o]of Object.entries(t))n(a,o,!0);return r}const notImplemented=()=>{throw new Error("not implemented")};function memoized(r){const e=new WeakMap;return(t,...n)=>{const a=e.get(t);if(a!==void 0)return a;const o=r(t,...n);return e.set(t,o),o}}const ut=Object.freeze(Object.defineProperty({__proto__:null,aInRange,abool,abytes,bitGet,bitLen,bitMask,bitSet,bytesToHex:bytesToHex$1,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes:ensureBytes$1,equalBytes:equalBytes$2,hexToBytes:hexToBytes$2,hexToNumber,inRange:inRange$2,isBytes:isBytes$4,memoized,notImplemented,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$4,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$6=BigInt(0),_1n$8=BigInt(1),_2n$5=BigInt(2),_3n$2=BigInt(3),_4n=BigInt(4),_5n$1=BigInt(5),_8n$2=BigInt(8);function mod(r,e){const t=r%e;return t>=_0n$6?t:e+t}function pow$1(r,e,t){if(e<_0n$6)throw new Error("invalid exponent, negatives unsupported");if(t<=_0n$6)throw new Error("invalid modulus");if(t===_1n$8)return _0n$6;let n=_1n$8;for(;e>_0n$6;)e&_1n$8&&(n=n*r%t),r=r*r%t,e>>=_1n$8;return n}function pow2(r,e,t){let n=r;for(;e-- >_0n$6;)n*=n,n%=t;return n}function invert(r,e){if(r===_0n$6)throw new Error("invert: expected non-zero number");if(e<=_0n$6)throw new Error("invert: expected positive modulus, got "+e);let t=mod(r,e),n=e,a=_0n$6,o=_1n$8;for(;t!==_0n$6;){const u=n/t,v=n%t,_=a-o*u;n=t,t=v,a=o,o=_}if(n!==_1n$8)throw new Error("invert: does not exist");return mod(a,e)}function tonelliShanks(r){const e=(r-_1n$8)/_2n$5;let t,n,a;for(t=r-_1n$8,n=0;t%_2n$5===_0n$6;t/=_2n$5,n++);for(a=_2n$5;a<r&&pow$1(a,e,r)!==r-_1n$8;a++)if(a>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const c=(r+_1n$8)/_4n;return function(v,_){const x=v.pow(_,c);if(!v.eql(v.sqr(x),_))throw new Error("Cannot find square root");return x}}const o=(t+_1n$8)/_2n$5;return function(u,v){if(u.pow(v,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let _=n,x=u.pow(u.mul(u.ONE,a),t),E=u.pow(v,o),M=u.pow(v,t);for(;!u.eql(M,u.ONE);){if(u.eql(M,u.ZERO))return u.ZERO;let C=1;for(let D=u.sqr(M);C<_&&!u.eql(D,u.ONE);C++)D=u.sqr(D);const I=u.pow(x,_1n$8<<BigInt(_-C-1));x=u.sqr(I),E=u.mul(E,I),M=u.mul(M,x),_=C}return E}}function FpSqrt(r){if(r%_4n===_3n$2){const e=(r+_1n$8)/_4n;return function(n,a){const o=n.pow(a,e);if(!n.eql(n.sqr(o),a))throw new Error("Cannot find square root");return o}}if(r%_8n$2===_5n$1){const e=(r-_5n$1)/_8n$2;return function(n,a){const o=n.mul(a,_2n$5),c=n.pow(o,e),u=n.mul(a,c),v=n.mul(n.mul(u,_2n$5),c),_=n.mul(u,n.sub(v,n.ONE));if(!n.eql(n.sqr(_),a))throw new Error("Cannot find square root");return _}}return tonelliShanks(r)}const isNegativeLE=(r,e)=>(mod(r,e)&_1n$8)===_1n$8,FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=FIELD_FIELDS.reduce((n,a)=>(n[a]="function",n),e);return validateObject(r,t)}function FpPow(r,e,t){if(t<_0n$6)throw new Error("invalid exponent, negatives unsupported");if(t===_0n$6)return r.ONE;if(t===_1n$8)return e;let n=r.ONE,a=e;for(;t>_0n$6;)t&_1n$8&&(n=r.mul(n,a)),a=r.sqr(a),t>>=_1n$8;return n}function FpInvertBatch(r,e){const t=new Array(e.length),n=e.reduce((o,c,u)=>r.is0(c)?o:(t[u]=o,r.mul(o,c)),r.ONE),a=r.inv(n);return e.reduceRight((o,c,u)=>r.is0(c)?o:(t[u]=r.mul(o,t[u]),r.mul(o,c)),a),t}function nLength(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Field(r,e,t=!1,n={}){if(r<=_0n$6)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:a,nByteLength:o}=nLength(r,e);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const u=Object.freeze({ORDER:r,isLE:t,BITS:a,BYTES:o,MASK:bitMask(a),ZERO:_0n$6,ONE:_1n$8,create:v=>mod(v,r),isValid:v=>{if(typeof v!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof v);return _0n$6<=v&&v<r},is0:v=>v===_0n$6,isOdd:v=>(v&_1n$8)===_1n$8,neg:v=>mod(-v,r),eql:(v,_)=>v===_,sqr:v=>mod(v*v,r),add:(v,_)=>mod(v+_,r),sub:(v,_)=>mod(v-_,r),mul:(v,_)=>mod(v*_,r),pow:(v,_)=>FpPow(u,v,_),div:(v,_)=>mod(v*invert(_,r),r),sqrN:v=>v*v,addN:(v,_)=>v+_,subN:(v,_)=>v-_,mulN:(v,_)=>v*_,inv:v=>invert(v,r),sqrt:n.sqrt||(v=>(c||(c=FpSqrt(r)),c(u,v))),invertBatch:v=>FpInvertBatch(u,v),cmov:(v,_,x)=>x?_:v,toBytes:v=>t?numberToBytesLE(v,o):numberToBytesBE(v,o),fromBytes:v=>{if(v.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+v.length);return t?bytesToNumberLE(v):bytesToNumberBE(v)}});return Object.freeze(u)}function getFieldBytesLength(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(r){const e=getFieldBytesLength(r);return e+Math.ceil(e/2)}function mapHashToField(r,e,t=!1){const n=r.length,a=getFieldBytesLength(e),o=getMinHashLength(e);if(n<16||n<o||n>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+n);const c=t?bytesToNumberLE(r):bytesToNumberBE(r),u=mod(c,e-_1n$8)+_1n$8;return t?numberToBytesLE(u,a):numberToBytesBE(u,a)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$5=BigInt(0),_1n$7=BigInt(1);function constTimeNegate(r,e){const t=e.negate();return r?t:e}function validateW(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function calcWOpts(r,e){validateW(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1);return{windows:t,windowSize:n}}function validateMSMPoints(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function validateMSMScalars(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(r){return pointWindowSizes.get(r)||1}function wNAF(r,e){return{constTimeNegate,hasPrecomputes(t){return getW(t)!==1},unsafeLadder(t,n,a=r.ZERO){let o=t;for(;n>_0n$5;)n&_1n$7&&(a=a.add(o)),o=o.double(),n>>=_1n$7;return a},precomputeWindow(t,n){const{windows:a,windowSize:o}=calcWOpts(n,e),c=[];let u=t,v=u;for(let _=0;_<a;_++){v=u,c.push(v);for(let x=1;x<o;x++)v=v.add(u),c.push(v);u=v.double()}return c},wNAF(t,n,a){const{windows:o,windowSize:c}=calcWOpts(t,e);let u=r.ZERO,v=r.BASE;const _=BigInt(2**t-1),x=2**t,E=BigInt(t);for(let M=0;M<o;M++){const C=M*c;let I=Number(a&_);a>>=E,I>c&&(I-=x,a+=_1n$7);const D=C,L=C+Math.abs(I)-1,N=M%2!==0,q=I<0;I===0?v=v.add(constTimeNegate(N,n[D])):u=u.add(constTimeNegate(q,n[L]))}return{p:u,f:v}},wNAFUnsafe(t,n,a,o=r.ZERO){const{windows:c,windowSize:u}=calcWOpts(t,e),v=BigInt(2**t-1),_=2**t,x=BigInt(t);for(let E=0;E<c;E++){const M=E*u;if(a===_0n$5)break;let C=Number(a&v);if(a>>=x,C>u&&(C-=_,a+=_1n$7),C===0)continue;let I=n[M+Math.abs(C)-1];C<0&&(I=I.negate()),o=o.add(I)}return o},getPrecomputes(t,n,a){let o=pointPrecomputes.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&pointPrecomputes.set(n,a(o))),o},wNAFCached(t,n,a){const o=getW(t);return this.wNAF(o,this.getPrecomputes(o,t,a),n)},wNAFCachedUnsafe(t,n,a,o){const c=getW(t);return c===1?this.unsafeLadder(t,n,o):this.wNAFUnsafe(c,this.getPrecomputes(c,t,a),n,o)},setWindowSize(t,n){validateW(n,e),pointWindowSizes.set(t,n),pointPrecomputes.delete(t)}}}function pippenger(r,e,t,n){if(validateMSMPoints(t,r),validateMSMScalars(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const a=r.ZERO,o=bitLen(BigInt(t.length)),c=o>12?o-3:o>4?o-2:o?2:1,u=(1<<c)-1,v=new Array(u+1).fill(a),_=Math.floor((e.BITS-1)/c)*c;let x=a;for(let E=_;E>=0;E-=c){v.fill(a);for(let C=0;C<n.length;C++){const I=n[C],D=Number(I>>BigInt(E)&BigInt(u));v[D]=v[D].add(t[C])}let M=a;for(let C=v.length-1,I=a;C>0;C--)I=I.add(v[C]),M=M.add(I);if(x=x.add(M),E!==0)for(let C=0;C<c;C++)x=x.double()}return x}function validateBasic(r){return validateField(r.Fp),validateObject(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$6=BigInt(1),_2n$4=BigInt(2),_8n$1=BigInt(8),VERIFY_DEFAULT={zip215:!0};function validateOpts$2(r){const e=validateBasic(r);return validateObject(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function twistedEdwards(r){const e=validateOpts$2(r),{Fp:t,n,prehash:a,hash:o,randomBytes:c,nByteLength:u,h:v}=e,_=_2n$4<<BigInt(u*8)-_1n$6,x=t.create,E=Field(e.n,e.nBitLength),M=e.uvRatio||((T,B)=>{try{return{isValid:!0,value:t.sqrt(T*t.inv(B))}}catch{return{isValid:!1,value:_0n$4}}}),C=e.adjustScalarBytes||(T=>T),I=e.domain||((T,B,$)=>{if(abool("phflag",$),B.length||$)throw new Error("Contexts/pre-hash are not supported");return T});function D(T,B){aInRange("coordinate "+T,B,_0n$4,_)}function L(T){if(!(T instanceof F))throw new Error("ExtendedPoint expected")}const N=memoized((T,B)=>{const{ex:$,ey:A,ez:g}=T,k=T.is0();B==null&&(B=k?_8n$1:t.inv(g));const H=x($*B),z=x(A*B),Q=x(g*B);if(k)return{x:_0n$4,y:_1n$6};if(Q!==_1n$6)throw new Error("invZ was invalid");return{x:H,y:z}}),q=memoized(T=>{const{a:B,d:$}=e;if(T.is0())throw new Error("bad point: ZERO");const{ex:A,ey:g,ez:k,et:H}=T,z=x(A*A),Q=x(g*g),ie=x(k*k),ne=x(ie*ie),Z=x(z*B),se=x(ie*x(Z+Q)),ae=x(ne+x($*x(z*Q)));if(se!==ae)throw new Error("bad point: equation left != right (1)");const ce=x(A*g),le=x(k*H);if(ce!==le)throw new Error("bad point: equation left != right (2)");return!0});class F{constructor(B,$,A,g){this.ex=B,this.ey=$,this.ez=A,this.et=g,D("x",B),D("y",$),D("z",A),D("t",g),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(B){if(B instanceof F)throw new Error("extended point not allowed");const{x:$,y:A}=B||{};return D("x",$),D("y",A),new F($,A,_1n$6,x($*A))}static normalizeZ(B){const $=t.invertBatch(B.map(A=>A.ez));return B.map((A,g)=>A.toAffine($[g])).map(F.fromAffine)}static msm(B,$){return pippenger(F,E,B,$)}_setWindowSize(B){W.setWindowSize(this,B)}assertValidity(){q(this)}equals(B){L(B);const{ex:$,ey:A,ez:g}=this,{ex:k,ey:H,ez:z}=B,Q=x($*z),ie=x(k*g),ne=x(A*z),Z=x(H*g);return Q===ie&&ne===Z}is0(){return this.equals(F.ZERO)}negate(){return new F(x(-this.ex),this.ey,this.ez,x(-this.et))}double(){const{a:B}=e,{ex:$,ey:A,ez:g}=this,k=x($*$),H=x(A*A),z=x(_2n$4*x(g*g)),Q=x(B*k),ie=$+A,ne=x(x(ie*ie)-k-H),Z=Q+H,se=Z-z,ae=Q-H,ce=x(ne*se),le=x(Z*ae),te=x(ne*ae),he=x(se*Z);return new F(ce,le,he,te)}add(B){L(B);const{a:$,d:A}=e,{ex:g,ey:k,ez:H,et:z}=this,{ex:Q,ey:ie,ez:ne,et:Z}=B;if($===BigInt(-1)){const Ke=x((k-g)*(ie+Q)),ye=x((k+g)*(ie-Q)),xe=x(ye-Ke);if(xe===_0n$4)return this.double();const Ve=x(H*_2n$4*Z),be=x(z*_2n$4*ne),Ee=be+Ve,Ge=ye+Ke,re=be-Ve,Y=x(Ee*xe),ee=x(Ge*re),fe=x(Ee*re),ue=x(xe*Ge);return new F(Y,ee,ue,fe)}const se=x(g*Q),ae=x(k*ie),ce=x(z*A*Z),le=x(H*ne),te=x((g+k)*(Q+ie)-se-ae),he=le-ce,Ae=le+ce,ge=x(ae-$*se),me=x(te*he),je=x(Ae*ge),we=x(te*ge),pe=x(he*Ae);return new F(me,je,pe,we)}subtract(B){return this.add(B.negate())}wNAF(B){return W.wNAFCached(this,B,F.normalizeZ)}multiply(B){const $=B;aInRange("scalar",$,_1n$6,n);const{p:A,f:g}=this.wNAF($);return F.normalizeZ([A,g])[0]}multiplyUnsafe(B,$=F.ZERO){const A=B;return aInRange("scalar",A,_0n$4,n),A===_0n$4?j:this.is0()||A===_1n$6?this:W.wNAFCachedUnsafe(this,A,F.normalizeZ,$)}isSmallOrder(){return this.multiplyUnsafe(v).is0()}isTorsionFree(){return W.unsafeLadder(this,n).is0()}toAffine(B){return N(this,B)}clearCofactor(){const{h:B}=e;return B===_1n$6?this:this.multiplyUnsafe(B)}static fromHex(B,$=!1){const{d:A,a:g}=e,k=t.BYTES;B=ensureBytes$1("pointHex",B,k),abool("zip215",$);const H=B.slice(),z=B[k-1];H[k-1]=z&-129;const Q=bytesToNumberLE(H),ie=$?_:t.ORDER;aInRange("pointHex.y",Q,_0n$4,ie);const ne=x(Q*Q),Z=x(ne-_1n$6),se=x(A*ne-g);let{isValid:ae,value:ce}=M(Z,se);if(!ae)throw new Error("Point.fromHex: invalid y coordinate");const le=(ce&_1n$6)===_1n$6,te=(z&128)!==0;if(!$&&ce===_0n$4&&te)throw new Error("Point.fromHex: x=0 and x_0=1");return te!==le&&(ce=x(-ce)),F.fromAffine({x:ce,y:Q})}static fromPrivateKey(B){return G(B).point}toRawBytes(){const{x:B,y:$}=this.toAffine(),A=numberToBytesLE($,t.BYTES);return A[A.length-1]|=B&_1n$6?128:0,A}toHex(){return bytesToHex$1(this.toRawBytes())}}F.BASE=new F(e.Gx,e.Gy,_1n$6,x(e.Gx*e.Gy)),F.ZERO=new F(_0n$4,_1n$6,_1n$6,_0n$4);const{BASE:U,ZERO:j}=F,W=wNAF(F,u*8);function X(T){return mod(T,n)}function J(T){return X(bytesToNumberLE(T))}function G(T){const B=t.BYTES;T=ensureBytes$1("private key",T,B);const $=ensureBytes$1("hashed private key",o(T),2*B),A=C($.slice(0,B)),g=$.slice(B,2*B),k=J(A),H=U.multiply(k),z=H.toRawBytes();return{head:A,prefix:g,scalar:k,point:H,pointBytes:z}}function oe(T){return G(T).pointBytes}function O(T=new Uint8Array,...B){const $=concatBytes(...B);return J(o(I($,ensureBytes$1("context",T),!!a)))}function l(T,B,$={}){T=ensureBytes$1("message",T),a&&(T=a(T));const{prefix:A,scalar:g,pointBytes:k}=G(B),H=O($.context,A,T),z=U.multiply(H).toRawBytes(),Q=O($.context,z,k,T),ie=X(H+Q*g);aInRange("signature.s",ie,_0n$4,n);const ne=concatBytes(z,numberToBytesLE(ie,t.BYTES));return ensureBytes$1("result",ne,t.BYTES*2)}const p=VERIFY_DEFAULT;function b(T,B,$,A=p){const{context:g,zip215:k}=A,H=t.BYTES;T=ensureBytes$1("signature",T,2*H),B=ensureBytes$1("message",B),$=ensureBytes$1("publicKey",$,H),k!==void 0&&abool("zip215",k),a&&(B=a(B));const z=bytesToNumberLE(T.slice(H,2*H));let Q,ie,ne;try{Q=F.fromHex($,k),ie=F.fromHex(T.slice(0,H),k),ne=U.multiplyUnsafe(z)}catch{return!1}if(!k&&Q.isSmallOrder())return!1;const Z=O(g,ie.toRawBytes(),Q.toRawBytes(),B);return ie.add(Q.multiplyUnsafe(Z)).subtract(ne).clearCofactor().equals(F.ZERO)}return U._setWindowSize(8),{CURVE:e,getPublicKey:oe,sign:l,verify:b,ExtendedPoint:F,utils:{getExtendedPublicKey:G,randomPrivateKey:()=>c(t.BYTES),precompute(T=8,B=F.BASE){return B._setWindowSize(T),B.multiply(BigInt(3)),B}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$5=BigInt(1);function validateOpts$1(r){return validateObject(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function montgomery(r){const e=validateOpts$1(r),{P:t}=e,n=q=>mod(q,t),a=e.montgomeryBits,o=Math.ceil(a/8),c=e.nByteLength,u=e.adjustScalarBytes||(q=>q),v=e.powPminus2||(q=>pow$1(q,t-BigInt(2),t));function _(q,F,U){const j=n(q*(F-U));return F=n(F-j),U=n(U+j),[F,U]}const x=(e.a-BigInt(2))/BigInt(4);function E(q,F){aInRange("u",q,_0n$3,t),aInRange("scalar",F,_0n$3,t);const U=F,j=q;let W=_1n$5,X=_0n$3,J=q,G=_1n$5,oe=_0n$3,O;for(let p=BigInt(a-1);p>=_0n$3;p--){const b=U>>p&_1n$5;oe^=b,O=_(oe,W,J),W=O[0],J=O[1],O=_(oe,X,G),X=O[0],G=O[1],oe=b;const S=W+X,T=n(S*S),B=W-X,$=n(B*B),A=T-$,g=J+G,k=J-G,H=n(k*S),z=n(g*B),Q=H+z,ie=H-z;J=n(Q*Q),G=n(j*n(ie*ie)),W=n(T*$),X=n(A*(T+n(x*A)))}O=_(oe,W,J),W=O[0],J=O[1],O=_(oe,X,G),X=O[0],G=O[1];const l=v(X);return n(W*l)}function M(q){return numberToBytesLE(n(q),o)}function C(q){const F=ensureBytes$1("u coordinate",q,o);return c===32&&(F[31]&=127),bytesToNumberLE(F)}function I(q){const F=ensureBytes$1("scalar",q),U=F.length;if(U!==o&&U!==c){let j=""+o+" or "+c;throw new Error("invalid scalar, expected "+j+" bytes, got "+U)}return bytesToNumberLE(u(F))}function D(q,F){const U=C(F),j=I(q),W=E(U,j);if(W===_0n$3)throw new Error("invalid private or public key received");return M(W)}const L=M(e.Gu);function N(q){return D(q,L)}return{scalarMult:D,scalarMultBase:N,getSharedSecret:(q,F)=>D(q,F),getPublicKey:q=>N(q),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:L}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ED25519_P=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ED25519_SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const _1n$4=BigInt(1),_2n$3=BigInt(2),_3n$1=BigInt(3),_5n=BigInt(5),_8n=BigInt(8);function ed25519_pow_2_252_3(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),a=BigInt(80),o=ED25519_P,u=r*r%o*r%o,v=pow2(u,_2n$3,o)*u%o,_=pow2(v,_1n$4,o)*r%o,x=pow2(_,_5n,o)*_%o,E=pow2(x,e,o)*x%o,M=pow2(E,t,o)*E%o,C=pow2(M,n,o)*M%o,I=pow2(C,a,o)*C%o,D=pow2(I,a,o)*C%o,L=pow2(D,e,o)*x%o;return{pow_p_5_8:pow2(L,_2n$3,o)*r%o,b2:u}}function adjustScalarBytes(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function uvRatio(r,e){const t=ED25519_P,n=mod(e*e*e,t),a=mod(n*n*e,t),o=ed25519_pow_2_252_3(r*a).pow_p_5_8;let c=mod(r*n*o,t);const u=mod(e*c*c,t),v=c,_=mod(c*ED25519_SQRT_M1,t),x=u===r,E=u===mod(-r,t),M=u===mod(-r*ED25519_SQRT_M1,t);return x&&(c=v),(E||M)&&(c=_),isNegativeLE(c,t)&&(c=mod(-c,t)),{isValid:x||E,value:c}}const Fp=Field(ED25519_P,void 0,!0),ed25519Defaults={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:_8n,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:sha512$2,randomBytes:randomBytes$1,adjustScalarBytes,uvRatio},ed25519$1=twistedEdwards(ed25519Defaults),x25519=montgomery({P:ED25519_P,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=ED25519_P,{pow_p_5_8:t,b2:n}=ed25519_pow_2_252_3(r);return mod(pow2(t,_3n$1,e)*n,e)},adjustScalarBytes,randomBytes:randomBytes$1});function edwardsToMontgomeryPub(r){const{y:e}=ed25519$1.ExtendedPoint.fromHex(r),t=BigInt(1);return Fp.toBytes(Fp.create((t+e)*Fp.inv(t-e)))}function edwardsToMontgomeryPriv(r){const e=ed25519Defaults.hash(r.subarray(0,32));return ed25519Defaults.adjustScalarBytes(e).subarray(0,32)}var src$2={exports:{}};function base$5(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var n=0;n<r.length;n++){var a=r.charAt(n),o=a.charCodeAt(0);if(e[o]!==255)throw new TypeError(a+" is ambiguous");e[o]=n}var c=r.length,u=r.charAt(0),v=Math.log(c)/Math.log(256),_=Math.log(256)/Math.log(c);function x(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var I=0,D=0,L=0,N=C.length;L!==N&&C[L]===0;)L++,I++;for(var q=(N-L)*_+1>>>0,F=new Uint8Array(q);L!==N;){for(var U=C[L],j=0,W=q-1;(U!==0||j<D)&&W!==-1;W--,j++)U+=256*F[W]>>>0,F[W]=U%c>>>0,U=U/c>>>0;if(U!==0)throw new Error("Non-zero carry");D=j,L++}for(var X=q-D;X!==q&&F[X]===0;)X++;for(var J=u.repeat(I);X<q;++X)J+=r.charAt(F[X]);return J}function E(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var I=0;if(C[I]!==" "){for(var D=0,L=0;C[I]===u;)D++,I++;for(var N=(C.length-I)*v+1>>>0,q=new Uint8Array(N);C[I];){var F=e[C.charCodeAt(I)];if(F===255)return;for(var U=0,j=N-1;(F!==0||U<L)&&j!==-1;j--,U++)F+=c*q[j]>>>0,q[j]=F%256>>>0,F=F/256>>>0;if(F!==0)throw new Error("Non-zero carry");L=U,I++}if(C[I]!==" "){for(var W=N-L;W!==N&&q[W]===0;)W++;for(var X=new Uint8Array(D+(N-W)),J=D;W!==N;)X[J++]=q[W++];return X}}}function M(C){var I=E(C);if(I)return I;throw new Error("Non-base"+c+" character")}return{encode:x,decodeUnsafe:E,decode:M}}var src$1=base$5;const textDecoder$1=new TextDecoder,decodeText$1=r=>textDecoder$1.decode(r),textEncoder$1=new TextEncoder,encodeText$2=r=>textEncoder$1.encode(r);function concat$3(r,e){const t=new Uint8Array(e);let n=0;for(const a of r)t.set(a,n),n+=a.length;return t}var util$2={decodeText:decodeText$1,encodeText:encodeText$2,concat:concat$3};const{encodeText:encodeText$1}=util$2;let Base$1=class{constructor(e,t,n,a){this.name=e,this.code=t,this.codeBuf=encodeText$1(this.code),this.alphabet=a,this.codec=n(a)}encode(e){return this.codec.encode(e)}decode(e){for(const t of e)if(this.alphabet&&this.alphabet.indexOf(t)<0)throw new Error(`invalid character '${t}' in '${e}'`);return this.codec.decode(e)}};var base$4=Base$1;const decode$c=(r,e,t)=>{const n={};for(let _=0;_<e.length;++_)n[e[_]]=_;let a=r.length;for(;r[a-1]==="=";)--a;const o=new Uint8Array(a*t/8|0);let c=0,u=0,v=0;for(let _=0;_<a;++_){const x=n[r[_]];if(x===void 0)throw new SyntaxError("Invalid character "+r[_]);u=u<<t|x,c+=t,c>=8&&(c-=8,o[v++]=255&u>>c)}if(c>=t||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return o},encode$b=(r,e,t)=>{const n=e[e.length-1]==="=",a=(1<<t)-1;let o="",c=0,u=0;for(let v=0;v<r.length;++v)for(u=u<<8|r[v],c+=8;c>t;)c-=t,o+=e[a&u>>c];if(c&&(o+=e[a&u<<t-c]),n)for(;o.length*t&7;)o+="=";return o},rfc4648$2=r=>e=>({encode(t){return encode$b(t,e,r)},decode(t){return decode$c(t,e,r)}});var rfc4648_1={rfc4648:rfc4648$2};const baseX$1=src$1,Base=base$4,{rfc4648:rfc4648$1}=rfc4648_1,{decodeText,encodeText}=util$2,identity$3=()=>({encode:decodeText,decode:encodeText}),constants$1=[["identity","\0",identity$3,""],["base2","0",rfc4648$1(1),"01"],["base8","7",rfc4648$1(3),"01234567"],["base10","9",baseX$1,"0123456789"],["base16","f",rfc4648$1(4),"0123456789abcdef"],["base16upper","F",rfc4648$1(4),"0123456789ABCDEF"],["base32hex","v",rfc4648$1(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",rfc4648$1(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",rfc4648$1(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",rfc4648$1(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",rfc4648$1(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",rfc4648$1(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",rfc4648$1(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",rfc4648$1(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",rfc4648$1(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",baseX$1,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",baseX$1,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",baseX$1,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",baseX$1,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",rfc4648$1(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",rfc4648$1(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",rfc4648$1(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",rfc4648$1(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],names$3=constants$1.reduce((r,e)=>(r[e[0]]=new Base(e[0],e[1],e[2],e[3]),r),{}),codes$1=constants$1.reduce((r,e)=>(r[e[1]]=names$3[e[0]],r),{});var constants_1={names:names$3,codes:codes$1};(function(r,e){const t=constants_1,{encodeText:n,decodeText:a,concat:o}=util$2;function c(D,L){if(!L)throw new Error("requires an encoded Uint8Array");const{name:N,codeBuf:q}=E(D);return x(N,L),o([q,L],q.length+L.length)}function u(D,L){const N=E(D),q=n(N.encode(L));return o([N.codeBuf,q],N.codeBuf.length+q.length)}function v(D){D instanceof Uint8Array&&(D=a(D));const L=D[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(L)&&(D=D.toLowerCase()),E(D[0]).decode(D.substring(1))}function _(D){if(D instanceof Uint8Array&&(D=a(D)),Object.prototype.toString.call(D)!=="[object String]")return!1;try{return E(D[0]).name}catch{return!1}}function x(D,L){E(D).decode(a(L))}function E(D){if(Object.prototype.hasOwnProperty.call(t.names,D))return t.names[D];if(Object.prototype.hasOwnProperty.call(t.codes,D))return t.codes[D];throw new Error(`Unsupported encoding: ${D}`)}function M(D){return D instanceof Uint8Array&&(D=a(D)),E(D[0])}e=r.exports=c,e.encode=u,e.decode=v,e.isEncoded=_,e.encoding=E,e.encodingFromData=M;const C=Object.freeze(t.names),I=Object.freeze(t.codes);e.names=C,e.codes=I})(src$2,src$2.exports);var srcExports=src$2.exports;const SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:t,C:n,D:a,E:o,F:c,G:u,H:v}=this;return[e,t,n,a,o,c,u,v]}set(e,t,n,a,o,c,u,v){this.A=e|0,this.B=t|0,this.C=n|0,this.D=a|0,this.E=o|0,this.F=c|0,this.G=u|0,this.H=v|0}process(e,t){for(let E=0;E<16;E++,t+=4)SHA256_W[E]=e.getUint32(t,!1);for(let E=16;E<64;E++){const M=SHA256_W[E-15],C=SHA256_W[E-2],I=rotr(M,7)^rotr(M,18)^M>>>3,D=rotr(C,17)^rotr(C,19)^C>>>10;SHA256_W[E]=D+SHA256_W[E-7]+I+SHA256_W[E-16]|0}let{A:n,B:a,C:o,D:c,E:u,F:v,G:_,H:x}=this;for(let E=0;E<64;E++){const M=rotr(u,6)^rotr(u,11)^rotr(u,25),C=x+M+Chi(u,v,_)+SHA256_K[E]+SHA256_W[E]|0,D=(rotr(n,2)^rotr(n,13)^rotr(n,22))+Maj(n,a,o)|0;x=_,_=v,v=u,u=c+C|0,c=o,o=a,a=n,n=C+D|0}n=n+this.A|0,a=a+this.B|0,o=o+this.C|0,c=c+this.D|0,u=u+this.E|0,v=v+this.F|0,_=_+this.G|0,x=x+this.H|0,this.set(n,a,o,c,u,v,_,x)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256$4=wrapConstructor$1(()=>new SHA256),Rho=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Id=new Uint8Array(new Array(16).fill(0).map((r,e)=>e)),Pi=Id.map(r=>(9*r+5)%16);let idxL=[Id],idxR=[Pi];for(let r=0;r<4;r++)for(let e of[idxL,idxR])e.push(e[r].map(t=>Rho[t]));const shifts=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(r=>new Uint8Array(r)),shiftsL=idxL.map((r,e)=>r.map(t=>shifts[e][t])),shiftsR=idxR.map((r,e)=>r.map(t=>shifts[e][t])),Kl=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),Kr=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]);function f(r,e,t,n){return r===0?e^t^n:r===1?e&t|~e&n:r===2?(e|~t)^n:r===3?e&n|t&~n:e^(t|~n)}const R_BUF=new Uint32Array(16);class RIPEMD160 extends HashMD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:n,h3:a,h4:o}=this;return[e,t,n,a,o]}set(e,t,n,a,o){this.h0=e|0,this.h1=t|0,this.h2=n|0,this.h3=a|0,this.h4=o|0}process(e,t){for(let C=0;C<16;C++,t+=4)R_BUF[C]=e.getUint32(t,!0);let n=this.h0|0,a=n,o=this.h1|0,c=o,u=this.h2|0,v=u,_=this.h3|0,x=_,E=this.h4|0,M=E;for(let C=0;C<5;C++){const I=4-C,D=Kl[C],L=Kr[C],N=idxL[C],q=idxR[C],F=shiftsL[C],U=shiftsR[C];for(let j=0;j<16;j++){const W=rotl$2(n+f(C,o,u,_)+R_BUF[N[j]]+D,F[j])+E|0;n=E,E=_,_=rotl$2(u,10)|0,u=o,o=W}for(let j=0;j<16;j++){const W=rotl$2(a+f(I,c,v,x)+R_BUF[q[j]]+L,U[j])+M|0;a=M,M=x,x=rotl$2(v,10)|0,v=c,c=W}}this.set(this.h1+u+x|0,this.h2+_+M|0,this.h3+E+a|0,this.h4+n+c|0,this.h0+o+v|0)}roundClean(){R_BUF.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const ripemd160$1=wrapConstructor$1(()=>new RIPEMD160),SHA3_PI$1=[],SHA3_ROTL$1=[],_SHA3_IOTA$1=[],_0n$2=BigInt(0),_1n$3=BigInt(1),_2n$2=BigInt(2),_7n$1=BigInt(7),_256n$1=BigInt(256),_0x71n$1=BigInt(113);for(let r=0,e=_1n$3,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],SHA3_PI$1.push(2*(5*n+t)),SHA3_ROTL$1.push((r+1)*(r+2)/2%64);let a=_0n$2;for(let o=0;o<7;o++)e=(e<<_1n$3^(e>>_7n$1)*_0x71n$1)%_256n$1,e&_2n$2&&(a^=_1n$3<<(_1n$3<<BigInt(o))-_1n$3);_SHA3_IOTA$1.push(a)}const[SHA3_IOTA_H$1,SHA3_IOTA_L$1]=split$1(_SHA3_IOTA$1,!0),rotlH$1=(r,e,t)=>t>32?rotlBH$1(r,e,t):rotlSH$1(r,e,t),rotlL$1=(r,e,t)=>t>32?rotlBL$1(r,e,t):rotlSL$1(r,e,t);function keccakP$1(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let c=0;c<10;c++)t[c]=r[c]^r[c+10]^r[c+20]^r[c+30]^r[c+40];for(let c=0;c<10;c+=2){const u=(c+8)%10,v=(c+2)%10,_=t[v],x=t[v+1],E=rotlH$1(_,x,1)^t[u],M=rotlL$1(_,x,1)^t[u+1];for(let C=0;C<50;C+=10)r[c+C]^=E,r[c+C+1]^=M}let a=r[2],o=r[3];for(let c=0;c<24;c++){const u=SHA3_ROTL$1[c],v=rotlH$1(a,o,u),_=rotlL$1(a,o,u),x=SHA3_PI$1[c];a=r[x],o=r[x+1],r[x]=v,r[x+1]=_}for(let c=0;c<50;c+=10){for(let u=0;u<10;u++)t[u]=r[c+u];for(let u=0;u<10;u++)r[c+u]^=~t[(u+2)%10]&t[(u+4)%10]}r[0]^=SHA3_IOTA_H$1[n],r[1]^=SHA3_IOTA_L$1[n]}t.fill(0)}let Keccak$1=class Et extends Hash$1{constructor(e,t,n,a=!1,o=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=a,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,anumber$1(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=u32$3(this.state)}keccak(){isLE$3||byteSwap32(this.state32),keccakP$1(this.state32,this.rounds),isLE$3||byteSwap32(this.state32),this.posOut=0,this.pos=0}update(e){aexists(this);const{blockLen:t,state:n}=this;e=toBytes$5(e);const a=e.length;for(let o=0;o<a;){const c=Math.min(t-this.pos,a-o);for(let u=0;u<c;u++)n[this.pos++]^=e[o++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:a}=this;e[n]^=t,t&128&&n===a-1&&this.keccak(),e[a-1]^=128,this.keccak()}writeInto(e){aexists(this,!1),abytes$1(e),this.finish();const t=this.state,{blockLen:n}=this;for(let a=0,o=e.length;a<o;){this.posOut>=n&&this.keccak();const c=Math.min(n-this.posOut,o-a);e.set(t.subarray(this.posOut,this.posOut+c),a),this.posOut+=c,a+=c}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return anumber$1(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(aoutput(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:a,rounds:o,enableXOF:c}=this;return e||(e=new Et(t,n,a,c,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=n,e.outputLen=a,e.enableXOF=c,e.destroyed=this.destroyed,e}};const gen$1=(r,e,t)=>wrapConstructor$1(()=>new Keccak$1(e,r,t)),keccak_256$1=gen$1(1,136,256/8);class HMAC extends Hash$1{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ahash(e);const n=toBytes$5(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const a=this.blockLen,o=new Uint8Array(a);o.set(n.length>a?e.create().update(n).digest():n);for(let c=0;c<o.length;c++)o[c]^=54;this.iHash.update(o),this.oHash=e.create();for(let c=0;c<o.length;c++)o[c]^=106;this.oHash.update(o),o.fill(0)}update(e){return aexists(this),this.iHash.update(e),this}digestInto(e){aexists(this),abytes$1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:a,destroyed:o,blockLen:c,outputLen:u}=this;return e=e,e.finished=a,e.destroyed=o,e.blockLen=c,e.outputLen=u,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac$1=(r,e,t)=>new HMAC(r,e).update(t).digest();hmac$1.create=(r,e)=>new HMAC(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validateSigVerOpts(r){r.lowS!==void 0&&abool("lowS",r.lowS),r.prehash!==void 0&&abool("prehash",r.prehash)}function validatePointOpts(r){const e=validateBasic(r);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a}=e;if(t){if(!n.eql(a,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n$1,hexToBytes:h2b}=ut;class DERErr extends Error{constructor(e=""){super(e)}}const DER={Err:DERErr,_tlv:{encode:(r,e)=>{const{Err:t}=DER;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,a=numberToHexUnpadded(n);if(a.length/2&128)throw new t("tlv.encode: long form length too big");const o=n>127?numberToHexUnpadded(a.length/2|128):"";return numberToHexUnpadded(r)+o+a+e},decode(r,e){const{Err:t}=DER;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const a=e[n++],o=!!(a&128);let c=0;if(!o)c=a;else{const v=a&127;if(!v)throw new t("tlv.decode(long): indefinite length not supported");if(v>4)throw new t("tlv.decode(long): byte length is too big");const _=e.subarray(n,n+v);if(_.length!==v)throw new t("tlv.decode: length bytes not complete");if(_[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const x of _)c=c<<8|x;if(n+=v,c<128)throw new t("tlv.decode(long): not minimal encoding")}const u=e.subarray(n,n+c);if(u.length!==c)throw new t("tlv.decode: wrong value length");return{v:u,l:e.subarray(n+c)}}},_int:{encode(r){const{Err:e}=DER;if(r<_0n$1)throw new e("integer: negative integers are not allowed");let t=numberToHexUnpadded(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=DER;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return b2n$1(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=DER,a=typeof r=="string"?h2b(r):r;abytes(a);const{v:o,l:c}=n.decode(48,a);if(c.length)throw new e("invalid signature: left bytes after parsing");const{v:u,l:v}=n.decode(2,o),{v:_,l:x}=n.decode(2,v);if(x.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(u),s:t.decode(_)}},hexFromSig(r){const{_tlv:e,_int:t}=DER,n=e.encode(2,t.encode(r.r)),a=e.encode(2,t.encode(r.s)),o=n+a;return e.encode(48,o)}},_0n$1=BigInt(0),_1n$2=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(r){const e=validatePointOpts(r),{Fp:t}=e,n=Field(e.n,e.nBitLength),a=e.toBytes||((D,L,N)=>{const q=L.toAffine();return concatBytes(Uint8Array.from([4]),t.toBytes(q.x),t.toBytes(q.y))}),o=e.fromBytes||(D=>{const L=D.subarray(1),N=t.fromBytes(L.subarray(0,t.BYTES)),q=t.fromBytes(L.subarray(t.BYTES,2*t.BYTES));return{x:N,y:q}});function c(D){const{a:L,b:N}=e,q=t.sqr(D),F=t.mul(q,D);return t.add(t.add(F,t.mul(D,L)),N)}if(!t.eql(t.sqr(e.Gy),c(e.Gx)))throw new Error("bad generator point: equation left != right");function u(D){return inRange$2(D,_1n$2,e.n)}function v(D){const{allowedPrivateKeyLengths:L,nByteLength:N,wrapPrivateKey:q,n:F}=e;if(L&&typeof D!="bigint"){if(isBytes$4(D)&&(D=bytesToHex$1(D)),typeof D!="string"||!L.includes(D.length))throw new Error("invalid private key");D=D.padStart(N*2,"0")}let U;try{U=typeof D=="bigint"?D:bytesToNumberBE(ensureBytes$1("private key",D,N))}catch{throw new Error("invalid private key, expected hex or "+N+" bytes, got "+typeof D)}return q&&(U=mod(U,F)),aInRange("private key",U,_1n$2,F),U}function _(D){if(!(D instanceof M))throw new Error("ProjectivePoint expected")}const x=memoized((D,L)=>{const{px:N,py:q,pz:F}=D;if(t.eql(F,t.ONE))return{x:N,y:q};const U=D.is0();L==null&&(L=U?t.ONE:t.inv(F));const j=t.mul(N,L),W=t.mul(q,L),X=t.mul(F,L);if(U)return{x:t.ZERO,y:t.ZERO};if(!t.eql(X,t.ONE))throw new Error("invZ was invalid");return{x:j,y:W}}),E=memoized(D=>{if(D.is0()){if(e.allowInfinityPoint&&!t.is0(D.py))return;throw new Error("bad point: ZERO")}const{x:L,y:N}=D.toAffine();if(!t.isValid(L)||!t.isValid(N))throw new Error("bad point: x or y not FE");const q=t.sqr(N),F=c(L);if(!t.eql(q,F))throw new Error("bad point: equation left != right");if(!D.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class M{constructor(L,N,q){if(this.px=L,this.py=N,this.pz=q,L==null||!t.isValid(L))throw new Error("x required");if(N==null||!t.isValid(N))throw new Error("y required");if(q==null||!t.isValid(q))throw new Error("z required");Object.freeze(this)}static fromAffine(L){const{x:N,y:q}=L||{};if(!L||!t.isValid(N)||!t.isValid(q))throw new Error("invalid affine point");if(L instanceof M)throw new Error("projective point not allowed");const F=U=>t.eql(U,t.ZERO);return F(N)&&F(q)?M.ZERO:new M(N,q,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(L){const N=t.invertBatch(L.map(q=>q.pz));return L.map((q,F)=>q.toAffine(N[F])).map(M.fromAffine)}static fromHex(L){const N=M.fromAffine(o(ensureBytes$1("pointHex",L)));return N.assertValidity(),N}static fromPrivateKey(L){return M.BASE.multiply(v(L))}static msm(L,N){return pippenger(M,n,L,N)}_setWindowSize(L){I.setWindowSize(this,L)}assertValidity(){E(this)}hasEvenY(){const{y:L}=this.toAffine();if(t.isOdd)return!t.isOdd(L);throw new Error("Field doesn't support isOdd")}equals(L){_(L);const{px:N,py:q,pz:F}=this,{px:U,py:j,pz:W}=L,X=t.eql(t.mul(N,W),t.mul(U,F)),J=t.eql(t.mul(q,W),t.mul(j,F));return X&&J}negate(){return new M(this.px,t.neg(this.py),this.pz)}double(){const{a:L,b:N}=e,q=t.mul(N,_3n),{px:F,py:U,pz:j}=this;let W=t.ZERO,X=t.ZERO,J=t.ZERO,G=t.mul(F,F),oe=t.mul(U,U),O=t.mul(j,j),l=t.mul(F,U);return l=t.add(l,l),J=t.mul(F,j),J=t.add(J,J),W=t.mul(L,J),X=t.mul(q,O),X=t.add(W,X),W=t.sub(oe,X),X=t.add(oe,X),X=t.mul(W,X),W=t.mul(l,W),J=t.mul(q,J),O=t.mul(L,O),l=t.sub(G,O),l=t.mul(L,l),l=t.add(l,J),J=t.add(G,G),G=t.add(J,G),G=t.add(G,O),G=t.mul(G,l),X=t.add(X,G),O=t.mul(U,j),O=t.add(O,O),G=t.mul(O,l),W=t.sub(W,G),J=t.mul(O,oe),J=t.add(J,J),J=t.add(J,J),new M(W,X,J)}add(L){_(L);const{px:N,py:q,pz:F}=this,{px:U,py:j,pz:W}=L;let X=t.ZERO,J=t.ZERO,G=t.ZERO;const oe=e.a,O=t.mul(e.b,_3n);let l=t.mul(N,U),p=t.mul(q,j),b=t.mul(F,W),S=t.add(N,q),T=t.add(U,j);S=t.mul(S,T),T=t.add(l,p),S=t.sub(S,T),T=t.add(N,F);let B=t.add(U,W);return T=t.mul(T,B),B=t.add(l,b),T=t.sub(T,B),B=t.add(q,F),X=t.add(j,W),B=t.mul(B,X),X=t.add(p,b),B=t.sub(B,X),G=t.mul(oe,T),X=t.mul(O,b),G=t.add(X,G),X=t.sub(p,G),G=t.add(p,G),J=t.mul(X,G),p=t.add(l,l),p=t.add(p,l),b=t.mul(oe,b),T=t.mul(O,T),p=t.add(p,b),b=t.sub(l,b),b=t.mul(oe,b),T=t.add(T,b),l=t.mul(p,T),J=t.add(J,l),l=t.mul(B,T),X=t.mul(S,X),X=t.sub(X,l),l=t.mul(S,p),G=t.mul(B,G),G=t.add(G,l),new M(X,J,G)}subtract(L){return this.add(L.negate())}is0(){return this.equals(M.ZERO)}wNAF(L){return I.wNAFCached(this,L,M.normalizeZ)}multiplyUnsafe(L){const{endo:N,n:q}=e;aInRange("scalar",L,_0n$1,q);const F=M.ZERO;if(L===_0n$1)return F;if(this.is0()||L===_1n$2)return this;if(!N||I.hasPrecomputes(this))return I.wNAFCachedUnsafe(this,L,M.normalizeZ);let{k1neg:U,k1:j,k2neg:W,k2:X}=N.splitScalar(L),J=F,G=F,oe=this;for(;j>_0n$1||X>_0n$1;)j&_1n$2&&(J=J.add(oe)),X&_1n$2&&(G=G.add(oe)),oe=oe.double(),j>>=_1n$2,X>>=_1n$2;return U&&(J=J.negate()),W&&(G=G.negate()),G=new M(t.mul(G.px,N.beta),G.py,G.pz),J.add(G)}multiply(L){const{endo:N,n:q}=e;aInRange("scalar",L,_1n$2,q);let F,U;if(N){const{k1neg:j,k1:W,k2neg:X,k2:J}=N.splitScalar(L);let{p:G,f:oe}=this.wNAF(W),{p:O,f:l}=this.wNAF(J);G=I.constTimeNegate(j,G),O=I.constTimeNegate(X,O),O=new M(t.mul(O.px,N.beta),O.py,O.pz),F=G.add(O),U=oe.add(l)}else{const{p:j,f:W}=this.wNAF(L);F=j,U=W}return M.normalizeZ([F,U])[0]}multiplyAndAddUnsafe(L,N,q){const F=M.BASE,U=(W,X)=>X===_0n$1||X===_1n$2||!W.equals(F)?W.multiplyUnsafe(X):W.multiply(X),j=U(this,N).add(U(L,q));return j.is0()?void 0:j}toAffine(L){return x(this,L)}isTorsionFree(){const{h:L,isTorsionFree:N}=e;if(L===_1n$2)return!0;if(N)return N(M,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:L,clearCofactor:N}=e;return L===_1n$2?this:N?N(M,this):this.multiplyUnsafe(e.h)}toRawBytes(L=!0){return abool("isCompressed",L),this.assertValidity(),a(M,this,L)}toHex(L=!0){return abool("isCompressed",L),bytesToHex$1(this.toRawBytes(L))}}M.BASE=new M(e.Gx,e.Gy,t.ONE),M.ZERO=new M(t.ZERO,t.ONE,t.ZERO);const C=e.nBitLength,I=wNAF(M,e.endo?Math.ceil(C/2):C);return{CURVE:e,ProjectivePoint:M,normPrivateKeyToScalar:v,weierstrassEquation:c,isWithinCurveOrder:u}}function validateOpts(r){const e=validateBasic(r);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass(r){const e=validateOpts(r),{Fp:t,n}=e,a=t.BYTES+1,o=2*t.BYTES+1;function c(b){return mod(b,n)}function u(b){return invert(b,n)}const{ProjectivePoint:v,normPrivateKeyToScalar:_,weierstrassEquation:x,isWithinCurveOrder:E}=weierstrassPoints({...e,toBytes(b,S,T){const B=S.toAffine(),$=t.toBytes(B.x),A=concatBytes;return abool("isCompressed",T),T?A(Uint8Array.from([S.hasEvenY()?2:3]),$):A(Uint8Array.from([4]),$,t.toBytes(B.y))},fromBytes(b){const S=b.length,T=b[0],B=b.subarray(1);if(S===a&&(T===2||T===3)){const $=bytesToNumberBE(B);if(!inRange$2($,_1n$2,t.ORDER))throw new Error("Point is not on curve");const A=x($);let g;try{g=t.sqrt(A)}catch(z){const Q=z instanceof Error?": "+z.message:"";throw new Error("Point is not on curve"+Q)}const k=(g&_1n$2)===_1n$2;return(T&1)===1!==k&&(g=t.neg(g)),{x:$,y:g}}else if(S===o&&T===4){const $=t.fromBytes(B.subarray(0,t.BYTES)),A=t.fromBytes(B.subarray(t.BYTES,2*t.BYTES));return{x:$,y:A}}else{const $=a,A=o;throw new Error("invalid Point, expected length of "+$+", or uncompressed "+A+", got "+S)}}}),M=b=>bytesToHex$1(numberToBytesBE(b,e.nByteLength));function C(b){const S=n>>_1n$2;return b>S}function I(b){return C(b)?c(-b):b}const D=(b,S,T)=>bytesToNumberBE(b.slice(S,T));class L{constructor(S,T,B){this.r=S,this.s=T,this.recovery=B,this.assertValidity()}static fromCompact(S){const T=e.nByteLength;return S=ensureBytes$1("compactSignature",S,T*2),new L(D(S,0,T),D(S,T,2*T))}static fromDER(S){const{r:T,s:B}=DER.toSig(ensureBytes$1("DER",S));return new L(T,B)}assertValidity(){aInRange("r",this.r,_1n$2,n),aInRange("s",this.s,_1n$2,n)}addRecoveryBit(S){return new L(this.r,this.s,S)}recoverPublicKey(S){const{r:T,s:B,recovery:$}=this,A=W(ensureBytes$1("msgHash",S));if($==null||![0,1,2,3].includes($))throw new Error("recovery id invalid");const g=$===2||$===3?T+e.n:T;if(g>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const k=$&1?"03":"02",H=v.fromHex(k+M(g)),z=u(g),Q=c(-A*z),ie=c(B*z),ne=v.BASE.multiplyAndAddUnsafe(H,Q,ie);if(!ne)throw new Error("point at infinify");return ne.assertValidity(),ne}hasHighS(){return C(this.s)}normalizeS(){return this.hasHighS()?new L(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$2(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$2(this.toCompactHex())}toCompactHex(){return M(this.r)+M(this.s)}}const N={isValidPrivateKey(b){try{return _(b),!0}catch{return!1}},normPrivateKeyToScalar:_,randomPrivateKey:()=>{const b=getMinHashLength(e.n);return mapHashToField(e.randomBytes(b),e.n)},precompute(b=8,S=v.BASE){return S._setWindowSize(b),S.multiply(BigInt(3)),S}};function q(b,S=!0){return v.fromPrivateKey(b).toRawBytes(S)}function F(b){const S=isBytes$4(b),T=typeof b=="string",B=(S||T)&&b.length;return S?B===a||B===o:T?B===2*a||B===2*o:b instanceof v}function U(b,S,T=!0){if(F(b))throw new Error("first arg must be private key");if(!F(S))throw new Error("second arg must be public key");return v.fromHex(S).multiply(_(b)).toRawBytes(T)}const j=e.bits2int||function(b){if(b.length>8192)throw new Error("input is too large");const S=bytesToNumberBE(b),T=b.length*8-e.nBitLength;return T>0?S>>BigInt(T):S},W=e.bits2int_modN||function(b){return c(j(b))},X=bitMask(e.nBitLength);function J(b){return aInRange("num < 2^"+e.nBitLength,b,_0n$1,X),numberToBytesBE(b,e.nByteLength)}function G(b,S,T=oe){if(["recovered","canonical"].some(se=>se in T))throw new Error("sign() legacy options not supported");const{hash:B,randomBytes:$}=e;let{lowS:A,prehash:g,extraEntropy:k}=T;A==null&&(A=!0),b=ensureBytes$1("msgHash",b),validateSigVerOpts(T),g&&(b=ensureBytes$1("prehashed msgHash",B(b)));const H=W(b),z=_(S),Q=[J(z),J(H)];if(k!=null&&k!==!1){const se=k===!0?$(t.BYTES):k;Q.push(ensureBytes$1("extraEntropy",se))}const ie=concatBytes(...Q),ne=H;function Z(se){const ae=j(se);if(!E(ae))return;const ce=u(ae),le=v.BASE.multiply(ae).toAffine(),te=c(le.x);if(te===_0n$1)return;const he=c(ce*c(ne+te*z));if(he===_0n$1)return;let Ae=(le.x===te?0:2)|Number(le.y&_1n$2),ge=he;return A&&C(he)&&(ge=I(he),Ae^=1),new L(te,ge,Ae)}return{seed:ie,k2sig:Z}}const oe={lowS:e.lowS,prehash:!1},O={lowS:e.lowS,prehash:!1};function l(b,S,T=oe){const{seed:B,k2sig:$}=G(b,S,T),A=e;return createHmacDrbg(A.hash.outputLen,A.nByteLength,A.hmac)(B,$)}v.BASE._setWindowSize(8);function p(b,S,T,B=O){const $=b;S=ensureBytes$1("msgHash",S),T=ensureBytes$1("publicKey",T);const{lowS:A,prehash:g,format:k}=B;if(validateSigVerOpts(B),"strict"in B)throw new Error("options.strict was renamed to lowS");if(k!==void 0&&k!=="compact"&&k!=="der")throw new Error("format must be compact or der");const H=typeof $=="string"||isBytes$4($),z=!H&&!k&&typeof $=="object"&&$!==null&&typeof $.r=="bigint"&&typeof $.s=="bigint";if(!H&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Q,ie;try{if(z&&(Q=new L($.r,$.s)),H){try{k!=="compact"&&(Q=L.fromDER($))}catch(Ae){if(!(Ae instanceof DER.Err))throw Ae}!Q&&k!=="der"&&(Q=L.fromCompact($))}ie=v.fromHex(T)}catch{return!1}if(!Q||A&&Q.hasHighS())return!1;g&&(S=e.hash(S));const{r:ne,s:Z}=Q,se=W(S),ae=u(Z),ce=c(se*ae),le=c(ne*ae),te=v.BASE.multiplyAndAddUnsafe(ie,ce,le)?.toAffine();return te?c(te.x)===ne:!1}return{CURVE:e,getPublicKey:q,getSharedSecret:U,sign:l,verify:p,ProjectivePoint:v,Signature:L,utils:N}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(r){return{hash:r,hmac:(e,...t)=>hmac$1(r,e,concatBytes$1(...t)),randomBytes:randomBytes$1}}function createCurve(r,e){const t=n=>weierstrass({...r,...getHash(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$1=BigInt(1),_2n$1=BigInt(2),divNearest=(r,e)=>(r+e/_2n$1)/e;function sqrtMod(r){const e=secp256k1P,t=BigInt(3),n=BigInt(6),a=BigInt(11),o=BigInt(22),c=BigInt(23),u=BigInt(44),v=BigInt(88),_=r*r*r%e,x=_*_*r%e,E=pow2(x,t,e)*x%e,M=pow2(E,t,e)*x%e,C=pow2(M,_2n$1,e)*_%e,I=pow2(C,a,e)*C%e,D=pow2(I,o,e)*I%e,L=pow2(D,u,e)*D%e,N=pow2(L,v,e)*L%e,q=pow2(N,u,e)*D%e,F=pow2(q,t,e)*x%e,U=pow2(F,c,e)*I%e,j=pow2(U,n,e)*_%e,W=pow2(j,_2n$1,e);if(!Fpk1.eql(Fpk1.sqr(W),r))throw new Error("Cannot find square root");return W}const Fpk1=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1$2=createCurve({a:BigInt(0),b:BigInt(7),Fp:Fpk1,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=secp256k1N,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-_1n$1*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=t,c=BigInt("0x100000000000000000000000000000000"),u=divNearest(o*r,e),v=divNearest(-n*r,e);let _=mod(r-u*t-v*a,e),x=mod(-u*n-v*o,e);const E=_>c,M=x>c;if(E&&(_=e-_),M&&(x=e-x),_>c||x>c)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:E,k1:_,k2neg:M,k2:x}}}},sha256$4);BigInt(0);secp256k1$2.ProjectivePoint;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fp256=Field(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),CURVE_A$1=Fp256.create(BigInt("-3")),CURVE_B$1=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),p256=createCurve({a:CURVE_A$1,b:CURVE_B$1,Fp:Fp256,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},sha256$4);var canonicalize=function r(e){if(typeof e=="number"&&isNaN(e))throw new Error("NaN is not allowed");if(typeof e=="number"&&!isFinite(e))throw new Error("Infinity is not allowed");return e===null||typeof e!="object"?JSON.stringify(e):e.toJSON instanceof Function?r(e.toJSON()):Array.isArray(e)?`[${e.reduce((a,o,c)=>`${a}${c===0?"":","}${r(o===void 0||typeof o=="symbol"?null:o)}`,"")}]`:`{${Object.keys(e).sort().reduce((n,a)=>{if(e[a]===void 0||typeof e[a]=="symbol")return n;const o=n.length===0?"":",";return`${n}${o}${r(a)}:${r(e[a])}`},"")}}`};const canonicalizeData=getDefaultExportFromCjs(canonicalize);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$3(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function isArrayOf(r,e){return Array.isArray(e)?e.length===0?!0:r?e.every(t=>typeof t=="string"):e.every(t=>Number.isSafeInteger(t)):!1}function afn(r){if(typeof r!="function")throw new Error("function expected");return!0}function astr(r,e){if(typeof e!="string")throw new Error(`${r}: string expected`);return!0}function anumber(r){if(!Number.isSafeInteger(r))throw new Error(`invalid integer: ${r}`)}function aArr(r){if(!Array.isArray(r))throw new Error("array expected")}function astrArr(r,e){if(!isArrayOf(!0,e))throw new Error(`${r}: array of strings expected`)}function anumArr(r,e){if(!isArrayOf(!1,e))throw new Error(`${r}: array of numbers expected`)}function chain(...r){const e=o=>o,t=(o,c)=>u=>o(c(u)),n=r.map(o=>o.encode).reduceRight(t,e),a=r.map(o=>o.decode).reduce(t,e);return{encode:n,decode:a}}function alphabet$1(r){const e=typeof r=="string"?r.split(""):r,t=e.length;astrArr("alphabet",e);const n=new Map(e.map((a,o)=>[a,o]));return{encode:a=>(aArr(a),a.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${r}`);return e[o]})),decode:a=>(aArr(a),a.map(o=>{astr("alphabet.decode",o);const c=n.get(o);if(c===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${r}`);return c}))}}function join$1(r=""){return astr("join",r),{encode:e=>(astrArr("join.decode",e),e.join(r)),decode:e=>(astr("join.decode",e),e.split(r))}}const gcd=(r,e)=>e===0?r:gcd(e,r%e),radix2carry=(r,e)=>r+(e-gcd(r,e)),powers=(()=>{let r=[];for(let e=0;e<40;e++)r.push(2**e);return r})();function convertRadix2(r,e,t,n){if(aArr(r),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(radix2carry(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${radix2carry(e,t)}`);let a=0,o=0;const c=powers[e],u=powers[t]-1,v=[];for(const _ of r){if(anumber(_),_>=c)throw new Error(`convertRadix2: invalid data word=${_} from=${e}`);if(a=a<<e|_,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=t;o-=t)v.push((a>>o-t&u)>>>0);const x=powers[o];if(x===void 0)throw new Error("invalid carry");a&=x-1}if(a=a<<t-o&u,!n&&o>=e)throw new Error("Excess padding");if(!n&&a>0)throw new Error(`Non-zero padding: ${a}`);return n&&o>0&&v.push(a>>>0),v}function radix2(r,e=!1){if(anumber(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,r)>32||radix2carry(r,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!isBytes$3(t))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(t),8,r,!e)},decode:t=>(anumArr("radix2.decode",t),Uint8Array.from(convertRadix2(t,r,8,e)))}}function unsafeWrapper(r){return afn(r),function(...e){try{return r.apply(null,e)}catch{}}}const BECH_ALPHABET=chain(alphabet$1("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join$1("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(r){const e=r>>25;let t=(r&33554431)<<5;for(let n=0;n<POLYMOD_GENERATORS.length;n++)(e>>n&1)===1&&(t^=POLYMOD_GENERATORS[n]);return t}function bechChecksum(r,e,t=1){const n=r.length;let a=1;for(let o=0;o<n;o++){const c=r.charCodeAt(o);if(c<33||c>126)throw new Error(`Invalid prefix (${r})`);a=bech32Polymod(a)^c>>5}a=bech32Polymod(a);for(let o=0;o<n;o++)a=bech32Polymod(a)^r.charCodeAt(o)&31;for(let o of e)a=bech32Polymod(a)^o;for(let o=0;o<6;o++)a=bech32Polymod(a);return a^=t,BECH_ALPHABET.encode(convertRadix2([a%powers[30]],30,5,!1))}function genBech32(r){const e=r==="bech32"?1:734539939,t=radix2(5),n=t.decode,a=t.encode,o=unsafeWrapper(n);function c(E,M,C=90){astr("bech32.encode prefix",E),isBytes$3(M)&&(M=Array.from(M)),anumArr("bech32.encode",M);const I=E.length;if(I===0)throw new TypeError(`Invalid prefix length ${I}`);const D=I+7+M.length;if(C!==!1&&D>C)throw new TypeError(`Length ${D} exceeds limit ${C}`);const L=E.toLowerCase(),N=bechChecksum(L,M,e);return`${L}1${BECH_ALPHABET.encode(M)}${N}`}function u(E,M=90){astr("bech32.decode input",E);const C=E.length;if(C<8||M!==!1&&C>M)throw new TypeError(`invalid string length: ${C} (${E}). Expected (8..${M})`);const I=E.toLowerCase();if(E!==I&&E!==E.toUpperCase())throw new Error("String must be lowercase or uppercase");const D=I.lastIndexOf("1");if(D===0||D===-1)throw new Error('Letter "1" must be present between prefix and data only');const L=I.slice(0,D),N=I.slice(D+1);if(N.length<6)throw new Error("Data must be at least 6 characters long");const q=BECH_ALPHABET.decode(N).slice(0,-6),F=bechChecksum(L,q,e);if(!N.endsWith(F))throw new Error(`Invalid checksum in ${E}: expected "${F}"`);return{prefix:L,words:q}}const v=unsafeWrapper(u);function _(E){const{prefix:M,words:C}=u(E,!1);return{prefix:M,words:C,bytes:n(C)}}function x(E,M){return c(E,a(M))}return{encode:c,decode:u,encodeFromBytes:x,decodeToBytes:_,decodeUnsafe:v,fromWords:n,fromWordsUnsafe:o,toWords:a}}const bech32=genBech32("bech32");/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32$2=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4));function isBytes$2(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}const createView$1=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$3(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$4(r){if(typeof r=="string")r=utf8ToBytes$3(r);else if(isBytes$2(r))r=r.slice();else throw new Error(`expected Uint8Array, got ${typeof r}`);return r}const isPlainObject=r=>Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object;function checkOpts$1(r,e){if(e!==void 0&&(typeof e!="object"||!isPlainObject(e)))throw new Error("options must be object or undefined");return Object.assign(r,e)}function ensureBytes(r,e){if(!isBytes$2(r))throw new Error("Uint8Array expected");if(typeof e=="number"&&r.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function equalBytes$1(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const wrapCipher$1=(r,e)=>(Object.assign(e,r),e);function setBigUint64$1(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const a=BigInt(32),o=BigInt(4294967295),c=Number(t>>a&o),u=Number(t&o),v=4,_=0;r.setUint32(e+v,c,n),r.setUint32(e+_,u,n)}function number$3(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`wrong positive integer: ${r}`)}function bool$1(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function isBytes$1(r){return r!=null&&typeof r=="object"&&(r instanceof Uint8Array||r.constructor.name==="Uint8Array")}function bytes$2(r,...e){if(!isBytes$1(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function exists$2(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function output$2(r,e){bytes$2(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const u8to16$1=(r,e)=>r[e++]&255|(r[e++]&255)<<8;let Poly1305$1=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes$4(e),ensureBytes(e,32);const t=u8to16$1(e,0),n=u8to16$1(e,2),a=u8to16$1(e,4),o=u8to16$1(e,6),c=u8to16$1(e,8),u=u8to16$1(e,10),v=u8to16$1(e,12),_=u8to16$1(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|a<<6)&7939,this.r[3]=(a>>>7|o<<9)&8191,this.r[4]=(o>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|u<<2)&8191,this.r[7]=(u>>>11|v<<5)&8065,this.r[8]=(v>>>8|_<<8)&8191,this.r[9]=_>>>5&127;for(let x=0;x<8;x++)this.pad[x]=u8to16$1(e,16+2*x)}process(e,t,n=!1){const a=n?0:2048,{h:o,r:c}=this,u=c[0],v=c[1],_=c[2],x=c[3],E=c[4],M=c[5],C=c[6],I=c[7],D=c[8],L=c[9],N=u8to16$1(e,t+0),q=u8to16$1(e,t+2),F=u8to16$1(e,t+4),U=u8to16$1(e,t+6),j=u8to16$1(e,t+8),W=u8to16$1(e,t+10),X=u8to16$1(e,t+12),J=u8to16$1(e,t+14);let G=o[0]+(N&8191),oe=o[1]+((N>>>13|q<<3)&8191),O=o[2]+((q>>>10|F<<6)&8191),l=o[3]+((F>>>7|U<<9)&8191),p=o[4]+((U>>>4|j<<12)&8191),b=o[5]+(j>>>1&8191),S=o[6]+((j>>>14|W<<2)&8191),T=o[7]+((W>>>11|X<<5)&8191),B=o[8]+((X>>>8|J<<8)&8191),$=o[9]+(J>>>5|a),A=0,g=A+G*u+oe*(5*L)+O*(5*D)+l*(5*I)+p*(5*C);A=g>>>13,g&=8191,g+=b*(5*M)+S*(5*E)+T*(5*x)+B*(5*_)+$*(5*v),A+=g>>>13,g&=8191;let k=A+G*v+oe*u+O*(5*L)+l*(5*D)+p*(5*I);A=k>>>13,k&=8191,k+=b*(5*C)+S*(5*M)+T*(5*E)+B*(5*x)+$*(5*_),A+=k>>>13,k&=8191;let H=A+G*_+oe*v+O*u+l*(5*L)+p*(5*D);A=H>>>13,H&=8191,H+=b*(5*I)+S*(5*C)+T*(5*M)+B*(5*E)+$*(5*x),A+=H>>>13,H&=8191;let z=A+G*x+oe*_+O*v+l*u+p*(5*L);A=z>>>13,z&=8191,z+=b*(5*D)+S*(5*I)+T*(5*C)+B*(5*M)+$*(5*E),A+=z>>>13,z&=8191;let Q=A+G*E+oe*x+O*_+l*v+p*u;A=Q>>>13,Q&=8191,Q+=b*(5*L)+S*(5*D)+T*(5*I)+B*(5*C)+$*(5*M),A+=Q>>>13,Q&=8191;let ie=A+G*M+oe*E+O*x+l*_+p*v;A=ie>>>13,ie&=8191,ie+=b*u+S*(5*L)+T*(5*D)+B*(5*I)+$*(5*C),A+=ie>>>13,ie&=8191;let ne=A+G*C+oe*M+O*E+l*x+p*_;A=ne>>>13,ne&=8191,ne+=b*v+S*u+T*(5*L)+B*(5*D)+$*(5*I),A+=ne>>>13,ne&=8191;let Z=A+G*I+oe*C+O*M+l*E+p*x;A=Z>>>13,Z&=8191,Z+=b*_+S*v+T*u+B*(5*L)+$*(5*D),A+=Z>>>13,Z&=8191;let se=A+G*D+oe*I+O*C+l*M+p*E;A=se>>>13,se&=8191,se+=b*x+S*_+T*v+B*u+$*(5*L),A+=se>>>13,se&=8191;let ae=A+G*L+oe*D+O*I+l*C+p*M;A=ae>>>13,ae&=8191,ae+=b*E+S*x+T*_+B*v+$*u,A+=ae>>>13,ae&=8191,A=(A<<2)+A|0,A=A+g|0,g=A&8191,A=A>>>13,k+=A,o[0]=g,o[1]=k,o[2]=H,o[3]=z,o[4]=Q,o[5]=ie,o[6]=ne,o[7]=Z,o[8]=se,o[9]=ae}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let a=e[1]>>>13;e[1]&=8191;for(let u=2;u<10;u++)e[u]+=a,a=e[u]>>>13,e[u]&=8191;e[0]+=a*5,a=e[0]>>>13,e[0]&=8191,e[1]+=a,a=e[1]>>>13,e[1]&=8191,e[2]+=a,n[0]=e[0]+5,a=n[0]>>>13,n[0]&=8191;for(let u=1;u<10;u++)n[u]=e[u]+a,a=n[u]>>>13,n[u]&=8191;n[9]-=8192;let o=(a^1)-1;for(let u=0;u<10;u++)n[u]&=o;o=~o;for(let u=0;u<10;u++)e[u]=e[u]&o|n[u];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let c=e[0]+t[0];e[0]=c&65535;for(let u=1;u<8;u++)c=(e[u]+t[u]|0)+(c>>>16)|0,e[u]=c&65535}update(e){exists$2(this);const{buffer:t,blockLen:n}=this;e=toBytes$4(e);const a=e.length;for(let o=0;o<a;){const c=Math.min(n-this.pos,a-o);if(c===n){for(;n<=a-o;o+=n)this.process(e,o);continue}t.set(e.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){exists$2(this),output$2(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:a}=this;if(a){for(t[a++]=1;a<16;a++)t[a]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let c=0;c<8;c++)e[o++]=n[c]>>>0,e[o++]=n[c]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}};function wrapConstructorWithKey$1(r){const e=(n,a)=>r(a).update(toBytes$4(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const poly1305$1=wrapConstructorWithKey$1(r=>new Poly1305$1(r)),sigma16$1=utf8ToBytes$3("expand 16-byte k"),sigma32$1=utf8ToBytes$3("expand 32-byte k"),sigma16_32$1=u32$2(sigma16$1),sigma32_32$1=u32$2(sigma32$1);function rotl$1(r,e){return r<<e|r>>>32-e}function isAligned32$1(r){return r.byteOffset%4===0}const BLOCK_LEN$1=64,BLOCK_LEN32$1=16,MAX_COUNTER$1=2**32-1,U32_EMPTY$1=new Uint32Array;function runCipher$1(r,e,t,n,a,o,c,u){const v=a.length,_=new Uint8Array(BLOCK_LEN$1),x=u32$2(_),E=isAligned32$1(a)&&isAligned32$1(o),M=E?u32$2(a):U32_EMPTY$1,C=E?u32$2(o):U32_EMPTY$1;for(let I=0;I<v;c++){if(r(e,t,n,x,c,u),c>=MAX_COUNTER$1)throw new Error("arx: counter overflow");const D=Math.min(BLOCK_LEN$1,v-I);if(E&&D===BLOCK_LEN$1){const L=I/4;if(I%4!==0)throw new Error("arx: invalid block position");for(let N=0,q;N<BLOCK_LEN32$1;N++)q=L+N,C[q]=M[q]^x[N];I+=BLOCK_LEN$1;continue}for(let L=0,N;L<D;L++)N=I+L,o[N]=a[N]^_[L];I+=D}}function createCipher$1(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:a,counterRight:o,rounds:c}=checkOpts$1({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return number$3(a),number$3(c),bool$1(o),bool$1(t),(u,v,_,x,E=0)=>{bytes$2(u),bytes$2(v),bytes$2(_);const M=_.length;if(x||(x=new Uint8Array(M)),bytes$2(x),number$3(E),E<0||E>=MAX_COUNTER$1)throw new Error("arx: counter overflow");if(x.length<M)throw new Error(`arx: output (${x.length}) is shorter than data (${M})`);const C=[];let I=u.length,D,L;if(I===32)D=u.slice(),C.push(D),L=sigma32_32$1;else if(I===16&&t)D=new Uint8Array(32),D.set(u),D.set(u,16),L=sigma16_32$1,C.push(D);else throw new Error(`arx: invalid 32-byte key, got length=${I}`);isAligned32$1(v)||(v=v.slice(),C.push(v));const N=u32$2(D);if(n){if(v.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(L,N,u32$2(v.subarray(0,16)),N),v=v.subarray(16)}const q=16-a;if(q!==v.length)throw new Error(`arx: nonce must be ${q} or 16 bytes`);if(q!==12){const U=new Uint8Array(12);U.set(v,o?0:12-v.length),v=U,C.push(v)}const F=u32$2(v);for(runCipher$1(r,L,N,F,_,x,E,c);C.length>0;)C.pop().fill(0);return x}}function chachaCore$1(r,e,t,n,a,o=20){let c=r[0],u=r[1],v=r[2],_=r[3],x=e[0],E=e[1],M=e[2],C=e[3],I=e[4],D=e[5],L=e[6],N=e[7],q=a,F=t[0],U=t[1],j=t[2],W=c,X=u,J=v,G=_,oe=x,O=E,l=M,p=C,b=I,S=D,T=L,B=N,$=q,A=F,g=U,k=j;for(let z=0;z<o;z+=2)W=W+oe|0,$=rotl$1($^W,16),b=b+$|0,oe=rotl$1(oe^b,12),W=W+oe|0,$=rotl$1($^W,8),b=b+$|0,oe=rotl$1(oe^b,7),X=X+O|0,A=rotl$1(A^X,16),S=S+A|0,O=rotl$1(O^S,12),X=X+O|0,A=rotl$1(A^X,8),S=S+A|0,O=rotl$1(O^S,7),J=J+l|0,g=rotl$1(g^J,16),T=T+g|0,l=rotl$1(l^T,12),J=J+l|0,g=rotl$1(g^J,8),T=T+g|0,l=rotl$1(l^T,7),G=G+p|0,k=rotl$1(k^G,16),B=B+k|0,p=rotl$1(p^B,12),G=G+p|0,k=rotl$1(k^G,8),B=B+k|0,p=rotl$1(p^B,7),W=W+O|0,k=rotl$1(k^W,16),T=T+k|0,O=rotl$1(O^T,12),W=W+O|0,k=rotl$1(k^W,8),T=T+k|0,O=rotl$1(O^T,7),X=X+l|0,$=rotl$1($^X,16),B=B+$|0,l=rotl$1(l^B,12),X=X+l|0,$=rotl$1($^X,8),B=B+$|0,l=rotl$1(l^B,7),J=J+p|0,A=rotl$1(A^J,16),b=b+A|0,p=rotl$1(p^b,12),J=J+p|0,A=rotl$1(A^J,8),b=b+A|0,p=rotl$1(p^b,7),G=G+oe|0,g=rotl$1(g^G,16),S=S+g|0,oe=rotl$1(oe^S,12),G=G+oe|0,g=rotl$1(g^G,8),S=S+g|0,oe=rotl$1(oe^S,7);let H=0;n[H++]=c+W|0,n[H++]=u+X|0,n[H++]=v+J|0,n[H++]=_+G|0,n[H++]=x+oe|0,n[H++]=E+O|0,n[H++]=M+l|0,n[H++]=C+p|0,n[H++]=I+b|0,n[H++]=D+S|0,n[H++]=L+T|0,n[H++]=N+B|0,n[H++]=q+$|0,n[H++]=F+A|0,n[H++]=U+g|0,n[H++]=j+k|0}function hchacha(r,e,t,n){let a=r[0],o=r[1],c=r[2],u=r[3],v=e[0],_=e[1],x=e[2],E=e[3],M=e[4],C=e[5],I=e[6],D=e[7],L=t[0],N=t[1],q=t[2],F=t[3];for(let j=0;j<20;j+=2)a=a+v|0,L=rotl$1(L^a,16),M=M+L|0,v=rotl$1(v^M,12),a=a+v|0,L=rotl$1(L^a,8),M=M+L|0,v=rotl$1(v^M,7),o=o+_|0,N=rotl$1(N^o,16),C=C+N|0,_=rotl$1(_^C,12),o=o+_|0,N=rotl$1(N^o,8),C=C+N|0,_=rotl$1(_^C,7),c=c+x|0,q=rotl$1(q^c,16),I=I+q|0,x=rotl$1(x^I,12),c=c+x|0,q=rotl$1(q^c,8),I=I+q|0,x=rotl$1(x^I,7),u=u+E|0,F=rotl$1(F^u,16),D=D+F|0,E=rotl$1(E^D,12),u=u+E|0,F=rotl$1(F^u,8),D=D+F|0,E=rotl$1(E^D,7),a=a+_|0,F=rotl$1(F^a,16),I=I+F|0,_=rotl$1(_^I,12),a=a+_|0,F=rotl$1(F^a,8),I=I+F|0,_=rotl$1(_^I,7),o=o+x|0,L=rotl$1(L^o,16),D=D+L|0,x=rotl$1(x^D,12),o=o+x|0,L=rotl$1(L^o,8),D=D+L|0,x=rotl$1(x^D,7),c=c+E|0,N=rotl$1(N^c,16),M=M+N|0,E=rotl$1(E^M,12),c=c+E|0,N=rotl$1(N^c,8),M=M+N|0,E=rotl$1(E^M,7),u=u+v|0,q=rotl$1(q^u,16),C=C+q|0,v=rotl$1(v^C,12),u=u+v|0,q=rotl$1(q^u,8),C=C+q|0,v=rotl$1(v^C,7);let U=0;n[U++]=a,n[U++]=o,n[U++]=c,n[U++]=u,n[U++]=L,n[U++]=N,n[U++]=q,n[U++]=F}const xchacha20=createCipher$1(chachaCore$1,{counterRight:!1,counterLength:8,extendNonceFn:hchacha,allowShortKeys:!1}),ZEROS16$1=new Uint8Array(16),updatePadded$1=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(ZEROS16$1.subarray(t))},ZEROS32$1=new Uint8Array(32);function computeTag$1(r,e,t,n,a){const o=r(e,t,ZEROS32$1),c=poly1305$1.create(o);a&&updatePadded$1(c,a),updatePadded$1(c,n);const u=new Uint8Array(16),v=createView$1(u);setBigUint64$1(v,0,BigInt(a?a.length:0),!0),setBigUint64$1(v,8,BigInt(n.length),!0),c.update(u);const _=c.digest();return o.fill(0),_}const _poly1305_aead$1=r=>(e,t,n)=>(ensureBytes(e,32),ensureBytes(t),{encrypt:(o,c)=>{const u=o.length,v=u+16;c?ensureBytes(c,v):c=new Uint8Array(v),r(e,t,o,c,1);const _=computeTag$1(r,e,t,c.subarray(0,-16),n);return c.set(_,u),c},decrypt:(o,c)=>{const u=o.length,v=u-16;if(u<16)throw new Error("encrypted data must be at least 16 bytes");c?ensureBytes(c,v):c=new Uint8Array(v);const _=o.subarray(0,-16),x=o.subarray(-16),E=computeTag$1(r,e,t,_,n);if(!equalBytes$1(x,E))throw new Error("invalid tag");return r(e,t,_,c,1),c}}),xchacha20poly1305=wrapCipher$1({blockSize:64,nonceLength:24,tagLength:16},_poly1305_aead$1(xchacha20)),u8a$1={toString:toString$5,fromString:fromString$4,concat:concat$4};function bytesToBase64url(r){return u8a$1.toString(r,"base64url")}function base64ToBytes(r){const e=r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return u8a$1.fromString(e,"base64url")}function base58ToBytes(r){return u8a$1.fromString(r,"base58btc")}function bytesToBase58(r){return u8a$1.toString(r,"base58btc")}function multibaseToBytes(r){const e=srcExports.decode(r);if([32,33,48,64,65,96].includes(e.length))return e;try{const[t,n]=decode$d(e);return e.slice(n)}catch{return e}}function hexToBytes$1(r,e){let t=r.startsWith("0x")?r.substring(2):r;return t.length%2!==0&&(t=`0${t}`),u8a$1.fromString(t.toLowerCase(),"base16")}function encodeBase64url(r){return bytesToBase64url(u8a$1.fromString(r))}function decodeBase64url(r){return u8a$1.toString(base64ToBytes(r))}function bytesToHex(r){return u8a$1.toString(r,"base16")}function bytesToBigInt(r){return BigInt("0x"+u8a$1.toString(r,"base16"))}function stringToBytes$1(r){return u8a$1.fromString(r,"utf-8")}function toJose({r,s:e,recoveryParam:t},n){const a=new Uint8Array(n?65:64);if(a.set(u8a$1.fromString(r,"base16"),0),a.set(u8a$1.fromString(e,"base16"),32),n){if(typeof t>"u")throw new Error("Signer did not return a recoveryParam");a[64]=t}return bytesToBase64url(a)}function fromJose(r){const e=base64ToBytes(r);if(e.length<64||e.length>65)throw new TypeError(`Wrong size for signature. Expected 64 or 65 bytes, but got ${e.length}`);const t=bytesToHex(e.slice(0,32)),n=bytesToHex(e.slice(32,64)),a=e.length===65?e[64]:void 0;return{r:t,s:n,recoveryParam:a}}function toSealed(r,e){return u8a$1.concat([base64ToBytes(r),e?base64ToBytes(e):new Uint8Array(0)])}function generateKeyPair$1(){const r=x25519.utils.randomPrivateKey(),e=x25519.getPublicKey(r);return{secretKey:r,publicKey:e}}function generateKeyPairFromSeed(r){if(r.length!==32)throw new Error("x25519: seed must be 32 bytes");return{publicKey:x25519.getPublicKey(r),secretKey:r}}function genX25519EphemeralKeyPair(){const r=generateKeyPair$1();return{publicKeyJWK:{kty:"OKP",crv:"X25519",x:bytesToBase64url(r.publicKey)},secretKey:r.secretKey}}function sha256$3(r){const e=typeof r=="string"?fromString$4(r):r;return sha256$4(e)}const keccak=keccak_256$1;function toEthereumAddress(r){const e=fromString$4(r.slice(2),"base16");return`0x${toString$5(keccak(e).slice(-20),"base16")}`}function writeUint32BE$1(r,e=new Uint8Array(4)){const t=fromString$4(r.toString(),"base10");return e.set(t,4-t.length),e}const lengthAndInput=r=>concat$4([writeUint32BE$1(r.length),r]);function concatKDF(r,e,t,n,a){const o=concat$4([lengthAndInput(fromString$4(t)),lengthAndInput(typeof n>"u"?new Uint8Array(0):n),lengthAndInput(typeof a>"u"?new Uint8Array(0):a),writeUint32BE$1(e)]);return sha256$3(concat$4([writeUint32BE$1(1),r,o]))}function EdDSASigner(r){const e=r;if(![32,64].includes(e.length))throw new Error(`bad_key: Invalid private key format. Expecting 32 or 64 bytes, but got ${e.length}`);return function(t){try{const n=typeof t=="string"?stringToBytes$1(t):t,a=ed25519$1.sign(n,e.slice(0,32));return Promise.resolve(bytesToBase64url(a))}catch(n){return Promise.reject(n)}}}function instanceOfEcdsaSignature(r){return typeof r=="object"&&"r"in r&&"s"in r}function ES256SignerAlg(){return function(e,t){try{return Promise.resolve(t(e)).then(function(n){return instanceOfEcdsaSignature(n)?toJose(n):n})}catch(n){return Promise.reject(n)}}}function ES256KSignerAlg(r){return function(t,n){try{return Promise.resolve(n(t)).then(function(a){if(instanceOfEcdsaSignature(a))return toJose(a,r);if(r&&typeof fromJose(a).recoveryParam>"u")throw new Error("not_supported: ES256K-R not supported when signer doesn't provide a recovery param");return a})}catch(a){return Promise.reject(a)}}}function Ed25519SignerAlg(){return function(e,t){try{return Promise.resolve(t(e)).then(function(n){if(instanceOfEcdsaSignature(n))throw new Error("invalid_config: expected a signer function that returns a string instead of signature object");return n})}catch(n){return Promise.reject(n)}}}const algorithms$1={ES256:ES256SignerAlg(),ES256K:ES256KSignerAlg(),"ES256K-R":ES256KSignerAlg(!0),Ed25519:Ed25519SignerAlg(),EdDSA:Ed25519SignerAlg()};function SignerAlg(r){const e=algorithms$1[r];if(!e)throw new Error(`not_supported: Unsupported algorithm ${r}`);return e}function publicKeyToAddress$1(r,e){const t=bytesToHex(base58ToBytes(e).slice(0,1)),n=hexToBytes$1(r),a=ripemd160$1(sha256$3(n)),o=t+bytesToHex(a),c=sha256$3(hexToBytes$1(o)),u=sha256$3(c),v=bytesToHex(u).substring(0,8),_=o+v;return bytesToBase58(hexToBytes$1(_))}function publicKeyToAddress(r,e){const t=secp256k1$2.ProjectivePoint.fromHex(r).toRawBytes(),n=ripemd160$1(sha256$3(t)),a=bech32.toWords(n);return bech32.encode(e,a).replace(e,"")}function verifyBlockchainAccountId(r,e){if(e){const t=e.split(":");switch(t[0]){case"bip122":t[t.length-1]=publicKeyToAddress$1(r,t[t.length-1]);break;case"cosmos":t[t.length-1]=publicKeyToAddress(r,t[1]);break;case"eip155":t[t.length-1]=toEthereumAddress(r);break;default:return!1}return t.join(":").toLowerCase()===e.toLowerCase()}return!1}function toSignatureObject(r,e=!1){const t=base64ToBytes(r);if(t.length!==(e?65:64))throw new Error("wrong signature length");const n=bytesToHex(t.slice(0,32)),a=bytesToHex(t.slice(32,64)),o={r:n,s:a};return e&&(o.recoveryParam=t[64]),o}function toSignatureObject2(r,e=!1){const t=base64ToBytes(r);if(t.length!==(e?65:64))throw new Error("wrong signature length");return{compact:t.slice(0,64),recovery:t[64]}}function extractPublicKeyBytes(r){return r.publicKeyBase58?base58ToBytes(r.publicKeyBase58):r.publicKeyBase64?base64ToBytes(r.publicKeyBase64):r.publicKeyHex?hexToBytes$1(r.publicKeyHex):r.publicKeyJwk&&r.publicKeyJwk.crv==="secp256k1"&&r.publicKeyJwk.x&&r.publicKeyJwk.y?secp256k1$2.ProjectivePoint.fromAffine({x:bytesToBigInt(base64ToBytes(r.publicKeyJwk.x)),y:bytesToBigInt(base64ToBytes(r.publicKeyJwk.y))}).toRawBytes(!1):r.publicKeyJwk&&r.publicKeyJwk.crv==="P-256"&&r.publicKeyJwk.x&&r.publicKeyJwk.y?p256.ProjectivePoint.fromAffine({x:bytesToBigInt(base64ToBytes(r.publicKeyJwk.x)),y:bytesToBigInt(base64ToBytes(r.publicKeyJwk.y))}).toRawBytes(!1):r.publicKeyJwk&&r.publicKeyJwk.kty==="OKP"&&["Ed25519","X25519"].includes(r.publicKeyJwk.crv??"")&&r.publicKeyJwk.x?base64ToBytes(r.publicKeyJwk.x):r.publicKeyMultibase?multibaseToBytes(r.publicKeyMultibase):new Uint8Array}function verifyES256(r,e,t){const n=sha256$3(r),a=p256.Signature.fromCompact(toSignatureObject2(e).compact),c=t.filter(u=>!u.ethereumAddress&&!u.blockchainAccountId).find(u=>{try{const v=extractPublicKeyBytes(u);return p256.verify(a,n,v)}catch{return!1}});if(!c)throw new Error("invalid_signature: Signature invalid for JWT");return c}function verifyES256K(r,e,t){const n=sha256$3(r),a=secp256k1$2.Signature.fromCompact(base64ToBytes(e)).normalizeS(),o=t.filter(v=>!v.ethereumAddress&&!v.blockchainAccountId),c=t.filter(v=>v.ethereumAddress||v.blockchainAccountId);let u=o.find(v=>{try{const _=extractPublicKeyBytes(v);return secp256k1$2.verify(a,n,_)}catch{return!1}});if(!u&&c.length>0&&(u=verifyRecoverableES256K(r,e,c)),!u)throw new Error("invalid_signature: Signature invalid for JWT");return u}function verifyRecoverableES256K(r,e,t){const n=[];if(e.length>86)n.push(toSignatureObject2(e,!0));else{const c=toSignatureObject2(e,!1);n.push({...c,recovery:0}),n.push({...c,recovery:1})}const a=sha256$3(r),o=c=>{const v=secp256k1$2.Signature.fromCompact(c.compact).addRecoveryBit(c.recovery||0).recoverPublicKey(a),_=toEthereumAddress(v.toHex(!1)).toLowerCase(),x=v.toHex(!1),E=v.toHex(!0);return t.find(M=>{const C=bytesToHex(extractPublicKeyBytes(M));return C===x||C===E||M.ethereumAddress?.toLowerCase()===_||M.blockchainAccountId?.split("@eip155")?.[0].toLowerCase()===_||verifyBlockchainAccountId(x,M.blockchainAccountId)})};for(const c of n){const u=o(c);if(u)return u}throw new Error("invalid_signature: Signature invalid for JWT")}function verifyEd25519(r,e,t){const n=stringToBytes$1(r),a=base64ToBytes(e),o=t.find(c=>ed25519$1.verify(a,n,extractPublicKeyBytes(c)));if(!o)throw new Error("invalid_signature: Signature invalid for JWT");return o}const algorithms={ES256:verifyES256,ES256K:verifyES256K,"ES256K-R":verifyRecoverableES256K,Ed25519:verifyEd25519,EdDSA:verifyEd25519};function VerifierAlgorithm(r){const e=algorithms[r];if(!e)throw new Error(`not_supported: Unsupported algorithm ${r}`);return e}VerifierAlgorithm.toSignatureObject=toSignatureObject;typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));const createJWS=function(r,e,t={},n={}){try{t.alg||(t.alg=defaultAlg);const a=typeof r=="string"?r:encodeSection(r,n.canonicalize),o=[encodeSection(t,n.canonicalize),a].join("."),c=SignerAlg(t.alg);return Promise.resolve(c(o,e)).then(function(u){return[o,u].join(".")})}catch(a){return Promise.reject(a)}},defaultAlg="ES256K";function encodeSection(r,e=!1){return encodeBase64url(e?canonicalizeData(r):JSON.stringify(r))}function decodeJWS(r){const e=r.match(/^([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)$/);if(e)return{header:JSON.parse(decodeBase64url(e[1])),payload:e[2],signature:e[3],data:`${e[1]}.${e[2]}`};throw new Error("invalid_argument: Incorrect format JWS")}function verifyJWSDecoded({header:r,data:e,signature:t},n){return Array.isArray(n)||(n=[n]),VerifierAlgorithm(r.alg)(e,t,n)}function verifyJWS(r,e){const t=decodeJWS(r);return verifyJWSDecoded(t,e)}const _iteratorSymbol=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function _settle(r,e,t){if(!r.s){if(t instanceof _Pact)if(t.s)e&1&&(e=t.s),t=t.v;else{t.o=_settle.bind(null,r,e);return}if(t&&t.then){t.then(_settle.bind(null,r,e),_settle.bind(null,r,2));return}r.s=e,r.v=t;const n=r.o;n&&n(r)}}const _Pact=function(){function r(){}return r.prototype.then=function(e,t){const n=new r,a=this.s;if(a){const o=a&1?e:t;if(o){try{_settle(n,1,o(this.v))}catch(c){_settle(n,2,c)}return n}else return this}return this.o=function(o){try{const c=o.v;o.s&1?_settle(n,1,e?e(c):c):t?_settle(n,1,t(c)):_settle(n,2,c)}catch(c){_settle(n,2,c)}},n},r}();function _isSettledPact(r){return r instanceof _Pact&&r.s&1}function _forTo(r,e,t){var n=-1,a,o;function c(u){try{for(;++n<r.length&&(!t||!t());)if(u=e(n),u&&u.then)if(_isSettledPact(u))u=u.v;else{u.then(c,o||(o=_settle.bind(null,a=new _Pact,2)));return}a?_settle(a,1,u):a=u}catch(v){_settle(a||(a=new _Pact),2,v)}}return c(),a}function _forOf(r,e,t){if(typeof r[_iteratorSymbol]=="function"){let x=function(E){try{for(;!(a=n.next()).done&&(!t||!t());)if(E=e(a.value),E&&E.then)if(_isSettledPact(E))E=E.v;else{E.then(x,c||(c=_settle.bind(null,o=new _Pact,2)));return}o?_settle(o,1,E):o=E}catch(M){_settle(o||(o=new _Pact),2,M)}};var n=r[_iteratorSymbol](),a,o,c;if(x(),n.return){var u=function(E){try{a.done||n.return()}catch{}return E};if(o&&o.then)return o.then(u,function(E){throw u(E)});u()}return o}if(!("length"in r))throw new TypeError("Object is not iterable");for(var v=[],_=0;_<r.length;_++)v.push(r[_]);return _forTo(v,function(x){return e(v[x])},t)}function _for(r,e,t){for(var n;;){var a=r();if(_isSettledPact(a)&&(a=a.v),!a)return o;if(a.then){n=0;break}var o=t();if(o&&o.then)if(_isSettledPact(o))o=o.s;else{n=1;break}if(e){var c=e();if(c&&c.then&&!_isSettledPact(c)){n=2;break}}}var u=new _Pact,v=_settle.bind(null,u,2);return(n===0?a.then(x):n===1?o.then(_):c.then(E)).then(void 0,v),u;function _(M){o=M;do{if(e&&(c=e(),c&&c.then&&!_isSettledPact(c))){c.then(E).then(void 0,v);return}if(a=r(),!a||_isSettledPact(a)&&!a.v){_settle(u,1,o);return}if(a.then){a.then(x).then(void 0,v);return}o=t(),_isSettledPact(o)&&(o=o.v)}while(!o||!o.then);o.then(_).then(void 0,v)}function x(M){M?(o=t(),o&&o.then?o.then(_).then(void 0,v):_(o)):_settle(u,1,o)}function E(){(a=r())?a.then?a.then(x).then(void 0,v):x(a):_settle(u,1,o)}}function validateJWE(r){if(!(r.protected&&r.iv&&r.ciphertext&&r.tag))throw new Error("bad_jwe: missing properties");r.recipients&&r.recipients.map(e=>{if(!(e.header&&e.encrypted_key))throw new Error("bad_jwe: malformed recipients")})}function encodeJWE({ciphertext:r,tag:e,iv:t,protectedHeader:n,recipient:a},o){const c={protected:n,iv:bytesToBase64url(t??new Uint8Array(0)),ciphertext:bytesToBase64url(r),tag:bytesToBase64url(e??new Uint8Array(0))};return o&&(c.aad=bytesToBase64url(o)),a&&(c.recipients=[a]),c}const decryptJWE=function(r,e){try{let t=function(_){if(u===null)throw new Error("failure: Failed to decrypt");return u},n;validateJWE(r);const a=JSON.parse(decodeBase64url(r.protected));if(a.enc!==e.enc)throw new Error(`not_supported: Decrypter does not supported: '${a.enc}'`);const o=toSealed(r.ciphertext,r.tag),c=stringToBytes$1(r.aad?`${r.protected}.${r.aad}`:r.protected);let u=null;const v=function(){if(!(a.alg==="dir"&&e.alg==="dir"))return function(){if(!r.recipients||r.recipients.length===0)throw new Error("bad_jwe: missing recipients");{let _=0;return _for(function(){return!u&&_<r.recipients.length},function(){return _++},function(){const x=r.recipients[_];Object.assign(x.header,a);const E=function(){if(x.header.alg===e.alg)return Promise.resolve(e.decrypt(o,base64ToBytes(r.iv),c,x)).then(function(M){u=M})}();if(E&&E.then)return E.then(function(){})})}}()}();return Promise.resolve(v&&v.then?v.then(t):t(v))}catch(t){return Promise.reject(t)}},createJWE=function(r,e,t={},n,a=!1){try{if(e[0].alg==="dir"){if(e.length>1)throw new Error('not_supported: Can only do "dir" encryption to one key.');return Promise.resolve(e[0].encrypt(r,t,n)).then(function(o){return encodeJWE(o,n)})}else{const o=e[0].enc;if(!e.reduce((x,E)=>x&&E.enc===o,!0))throw new Error("invalid_argument: Incompatible encrypters passed");let c,u,v;if(a){v=e[0].genEpk?.();const x=e[0].alg;t={...t,alg:x,epk:v?.publicKeyJWK}}const _=_forOf(e,function(x){const E=function(){return c?Promise.resolve(x.encryptCek?.(c,v)).then(function(M){M&&u?.recipients?.push(M)}):Promise.resolve(x.encrypt(r,t,n,v)).then(function(M){c=M.cek,u=encodeJWE(M,n)})}();if(E&&E.then)return E.then(function(){})});return Promise.resolve(_&&_.then?_.then(function(){return u}):u)}}catch(o){return Promise.reject(o)}};function xc20pEncrypter(r){return(e,t)=>{const n=randomBytes$1(24),o=xchacha20poly1305(r,n,t).encrypt(e);return{ciphertext:o.subarray(0,o.length-16),tag:o.subarray(o.length-16),iv:n}}}function xc20pDirEncrypter(r){const e=function(o,c={},u){try{const v=encodeBase64url(JSON.stringify(Object.assign({alg:a},c,{enc:n}))),_=stringToBytes$1(u?`${v}.${bytesToBase64url(u)}`:v);return Promise.resolve({...t(o,_),protectedHeader:v})}catch(v){return Promise.reject(v)}},t=xc20pEncrypter(r),n="XC20P",a="dir";return{alg:a,enc:n,encrypt:e}}function xc20pDirDecrypter(r){return{alg:"dir",enc:"XC20P",decrypt:function(t,n,a){try{try{return Promise.resolve(xchacha20poly1305(r,n,a).decrypt(t))}catch{return Promise.resolve(null)}}catch(o){return Promise.reject(o)}}}}const createX25519EcdhEsKek=function(r,e,t,n,a,o){try{const c="X25519",v=o?generateKeyPairFromSeed(o.secretKey):generateKeyPair$1(),_={kty:"OKP",crv:c,x:bytesToBase64url(v.publicKey)},x=x25519.getSharedSecret(v.secretKey,r),E=base64ToBytes(a??""),M=concatKDF(x,256,t,void 0,E);return Promise.resolve({epk:_,kek:M})}catch(c){return Promise.reject(c)}},computeX25519EcdhEsKek=function(r,e,t){try{let n=function(){let x,E;return r.header.apu&&(x=base64ToBytes(r.header.apu)),r.header.apv&&(E=base64ToBytes(r.header.apv)),concatKDF(v,o,t,x,E)};const a="X25519",o=256,c=r.header;if(c.epk?.crv!==a||typeof c.epk.x>"u")return Promise.resolve(null);const u=base64ToBytes(c.epk.x);let v;const _=function(){if(e instanceof Uint8Array)v=x25519.getSharedSecret(e,u);else return Promise.resolve(e(u)).then(function(x){v=x})}();return Promise.resolve(_&&_.then?_.then(n):n(_))}catch(n){return Promise.reject(n)}};function createFullEncrypter(r,e,t={},n,a,o){const c=function(v,_={},x,E){try{Object.assign(_,{alg:void 0});const M=randomBytes$1(32);return Promise.resolve(u(M,E)).then(function(C){return E&&(_.alg=`${n.alg}+${a.alg}`,_.epk=E.publicKeyJWK),Promise.resolve(o.from(M).encrypt(v,_,x)).then(function(I){return{...I,recipient:C,cek:M}})})}catch(M){return Promise.reject(M)}},u=function(v,_){try{return Promise.resolve(n.createKek(r,e,`${n.alg}+${a.alg}`,t.apu,t.apv,_)).then(function({epk:x,kek:E}){return Promise.resolve(a.from(E).wrap(v)).then(function(M){const C={encrypted_key:bytesToBase64url(M.ciphertext),header:{}};return M.iv&&(C.header.iv=bytesToBase64url(M.iv)),M.tag&&(C.header.tag=bytesToBase64url(M.tag)),t.kid&&(C.header.kid=t.kid),t.apu&&(C.header.apu=t.apu),t.apv&&(C.header.apv=t.apv),_||(C.header.alg=`${n.alg}+${a.alg}`,C.header.epk=x),C})})}catch(x){return Promise.reject(x)}};return{alg:a.alg,enc:o.enc,encrypt:c,encryptCek:u,genEpk:genX25519EphemeralKeyPair}}const resolveX25519Encrypters=function(r,e){try{const t=function(a,o=[]){try{return Promise.resolve(e.resolve(a)).then(function({didResolutionMetadata:c,didDocument:u}){function v(){const M=u.keyAgreement?.map(C=>typeof C=="string"?[...u.publicKey||[],...u.verificationMethod||[]].find(I=>I.id===C):C)?.filter(C=>typeof C<"u")?.filter(C=>C.type==="X25519KeyAgreementKey2019"||C.type==="X25519KeyAgreementKey2020")||[];if(!M.length&&!_.length)throw new Error(`no_suitable_keys: Could not find x25519 key for ${a}`);return M.map(C=>x25519Encrypter(extractPublicKeyBytes(C),C.id)).concat(..._)}if(o.push(a),c?.error||u==null)throw new Error(`resolver_error: Could not resolve ${a}: ${c.error}, ${c.message}`);let _=[];if(!u.controller&&!u.keyAgreement)throw new Error(`no_suitable_keys: Could not find x25519 key for ${a}`);const x=function(){if(u.controller){let E=Array.isArray(u.controller)?u.controller:[u.controller];E=E.filter(C=>!o.includes(C));const M=E.map(C=>t(C,o).catch(()=>[]));return Promise.resolve(Promise.all(M)).then(function(C){_=[].concat(...C)})}}();return x&&x.then?x.then(v):v(x)})}catch(c){return Promise.reject(c)}},n=r.map(a=>t(a));return Promise.resolve(Promise.all(n)).then(function(a){return[].concat(...a)})}catch(t){return Promise.reject(t)}};function validateHeader(r){if(!(r&&r.epk&&r.iv&&r.tag))throw new Error("bad_jwe: malformed header");return r}const xc20pKeyWrapper={from:r=>({wrap:function(t){try{return Promise.resolve(xc20pEncrypter(r)(t))}catch(n){return Promise.reject(n)}}}),alg:"XC20PKW"};function x25519Encrypter(r,e,t){return xc20pAnonEncrypterEcdhESx25519WithXc20PkwV2(r,{kid:e,apv:t})}function xc20pAnonEncrypterEcdhESx25519WithXc20PkwV2(r,e={}){return createFullEncrypter(r,void 0,e,{createKek:createX25519EcdhEsKek,alg:"ECDH-ES"},xc20pKeyWrapper,{from:t=>xc20pDirEncrypter(t),enc:"XC20P"})}function x25519Decrypter(r){return xc20pAnonDecrypterEcdhESx25519WithXc20PkwV2(r)}function xc20pAnonDecrypterEcdhESx25519WithXc20PkwV2(r){const e=function(a,o,c,u){try{u=u;const v=validateHeader(u.header);return Promise.resolve(computeX25519EcdhEsKek(u,r,t)).then(function(_){if(!_)return null;const x=toSealed(u.encrypted_key,v.tag);return Promise.resolve(xc20pDirDecrypter(_).decrypt(x,base64ToBytes(v.iv))).then(function(E){return E===null?null:xc20pDirDecrypter(E).decrypt(a,o,c)})})}catch(v){return Promise.reject(v)}},t="ECDH-ES+XC20PKW";return{alg:t,enc:"XC20P",decrypt:e}}function equals$2(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function coerce(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$3(r){return new TextEncoder().encode(r)}function toString$4(r){return new TextDecoder().decode(r)}function base$3(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var a=0;a<r.length;a++){var o=r.charAt(a),c=o.charCodeAt(0);if(t[c]!==255)throw new TypeError(o+" is ambiguous");t[c]=a}var u=r.length,v=r.charAt(0),_=Math.log(u)/Math.log(256),x=Math.log(256)/Math.log(u);function E(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var D=0,L=0,N=0,q=I.length;N!==q&&I[N]===0;)N++,D++;for(var F=(q-N)*x+1>>>0,U=new Uint8Array(F);N!==q;){for(var j=I[N],W=0,X=F-1;(j!==0||W<L)&&X!==-1;X--,W++)j+=256*U[X]>>>0,U[X]=j%u>>>0,j=j/u>>>0;if(j!==0)throw new Error("Non-zero carry");L=W,N++}for(var J=F-L;J!==F&&U[J]===0;)J++;for(var G=v.repeat(D);J<F;++J)G+=r.charAt(U[J]);return G}function M(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var D=0;if(I[D]!==" "){for(var L=0,N=0;I[D]===v;)L++,D++;for(var q=(I.length-D)*_+1>>>0,F=new Uint8Array(q);I[D];){var U=t[I.charCodeAt(D)];if(U===255)return;for(var j=0,W=q-1;(U!==0||j<N)&&W!==-1;W--,j++)U+=u*F[W]>>>0,F[W]=U%256>>>0,U=U/256>>>0;if(U!==0)throw new Error("Non-zero carry");N=j,D++}if(I[D]!==" "){for(var X=q-N;X!==q&&F[X]===0;)X++;for(var J=new Uint8Array(L+(q-X)),G=L;X!==q;)J[G++]=F[X++];return J}}}function C(I){var D=M(I);if(D)return D;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:M,decode:C}}var src=base$3,_brrp__multiformats_scope_baseX=src;let Encoder$1=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$1=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;const a=t.codePointAt(0);if(a===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$2(this,e)}};class ComposedDecoder{decoders;constructor(e){this.decoders=e}or(e){return or$2(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or$2(r,e){return new ComposedDecoder({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Codec$1=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,a){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=a,this.encoder=new Encoder$1(e,t,n),this.decoder=new Decoder$1(e,t,a)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$2({name:r,prefix:e,encode:t,decode:n}){return new Codec$1(r,e,t,n)}function baseX({name:r,prefix:e,alphabet:t}){const{encode:n,decode:a}=_brrp__multiformats_scope_baseX(t,r);return from$2({prefix:e,name:r,encode:n,decode:o=>coerce(a(o))})}function decode$b(r,e,t,n){const a={};for(let x=0;x<e.length;++x)a[e[x]]=x;let o=r.length;for(;r[o-1]==="=";)--o;const c=new Uint8Array(o*t/8|0);let u=0,v=0,_=0;for(let x=0;x<o;++x){const E=a[r[x]];if(E===void 0)throw new SyntaxError(`Non-${n} character`);v=v<<t|E,u+=t,u>=8&&(u-=8,c[_++]=255&v>>u)}if(u>=t||255&v<<8-u)throw new SyntaxError("Unexpected end of data");return c}function encode$a(r,e,t){const n=e[e.length-1]==="=",a=(1<<t)-1;let o="",c=0,u=0;for(let v=0;v<r.length;++v)for(u=u<<8|r[v],c+=8;c>t;)c-=t,o+=e[a&u>>c];if(c!==0&&(o+=e[a&u<<t-c]),n)for(;o.length*t&7;)o+="=";return o}function rfc4648({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return from$2({prefix:e,name:r,encode(a){return encode$a(a,n,t)},decode(a){return decode$b(a,n,t,r)}})}const base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$1=Object.freeze(Object.defineProperty({__proto__:null,base32,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc,base58flickr},Symbol.toStringTag,{value:"Module"}));var encode_1$1=encode$9,MSB$4=128,MSBALL$1=-128,INT$1=Math.pow(2,31);function encode$9(r,e,t){e=e||[],t=t||0;for(var n=t;r>=INT$1;)e[t++]=r&255|MSB$4,r/=128;for(;r&MSBALL$1;)e[t++]=r&255|MSB$4,r>>>=7;return e[t]=r|0,encode$9.bytes=t-n+1,e}var decode$a=read$3,MSB$1$1=128,REST$1$1=127;function read$3(r,n){var t=0,n=n||0,a=0,o=n,c,u=r.length;do{if(o>=u)throw read$3.bytes=0,new RangeError("Could not decode varint");c=r[o++],t+=a<28?(c&REST$1$1)<<a:(c&REST$1$1)*Math.pow(2,a),a+=7}while(c>=MSB$1$1);return read$3.bytes=o-n,t}var N1$2=Math.pow(2,7),N2$2=Math.pow(2,14),N3$2=Math.pow(2,21),N4$2=Math.pow(2,28),N5$2=Math.pow(2,35),N6$2=Math.pow(2,42),N7$2=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$3=function(r){return r<N1$2?1:r<N2$2?2:r<N3$2?3:r<N4$2?4:r<N5$2?5:r<N6$2?6:r<N7$2?7:r<N8$1?8:r<N9$1?9:10},varint$2={encode:encode_1$1,decode:decode$a,encodingLength:length$3},_brrp_varint=varint$2;function decode$9(r,e=0){return[_brrp_varint.decode(r,e),_brrp_varint.decode.bytes]}function encodeTo(r,e,t=0){return _brrp_varint.encode(r,e,t),e}function encodingLength$1(r){return _brrp_varint.encodingLength(r)}function create(r,e){const t=e.byteLength,n=encodingLength$1(r),a=n+encodingLength$1(t),o=new Uint8Array(a+t);return encodeTo(r,o,0),encodeTo(t,o,n),o.set(e,a),new Digest(r,t,e,o)}function decode$8(r){const e=coerce(r),[t,n]=decode$9(e),[a,o]=decode$9(e.subarray(n)),c=e.subarray(n+o);if(c.byteLength!==a)throw new Error("Incorrect length");return new Digest(t,a,c,e)}function equals$1(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&equals$2(r.bytes,t.bytes)}}class Digest{code;size;digest;bytes;constructor(e,t,n,a){this.code=e,this.size=t,this.digest=n,this.bytes=a}}function format(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return toStringV0(t,baseCache(r),e??base58btc.encoder);default:return toStringV1(t,baseCache(r),e??base32.encoder)}}const cache$1=new WeakMap;function baseCache(r){const e=cache$1.get(r);if(e==null){const t=new Map;return cache$1.set(r,t),t}return e}class CID{code;version;multihash;bytes;"/";constructor(e,t,n,a){this.code=t,this.version=e,this.multihash=n,this.bytes=a,this["/"]=a}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=create(e,t);return CID.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return CID.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&equals$1(e.multihash,n.multihash)}toString(e){return format(this,e)}toJSON(){return{"/":format(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof CID)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:a,multihash:o,bytes:c}=t;return new CID(n,a,o,c??encodeCID(n,a,o.bytes))}else if(t[cidSymbol]===!0){const{version:n,multihash:a,code:o}=t,c=decode$8(a);return CID.create(n,o,c)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(e,t,n,n.bytes)}case 1:{const a=encodeCID(e,t,n.bytes);return new CID(e,t,n,a)}default:throw new Error("Invalid version")}}static createV0(e){return CID.create(0,DAG_PB_CODE,e)}static createV1(e,t){return CID.create(1,e,t)}static decode(e){const[t,n]=CID.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=CID.inspectBytes(e),n=t.size-t.multihashSize,a=coerce(e.subarray(n,n+t.multihashSize));if(a.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=a.subarray(t.multihashSize-t.digestSize),c=new Digest(t.multihashCode,t.digestSize,o,a);return[t.version===0?CID.createV0(c):CID.createV1(t.codec,c),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[E,M]=decode$9(e.subarray(t));return t+=M,E};let a=n(),o=DAG_PB_CODE;if(a===18?(a=0,t=0):o=n(),a!==0&&a!==1)throw new RangeError(`Invalid CID version ${a}`);const c=t,u=n(),v=n(),_=t+v,x=_-c;return{version:a,codec:o,multihashCode:u,digestSize:v,multihashSize:x,size:_}}static parse(e,t){const[n,a]=parseCIDtoBytes(e,t),o=CID.decode(a);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(o).set(n,e),o}}function parseCIDtoBytes(r,e){switch(r[0]){case"Q":{const t=e??base58btc;return[base58btc.prefix,t.decode(`${base58btc.prefix}${r}`)]}case base58btc.prefix:{const t=e??base58btc;return[base58btc.prefix,t.decode(r)]}case base32.prefix:{const t=e??base32;return[base32.prefix,t.decode(r)]}case base36.prefix:{const t=e??base36;return[base36.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function toStringV0(r,e,t){const{prefix:n}=t;if(n!==base58btc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const a=e.get(n);if(a==null){const o=t.encode(r).slice(1);return e.set(n,o),o}else return a}function toStringV1(r,e,t){const{prefix:n}=t,a=e.get(n);if(a==null){const o=t.encode(r);return e.set(n,o),o}else return a}const DAG_PB_CODE=112,SHA_256_CODE=18;function encodeCID(r,e,t){const n=encodingLength$1(r),a=n+encodingLength$1(e),o=new Uint8Array(a+t.byteLength);return encodeTo(r,o,0),encodeTo(e,o,n),o.set(t,a),o}const cidSymbol=Symbol.for("@ipld/js-cid/CID");function from$1({name:r,code:e,encode:t}){return new Hasher(r,e,t)}class Hasher{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?create(this.code,t):t.then(n=>create(this.code,n))}else throw Error("Unknown type, must be binary type")}}function readonly({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*linksWithin(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const a=[...r,t],o=CID.asCID(n);o!=null?yield[a.join("/"),o]:typeof n=="object"&&(yield*links(n,a))}else{const t=CID.asCID(e);t!=null?yield[r.join("/"),t]:yield*links(e,r)}}function*links(r,e){if(r==null||r instanceof Uint8Array)return;const t=CID.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,a]of Object.entries(r)){const o=[...e,n];yield*linksWithin(o,a)}}function*treeWithin(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const a=[...r,t];yield a.join("/"),typeof n=="object"&&CID.asCID(n)==null&&(yield*tree(n,a))}else yield*tree(e,r)}function*tree(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const a=[...e,t];yield a.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&CID.asCID(n)==null&&(yield*treeWithin(a,n))}}function get$1(r,e){let t=r;for(const[n,a]of e.entries()){if(t=t[a],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(c=>`[${JSON.stringify(c)}]`).join("")}`);const o=CID.asCID(t);if(o!=null)return{value:o,remaining:e.slice(n+1).join("/")}}return{value:t}}class Block{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:n}){if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:readonly(),bytes:readonly(),value:readonly(),asBlock:readonly()})}links(){return links(this.value,[])}tree(){return tree(this.value,[])}get(e="/"){return get$1(this.value,e.split("/").filter(Boolean))}}async function encode$8({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(e==null||t==null)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),a=await t.digest(n),o=CID.create(1,e.code,a);return new Block({value:r,bytes:n,cid:o})}async function decode$7({bytes:r,codec:e,hasher:t}){if(r==null)throw new Error('Missing required argument "bytes"');if(e==null||t==null)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),a=await t.digest(r),o=CID.create(1,e.code,a);return new Block({value:n,bytes:r,cid:o})}function sha$2(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const sha256$2=from$1({name:"sha2-256",code:18,encode:sha$2("SHA-256")}),code$2=0,name$2="identity",encode$7=coerce;function digest(r){return create(code$2,encode$7(r))}const identity$2={code:code$2,name:name$2,encode:encode$7,digest},base64=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$1=Object.freeze(Object.defineProperty({__proto__:null,base64,base64pad,base64url,base64urlpad},Symbol.toStringTag,{value:"Module"})),typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(typeofs.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(isBuffer$1(r))return"Buffer";const t=getObjectType(r);return t||"Object"}function isBuffer$1(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function getObjectType(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(objectTypeNames.includes(e))return e}let Type$1=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};Type$1.uint=new Type$1(0,"uint",!0);Type$1.negint=new Type$1(1,"negint",!0);Type$1.bytes=new Type$1(2,"bytes",!0);Type$1.string=new Type$1(3,"string",!0);Type$1.array=new Type$1(4,"array",!1);Type$1.map=new Type$1(5,"map",!1);Type$1.tag=new Type$1(6,"tag",!1);Type$1.float=new Type$1(7,"float",!0);Type$1.false=new Type$1(7,"false",!0);Type$1.true=new Type$1(7,"true",!0);Type$1.null=new Type$1(7,"null",!0);Type$1.undefined=new Type$1(7,"undefined",!0);Type$1.break=new Type$1(7,"break",!0);class Token{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",textDecoder=new TextDecoder,textEncoder=new TextEncoder;function isBuffer(r){return useBuffer&&globalThis.Buffer.isBuffer(r)}function asU8A(r){return r instanceof Uint8Array?isBuffer(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const toString$3=useBuffer?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):utf8Slice(r,e,t):(r,e,t)=>t-e>64?textDecoder.decode(r.subarray(e,t)):utf8Slice(r,e,t),fromString$2=useBuffer?r=>r.length>64?globalThis.Buffer.from(r):utf8ToBytes$2(r):r=>r.length>64?textEncoder.encode(r):utf8ToBytes$2(r),fromArray=r=>Uint8Array.from(r),slice=useBuffer?(r,e,t)=>isBuffer(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),concat$2=useBuffer?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),asU8A(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let a of r)n+a.length>t.length&&(a=a.subarray(0,t.length-n)),t.set(a,n),n+=a.length;return t},alloc$2=useBuffer?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function compare(r,e){if(isBuffer(r)&&isBuffer(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function utf8ToBytes$2(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e}function utf8Slice(r,e,t){const n=[];for(;e<t;){const a=r[e];let o=null,c=a>239?4:a>223?3:a>191?2:1;if(e+c<=t){let u,v,_,x;switch(c){case 1:a<128&&(o=a);break;case 2:u=r[e+1],(u&192)===128&&(x=(a&31)<<6|u&63,x>127&&(o=x));break;case 3:u=r[e+1],v=r[e+2],(u&192)===128&&(v&192)===128&&(x=(a&15)<<12|(u&63)<<6|v&63,x>2047&&(x<55296||x>57343)&&(o=x));break;case 4:u=r[e+1],v=r[e+2],_=r[e+3],(u&192)===128&&(v&192)===128&&(_&192)===128&&(x=(a&15)<<18|(u&63)<<12|(v&63)<<6|_&63,x>65535&&x<1114112&&(o=x))}}o===null?(o=65533,c=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),e+=c}return decodeCodePointsArray(n)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(r){const e=r.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=MAX_ARGUMENTS_LENGTH));return t}const defaultChunkSize=256;class Bl{constructor(e=defaultChunkSize){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const a=t.length-(this.maxCursor-this.cursor)-1;t.set(e,a)}else{if(t){const a=t.length-(this.maxCursor-this.cursor)-1;a<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,a),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=alloc$2(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=slice(n,0,this.cursor)}else t=concat$2(this.chunks,this.cursor);return e&&this.reset(),t}}const decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:";function assertEnoughData(r,e,t){if(r.length-e<t)throw new Error(`${decodeErrPrefix} not enough data for type`)}const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(r,e,t){assertEnoughData(r,e,1);const n=r[e];if(t.strict===!0&&n<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint16(r,e,t){assertEnoughData(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint32(r,e,t){assertEnoughData(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint64(r,e,t){assertEnoughData(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],a=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],o=(BigInt(n)<<BigInt(32))+BigInt(a);if(t.strict===!0&&o<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(t.allowBigInt===!0)return o;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(r,e,t,n){return new Token(Type$1.uint,readUint8(r,e+1,n),2)}function decodeUint16(r,e,t,n){return new Token(Type$1.uint,readUint16(r,e+1,n),3)}function decodeUint32(r,e,t,n){return new Token(Type$1.uint,readUint32(r,e+1,n),5)}function decodeUint64(r,e,t,n){return new Token(Type$1.uint,readUint64(r,e+1,n),9)}function encodeUint(r,e){return encodeUintValue(r,0,e.value)}function encodeUintValue(r,e,t){if(t<uintBoundaries[0]){const n=Number(t);r.push([e|n])}else if(t<uintBoundaries[1]){const n=Number(t);r.push([e|24,n])}else if(t<uintBoundaries[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<uintBoundaries[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<uintBoundaries[4]){const a=[e|27,0,0,0,0,0,0,0];let o=Number(n&BigInt(4294967295)),c=Number(n>>BigInt(32)&BigInt(4294967295));a[8]=o&255,o=o>>8,a[7]=o&255,o=o>>8,a[6]=o&255,o=o>>8,a[5]=o&255,a[4]=c&255,c=c>>8,a[3]=c&255,c=c>>8,a[2]=c&255,c=c>>8,a[1]=c&255,r.push(a)}else throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`)}}encodeUint.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};encodeUintValue.encodedSize=function(e){return e<uintBoundaries[0]?1:e<uintBoundaries[1]?2:e<uintBoundaries[2]?3:e<uintBoundaries[3]?5:9};encodeUint.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function decodeNegint8(r,e,t,n){return new Token(Type$1.negint,-1-readUint8(r,e+1,n),2)}function decodeNegint16(r,e,t,n){return new Token(Type$1.negint,-1-readUint16(r,e+1,n),3)}function decodeNegint32(r,e,t,n){return new Token(Type$1.negint,-1-readUint32(r,e+1,n),5)}const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(r,e,t,n){const a=readUint64(r,e+1,n);if(typeof a!="bigint"){const o=-1-a;if(o>=Number.MIN_SAFE_INTEGER)return new Token(Type$1.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type$1.negint,neg1b-BigInt(a),9)}function encodeNegint(r,e){const t=e.value,n=typeof t=="bigint"?t*neg1b-pos1b:t*-1-1;encodeUintValue(r,e.type.majorEncoded,n)}encodeNegint.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*neg1b-pos1b:t*-1-1;return n<uintBoundaries[0]?1:n<uintBoundaries[1]?2:n<uintBoundaries[2]?3:n<uintBoundaries[3]?5:9};encodeNegint.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function toToken$3(r,e,t,n){assertEnoughData(r,e,t+n);const a=slice(r,e+t,e+t+n);return new Token(Type$1.bytes,a,t+n)}function decodeBytesCompact(r,e,t,n){return toToken$3(r,e,1,t)}function decodeBytes8(r,e,t,n){return toToken$3(r,e,2,readUint8(r,e+1,n))}function decodeBytes16(r,e,t,n){return toToken$3(r,e,3,readUint16(r,e+1,n))}function decodeBytes32(r,e,t,n){return toToken$3(r,e,5,readUint32(r,e+1,n))}function decodeBytes64(r,e,t,n){const a=readUint64(r,e+1,n);if(typeof a=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken$3(r,e,9,a)}function tokenBytes(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===Type$1.string?fromString$2(r.value):r.value),r.encodedBytes}function encodeBytes(r,e){const t=tokenBytes(e);encodeUintValue(r,e.type.majorEncoded,t.length),r.push(t)}encodeBytes.encodedSize=function(e){const t=tokenBytes(e);return encodeUintValue.encodedSize(t.length)+t.length};encodeBytes.compareTokens=function(e,t){return compareBytes(tokenBytes(e),tokenBytes(t))};function compareBytes(r,e){return r.length<e.length?-1:r.length>e.length?1:compare(r,e)}function toToken$2(r,e,t,n,a){const o=t+n;assertEnoughData(r,e,o);const c=new Token(Type$1.string,toString$3(r,e+t,e+o),o);return a.retainStringBytes===!0&&(c.byteValue=slice(r,e+t,e+o)),c}function decodeStringCompact(r,e,t,n){return toToken$2(r,e,1,t,n)}function decodeString8(r,e,t,n){return toToken$2(r,e,2,readUint8(r,e+1,n),n)}function decodeString16(r,e,t,n){return toToken$2(r,e,3,readUint16(r,e+1,n),n)}function decodeString32(r,e,t,n){return toToken$2(r,e,5,readUint32(r,e+1,n),n)}function decodeString64(r,e,t,n){const a=readUint64(r,e+1,n);if(typeof a=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken$2(r,e,9,a,n)}const encodeString=encodeBytes;function toToken$1(r,e,t,n){return new Token(Type$1.array,n,t)}function decodeArrayCompact(r,e,t,n){return toToken$1(r,e,1,t)}function decodeArray8(r,e,t,n){return toToken$1(r,e,2,readUint8(r,e+1,n))}function decodeArray16(r,e,t,n){return toToken$1(r,e,3,readUint16(r,e+1,n))}function decodeArray32(r,e,t,n){return toToken$1(r,e,5,readUint32(r,e+1,n))}function decodeArray64(r,e,t,n){const a=readUint64(r,e+1,n);if(typeof a=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken$1(r,e,9,a)}function decodeArrayIndefinite(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken$1(r,e,1,1/0)}function encodeArray(r,e){encodeUintValue(r,Type$1.array.majorEncoded,e.value)}encodeArray.compareTokens=encodeUint.compareTokens;encodeArray.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function toToken(r,e,t,n){return new Token(Type$1.map,n,t)}function decodeMapCompact(r,e,t,n){return toToken(r,e,1,t)}function decodeMap8(r,e,t,n){return toToken(r,e,2,readUint8(r,e+1,n))}function decodeMap16(r,e,t,n){return toToken(r,e,3,readUint16(r,e+1,n))}function decodeMap32(r,e,t,n){return toToken(r,e,5,readUint32(r,e+1,n))}function decodeMap64(r,e,t,n){const a=readUint64(r,e+1,n);if(typeof a=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken(r,e,9,a)}function decodeMapIndefinite(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken(r,e,1,1/0)}function encodeMap(r,e){encodeUintValue(r,Type$1.map.majorEncoded,e.value)}encodeMap.compareTokens=encodeUint.compareTokens;encodeMap.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function decodeTagCompact(r,e,t,n){return new Token(Type$1.tag,t,1)}function decodeTag8(r,e,t,n){return new Token(Type$1.tag,readUint8(r,e+1,n),2)}function decodeTag16(r,e,t,n){return new Token(Type$1.tag,readUint16(r,e+1,n),3)}function decodeTag32(r,e,t,n){return new Token(Type$1.tag,readUint32(r,e+1,n),5)}function decodeTag64(r,e,t,n){return new Token(Type$1.tag,readUint64(r,e+1,n),9)}function encodeTag(r,e){encodeUintValue(r,Type$1.tag.majorEncoded,e.value)}encodeTag.compareTokens=encodeUint.compareTokens;encodeTag.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new Token(Type$1.null,null,1):new Token(Type$1.undefined,void 0,1)}function decodeBreak(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type$1.break,void 0,1)}function createToken(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type$1.float,r,e)}function decodeFloat16(r,e,t,n){return createToken(readFloat16(r,e+1),3,n)}function decodeFloat32(r,e,t,n){return createToken(readFloat32(r,e+1),5,n)}function decodeFloat64(r,e,t,n){return createToken(readFloat64(r,e+1),9,n)}function encodeFloat(r,e,t){const n=e.value;if(n===!1)r.push([Type$1.float.majorEncoded|MINOR_FALSE]);else if(n===!0)r.push([Type$1.float.majorEncoded|MINOR_TRUE]);else if(n===null)r.push([Type$1.float.majorEncoded|MINOR_NULL]);else if(n===void 0)r.push([Type$1.float.majorEncoded|MINOR_UNDEFINED]);else{let a,o=!1;(!t||t.float64!==!0)&&(encodeFloat16(n),a=readFloat16(ui8a,1),n===a||Number.isNaN(n)?(ui8a[0]=249,r.push(ui8a.slice(0,3)),o=!0):(encodeFloat32(n),a=readFloat32(ui8a,1),n===a&&(ui8a[0]=250,r.push(ui8a.slice(0,5)),o=!0))),o||(encodeFloat64(n),a=readFloat64(ui8a,1),ui8a[0]=251,r.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){encodeFloat16(n);let a=readFloat16(ui8a,1);if(n===a||Number.isNaN(n))return 3;if(encodeFloat32(n),a=readFloat32(ui8a,1),n===a)return 5}return 9};const buffer$1=new ArrayBuffer(9),dataView=new DataView(buffer$1,1),ui8a=new Uint8Array(buffer$1,0);function encodeFloat16(r){if(r===1/0)dataView.setUint16(0,31744,!1);else if(r===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(r))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,r);const e=dataView.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)dataView.setUint16(0,31744,!1);else if(t===0)dataView.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const a=t-127;a<-24?dataView.setUint16(0,0):a<-14?dataView.setUint16(0,(e&2147483648)>>16|1<<24+a,!1):dataView.setUint16(0,(e&2147483648)>>16|a+15<<10|n>>13,!1)}}}function readFloat16(r,e){if(r.length-e<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,a=t&1023;let o;return n===0?o=a*2**-24:n!==31?o=(a+1024)*2**(n-25):o=a===0?1/0:NaN,t&32768?-o:o}function encodeFloat32(r){dataView.setFloat32(0,r,!1)}function readFloat32(r,e){if(r.length-e<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function encodeFloat64(r){dataView.setFloat64(0,r,!1)}function readFloat64(r,e){if(r.length-e<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}encodeFloat.compareTokens=encodeUint.compareTokens;function invalidMinor(r,e,t){throw new Error(`${decodeErrPrefix} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function errorer(r){return()=>{throw new Error(`${decodeErrPrefix} ${r}`)}}const jump=[];for(let r=0;r<=23;r++)jump[r]=invalidMinor;jump[24]=decodeUint8;jump[25]=decodeUint16;jump[26]=decodeUint32;jump[27]=decodeUint64;jump[28]=invalidMinor;jump[29]=invalidMinor;jump[30]=invalidMinor;jump[31]=invalidMinor;for(let r=32;r<=55;r++)jump[r]=invalidMinor;jump[56]=decodeNegint8;jump[57]=decodeNegint16;jump[58]=decodeNegint32;jump[59]=decodeNegint64;jump[60]=invalidMinor;jump[61]=invalidMinor;jump[62]=invalidMinor;jump[63]=invalidMinor;for(let r=64;r<=87;r++)jump[r]=decodeBytesCompact;jump[88]=decodeBytes8;jump[89]=decodeBytes16;jump[90]=decodeBytes32;jump[91]=decodeBytes64;jump[92]=invalidMinor;jump[93]=invalidMinor;jump[94]=invalidMinor;jump[95]=errorer("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)jump[r]=decodeStringCompact;jump[120]=decodeString8;jump[121]=decodeString16;jump[122]=decodeString32;jump[123]=decodeString64;jump[124]=invalidMinor;jump[125]=invalidMinor;jump[126]=invalidMinor;jump[127]=errorer("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)jump[r]=decodeArrayCompact;jump[152]=decodeArray8;jump[153]=decodeArray16;jump[154]=decodeArray32;jump[155]=decodeArray64;jump[156]=invalidMinor;jump[157]=invalidMinor;jump[158]=invalidMinor;jump[159]=decodeArrayIndefinite;for(let r=160;r<=183;r++)jump[r]=decodeMapCompact;jump[184]=decodeMap8;jump[185]=decodeMap16;jump[186]=decodeMap32;jump[187]=decodeMap64;jump[188]=invalidMinor;jump[189]=invalidMinor;jump[190]=invalidMinor;jump[191]=decodeMapIndefinite;for(let r=192;r<=215;r++)jump[r]=decodeTagCompact;jump[216]=decodeTag8;jump[217]=decodeTag16;jump[218]=decodeTag32;jump[219]=decodeTag64;jump[220]=invalidMinor;jump[221]=invalidMinor;jump[222]=invalidMinor;jump[223]=invalidMinor;for(let r=224;r<=243;r++)jump[r]=errorer("simple values are not supported");jump[244]=invalidMinor;jump[245]=invalidMinor;jump[246]=invalidMinor;jump[247]=decodeUndefined;jump[248]=errorer("simple values are not supported");jump[249]=decodeFloat16;jump[250]=decodeFloat32;jump[251]=decodeFloat64;jump[252]=invalidMinor;jump[253]=invalidMinor;jump[254]=invalidMinor;jump[255]=decodeBreak;const quick=[];for(let r=0;r<24;r++)quick[r]=new Token(Type$1.uint,r,1);for(let r=-1;r>=-24;r--)quick[31-r]=new Token(Type$1.negint,r,1);quick[64]=new Token(Type$1.bytes,new Uint8Array(0),1);quick[96]=new Token(Type$1.string,"",1);quick[128]=new Token(Type$1.array,0,1);quick[160]=new Token(Type$1.map,0,1);quick[244]=new Token(Type$1.false,!1,1);quick[245]=new Token(Type$1.true,!0,1);quick[246]=new Token(Type$1.null,null,1);function quickEncodeToken(r){switch(r.type){case Type$1.false:return fromArray([244]);case Type$1.true:return fromArray([245]);case Type$1.null:return fromArray([246]);case Type$1.bytes:return r.value.length?void 0:fromArray([64]);case Type$1.string:return r.value===""?fromArray([96]):void 0;case Type$1.array:return r.value===0?fromArray([128]):void 0;case Type$1.map:return r.value===0?fromArray([160]):void 0;case Type$1.uint:return r.value<24?fromArray([Number(r.value)]):void 0;case Type$1.negint:if(r.value>=-24)return fromArray([31-Number(r.value)])}}const defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const r=[];return r[Type$1.uint.major]=encodeUint,r[Type$1.negint.major]=encodeNegint,r[Type$1.bytes.major]=encodeBytes,r[Type$1.string.major]=encodeString,r[Type$1.array.major]=encodeArray,r[Type$1.map.major]=encodeMap,r[Type$1.tag.major]=encodeTag,r[Type$1.float.major]=encodeFloat,r}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(t,e)}}const simpleTokens={null:new Token(Type$1.null,null),undefined:new Token(Type$1.undefined,void 0),true:new Token(Type$1.true,!0),false:new Token(Type$1.false,!1),emptyArray:new Token(Type$1.array,0),emptyMap:new Token(Type$1.map,0)},typeEncoders={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new Token(Type$1.float,r):r>=0?new Token(Type$1.uint,r):new Token(Type$1.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new Token(Type$1.uint,r):new Token(Type$1.negint,r)},Uint8Array(r,e,t,n){return new Token(Type$1.bytes,r)},string(r,e,t,n){return new Token(Type$1.string,r)},boolean(r,e,t,n){return r?simpleTokens.true:simpleTokens.false},null(r,e,t,n){return simpleTokens.null},undefined(r,e,t,n){return simpleTokens.undefined},ArrayBuffer(r,e,t,n){return new Token(Type$1.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new Token(Type$1.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[simpleTokens.emptyArray,new Token(Type$1.break)]:simpleTokens.emptyArray;n=Ref.createCheck(n,r);const a=[];let o=0;for(const c of r)a[o++]=objectToTokens(c,t,n);return t.addBreakTokens?[new Token(Type$1.array,r.length),a,new Token(Type$1.break)]:[new Token(Type$1.array,r.length),a]},Object(r,e,t,n){const a=e!=="Object",o=a?r.keys():Object.keys(r),c=a?r.size:o.length;if(!c)return t.addBreakTokens===!0?[simpleTokens.emptyMap,new Token(Type$1.break)]:simpleTokens.emptyMap;n=Ref.createCheck(n,r);const u=[];let v=0;for(const _ of o)u[v++]=[objectToTokens(_,t,n),objectToTokens(a?r.get(_):r[_],t,n)];return sortMapEntries(u,t),t.addBreakTokens?[new Token(Type$1.map,c),u,new Token(Type$1.break)]:[new Token(Type$1.map,c),u]}};typeEncoders.Map=typeEncoders.Object;typeEncoders.Buffer=typeEncoders.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${r}Array`]=typeEncoders.DataView;function objectToTokens(r,e={},t){const n=is(r),a=e&&e.typeEncoders&&e.typeEncoders[n]||typeEncoders[n];if(typeof a=="function"){const c=a(r,n,e,t);if(c!=null)return c}const o=typeEncoders[n];if(!o)throw new Error(`${encodeErrPrefix} unsupported type: ${n}`);return o(r,n,e,t)}function sortMapEntries(r,e){e.mapSorter&&r.sort(e.mapSorter)}function mapSorter(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const a=t.type.major,o=cborEncoders[a].compareTokens(t,n);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function tokensToEncoded(r,e,t,n){if(Array.isArray(e))for(const a of e)tokensToEncoded(r,a,t,n);else t[e.type.major](r,e,n)}function encodeCustom(r,e,t){const n=objectToTokens(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const a=t.quickEncodeToken(n);if(a)return a;const o=e[n.type.major];if(o.encodedSize){const c=o.encodedSize(n,t),u=new Bl(c);if(o(u,n,t),u.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return asU8A(u.chunks[0])}}return buf.reset(),tokensToEncoded(buf,n,e,t),buf.toBytes(!0)}function encode$6(r,e){return e=Object.assign({},defaultEncodeOptions,e),encodeCustom(r,cborEncoders,e)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=quick[e];if(t===void 0){const n=jump[e];if(!n)throw new Error(`${decodeErrPrefix} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const a=e&31;t=n(this.data,this._pos,a,this.options)}return this._pos+=t.encodedLength,t}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(r,e,t){const n=[];for(let a=0;a<r.value;a++){const o=tokensToObject(e,t);if(o===BREAK){if(r.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(o===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${a}, expected ${r.value})`);n[a]=o}return n}function tokenToMap(r,e,t){const n=t.useMaps===!0,a=n?void 0:{},o=n?new Map:void 0;for(let c=0;c<r.value;c++){const u=tokensToObject(e,t);if(u===BREAK){if(r.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(u===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${c} [no key], expected ${r.value})`);if(n!==!0&&typeof u!="string")throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof u})`);if(t.rejectDuplicateMapKeys===!0&&(n&&o.has(u)||!n&&u in a))throw new Error(`${decodeErrPrefix} found repeat map key "${u}"`);const v=tokensToObject(e,t);if(v===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${c} [no value], expected ${r.value})`);n?o.set(u,v):a[u]=v}return n?o:a}function tokensToObject(r,e){if(r.done())return DONE;const t=r.next();if(t.type===Type$1.break)return BREAK;if(t.type.terminal)return t.value;if(t.type===Type$1.array)return tokenToArray(t,r,e);if(t.type===Type$1.map)return tokenToMap(t,r,e);if(t.type===Type$1.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=tokensToObject(r,e);return e.tags[t.value](n)}throw new Error(`${decodeErrPrefix} tag not supported (${t.value})`)}throw new Error("unsupported")}function decodeFirst(r,e){if(!(r instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);e=Object.assign({},defaultDecodeOptions,e);const t=e.tokenizer||new Tokeniser(r,e),n=tokensToObject(t,e);if(n===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(n===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);return[n,r.subarray(t.pos())]}function decode$6(r,e){const[t,n]=decodeFirst(r,e);if(n.length>0)throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return t}const CID_CBOR_TAG=42;function toByteView(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function cidEncoder(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=CID.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new Token(Type$1.tag,CID_CBOR_TAG),new Token(Type$1.bytes,t)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const _encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}},encodeOptions={..._encodeOptions,typeEncoders:{..._encodeOptions.typeEncoders}};function cidDecoder(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID.decode(r.subarray(1))}const _decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};_decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;const decodeOptions={..._decodeOptions,tags:_decodeOptions.tags.slice()},name$1="dag-cbor",code$1=113,encode$5=r=>encode$6(r,_encodeOptions),decode$5=r=>decode$6(toByteView(r),_decodeOptions),dagCbor=Object.freeze(Object.defineProperty({__proto__:null,code:code$1,decode:decode$5,decodeOptions,encode:encode$5,encodeOptions,name:name$1,toByteView},Symbol.toStringTag,{value:"Module"})),ENC_BLOCK_SIZE=24;async function encodePayload(r){const e=await encode$8({value:r,codec:dagCbor,hasher:sha256$2});return{cid:e.cid,linkedBlock:e.bytes}}function pad$1(r,e=ENC_BLOCK_SIZE){const t=(e-r.length%e)%e,n=new Uint8Array(r.length+t);return n.set(r,0),n}async function encodeIdentityCID(r){return(await encode$8({value:r,codec:dagCbor,hasher:identity$2})).cid}function decodeIdentityCID(r){const e=CID.asCID(r);if(!e)throw new Error("CID could not be parsed");if(e.code!==code$1)throw new Error("CID codec must be dag-cbor");if(e.multihash.code!==identity$2.code)throw new Error("CID must use identity multihash");return decode$5(e.multihash.digest)}async function prepareCleartext(r,e){return pad$1((await encodeIdentityCID(r)).bytes,e)}function decodeCleartext(r){return decodeIdentityCID(CID.decodeFirst(r)[0])}const abortableHandlerSymbol=Symbol("abortable"),abortedReasonSymbol=Symbol("aborted");function abortable(r,e){if(e.aborted)return Promise.reject(abortedReasonSymbol);let t;const n=new Promise((a,o)=>{t=o});return e.addEventListener("abort",()=>{t(abortedReasonSymbol)}),Promise.race([r,n])}let nanoid$1=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const ABORT_REQUEST_METHOD="utils_abort_request";var ERROR_CODE;(function(r){r[r.PARSE_ERROR=-32700]="PARSE_ERROR",r[r.INVALID_REQUEST=-32600]="INVALID_REQUEST",r[r.METHOD_NOT_FOUND=-32601]="METHOD_NOT_FOUND",r[r.INVALID_PARAMS=-32602]="INVALID_PARAMS",r[r.INTERNAL_ERROR=-32603]="INTERNAL_ERROR"})(ERROR_CODE||(ERROR_CODE={}));const ERROR_MESSAGE={[ERROR_CODE.PARSE_ERROR]:"Parse error",[ERROR_CODE.INVALID_REQUEST]:"Invalid request",[ERROR_CODE.METHOD_NOT_FOUND]:"Method not found",[ERROR_CODE.INVALID_PARAMS]:"Invalid params",[ERROR_CODE.INTERNAL_ERROR]:"Internal error"};function isServerError(r){return-32e3>=r&&r>=-32099}function getErrorMessage(r){return ERROR_MESSAGE[r.toString()]??(isServerError(r)?"Server error":"Application error")}class RPCError extends Error{static fromObject(e){return new RPCError(e.code,e.message,e.data)}toObject(){return{code:this.code,data:this.data,message:this.message}}constructor(e,t,n){super(),Object.setPrototypeOf(this,RPCError.prototype),this.code=e,this.data=n,this.message=t??getErrorMessage(e)}}function createErrorFactory(r){const e=ERROR_MESSAGE[r];return function(n){return new RPCError(r,e,n)}}createErrorFactory(ERROR_CODE.PARSE_ERROR);createErrorFactory(ERROR_CODE.INVALID_REQUEST);createErrorFactory(ERROR_CODE.METHOD_NOT_FOUND);createErrorFactory(ERROR_CODE.INVALID_PARAMS);createErrorFactory(ERROR_CODE.INTERNAL_ERROR);function _checkPrivateRedeclaration(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classApplyDescriptorGet(r,e){return e.get?e.get.call(r):e.value}function _classApplyDescriptorSet(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}function _classExtractFieldDescriptor(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function _classPrivateFieldGet(r,e){var t=_classExtractFieldDescriptor(r,e,"get");return _classApplyDescriptorGet(r,t)}function _classPrivateFieldInit(r,e,t){_checkPrivateRedeclaration(r,e),e.set(r,t)}function _classPrivateFieldSet(r,e,t){var n=_classExtractFieldDescriptor(r,e,"set");return _classApplyDescriptorSet(r,n,t),t}var _connection=new WeakMap;class RPCClient{get connection(){return _classPrivateFieldGet(this,_connection)}createID(){return nanoid$1()}request(e,t=void 0,n={}){const{signal:a}=n;if(a?.aborted)return Promise.reject(abortedReasonSymbol);const o=this.createID(),c=_classPrivateFieldGet(this,_connection).send({jsonrpc:"2.0",id:o,method:e,params:t}).then(u=>{if(u==null)throw new Error("Missing response");if(u.error!=null)throw RPCError.fromObject(u.error);return u.result});return a==null?c:(a.addEventListener("abort",()=>{this.notify(ABORT_REQUEST_METHOD,{id:o})}),abortable(c,a))}async notify(e,t=void 0){await _classPrivateFieldGet(this,_connection).send({jsonrpc:"2.0",method:e,params:t})}constructor(e){_classPrivateFieldInit(this,_connection,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_connection,e)}}function createErrorResponse(r,e){return{jsonrpc:"2.0",id:r,error:{code:e,message:getErrorMessage(e)}}}function fallbackOnHandlerError(r,e,t){console.warn("Unhandled handler error",e,t)}function fallbackOnInvalidMessage(r,e){console.warn("Unhandled invalid message",e)}function fallbackOnNotification(r,e){console.warn("Unhandled notification",e)}function createHandler(r,e={}){const t=e.onHandlerError??fallbackOnHandlerError,n=e.onInvalidMessage??fallbackOnInvalidMessage,a=e.onNotification??fallbackOnNotification,o={};function c(u,v){if(v.method===ABORT_REQUEST_METHOD){const _=v.params?.id;_!=null&&o[_]?.abort()}else a(u,v)}return async function(v,_){const x=_.id;if(_.jsonrpc!=="2.0"||_.method==null)return x==null?(n(v,_),null):createErrorResponse(x,ERROR_CODE.INVALID_REQUEST);const E=r[_.method];if(E==null)return x==null?(c(v,_),null):createErrorResponse(x,ERROR_CODE.METHOD_NOT_FOUND);try{let M;if(x!=null&&E[abortableHandlerSymbol]){const I=new AbortController;o[x]=I,M=E(v,_.params,{signal:I.signal})}else M=E(v,_.params,{});const C=M==null?M:typeof M.then=="function"?await M:M;return x==null||o[x]?.signal.aborted?null:{jsonrpc:"2.0",id:x,result:C}}catch(M){if(x==null||o[x]?.signal.aborted)return t(v,_,M),null;let C;if(M instanceof RPCError)C=M.toObject();else{t(v,_,M);const I=M.code??-32e3;C={code:I,message:M.message||getErrorMessage(I)}}return{jsonrpc:"2.0",id:x,error:C}}finally{x!=null&&delete o[x]}}}function _extends(){return _extends=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_extends.apply(this,arguments)}var CAIP2={name:"chainId",regex:"[-:a-zA-Z0-9]{5,41}",parameters:{delimiter:":",values:{0:{name:"namespace",regex:"[-a-z0-9]{3,8}"},1:{name:"reference",regex:"[-a-zA-Z0-9]{1,32}"}}}},CAIP10={name:"accountId",regex:"[-:a-zA-Z0-9]{7,106}",parameters:{delimiter:":",values:{0:{name:"namespace",regex:"[-a-z0-9]{3,8}"},1:{name:"reference",regex:"[-a-zA-Z0-9]{1,32}"},2:{name:"address",regex:"[a-zA-Z0-9]{1,64}"}}}},CAIP={2:CAIP2,10:CAIP10};function splitParams(r,e){return r.split(e.parameters.delimiter)}function getParams(r,e){var t=splitParams(r,e),n={};return t.forEach(function(a,o){n[e.parameters.values[o].name]=a}),n}function joinParams(r,e){return Object.values(e.parameters.values).map(function(t){var n=r[t.name];return typeof n=="string"?n:joinParams(n,t)}).join(e.parameters.delimiter)}function isValidId(r,e){if(!new RegExp(e.regex).test(r))return!1;var t=splitParams(r,e);if(t.length!==Object.keys(e.parameters.values).length)return!1;var n=t.map(function(a,o){return new RegExp(e.parameters.values[o].regex).test(a)}).filter(function(a){return!!a});return n.length===t.length}var ChainId=function(){function r(t){typeof t=="string"&&(t=r.parse(t)),this.namespace=t.namespace,this.reference=t.reference}r.parse=function(n){if(!isValidId(n,this.spec))throw new Error("Invalid "+this.spec.name+" provided: "+n);return new r(getParams(n,this.spec)).toJSON()},r.format=function(n){return joinParams(n,this.spec)};var e=r.prototype;return e.toString=function(){return r.format(this.toJSON())},e.toJSON=function(){return{namespace:this.namespace,reference:this.reference}},r}();ChainId.spec=CAIP[2];var AccountId=function(){function r(t){typeof t=="string"&&(t=r.parse(t)),this.chainId=new ChainId(t.chainId),this.address=t.address}r.parse=function(n){if(!isValidId(n,this.spec))throw new Error("Invalid "+this.spec.name+" provided: "+n);var a=getParams(n,this.spec),o=a.namespace,c=a.reference,u=a.address,v=new ChainId({namespace:o,reference:c});return new r({chainId:v,address:u}).toJSON()},r.format=function(n){var a=new ChainId(n.chainId),o=_extends({},a.toJSON(),{address:n.address});return joinParams(o,this.spec)};var e=r.prototype;return e.toString=function(){return r.format(this.toJSON())},e.toJSON=function(){return{chainId:this.chainId.toJSON(),address:this.address}},r}();AccountId.spec=CAIP[10];function isLeft(r){return r._tag==="Left"}function left(r){return{_tag:"Left",left:r}}function right(r){return{_tag:"Right",right:r}}function getOrThrow(r){if(isLeft(r))throw r.left;return r.right}class StringTape{position;input;constructor(e){this.input=e,this.position=0}get isEOF(){return this.position>=this.input.length}}function failure(r,e,t){return t.position=e,fail(r)}function fail(r){return left(r)}function literal$1(r){return function(e){return e.input.slice(e.position,e.position+r.length)===r?(e.position+=r.length,right(r)):fail(new Error(`Can not match literal "${r}"`))}}function foldMap(r,e){return function(n){const a=n.position,o=r(n);if(isLeft(o))return n.position=a,o;const c=e(o.right);return isLeft(c)?failure(c.left,a,n):c}}function map$4(r,e){return function(t){const n=t.position,a=r(t);return isLeft(a)?(t.position=n,a):right(e(a.right))}}function match(r){return function(e){const t=e.input.slice(e.position).match(r);return t?(e.position+=t[0].length,right(t[0])):fail(new Error(`Can not match ${r}`))}}function joinSeq(...r){return join(seqA(r))}function join(r,e=""){return function(t){const n=t.position,a=r(t);return isLeft(a)?(t.position=n,a):right(a.right.join(e))}}function seq(...r){return seqA(r)}function seqA(r){return function(e){const t=e.position,n=[];for(const a of r){const o=a(e);if(isLeft(o))return failure(o.left,t,e);n.push(o.right)}return right(n)}}function option(r,e){return function(n){const a=r(n);return isLeft(a)?right(e):a}}function choice(...r){return function(t){for(const n of r){const a=t.position,o=n(t);if(isLeft(o))t.position=a;else return o}return fail(new Error(`Can not find any of ${r.map(n=>n.name).join(", ")}`))}}function sepBy(r,e,t=1,n=1/0){return function(a){const o=a.position,c=[],u=r(a);if(isLeft(u))return failure(u.left,o,a);c.push(u.right);let v=a.position;const _=x=>c.length<t?failure(x.left,v,a):(a.position=v,right(c));for(;!a.isEOF&&c.length<n;){v=a.position;const x=e(a);if(isLeft(x))return _(x);const E=r(a);if(isLeft(E))return _(E);c.push(E.right)}return c.length<t?failure(new Error(`Got ${c}/${t} instances of ${r.name}`),o,a):right(c)}}function many(r,e=1,t=1/0){return function(a){const o=a.position,c=[];for(;!a.isEOF&&c.length<t;){const u=r(a);if(isLeft(u))return c.length<e?failure(u.left,o,a):right(c);c.push(u.right)}return right(c)}}function parseAll(r){return function(t){const n=t.position,a=r(t);return isLeft(a)||t.isEOF?a:failure(new Error(`Consumed only ${t.position} of input`),n,t)}}function getFunctionName(r){return r.displayName||r.name||`<function${r.length}>`}function stringify$1(r){return typeof r=="function"?getFunctionName(r):typeof r=="number"&&!isFinite(r)?isNaN(r)?"NaN":r>0?"Infinity":"-Infinity":JSON.stringify(r)}function getContextPath(r){return"/"+r.map(({key:e,type:t})=>`${e}(${t.name})`).join("/")}class ValidationError extends Error{trail;constructor(e,t=`Invalid value ${stringify$1(e[e.length-1].actual)} supplied to ${getContextPath(e)}`){super(t),this.trail=e}get value(){return this.trail[this.trail.length-1].actual}}function identity$1(r){return r}class Codec{_A;_I;_O;name;constructor(e){this.name=e}pipe(e,t=`${this.name}${e.name}`){return new Type(t,e.is,(n,a)=>{const o=this.decode(n,a);return isLeft(o)?o:e.decode(o.right,a)},this.encode===identity$1&&e.encode===identity$1?identity$1:n=>this.encode(e.encode(n)))}parse(e,t=ThrowContext.root(this,e)){const n=this.decode(e,t);if(isLeft(n))throw new Error(`Something is wrong: ${n} should be Right`);return n.right}}class Type extends Codec{name;is;decode;encode;constructor(e,t,n,a){super(e),this.name=e,this.is=t,this.decode=n,this.encode=a}}class ThrowContext{trail;constructor(e){this.trail=e}static root(e,t){return new ThrowContext([{key:"",type:e,actual:t}])}failures(e){throw e[0]}success(e){return right(e)}failure(e){throw new ValidationError(this.trail,e)}child(e,t,n){const a=this.trail.concat([{key:e,type:t,actual:n}]);return new ThrowContext(a)}}class TrivialCodec extends Codec{is;constructor(e,t){super(e),this.is=t}encode=identity$1;decode(e,t){return this.is(e)?t.success(e):t.failure()}}new TrivialCodec("null",r=>r===null);new TrivialCodec("undefined",r=>r===void 0);new TrivialCodec("void",r=>r===void 0);new TrivialCodec("string",r=>typeof r=="string");new TrivialCodec("number",r=>typeof r=="number");new TrivialCodec("boolean",r=>typeof r=="boolean");new TrivialCodec("bigint",r=>typeof r=="bigint");new TrivialCodec("unknown",r=>!0);new TrivialCodec("object",r=>!!r&&typeof r=="object");new TrivialCodec("UnknownArray",r=>Array.isArray(r));new TrivialCodec("UnknownDictionary",r=>{if(!(!!r&&typeof r=="object")||Array.isArray(r))return!1;const n=Object.getPrototypeOf(r);if(!n)return!0;const a=Object.hasOwn(n,"constructor")&&n.constructor;return typeof a=="function"&&a instanceof a&&a.toString()==Object.toString()});new TrivialCodec("any",r=>!0);new TrivialCodec("never",r=>!1);function decode$4(r,e){const t=ThrowContext.root(r,e),n=r.decode(e,t);if(isLeft(n))throw new Error(`Something is wrong: ${n} should be Right`);return n.right}const DOT=literal$1("."),COLON=literal$1(":"),DCOLON=literal$1("::"),h16=match(/^([0-9a-fA-F]{2}){1,4}/),decOctet=match(/^(25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|(\d)/),ipv4Address=joinSeq(decOctet,DOT,decOctet,DOT,decOctet,DOT,decOctet),ls32=choice(joinSeq(h16,COLON,h16),ipv4Address);function makeIPv6Address(){const r=E=>join(many(joinSeq(h16,COLON),E,E)),e=E=>option(join(sepBy(h16,COLON,1,E),":"),""),t=seq(r(6),ls32),n=seq(DCOLON,r(5),ls32),a=seq(e(1),DCOLON,r(4),ls32),o=seq(e(2),DCOLON,r(3),ls32),c=seq(e(3),DCOLON,r(2),ls32),u=seq(e(4),DCOLON,r(1),ls32),v=seq(e(5),DCOLON,ls32),_=seq(e(6),DCOLON,h16),x=seq(e(7),DCOLON);return join(choice(t,n,a,o,c,u,v,_,x))}const ipv6address=makeIPv6Address(),ipLiteral=joinSeq(literal$1("["),ipv6address,literal$1("]")),port=foldMap(match(/^\d+/),r=>String(parseInt(r,10))===r?right(r):left(new Error(`Invalid port ${r}`))),regName=match(/^([a-zA-Z0-9\-._~!$&'()*+,;=]|(%[a-fA-F0-9]{2}))*/),host=choice(ipLiteral,ipv4Address,regName),colonPort=joinSeq(literal$1(":"),port),dnsauthority=joinSeq(host,option(colonPort,"")),domain=foldMap(dnsauthority,r=>r?right(r):left(new Error("domain can not be empty"))),uri$1=foldMap(match(/^\S+/),r=>{try{return new URL(r),right(r)}catch{return left(new Error(`Invalid URI ${r}`))}}),LF=literal$1(`
`),DIGITS=match(/^\d+/),network=match(/^\w+/),wantLine=seq(domain,literal$1(" wants you to sign in with your "),network,literal$1(" account:")),wantClause=map$4(wantLine,r=>({domain:r[0],network:r[2]})),address=match(/^\w+/),statementLine=match(/^[^\n]+/),statementClause=map$4(option(seq(statementLine,LF),void 0),r=>{if(r)return r[0]}),uriClause=map$4(seq(literal$1("URI: "),uri$1,LF),r=>r[1]),versionClause=map$4(seq(literal$1("Version: 1"),LF),()=>"1"),chainIdClause=map$4(seq(literal$1("Chain ID: "),DIGITS,LF),r=>r[1]),nonce=match(/^[a-zA-Z0-9]{8,}/),nonceClause=map$4(seq(literal$1("Nonce: "),nonce,LF),r=>r[1]),dateTimeMatch=match(/\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(Z|([+-](\d\d):(\d\d)))/),dateTime=foldMap(dateTimeMatch,r=>Number.isFinite(Date.parse(r))?right(r):left(new Error(`Invalid date-time ${r}`))),dateTimeClause=r=>map$4(seq(literal$1(r),dateTime),e=>e[1]),issuedAtClause=dateTimeClause("Issued At: "),expirationTimeClause=dateTimeClause("Expiration Time: "),notBeforeClause=dateTimeClause("Not Before: "),anyPchar=match(/^([a-zA-Z0-9-._~!$&'():@]|(%[a-fA-F0-9]{2}))*/),requestIdLine=seq(literal$1("Request ID: "),anyPchar,LF),requestIdClause=map$4(requestIdLine,r=>r[1]),resource=uri$1,resourceLine=seq(literal$1("- "),resource),resourceClause=map$4(resourceLine,r=>r[1]),resourcesSection=seq(literal$1("Resources:"),LF,option(sepBy(resourceClause,LF),[])),resourcesClause=map$4(resourcesSection,r=>r[2]),header=seq(wantClause,LF,address,LF),headerClause=map$4(header,r=>({domain:r[0].domain,network:r[0].network,address:r[2]})),mandatoryFields=map$4(seq(uriClause,versionClause,chainIdClause,nonceClause,issuedAtClause),r=>({uri:r[0],version:r[1],chainId:r[2],nonce:r[3],issuedAt:r[4]})),optionalExpirationTime=option(seq(LF,expirationTimeClause),void 0),optionalNotBefore=option(seq(LF,notBeforeClause),void 0),optionalRequestId=option(seq(LF,requestIdClause),void 0),optionalResources=map$4(option(seq(LF,resourcesClause),void 0),r=>r?r[1]:void 0),optionalFields=map$4(seq(optionalExpirationTime,optionalNotBefore,optionalRequestId,optionalResources),r=>({expirationTime:r[0],notBefore:r[1],requestId:r[2],resources:r[3]})),siwxMessageRaw=seq(headerClause,LF,statementClause,LF,mandatoryFields,optionalFields),siwxMessage=map$4(siwxMessageRaw,r=>{const e=r[0],t=r[2],n=r[4],a=r[5];return{domain:e.domain,network:e.network,address:e.address,statement:t,uri:n.uri,version:n.version,chainId:n.chainId,nonce:n.nonce,issuedAt:n.issuedAt,resources:a.resources}});function toField(r){const e=parseAll(r);return function(t){return getOrThrow(e(new StringTape(t)))}}const toDomainString=toField(domain),toDateTimeString=toField(dateTime),toURIString=toField(uri$1);function toNonEmptyString(r,e){if(r)return r;throw new Error(`Expect non-empty string for "${e}" field`)}function toVersionString(r){if(String(r)!=="1")throw new Error(`Invalid version string: ${r}`);return"1"}function toChainIdString(r){return String(r)}function toNonceString(r){return toField(nonce)(String(r))}function _define_property$3(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function resourcesList(r){return r.map(e=>`- ${e}`).join(`
`)}let SiwxMessage$1=class{toString(){return toString$2(this)}constructor(e){_define_property$3(this,"domain",void 0),_define_property$3(this,"network",void 0),_define_property$3(this,"address",void 0),_define_property$3(this,"statement",void 0),_define_property$3(this,"uri",void 0),_define_property$3(this,"version",void 0),_define_property$3(this,"chainId",void 0),_define_property$3(this,"nonce",void 0),_define_property$3(this,"issuedAt",void 0),_define_property$3(this,"expirationTime",void 0),_define_property$3(this,"notBefore",void 0),_define_property$3(this,"requestId",void 0),_define_property$3(this,"resources",void 0),this.domain=toDomainString(e.domain),this.network=toNonEmptyString(e.network,"network"),this.address=toNonEmptyString(e.address,"address"),this.statement=mapUndefined(e.statement,t=>toNonEmptyString(t,"statement")),this.uri=toURIString(e.uri),this.version=toVersionString(e.version||"1"),this.chainId=toChainIdString(e.chainId),this.nonce=toNonceString(e.nonce),this.issuedAt=toDateTimeString(e.issuedAt),this.expirationTime=mapUndefined(e.expirationTime,toDateTimeString),this.notBefore=mapUndefined(e.notBefore,toDateTimeString),this.requestId=mapUndefined(e.requestId,t=>toNonEmptyString(t,"requestId")),this.resources=mapUndefined(e.resources,t=>t.map(toURIString))}};_define_property$3(SiwxMessage$1,"fromString",fromString$1);_define_property$3(SiwxMessage$1,"fromStringSafe",fromStringSafe);function fromStringSafe(r){const t=parseAll(siwxMessage)(new StringTape(r));return isLeft(t)?t:right(new SiwxMessage$1(t.right))}function fromString$1(r){return getOrThrow(fromStringSafe(r))}function toString$2(r){const e=`${r.domain} wants you to sign in with your ${r.network} account:`,t=r.address,n=r.statement,a=`URI: ${r.uri}`,o=`Version: ${r.version}`,c=`Chain ID: ${r.chainId}`,u=`Nonce: ${r.nonce}`,v=`Issued At: ${r.issuedAt}`,_=r.expirationTime?`Expiration Time: ${r.expirationTime}`:void 0,x=r.notBefore?`Not Before: ${r.notBefore}`:void 0,E=r.requestId?`Request ID: ${r.requestId}`:void 0,M=r.resources?`Resources:
${resourcesList(r.resources)}`:void 0;let C=`${e}
${t}

`;return n&&(C+=`${n}
`),[C,a,o,c,u,v,_,x,E,M].filter(Boolean).join(`
`)}function mapUndefined(r,e){if(r!==void 0)return e(r)}function _define_property$2(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var ErrorTypes;(function(r){r.INVALID_SIGNATURE="Invalid signature.",r.EXPIRED_MESSAGE="Expired message.",r.MALFORMED_SESSION="Malformed session."})(ErrorTypes||(ErrorTypes={}));var SignatureType;(function(r){r.PERSONAL_SIGNATURE="Personal signature"})(SignatureType||(SignatureType={}));class SiwxMessage{static fromCacao(e){const t=AccountId.parse(e.p.iss.replace("did:pkh:","")),n=new this({domain:e.p.domain,address:t.address,uri:e.p.aud,version:e.p.version,chainId:new ChainId(t.chainId).reference});return e.p.statement&&(n.statement=e.p.statement),e.p.nonce&&(n.nonce=e.p.nonce),e.p.iat&&(n.issuedAt=e.p.iat),e.p.exp&&(n.expirationTime=e.p.exp),e.p.nbf&&(n.notBefore=e.p.nbf),e.p.requestId&&(n.requestId=e.p.requestId),e.p.resources&&(n.resources=e.p.resources),e.s&&(e.s.s&&(n.signature=e.s.s),e.s.t==="eip191"&&(n.type="Personal signature")),n}toMessage(e,t){return asString(this,e,t)}constructor(e){if(_define_property$2(this,"domain",void 0),_define_property$2(this,"address",void 0),_define_property$2(this,"statement",void 0),_define_property$2(this,"uri",void 0),_define_property$2(this,"version",void 0),_define_property$2(this,"nonce",void 0),_define_property$2(this,"issuedAt",void 0),_define_property$2(this,"expirationTime",void 0),_define_property$2(this,"notBefore",void 0),_define_property$2(this,"requestId",void 0),_define_property$2(this,"chainId",void 0),_define_property$2(this,"resources",void 0),_define_property$2(this,"signature",void 0),_define_property$2(this,"type",void 0),typeof e=="string"){const t=fromString$1(e);this.domain=t.domain,this.address=t.address,this.statement=t.statement,this.uri=t.uri,this.version=t.version,this.nonce=t.nonce,this.issuedAt=t.issuedAt,this.expirationTime=t.expirationTime,this.notBefore=t.notBefore,this.requestId=t.requestId,this.chainId=t.chainId,this.resources=t.resources}else Object.assign(this,e)}}function asLegacyChainIdString(r,e){const t=`${r.domain} wants you to sign in with your ${e} account:`,n=`URI: ${r.uri}`;let a=[t,r.address].join(`
`);const o=`Version: ${r.version}`;r.nonce||(r.nonce=(Math.random()+1).toString(36).substring(4));const c=`Nonce: ${r.nonce}`,u=[n,o,c];if(r.issuedAt&&Date.parse(r.issuedAt),r.issuedAt=r.issuedAt?r.issuedAt:new Date().toISOString(),u.push(`Issued At: ${r.issuedAt}`),r.expirationTime){const _=`Expiration Time: ${r.expirationTime}`;u.push(_)}r.notBefore&&u.push(`Not Before: ${r.notBefore}`),r.requestId&&u.push(`Request ID: ${r.requestId}`),r.chainId&&u.push(`Chain ID: ${r.chainId}`),r.resources&&u.push(["Resources:",...r.resources.map(_=>`- ${_}`)].join(`
`));const v=u.join(`
`);return r.statement&&(a=[a,r.statement].join(`

`)),[a,v].join(`

`)}function asString(r,e,t){const n=`${r.domain} wants you to sign in with your ${e} account:`,a=`URI: ${r.uri}`;let o=[n,t||r.address].join(`
`);const c=`Version: ${r.version}`;r.nonce||(r.nonce=(Math.random()+1).toString(36).substring(4));const u=`Nonce: ${r.nonce}`,v=`Chain ID: ${r.chainId}`,_=[a,c,v,u];if(r.issuedAt&&Date.parse(r.issuedAt),r.issuedAt=r.issuedAt?r.issuedAt:new Date().toISOString(),_.push(`Issued At: ${r.issuedAt}`),r.expirationTime){const E=`Expiration Time: ${r.expirationTime}`;_.push(E)}r.notBefore&&_.push(`Not Before: ${r.notBefore}`),r.requestId&&_.push(`Request ID: ${r.requestId}`),r.resources&&r.resources.length>=1&&_.push(["Resources:",...r.resources.map(E=>`- ${E}`)].join(`
`));const x=_.join(`
`);return r.statement&&(o=[o,r.statement].join(`

`)),[o,x].join(`

`)}function isHex(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function size(r){return isHex(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const version$3="1.21.3",getVersion=()=>`viem@${version$3}`;class BaseError extends Error{constructor(e,t={}){super(),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ViemError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:getVersion()});const n=t.cause instanceof BaseError?t.cause.details:t.cause?.message?t.cause.message:t.details,a=t.cause instanceof BaseError&&t.cause.docsPath||t.docsPath;this.message=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...a?[`Docs: https://viem.sh${a}.html${t.docsSlug?`#${t.docsSlug}`:""}`]:[],...n?[`Details: ${n}`]:[],`Version: ${this.version}`].join(`
`),t.cause&&(this.cause=t.cause),this.details=n,this.docsPath=a,this.metaMessages=t.metaMessages,this.shortMessage=e}walk(e){return walk(this,e)}}function walk(r,e){return e?.(r)?r:r&&typeof r=="object"&&"cause"in r?walk(r.cause,e):e?null:r}class SizeExceedsPaddingSizeError extends BaseError{constructor({size:e,targetSize:t,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SizeExceedsPaddingSizeError"})}}function pad(r,{dir:e,size:t=32}={}){return typeof r=="string"?padHex(r,{dir:e,size:t}):padBytes(r,{dir:e,size:t})}function padHex(r,{dir:e,size:t=32}={}){if(t===null)return r;const n=r.replace("0x","");if(n.length>t*2)throw new SizeExceedsPaddingSizeError({size:Math.ceil(n.length/2),targetSize:t,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function padBytes(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new SizeExceedsPaddingSizeError({size:r.length,targetSize:t,type:"bytes"});const n=new Uint8Array(t);for(let a=0;a<t;a++){const o=e==="right";n[o?a:t-a-1]=r[o?a:r.length-a-1]}return n}class IntegerOutOfRangeError extends BaseError{constructor({max:e,min:t,signed:n,size:a,value:o}){super(`Number "${o}" is not in safe ${a?`${a*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"IntegerOutOfRangeError"})}}class SizeOverflowError extends BaseError{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SizeOverflowError"})}}function assertSize(r,{size:e}){if(size(r)>e)throw new SizeOverflowError({givenSize:size(r),maxSize:e})}function numberToHex(r,e={}){const{signed:t,size:n}=e,a=BigInt(r);let o;n?t?o=(1n<<BigInt(n)*8n-1n)-1n:o=2n**(BigInt(n)*8n)-1n:typeof r=="number"&&(o=BigInt(Number.MAX_SAFE_INTEGER));const c=typeof o=="bigint"&&t?-o-1n:0;if(o&&a>o||a<c){const v=typeof r=="bigint"?"n":"";throw new IntegerOutOfRangeError({max:o?`${o}${v}`:void 0,min:`${c}${v}`,signed:t,size:n,value:`${r}${v}`})}const u=`0x${(t&&a<0?(1n<<BigInt(n*8))+BigInt(a):a).toString(16)}`;return n?pad(u,{size:n}):u}const encoder$1=new TextEncoder;function toBytes$3(r,e={}){return typeof r=="number"||typeof r=="bigint"?numberToBytes(r,e):typeof r=="boolean"?boolToBytes(r,e):isHex(r)?hexToBytes(r,e):stringToBytes(r,e)}function boolToBytes(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(assertSize(t,{size:e.size}),pad(t,{size:e.size})):t}const charCodeMap={zero:48,nine:57,A:65,F:70,a:97,f:102};function charCodeToBase16(r){if(r>=charCodeMap.zero&&r<=charCodeMap.nine)return r-charCodeMap.zero;if(r>=charCodeMap.A&&r<=charCodeMap.F)return r-(charCodeMap.A-10);if(r>=charCodeMap.a&&r<=charCodeMap.f)return r-(charCodeMap.a-10)}function hexToBytes(r,e={}){let t=r;e.size&&(assertSize(t,{size:e.size}),t=pad(t,{dir:"right",size:e.size}));let n=t.slice(2);n.length%2&&(n=`0${n}`);const a=n.length/2,o=new Uint8Array(a);for(let c=0,u=0;c<a;c++){const v=charCodeToBase16(n.charCodeAt(u++)),_=charCodeToBase16(n.charCodeAt(u++));if(v===void 0||_===void 0)throw new BaseError(`Invalid byte sequence ("${n[u-2]}${n[u-1]}" in "${n}").`);o[c]=v*16+_}return o}function numberToBytes(r,e){const t=numberToHex(r,e);return hexToBytes(t)}function stringToBytes(r,e={}){const t=encoder$1.encode(r);return typeof e.size=="number"?(assertSize(t,{size:e.size}),pad(t,{dir:"right",size:e.size})):t}function number$2(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function bytes$1(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function exists$1(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function output$1(r,e){bytes$1(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(r,e=!1){return e?{h:Number(r&U32_MASK64),l:Number(r>>_32n&U32_MASK64)}:{h:Number(r>>_32n&U32_MASK64)|0,l:Number(r&U32_MASK64)|0}}function split(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let a=0;a<r.length;a++){const{h:o,l:c}=fromBig(r[a],e);[t[a],n[a]]=[o,c]}return[t,n]}const rotlSH=(r,e,t)=>r<<t|e>>>32-t,rotlSL=(r,e,t)=>e<<t|r>>>32-t,rotlBH=(r,e,t)=>e<<t-32|r>>>64-t,rotlBL=(r,e,t)=>r<<t-32|e>>>64-t;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=r=>r instanceof Uint8Array,u32$1=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$1(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$2(r){if(typeof r=="string"&&(r=utf8ToBytes$1(r)),!u8a(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}class Hash{clone(){return this._cloneInto()}}function wrapConstructor(r){const e=n=>r().update(toBytes$2(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}const[SHA3_PI,SHA3_ROTL,_SHA3_IOTA]=[[],[],[]],_0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2),_7n=BigInt(7),_256n=BigInt(256),_0x71n=BigInt(113);for(let r=0,e=_1n,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],SHA3_PI.push(2*(5*n+t)),SHA3_ROTL.push((r+1)*(r+2)/2%64);let a=_0n;for(let o=0;o<7;o++)e=(e<<_1n^(e>>_7n)*_0x71n)%_256n,e&_2n&&(a^=_1n<<(_1n<<BigInt(o))-_1n);_SHA3_IOTA.push(a)}const[SHA3_IOTA_H,SHA3_IOTA_L]=split(_SHA3_IOTA,!0),rotlH=(r,e,t)=>t>32?rotlBH(r,e,t):rotlSH(r,e,t),rotlL=(r,e,t)=>t>32?rotlBL(r,e,t):rotlSL(r,e,t);function keccakP(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let c=0;c<10;c++)t[c]=r[c]^r[c+10]^r[c+20]^r[c+30]^r[c+40];for(let c=0;c<10;c+=2){const u=(c+8)%10,v=(c+2)%10,_=t[v],x=t[v+1],E=rotlH(_,x,1)^t[u],M=rotlL(_,x,1)^t[u+1];for(let C=0;C<50;C+=10)r[c+C]^=E,r[c+C+1]^=M}let a=r[2],o=r[3];for(let c=0;c<24;c++){const u=SHA3_ROTL[c],v=rotlH(a,o,u),_=rotlL(a,o,u),x=SHA3_PI[c];a=r[x],o=r[x+1],r[x]=v,r[x+1]=_}for(let c=0;c<50;c+=10){for(let u=0;u<10;u++)t[u]=r[c+u];for(let u=0;u<10;u++)r[c+u]^=~t[(u+2)%10]&t[(u+4)%10]}r[0]^=SHA3_IOTA_H[n],r[1]^=SHA3_IOTA_L[n]}t.fill(0)}class Keccak extends Hash{constructor(e,t,n,a=!1,o=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=a,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,number$2(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=u32$1(this.state)}keccak(){keccakP(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){exists$1(this);const{blockLen:t,state:n}=this;e=toBytes$2(e);const a=e.length;for(let o=0;o<a;){const c=Math.min(t-this.pos,a-o);for(let u=0;u<c;u++)n[this.pos++]^=e[o++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:a}=this;e[n]^=t,t&128&&n===a-1&&this.keccak(),e[a-1]^=128,this.keccak()}writeInto(e){exists$1(this,!1),bytes$1(e),this.finish();const t=this.state,{blockLen:n}=this;for(let a=0,o=e.length;a<o;){this.posOut>=n&&this.keccak();const c=Math.min(n-this.posOut,o-a);e.set(t.subarray(this.posOut,this.posOut+c),a),this.posOut+=c,a+=c}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return number$2(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(output$1(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:a,rounds:o,enableXOF:c}=this;return e||(e=new Keccak(t,n,a,c,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=n,e.outputLen=a,e.enableXOF=c,e.destroyed=this.destroyed,e}}const gen=(r,e,t)=>wrapConstructor(()=>new Keccak(e,r,t)),keccak_256=gen(1,136,256/8);function keccak256(r,e){return keccak_256(isHex(r,{strict:!1})?toBytes$3(r):r)}function checksumAddress(r,e){const t=r.substring(2).toLowerCase(),n=keccak256(stringToBytes(t)),a=t.split("");for(let o=0;o<40;o+=2)n[o>>1]>>4>=8&&a[o]&&(a[o]=a[o].toUpperCase()),(n[o>>1]&15)>=8&&a[o+1]&&(a[o+1]=a[o+1].toUpperCase());return`0x${a.join("")}`}class SiweMessage extends SiwxMessage{toMessage(){return super.toMessage("Ethereum")}toMessageEip55(){const e=checksumAddress(this.address);return super.toMessage("Ethereum",e)}signMessage({eip55:e}={}){let t;switch(this.type){case SignatureType.PERSONAL_SIGNATURE:{t=e?this.toMessageEip55():this.toMessage();break}default:{t=e?this.toMessageEip55():this.toMessage();break}}return t}}function equals(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function alloc$1(r=0){return new Uint8Array(r)}function allocUnsafe(r=0){return new Uint8Array(r)}function asUint8Array(r){return r}function xor$1(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=allocUnsafe(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}function concat$1(r,e){e==null&&(e=r.reduce((a,o)=>a+o.length,0));const t=allocUnsafe(e);let n=0;for(const a of r)t.set(a,n),n+=a.length;return t}const base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),alphabet=Array.from(""),alphabetBytesToChars=alphabet.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes=alphabet.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function encode$4(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars[t],e),"")}function decode$3(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const a=alphabetCharsToBytes[n];if(a==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(a)}return new Uint8Array(e)}const base256emoji=from$2({prefix:"",name:"base256emoji",encode:encode$4,decode:decode$3}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),identity=from$2({prefix:"\0",name:"identity",encode:r=>toString$4(r),decode:r=>fromString$3(r)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const code=85,bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$1,...base36$1,...base58,...base64$1,...base256emoji$1};function createCodec$1(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const string$1=createCodec$1("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ascii=createCodec$1("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=allocUnsafe(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BASES={utf8:string$1,"utf-8":string$1,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function fromString(r,e="utf8"){const t=BASES[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function toString$1(r,e="utf8"){const t=BASES[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const CLOCK_SKEW_DEFAULT_SEC=5*60;new Date("2022-09-20").valueOf();var Cacao;(function(r){function e(u){const v={h:{t:"eip4361"},p:{domain:u.domain,iat:u.issuedAt,iss:`did:pkh:eip155:${u.chainId}:${u.address}`,aud:u.uri,version:u.version,nonce:u.nonce}};return u.signature&&(v.s={t:"eip191",s:u.signature}),u.notBefore&&(v.p.nbf=u.notBefore),u.expirationTime&&(v.p.exp=u.expirationTime),u.statement&&(v.p.statement=u.statement),u.requestId&&(v.p.requestId=u.requestId),u.resources&&(v.p.resources=u.resources),v}r.fromSiweMessage=e;function t(u){const v={h:{t:"caip122"},p:{domain:u.domain,iat:u.issuedAt,iss:`did:pkh:solana:${u.chainId}:${u.address}`,aud:u.uri,version:u.version,nonce:u.nonce}};return u.signature&&(v.s={t:"solana:ed25519",s:u.signature}),u.notBefore&&(v.p.nbf=u.notBefore),u.expirationTime&&(v.p.exp=u.expirationTime),u.statement&&(v.p.statement=u.statement),u.requestId&&(v.p.requestId=u.requestId),u.resources&&(v.p.resources=u.resources),v}r.fromSiwsMessage=t;function n(u){const v={h:{t:"caip122"},p:{domain:u.domain,iat:u.issuedAt,iss:`did:pkh:tezos:${u.chainId}:${u.address}`,aud:u.uri,version:u.version,nonce:u.nonce}};return u.signature&&(v.s={t:"tezos:ed25519",s:u.signature}),u.notBefore&&(v.p.nbf=u.notBefore),u.expirationTime&&(v.p.exp=u.expirationTime),u.statement&&(v.p.statement=u.statement),u.requestId&&(v.p.requestId=u.requestId),u.resources&&(v.p.resources=u.resources),v}r.fromSiwTezosMessage=n;function a(u){const v={h:{t:"caip122"},p:{domain:u.domain,iat:u.issuedAt,iss:`did:pkh:stacks:${u.chainId}:${u.address}`,aud:u.uri,version:u.version,nonce:u.nonce}};return u.signature&&(v.s={t:"stacks:secp256k1",s:u.signature}),u.notBefore&&(v.p.nbf=u.notBefore),u.expirationTime&&(v.p.exp=u.expirationTime),u.statement&&(v.p.statement=u.statement),u.requestId&&(v.p.requestId=u.requestId),u.resources&&(v.p.resources=u.resources),v}r.fromSiwStacksMessage=a;async function o(u){return(await decode$7({bytes:u,codec:dagCbor,hasher:sha256$2})).value}r.fromBlockBytes=o;async function c(u,v={}){assertSigned(u);const _=v.verifiers[u.s.t];if(!_)throw new Error("Unsupported CACAO signature type, register the needed verifier");return _(u,v)}r.verify=c})(Cacao||(Cacao={}));var CacaoBlock;(function(r){function e(t){return encode$8({value:t,codec:dagCbor,hasher:sha256$2})}r.fromCacao=e})(CacaoBlock||(CacaoBlock={}));function assertSigned(r){if(r.s===null||r.s===void 0)throw new Error("CACAO does not have a signature")}function verifyTimeChecks(r,e){const t=e.atTime?e.atTime.getTime():Date.now(),n=(e.clockSkewSecs??CLOCK_SKEW_DEFAULT_SEC)*1e3;if(Date.parse(r.p.iat)>t+n||Date.parse(r.p.nbf)>t+n)throw new Error("CACAO is not valid yet");const a=e.revocationPhaseOutSecs?e.revocationPhaseOutSecs*1e3:0;if(!e.disableExpirationCheck&&Date.parse(r.p.exp)+a+n<t)throw new Error("CACAO has expired")}var random={},system={},browser$d={};Object.defineProperty(browser$d,"__esModule",{value:!0});browser$d.BrowserRandomSource=void 0;const QUOTA=65536;class BrowserRandomSource{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let n=0;n<t.length;n+=QUOTA)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,QUOTA)));return t}}browser$d.BrowserRandomSource=BrowserRandomSource;var node$1={},wipe$1={};Object.defineProperty(wipe$1,"__esModule",{value:!0});function wipe(r){for(var e=0;e<r.length;e++)r[e]=0;return r}wipe$1.wipe=wipe;var cryptoBrowserify={},browser$c={exports:{}},safeBuffer$1={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer$1;function requireSafeBuffer$1(){return hasRequiredSafeBuffer$1||(hasRequiredSafeBuffer$1=1,function(r,e){var t=bufferPolyfill,n=t.Buffer;function a(c,u){for(var v in c)u[v]=c[v]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=o);function o(c,u,v){return n(c,u,v)}o.prototype=Object.create(n.prototype),a(n,o),o.from=function(c,u,v){if(typeof c=="number")throw new TypeError("Argument must not be a number");return n(c,u,v)},o.alloc=function(c,u,v){if(typeof c!="number")throw new TypeError("Argument must be a number");var _=n(c);return u!==void 0?typeof v=="string"?_.fill(u,v):_.fill(u):_.fill(0),_},o.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return n(c)},o.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(c)}}(safeBuffer$1,safeBuffer$1.exports)),safeBuffer$1.exports}var hasRequiredBrowser$b;function requireBrowser$b(){if(hasRequiredBrowser$b)return browser$c.exports;hasRequiredBrowser$b=1;var r=65536,e=4294967295;function t(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var n=requireSafeBuffer$1().Buffer,a=commonjsGlobal.crypto||commonjsGlobal.msCrypto;a&&a.getRandomValues?browser$c.exports=o:browser$c.exports=t;function o(c,u){if(c>e)throw new RangeError("requested too many random bytes");var v=n.allocUnsafe(c);if(c>0)if(c>r)for(var _=0;_<c;_+=r)a.getRandomValues(v.slice(_,_+r));else a.getRandomValues(v);return typeof u=="function"?dist.process.nextTick(function(){u(null,v)}):v}return browser$c.exports}var inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}),inherits_browser.exports}var events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning(r){console&&console.warn&&console.warn(r)}var NumberIsNaN=Number.isNaN||function(e){return e!==e};function EventEmitter$1(){EventEmitter$1.init.call(this)}events$1.exports=EventEmitter$1;events$1.exports.once=once;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(r){if(typeof r!="number"||r<0||NumberIsNaN(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");defaultMaxListeners=r}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners(r){return r._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:r._maxListeners}EventEmitter$1.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a=e==="error",o=this._events;if(o!==void 0)a=a&&o.error===void 0;else if(!a)return!1;if(a){var c;if(t.length>0&&(c=t[0]),c instanceof Error)throw c;var u=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw u.context=c,u}var v=o[e];if(v===void 0)return!1;if(typeof v=="function")ReflectApply(v,this,t);else for(var _=v.length,x=arrayClone(v,_),n=0;n<_;++n)ReflectApply(x[n],this,t);return!0};function _addListener(r,e,t,n){var a,o,c;if(checkListener(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),c=o[e]),c===void 0)c=o[e]=t,++r._eventsCount;else if(typeof c=="function"?c=o[e]=n?[t,c]:[c,t]:n?c.unshift(t):c.push(t),a=_getMaxListeners(r),a>0&&c.length>a&&!c.warned){c.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=r,u.type=e,u.count=c.length,ProcessEmitWarning(u)}return r}EventEmitter$1.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},a=onceWrapper.bind(n);return a.listener=t,n.wrapFn=a,a}EventEmitter$1.prototype.once=function(e,t){return checkListener(t),this.on(e,_onceWrap(this,e,t)),this};EventEmitter$1.prototype.prependOnceListener=function(e,t){return checkListener(t),this.prependListener(e,_onceWrap(this,e,t)),this};EventEmitter$1.prototype.removeListener=function(e,t){var n,a,o,c,u;if(checkListener(t),a=this._events,a===void 0)return this;if(n=a[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,c=n.length-1;c>=0;c--)if(n[c]===t||n[c].listener===t){u=n[c].listener,o=c;break}if(o<0)return this;o===0?n.shift():spliceOne(n,o),n.length===1&&(a[e]=n[0]),a.removeListener!==void 0&&this.emit("removeListener",e,u||t)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function(e){var t,n,a;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),c;for(a=0;a<o.length;++a)c=o[a],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this};function _listeners(r,e,t){var n=r._events;if(n===void 0)return[];var a=n[e];return a===void 0?[]:typeof a=="function"?t?[a.listener||a]:[a]:t?unwrapListeners(a):arrayClone(a,a.length)}EventEmitter$1.prototype.listeners=function(e){return _listeners(this,e,!0)};EventEmitter$1.prototype.rawListeners=function(e){return _listeners(this,e,!1)};EventEmitter$1.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):listenerCount.call(r,e)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function spliceOne(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function unwrapListeners(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function once(r,e){return new Promise(function(t,n){function a(c){r.removeListener(e,o),n(c)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",a),t([].slice.call(arguments))}eventTargetAgnosticAddListener(r,e,o,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter(r,a,{once:!0})})}function addErrorHandlerIfEventEmitter(r,e,t){typeof r.on=="function"&&eventTargetAgnosticAddListener(r,"error",e,t)}function eventTargetAgnosticAddListener(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function a(o){n.once&&r.removeEventListener(e,a),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var eventsExports=events$1.exports,streamBrowser$1,hasRequiredStreamBrowser$1;function requireStreamBrowser$1(){return hasRequiredStreamBrowser$1||(hasRequiredStreamBrowser$1=1,streamBrowser$1=eventsExports.EventEmitter),streamBrowser$1}var util$1={},types={},shams$1,hasRequiredShams$1;function requireShams$1(){return hasRequiredShams$1||(hasRequiredShams$1=1,shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var a=42;e[t]=a;for(var o in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var c=Object.getOwnPropertySymbols(e);if(c.length!==1||c[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var u=Object.getOwnPropertyDescriptor(e,t);if(u.value!==a||u.enumerable!==!0)return!1}return!0}),shams$1}var shams,hasRequiredShams;function requireShams(){if(hasRequiredShams)return shams;hasRequiredShams=1;var r=requireShams$1();return shams=function(){return r()&&!!Symbol.toStringTag},shams}var esObjectAtoms,hasRequiredEsObjectAtoms;function requireEsObjectAtoms(){return hasRequiredEsObjectAtoms||(hasRequiredEsObjectAtoms=1,esObjectAtoms=Object),esObjectAtoms}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range=RangeError),range}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var type,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type=TypeError),type}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var abs,hasRequiredAbs;function requireAbs(){return hasRequiredAbs||(hasRequiredAbs=1,abs=Math.abs),abs}var floor,hasRequiredFloor;function requireFloor(){return hasRequiredFloor||(hasRequiredFloor=1,floor=Math.floor),floor}var max,hasRequiredMax;function requireMax(){return hasRequiredMax||(hasRequiredMax=1,max=Math.max),max}var min,hasRequiredMin;function requireMin(){return hasRequiredMin||(hasRequiredMin=1,min=Math.min),min}var pow,hasRequiredPow;function requirePow(){return hasRequiredPow||(hasRequiredPow=1,pow=Math.pow),pow}var round$1,hasRequiredRound;function requireRound(){return hasRequiredRound||(hasRequiredRound=1,round$1=Math.round),round$1}var _isNaN,hasRequired_isNaN;function require_isNaN(){return hasRequired_isNaN||(hasRequired_isNaN=1,_isNaN=Number.isNaN||function(e){return e!==e}),_isNaN}var sign$3,hasRequiredSign$1;function requireSign$1(){if(hasRequiredSign$1)return sign$3;hasRequiredSign$1=1;var r=require_isNaN();return sign$3=function(t){return r(t)||t===0?t:t<0?-1:1},sign$3}var gOPD,hasRequiredGOPD;function requireGOPD(){return hasRequiredGOPD||(hasRequiredGOPD=1,gOPD=Object.getOwnPropertyDescriptor),gOPD}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var r=requireGOPD();if(r)try{r([],"length")}catch{r=null}return gopd=r,gopd}var esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var r=Object.defineProperty||!1;if(r)try{r({},"a",{value:1})}catch{r=!1}return esDefineProperty=r,esDefineProperty}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var r=typeof Symbol<"u"&&Symbol,e=requireShams$1();return hasSymbols=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},hasSymbols}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var r=requireEsObjectAtoms();return Object_getPrototypeOf=r.getPrototypeOf||null,Object_getPrototypeOf}var implementation$1,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation$1;hasRequiredImplementation=1;var r="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,n="[object Function]",a=function(v,_){for(var x=[],E=0;E<v.length;E+=1)x[E]=v[E];for(var M=0;M<_.length;M+=1)x[M+v.length]=_[M];return x},o=function(v,_){for(var x=[],E=_,M=0;E<v.length;E+=1,M+=1)x[M]=v[E];return x},c=function(u,v){for(var _="",x=0;x<u.length;x+=1)_+=u[x],x+1<u.length&&(_+=v);return _};return implementation$1=function(v){var _=this;if(typeof _!="function"||e.apply(_)!==n)throw new TypeError(r+_);for(var x=o(arguments,1),E,M=function(){if(this instanceof E){var N=_.apply(this,a(x,arguments));return Object(N)===N?N:this}return _.apply(v,a(x,arguments))},C=t(0,_.length-x.length),I=[],D=0;D<C;D++)I[D]="$"+D;if(E=Function("binder","return function ("+c(I,",")+"){ return binder.apply(this,arguments); }")(M),_.prototype){var L=function(){};L.prototype=_.prototype,E.prototype=new L,L.prototype=null}return E},implementation$1}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var r=requireImplementation();return functionBind=Function.prototype.bind||r,functionBind}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){return hasRequiredFunctionCall||(hasRequiredFunctionCall=1,functionCall=Function.prototype.call),functionCall}var functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply,hasRequiredReflectApply;function requireReflectApply(){return hasRequiredReflectApply||(hasRequiredReflectApply=1,reflectApply=typeof Reflect<"u"&&Reflect&&Reflect.apply),reflectApply}var actualApply,hasRequiredActualApply;function requireActualApply(){if(hasRequiredActualApply)return actualApply;hasRequiredActualApply=1;var r=requireFunctionBind(),e=requireFunctionApply(),t=requireFunctionCall(),n=requireReflectApply();return actualApply=n||r.call(t,e),actualApply}var callBindApplyHelpers,hasRequiredCallBindApplyHelpers;function requireCallBindApplyHelpers(){if(hasRequiredCallBindApplyHelpers)return callBindApplyHelpers;hasRequiredCallBindApplyHelpers=1;var r=requireFunctionBind(),e=requireType(),t=requireFunctionCall(),n=requireActualApply();return callBindApplyHelpers=function(o){if(o.length<1||typeof o[0]!="function")throw new e("a function is required");return n(r,t,o)},callBindApplyHelpers}var get,hasRequiredGet;function requireGet(){if(hasRequiredGet)return get;hasRequiredGet=1;var r=requireCallBindApplyHelpers(),e=requireGopd(),t;try{t=[].__proto__===Array.prototype}catch(c){if(!c||typeof c!="object"||!("code"in c)||c.code!=="ERR_PROTO_ACCESS")throw c}var n=!!t&&e&&e(Object.prototype,"__proto__"),a=Object,o=a.getPrototypeOf;return get=n&&typeof n.get=="function"?r([n.get]):typeof o=="function"?function(u){return o(u==null?u:a(u))}:!1,get}var getProto,hasRequiredGetProto;function requireGetProto(){if(hasRequiredGetProto)return getProto;hasRequiredGetProto=1;var r=requireReflect_getPrototypeOf(),e=requireObject_getPrototypeOf(),t=requireGet();return getProto=r?function(a){return r(a)}:e?function(a){if(!a||typeof a!="object"&&typeof a!="function")throw new TypeError("getProto: not an object");return e(a)}:t?function(a){return t(a)}:null,getProto}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var r=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=requireFunctionBind();return hasown=t.call(r,e),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var r,e=requireEsObjectAtoms(),t=requireEsErrors(),n=require_eval(),a=requireRange(),o=requireRef(),c=requireSyntax(),u=requireType(),v=requireUri(),_=requireAbs(),x=requireFloor(),E=requireMax(),M=requireMin(),C=requirePow(),I=requireRound(),D=requireSign$1(),L=Function,N=function(ae){try{return L('"use strict"; return ('+ae+").constructor;")()}catch{}},q=requireGopd(),F=requireEsDefineProperty(),U=function(){throw new u},j=q?function(){try{return arguments.callee,U}catch{try{return q(arguments,"callee").get}catch{return U}}}():U,W=requireHasSymbols()(),X=requireGetProto(),J=requireObject_getPrototypeOf(),G=requireReflect_getPrototypeOf(),oe=requireFunctionApply(),O=requireFunctionCall(),l={},p=typeof Uint8Array>"u"||!X?r:X(Uint8Array),b={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?r:ArrayBuffer,"%ArrayIteratorPrototype%":W&&X?X([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":l,"%AsyncGenerator%":l,"%AsyncGeneratorFunction%":l,"%AsyncIteratorPrototype%":l,"%Atomics%":typeof Atomics>"u"?r:Atomics,"%BigInt%":typeof BigInt>"u"?r:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?r:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":n,"%Float32Array%":typeof Float32Array>"u"?r:Float32Array,"%Float64Array%":typeof Float64Array>"u"?r:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?r:FinalizationRegistry,"%Function%":L,"%GeneratorFunction%":l,"%Int8Array%":typeof Int8Array>"u"?r:Int8Array,"%Int16Array%":typeof Int16Array>"u"?r:Int16Array,"%Int32Array%":typeof Int32Array>"u"?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":W&&X?X(X([][Symbol.iterator]())):r,"%JSON%":typeof JSON=="object"?JSON:r,"%Map%":typeof Map>"u"?r:Map,"%MapIteratorPrototype%":typeof Map>"u"||!W||!X?r:X(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":q,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?r:Promise,"%Proxy%":typeof Proxy>"u"?r:Proxy,"%RangeError%":a,"%ReferenceError%":o,"%Reflect%":typeof Reflect>"u"?r:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?r:Set,"%SetIteratorPrototype%":typeof Set>"u"||!W||!X?r:X(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":W&&X?X(""[Symbol.iterator]()):r,"%Symbol%":W?Symbol:r,"%SyntaxError%":c,"%ThrowTypeError%":j,"%TypedArray%":p,"%TypeError%":u,"%Uint8Array%":typeof Uint8Array>"u"?r:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?r:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?r:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?r:Uint32Array,"%URIError%":v,"%WeakMap%":typeof WeakMap>"u"?r:WeakMap,"%WeakRef%":typeof WeakRef>"u"?r:WeakRef,"%WeakSet%":typeof WeakSet>"u"?r:WeakSet,"%Function.prototype.call%":O,"%Function.prototype.apply%":oe,"%Object.defineProperty%":F,"%Object.getPrototypeOf%":J,"%Math.abs%":_,"%Math.floor%":x,"%Math.max%":E,"%Math.min%":M,"%Math.pow%":C,"%Math.round%":I,"%Math.sign%":D,"%Reflect.getPrototypeOf%":G};if(X)try{null.error}catch(ae){var S=X(X(ae));b["%Error.prototype%"]=S}var T=function ae(ce){var le;if(ce==="%AsyncFunction%")le=N("async function () {}");else if(ce==="%GeneratorFunction%")le=N("function* () {}");else if(ce==="%AsyncGeneratorFunction%")le=N("async function* () {}");else if(ce==="%AsyncGenerator%"){var te=ae("%AsyncGeneratorFunction%");te&&(le=te.prototype)}else if(ce==="%AsyncIteratorPrototype%"){var he=ae("%AsyncGenerator%");he&&X&&(le=X(he.prototype))}return b[ce]=le,le},B={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$=requireFunctionBind(),A=requireHasown(),g=$.call(O,Array.prototype.concat),k=$.call(oe,Array.prototype.splice),H=$.call(O,String.prototype.replace),z=$.call(O,String.prototype.slice),Q=$.call(O,RegExp.prototype.exec),ie=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,ne=/\\(\\)?/g,Z=function(ce){var le=z(ce,0,1),te=z(ce,-1);if(le==="%"&&te!=="%")throw new c("invalid intrinsic syntax, expected closing `%`");if(te==="%"&&le!=="%")throw new c("invalid intrinsic syntax, expected opening `%`");var he=[];return H(ce,ie,function(Ae,ge,me,je){he[he.length]=me?H(je,ne,"$1"):ge||Ae}),he},se=function(ce,le){var te=ce,he;if(A(B,te)&&(he=B[te],te="%"+he[0]+"%"),A(b,te)){var Ae=b[te];if(Ae===l&&(Ae=T(te)),typeof Ae>"u"&&!le)throw new u("intrinsic "+ce+" exists, but is not available. Please file an issue!");return{alias:he,name:te,value:Ae}}throw new c("intrinsic "+ce+" does not exist!")};return getIntrinsic=function(ce,le){if(typeof ce!="string"||ce.length===0)throw new u("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof le!="boolean")throw new u('"allowMissing" argument must be a boolean');if(Q(/^%?[^%]*%?$/,ce)===null)throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var te=Z(ce),he=te.length>0?te[0]:"",Ae=se("%"+he+"%",le),ge=Ae.name,me=Ae.value,je=!1,we=Ae.alias;we&&(he=we[0],k(te,g([0,1],we)));for(var pe=1,Ke=!0;pe<te.length;pe+=1){var ye=te[pe],xe=z(ye,0,1),Ve=z(ye,-1);if((xe==='"'||xe==="'"||xe==="`"||Ve==='"'||Ve==="'"||Ve==="`")&&xe!==Ve)throw new c("property names with quotes must have matching quotes");if((ye==="constructor"||!Ke)&&(je=!0),he+="."+ye,ge="%"+he+"%",A(b,ge))me=b[ge];else if(me!=null){if(!(ye in me)){if(!le)throw new u("base intrinsic for "+ce+" exists, but the property is not available.");return}if(q&&pe+1>=te.length){var be=q(me,ye);Ke=!!be,Ke&&"get"in be&&!("originalValue"in be.get)?me=be.get:me=me[ye]}else Ke=A(me,ye),me=me[ye];Ke&&!je&&(b[ge]=me)}}return me},getIntrinsic}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var r=requireGetIntrinsic(),e=requireCallBindApplyHelpers(),t=e([r("%String.prototype.indexOf%")]);return callBound=function(a,o){var c=r(a,!!o);return typeof c=="function"&&t(a,".prototype.")>-1?e([c]):c},callBound}var isArguments,hasRequiredIsArguments;function requireIsArguments(){if(hasRequiredIsArguments)return isArguments;hasRequiredIsArguments=1;var r=requireShams()(),e=requireCallBound(),t=e("Object.prototype.toString"),n=function(u){return r&&u&&typeof u=="object"&&Symbol.toStringTag in u?!1:t(u)==="[object Arguments]"},a=function(u){return n(u)?!0:u!==null&&typeof u=="object"&&"length"in u&&typeof u.length=="number"&&u.length>=0&&t(u)!=="[object Array]"&&"callee"in u&&t(u.callee)==="[object Function]"},o=function(){return n(arguments)}();return n.isLegacyArguments=a,isArguments=o?n:a,isArguments}var isRegex,hasRequiredIsRegex;function requireIsRegex(){if(hasRequiredIsRegex)return isRegex;hasRequiredIsRegex=1;var r=requireCallBound(),e=requireShams()(),t=requireHasown(),n=requireGopd(),a;if(e){var o=r("RegExp.prototype.exec"),c={},u=function(){throw c},v={toString:u,valueOf:u};typeof Symbol.toPrimitive=="symbol"&&(v[Symbol.toPrimitive]=u),a=function(M){if(!M||typeof M!="object")return!1;var C=n(M,"lastIndex"),I=C&&t(C,"value");if(!I)return!1;try{o(M,v)}catch(D){return D===c}}}else{var _=r("Object.prototype.toString"),x="[object RegExp]";a=function(M){return!M||typeof M!="object"&&typeof M!="function"?!1:_(M)===x}}return isRegex=a,isRegex}var safeRegexTest,hasRequiredSafeRegexTest;function requireSafeRegexTest(){if(hasRequiredSafeRegexTest)return safeRegexTest;hasRequiredSafeRegexTest=1;var r=requireCallBound(),e=requireIsRegex(),t=r("RegExp.prototype.exec"),n=requireType();return safeRegexTest=function(o){if(!e(o))throw new n("`regex` must be a RegExp");return function(u){return t(o,u)!==null}},safeRegexTest}var isGeneratorFunction,hasRequiredIsGeneratorFunction;function requireIsGeneratorFunction(){if(hasRequiredIsGeneratorFunction)return isGeneratorFunction;hasRequiredIsGeneratorFunction=1;var r=requireCallBound(),e=requireSafeRegexTest(),t=e(/^\s*(?:function)?\*/),n=requireShams()(),a=requireGetProto(),o=r("Object.prototype.toString"),c=r("Function.prototype.toString"),u=function(){if(!n)return!1;try{return Function("return function*() {}")()}catch{}},v;return isGeneratorFunction=function(x){if(typeof x!="function")return!1;if(t(c(x)))return!0;if(!n){var E=o(x);return E==="[object GeneratorFunction]"}if(!a)return!1;if(typeof v>"u"){var M=u();v=M?a(M):!1}return a(x)===v},isGeneratorFunction}var isCallable,hasRequiredIsCallable;function requireIsCallable(){if(hasRequiredIsCallable)return isCallable;hasRequiredIsCallable=1;var r=Function.prototype.toString,e=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,t,n;if(typeof e=="function"&&typeof Object.defineProperty=="function")try{t=Object.defineProperty({},"length",{get:function(){throw n}}),n={},e(function(){throw 42},null,t)}catch(q){q!==n&&(e=null)}else e=null;var a=/^\s*class\b/,o=function(F){try{var U=r.call(F);return a.test(U)}catch{return!1}},c=function(F){try{return o(F)?!1:(r.call(F),!0)}catch{return!1}},u=Object.prototype.toString,v="[object Object]",_="[object Function]",x="[object GeneratorFunction]",E="[object HTMLAllCollection]",M="[object HTML document.all class]",C="[object HTMLCollection]",I=typeof Symbol=="function"&&!!Symbol.toStringTag,D=!(0 in[,]),L=function(){return!1};if(typeof document=="object"){var N=document.all;u.call(N)===u.call(document.all)&&(L=function(F){if((D||!F)&&(typeof F>"u"||typeof F=="object"))try{var U=u.call(F);return(U===E||U===M||U===C||U===v)&&F("")==null}catch{}return!1})}return isCallable=e?function(F){if(L(F))return!0;if(!F||typeof F!="function"&&typeof F!="object")return!1;try{e(F,null,t)}catch(U){if(U!==n)return!1}return!o(F)&&c(F)}:function(F){if(L(F))return!0;if(!F||typeof F!="function"&&typeof F!="object")return!1;if(I)return c(F);if(o(F))return!1;var U=u.call(F);return U!==_&&U!==x&&!/^\[object HTML/.test(U)?!1:c(F)},isCallable}var forEach_1,hasRequiredForEach;function requireForEach(){if(hasRequiredForEach)return forEach_1;hasRequiredForEach=1;var r=requireIsCallable(),e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,n=function(v,_,x){for(var E=0,M=v.length;E<M;E++)t.call(v,E)&&(x==null?_(v[E],E,v):_.call(x,v[E],E,v))},a=function(v,_,x){for(var E=0,M=v.length;E<M;E++)x==null?_(v.charAt(E),E,v):_.call(x,v.charAt(E),E,v)},o=function(v,_,x){for(var E in v)t.call(v,E)&&(x==null?_(v[E],E,v):_.call(x,v[E],E,v))},c=function(v,_,x){if(!r(_))throw new TypeError("iterator must be a function");var E;arguments.length>=3&&(E=x),e.call(v)==="[object Array]"?n(v,_,E):typeof v=="string"?a(v,_,E):o(v,_,E)};return forEach_1=c,forEach_1}var possibleTypedArrayNames,hasRequiredPossibleTypedArrayNames;function requirePossibleTypedArrayNames(){return hasRequiredPossibleTypedArrayNames||(hasRequiredPossibleTypedArrayNames=1,possibleTypedArrayNames=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),possibleTypedArrayNames}var availableTypedArrays,hasRequiredAvailableTypedArrays;function requireAvailableTypedArrays(){if(hasRequiredAvailableTypedArrays)return availableTypedArrays;hasRequiredAvailableTypedArrays=1;var r=requirePossibleTypedArrayNames(),e=typeof globalThis>"u"?commonjsGlobal:globalThis;return availableTypedArrays=function(){for(var n=[],a=0;a<r.length;a++)typeof e[r[a]]=="function"&&(n[n.length]=r[a]);return n},availableTypedArrays}var callBind={exports:{}},defineDataProperty,hasRequiredDefineDataProperty;function requireDefineDataProperty(){if(hasRequiredDefineDataProperty)return defineDataProperty;hasRequiredDefineDataProperty=1;var r=requireEsDefineProperty(),e=requireSyntax(),t=requireType(),n=requireGopd();return defineDataProperty=function(o,c,u){if(!o||typeof o!="object"&&typeof o!="function")throw new t("`obj` must be an object or a function`");if(typeof c!="string"&&typeof c!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var v=arguments.length>3?arguments[3]:null,_=arguments.length>4?arguments[4]:null,x=arguments.length>5?arguments[5]:null,E=arguments.length>6?arguments[6]:!1,M=!!n&&n(o,c);if(r)r(o,c,{configurable:x===null&&M?M.configurable:!x,enumerable:v===null&&M?M.enumerable:!v,value:u,writable:_===null&&M?M.writable:!_});else if(E||!v&&!_&&!x)o[c]=u;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},defineDataProperty}var hasPropertyDescriptors_1,hasRequiredHasPropertyDescriptors;function requireHasPropertyDescriptors(){if(hasRequiredHasPropertyDescriptors)return hasPropertyDescriptors_1;hasRequiredHasPropertyDescriptors=1;var r=requireEsDefineProperty(),e=function(){return!!r};return e.hasArrayLengthDefineBug=function(){if(!r)return null;try{return r([],"length",{value:1}).length!==1}catch{return!0}},hasPropertyDescriptors_1=e,hasPropertyDescriptors_1}var setFunctionLength,hasRequiredSetFunctionLength;function requireSetFunctionLength(){if(hasRequiredSetFunctionLength)return setFunctionLength;hasRequiredSetFunctionLength=1;var r=requireGetIntrinsic(),e=requireDefineDataProperty(),t=requireHasPropertyDescriptors()(),n=requireGopd(),a=requireType(),o=r("%Math.floor%");return setFunctionLength=function(u,v){if(typeof u!="function")throw new a("`fn` is not a function");if(typeof v!="number"||v<0||v>4294967295||o(v)!==v)throw new a("`length` must be a positive 32-bit integer");var _=arguments.length>2&&!!arguments[2],x=!0,E=!0;if("length"in u&&n){var M=n(u,"length");M&&!M.configurable&&(x=!1),M&&!M.writable&&(E=!1)}return(x||E||!_)&&(t?e(u,"length",v,!0,!0):e(u,"length",v)),u},setFunctionLength}var applyBind,hasRequiredApplyBind;function requireApplyBind(){if(hasRequiredApplyBind)return applyBind;hasRequiredApplyBind=1;var r=requireFunctionBind(),e=requireFunctionApply(),t=requireActualApply();return applyBind=function(){return t(r,e,arguments)},applyBind}var hasRequiredCallBind;function requireCallBind(){return hasRequiredCallBind||(hasRequiredCallBind=1,function(r){var e=requireSetFunctionLength(),t=requireEsDefineProperty(),n=requireCallBindApplyHelpers(),a=requireApplyBind();r.exports=function(c){var u=n(arguments),v=c.length-(arguments.length-1);return e(u,1+(v>0?v:0),!0)},t?t(r.exports,"apply",{value:a}):r.exports.apply=a}(callBind)),callBind.exports}var whichTypedArray,hasRequiredWhichTypedArray;function requireWhichTypedArray(){if(hasRequiredWhichTypedArray)return whichTypedArray;hasRequiredWhichTypedArray=1;var r=requireForEach(),e=requireAvailableTypedArrays(),t=requireCallBind(),n=requireCallBound(),a=requireGopd(),o=n("Object.prototype.toString"),c=requireShams()(),u=typeof globalThis>"u"?commonjsGlobal:globalThis,v=e(),_=n("String.prototype.slice"),x=Object.getPrototypeOf,E=n("Array.prototype.indexOf",!0)||function(L,N){for(var q=0;q<L.length;q+=1)if(L[q]===N)return q;return-1},M={__proto__:null};c&&a&&x?r(v,function(D){var L=new u[D];if(Symbol.toStringTag in L){var N=x(L),q=a(N,Symbol.toStringTag);if(!q){var F=x(N);q=a(F,Symbol.toStringTag)}M["$"+D]=t(q.get)}}):r(v,function(D){var L=new u[D],N=L.slice||L.set;N&&(M["$"+D]=t(N))});var C=function(L){var N=!1;return r(M,function(q,F){if(!N)try{"$"+q(L)===F&&(N=_(F,1))}catch{}}),N},I=function(L){var N=!1;return r(M,function(q,F){if(!N)try{q(L),N=_(F,1)}catch{}}),N};return whichTypedArray=function(L){if(!L||typeof L!="object")return!1;if(!c){var N=_(o(L),8,-1);return E(v,N)>-1?N:N!=="Object"?!1:I(L)}return a?C(L):null},whichTypedArray}var isTypedArray,hasRequiredIsTypedArray;function requireIsTypedArray(){if(hasRequiredIsTypedArray)return isTypedArray;hasRequiredIsTypedArray=1;var r=requireWhichTypedArray();return isTypedArray=function(t){return!!r(t)},isTypedArray}var hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,function(r){var e=requireIsArguments(),t=requireIsGeneratorFunction(),n=requireWhichTypedArray(),a=requireIsTypedArray();function o(pe){return pe.call.bind(pe)}var c=typeof BigInt<"u",u=typeof Symbol<"u",v=o(Object.prototype.toString),_=o(Number.prototype.valueOf),x=o(String.prototype.valueOf),E=o(Boolean.prototype.valueOf);if(c)var M=o(BigInt.prototype.valueOf);if(u)var C=o(Symbol.prototype.valueOf);function I(pe,Ke){if(typeof pe!="object")return!1;try{return Ke(pe),!0}catch{return!1}}r.isArgumentsObject=e,r.isGeneratorFunction=t,r.isTypedArray=a;function D(pe){return typeof Promise<"u"&&pe instanceof Promise||pe!==null&&typeof pe=="object"&&typeof pe.then=="function"&&typeof pe.catch=="function"}r.isPromise=D;function L(pe){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(pe):a(pe)||z(pe)}r.isArrayBufferView=L;function N(pe){return n(pe)==="Uint8Array"}r.isUint8Array=N;function q(pe){return n(pe)==="Uint8ClampedArray"}r.isUint8ClampedArray=q;function F(pe){return n(pe)==="Uint16Array"}r.isUint16Array=F;function U(pe){return n(pe)==="Uint32Array"}r.isUint32Array=U;function j(pe){return n(pe)==="Int8Array"}r.isInt8Array=j;function W(pe){return n(pe)==="Int16Array"}r.isInt16Array=W;function X(pe){return n(pe)==="Int32Array"}r.isInt32Array=X;function J(pe){return n(pe)==="Float32Array"}r.isFloat32Array=J;function G(pe){return n(pe)==="Float64Array"}r.isFloat64Array=G;function oe(pe){return n(pe)==="BigInt64Array"}r.isBigInt64Array=oe;function O(pe){return n(pe)==="BigUint64Array"}r.isBigUint64Array=O;function l(pe){return v(pe)==="[object Map]"}l.working=typeof Map<"u"&&l(new Map);function p(pe){return typeof Map>"u"?!1:l.working?l(pe):pe instanceof Map}r.isMap=p;function b(pe){return v(pe)==="[object Set]"}b.working=typeof Set<"u"&&b(new Set);function S(pe){return typeof Set>"u"?!1:b.working?b(pe):pe instanceof Set}r.isSet=S;function T(pe){return v(pe)==="[object WeakMap]"}T.working=typeof WeakMap<"u"&&T(new WeakMap);function B(pe){return typeof WeakMap>"u"?!1:T.working?T(pe):pe instanceof WeakMap}r.isWeakMap=B;function $(pe){return v(pe)==="[object WeakSet]"}$.working=typeof WeakSet<"u"&&$(new WeakSet);function A(pe){return $(pe)}r.isWeakSet=A;function g(pe){return v(pe)==="[object ArrayBuffer]"}g.working=typeof ArrayBuffer<"u"&&g(new ArrayBuffer);function k(pe){return typeof ArrayBuffer>"u"?!1:g.working?g(pe):pe instanceof ArrayBuffer}r.isArrayBuffer=k;function H(pe){return v(pe)==="[object DataView]"}H.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&H(new DataView(new ArrayBuffer(1),0,1));function z(pe){return typeof DataView>"u"?!1:H.working?H(pe):pe instanceof DataView}r.isDataView=z;var Q=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function ie(pe){return v(pe)==="[object SharedArrayBuffer]"}function ne(pe){return typeof Q>"u"?!1:(typeof ie.working>"u"&&(ie.working=ie(new Q)),ie.working?ie(pe):pe instanceof Q)}r.isSharedArrayBuffer=ne;function Z(pe){return v(pe)==="[object AsyncFunction]"}r.isAsyncFunction=Z;function se(pe){return v(pe)==="[object Map Iterator]"}r.isMapIterator=se;function ae(pe){return v(pe)==="[object Set Iterator]"}r.isSetIterator=ae;function ce(pe){return v(pe)==="[object Generator]"}r.isGeneratorObject=ce;function le(pe){return v(pe)==="[object WebAssembly.Module]"}r.isWebAssemblyCompiledModule=le;function te(pe){return I(pe,_)}r.isNumberObject=te;function he(pe){return I(pe,x)}r.isStringObject=he;function Ae(pe){return I(pe,E)}r.isBooleanObject=Ae;function ge(pe){return c&&I(pe,M)}r.isBigIntObject=ge;function me(pe){return u&&I(pe,C)}r.isSymbolObject=me;function je(pe){return te(pe)||he(pe)||Ae(pe)||ge(pe)||me(pe)}r.isBoxedPrimitive=je;function we(pe){return typeof Uint8Array<"u"&&(k(pe)||ne(pe))}r.isAnyArrayBuffer=we,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(pe){Object.defineProperty(r,pe,{enumerable:!1,value:function(){throw new Error(pe+" is not supported in userland")}})})}(types)),types}var isBufferBrowser,hasRequiredIsBufferBrowser;function requireIsBufferBrowser(){return hasRequiredIsBufferBrowser||(hasRequiredIsBufferBrowser=1,isBufferBrowser=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"}),isBufferBrowser}var hasRequiredUtil$1;function requireUtil$1(){return hasRequiredUtil$1||(hasRequiredUtil$1=1,function(r){var e={},t=Object.getOwnPropertyDescriptors||function(Q){for(var ie=Object.keys(Q),ne={},Z=0;Z<ie.length;Z++)ne[ie[Z]]=Object.getOwnPropertyDescriptor(Q,ie[Z]);return ne},n=/%[sdj%]/g;r.format=function(z){if(!W(z)){for(var Q=[],ie=0;ie<arguments.length;ie++)Q.push(u(arguments[ie]));return Q.join(" ")}for(var ie=1,ne=arguments,Z=ne.length,se=String(z).replace(n,function(ce){if(ce==="%%")return"%";if(ie>=Z)return ce;switch(ce){case"%s":return String(ne[ie++]);case"%d":return Number(ne[ie++]);case"%j":try{return JSON.stringify(ne[ie++])}catch{return"[Circular]"}default:return ce}}),ae=ne[ie];ie<Z;ae=ne[++ie])F(ae)||!oe(ae)?se+=" "+ae:se+=" "+u(ae);return se},r.deprecate=function(z,Q){if(typeof dist.process<"u"&&dist.process.noDeprecation===!0)return z;if(typeof dist.process>"u")return function(){return r.deprecate(z,Q).apply(this,arguments)};var ie=!1;function ne(){if(!ie){if(dist.process.throwDeprecation)throw new Error(Q);dist.process.traceDeprecation?console.trace(Q):console.error(Q),ie=!0}return z.apply(this,arguments)}return ne};var a={},o=/^$/;if(e.NODE_DEBUG){var c=e.NODE_DEBUG;c=c.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+c+"$","i")}r.debuglog=function(z){if(z=z.toUpperCase(),!a[z])if(o.test(z)){var Q=dist.process.pid;a[z]=function(){var ie=r.format.apply(r,arguments);console.error("%s %d: %s",z,Q,ie)}}else a[z]=function(){};return a[z]};function u(z,Q){var ie={seen:[],stylize:_};return arguments.length>=3&&(ie.depth=arguments[2]),arguments.length>=4&&(ie.colors=arguments[3]),q(Q)?ie.showHidden=Q:Q&&r._extend(ie,Q),J(ie.showHidden)&&(ie.showHidden=!1),J(ie.depth)&&(ie.depth=2),J(ie.colors)&&(ie.colors=!1),J(ie.customInspect)&&(ie.customInspect=!0),ie.colors&&(ie.stylize=v),E(ie,z,ie.depth)}r.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function v(z,Q){var ie=u.styles[Q];return ie?"\x1B["+u.colors[ie][0]+"m"+z+"\x1B["+u.colors[ie][1]+"m":z}function _(z,Q){return z}function x(z){var Q={};return z.forEach(function(ie,ne){Q[ie]=!0}),Q}function E(z,Q,ie){if(z.customInspect&&Q&&p(Q.inspect)&&Q.inspect!==r.inspect&&!(Q.constructor&&Q.constructor.prototype===Q)){var ne=Q.inspect(ie,z);return W(ne)||(ne=E(z,ne,ie)),ne}var Z=M(z,Q);if(Z)return Z;var se=Object.keys(Q),ae=x(se);if(z.showHidden&&(se=Object.getOwnPropertyNames(Q)),l(Q)&&(se.indexOf("message")>=0||se.indexOf("description")>=0))return C(Q);if(se.length===0){if(p(Q)){var ce=Q.name?": "+Q.name:"";return z.stylize("[Function"+ce+"]","special")}if(G(Q))return z.stylize(RegExp.prototype.toString.call(Q),"regexp");if(O(Q))return z.stylize(Date.prototype.toString.call(Q),"date");if(l(Q))return C(Q)}var le="",te=!1,he=["{","}"];if(N(Q)&&(te=!0,he=["[","]"]),p(Q)){var Ae=Q.name?": "+Q.name:"";le=" [Function"+Ae+"]"}if(G(Q)&&(le=" "+RegExp.prototype.toString.call(Q)),O(Q)&&(le=" "+Date.prototype.toUTCString.call(Q)),l(Q)&&(le=" "+C(Q)),se.length===0&&(!te||Q.length==0))return he[0]+le+he[1];if(ie<0)return G(Q)?z.stylize(RegExp.prototype.toString.call(Q),"regexp"):z.stylize("[Object]","special");z.seen.push(Q);var ge;return te?ge=I(z,Q,ie,ae,se):ge=se.map(function(me){return D(z,Q,ie,ae,me,te)}),z.seen.pop(),L(ge,le,he)}function M(z,Q){if(J(Q))return z.stylize("undefined","undefined");if(W(Q)){var ie="'"+JSON.stringify(Q).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return z.stylize(ie,"string")}if(j(Q))return z.stylize(""+Q,"number");if(q(Q))return z.stylize(""+Q,"boolean");if(F(Q))return z.stylize("null","null")}function C(z){return"["+Error.prototype.toString.call(z)+"]"}function I(z,Q,ie,ne,Z){for(var se=[],ae=0,ce=Q.length;ae<ce;++ae)A(Q,String(ae))?se.push(D(z,Q,ie,ne,String(ae),!0)):se.push("");return Z.forEach(function(le){le.match(/^\d+$/)||se.push(D(z,Q,ie,ne,le,!0))}),se}function D(z,Q,ie,ne,Z,se){var ae,ce,le;if(le=Object.getOwnPropertyDescriptor(Q,Z)||{value:Q[Z]},le.get?le.set?ce=z.stylize("[Getter/Setter]","special"):ce=z.stylize("[Getter]","special"):le.set&&(ce=z.stylize("[Setter]","special")),A(ne,Z)||(ae="["+Z+"]"),ce||(z.seen.indexOf(le.value)<0?(F(ie)?ce=E(z,le.value,null):ce=E(z,le.value,ie-1),ce.indexOf(`
`)>-1&&(se?ce=ce.split(`
`).map(function(te){return"  "+te}).join(`
`).slice(2):ce=`
`+ce.split(`
`).map(function(te){return"   "+te}).join(`
`))):ce=z.stylize("[Circular]","special")),J(ae)){if(se&&Z.match(/^\d+$/))return ce;ae=JSON.stringify(""+Z),ae.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(ae=ae.slice(1,-1),ae=z.stylize(ae,"name")):(ae=ae.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),ae=z.stylize(ae,"string"))}return ae+": "+ce}function L(z,Q,ie){var ne=z.reduce(function(Z,se){return se.indexOf(`
`)>=0,Z+se.replace(/\u001b\[\d\d?m/g,"").length+1},0);return ne>60?ie[0]+(Q===""?"":Q+`
 `)+" "+z.join(`,
  `)+" "+ie[1]:ie[0]+Q+" "+z.join(", ")+" "+ie[1]}r.types=requireTypes();function N(z){return Array.isArray(z)}r.isArray=N;function q(z){return typeof z=="boolean"}r.isBoolean=q;function F(z){return z===null}r.isNull=F;function U(z){return z==null}r.isNullOrUndefined=U;function j(z){return typeof z=="number"}r.isNumber=j;function W(z){return typeof z=="string"}r.isString=W;function X(z){return typeof z=="symbol"}r.isSymbol=X;function J(z){return z===void 0}r.isUndefined=J;function G(z){return oe(z)&&S(z)==="[object RegExp]"}r.isRegExp=G,r.types.isRegExp=G;function oe(z){return typeof z=="object"&&z!==null}r.isObject=oe;function O(z){return oe(z)&&S(z)==="[object Date]"}r.isDate=O,r.types.isDate=O;function l(z){return oe(z)&&(S(z)==="[object Error]"||z instanceof Error)}r.isError=l,r.types.isNativeError=l;function p(z){return typeof z=="function"}r.isFunction=p;function b(z){return z===null||typeof z=="boolean"||typeof z=="number"||typeof z=="string"||typeof z=="symbol"||typeof z>"u"}r.isPrimitive=b,r.isBuffer=requireIsBufferBrowser();function S(z){return Object.prototype.toString.call(z)}function T(z){return z<10?"0"+z.toString(10):z.toString(10)}var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function $(){var z=new Date,Q=[T(z.getHours()),T(z.getMinutes()),T(z.getSeconds())].join(":");return[z.getDate(),B[z.getMonth()],Q].join(" ")}r.log=function(){console.log("%s - %s",$(),r.format.apply(r,arguments))},r.inherits=requireInherits_browser(),r._extend=function(z,Q){if(!Q||!oe(Q))return z;for(var ie=Object.keys(Q),ne=ie.length;ne--;)z[ie[ne]]=Q[ie[ne]];return z};function A(z,Q){return Object.prototype.hasOwnProperty.call(z,Q)}var g=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;r.promisify=function(Q){if(typeof Q!="function")throw new TypeError('The "original" argument must be of type Function');if(g&&Q[g]){var ie=Q[g];if(typeof ie!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(ie,g,{value:ie,enumerable:!1,writable:!1,configurable:!0}),ie}function ie(){for(var ne,Z,se=new Promise(function(le,te){ne=le,Z=te}),ae=[],ce=0;ce<arguments.length;ce++)ae.push(arguments[ce]);ae.push(function(le,te){le?Z(le):ne(te)});try{Q.apply(this,ae)}catch(le){Z(le)}return se}return Object.setPrototypeOf(ie,Object.getPrototypeOf(Q)),g&&Object.defineProperty(ie,g,{value:ie,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(ie,t(Q))},r.promisify.custom=g;function k(z,Q){if(!z){var ie=new Error("Promise was rejected with a falsy value");ie.reason=z,z=ie}return Q(z)}function H(z){if(typeof z!="function")throw new TypeError('The "original" argument must be of type Function');function Q(){for(var ie=[],ne=0;ne<arguments.length;ne++)ie.push(arguments[ne]);var Z=ie.pop();if(typeof Z!="function")throw new TypeError("The last argument must be of type Function");var se=this,ae=function(){return Z.apply(se,arguments)};z.apply(this,ie).then(function(ce){dist.process.nextTick(ae.bind(null,null,ce))},function(ce){dist.process.nextTick(k.bind(null,ce,ae))})}return Object.setPrototypeOf(Q,Object.getPrototypeOf(z)),Object.defineProperties(Q,t(z)),Q}r.callbackify=H}(util$1)),util$1}var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;function r(I,D){var L=Object.keys(I);if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(I);D&&(N=N.filter(function(q){return Object.getOwnPropertyDescriptor(I,q).enumerable})),L.push.apply(L,N)}return L}function e(I){for(var D=1;D<arguments.length;D++){var L=arguments[D]!=null?arguments[D]:{};D%2?r(Object(L),!0).forEach(function(N){t(I,N,L[N])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(L)):r(Object(L)).forEach(function(N){Object.defineProperty(I,N,Object.getOwnPropertyDescriptor(L,N))})}return I}function t(I,D,L){return D=c(D),D in I?Object.defineProperty(I,D,{value:L,enumerable:!0,configurable:!0,writable:!0}):I[D]=L,I}function n(I,D){if(!(I instanceof D))throw new TypeError("Cannot call a class as a function")}function a(I,D){for(var L=0;L<D.length;L++){var N=D[L];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(I,c(N.key),N)}}function o(I,D,L){return D&&a(I.prototype,D),Object.defineProperty(I,"prototype",{writable:!1}),I}function c(I){var D=u(I,"string");return typeof D=="symbol"?D:String(D)}function u(I,D){if(typeof I!="object"||I===null)return I;var L=I[Symbol.toPrimitive];if(L!==void 0){var N=L.call(I,D);if(typeof N!="object")return N;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(I)}var v=bufferPolyfill,_=v.Buffer,x=requireUtil$1(),E=x.inspect,M=E&&E.custom||"inspect";function C(I,D,L){_.prototype.copy.call(I,D,L)}return buffer_list=function(){function I(){n(this,I),this.head=null,this.tail=null,this.length=0}return o(I,[{key:"push",value:function(L){var N={data:L,next:null};this.length>0?this.tail.next=N:this.head=N,this.tail=N,++this.length}},{key:"unshift",value:function(L){var N={data:L,next:this.head};this.length===0&&(this.tail=N),this.head=N,++this.length}},{key:"shift",value:function(){if(this.length!==0){var L=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,L}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(L){if(this.length===0)return"";for(var N=this.head,q=""+N.data;N=N.next;)q+=L+N.data;return q}},{key:"concat",value:function(L){if(this.length===0)return _.alloc(0);for(var N=_.allocUnsafe(L>>>0),q=this.head,F=0;q;)C(q.data,N,F),F+=q.data.length,q=q.next;return N}},{key:"consume",value:function(L,N){var q;return L<this.head.data.length?(q=this.head.data.slice(0,L),this.head.data=this.head.data.slice(L)):L===this.head.data.length?q=this.shift():q=N?this._getString(L):this._getBuffer(L),q}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(L){var N=this.head,q=1,F=N.data;for(L-=F.length;N=N.next;){var U=N.data,j=L>U.length?U.length:L;if(j===U.length?F+=U:F+=U.slice(0,L),L-=j,L===0){j===U.length?(++q,N.next?this.head=N.next:this.head=this.tail=null):(this.head=N,N.data=U.slice(j));break}++q}return this.length-=q,F}},{key:"_getBuffer",value:function(L){var N=_.allocUnsafe(L),q=this.head,F=1;for(q.data.copy(N),L-=q.data.length;q=q.next;){var U=q.data,j=L>U.length?U.length:L;if(U.copy(N,N.length-L,0,j),L-=j,L===0){j===U.length?(++F,q.next?this.head=q.next:this.head=this.tail=null):(this.head=q,q.data=U.slice(j));break}++F}return this.length-=F,N}},{key:M,value:function(L,N){return E(this,e(e({},N),{},{depth:0,customInspect:!1}))}}]),I}(),buffer_list}var destroy_1$1,hasRequiredDestroy$1;function requireDestroy$1(){if(hasRequiredDestroy$1)return destroy_1$1;hasRequiredDestroy$1=1;function r(c,u){var v=this,_=this._readableState&&this._readableState.destroyed,x=this._writableState&&this._writableState.destroyed;return _||x?(u?u(c):c&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,dist.process.nextTick(a,this,c)):dist.process.nextTick(a,this,c)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(c||null,function(E){!u&&E?v._writableState?v._writableState.errorEmitted?dist.process.nextTick(t,v):(v._writableState.errorEmitted=!0,dist.process.nextTick(e,v,E)):dist.process.nextTick(e,v,E):u?(dist.process.nextTick(t,v),u(E)):dist.process.nextTick(t,v)}),this)}function e(c,u){a(c,u),t(c)}function t(c){c._writableState&&!c._writableState.emitClose||c._readableState&&!c._readableState.emitClose||c.emit("close")}function n(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function a(c,u){c.emit("error",u)}function o(c,u){var v=c._readableState,_=c._writableState;v&&v.autoDestroy||_&&_.autoDestroy?c.destroy(u):c.emit("error",u)}return destroy_1$1={destroy:r,undestroy:n,errorOrDestroy:o},destroy_1$1}var errorsBrowser={},hasRequiredErrorsBrowser;function requireErrorsBrowser(){if(hasRequiredErrorsBrowser)return errorsBrowser;hasRequiredErrorsBrowser=1;function r(u,v){u.prototype=Object.create(v.prototype),u.prototype.constructor=u,u.__proto__=v}var e={};function t(u,v,_){_||(_=Error);function x(M,C,I){return typeof v=="string"?v:v(M,C,I)}var E=function(M){r(C,M);function C(I,D,L){return M.call(this,x(I,D,L))||this}return C}(_);E.prototype.name=_.name,E.prototype.code=u,e[u]=E}function n(u,v){if(Array.isArray(u)){var _=u.length;return u=u.map(function(x){return String(x)}),_>2?"one of ".concat(v," ").concat(u.slice(0,_-1).join(", "),", or ")+u[_-1]:_===2?"one of ".concat(v," ").concat(u[0]," or ").concat(u[1]):"of ".concat(v," ").concat(u[0])}else return"of ".concat(v," ").concat(String(u))}function a(u,v,_){return u.substr(0,v.length)===v}function o(u,v,_){return(_===void 0||_>u.length)&&(_=u.length),u.substring(_-v.length,_)===v}function c(u,v,_){return typeof _!="number"&&(_=0),_+v.length>u.length?!1:u.indexOf(v,_)!==-1}return t("ERR_INVALID_OPT_VALUE",function(u,v){return'The value "'+v+'" is invalid for option "'+u+'"'},TypeError),t("ERR_INVALID_ARG_TYPE",function(u,v,_){var x;typeof v=="string"&&a(v,"not ")?(x="must not be",v=v.replace(/^not /,"")):x="must be";var E;if(o(u," argument"))E="The ".concat(u," ").concat(x," ").concat(n(v,"type"));else{var M=c(u,".")?"property":"argument";E='The "'.concat(u,'" ').concat(M," ").concat(x," ").concat(n(v,"type"))}return E+=". Received type ".concat(typeof _),E},TypeError),t("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),t("ERR_METHOD_NOT_IMPLEMENTED",function(u){return"The "+u+" method is not implemented"}),t("ERR_STREAM_PREMATURE_CLOSE","Premature close"),t("ERR_STREAM_DESTROYED",function(u){return"Cannot call "+u+" after a stream was destroyed"}),t("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),t("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),t("ERR_STREAM_WRITE_AFTER_END","write after end"),t("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),t("ERR_UNKNOWN_ENCODING",function(u){return"Unknown encoding: "+u},TypeError),t("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),errorsBrowser.codes=e,errorsBrowser}var state,hasRequiredState;function requireState(){if(hasRequiredState)return state;hasRequiredState=1;var r=requireErrorsBrowser().codes.ERR_INVALID_OPT_VALUE;function e(n,a,o){return n.highWaterMark!=null?n.highWaterMark:a?n[o]:null}function t(n,a,o,c){var u=e(a,c,o);if(u!=null){if(!(isFinite(u)&&Math.floor(u)===u)||u<0){var v=c?o:"highWaterMark";throw new r(v,u)}return Math.floor(u)}return n.objectMode?16:16*1024}return state={getHighWaterMark:t},state}var browser$b,hasRequiredBrowser$a;function requireBrowser$a(){if(hasRequiredBrowser$a)return browser$b;hasRequiredBrowser$a=1,browser$b=r;function r(t,n){if(e("noDeprecation"))return t;var a=!1;function o(){if(!a){if(e("throwDeprecation"))throw new Error(n);e("traceDeprecation")?console.trace(n):console.warn(n),a=!0}return t.apply(this,arguments)}return o}function e(t){try{if(!commonjsGlobal.localStorage)return!1}catch{return!1}var n=commonjsGlobal.localStorage[t];return n==null?!1:String(n).toLowerCase()==="true"}return browser$b}var _stream_writable$1,hasRequired_stream_writable$1;function require_stream_writable$1(){if(hasRequired_stream_writable$1)return _stream_writable$1;hasRequired_stream_writable$1=1,_stream_writable$1=J;function r(ne){var Z=this;this.next=null,this.entry=null,this.finish=function(){ie(Z,ne)}}var e;J.WritableState=W;var t={deprecate:requireBrowser$a()},n=requireStreamBrowser$1(),a=bufferPolyfill.Buffer,o=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function c(ne){return a.from(ne)}function u(ne){return a.isBuffer(ne)||ne instanceof o}var v=requireDestroy$1(),_=requireState(),x=_.getHighWaterMark,E=requireErrorsBrowser().codes,M=E.ERR_INVALID_ARG_TYPE,C=E.ERR_METHOD_NOT_IMPLEMENTED,I=E.ERR_MULTIPLE_CALLBACK,D=E.ERR_STREAM_CANNOT_PIPE,L=E.ERR_STREAM_DESTROYED,N=E.ERR_STREAM_NULL_VALUES,q=E.ERR_STREAM_WRITE_AFTER_END,F=E.ERR_UNKNOWN_ENCODING,U=v.errorOrDestroy;requireInherits_browser()(J,n);function j(){}function W(ne,Z,se){e=e||require_stream_duplex$1(),ne=ne||{},typeof se!="boolean"&&(se=Z instanceof e),this.objectMode=!!ne.objectMode,se&&(this.objectMode=this.objectMode||!!ne.writableObjectMode),this.highWaterMark=x(this,ne,"writableHighWaterMark",se),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ae=ne.decodeStrings===!1;this.decodeStrings=!ae,this.defaultEncoding=ne.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(ce){T(Z,ce)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=ne.emitClose!==!1,this.autoDestroy=!!ne.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}W.prototype.getBuffer=function(){for(var Z=this.bufferedRequest,se=[];Z;)se.push(Z),Z=Z.next;return se},function(){try{Object.defineProperty(W.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var X;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(X=Function.prototype[Symbol.hasInstance],Object.defineProperty(J,Symbol.hasInstance,{value:function(Z){return X.call(this,Z)?!0:this!==J?!1:Z&&Z._writableState instanceof W}})):X=function(Z){return Z instanceof this};function J(ne){e=e||require_stream_duplex$1();var Z=this instanceof e;if(!Z&&!X.call(J,this))return new J(ne);this._writableState=new W(ne,this,Z),this.writable=!0,ne&&(typeof ne.write=="function"&&(this._write=ne.write),typeof ne.writev=="function"&&(this._writev=ne.writev),typeof ne.destroy=="function"&&(this._destroy=ne.destroy),typeof ne.final=="function"&&(this._final=ne.final)),n.call(this)}J.prototype.pipe=function(){U(this,new D)};function G(ne,Z){var se=new q;U(ne,se),dist.process.nextTick(Z,se)}function oe(ne,Z,se,ae){var ce;return se===null?ce=new N:typeof se!="string"&&!Z.objectMode&&(ce=new M("chunk",["string","Buffer"],se)),ce?(U(ne,ce),dist.process.nextTick(ae,ce),!1):!0}J.prototype.write=function(ne,Z,se){var ae=this._writableState,ce=!1,le=!ae.objectMode&&u(ne);return le&&!a.isBuffer(ne)&&(ne=c(ne)),typeof Z=="function"&&(se=Z,Z=null),le?Z="buffer":Z||(Z=ae.defaultEncoding),typeof se!="function"&&(se=j),ae.ending?G(this,se):(le||oe(this,ae,ne,se))&&(ae.pendingcb++,ce=l(this,ae,le,ne,Z,se)),ce},J.prototype.cork=function(){this._writableState.corked++},J.prototype.uncork=function(){var ne=this._writableState;ne.corked&&(ne.corked--,!ne.writing&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&A(this,ne))},J.prototype.setDefaultEncoding=function(Z){if(typeof Z=="string"&&(Z=Z.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Z+"").toLowerCase())>-1))throw new F(Z);return this._writableState.defaultEncoding=Z,this},Object.defineProperty(J.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function O(ne,Z,se){return!ne.objectMode&&ne.decodeStrings!==!1&&typeof Z=="string"&&(Z=a.from(Z,se)),Z}Object.defineProperty(J.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function l(ne,Z,se,ae,ce,le){if(!se){var te=O(Z,ae,ce);ae!==te&&(se=!0,ce="buffer",ae=te)}var he=Z.objectMode?1:ae.length;Z.length+=he;var Ae=Z.length<Z.highWaterMark;if(Ae||(Z.needDrain=!0),Z.writing||Z.corked){var ge=Z.lastBufferedRequest;Z.lastBufferedRequest={chunk:ae,encoding:ce,isBuf:se,callback:le,next:null},ge?ge.next=Z.lastBufferedRequest:Z.bufferedRequest=Z.lastBufferedRequest,Z.bufferedRequestCount+=1}else p(ne,Z,!1,he,ae,ce,le);return Ae}function p(ne,Z,se,ae,ce,le,te){Z.writelen=ae,Z.writecb=te,Z.writing=!0,Z.sync=!0,Z.destroyed?Z.onwrite(new L("write")):se?ne._writev(ce,Z.onwrite):ne._write(ce,le,Z.onwrite),Z.sync=!1}function b(ne,Z,se,ae,ce){--Z.pendingcb,se?(dist.process.nextTick(ce,ae),dist.process.nextTick(z,ne,Z),ne._writableState.errorEmitted=!0,U(ne,ae)):(ce(ae),ne._writableState.errorEmitted=!0,U(ne,ae),z(ne,Z))}function S(ne){ne.writing=!1,ne.writecb=null,ne.length-=ne.writelen,ne.writelen=0}function T(ne,Z){var se=ne._writableState,ae=se.sync,ce=se.writecb;if(typeof ce!="function")throw new I;if(S(se),Z)b(ne,se,ae,Z,ce);else{var le=g(se)||ne.destroyed;!le&&!se.corked&&!se.bufferProcessing&&se.bufferedRequest&&A(ne,se),ae?dist.process.nextTick(B,ne,se,le,ce):B(ne,se,le,ce)}}function B(ne,Z,se,ae){se||$(ne,Z),Z.pendingcb--,ae(),z(ne,Z)}function $(ne,Z){Z.length===0&&Z.needDrain&&(Z.needDrain=!1,ne.emit("drain"))}function A(ne,Z){Z.bufferProcessing=!0;var se=Z.bufferedRequest;if(ne._writev&&se&&se.next){var ae=Z.bufferedRequestCount,ce=new Array(ae),le=Z.corkedRequestsFree;le.entry=se;for(var te=0,he=!0;se;)ce[te]=se,se.isBuf||(he=!1),se=se.next,te+=1;ce.allBuffers=he,p(ne,Z,!0,Z.length,ce,"",le.finish),Z.pendingcb++,Z.lastBufferedRequest=null,le.next?(Z.corkedRequestsFree=le.next,le.next=null):Z.corkedRequestsFree=new r(Z),Z.bufferedRequestCount=0}else{for(;se;){var Ae=se.chunk,ge=se.encoding,me=se.callback,je=Z.objectMode?1:Ae.length;if(p(ne,Z,!1,je,Ae,ge,me),se=se.next,Z.bufferedRequestCount--,Z.writing)break}se===null&&(Z.lastBufferedRequest=null)}Z.bufferedRequest=se,Z.bufferProcessing=!1}J.prototype._write=function(ne,Z,se){se(new C("_write()"))},J.prototype._writev=null,J.prototype.end=function(ne,Z,se){var ae=this._writableState;return typeof ne=="function"?(se=ne,ne=null,Z=null):typeof Z=="function"&&(se=Z,Z=null),ne!=null&&this.write(ne,Z),ae.corked&&(ae.corked=1,this.uncork()),ae.ending||Q(this,ae,se),this},Object.defineProperty(J.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function g(ne){return ne.ending&&ne.length===0&&ne.bufferedRequest===null&&!ne.finished&&!ne.writing}function k(ne,Z){ne._final(function(se){Z.pendingcb--,se&&U(ne,se),Z.prefinished=!0,ne.emit("prefinish"),z(ne,Z)})}function H(ne,Z){!Z.prefinished&&!Z.finalCalled&&(typeof ne._final=="function"&&!Z.destroyed?(Z.pendingcb++,Z.finalCalled=!0,dist.process.nextTick(k,ne,Z)):(Z.prefinished=!0,ne.emit("prefinish")))}function z(ne,Z){var se=g(Z);if(se&&(H(ne,Z),Z.pendingcb===0&&(Z.finished=!0,ne.emit("finish"),Z.autoDestroy))){var ae=ne._readableState;(!ae||ae.autoDestroy&&ae.endEmitted)&&ne.destroy()}return se}function Q(ne,Z,se){Z.ending=!0,z(ne,Z),se&&(Z.finished?dist.process.nextTick(se):ne.once("finish",se)),Z.ended=!0,ne.writable=!1}function ie(ne,Z,se){var ae=ne.entry;for(ne.entry=null;ae;){var ce=ae.callback;Z.pendingcb--,ce(se),ae=ae.next}Z.corkedRequestsFree.next=ne}return Object.defineProperty(J.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Z){this._writableState&&(this._writableState.destroyed=Z)}}),J.prototype.destroy=v.destroy,J.prototype._undestroy=v.undestroy,J.prototype._destroy=function(ne,Z){Z(ne)},_stream_writable$1}var _stream_duplex$1,hasRequired_stream_duplex$1;function require_stream_duplex$1(){if(hasRequired_stream_duplex$1)return _stream_duplex$1;hasRequired_stream_duplex$1=1;var r=Object.keys||function(_){var x=[];for(var E in _)x.push(E);return x};_stream_duplex$1=c;var e=require_stream_readable$1(),t=require_stream_writable$1();requireInherits_browser()(c,e);for(var n=r(t.prototype),a=0;a<n.length;a++){var o=n[a];c.prototype[o]||(c.prototype[o]=t.prototype[o])}function c(_){if(!(this instanceof c))return new c(_);e.call(this,_),t.call(this,_),this.allowHalfOpen=!0,_&&(_.readable===!1&&(this.readable=!1),_.writable===!1&&(this.writable=!1),_.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",u)))}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function u(){this._writableState.ended||dist.process.nextTick(v,this)}function v(_){_.end()}return Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(x){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=x,this._writableState.destroyed=x)}}),_stream_duplex$1}var string_decoder={},hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var r=requireSafeBuffer$1().Buffer,e=r.isEncoding||function(N){switch(N=""+N,N&&N.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(N){if(!N)return"utf8";for(var q;;)switch(N){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return N;default:if(q)return;N=(""+N).toLowerCase(),q=!0}}function n(N){var q=t(N);if(typeof q!="string"&&(r.isEncoding===e||!e(N)))throw new Error("Unknown encoding: "+N);return q||N}string_decoder.StringDecoder=a;function a(N){this.encoding=n(N);var q;switch(this.encoding){case"utf16le":this.text=E,this.end=M,q=4;break;case"utf8":this.fillLast=v,q=4;break;case"base64":this.text=C,this.end=I,q=3;break;default:this.write=D,this.end=L;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(q)}a.prototype.write=function(N){if(N.length===0)return"";var q,F;if(this.lastNeed){if(q=this.fillLast(N),q===void 0)return"";F=this.lastNeed,this.lastNeed=0}else F=0;return F<N.length?q?q+this.text(N,F):this.text(N,F):q||""},a.prototype.end=x,a.prototype.text=_,a.prototype.fillLast=function(N){if(this.lastNeed<=N.length)return N.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);N.copy(this.lastChar,this.lastTotal-this.lastNeed,0,N.length),this.lastNeed-=N.length};function o(N){return N<=127?0:N>>5===6?2:N>>4===14?3:N>>3===30?4:N>>6===2?-1:-2}function c(N,q,F){var U=q.length-1;if(U<F)return 0;var j=o(q[U]);return j>=0?(j>0&&(N.lastNeed=j-1),j):--U<F||j===-2?0:(j=o(q[U]),j>=0?(j>0&&(N.lastNeed=j-2),j):--U<F||j===-2?0:(j=o(q[U]),j>=0?(j>0&&(j===2?j=0:N.lastNeed=j-3),j):0))}function u(N,q,F){if((q[0]&192)!==128)return N.lastNeed=0,"";if(N.lastNeed>1&&q.length>1){if((q[1]&192)!==128)return N.lastNeed=1,"";if(N.lastNeed>2&&q.length>2&&(q[2]&192)!==128)return N.lastNeed=2,""}}function v(N){var q=this.lastTotal-this.lastNeed,F=u(this,N);if(F!==void 0)return F;if(this.lastNeed<=N.length)return N.copy(this.lastChar,q,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);N.copy(this.lastChar,q,0,N.length),this.lastNeed-=N.length}function _(N,q){var F=c(this,N,q);if(!this.lastNeed)return N.toString("utf8",q);this.lastTotal=F;var U=N.length-(F-this.lastNeed);return N.copy(this.lastChar,0,U),N.toString("utf8",q,U)}function x(N){var q=N&&N.length?this.write(N):"";return this.lastNeed?q+"":q}function E(N,q){if((N.length-q)%2===0){var F=N.toString("utf16le",q);if(F){var U=F.charCodeAt(F.length-1);if(U>=55296&&U<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=N[N.length-2],this.lastChar[1]=N[N.length-1],F.slice(0,-1)}return F}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=N[N.length-1],N.toString("utf16le",q,N.length-1)}function M(N){var q=N&&N.length?this.write(N):"";if(this.lastNeed){var F=this.lastTotal-this.lastNeed;return q+this.lastChar.toString("utf16le",0,F)}return q}function C(N,q){var F=(N.length-q)%3;return F===0?N.toString("base64",q):(this.lastNeed=3-F,this.lastTotal=3,F===1?this.lastChar[0]=N[N.length-1]:(this.lastChar[0]=N[N.length-2],this.lastChar[1]=N[N.length-1]),N.toString("base64",q,N.length-F))}function I(N){var q=N&&N.length?this.write(N):"";return this.lastNeed?q+this.lastChar.toString("base64",0,3-this.lastNeed):q}function D(N){return N.toString(this.encoding)}function L(N){return N&&N.length?this.write(N):""}return string_decoder}var endOfStream,hasRequiredEndOfStream;function requireEndOfStream(){if(hasRequiredEndOfStream)return endOfStream;hasRequiredEndOfStream=1;var r=requireErrorsBrowser().codes.ERR_STREAM_PREMATURE_CLOSE;function e(o){var c=!1;return function(){if(!c){c=!0;for(var u=arguments.length,v=new Array(u),_=0;_<u;_++)v[_]=arguments[_];o.apply(this,v)}}}function t(){}function n(o){return o.setHeader&&typeof o.abort=="function"}function a(o,c,u){if(typeof c=="function")return a(o,null,c);c||(c={}),u=e(u||t);var v=c.readable||c.readable!==!1&&o.readable,_=c.writable||c.writable!==!1&&o.writable,x=function(){o.writable||M()},E=o._writableState&&o._writableState.finished,M=function(){_=!1,E=!0,v||u.call(o)},C=o._readableState&&o._readableState.endEmitted,I=function(){v=!1,C=!0,_||u.call(o)},D=function(F){u.call(o,F)},L=function(){var F;if(v&&!C)return(!o._readableState||!o._readableState.ended)&&(F=new r),u.call(o,F);if(_&&!E)return(!o._writableState||!o._writableState.ended)&&(F=new r),u.call(o,F)},N=function(){o.req.on("finish",M)};return n(o)?(o.on("complete",M),o.on("abort",L),o.req?N():o.on("request",N)):_&&!o._writableState&&(o.on("end",x),o.on("close",x)),o.on("end",I),o.on("finish",M),c.error!==!1&&o.on("error",D),o.on("close",L),function(){o.removeListener("complete",M),o.removeListener("abort",L),o.removeListener("request",N),o.req&&o.req.removeListener("finish",M),o.removeListener("end",x),o.removeListener("close",x),o.removeListener("finish",M),o.removeListener("end",I),o.removeListener("error",D),o.removeListener("close",L)}}return endOfStream=a,endOfStream}var async_iterator,hasRequiredAsync_iterator;function requireAsync_iterator(){if(hasRequiredAsync_iterator)return async_iterator;hasRequiredAsync_iterator=1;var r;function e(F,U,j){return U=t(U),U in F?Object.defineProperty(F,U,{value:j,enumerable:!0,configurable:!0,writable:!0}):F[U]=j,F}function t(F){var U=n(F,"string");return typeof U=="symbol"?U:String(U)}function n(F,U){if(typeof F!="object"||F===null)return F;var j=F[Symbol.toPrimitive];if(j!==void 0){var W=j.call(F,U);if(typeof W!="object")return W;throw new TypeError("@@toPrimitive must return a primitive value.")}return(U==="string"?String:Number)(F)}var a=requireEndOfStream(),o=Symbol("lastResolve"),c=Symbol("lastReject"),u=Symbol("error"),v=Symbol("ended"),_=Symbol("lastPromise"),x=Symbol("handlePromise"),E=Symbol("stream");function M(F,U){return{value:F,done:U}}function C(F){var U=F[o];if(U!==null){var j=F[E].read();j!==null&&(F[_]=null,F[o]=null,F[c]=null,U(M(j,!1)))}}function I(F){dist.process.nextTick(C,F)}function D(F,U){return function(j,W){F.then(function(){if(U[v]){j(M(void 0,!0));return}U[x](j,W)},W)}}var L=Object.getPrototypeOf(function(){}),N=Object.setPrototypeOf((r={get stream(){return this[E]},next:function(){var U=this,j=this[u];if(j!==null)return Promise.reject(j);if(this[v])return Promise.resolve(M(void 0,!0));if(this[E].destroyed)return new Promise(function(G,oe){dist.process.nextTick(function(){U[u]?oe(U[u]):G(M(void 0,!0))})});var W=this[_],X;if(W)X=new Promise(D(W,this));else{var J=this[E].read();if(J!==null)return Promise.resolve(M(J,!1));X=new Promise(this[x])}return this[_]=X,X}},e(r,Symbol.asyncIterator,function(){return this}),e(r,"return",function(){var U=this;return new Promise(function(j,W){U[E].destroy(null,function(X){if(X){W(X);return}j(M(void 0,!0))})})}),r),L),q=function(U){var j,W=Object.create(N,(j={},e(j,E,{value:U,writable:!0}),e(j,o,{value:null,writable:!0}),e(j,c,{value:null,writable:!0}),e(j,u,{value:null,writable:!0}),e(j,v,{value:U._readableState.endEmitted,writable:!0}),e(j,x,{value:function(J,G){var oe=W[E].read();oe?(W[_]=null,W[o]=null,W[c]=null,J(M(oe,!1))):(W[o]=J,W[c]=G)},writable:!0}),j));return W[_]=null,a(U,function(X){if(X&&X.code!=="ERR_STREAM_PREMATURE_CLOSE"){var J=W[c];J!==null&&(W[_]=null,W[o]=null,W[c]=null,J(X)),W[u]=X;return}var G=W[o];G!==null&&(W[_]=null,W[o]=null,W[c]=null,G(M(void 0,!0))),W[v]=!0}),U.on("readable",I.bind(null,W)),W};return async_iterator=q,async_iterator}var fromBrowser,hasRequiredFromBrowser;function requireFromBrowser(){return hasRequiredFromBrowser||(hasRequiredFromBrowser=1,fromBrowser=function(){throw new Error("Readable.from is not available in the browser")}),fromBrowser}var _stream_readable$1,hasRequired_stream_readable$1;function require_stream_readable$1(){if(hasRequired_stream_readable$1)return _stream_readable$1;hasRequired_stream_readable$1=1,_stream_readable$1=G;var r;G.ReadableState=J,eventsExports.EventEmitter;var e=function(te,he){return te.listeners(he).length},t=requireStreamBrowser$1(),n=bufferPolyfill.Buffer,a=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(le){return n.from(le)}function c(le){return n.isBuffer(le)||le instanceof a}var u=requireUtil$1(),v;u&&u.debuglog?v=u.debuglog("stream"):v=function(){};var _=requireBuffer_list(),x=requireDestroy$1(),E=requireState(),M=E.getHighWaterMark,C=requireErrorsBrowser().codes,I=C.ERR_INVALID_ARG_TYPE,D=C.ERR_STREAM_PUSH_AFTER_EOF,L=C.ERR_METHOD_NOT_IMPLEMENTED,N=C.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,q,F,U;requireInherits_browser()(G,t);var j=x.errorOrDestroy,W=["error","close","destroy","pause","resume"];function X(le,te,he){if(typeof le.prependListener=="function")return le.prependListener(te,he);!le._events||!le._events[te]?le.on(te,he):Array.isArray(le._events[te])?le._events[te].unshift(he):le._events[te]=[he,le._events[te]]}function J(le,te,he){r=r||require_stream_duplex$1(),le=le||{},typeof he!="boolean"&&(he=te instanceof r),this.objectMode=!!le.objectMode,he&&(this.objectMode=this.objectMode||!!le.readableObjectMode),this.highWaterMark=M(this,le,"readableHighWaterMark",he),this.buffer=new _,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=le.emitClose!==!1,this.autoDestroy=!!le.autoDestroy,this.destroyed=!1,this.defaultEncoding=le.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,le.encoding&&(q||(q=requireString_decoder().StringDecoder),this.decoder=new q(le.encoding),this.encoding=le.encoding)}function G(le){if(r=r||require_stream_duplex$1(),!(this instanceof G))return new G(le);var te=this instanceof r;this._readableState=new J(le,this,te),this.readable=!0,le&&(typeof le.read=="function"&&(this._read=le.read),typeof le.destroy=="function"&&(this._destroy=le.destroy)),t.call(this)}Object.defineProperty(G.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(te){this._readableState&&(this._readableState.destroyed=te)}}),G.prototype.destroy=x.destroy,G.prototype._undestroy=x.undestroy,G.prototype._destroy=function(le,te){te(le)},G.prototype.push=function(le,te){var he=this._readableState,Ae;return he.objectMode?Ae=!0:typeof le=="string"&&(te=te||he.defaultEncoding,te!==he.encoding&&(le=n.from(le,te),te=""),Ae=!0),oe(this,le,te,!1,Ae)},G.prototype.unshift=function(le){return oe(this,le,null,!0,!1)};function oe(le,te,he,Ae,ge){v("readableAddChunk",te);var me=le._readableState;if(te===null)me.reading=!1,T(le,me);else{var je;if(ge||(je=l(me,te)),je)j(le,je);else if(me.objectMode||te&&te.length>0)if(typeof te!="string"&&!me.objectMode&&Object.getPrototypeOf(te)!==n.prototype&&(te=o(te)),Ae)me.endEmitted?j(le,new N):O(le,me,te,!0);else if(me.ended)j(le,new D);else{if(me.destroyed)return!1;me.reading=!1,me.decoder&&!he?(te=me.decoder.write(te),me.objectMode||te.length!==0?O(le,me,te,!1):A(le,me)):O(le,me,te,!1)}else Ae||(me.reading=!1,A(le,me))}return!me.ended&&(me.length<me.highWaterMark||me.length===0)}function O(le,te,he,Ae){te.flowing&&te.length===0&&!te.sync?(te.awaitDrain=0,le.emit("data",he)):(te.length+=te.objectMode?1:he.length,Ae?te.buffer.unshift(he):te.buffer.push(he),te.needReadable&&B(le)),A(le,te)}function l(le,te){var he;return!c(te)&&typeof te!="string"&&te!==void 0&&!le.objectMode&&(he=new I("chunk",["string","Buffer","Uint8Array"],te)),he}G.prototype.isPaused=function(){return this._readableState.flowing===!1},G.prototype.setEncoding=function(le){q||(q=requireString_decoder().StringDecoder);var te=new q(le);this._readableState.decoder=te,this._readableState.encoding=this._readableState.decoder.encoding;for(var he=this._readableState.buffer.head,Ae="";he!==null;)Ae+=te.write(he.data),he=he.next;return this._readableState.buffer.clear(),Ae!==""&&this._readableState.buffer.push(Ae),this._readableState.length=Ae.length,this};var p=1073741824;function b(le){return le>=p?le=p:(le--,le|=le>>>1,le|=le>>>2,le|=le>>>4,le|=le>>>8,le|=le>>>16,le++),le}function S(le,te){return le<=0||te.length===0&&te.ended?0:te.objectMode?1:le!==le?te.flowing&&te.length?te.buffer.head.data.length:te.length:(le>te.highWaterMark&&(te.highWaterMark=b(le)),le<=te.length?le:te.ended?te.length:(te.needReadable=!0,0))}G.prototype.read=function(le){v("read",le),le=parseInt(le,10);var te=this._readableState,he=le;if(le!==0&&(te.emittedReadable=!1),le===0&&te.needReadable&&((te.highWaterMark!==0?te.length>=te.highWaterMark:te.length>0)||te.ended))return v("read: emitReadable",te.length,te.ended),te.length===0&&te.ended?se(this):B(this),null;if(le=S(le,te),le===0&&te.ended)return te.length===0&&se(this),null;var Ae=te.needReadable;v("need readable",Ae),(te.length===0||te.length-le<te.highWaterMark)&&(Ae=!0,v("length less than watermark",Ae)),te.ended||te.reading?(Ae=!1,v("reading or ended",Ae)):Ae&&(v("do read"),te.reading=!0,te.sync=!0,te.length===0&&(te.needReadable=!0),this._read(te.highWaterMark),te.sync=!1,te.reading||(le=S(he,te)));var ge;return le>0?ge=Z(le,te):ge=null,ge===null?(te.needReadable=te.length<=te.highWaterMark,le=0):(te.length-=le,te.awaitDrain=0),te.length===0&&(te.ended||(te.needReadable=!0),he!==le&&te.ended&&se(this)),ge!==null&&this.emit("data",ge),ge};function T(le,te){if(v("onEofChunk"),!te.ended){if(te.decoder){var he=te.decoder.end();he&&he.length&&(te.buffer.push(he),te.length+=te.objectMode?1:he.length)}te.ended=!0,te.sync?B(le):(te.needReadable=!1,te.emittedReadable||(te.emittedReadable=!0,$(le)))}}function B(le){var te=le._readableState;v("emitReadable",te.needReadable,te.emittedReadable),te.needReadable=!1,te.emittedReadable||(v("emitReadable",te.flowing),te.emittedReadable=!0,dist.process.nextTick($,le))}function $(le){var te=le._readableState;v("emitReadable_",te.destroyed,te.length,te.ended),!te.destroyed&&(te.length||te.ended)&&(le.emit("readable"),te.emittedReadable=!1),te.needReadable=!te.flowing&&!te.ended&&te.length<=te.highWaterMark,ne(le)}function A(le,te){te.readingMore||(te.readingMore=!0,dist.process.nextTick(g,le,te))}function g(le,te){for(;!te.reading&&!te.ended&&(te.length<te.highWaterMark||te.flowing&&te.length===0);){var he=te.length;if(v("maybeReadMore read 0"),le.read(0),he===te.length)break}te.readingMore=!1}G.prototype._read=function(le){j(this,new L("_read()"))},G.prototype.pipe=function(le,te){var he=this,Ae=this._readableState;switch(Ae.pipesCount){case 0:Ae.pipes=le;break;case 1:Ae.pipes=[Ae.pipes,le];break;default:Ae.pipes.push(le);break}Ae.pipesCount+=1,v("pipe count=%d opts=%j",Ae.pipesCount,te);var ge=(!te||te.end!==!1)&&le!==dist.process.stdout&&le!==dist.process.stderr,me=ge?we:Ge;Ae.endEmitted?dist.process.nextTick(me):he.once("end",me),le.on("unpipe",je);function je(re,Y){v("onunpipe"),re===he&&Y&&Y.hasUnpiped===!1&&(Y.hasUnpiped=!0,ye())}function we(){v("onend"),le.end()}var pe=k(he);le.on("drain",pe);var Ke=!1;function ye(){v("cleanup"),le.removeListener("close",be),le.removeListener("finish",Ee),le.removeListener("drain",pe),le.removeListener("error",Ve),le.removeListener("unpipe",je),he.removeListener("end",we),he.removeListener("end",Ge),he.removeListener("data",xe),Ke=!0,Ae.awaitDrain&&(!le._writableState||le._writableState.needDrain)&&pe()}he.on("data",xe);function xe(re){v("ondata");var Y=le.write(re);v("dest.write",Y),Y===!1&&((Ae.pipesCount===1&&Ae.pipes===le||Ae.pipesCount>1&&ce(Ae.pipes,le)!==-1)&&!Ke&&(v("false write response, pause",Ae.awaitDrain),Ae.awaitDrain++),he.pause())}function Ve(re){v("onerror",re),Ge(),le.removeListener("error",Ve),e(le,"error")===0&&j(le,re)}X(le,"error",Ve);function be(){le.removeListener("finish",Ee),Ge()}le.once("close",be);function Ee(){v("onfinish"),le.removeListener("close",be),Ge()}le.once("finish",Ee);function Ge(){v("unpipe"),he.unpipe(le)}return le.emit("pipe",he),Ae.flowing||(v("pipe resume"),he.resume()),le};function k(le){return function(){var he=le._readableState;v("pipeOnDrain",he.awaitDrain),he.awaitDrain&&he.awaitDrain--,he.awaitDrain===0&&e(le,"data")&&(he.flowing=!0,ne(le))}}G.prototype.unpipe=function(le){var te=this._readableState,he={hasUnpiped:!1};if(te.pipesCount===0)return this;if(te.pipesCount===1)return le&&le!==te.pipes?this:(le||(le=te.pipes),te.pipes=null,te.pipesCount=0,te.flowing=!1,le&&le.emit("unpipe",this,he),this);if(!le){var Ae=te.pipes,ge=te.pipesCount;te.pipes=null,te.pipesCount=0,te.flowing=!1;for(var me=0;me<ge;me++)Ae[me].emit("unpipe",this,{hasUnpiped:!1});return this}var je=ce(te.pipes,le);return je===-1?this:(te.pipes.splice(je,1),te.pipesCount-=1,te.pipesCount===1&&(te.pipes=te.pipes[0]),le.emit("unpipe",this,he),this)},G.prototype.on=function(le,te){var he=t.prototype.on.call(this,le,te),Ae=this._readableState;return le==="data"?(Ae.readableListening=this.listenerCount("readable")>0,Ae.flowing!==!1&&this.resume()):le==="readable"&&!Ae.endEmitted&&!Ae.readableListening&&(Ae.readableListening=Ae.needReadable=!0,Ae.flowing=!1,Ae.emittedReadable=!1,v("on readable",Ae.length,Ae.reading),Ae.length?B(this):Ae.reading||dist.process.nextTick(z,this)),he},G.prototype.addListener=G.prototype.on,G.prototype.removeListener=function(le,te){var he=t.prototype.removeListener.call(this,le,te);return le==="readable"&&dist.process.nextTick(H,this),he},G.prototype.removeAllListeners=function(le){var te=t.prototype.removeAllListeners.apply(this,arguments);return(le==="readable"||le===void 0)&&dist.process.nextTick(H,this),te};function H(le){var te=le._readableState;te.readableListening=le.listenerCount("readable")>0,te.resumeScheduled&&!te.paused?te.flowing=!0:le.listenerCount("data")>0&&le.resume()}function z(le){v("readable nexttick read 0"),le.read(0)}G.prototype.resume=function(){var le=this._readableState;return le.flowing||(v("resume"),le.flowing=!le.readableListening,Q(this,le)),le.paused=!1,this};function Q(le,te){te.resumeScheduled||(te.resumeScheduled=!0,dist.process.nextTick(ie,le,te))}function ie(le,te){v("resume",te.reading),te.reading||le.read(0),te.resumeScheduled=!1,le.emit("resume"),ne(le),te.flowing&&!te.reading&&le.read(0)}G.prototype.pause=function(){return v("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(v("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function ne(le){var te=le._readableState;for(v("flow",te.flowing);te.flowing&&le.read()!==null;);}G.prototype.wrap=function(le){var te=this,he=this._readableState,Ae=!1;le.on("end",function(){if(v("wrapped end"),he.decoder&&!he.ended){var je=he.decoder.end();je&&je.length&&te.push(je)}te.push(null)}),le.on("data",function(je){if(v("wrapped data"),he.decoder&&(je=he.decoder.write(je)),!(he.objectMode&&je==null)&&!(!he.objectMode&&(!je||!je.length))){var we=te.push(je);we||(Ae=!0,le.pause())}});for(var ge in le)this[ge]===void 0&&typeof le[ge]=="function"&&(this[ge]=function(we){return function(){return le[we].apply(le,arguments)}}(ge));for(var me=0;me<W.length;me++)le.on(W[me],this.emit.bind(this,W[me]));return this._read=function(je){v("wrapped _read",je),Ae&&(Ae=!1,le.resume())},this},typeof Symbol=="function"&&(G.prototype[Symbol.asyncIterator]=function(){return F===void 0&&(F=requireAsync_iterator()),F(this)}),Object.defineProperty(G.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(G.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(G.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(te){this._readableState&&(this._readableState.flowing=te)}}),G._fromList=Z,Object.defineProperty(G.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Z(le,te){if(te.length===0)return null;var he;return te.objectMode?he=te.buffer.shift():!le||le>=te.length?(te.decoder?he=te.buffer.join(""):te.buffer.length===1?he=te.buffer.first():he=te.buffer.concat(te.length),te.buffer.clear()):he=te.buffer.consume(le,te.decoder),he}function se(le){var te=le._readableState;v("endReadable",te.endEmitted),te.endEmitted||(te.ended=!0,dist.process.nextTick(ae,te,le))}function ae(le,te){if(v("endReadableNT",le.endEmitted,le.length),!le.endEmitted&&le.length===0&&(le.endEmitted=!0,te.readable=!1,te.emit("end"),le.autoDestroy)){var he=te._writableState;(!he||he.autoDestroy&&he.finished)&&te.destroy()}}typeof Symbol=="function"&&(G.from=function(le,te){return U===void 0&&(U=requireFromBrowser()),U(G,le,te)});function ce(le,te){for(var he=0,Ae=le.length;he<Ae;he++)if(le[he]===te)return he;return-1}return _stream_readable$1}var _stream_transform$1,hasRequired_stream_transform$1;function require_stream_transform$1(){if(hasRequired_stream_transform$1)return _stream_transform$1;hasRequired_stream_transform$1=1,_stream_transform$1=u;var r=requireErrorsBrowser().codes,e=r.ERR_METHOD_NOT_IMPLEMENTED,t=r.ERR_MULTIPLE_CALLBACK,n=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,o=require_stream_duplex$1();requireInherits_browser()(u,o);function c(x,E){var M=this._transformState;M.transforming=!1;var C=M.writecb;if(C===null)return this.emit("error",new t);M.writechunk=null,M.writecb=null,E!=null&&this.push(E),C(x);var I=this._readableState;I.reading=!1,(I.needReadable||I.length<I.highWaterMark)&&this._read(I.highWaterMark)}function u(x){if(!(this instanceof u))return new u(x);o.call(this,x),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,x&&(typeof x.transform=="function"&&(this._transform=x.transform),typeof x.flush=="function"&&(this._flush=x.flush)),this.on("prefinish",v)}function v(){var x=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(E,M){_(x,E,M)}):_(this,null,null)}u.prototype.push=function(x,E){return this._transformState.needTransform=!1,o.prototype.push.call(this,x,E)},u.prototype._transform=function(x,E,M){M(new e("_transform()"))},u.prototype._write=function(x,E,M){var C=this._transformState;if(C.writecb=M,C.writechunk=x,C.writeencoding=E,!C.transforming){var I=this._readableState;(C.needTransform||I.needReadable||I.length<I.highWaterMark)&&this._read(I.highWaterMark)}},u.prototype._read=function(x){var E=this._transformState;E.writechunk!==null&&!E.transforming?(E.transforming=!0,this._transform(E.writechunk,E.writeencoding,E.afterTransform)):E.needTransform=!0},u.prototype._destroy=function(x,E){o.prototype._destroy.call(this,x,function(M){E(M)})};function _(x,E,M){if(E)return x.emit("error",E);if(M!=null&&x.push(M),x._writableState.length)throw new a;if(x._transformState.transforming)throw new n;return x.push(null)}return _stream_transform$1}var _stream_passthrough$1,hasRequired_stream_passthrough$1;function require_stream_passthrough$1(){if(hasRequired_stream_passthrough$1)return _stream_passthrough$1;hasRequired_stream_passthrough$1=1,_stream_passthrough$1=e;var r=require_stream_transform$1();requireInherits_browser()(e,r);function e(t){if(!(this instanceof e))return new e(t);r.call(this,t)}return e.prototype._transform=function(t,n,a){a(null,t)},_stream_passthrough$1}var pipeline_1,hasRequiredPipeline;function requirePipeline(){if(hasRequiredPipeline)return pipeline_1;hasRequiredPipeline=1;var r;function e(M){var C=!1;return function(){C||(C=!0,M.apply(void 0,arguments))}}var t=requireErrorsBrowser().codes,n=t.ERR_MISSING_ARGS,a=t.ERR_STREAM_DESTROYED;function o(M){if(M)throw M}function c(M){return M.setHeader&&typeof M.abort=="function"}function u(M,C,I,D){D=e(D);var L=!1;M.on("close",function(){L=!0}),r===void 0&&(r=requireEndOfStream()),r(M,{readable:C,writable:I},function(q){if(q)return D(q);L=!0,D()});var N=!1;return function(q){if(!L&&!N){if(N=!0,c(M))return M.abort();if(typeof M.destroy=="function")return M.destroy();D(q||new a("pipe"))}}}function v(M){M()}function _(M,C){return M.pipe(C)}function x(M){return!M.length||typeof M[M.length-1]!="function"?o:M.pop()}function E(){for(var M=arguments.length,C=new Array(M),I=0;I<M;I++)C[I]=arguments[I];var D=x(C);if(Array.isArray(C[0])&&(C=C[0]),C.length<2)throw new n("streams");var L,N=C.map(function(q,F){var U=F<C.length-1,j=F>0;return u(q,U,j,function(W){L||(L=W),W&&N.forEach(v),!U&&(N.forEach(v),D(L))})});return C.reduce(_)}return pipeline_1=E,pipeline_1}var streamBrowserify,hasRequiredStreamBrowserify;function requireStreamBrowserify(){if(hasRequiredStreamBrowserify)return streamBrowserify;hasRequiredStreamBrowserify=1,streamBrowserify=t;var r=eventsExports.EventEmitter,e=requireInherits_browser();e(t,r),t.Readable=require_stream_readable$1(),t.Writable=require_stream_writable$1(),t.Duplex=require_stream_duplex$1(),t.Transform=require_stream_transform$1(),t.PassThrough=require_stream_passthrough$1(),t.finished=requireEndOfStream(),t.pipeline=requirePipeline(),t.Stream=t;function t(){r.call(this)}return t.prototype.pipe=function(n,a){var o=this;function c(C){n.writable&&n.write(C)===!1&&o.pause&&o.pause()}o.on("data",c);function u(){o.readable&&o.resume&&o.resume()}n.on("drain",u),!n._isStdio&&(!a||a.end!==!1)&&(o.on("end",_),o.on("close",x));var v=!1;function _(){v||(v=!0,n.end())}function x(){v||(v=!0,typeof n.destroy=="function"&&n.destroy())}function E(C){if(M(),r.listenerCount(this,"error")===0)throw C}o.on("error",E),n.on("error",E);function M(){o.removeListener("data",c),n.removeListener("drain",u),o.removeListener("end",_),o.removeListener("close",x),o.removeListener("error",E),n.removeListener("error",E),o.removeListener("end",M),o.removeListener("close",M),n.removeListener("close",M)}return o.on("end",M),o.on("close",M),n.on("close",M),n.emit("pipe",o),n},streamBrowserify}var hashBase,hasRequiredHashBase;function requireHashBase(){if(hasRequiredHashBase)return hashBase;hasRequiredHashBase=1;var r=requireSafeBuffer$1().Buffer,e=requireStreamBrowserify().Transform,t=requireInherits_browser();function n(u){e.call(this),this._block=r.allocUnsafe(u),this._blockSize=u,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}t(n,e),n.prototype._transform=function(u,v,_){var x=null;try{this.update(u,v)}catch(E){x=E}_(x)},n.prototype._flush=function(u){var v=null;try{this.push(this.digest())}catch(_){v=_}u(v)};var a=typeof Uint8Array<"u",o=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&ArrayBuffer.isView&&(r.prototype instanceof Uint8Array||r.TYPED_ARRAY_SUPPORT);function c(u,v){if(u instanceof r)return u;if(typeof u=="string")return r.from(u,v);if(o&&ArrayBuffer.isView(u)){if(u.byteLength===0)return r.alloc(0);var _=r.from(u.buffer,u.byteOffset,u.byteLength);if(_.byteLength===u.byteLength)return _}if(a&&u instanceof Uint8Array||r.isBuffer(u)&&u.constructor&&typeof u.constructor.isBuffer=="function"&&u.constructor.isBuffer(u))return r.from(u);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}return n.prototype.update=function(u,v){if(this._finalized)throw new Error("Digest already called");u=c(u,v);for(var _=this._block,x=0;this._blockOffset+u.length-x>=this._blockSize;){for(var E=this._blockOffset;E<this._blockSize;)_[E++]=u[x++];this._update(),this._blockOffset=0}for(;x<u.length;)_[this._blockOffset++]=u[x++];for(var M=0,C=u.length*8;C>0;++M)this._length[M]+=C,C=this._length[M]/4294967296|0,C>0&&(this._length[M]-=4294967296*C);return this},n.prototype._update=function(){throw new Error("_update is not implemented")},n.prototype.digest=function(u){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var v=this._digest();u!==void 0&&(v=v.toString(u)),this._block.fill(0),this._blockOffset=0;for(var _=0;_<4;++_)this._length[_]=0;return v},n.prototype._digest=function(){throw new Error("_digest is not implemented")},hashBase=n,hashBase}var md5_js,hasRequiredMd5_js;function requireMd5_js(){if(hasRequiredMd5_js)return md5_js;hasRequiredMd5_js=1;var r=requireInherits_browser(),e=requireHashBase(),t=requireSafeBuffer$1().Buffer,n=new Array(16);function a(){e.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}r(a,e),a.prototype._update=function(){for(var x=n,E=0;E<16;++E)x[E]=this._block.readInt32LE(E*4);var M=this._a,C=this._b,I=this._c,D=this._d;M=c(M,C,I,D,x[0],3614090360,7),D=c(D,M,C,I,x[1],3905402710,12),I=c(I,D,M,C,x[2],606105819,17),C=c(C,I,D,M,x[3],3250441966,22),M=c(M,C,I,D,x[4],4118548399,7),D=c(D,M,C,I,x[5],1200080426,12),I=c(I,D,M,C,x[6],2821735955,17),C=c(C,I,D,M,x[7],4249261313,22),M=c(M,C,I,D,x[8],1770035416,7),D=c(D,M,C,I,x[9],2336552879,12),I=c(I,D,M,C,x[10],4294925233,17),C=c(C,I,D,M,x[11],2304563134,22),M=c(M,C,I,D,x[12],1804603682,7),D=c(D,M,C,I,x[13],4254626195,12),I=c(I,D,M,C,x[14],2792965006,17),C=c(C,I,D,M,x[15],1236535329,22),M=u(M,C,I,D,x[1],4129170786,5),D=u(D,M,C,I,x[6],3225465664,9),I=u(I,D,M,C,x[11],643717713,14),C=u(C,I,D,M,x[0],3921069994,20),M=u(M,C,I,D,x[5],3593408605,5),D=u(D,M,C,I,x[10],38016083,9),I=u(I,D,M,C,x[15],3634488961,14),C=u(C,I,D,M,x[4],3889429448,20),M=u(M,C,I,D,x[9],568446438,5),D=u(D,M,C,I,x[14],3275163606,9),I=u(I,D,M,C,x[3],4107603335,14),C=u(C,I,D,M,x[8],1163531501,20),M=u(M,C,I,D,x[13],2850285829,5),D=u(D,M,C,I,x[2],4243563512,9),I=u(I,D,M,C,x[7],1735328473,14),C=u(C,I,D,M,x[12],2368359562,20),M=v(M,C,I,D,x[5],4294588738,4),D=v(D,M,C,I,x[8],2272392833,11),I=v(I,D,M,C,x[11],1839030562,16),C=v(C,I,D,M,x[14],4259657740,23),M=v(M,C,I,D,x[1],2763975236,4),D=v(D,M,C,I,x[4],1272893353,11),I=v(I,D,M,C,x[7],4139469664,16),C=v(C,I,D,M,x[10],3200236656,23),M=v(M,C,I,D,x[13],681279174,4),D=v(D,M,C,I,x[0],3936430074,11),I=v(I,D,M,C,x[3],3572445317,16),C=v(C,I,D,M,x[6],76029189,23),M=v(M,C,I,D,x[9],3654602809,4),D=v(D,M,C,I,x[12],3873151461,11),I=v(I,D,M,C,x[15],530742520,16),C=v(C,I,D,M,x[2],3299628645,23),M=_(M,C,I,D,x[0],4096336452,6),D=_(D,M,C,I,x[7],1126891415,10),I=_(I,D,M,C,x[14],2878612391,15),C=_(C,I,D,M,x[5],4237533241,21),M=_(M,C,I,D,x[12],1700485571,6),D=_(D,M,C,I,x[3],2399980690,10),I=_(I,D,M,C,x[10],4293915773,15),C=_(C,I,D,M,x[1],2240044497,21),M=_(M,C,I,D,x[8],1873313359,6),D=_(D,M,C,I,x[15],4264355552,10),I=_(I,D,M,C,x[6],2734768916,15),C=_(C,I,D,M,x[13],1309151649,21),M=_(M,C,I,D,x[4],4149444226,6),D=_(D,M,C,I,x[11],3174756917,10),I=_(I,D,M,C,x[2],718787259,15),C=_(C,I,D,M,x[9],3951481745,21),this._a=this._a+M|0,this._b=this._b+C|0,this._c=this._c+I|0,this._d=this._d+D|0},a.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var x=t.allocUnsafe(16);return x.writeInt32LE(this._a,0),x.writeInt32LE(this._b,4),x.writeInt32LE(this._c,8),x.writeInt32LE(this._d,12),x};function o(x,E){return x<<E|x>>>32-E}function c(x,E,M,C,I,D,L){return o(x+(E&M|~E&C)+I+D|0,L)+E|0}function u(x,E,M,C,I,D,L){return o(x+(E&C|M&~C)+I+D|0,L)+E|0}function v(x,E,M,C,I,D,L){return o(x+(E^M^C)+I+D|0,L)+E|0}function _(x,E,M,C,I,D,L){return o(x+(M^(E|~C))+I+D|0,L)+E|0}return md5_js=a,md5_js}var ripemd160,hasRequiredRipemd160;function requireRipemd160(){if(hasRequiredRipemd160)return ripemd160;hasRequiredRipemd160=1;var r=bufferPolyfill.Buffer,e=requireInherits_browser(),t=requireHashBase(),n=new Array(16),a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],o=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],c=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],u=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],v=[0,1518500249,1859775393,2400959708,2840853838],_=[1352829926,1548603684,1836072691,2053994217,0];function x(){t.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}e(x,t),x.prototype._update=function(){for(var N=n,q=0;q<16;++q)N[q]=this._block.readInt32LE(q*4);for(var F=this._a|0,U=this._b|0,j=this._c|0,W=this._d|0,X=this._e|0,J=this._a|0,G=this._b|0,oe=this._c|0,O=this._d|0,l=this._e|0,p=0;p<80;p+=1){var b,S;p<16?(b=M(F,U,j,W,X,N[a[p]],v[0],c[p]),S=L(J,G,oe,O,l,N[o[p]],_[0],u[p])):p<32?(b=C(F,U,j,W,X,N[a[p]],v[1],c[p]),S=D(J,G,oe,O,l,N[o[p]],_[1],u[p])):p<48?(b=I(F,U,j,W,X,N[a[p]],v[2],c[p]),S=I(J,G,oe,O,l,N[o[p]],_[2],u[p])):p<64?(b=D(F,U,j,W,X,N[a[p]],v[3],c[p]),S=C(J,G,oe,O,l,N[o[p]],_[3],u[p])):(b=L(F,U,j,W,X,N[a[p]],v[4],c[p]),S=M(J,G,oe,O,l,N[o[p]],_[4],u[p])),F=X,X=W,W=E(j,10),j=U,U=b,J=l,l=O,O=E(oe,10),oe=G,G=S}var T=this._b+j+O|0;this._b=this._c+W+l|0,this._c=this._d+X+J|0,this._d=this._e+F+G|0,this._e=this._a+U+oe|0,this._a=T},x.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var N=r.alloc?r.alloc(20):new r(20);return N.writeInt32LE(this._a,0),N.writeInt32LE(this._b,4),N.writeInt32LE(this._c,8),N.writeInt32LE(this._d,12),N.writeInt32LE(this._e,16),N};function E(N,q){return N<<q|N>>>32-q}function M(N,q,F,U,j,W,X,J){return E(N+(q^F^U)+W+X|0,J)+j|0}function C(N,q,F,U,j,W,X,J){return E(N+(q&F|~q&U)+W+X|0,J)+j|0}function I(N,q,F,U,j,W,X,J){return E(N+((q|~F)^U)+W+X|0,J)+j|0}function D(N,q,F,U,j,W,X,J){return E(N+(q&U|F&~U)+W+X|0,J)+j|0}function L(N,q,F,U,j,W,X,J){return E(N+(q^(F|~U))+W+X|0,J)+j|0}return ripemd160=x,ripemd160}var sha_js={exports:{}},hash$1,hasRequiredHash$1;function requireHash$1(){if(hasRequiredHash$1)return hash$1;hasRequiredHash$1=1;var r=requireSafeBuffer$1().Buffer;function e(t,n){this._block=r.alloc(t),this._finalSize=n,this._blockSize=t,this._len=0}return e.prototype.update=function(t,n){typeof t=="string"&&(n=n||"utf8",t=r.from(t,n));for(var a=this._block,o=this._blockSize,c=t.length,u=this._len,v=0;v<c;){for(var _=u%o,x=Math.min(c-v,o-_),E=0;E<x;E++)a[_+E]=t[v+E];u+=x,v+=x,u%o===0&&this._update(a)}return this._len+=c,this},e.prototype.digest=function(t){var n=this._len%this._blockSize;this._block[n]=128,this._block.fill(0,n+1),n>=this._finalSize&&(this._update(this._block),this._block.fill(0));var a=this._len*8;if(a<=4294967295)this._block.writeUInt32BE(a,this._blockSize-4);else{var o=(a&4294967295)>>>0,c=(a-o)/4294967296;this._block.writeUInt32BE(c,this._blockSize-8),this._block.writeUInt32BE(o,this._blockSize-4)}this._update(this._block);var u=this._hash();return t?u.toString(t):u},e.prototype._update=function(){throw new Error("_update must be implemented by subclass")},hash$1=e,hash$1}var sha$1,hasRequiredSha$1;function requireSha$1(){if(hasRequiredSha$1)return sha$1;hasRequiredSha$1=1;var r=requireInherits_browser(),e=requireHash$1(),t=requireSafeBuffer$1().Buffer,n=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function o(){this.init(),this._w=a,e.call(this,64,56)}r(o,e),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function c(_){return _<<5|_>>>27}function u(_){return _<<30|_>>>2}function v(_,x,E,M){return _===0?x&E|~x&M:_===2?x&E|x&M|E&M:x^E^M}return o.prototype._update=function(_){for(var x=this._w,E=this._a|0,M=this._b|0,C=this._c|0,I=this._d|0,D=this._e|0,L=0;L<16;++L)x[L]=_.readInt32BE(L*4);for(;L<80;++L)x[L]=x[L-3]^x[L-8]^x[L-14]^x[L-16];for(var N=0;N<80;++N){var q=~~(N/20),F=c(E)+v(q,M,C,I)+D+x[N]+n[q]|0;D=I,I=C,C=u(M),M=E,E=F}this._a=E+this._a|0,this._b=M+this._b|0,this._c=C+this._c|0,this._d=I+this._d|0,this._e=D+this._e|0},o.prototype._hash=function(){var _=t.allocUnsafe(20);return _.writeInt32BE(this._a|0,0),_.writeInt32BE(this._b|0,4),_.writeInt32BE(this._c|0,8),_.writeInt32BE(this._d|0,12),_.writeInt32BE(this._e|0,16),_},sha$1=o,sha$1}var sha1,hasRequiredSha1;function requireSha1(){if(hasRequiredSha1)return sha1;hasRequiredSha1=1;var r=requireInherits_browser(),e=requireHash$1(),t=requireSafeBuffer$1().Buffer,n=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function o(){this.init(),this._w=a,e.call(this,64,56)}r(o,e),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function c(x){return x<<1|x>>>31}function u(x){return x<<5|x>>>27}function v(x){return x<<30|x>>>2}function _(x,E,M,C){return x===0?E&M|~E&C:x===2?E&M|E&C|M&C:E^M^C}return o.prototype._update=function(x){for(var E=this._w,M=this._a|0,C=this._b|0,I=this._c|0,D=this._d|0,L=this._e|0,N=0;N<16;++N)E[N]=x.readInt32BE(N*4);for(;N<80;++N)E[N]=c(E[N-3]^E[N-8]^E[N-14]^E[N-16]);for(var q=0;q<80;++q){var F=~~(q/20),U=u(M)+_(F,C,I,D)+L+E[q]+n[F]|0;L=D,D=I,I=v(C),C=M,M=U}this._a=M+this._a|0,this._b=C+this._b|0,this._c=I+this._c|0,this._d=D+this._d|0,this._e=L+this._e|0},o.prototype._hash=function(){var x=t.allocUnsafe(20);return x.writeInt32BE(this._a|0,0),x.writeInt32BE(this._b|0,4),x.writeInt32BE(this._c|0,8),x.writeInt32BE(this._d|0,12),x.writeInt32BE(this._e|0,16),x},sha1=o,sha1}var sha256$1,hasRequiredSha256;function requireSha256(){if(hasRequiredSha256)return sha256$1;hasRequiredSha256=1;var r=requireInherits_browser(),e=requireHash$1(),t=requireSafeBuffer$1().Buffer,n=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);function o(){this.init(),this._w=a,e.call(this,64,56)}r(o,e),o.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function c(M,C,I){return I^M&(C^I)}function u(M,C,I){return M&C|I&(M|C)}function v(M){return(M>>>2|M<<30)^(M>>>13|M<<19)^(M>>>22|M<<10)}function _(M){return(M>>>6|M<<26)^(M>>>11|M<<21)^(M>>>25|M<<7)}function x(M){return(M>>>7|M<<25)^(M>>>18|M<<14)^M>>>3}function E(M){return(M>>>17|M<<15)^(M>>>19|M<<13)^M>>>10}return o.prototype._update=function(M){for(var C=this._w,I=this._a|0,D=this._b|0,L=this._c|0,N=this._d|0,q=this._e|0,F=this._f|0,U=this._g|0,j=this._h|0,W=0;W<16;++W)C[W]=M.readInt32BE(W*4);for(;W<64;++W)C[W]=E(C[W-2])+C[W-7]+x(C[W-15])+C[W-16]|0;for(var X=0;X<64;++X){var J=j+_(q)+c(q,F,U)+n[X]+C[X]|0,G=v(I)+u(I,D,L)|0;j=U,U=F,F=q,q=N+J|0,N=L,L=D,D=I,I=J+G|0}this._a=I+this._a|0,this._b=D+this._b|0,this._c=L+this._c|0,this._d=N+this._d|0,this._e=q+this._e|0,this._f=F+this._f|0,this._g=U+this._g|0,this._h=j+this._h|0},o.prototype._hash=function(){var M=t.allocUnsafe(32);return M.writeInt32BE(this._a,0),M.writeInt32BE(this._b,4),M.writeInt32BE(this._c,8),M.writeInt32BE(this._d,12),M.writeInt32BE(this._e,16),M.writeInt32BE(this._f,20),M.writeInt32BE(this._g,24),M.writeInt32BE(this._h,28),M},sha256$1=o,sha256$1}var sha224$1,hasRequiredSha224;function requireSha224(){if(hasRequiredSha224)return sha224$1;hasRequiredSha224=1;var r=requireInherits_browser(),e=requireSha256(),t=requireHash$1(),n=requireSafeBuffer$1().Buffer,a=new Array(64);function o(){this.init(),this._w=a,t.call(this,64,56)}return r(o,e),o.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},o.prototype._hash=function(){var c=n.allocUnsafe(28);return c.writeInt32BE(this._a,0),c.writeInt32BE(this._b,4),c.writeInt32BE(this._c,8),c.writeInt32BE(this._d,12),c.writeInt32BE(this._e,16),c.writeInt32BE(this._f,20),c.writeInt32BE(this._g,24),c},sha224$1=o,sha224$1}var sha512$1,hasRequiredSha512;function requireSha512(){if(hasRequiredSha512)return sha512$1;hasRequiredSha512=1;var r=requireInherits_browser(),e=requireHash$1(),t=requireSafeBuffer$1().Buffer,n=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],a=new Array(160);function o(){this.init(),this._w=a,e.call(this,128,112)}r(o,e),o.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function c(D,L,N){return N^D&(L^N)}function u(D,L,N){return D&L|N&(D|L)}function v(D,L){return(D>>>28|L<<4)^(L>>>2|D<<30)^(L>>>7|D<<25)}function _(D,L){return(D>>>14|L<<18)^(D>>>18|L<<14)^(L>>>9|D<<23)}function x(D,L){return(D>>>1|L<<31)^(D>>>8|L<<24)^D>>>7}function E(D,L){return(D>>>1|L<<31)^(D>>>8|L<<24)^(D>>>7|L<<25)}function M(D,L){return(D>>>19|L<<13)^(L>>>29|D<<3)^D>>>6}function C(D,L){return(D>>>19|L<<13)^(L>>>29|D<<3)^(D>>>6|L<<26)}function I(D,L){return D>>>0<L>>>0?1:0}return o.prototype._update=function(D){for(var L=this._w,N=this._ah|0,q=this._bh|0,F=this._ch|0,U=this._dh|0,j=this._eh|0,W=this._fh|0,X=this._gh|0,J=this._hh|0,G=this._al|0,oe=this._bl|0,O=this._cl|0,l=this._dl|0,p=this._el|0,b=this._fl|0,S=this._gl|0,T=this._hl|0,B=0;B<32;B+=2)L[B]=D.readInt32BE(B*4),L[B+1]=D.readInt32BE(B*4+4);for(;B<160;B+=2){var $=L[B-30],A=L[B-15*2+1],g=x($,A),k=E(A,$);$=L[B-2*2],A=L[B-2*2+1];var H=M($,A),z=C(A,$),Q=L[B-7*2],ie=L[B-7*2+1],ne=L[B-16*2],Z=L[B-16*2+1],se=k+ie|0,ae=g+Q+I(se,k)|0;se=se+z|0,ae=ae+H+I(se,z)|0,se=se+Z|0,ae=ae+ne+I(se,Z)|0,L[B]=ae,L[B+1]=se}for(var ce=0;ce<160;ce+=2){ae=L[ce],se=L[ce+1];var le=u(N,q,F),te=u(G,oe,O),he=v(N,G),Ae=v(G,N),ge=_(j,p),me=_(p,j),je=n[ce],we=n[ce+1],pe=c(j,W,X),Ke=c(p,b,S),ye=T+me|0,xe=J+ge+I(ye,T)|0;ye=ye+Ke|0,xe=xe+pe+I(ye,Ke)|0,ye=ye+we|0,xe=xe+je+I(ye,we)|0,ye=ye+se|0,xe=xe+ae+I(ye,se)|0;var Ve=Ae+te|0,be=he+le+I(Ve,Ae)|0;J=X,T=S,X=W,S=b,W=j,b=p,p=l+ye|0,j=U+xe+I(p,l)|0,U=F,l=O,F=q,O=oe,q=N,oe=G,G=ye+Ve|0,N=xe+be+I(G,ye)|0}this._al=this._al+G|0,this._bl=this._bl+oe|0,this._cl=this._cl+O|0,this._dl=this._dl+l|0,this._el=this._el+p|0,this._fl=this._fl+b|0,this._gl=this._gl+S|0,this._hl=this._hl+T|0,this._ah=this._ah+N+I(this._al,G)|0,this._bh=this._bh+q+I(this._bl,oe)|0,this._ch=this._ch+F+I(this._cl,O)|0,this._dh=this._dh+U+I(this._dl,l)|0,this._eh=this._eh+j+I(this._el,p)|0,this._fh=this._fh+W+I(this._fl,b)|0,this._gh=this._gh+X+I(this._gl,S)|0,this._hh=this._hh+J+I(this._hl,T)|0},o.prototype._hash=function(){var D=t.allocUnsafe(64);function L(N,q,F){D.writeInt32BE(N,F),D.writeInt32BE(q,F+4)}return L(this._ah,this._al,0),L(this._bh,this._bl,8),L(this._ch,this._cl,16),L(this._dh,this._dl,24),L(this._eh,this._el,32),L(this._fh,this._fl,40),L(this._gh,this._gl,48),L(this._hh,this._hl,56),D},sha512$1=o,sha512$1}var sha384$1,hasRequiredSha384;function requireSha384(){if(hasRequiredSha384)return sha384$1;hasRequiredSha384=1;var r=requireInherits_browser(),e=requireSha512(),t=requireHash$1(),n=requireSafeBuffer$1().Buffer,a=new Array(160);function o(){this.init(),this._w=a,t.call(this,128,112)}return r(o,e),o.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},o.prototype._hash=function(){var c=n.allocUnsafe(48);function u(v,_,x){c.writeInt32BE(v,x),c.writeInt32BE(_,x+4)}return u(this._ah,this._al,0),u(this._bh,this._bl,8),u(this._ch,this._cl,16),u(this._dh,this._dl,24),u(this._eh,this._el,32),u(this._fh,this._fl,40),c},sha384$1=o,sha384$1}var hasRequiredSha_js;function requireSha_js(){if(hasRequiredSha_js)return sha_js.exports;hasRequiredSha_js=1;var r=sha_js.exports=function(t){t=t.toLowerCase();var n=r[t];if(!n)throw new Error(t+" is not supported (we accept pull requests)");return new n};return r.sha=requireSha$1(),r.sha1=requireSha1(),r.sha224=requireSha224(),r.sha256=requireSha256(),r.sha384=requireSha384(),r.sha512=requireSha512(),sha_js.exports}var cipherBase,hasRequiredCipherBase;function requireCipherBase(){if(hasRequiredCipherBase)return cipherBase;hasRequiredCipherBase=1;var r=requireSafeBuffer$1().Buffer,e=requireStreamBrowserify().Transform,t=requireString_decoder().StringDecoder,n=requireInherits_browser();function a(v){e.call(this),this.hashMode=typeof v=="string",this.hashMode?this[v]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}n(a,e);var o=typeof Uint8Array<"u",c=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&ArrayBuffer.isView&&(r.prototype instanceof Uint8Array||r.TYPED_ARRAY_SUPPORT);function u(v,_){if(v instanceof r)return v;if(typeof v=="string")return r.from(v,_);if(c&&ArrayBuffer.isView(v)){if(v.byteLength===0)return r.alloc(0);var x=r.from(v.buffer,v.byteOffset,v.byteLength);if(x.byteLength===v.byteLength)return x}if(o&&v instanceof Uint8Array||r.isBuffer(v)&&v.constructor&&typeof v.constructor.isBuffer=="function"&&v.constructor.isBuffer(v))return r.from(v);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}return a.prototype.update=function(v,_,x){var E=u(v,_),M=this._update(E);return this.hashMode?this:(x&&(M=this._toString(M,x)),M)},a.prototype.setAutoPadding=function(){},a.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},a.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},a.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},a.prototype._transform=function(v,_,x){var E;try{this.hashMode?this._update(v):this.push(this._update(v))}catch(M){E=M}finally{x(E)}},a.prototype._flush=function(v){var _;try{this.push(this.__final())}catch(x){_=x}v(_)},a.prototype._finalOrDigest=function(v){var _=this.__final()||r.alloc(0);return v&&(_=this._toString(_,v,!0)),_},a.prototype._toString=function(v,_,x){if(this._decoder||(this._decoder=new t(_),this._encoding=_),this._encoding!==_)throw new Error("cant switch encodings");var E=this._decoder.write(v);return x&&(E+=this._decoder.end()),E},cipherBase=a,cipherBase}var browser$a,hasRequiredBrowser$9;function requireBrowser$9(){if(hasRequiredBrowser$9)return browser$a;hasRequiredBrowser$9=1;var r=requireInherits_browser(),e=requireMd5_js(),t=requireRipemd160(),n=requireSha_js(),a=requireCipherBase();function o(c){a.call(this,"digest"),this._hash=c}return r(o,a),o.prototype._update=function(c){this._hash.update(c)},o.prototype._final=function(){return this._hash.digest()},browser$a=function(u){return u=u.toLowerCase(),u==="md5"?new e:u==="rmd160"||u==="ripemd160"?new t:new o(n(u))},browser$a}var legacy,hasRequiredLegacy;function requireLegacy(){if(hasRequiredLegacy)return legacy;hasRequiredLegacy=1;var r=requireInherits_browser(),e=requireSafeBuffer$1().Buffer,t=requireCipherBase(),n=e.alloc(128),a=64;function o(c,u){t.call(this,"digest"),typeof u=="string"&&(u=e.from(u)),this._alg=c,this._key=u,u.length>a?u=c(u):u.length<a&&(u=e.concat([u,n],a));for(var v=this._ipad=e.allocUnsafe(a),_=this._opad=e.allocUnsafe(a),x=0;x<a;x++)v[x]=u[x]^54,_[x]=u[x]^92;this._hash=[v]}return r(o,t),o.prototype._update=function(c){this._hash.push(c)},o.prototype._final=function(){var c=this._alg(e.concat(this._hash));return this._alg(e.concat([this._opad,c]))},legacy=o,legacy}var md5,hasRequiredMd5;function requireMd5(){if(hasRequiredMd5)return md5;hasRequiredMd5=1;var r=requireMd5_js();return md5=function(e){return new r().update(e).digest()},md5}var browser$9,hasRequiredBrowser$8;function requireBrowser$8(){if(hasRequiredBrowser$8)return browser$9;hasRequiredBrowser$8=1;var r=requireInherits_browser(),e=requireLegacy(),t=requireCipherBase(),n=requireSafeBuffer$1().Buffer,a=requireMd5(),o=requireRipemd160(),c=requireSha_js(),u=n.alloc(128);function v(_,x){t.call(this,"digest"),typeof x=="string"&&(x=n.from(x));var E=_==="sha512"||_==="sha384"?128:64;if(this._alg=_,this._key=x,x.length>E){var M=_==="rmd160"?new o:c(_);x=M.update(x).digest()}else x.length<E&&(x=n.concat([x,u],E));for(var C=this._ipad=n.allocUnsafe(E),I=this._opad=n.allocUnsafe(E),D=0;D<E;D++)C[D]=x[D]^54,I[D]=x[D]^92;this._hash=_==="rmd160"?new o:c(_),this._hash.update(C)}return r(v,t),v.prototype._update=function(_){this._hash.update(_)},v.prototype._final=function(){var _=this._hash.digest(),x=this._alg==="rmd160"?new o:c(this._alg);return x.update(this._opad).update(_).digest()},browser$9=function(x,E){return x=x.toLowerCase(),x==="rmd160"||x==="ripemd160"?new v("rmd160",E):x==="md5"?new e(a,E):new v(x,E)},browser$9}const sha224WithRSAEncryption={sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption={sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption={sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption={sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},sha256={sign:"ecdsa",hash:"sha256",id:""},sha224={sign:"ecdsa",hash:"sha224",id:""},sha384={sign:"ecdsa",hash:"sha384",id:""},sha512={sign:"ecdsa",hash:"sha512",id:""},DSA={sign:"dsa",hash:"sha1",id:""},ripemd160WithRSA={sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption={sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},require$$6={sha224WithRSAEncryption,"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption,"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption,"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption,"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256,sha224,sha384,sha512,"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA,"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA,"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption,"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}};var algos,hasRequiredAlgos;function requireAlgos(){return hasRequiredAlgos||(hasRequiredAlgos=1,algos=require$$6),algos}var browser$8={},precondition,hasRequiredPrecondition;function requirePrecondition(){if(hasRequiredPrecondition)return precondition;hasRequiredPrecondition=1;var r=Math.pow(2,30)-1;return precondition=function(e,t){if(typeof e!="number")throw new TypeError("Iterations not a number");if(e<0)throw new TypeError("Bad iterations");if(typeof t!="number")throw new TypeError("Key length not a number");if(t<0||t>r||t!==t)throw new TypeError("Bad key length")},precondition}var defaultEncoding_1,hasRequiredDefaultEncoding;function requireDefaultEncoding(){if(hasRequiredDefaultEncoding)return defaultEncoding_1;hasRequiredDefaultEncoding=1;var r;if(commonjsGlobal.process&&commonjsGlobal.process.browser)r="utf-8";else if(commonjsGlobal.process&&commonjsGlobal.process.version){var e=parseInt(dist.process.version.split(".")[0].slice(1),10);r=e>=6?"utf-8":"binary"}else r="utf-8";return defaultEncoding_1=r,defaultEncoding_1}var toBuffer,hasRequiredToBuffer;function requireToBuffer(){if(hasRequiredToBuffer)return toBuffer;hasRequiredToBuffer=1;var r=requireSafeBuffer$1().Buffer;return toBuffer=function(e,t,n){if(r.isBuffer(e))return e;if(typeof e=="string")return r.from(e,t);if(ArrayBuffer.isView(e))return r.from(e.buffer);throw new TypeError(n+" must be a string, a Buffer, a typed array or a DataView")},toBuffer}var syncBrowser,hasRequiredSyncBrowser;function requireSyncBrowser(){if(hasRequiredSyncBrowser)return syncBrowser;hasRequiredSyncBrowser=1;var r=requireMd5(),e=requireRipemd160(),t=requireSha_js(),n=requireSafeBuffer$1().Buffer,a=requirePrecondition(),o=requireDefaultEncoding(),c=requireToBuffer(),u=n.alloc(128),v={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function _(M,C,I){var D=x(M),L=M==="sha512"||M==="sha384"?128:64;C.length>L?C=D(C):C.length<L&&(C=n.concat([C,u],L));for(var N=n.allocUnsafe(L+v[M]),q=n.allocUnsafe(L+v[M]),F=0;F<L;F++)N[F]=C[F]^54,q[F]=C[F]^92;var U=n.allocUnsafe(L+I+4);N.copy(U,0,0,L),this.ipad1=U,this.ipad2=N,this.opad=q,this.alg=M,this.blocksize=L,this.hash=D,this.size=v[M]}_.prototype.run=function(M,C){M.copy(C,this.blocksize);var I=this.hash(C);return I.copy(this.opad,this.blocksize),this.hash(this.opad)};function x(M){function C(D){return t(M).update(D).digest()}function I(D){return new e().update(D).digest()}return M==="rmd160"||M==="ripemd160"?I:M==="md5"?r:C}function E(M,C,I,D,L){a(I,D),M=c(M,o,"Password"),C=c(C,o,"Salt"),L=L||"sha1";var N=new _(L,M,C.length),q=n.allocUnsafe(D),F=n.allocUnsafe(C.length+4);C.copy(F,0,0,C.length);for(var U=0,j=v[L],W=Math.ceil(D/j),X=1;X<=W;X++){F.writeUInt32BE(X,C.length);for(var J=N.run(F,N.ipad1),G=J,oe=1;oe<I;oe++){G=N.run(G,N.ipad2);for(var O=0;O<j;O++)J[O]^=G[O]}J.copy(q,U),U+=j}return q}return syncBrowser=E,syncBrowser}var async,hasRequiredAsync;function requireAsync(){if(hasRequiredAsync)return async;hasRequiredAsync=1;var r=requireSafeBuffer$1().Buffer,e=requirePrecondition(),t=requireDefaultEncoding(),n=requireSyncBrowser(),a=requireToBuffer(),o,c=commonjsGlobal.crypto&&commonjsGlobal.crypto.subtle,u={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},v=[];function _(I){if(commonjsGlobal.process&&!commonjsGlobal.process.browser||!c||!c.importKey||!c.deriveBits)return Promise.resolve(!1);if(v[I]!==void 0)return v[I];o=o||r.alloc(8);var D=M(o,o,10,128,I).then(function(){return!0}).catch(function(){return!1});return v[I]=D,D}var x;function E(){return x||(commonjsGlobal.process&&commonjsGlobal.process.nextTick?x=commonjsGlobal.process.nextTick:commonjsGlobal.queueMicrotask?x=commonjsGlobal.queueMicrotask:commonjsGlobal.setImmediate?x=commonjsGlobal.setImmediate:x=commonjsGlobal.setTimeout,x)}function M(I,D,L,N,q){return c.importKey("raw",I,{name:"PBKDF2"},!1,["deriveBits"]).then(function(F){return c.deriveBits({name:"PBKDF2",salt:D,iterations:L,hash:{name:q}},F,N<<3)}).then(function(F){return r.from(F)})}function C(I,D){I.then(function(L){E()(function(){D(null,L)})},function(L){E()(function(){D(L)})})}return async=function(I,D,L,N,q,F){typeof q=="function"&&(F=q,q=void 0),q=q||"sha1";var U=u[q.toLowerCase()];if(!U||typeof commonjsGlobal.Promise!="function"){E()(function(){var j;try{j=n(I,D,L,N,q)}catch(W){return F(W)}F(null,j)});return}if(e(L,N),I=a(I,t,"Password"),D=a(D,t,"Salt"),typeof F!="function")throw new Error("No callback provided to pbkdf2");C(_(U).then(function(j){return j?M(I,D,L,N,U):n(I,D,L,N,q)}),F)},async}var hasRequiredBrowser$7;function requireBrowser$7(){return hasRequiredBrowser$7||(hasRequiredBrowser$7=1,browser$8.pbkdf2=requireAsync(),browser$8.pbkdf2Sync=requireSyncBrowser()),browser$8}var browser$7={},des$1={},utils$3={},hasRequiredUtils$3;function requireUtils$3(){if(hasRequiredUtils$3)return utils$3;hasRequiredUtils$3=1,utils$3.readUInt32BE=function(a,o){var c=a[0+o]<<24|a[1+o]<<16|a[2+o]<<8|a[3+o];return c>>>0},utils$3.writeUInt32BE=function(a,o,c){a[0+c]=o>>>24,a[1+c]=o>>>16&255,a[2+c]=o>>>8&255,a[3+c]=o&255},utils$3.ip=function(a,o,c,u){for(var v=0,_=0,x=6;x>=0;x-=2){for(var E=0;E<=24;E+=8)v<<=1,v|=o>>>E+x&1;for(var E=0;E<=24;E+=8)v<<=1,v|=a>>>E+x&1}for(var x=6;x>=0;x-=2){for(var E=1;E<=25;E+=8)_<<=1,_|=o>>>E+x&1;for(var E=1;E<=25;E+=8)_<<=1,_|=a>>>E+x&1}c[u+0]=v>>>0,c[u+1]=_>>>0},utils$3.rip=function(a,o,c,u){for(var v=0,_=0,x=0;x<4;x++)for(var E=24;E>=0;E-=8)v<<=1,v|=o>>>E+x&1,v<<=1,v|=a>>>E+x&1;for(var x=4;x<8;x++)for(var E=24;E>=0;E-=8)_<<=1,_|=o>>>E+x&1,_<<=1,_|=a>>>E+x&1;c[u+0]=v>>>0,c[u+1]=_>>>0},utils$3.pc1=function(a,o,c,u){for(var v=0,_=0,x=7;x>=5;x--){for(var E=0;E<=24;E+=8)v<<=1,v|=o>>E+x&1;for(var E=0;E<=24;E+=8)v<<=1,v|=a>>E+x&1}for(var E=0;E<=24;E+=8)v<<=1,v|=o>>E+x&1;for(var x=1;x<=3;x++){for(var E=0;E<=24;E+=8)_<<=1,_|=o>>E+x&1;for(var E=0;E<=24;E+=8)_<<=1,_|=a>>E+x&1}for(var E=0;E<=24;E+=8)_<<=1,_|=a>>E+x&1;c[u+0]=v>>>0,c[u+1]=_>>>0},utils$3.r28shl=function(a,o){return a<<o&268435455|a>>>28-o};var r=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];utils$3.pc2=function(a,o,c,u){for(var v=0,_=0,x=r.length>>>1,E=0;E<x;E++)v<<=1,v|=a>>>r[E]&1;for(var E=x;E<r.length;E++)_<<=1,_|=o>>>r[E]&1;c[u+0]=v>>>0,c[u+1]=_>>>0},utils$3.expand=function(a,o,c){var u=0,v=0;u=(a&1)<<5|a>>>27;for(var _=23;_>=15;_-=4)u<<=6,u|=a>>>_&63;for(var _=11;_>=3;_-=4)v|=a>>>_&63,v<<=6;v|=(a&31)<<1|a>>>31,o[c+0]=u>>>0,o[c+1]=v>>>0};var e=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];utils$3.substitute=function(a,o){for(var c=0,u=0;u<4;u++){var v=a>>>18-u*6&63,_=e[u*64+v];c<<=4,c|=_}for(var u=0;u<4;u++){var v=o>>>18-u*6&63,_=e[4*64+u*64+v];c<<=4,c|=_}return c>>>0};var t=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];return utils$3.permute=function(a){for(var o=0,c=0;c<t.length;c++)o<<=1,o|=a>>>t[c]&1;return o>>>0},utils$3.padSplit=function(a,o,c){for(var u=a.toString(2);u.length<o;)u="0"+u;for(var v=[],_=0;_<o;_+=c)v.push(u.slice(_,_+c));return v.join(" ")},utils$3}var minimalisticAssert,hasRequiredMinimalisticAssert;function requireMinimalisticAssert(){if(hasRequiredMinimalisticAssert)return minimalisticAssert;hasRequiredMinimalisticAssert=1,minimalisticAssert=r;function r(e,t){if(!e)throw new Error(t||"Assertion failed")}return r.equal=function(t,n,a){if(t!=n)throw new Error(a||"Assertion failed: "+t+" != "+n)},minimalisticAssert}var cipher,hasRequiredCipher;function requireCipher(){if(hasRequiredCipher)return cipher;hasRequiredCipher=1;var r=requireMinimalisticAssert();function e(t){this.options=t,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0,this.padding=t.padding!==!1}return cipher=e,e.prototype._init=function(){},e.prototype.update=function(n){return n.length===0?[]:this.type==="decrypt"?this._updateDecrypt(n):this._updateEncrypt(n)},e.prototype._buffer=function(n,a){for(var o=Math.min(this.buffer.length-this.bufferOff,n.length-a),c=0;c<o;c++)this.buffer[this.bufferOff+c]=n[a+c];return this.bufferOff+=o,o},e.prototype._flushBuffer=function(n,a){return this._update(this.buffer,0,n,a),this.bufferOff=0,this.blockSize},e.prototype._updateEncrypt=function(n){var a=0,o=0,c=(this.bufferOff+n.length)/this.blockSize|0,u=new Array(c*this.blockSize);this.bufferOff!==0&&(a+=this._buffer(n,a),this.bufferOff===this.buffer.length&&(o+=this._flushBuffer(u,o)));for(var v=n.length-(n.length-a)%this.blockSize;a<v;a+=this.blockSize)this._update(n,a,u,o),o+=this.blockSize;for(;a<n.length;a++,this.bufferOff++)this.buffer[this.bufferOff]=n[a];return u},e.prototype._updateDecrypt=function(n){for(var a=0,o=0,c=Math.ceil((this.bufferOff+n.length)/this.blockSize)-1,u=new Array(c*this.blockSize);c>0;c--)a+=this._buffer(n,a),o+=this._flushBuffer(u,o);return a+=this._buffer(n,a),u},e.prototype.final=function(n){var a;n&&(a=this.update(n));var o;return this.type==="encrypt"?o=this._finalEncrypt():o=this._finalDecrypt(),a?a.concat(o):o},e.prototype._pad=function(n,a){if(a===0)return!1;for(;a<n.length;)n[a++]=0;return!0},e.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var n=new Array(this.blockSize);return this._update(this.buffer,0,n,0),n},e.prototype._unpad=function(n){return n},e.prototype._finalDecrypt=function(){r.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var n=new Array(this.blockSize);return this._flushBuffer(n,0),this._unpad(n)},cipher}var des,hasRequiredDes$1;function requireDes$1(){if(hasRequiredDes$1)return des;hasRequiredDes$1=1;var r=requireMinimalisticAssert(),e=requireInherits_browser(),t=requireUtils$3(),n=requireCipher();function a(){this.tmp=new Array(2),this.keys=null}function o(u){n.call(this,u);var v=new a;this._desState=v,this.deriveKeys(v,u.key)}e(o,n),des=o,o.create=function(v){return new o(v)};var c=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];return o.prototype.deriveKeys=function(v,_){v.keys=new Array(16*2),r.equal(_.length,this.blockSize,"Invalid key length");var x=t.readUInt32BE(_,0),E=t.readUInt32BE(_,4);t.pc1(x,E,v.tmp,0),x=v.tmp[0],E=v.tmp[1];for(var M=0;M<v.keys.length;M+=2){var C=c[M>>>1];x=t.r28shl(x,C),E=t.r28shl(E,C),t.pc2(x,E,v.keys,M)}},o.prototype._update=function(v,_,x,E){var M=this._desState,C=t.readUInt32BE(v,_),I=t.readUInt32BE(v,_+4);t.ip(C,I,M.tmp,0),C=M.tmp[0],I=M.tmp[1],this.type==="encrypt"?this._encrypt(M,C,I,M.tmp,0):this._decrypt(M,C,I,M.tmp,0),C=M.tmp[0],I=M.tmp[1],t.writeUInt32BE(x,C,E),t.writeUInt32BE(x,I,E+4)},o.prototype._pad=function(v,_){if(this.padding===!1)return!1;for(var x=v.length-_,E=_;E<v.length;E++)v[E]=x;return!0},o.prototype._unpad=function(v){if(this.padding===!1)return v;for(var _=v[v.length-1],x=v.length-_;x<v.length;x++)r.equal(v[x],_);return v.slice(0,v.length-_)},o.prototype._encrypt=function(v,_,x,E,M){for(var C=_,I=x,D=0;D<v.keys.length;D+=2){var L=v.keys[D],N=v.keys[D+1];t.expand(I,v.tmp,0),L^=v.tmp[0],N^=v.tmp[1];var q=t.substitute(L,N),F=t.permute(q),U=I;I=(C^F)>>>0,C=U}t.rip(I,C,E,M)},o.prototype._decrypt=function(v,_,x,E,M){for(var C=x,I=_,D=v.keys.length-2;D>=0;D-=2){var L=v.keys[D],N=v.keys[D+1];t.expand(C,v.tmp,0),L^=v.tmp[0],N^=v.tmp[1];var q=t.substitute(L,N),F=t.permute(q),U=C;C=(I^F)>>>0,I=U}t.rip(C,I,E,M)},des}var cbc$1={},hasRequiredCbc$1;function requireCbc$1(){if(hasRequiredCbc$1)return cbc$1;hasRequiredCbc$1=1;var r=requireMinimalisticAssert(),e=requireInherits_browser(),t={};function n(o){r.equal(o.length,8,"Invalid IV length"),this.iv=new Array(8);for(var c=0;c<this.iv.length;c++)this.iv[c]=o[c]}function a(o){function c(x){o.call(this,x),this._cbcInit()}e(c,o);for(var u=Object.keys(t),v=0;v<u.length;v++){var _=u[v];c.prototype[_]=t[_]}return c.create=function(E){return new c(E)},c}return cbc$1.instantiate=a,t._cbcInit=function(){var c=new n(this.options.iv);this._cbcState=c},t._update=function(c,u,v,_){var x=this._cbcState,E=this.constructor.super_.prototype,M=x.iv;if(this.type==="encrypt"){for(var C=0;C<this.blockSize;C++)M[C]^=c[u+C];E._update.call(this,M,0,v,_);for(var C=0;C<this.blockSize;C++)M[C]=v[_+C]}else{E._update.call(this,c,u,v,_);for(var C=0;C<this.blockSize;C++)v[_+C]^=M[C];for(var C=0;C<this.blockSize;C++)M[C]=c[u+C]}},cbc$1}var ede,hasRequiredEde;function requireEde(){if(hasRequiredEde)return ede;hasRequiredEde=1;var r=requireMinimalisticAssert(),e=requireInherits_browser(),t=requireCipher(),n=requireDes$1();function a(c,u){r.equal(u.length,24,"Invalid key length");var v=u.slice(0,8),_=u.slice(8,16),x=u.slice(16,24);c==="encrypt"?this.ciphers=[n.create({type:"encrypt",key:v}),n.create({type:"decrypt",key:_}),n.create({type:"encrypt",key:x})]:this.ciphers=[n.create({type:"decrypt",key:x}),n.create({type:"encrypt",key:_}),n.create({type:"decrypt",key:v})]}function o(c){t.call(this,c);var u=new a(this.type,this.options.key);this._edeState=u}return e(o,t),ede=o,o.create=function(u){return new o(u)},o.prototype._update=function(u,v,_,x){var E=this._edeState;E.ciphers[0]._update(u,v,_,x),E.ciphers[1]._update(_,x,_,x),E.ciphers[2]._update(_,x,_,x)},o.prototype._pad=n.prototype._pad,o.prototype._unpad=n.prototype._unpad,ede}var hasRequiredDes;function requireDes(){return hasRequiredDes||(hasRequiredDes=1,des$1.utils=requireUtils$3(),des$1.Cipher=requireCipher(),des$1.DES=requireDes$1(),des$1.CBC=requireCbc$1(),des$1.EDE=requireEde()),des$1}var browserifyDes,hasRequiredBrowserifyDes;function requireBrowserifyDes(){if(hasRequiredBrowserifyDes)return browserifyDes;hasRequiredBrowserifyDes=1;var r=requireCipherBase(),e=requireDes(),t=requireInherits_browser(),n=requireSafeBuffer$1().Buffer,a={"des-ede3-cbc":e.CBC.instantiate(e.EDE),"des-ede3":e.EDE,"des-ede-cbc":e.CBC.instantiate(e.EDE),"des-ede":e.EDE,"des-cbc":e.CBC.instantiate(e.DES),"des-ecb":e.DES};a.des=a["des-cbc"],a.des3=a["des-ede3-cbc"],browserifyDes=o,t(o,r);function o(c){r.call(this);var u=c.mode.toLowerCase(),v=a[u],_;c.decrypt?_="decrypt":_="encrypt";var x=c.key;n.isBuffer(x)||(x=n.from(x)),(u==="des-ede"||u==="des-ede-cbc")&&(x=n.concat([x,x.slice(0,8)]));var E=c.iv;n.isBuffer(E)||(E=n.from(E)),this._des=v.create({key:x,iv:E,type:_})}return o.prototype._update=function(c){return n.from(this._des.update(c))},o.prototype._final=function(){return n.from(this._des.final())},browserifyDes}var browser$6={},encrypter={},ecb={},hasRequiredEcb;function requireEcb(){return hasRequiredEcb||(hasRequiredEcb=1,ecb.encrypt=function(r,e){return r._cipher.encryptBlock(e)},ecb.decrypt=function(r,e){return r._cipher.decryptBlock(e)}),ecb}var cbc={},bufferXor,hasRequiredBufferXor;function requireBufferXor(){return hasRequiredBufferXor||(hasRequiredBufferXor=1,bufferXor=function(e,t){for(var n=Math.min(e.length,t.length),a=new dist.Buffer(n),o=0;o<n;++o)a[o]=e[o]^t[o];return a}),bufferXor}var hasRequiredCbc;function requireCbc(){if(hasRequiredCbc)return cbc;hasRequiredCbc=1;var r=requireBufferXor();return cbc.encrypt=function(e,t){var n=r(t,e._prev);return e._prev=e._cipher.encryptBlock(n),e._prev},cbc.decrypt=function(e,t){var n=e._prev;e._prev=t;var a=e._cipher.decryptBlock(t);return r(a,n)},cbc}var cfb={},hasRequiredCfb;function requireCfb(){if(hasRequiredCfb)return cfb;hasRequiredCfb=1;var r=requireSafeBuffer$1().Buffer,e=requireBufferXor();function t(n,a,o){var c=a.length,u=e(a,n._cache);return n._cache=n._cache.slice(c),n._prev=r.concat([n._prev,o?a:u]),u}return cfb.encrypt=function(n,a,o){for(var c=r.allocUnsafe(0),u;a.length;)if(n._cache.length===0&&(n._cache=n._cipher.encryptBlock(n._prev),n._prev=r.allocUnsafe(0)),n._cache.length<=a.length)u=n._cache.length,c=r.concat([c,t(n,a.slice(0,u),o)]),a=a.slice(u);else{c=r.concat([c,t(n,a,o)]);break}return c},cfb}var cfb8={},hasRequiredCfb8;function requireCfb8(){if(hasRequiredCfb8)return cfb8;hasRequiredCfb8=1;var r=requireSafeBuffer$1().Buffer;function e(t,n,a){var o=t._cipher.encryptBlock(t._prev),c=o[0]^n;return t._prev=r.concat([t._prev.slice(1),r.from([a?n:c])]),c}return cfb8.encrypt=function(t,n,a){for(var o=n.length,c=r.allocUnsafe(o),u=-1;++u<o;)c[u]=e(t,n[u],a);return c},cfb8}var cfb1={},hasRequiredCfb1;function requireCfb1(){if(hasRequiredCfb1)return cfb1;hasRequiredCfb1=1;var r=requireSafeBuffer$1().Buffer;function e(n,a,o){for(var c,u=-1,v=8,_=0,x,E;++u<v;)c=n._cipher.encryptBlock(n._prev),x=a&1<<7-u?128:0,E=c[0]^x,_+=(E&128)>>u%8,n._prev=t(n._prev,o?x:E);return _}function t(n,a){var o=n.length,c=-1,u=r.allocUnsafe(n.length);for(n=r.concat([n,r.from([a])]);++c<o;)u[c]=n[c]<<1|n[c+1]>>7;return u}return cfb1.encrypt=function(n,a,o){for(var c=a.length,u=r.allocUnsafe(c),v=-1;++v<c;)u[v]=e(n,a[v],o);return u},cfb1}var ofb={},hasRequiredOfb;function requireOfb(){if(hasRequiredOfb)return ofb;hasRequiredOfb=1;var r=requireBufferXor();function e(t){return t._prev=t._cipher.encryptBlock(t._prev),t._prev}return ofb.encrypt=function(t,n){for(;t._cache.length<n.length;)t._cache=dist.Buffer.concat([t._cache,e(t)]);var a=t._cache.slice(0,n.length);return t._cache=t._cache.slice(n.length),r(n,a)},ofb}var ctr={},incr32_1,hasRequiredIncr32;function requireIncr32(){if(hasRequiredIncr32)return incr32_1;hasRequiredIncr32=1;function r(e){for(var t=e.length,n;t--;)if(n=e.readUInt8(t),n===255)e.writeUInt8(0,t);else{n++,e.writeUInt8(n,t);break}}return incr32_1=r,incr32_1}var hasRequiredCtr;function requireCtr(){if(hasRequiredCtr)return ctr;hasRequiredCtr=1;var r=requireBufferXor(),e=requireSafeBuffer$1().Buffer,t=requireIncr32();function n(o){var c=o._cipher.encryptBlockRaw(o._prev);return t(o._prev),c}var a=16;return ctr.encrypt=function(o,c){var u=Math.ceil(c.length/a),v=o._cache.length;o._cache=e.concat([o._cache,e.allocUnsafe(u*a)]);for(var _=0;_<u;_++){var x=n(o),E=v+_*a;o._cache.writeUInt32BE(x[0],E+0),o._cache.writeUInt32BE(x[1],E+4),o._cache.writeUInt32BE(x[2],E+8),o._cache.writeUInt32BE(x[3],E+12)}var M=o._cache.slice(0,c.length);return o._cache=o._cache.slice(c.length),r(c,M)},ctr}const aes128={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},require$$2={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128,aes192,aes256,"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}};var modes_1,hasRequiredModes$1;function requireModes$1(){if(hasRequiredModes$1)return modes_1;hasRequiredModes$1=1;var r={ECB:requireEcb(),CBC:requireCbc(),CFB:requireCfb(),CFB8:requireCfb8(),CFB1:requireCfb1(),OFB:requireOfb(),CTR:requireCtr(),GCM:requireCtr()},e=require$$2;for(var t in e)e[t].module=r[e[t].mode];return modes_1=e,modes_1}var aes={},hasRequiredAes;function requireAes(){if(hasRequiredAes)return aes;hasRequiredAes=1;var r=requireSafeBuffer$1().Buffer;function e(u){r.isBuffer(u)||(u=r.from(u));for(var v=u.length/4|0,_=new Array(v),x=0;x<v;x++)_[x]=u.readUInt32BE(x*4);return _}function t(u){for(var v=0;v<u.length;u++)u[v]=0}function n(u,v,_,x,E){for(var M=_[0],C=_[1],I=_[2],D=_[3],L=u[0]^v[0],N=u[1]^v[1],q=u[2]^v[2],F=u[3]^v[3],U,j,W,X,J=4,G=1;G<E;G++)U=M[L>>>24]^C[N>>>16&255]^I[q>>>8&255]^D[F&255]^v[J++],j=M[N>>>24]^C[q>>>16&255]^I[F>>>8&255]^D[L&255]^v[J++],W=M[q>>>24]^C[F>>>16&255]^I[L>>>8&255]^D[N&255]^v[J++],X=M[F>>>24]^C[L>>>16&255]^I[N>>>8&255]^D[q&255]^v[J++],L=U,N=j,q=W,F=X;return U=(x[L>>>24]<<24|x[N>>>16&255]<<16|x[q>>>8&255]<<8|x[F&255])^v[J++],j=(x[N>>>24]<<24|x[q>>>16&255]<<16|x[F>>>8&255]<<8|x[L&255])^v[J++],W=(x[q>>>24]<<24|x[F>>>16&255]<<16|x[L>>>8&255]<<8|x[N&255])^v[J++],X=(x[F>>>24]<<24|x[L>>>16&255]<<16|x[N>>>8&255]<<8|x[q&255])^v[J++],U=U>>>0,j=j>>>0,W=W>>>0,X=X>>>0,[U,j,W,X]}var a=[0,1,2,4,8,16,32,64,128,27,54],o=function(){for(var u=new Array(256),v=0;v<256;v++)v<128?u[v]=v<<1:u[v]=v<<1^283;for(var _=[],x=[],E=[[],[],[],[]],M=[[],[],[],[]],C=0,I=0,D=0;D<256;++D){var L=I^I<<1^I<<2^I<<3^I<<4;L=L>>>8^L&255^99,_[C]=L,x[L]=C;var N=u[C],q=u[N],F=u[q],U=u[L]*257^L*16843008;E[0][C]=U<<24|U>>>8,E[1][C]=U<<16|U>>>16,E[2][C]=U<<8|U>>>24,E[3][C]=U,U=F*16843009^q*65537^N*257^C*16843008,M[0][L]=U<<24|U>>>8,M[1][L]=U<<16|U>>>16,M[2][L]=U<<8|U>>>24,M[3][L]=U,C===0?C=I=1:(C=N^u[u[u[F^N]]],I^=u[u[I]])}return{SBOX:_,INV_SBOX:x,SUB_MIX:E,INV_SUB_MIX:M}}();function c(u){this._key=e(u),this._reset()}return c.blockSize=4*4,c.keySize=256/8,c.prototype.blockSize=c.blockSize,c.prototype.keySize=c.keySize,c.prototype._reset=function(){for(var u=this._key,v=u.length,_=v+6,x=(_+1)*4,E=[],M=0;M<v;M++)E[M]=u[M];for(M=v;M<x;M++){var C=E[M-1];M%v===0?(C=C<<8|C>>>24,C=o.SBOX[C>>>24]<<24|o.SBOX[C>>>16&255]<<16|o.SBOX[C>>>8&255]<<8|o.SBOX[C&255],C^=a[M/v|0]<<24):v>6&&M%v===4&&(C=o.SBOX[C>>>24]<<24|o.SBOX[C>>>16&255]<<16|o.SBOX[C>>>8&255]<<8|o.SBOX[C&255]),E[M]=E[M-v]^C}for(var I=[],D=0;D<x;D++){var L=x-D,N=E[L-(D%4?0:4)];D<4||L<=4?I[D]=N:I[D]=o.INV_SUB_MIX[0][o.SBOX[N>>>24]]^o.INV_SUB_MIX[1][o.SBOX[N>>>16&255]]^o.INV_SUB_MIX[2][o.SBOX[N>>>8&255]]^o.INV_SUB_MIX[3][o.SBOX[N&255]]}this._nRounds=_,this._keySchedule=E,this._invKeySchedule=I},c.prototype.encryptBlockRaw=function(u){return u=e(u),n(u,this._keySchedule,o.SUB_MIX,o.SBOX,this._nRounds)},c.prototype.encryptBlock=function(u){var v=this.encryptBlockRaw(u),_=r.allocUnsafe(16);return _.writeUInt32BE(v[0],0),_.writeUInt32BE(v[1],4),_.writeUInt32BE(v[2],8),_.writeUInt32BE(v[3],12),_},c.prototype.decryptBlock=function(u){u=e(u);var v=u[1];u[1]=u[3],u[3]=v;var _=n(u,this._invKeySchedule,o.INV_SUB_MIX,o.INV_SBOX,this._nRounds),x=r.allocUnsafe(16);return x.writeUInt32BE(_[0],0),x.writeUInt32BE(_[3],4),x.writeUInt32BE(_[2],8),x.writeUInt32BE(_[1],12),x},c.prototype.scrub=function(){t(this._keySchedule),t(this._invKeySchedule),t(this._key)},aes.AES=c,aes}var ghash,hasRequiredGhash;function requireGhash(){if(hasRequiredGhash)return ghash;hasRequiredGhash=1;var r=requireSafeBuffer$1().Buffer,e=r.alloc(16,0);function t(o){return[o.readUInt32BE(0),o.readUInt32BE(4),o.readUInt32BE(8),o.readUInt32BE(12)]}function n(o){var c=r.allocUnsafe(16);return c.writeUInt32BE(o[0]>>>0,0),c.writeUInt32BE(o[1]>>>0,4),c.writeUInt32BE(o[2]>>>0,8),c.writeUInt32BE(o[3]>>>0,12),c}function a(o){this.h=o,this.state=r.alloc(16,0),this.cache=r.allocUnsafe(0)}return a.prototype.ghash=function(o){for(var c=-1;++c<o.length;)this.state[c]^=o[c];this._multiply()},a.prototype._multiply=function(){for(var o=t(this.h),c=[0,0,0,0],u,v,_,x=-1;++x<128;){for(v=(this.state[~~(x/8)]&1<<7-x%8)!==0,v&&(c[0]^=o[0],c[1]^=o[1],c[2]^=o[2],c[3]^=o[3]),_=(o[3]&1)!==0,u=3;u>0;u--)o[u]=o[u]>>>1|(o[u-1]&1)<<31;o[0]=o[0]>>>1,_&&(o[0]=o[0]^225<<24)}this.state=n(c)},a.prototype.update=function(o){this.cache=r.concat([this.cache,o]);for(var c;this.cache.length>=16;)c=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(c)},a.prototype.final=function(o,c){return this.cache.length&&this.ghash(r.concat([this.cache,e],16)),this.ghash(n([0,o,0,c])),this.state},ghash=a,ghash}var authCipher,hasRequiredAuthCipher;function requireAuthCipher(){if(hasRequiredAuthCipher)return authCipher;hasRequiredAuthCipher=1;var r=requireAes(),e=requireSafeBuffer$1().Buffer,t=requireCipherBase(),n=requireInherits_browser(),a=requireGhash(),o=requireBufferXor(),c=requireIncr32();function u(x,E){var M=0;x.length!==E.length&&M++;for(var C=Math.min(x.length,E.length),I=0;I<C;++I)M+=x[I]^E[I];return M}function v(x,E,M){if(E.length===12)return x._finID=e.concat([E,e.from([0,0,0,1])]),e.concat([E,e.from([0,0,0,2])]);var C=new a(M),I=E.length,D=I%16;C.update(E),D&&(D=16-D,C.update(e.alloc(D,0))),C.update(e.alloc(8,0));var L=I*8,N=e.alloc(8);N.writeUIntBE(L,0,8),C.update(N),x._finID=C.state;var q=e.from(x._finID);return c(q),q}function _(x,E,M,C){t.call(this);var I=e.alloc(4,0);this._cipher=new r.AES(E);var D=this._cipher.encryptBlock(I);this._ghash=new a(D),M=v(this,M,D),this._prev=e.from(M),this._cache=e.allocUnsafe(0),this._secCache=e.allocUnsafe(0),this._decrypt=C,this._alen=0,this._len=0,this._mode=x,this._authTag=null,this._called=!1}return n(_,t),_.prototype._update=function(x){if(!this._called&&this._alen){var E=16-this._alen%16;E<16&&(E=e.alloc(E,0),this._ghash.update(E))}this._called=!0;var M=this._mode.encrypt(this,x);return this._decrypt?this._ghash.update(x):this._ghash.update(M),this._len+=x.length,M},_.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var x=o(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt&&u(x,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=x,this._cipher.scrub()},_.prototype.getAuthTag=function(){if(this._decrypt||!e.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},_.prototype.setAuthTag=function(E){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=E},_.prototype.setAAD=function(E){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(E),this._alen+=E.length},authCipher=_,authCipher}var streamCipher,hasRequiredStreamCipher;function requireStreamCipher(){if(hasRequiredStreamCipher)return streamCipher;hasRequiredStreamCipher=1;var r=requireAes(),e=requireSafeBuffer$1().Buffer,t=requireCipherBase(),n=requireInherits_browser();function a(o,c,u,v){t.call(this),this._cipher=new r.AES(c),this._prev=e.from(u),this._cache=e.allocUnsafe(0),this._secCache=e.allocUnsafe(0),this._decrypt=v,this._mode=o}return n(a,t),a.prototype._update=function(o){return this._mode.encrypt(this,o,this._decrypt)},a.prototype._final=function(){this._cipher.scrub()},streamCipher=a,streamCipher}var evp_bytestokey,hasRequiredEvp_bytestokey;function requireEvp_bytestokey(){if(hasRequiredEvp_bytestokey)return evp_bytestokey;hasRequiredEvp_bytestokey=1;var r=requireSafeBuffer$1().Buffer,e=requireMd5_js();function t(n,a,o,c){if(r.isBuffer(n)||(n=r.from(n,"binary")),a&&(r.isBuffer(a)||(a=r.from(a,"binary")),a.length!==8))throw new RangeError("salt should be Buffer with 8 byte length");for(var u=o/8,v=r.alloc(u),_=r.alloc(c||0),x=r.alloc(0);u>0||c>0;){var E=new e;E.update(x),E.update(n),a&&E.update(a),x=E.digest();var M=0;if(u>0){var C=v.length-u;M=Math.min(u,x.length),x.copy(v,C,0,M),u-=M}if(M<x.length&&c>0){var I=_.length-c,D=Math.min(c,x.length-M);x.copy(_,I,M,M+D),c-=D}}return x.fill(0),{key:v,iv:_}}return evp_bytestokey=t,evp_bytestokey}var hasRequiredEncrypter;function requireEncrypter(){if(hasRequiredEncrypter)return encrypter;hasRequiredEncrypter=1;var r=requireModes$1(),e=requireAuthCipher(),t=requireSafeBuffer$1().Buffer,n=requireStreamCipher(),a=requireCipherBase(),o=requireAes(),c=requireEvp_bytestokey(),u=requireInherits_browser();function v(C,I,D){a.call(this),this._cache=new x,this._cipher=new o.AES(I),this._prev=t.from(D),this._mode=C,this._autopadding=!0}u(v,a),v.prototype._update=function(C){this._cache.add(C);for(var I,D,L=[];I=this._cache.get();)D=this._mode.encrypt(this,I),L.push(D);return t.concat(L)};var _=t.alloc(16,16);v.prototype._final=function(){var C=this._cache.flush();if(this._autopadding)return C=this._mode.encrypt(this,C),this._cipher.scrub(),C;if(!C.equals(_))throw this._cipher.scrub(),new Error("data not multiple of block length")},v.prototype.setAutoPadding=function(C){return this._autopadding=!!C,this};function x(){this.cache=t.allocUnsafe(0)}x.prototype.add=function(C){this.cache=t.concat([this.cache,C])},x.prototype.get=function(){if(this.cache.length>15){var C=this.cache.slice(0,16);return this.cache=this.cache.slice(16),C}return null},x.prototype.flush=function(){for(var C=16-this.cache.length,I=t.allocUnsafe(C),D=-1;++D<C;)I.writeUInt8(C,D);return t.concat([this.cache,I])};function E(C,I,D){var L=r[C.toLowerCase()];if(!L)throw new TypeError("invalid suite type");if(typeof I=="string"&&(I=t.from(I)),I.length!==L.key/8)throw new TypeError("invalid key length "+I.length);if(typeof D=="string"&&(D=t.from(D)),L.mode!=="GCM"&&D.length!==L.iv)throw new TypeError("invalid iv length "+D.length);return L.type==="stream"?new n(L.module,I,D):L.type==="auth"?new e(L.module,I,D):new v(L.module,I,D)}function M(C,I){var D=r[C.toLowerCase()];if(!D)throw new TypeError("invalid suite type");var L=c(I,!1,D.key,D.iv);return E(C,L.key,L.iv)}return encrypter.createCipheriv=E,encrypter.createCipher=M,encrypter}var decrypter={},hasRequiredDecrypter;function requireDecrypter(){if(hasRequiredDecrypter)return decrypter;hasRequiredDecrypter=1;var r=requireAuthCipher(),e=requireSafeBuffer$1().Buffer,t=requireModes$1(),n=requireStreamCipher(),a=requireCipherBase(),o=requireAes(),c=requireEvp_bytestokey(),u=requireInherits_browser();function v(C,I,D){a.call(this),this._cache=new _,this._last=void 0,this._cipher=new o.AES(I),this._prev=e.from(D),this._mode=C,this._autopadding=!0}u(v,a),v.prototype._update=function(C){this._cache.add(C);for(var I,D,L=[];I=this._cache.get(this._autopadding);)D=this._mode.decrypt(this,I),L.push(D);return e.concat(L)},v.prototype._final=function(){var C=this._cache.flush();if(this._autopadding)return x(this._mode.decrypt(this,C));if(C)throw new Error("data not multiple of block length")},v.prototype.setAutoPadding=function(C){return this._autopadding=!!C,this};function _(){this.cache=e.allocUnsafe(0)}_.prototype.add=function(C){this.cache=e.concat([this.cache,C])},_.prototype.get=function(C){var I;if(C){if(this.cache.length>16)return I=this.cache.slice(0,16),this.cache=this.cache.slice(16),I}else if(this.cache.length>=16)return I=this.cache.slice(0,16),this.cache=this.cache.slice(16),I;return null},_.prototype.flush=function(){if(this.cache.length)return this.cache};function x(C){var I=C[15];if(I<1||I>16)throw new Error("unable to decrypt data");for(var D=-1;++D<I;)if(C[D+(16-I)]!==I)throw new Error("unable to decrypt data");if(I!==16)return C.slice(0,16-I)}function E(C,I,D){var L=t[C.toLowerCase()];if(!L)throw new TypeError("invalid suite type");if(typeof D=="string"&&(D=e.from(D)),L.mode!=="GCM"&&D.length!==L.iv)throw new TypeError("invalid iv length "+D.length);if(typeof I=="string"&&(I=e.from(I)),I.length!==L.key/8)throw new TypeError("invalid key length "+I.length);return L.type==="stream"?new n(L.module,I,D,!0):L.type==="auth"?new r(L.module,I,D,!0):new v(L.module,I,D)}function M(C,I){var D=t[C.toLowerCase()];if(!D)throw new TypeError("invalid suite type");var L=c(I,!1,D.key,D.iv);return E(C,L.key,L.iv)}return decrypter.createDecipher=M,decrypter.createDecipheriv=E,decrypter}var hasRequiredBrowser$6;function requireBrowser$6(){if(hasRequiredBrowser$6)return browser$6;hasRequiredBrowser$6=1;var r=requireEncrypter(),e=requireDecrypter(),t=require$$2;function n(){return Object.keys(t)}return browser$6.createCipher=browser$6.Cipher=r.createCipher,browser$6.createCipheriv=browser$6.Cipheriv=r.createCipheriv,browser$6.createDecipher=browser$6.Decipher=e.createDecipher,browser$6.createDecipheriv=browser$6.Decipheriv=e.createDecipheriv,browser$6.listCiphers=browser$6.getCiphers=n,browser$6}var modes={},hasRequiredModes;function requireModes(){return hasRequiredModes||(hasRequiredModes=1,function(r){r["des-ecb"]={key:8,iv:0},r["des-cbc"]=r.des={key:8,iv:8},r["des-ede3-cbc"]=r.des3={key:24,iv:8},r["des-ede3"]={key:24,iv:0},r["des-ede-cbc"]={key:16,iv:8},r["des-ede"]={key:16,iv:0}}(modes)),modes}var hasRequiredBrowser$5;function requireBrowser$5(){if(hasRequiredBrowser$5)return browser$7;hasRequiredBrowser$5=1;var r=requireBrowserifyDes(),e=requireBrowser$6(),t=requireModes$1(),n=requireModes(),a=requireEvp_bytestokey();function o(x,E){x=x.toLowerCase();var M,C;if(t[x])M=t[x].key,C=t[x].iv;else if(n[x])M=n[x].key*8,C=n[x].iv;else throw new TypeError("invalid suite type");var I=a(E,!1,M,C);return u(x,I.key,I.iv)}function c(x,E){x=x.toLowerCase();var M,C;if(t[x])M=t[x].key,C=t[x].iv;else if(n[x])M=n[x].key*8,C=n[x].iv;else throw new TypeError("invalid suite type");var I=a(E,!1,M,C);return v(x,I.key,I.iv)}function u(x,E,M){if(x=x.toLowerCase(),t[x])return e.createCipheriv(x,E,M);if(n[x])return new r({key:E,iv:M,mode:x});throw new TypeError("invalid suite type")}function v(x,E,M){if(x=x.toLowerCase(),t[x])return e.createDecipheriv(x,E,M);if(n[x])return new r({key:E,iv:M,mode:x,decrypt:!0});throw new TypeError("invalid suite type")}function _(){return Object.keys(n).concat(e.getCiphers())}return browser$7.createCipher=browser$7.Cipher=o,browser$7.createCipheriv=browser$7.Cipheriv=u,browser$7.createDecipher=browser$7.Decipher=c,browser$7.createDecipheriv=browser$7.Decipheriv=v,browser$7.listCiphers=browser$7.getCiphers=_,browser$7}var browser$5={},bn$6={exports:{}};bn$6.exports;var hasRequiredBn$6;function requireBn$6(){return hasRequiredBn$6||(hasRequiredBn$6=1,function(r){(function(e,t){function n(O,l){if(!O)throw new Error(l||"Assertion failed")}function a(O,l){O.super_=l;var p=function(){};p.prototype=l.prototype,O.prototype=new p,O.prototype.constructor=O}function o(O,l,p){if(o.isBN(O))return O;this.negative=0,this.words=null,this.length=0,this.red=null,O!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(O||0,l||10,p||"be"))}typeof e=="object"?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=bufferPolyfill.Buffer}catch{}o.isBN=function(l){return l instanceof o?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===o.wordSize&&Array.isArray(l.words)},o.max=function(l,p){return l.cmp(p)>0?l:p},o.min=function(l,p){return l.cmp(p)<0?l:p},o.prototype._init=function(l,p,b){if(typeof l=="number")return this._initNumber(l,p,b);if(typeof l=="object")return this._initArray(l,p,b);p==="hex"&&(p=16),n(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var S=0;l[0]==="-"&&(S++,this.negative=1),S<l.length&&(p===16?this._parseHex(l,S,b):(this._parseBase(l,p,S),b==="le"&&this._initArray(this.toArray(),p,b)))},o.prototype._initNumber=function(l,p,b){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(n(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),b==="le"&&this._initArray(this.toArray(),p,b)},o.prototype._initArray=function(l,p,b){if(n(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T,B,$=0;if(b==="be")for(S=l.length-1,T=0;S>=0;S-=3)B=l[S]|l[S-1]<<8|l[S-2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);else if(b==="le")for(S=0,T=0;S<l.length;S+=3)B=l[S]|l[S+1]<<8|l[S+2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);return this.strip()};function u(O,l){var p=O.charCodeAt(l);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function v(O,l,p){var b=u(O,p);return p-1>=l&&(b|=u(O,p-1)<<4),b}o.prototype._parseHex=function(l,p,b){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T=0,B=0,$;if(b==="be")for(S=l.length-1;S>=p;S-=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8;else{var A=l.length-p;for(S=A%2===0?p+1:p;S<l.length;S+=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8}this.strip()};function _(O,l,p,b){for(var S=0,T=Math.min(O.length,p),B=l;B<T;B++){var $=O.charCodeAt(B)-48;S*=b,$>=49?S+=$-49+10:$>=17?S+=$-17+10:S+=$}return S}o.prototype._parseBase=function(l,p,b){this.words=[0],this.length=1;for(var S=0,T=1;T<=67108863;T*=p)S++;S--,T=T/p|0;for(var B=l.length-b,$=B%S,A=Math.min(B,B-$)+b,g=0,k=b;k<A;k+=S)g=_(l,k,k+S,p),this.imuln(T),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g);if($!==0){var H=1;for(g=_(l,k,l.length,p),k=0;k<$;k++)H*=p;this.imuln(H),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g)}this.strip()},o.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red},o.prototype.clone=function(){var l=new o(null);return this.copy(l),l},o.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],E=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],M=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(l,p){l=l||10,p=p|0||1;var b;if(l===16||l==="hex"){b="";for(var S=0,T=0,B=0;B<this.length;B++){var $=this.words[B],A=(($<<S|T)&16777215).toString(16);T=$>>>24-S&16777215,S+=2,S>=26&&(S-=26,B--),T!==0||B!==this.length-1?b=x[6-A.length]+A+b:b=A+b}for(T!==0&&(b=T.toString(16)+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}if(l===(l|0)&&l>=2&&l<=36){var g=E[l],k=M[l];b="";var H=this.clone();for(H.negative=0;!H.isZero();){var z=H.modn(k).toString(l);H=H.idivn(k),H.isZero()?b=z+b:b=x[g-z.length]+z+b}for(this.isZero()&&(b="0"+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(l,p){return n(typeof c<"u"),this.toArrayLike(c,l,p)},o.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)},o.prototype.toArrayLike=function(l,p,b){var S=this.byteLength(),T=b||Math.max(1,S);n(S<=T,"byte array longer than desired length"),n(T>0,"Requested array length <= 0"),this.strip();var B=p==="le",$=new l(T),A,g,k=this.clone();if(B){for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[g]=A;for(;g<T;g++)$[g]=0}else{for(g=0;g<T-S;g++)$[g]=0;for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[T-g-1]=A}return $},Math.clz32?o.prototype._countBits=function(l){return 32-Math.clz32(l)}:o.prototype._countBits=function(l){var p=l,b=0;return p>=4096&&(b+=13,p>>>=13),p>=64&&(b+=7,p>>>=7),p>=8&&(b+=4,p>>>=4),p>=2&&(b+=2,p>>>=2),b+p},o.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,b=0;return p&8191||(b+=13,p>>>=13),p&127||(b+=7,p>>>=7),p&15||(b+=4,p>>>=4),p&3||(b+=2,p>>>=2),p&1||b++,b},o.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function C(O){for(var l=new Array(O.bitLength()),p=0;p<l.length;p++){var b=p/26|0,S=p%26;l[p]=(O.words[b]&1<<S)>>>S}return l}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var b=this._zeroBits(this.words[p]);if(l+=b,b!==26)break}return l},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},o.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this.strip()},o.prototype.ior=function(l){return n((this.negative|l.negative)===0),this.iuor(l)},o.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},o.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},o.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var b=0;b<p.length;b++)this.words[b]=this.words[b]&l.words[b];return this.length=p.length,this.strip()},o.prototype.iand=function(l){return n((this.negative|l.negative)===0),this.iuand(l)},o.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},o.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},o.prototype.iuxor=function(l){var p,b;this.length>l.length?(p=this,b=l):(p=l,b=this);for(var S=0;S<b.length;S++)this.words[S]=p.words[S]^b.words[S];if(this!==p)for(;S<p.length;S++)this.words[S]=p.words[S];return this.length=p.length,this.strip()},o.prototype.ixor=function(l){return n((this.negative|l.negative)===0),this.iuxor(l)},o.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},o.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},o.prototype.inotn=function(l){n(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,b=l%26;this._expand(p),b>0&&p--;for(var S=0;S<p;S++)this.words[S]=~this.words[S]&67108863;return b>0&&(this.words[S]=~this.words[S]&67108863>>26-b),this.strip()},o.prototype.notn=function(l){return this.clone().inotn(l)},o.prototype.setn=function(l,p){n(typeof l=="number"&&l>=0);var b=l/26|0,S=l%26;return this._expand(b+1),p?this.words[b]=this.words[b]|1<<S:this.words[b]=this.words[b]&~(1<<S),this.strip()},o.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var b,S;this.length>l.length?(b=this,S=l):(b=l,S=this);for(var T=0,B=0;B<S.length;B++)p=(b.words[B]|0)+(S.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;for(;T!==0&&B<b.length;B++)p=(b.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;if(this.length=b.length,T!==0)this.words[this.length]=T,this.length++;else if(b!==this)for(;B<b.length;B++)this.words[B]=b.words[B];return this},o.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},o.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var b=this.cmp(l);if(b===0)return this.negative=0,this.length=1,this.words[0]=0,this;var S,T;b>0?(S=this,T=l):(S=l,T=this);for(var B=0,$=0;$<T.length;$++)p=(S.words[$]|0)-(T.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;for(;B!==0&&$<S.length;$++)p=(S.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;if(B===0&&$<S.length&&S!==this)for(;$<S.length;$++)this.words[$]=S.words[$];return this.length=Math.max(this.length,$),S!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(l){return this.clone().isub(l)};function I(O,l,p){p.negative=l.negative^O.negative;var b=O.length+l.length|0;p.length=b,b=b-1|0;var S=O.words[0]|0,T=l.words[0]|0,B=S*T,$=B&67108863,A=B/67108864|0;p.words[0]=$;for(var g=1;g<b;g++){for(var k=A>>>26,H=A&67108863,z=Math.min(g,l.length-1),Q=Math.max(0,g-O.length+1);Q<=z;Q++){var ie=g-Q|0;S=O.words[ie]|0,T=l.words[Q]|0,B=S*T+H,k+=B/67108864|0,H=B&67108863}p.words[g]=H|0,A=k|0}return A!==0?p.words[g]=A|0:p.length--,p.strip()}var D=function(l,p,b){var S=l.words,T=p.words,B=b.words,$=0,A,g,k,H=S[0]|0,z=H&8191,Q=H>>>13,ie=S[1]|0,ne=ie&8191,Z=ie>>>13,se=S[2]|0,ae=se&8191,ce=se>>>13,le=S[3]|0,te=le&8191,he=le>>>13,Ae=S[4]|0,ge=Ae&8191,me=Ae>>>13,je=S[5]|0,we=je&8191,pe=je>>>13,Ke=S[6]|0,ye=Ke&8191,xe=Ke>>>13,Ve=S[7]|0,be=Ve&8191,Ee=Ve>>>13,Ge=S[8]|0,re=Ge&8191,Y=Ge>>>13,ee=S[9]|0,fe=ee&8191,ue=ee>>>13,ve=T[0]|0,de=ve&8191,Se=ve>>>13,We=T[1]|0,_e=We&8191,Me=We>>>13,ze=T[2]|0,Te=ze&8191,$e=ze>>>13,Je=T[3]|0,ke=Je&8191,Oe=Je>>>13,Ze=T[4]|0,Be=Ze&8191,Le=Ze>>>13,Qe=T[5]|0,Re=Qe&8191,Ne=Qe>>>13,et=T[6]|0,Ce=et&8191,qe=et>>>13,tt=T[7]|0,Ie=tt&8191,Fe=tt>>>13,rt=T[8]|0,De=rt&8191,Ue=rt>>>13,nt=T[9]|0,Pe=nt&8191,He=nt>>>13;b.negative=l.negative^p.negative,b.length=19,A=Math.imul(z,de),g=Math.imul(z,Se),g=g+Math.imul(Q,de)|0,k=Math.imul(Q,Se);var Xe=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Xe>>>26)|0,Xe&=67108863,A=Math.imul(ne,de),g=Math.imul(ne,Se),g=g+Math.imul(Z,de)|0,k=Math.imul(Z,Se),A=A+Math.imul(z,_e)|0,g=g+Math.imul(z,Me)|0,g=g+Math.imul(Q,_e)|0,k=k+Math.imul(Q,Me)|0;var Ye=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,A=Math.imul(ae,de),g=Math.imul(ae,Se),g=g+Math.imul(ce,de)|0,k=Math.imul(ce,Se),A=A+Math.imul(ne,_e)|0,g=g+Math.imul(ne,Me)|0,g=g+Math.imul(Z,_e)|0,k=k+Math.imul(Z,Me)|0,A=A+Math.imul(z,Te)|0,g=g+Math.imul(z,$e)|0,g=g+Math.imul(Q,Te)|0,k=k+Math.imul(Q,$e)|0;var it=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(it>>>26)|0,it&=67108863,A=Math.imul(te,de),g=Math.imul(te,Se),g=g+Math.imul(he,de)|0,k=Math.imul(he,Se),A=A+Math.imul(ae,_e)|0,g=g+Math.imul(ae,Me)|0,g=g+Math.imul(ce,_e)|0,k=k+Math.imul(ce,Me)|0,A=A+Math.imul(ne,Te)|0,g=g+Math.imul(ne,$e)|0,g=g+Math.imul(Z,Te)|0,k=k+Math.imul(Z,$e)|0,A=A+Math.imul(z,ke)|0,g=g+Math.imul(z,Oe)|0,g=g+Math.imul(Q,ke)|0,k=k+Math.imul(Q,Oe)|0;var st=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(st>>>26)|0,st&=67108863,A=Math.imul(ge,de),g=Math.imul(ge,Se),g=g+Math.imul(me,de)|0,k=Math.imul(me,Se),A=A+Math.imul(te,_e)|0,g=g+Math.imul(te,Me)|0,g=g+Math.imul(he,_e)|0,k=k+Math.imul(he,Me)|0,A=A+Math.imul(ae,Te)|0,g=g+Math.imul(ae,$e)|0,g=g+Math.imul(ce,Te)|0,k=k+Math.imul(ce,$e)|0,A=A+Math.imul(ne,ke)|0,g=g+Math.imul(ne,Oe)|0,g=g+Math.imul(Z,ke)|0,k=k+Math.imul(Z,Oe)|0,A=A+Math.imul(z,Be)|0,g=g+Math.imul(z,Le)|0,g=g+Math.imul(Q,Be)|0,k=k+Math.imul(Q,Le)|0;var ot=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ot>>>26)|0,ot&=67108863,A=Math.imul(we,de),g=Math.imul(we,Se),g=g+Math.imul(pe,de)|0,k=Math.imul(pe,Se),A=A+Math.imul(ge,_e)|0,g=g+Math.imul(ge,Me)|0,g=g+Math.imul(me,_e)|0,k=k+Math.imul(me,Me)|0,A=A+Math.imul(te,Te)|0,g=g+Math.imul(te,$e)|0,g=g+Math.imul(he,Te)|0,k=k+Math.imul(he,$e)|0,A=A+Math.imul(ae,ke)|0,g=g+Math.imul(ae,Oe)|0,g=g+Math.imul(ce,ke)|0,k=k+Math.imul(ce,Oe)|0,A=A+Math.imul(ne,Be)|0,g=g+Math.imul(ne,Le)|0,g=g+Math.imul(Z,Be)|0,k=k+Math.imul(Z,Le)|0,A=A+Math.imul(z,Re)|0,g=g+Math.imul(z,Ne)|0,g=g+Math.imul(Q,Re)|0,k=k+Math.imul(Q,Ne)|0;var at=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(at>>>26)|0,at&=67108863,A=Math.imul(ye,de),g=Math.imul(ye,Se),g=g+Math.imul(xe,de)|0,k=Math.imul(xe,Se),A=A+Math.imul(we,_e)|0,g=g+Math.imul(we,Me)|0,g=g+Math.imul(pe,_e)|0,k=k+Math.imul(pe,Me)|0,A=A+Math.imul(ge,Te)|0,g=g+Math.imul(ge,$e)|0,g=g+Math.imul(me,Te)|0,k=k+Math.imul(me,$e)|0,A=A+Math.imul(te,ke)|0,g=g+Math.imul(te,Oe)|0,g=g+Math.imul(he,ke)|0,k=k+Math.imul(he,Oe)|0,A=A+Math.imul(ae,Be)|0,g=g+Math.imul(ae,Le)|0,g=g+Math.imul(ce,Be)|0,k=k+Math.imul(ce,Le)|0,A=A+Math.imul(ne,Re)|0,g=g+Math.imul(ne,Ne)|0,g=g+Math.imul(Z,Re)|0,k=k+Math.imul(Z,Ne)|0,A=A+Math.imul(z,Ce)|0,g=g+Math.imul(z,qe)|0,g=g+Math.imul(Q,Ce)|0,k=k+Math.imul(Q,qe)|0;var ft=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ft>>>26)|0,ft&=67108863,A=Math.imul(be,de),g=Math.imul(be,Se),g=g+Math.imul(Ee,de)|0,k=Math.imul(Ee,Se),A=A+Math.imul(ye,_e)|0,g=g+Math.imul(ye,Me)|0,g=g+Math.imul(xe,_e)|0,k=k+Math.imul(xe,Me)|0,A=A+Math.imul(we,Te)|0,g=g+Math.imul(we,$e)|0,g=g+Math.imul(pe,Te)|0,k=k+Math.imul(pe,$e)|0,A=A+Math.imul(ge,ke)|0,g=g+Math.imul(ge,Oe)|0,g=g+Math.imul(me,ke)|0,k=k+Math.imul(me,Oe)|0,A=A+Math.imul(te,Be)|0,g=g+Math.imul(te,Le)|0,g=g+Math.imul(he,Be)|0,k=k+Math.imul(he,Le)|0,A=A+Math.imul(ae,Re)|0,g=g+Math.imul(ae,Ne)|0,g=g+Math.imul(ce,Re)|0,k=k+Math.imul(ce,Ne)|0,A=A+Math.imul(ne,Ce)|0,g=g+Math.imul(ne,qe)|0,g=g+Math.imul(Z,Ce)|0,k=k+Math.imul(Z,qe)|0,A=A+Math.imul(z,Ie)|0,g=g+Math.imul(z,Fe)|0,g=g+Math.imul(Q,Ie)|0,k=k+Math.imul(Q,Fe)|0;var lt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(lt>>>26)|0,lt&=67108863,A=Math.imul(re,de),g=Math.imul(re,Se),g=g+Math.imul(Y,de)|0,k=Math.imul(Y,Se),A=A+Math.imul(be,_e)|0,g=g+Math.imul(be,Me)|0,g=g+Math.imul(Ee,_e)|0,k=k+Math.imul(Ee,Me)|0,A=A+Math.imul(ye,Te)|0,g=g+Math.imul(ye,$e)|0,g=g+Math.imul(xe,Te)|0,k=k+Math.imul(xe,$e)|0,A=A+Math.imul(we,ke)|0,g=g+Math.imul(we,Oe)|0,g=g+Math.imul(pe,ke)|0,k=k+Math.imul(pe,Oe)|0,A=A+Math.imul(ge,Be)|0,g=g+Math.imul(ge,Le)|0,g=g+Math.imul(me,Be)|0,k=k+Math.imul(me,Le)|0,A=A+Math.imul(te,Re)|0,g=g+Math.imul(te,Ne)|0,g=g+Math.imul(he,Re)|0,k=k+Math.imul(he,Ne)|0,A=A+Math.imul(ae,Ce)|0,g=g+Math.imul(ae,qe)|0,g=g+Math.imul(ce,Ce)|0,k=k+Math.imul(ce,qe)|0,A=A+Math.imul(ne,Ie)|0,g=g+Math.imul(ne,Fe)|0,g=g+Math.imul(Z,Ie)|0,k=k+Math.imul(Z,Fe)|0,A=A+Math.imul(z,De)|0,g=g+Math.imul(z,Ue)|0,g=g+Math.imul(Q,De)|0,k=k+Math.imul(Q,Ue)|0;var ct=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ct>>>26)|0,ct&=67108863,A=Math.imul(fe,de),g=Math.imul(fe,Se),g=g+Math.imul(ue,de)|0,k=Math.imul(ue,Se),A=A+Math.imul(re,_e)|0,g=g+Math.imul(re,Me)|0,g=g+Math.imul(Y,_e)|0,k=k+Math.imul(Y,Me)|0,A=A+Math.imul(be,Te)|0,g=g+Math.imul(be,$e)|0,g=g+Math.imul(Ee,Te)|0,k=k+Math.imul(Ee,$e)|0,A=A+Math.imul(ye,ke)|0,g=g+Math.imul(ye,Oe)|0,g=g+Math.imul(xe,ke)|0,k=k+Math.imul(xe,Oe)|0,A=A+Math.imul(we,Be)|0,g=g+Math.imul(we,Le)|0,g=g+Math.imul(pe,Be)|0,k=k+Math.imul(pe,Le)|0,A=A+Math.imul(ge,Re)|0,g=g+Math.imul(ge,Ne)|0,g=g+Math.imul(me,Re)|0,k=k+Math.imul(me,Ne)|0,A=A+Math.imul(te,Ce)|0,g=g+Math.imul(te,qe)|0,g=g+Math.imul(he,Ce)|0,k=k+Math.imul(he,qe)|0,A=A+Math.imul(ae,Ie)|0,g=g+Math.imul(ae,Fe)|0,g=g+Math.imul(ce,Ie)|0,k=k+Math.imul(ce,Fe)|0,A=A+Math.imul(ne,De)|0,g=g+Math.imul(ne,Ue)|0,g=g+Math.imul(Z,De)|0,k=k+Math.imul(Z,Ue)|0,A=A+Math.imul(z,Pe)|0,g=g+Math.imul(z,He)|0,g=g+Math.imul(Q,Pe)|0,k=k+Math.imul(Q,He)|0;var ht=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ht>>>26)|0,ht&=67108863,A=Math.imul(fe,_e),g=Math.imul(fe,Me),g=g+Math.imul(ue,_e)|0,k=Math.imul(ue,Me),A=A+Math.imul(re,Te)|0,g=g+Math.imul(re,$e)|0,g=g+Math.imul(Y,Te)|0,k=k+Math.imul(Y,$e)|0,A=A+Math.imul(be,ke)|0,g=g+Math.imul(be,Oe)|0,g=g+Math.imul(Ee,ke)|0,k=k+Math.imul(Ee,Oe)|0,A=A+Math.imul(ye,Be)|0,g=g+Math.imul(ye,Le)|0,g=g+Math.imul(xe,Be)|0,k=k+Math.imul(xe,Le)|0,A=A+Math.imul(we,Re)|0,g=g+Math.imul(we,Ne)|0,g=g+Math.imul(pe,Re)|0,k=k+Math.imul(pe,Ne)|0,A=A+Math.imul(ge,Ce)|0,g=g+Math.imul(ge,qe)|0,g=g+Math.imul(me,Ce)|0,k=k+Math.imul(me,qe)|0,A=A+Math.imul(te,Ie)|0,g=g+Math.imul(te,Fe)|0,g=g+Math.imul(he,Ie)|0,k=k+Math.imul(he,Fe)|0,A=A+Math.imul(ae,De)|0,g=g+Math.imul(ae,Ue)|0,g=g+Math.imul(ce,De)|0,k=k+Math.imul(ce,Ue)|0,A=A+Math.imul(ne,Pe)|0,g=g+Math.imul(ne,He)|0,g=g+Math.imul(Z,Pe)|0,k=k+Math.imul(Z,He)|0;var dt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(dt>>>26)|0,dt&=67108863,A=Math.imul(fe,Te),g=Math.imul(fe,$e),g=g+Math.imul(ue,Te)|0,k=Math.imul(ue,$e),A=A+Math.imul(re,ke)|0,g=g+Math.imul(re,Oe)|0,g=g+Math.imul(Y,ke)|0,k=k+Math.imul(Y,Oe)|0,A=A+Math.imul(be,Be)|0,g=g+Math.imul(be,Le)|0,g=g+Math.imul(Ee,Be)|0,k=k+Math.imul(Ee,Le)|0,A=A+Math.imul(ye,Re)|0,g=g+Math.imul(ye,Ne)|0,g=g+Math.imul(xe,Re)|0,k=k+Math.imul(xe,Ne)|0,A=A+Math.imul(we,Ce)|0,g=g+Math.imul(we,qe)|0,g=g+Math.imul(pe,Ce)|0,k=k+Math.imul(pe,qe)|0,A=A+Math.imul(ge,Ie)|0,g=g+Math.imul(ge,Fe)|0,g=g+Math.imul(me,Ie)|0,k=k+Math.imul(me,Fe)|0,A=A+Math.imul(te,De)|0,g=g+Math.imul(te,Ue)|0,g=g+Math.imul(he,De)|0,k=k+Math.imul(he,Ue)|0,A=A+Math.imul(ae,Pe)|0,g=g+Math.imul(ae,He)|0,g=g+Math.imul(ce,Pe)|0,k=k+Math.imul(ce,He)|0;var pt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(pt>>>26)|0,pt&=67108863,A=Math.imul(fe,ke),g=Math.imul(fe,Oe),g=g+Math.imul(ue,ke)|0,k=Math.imul(ue,Oe),A=A+Math.imul(re,Be)|0,g=g+Math.imul(re,Le)|0,g=g+Math.imul(Y,Be)|0,k=k+Math.imul(Y,Le)|0,A=A+Math.imul(be,Re)|0,g=g+Math.imul(be,Ne)|0,g=g+Math.imul(Ee,Re)|0,k=k+Math.imul(Ee,Ne)|0,A=A+Math.imul(ye,Ce)|0,g=g+Math.imul(ye,qe)|0,g=g+Math.imul(xe,Ce)|0,k=k+Math.imul(xe,qe)|0,A=A+Math.imul(we,Ie)|0,g=g+Math.imul(we,Fe)|0,g=g+Math.imul(pe,Ie)|0,k=k+Math.imul(pe,Fe)|0,A=A+Math.imul(ge,De)|0,g=g+Math.imul(ge,Ue)|0,g=g+Math.imul(me,De)|0,k=k+Math.imul(me,Ue)|0,A=A+Math.imul(te,Pe)|0,g=g+Math.imul(te,He)|0,g=g+Math.imul(he,Pe)|0,k=k+Math.imul(he,He)|0;var gt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(gt>>>26)|0,gt&=67108863,A=Math.imul(fe,Be),g=Math.imul(fe,Le),g=g+Math.imul(ue,Be)|0,k=Math.imul(ue,Le),A=A+Math.imul(re,Re)|0,g=g+Math.imul(re,Ne)|0,g=g+Math.imul(Y,Re)|0,k=k+Math.imul(Y,Ne)|0,A=A+Math.imul(be,Ce)|0,g=g+Math.imul(be,qe)|0,g=g+Math.imul(Ee,Ce)|0,k=k+Math.imul(Ee,qe)|0,A=A+Math.imul(ye,Ie)|0,g=g+Math.imul(ye,Fe)|0,g=g+Math.imul(xe,Ie)|0,k=k+Math.imul(xe,Fe)|0,A=A+Math.imul(we,De)|0,g=g+Math.imul(we,Ue)|0,g=g+Math.imul(pe,De)|0,k=k+Math.imul(pe,Ue)|0,A=A+Math.imul(ge,Pe)|0,g=g+Math.imul(ge,He)|0,g=g+Math.imul(me,Pe)|0,k=k+Math.imul(me,He)|0;var mt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(mt>>>26)|0,mt&=67108863,A=Math.imul(fe,Re),g=Math.imul(fe,Ne),g=g+Math.imul(ue,Re)|0,k=Math.imul(ue,Ne),A=A+Math.imul(re,Ce)|0,g=g+Math.imul(re,qe)|0,g=g+Math.imul(Y,Ce)|0,k=k+Math.imul(Y,qe)|0,A=A+Math.imul(be,Ie)|0,g=g+Math.imul(be,Fe)|0,g=g+Math.imul(Ee,Ie)|0,k=k+Math.imul(Ee,Fe)|0,A=A+Math.imul(ye,De)|0,g=g+Math.imul(ye,Ue)|0,g=g+Math.imul(xe,De)|0,k=k+Math.imul(xe,Ue)|0,A=A+Math.imul(we,Pe)|0,g=g+Math.imul(we,He)|0,g=g+Math.imul(pe,Pe)|0,k=k+Math.imul(pe,He)|0;var yt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(yt>>>26)|0,yt&=67108863,A=Math.imul(fe,Ce),g=Math.imul(fe,qe),g=g+Math.imul(ue,Ce)|0,k=Math.imul(ue,qe),A=A+Math.imul(re,Ie)|0,g=g+Math.imul(re,Fe)|0,g=g+Math.imul(Y,Ie)|0,k=k+Math.imul(Y,Fe)|0,A=A+Math.imul(be,De)|0,g=g+Math.imul(be,Ue)|0,g=g+Math.imul(Ee,De)|0,k=k+Math.imul(Ee,Ue)|0,A=A+Math.imul(ye,Pe)|0,g=g+Math.imul(ye,He)|0,g=g+Math.imul(xe,Pe)|0,k=k+Math.imul(xe,He)|0;var vt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(vt>>>26)|0,vt&=67108863,A=Math.imul(fe,Ie),g=Math.imul(fe,Fe),g=g+Math.imul(ue,Ie)|0,k=Math.imul(ue,Fe),A=A+Math.imul(re,De)|0,g=g+Math.imul(re,Ue)|0,g=g+Math.imul(Y,De)|0,k=k+Math.imul(Y,Ue)|0,A=A+Math.imul(be,Pe)|0,g=g+Math.imul(be,He)|0,g=g+Math.imul(Ee,Pe)|0,k=k+Math.imul(Ee,He)|0;var bt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(bt>>>26)|0,bt&=67108863,A=Math.imul(fe,De),g=Math.imul(fe,Ue),g=g+Math.imul(ue,De)|0,k=Math.imul(ue,Ue),A=A+Math.imul(re,Pe)|0,g=g+Math.imul(re,He)|0,g=g+Math.imul(Y,Pe)|0,k=k+Math.imul(Y,He)|0;var wt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(wt>>>26)|0,wt&=67108863,A=Math.imul(fe,Pe),g=Math.imul(fe,He),g=g+Math.imul(ue,Pe)|0,k=Math.imul(ue,He);var _t=($+A|0)+((g&8191)<<13)|0;return $=(k+(g>>>13)|0)+(_t>>>26)|0,_t&=67108863,B[0]=Xe,B[1]=Ye,B[2]=it,B[3]=st,B[4]=ot,B[5]=at,B[6]=ft,B[7]=lt,B[8]=ct,B[9]=ht,B[10]=dt,B[11]=pt,B[12]=gt,B[13]=mt,B[14]=yt,B[15]=vt,B[16]=bt,B[17]=wt,B[18]=_t,$!==0&&(B[19]=$,b.length++),b};Math.imul||(D=I);function L(O,l,p){p.negative=l.negative^O.negative,p.length=O.length+l.length;for(var b=0,S=0,T=0;T<p.length-1;T++){var B=S;S=0;for(var $=b&67108863,A=Math.min(T,l.length-1),g=Math.max(0,T-O.length+1);g<=A;g++){var k=T-g,H=O.words[k]|0,z=l.words[g]|0,Q=H*z,ie=Q&67108863;B=B+(Q/67108864|0)|0,ie=ie+$|0,$=ie&67108863,B=B+(ie>>>26)|0,S+=B>>>26,B&=67108863}p.words[T]=$,b=B,B=S}return b!==0?p.words[T]=b:p.length--,p.strip()}function N(O,l,p){var b=new q;return b.mulp(O,l,p)}o.prototype.mulTo=function(l,p){var b,S=this.length+l.length;return this.length===10&&l.length===10?b=D(this,l,p):S<63?b=I(this,l,p):S<1024?b=L(this,l,p):b=N(this,l,p),b};function q(O,l){this.x=O,this.y=l}q.prototype.makeRBT=function(l){for(var p=new Array(l),b=o.prototype._countBits(l)-1,S=0;S<l;S++)p[S]=this.revBin(S,b,l);return p},q.prototype.revBin=function(l,p,b){if(l===0||l===b-1)return l;for(var S=0,T=0;T<p;T++)S|=(l&1)<<p-T-1,l>>=1;return S},q.prototype.permute=function(l,p,b,S,T,B){for(var $=0;$<B;$++)S[$]=p[l[$]],T[$]=b[l[$]]},q.prototype.transform=function(l,p,b,S,T,B){this.permute(B,l,p,b,S,T);for(var $=1;$<T;$<<=1)for(var A=$<<1,g=Math.cos(2*Math.PI/A),k=Math.sin(2*Math.PI/A),H=0;H<T;H+=A)for(var z=g,Q=k,ie=0;ie<$;ie++){var ne=b[H+ie],Z=S[H+ie],se=b[H+ie+$],ae=S[H+ie+$],ce=z*se-Q*ae;ae=z*ae+Q*se,se=ce,b[H+ie]=ne+se,S[H+ie]=Z+ae,b[H+ie+$]=ne-se,S[H+ie+$]=Z-ae,ie!==A&&(ce=g*z-k*Q,Q=g*Q+k*z,z=ce)}},q.prototype.guessLen13b=function(l,p){var b=Math.max(p,l)|1,S=b&1,T=0;for(b=b/2|0;b;b=b>>>1)T++;return 1<<T+1+S},q.prototype.conjugate=function(l,p,b){if(!(b<=1))for(var S=0;S<b/2;S++){var T=l[S];l[S]=l[b-S-1],l[b-S-1]=T,T=p[S],p[S]=-p[b-S-1],p[b-S-1]=-T}},q.prototype.normalize13b=function(l,p){for(var b=0,S=0;S<p/2;S++){var T=Math.round(l[2*S+1]/p)*8192+Math.round(l[2*S]/p)+b;l[S]=T&67108863,T<67108864?b=0:b=T/67108864|0}return l},q.prototype.convert13b=function(l,p,b,S){for(var T=0,B=0;B<p;B++)T=T+(l[B]|0),b[2*B]=T&8191,T=T>>>13,b[2*B+1]=T&8191,T=T>>>13;for(B=2*p;B<S;++B)b[B]=0;n(T===0),n((T&-8192)===0)},q.prototype.stub=function(l){for(var p=new Array(l),b=0;b<l;b++)p[b]=0;return p},q.prototype.mulp=function(l,p,b){var S=2*this.guessLen13b(l.length,p.length),T=this.makeRBT(S),B=this.stub(S),$=new Array(S),A=new Array(S),g=new Array(S),k=new Array(S),H=new Array(S),z=new Array(S),Q=b.words;Q.length=S,this.convert13b(l.words,l.length,$,S),this.convert13b(p.words,p.length,k,S),this.transform($,B,A,g,S,T),this.transform(k,B,H,z,S,T);for(var ie=0;ie<S;ie++){var ne=A[ie]*H[ie]-g[ie]*z[ie];g[ie]=A[ie]*z[ie]+g[ie]*H[ie],A[ie]=ne}return this.conjugate(A,g,S),this.transform(A,g,Q,B,S,T),this.conjugate(Q,B,S),this.normalize13b(Q,S),b.negative=l.negative^p.negative,b.length=l.length+p.length,b.strip()},o.prototype.mul=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},o.prototype.mulf=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),N(this,l,p)},o.prototype.imul=function(l){return this.clone().mulTo(l,this)},o.prototype.imuln=function(l){n(typeof l=="number"),n(l<67108864);for(var p=0,b=0;b<this.length;b++){var S=(this.words[b]|0)*l,T=(S&67108863)+(p&67108863);p>>=26,p+=S/67108864|0,p+=T>>>26,this.words[b]=T&67108863}return p!==0&&(this.words[b]=p,this.length++),this},o.prototype.muln=function(l){return this.clone().imuln(l)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(l){var p=C(l);if(p.length===0)return new o(1);for(var b=this,S=0;S<p.length&&p[S]===0;S++,b=b.sqr());if(++S<p.length)for(var T=b.sqr();S<p.length;S++,T=T.sqr())p[S]!==0&&(b=b.mul(T));return b},o.prototype.iushln=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=67108863>>>26-p<<26-p,T;if(p!==0){var B=0;for(T=0;T<this.length;T++){var $=this.words[T]&S,A=(this.words[T]|0)-$<<p;this.words[T]=A|B,B=$>>>26-p}B&&(this.words[T]=B,this.length++)}if(b!==0){for(T=this.length-1;T>=0;T--)this.words[T+b]=this.words[T];for(T=0;T<b;T++)this.words[T]=0;this.length+=b}return this.strip()},o.prototype.ishln=function(l){return n(this.negative===0),this.iushln(l)},o.prototype.iushrn=function(l,p,b){n(typeof l=="number"&&l>=0);var S;p?S=(p-p%26)/26:S=0;var T=l%26,B=Math.min((l-T)/26,this.length),$=67108863^67108863>>>T<<T,A=b;if(S-=B,S=Math.max(0,S),A){for(var g=0;g<B;g++)A.words[g]=this.words[g];A.length=B}if(B!==0)if(this.length>B)for(this.length-=B,g=0;g<this.length;g++)this.words[g]=this.words[g+B];else this.words[0]=0,this.length=1;var k=0;for(g=this.length-1;g>=0&&(k!==0||g>=S);g--){var H=this.words[g]|0;this.words[g]=k<<26-T|H>>>T,k=H&$}return A&&k!==0&&(A.words[A.length++]=k),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(l,p,b){return n(this.negative===0),this.iushrn(l,p,b)},o.prototype.shln=function(l){return this.clone().ishln(l)},o.prototype.ushln=function(l){return this.clone().iushln(l)},o.prototype.shrn=function(l){return this.clone().ishrn(l)},o.prototype.ushrn=function(l){return this.clone().iushrn(l)},o.prototype.testn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return!1;var T=this.words[b];return!!(T&S)},o.prototype.imaskn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=b)return this;if(p!==0&&b++,this.length=Math.min(b,this.length),p!==0){var S=67108863^67108863>>>p<<p;this.words[this.length-1]&=S}return this.strip()},o.prototype.maskn=function(l){return this.clone().imaskn(l)},o.prototype.iaddn=function(l){return n(typeof l=="number"),n(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},o.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},o.prototype.isubn=function(l){if(n(typeof l=="number"),n(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},o.prototype.addn=function(l){return this.clone().iaddn(l)},o.prototype.subn=function(l){return this.clone().isubn(l)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(l,p,b){var S=l.length+b,T;this._expand(S);var B,$=0;for(T=0;T<l.length;T++){B=(this.words[T+b]|0)+$;var A=(l.words[T]|0)*p;B-=A&67108863,$=(B>>26)-(A/67108864|0),this.words[T+b]=B&67108863}for(;T<this.length-b;T++)B=(this.words[T+b]|0)+$,$=B>>26,this.words[T+b]=B&67108863;if($===0)return this.strip();for(n($===-1),$=0,T=0;T<this.length;T++)B=-(this.words[T]|0)+$,$=B>>26,this.words[T]=B&67108863;return this.negative=1,this.strip()},o.prototype._wordDiv=function(l,p){var b=this.length-l.length,S=this.clone(),T=l,B=T.words[T.length-1]|0,$=this._countBits(B);b=26-$,b!==0&&(T=T.ushln(b),S.iushln(b),B=T.words[T.length-1]|0);var A=S.length-T.length,g;if(p!=="mod"){g=new o(null),g.length=A+1,g.words=new Array(g.length);for(var k=0;k<g.length;k++)g.words[k]=0}var H=S.clone()._ishlnsubmul(T,1,A);H.negative===0&&(S=H,g&&(g.words[A]=1));for(var z=A-1;z>=0;z--){var Q=(S.words[T.length+z]|0)*67108864+(S.words[T.length+z-1]|0);for(Q=Math.min(Q/B|0,67108863),S._ishlnsubmul(T,Q,z);S.negative!==0;)Q--,S.negative=0,S._ishlnsubmul(T,1,z),S.isZero()||(S.negative^=1);g&&(g.words[z]=Q)}return g&&g.strip(),S.strip(),p!=="div"&&b!==0&&S.iushrn(b),{div:g||null,mod:S}},o.prototype.divmod=function(l,p,b){if(n(!l.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var S,T,B;return this.negative!==0&&l.negative===0?(B=this.neg().divmod(l,p),p!=="mod"&&(S=B.div.neg()),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.iadd(l)),{div:S,mod:T}):this.negative===0&&l.negative!==0?(B=this.divmod(l.neg(),p),p!=="mod"&&(S=B.div.neg()),{div:S,mod:B.mod}):this.negative&l.negative?(B=this.neg().divmod(l.neg(),p),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.isub(l)),{div:B.div,mod:T}):l.length>this.length||this.cmp(l)<0?{div:new o(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new o(this.modn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new o(this.modn(l.words[0]))}:this._wordDiv(l,p)},o.prototype.div=function(l){return this.divmod(l,"div",!1).div},o.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},o.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},o.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var b=p.div.negative!==0?p.mod.isub(l):p.mod,S=l.ushrn(1),T=l.andln(1),B=b.cmp(S);return B<0||T===1&&B===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},o.prototype.modn=function(l){n(l<=67108863);for(var p=(1<<26)%l,b=0,S=this.length-1;S>=0;S--)b=(p*b+(this.words[S]|0))%l;return b},o.prototype.idivn=function(l){n(l<=67108863);for(var p=0,b=this.length-1;b>=0;b--){var S=(this.words[b]|0)+p*67108864;this.words[b]=S/l|0,p=S%l}return this.strip()},o.prototype.divn=function(l){return this.clone().idivn(l)},o.prototype.egcd=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=new o(0),$=new o(1),A=0;p.isEven()&&b.isEven();)p.iushrn(1),b.iushrn(1),++A;for(var g=b.clone(),k=p.clone();!p.isZero();){for(var H=0,z=1;!(p.words[0]&z)&&H<26;++H,z<<=1);if(H>0)for(p.iushrn(H);H-- >0;)(S.isOdd()||T.isOdd())&&(S.iadd(g),T.isub(k)),S.iushrn(1),T.iushrn(1);for(var Q=0,ie=1;!(b.words[0]&ie)&&Q<26;++Q,ie<<=1);if(Q>0)for(b.iushrn(Q);Q-- >0;)(B.isOdd()||$.isOdd())&&(B.iadd(g),$.isub(k)),B.iushrn(1),$.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(B),T.isub($)):(b.isub(p),B.isub(S),$.isub(T))}return{a:B,b:$,gcd:b.iushln(A)}},o.prototype._invmp=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=b.clone();p.cmpn(1)>0&&b.cmpn(1)>0;){for(var $=0,A=1;!(p.words[0]&A)&&$<26;++$,A<<=1);if($>0)for(p.iushrn($);$-- >0;)S.isOdd()&&S.iadd(B),S.iushrn(1);for(var g=0,k=1;!(b.words[0]&k)&&g<26;++g,k<<=1);if(g>0)for(b.iushrn(g);g-- >0;)T.isOdd()&&T.iadd(B),T.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(T)):(b.isub(p),T.isub(S))}var H;return p.cmpn(1)===0?H=S:H=T,H.cmpn(0)<0&&H.iadd(l),H},o.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),b=l.clone();p.negative=0,b.negative=0;for(var S=0;p.isEven()&&b.isEven();S++)p.iushrn(1),b.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;b.isEven();)b.iushrn(1);var T=p.cmp(b);if(T<0){var B=p;p=b,b=B}else if(T===0||b.cmpn(1)===0)break;p.isub(b)}while(!0);return b.iushln(S)},o.prototype.invm=function(l){return this.egcd(l).a.umod(l)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(l){return this.words[0]&l},o.prototype.bincn=function(l){n(typeof l=="number");var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return this._expand(b+1),this.words[b]|=S,this;for(var T=S,B=b;T!==0&&B<this.length;B++){var $=this.words[B]|0;$+=T,T=$>>>26,$&=67108863,this.words[B]=$}return T!==0&&(this.words[B]=T,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var b;if(this.length>1)b=1;else{p&&(l=-l),n(l<=67108863,"Number is too big");var S=this.words[0]|0;b=S===l?0:S<l?-1:1}return this.negative!==0?-b|0:b},o.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},o.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,b=this.length-1;b>=0;b--){var S=this.words[b]|0,T=l.words[b]|0;if(S!==T){S<T?p=-1:S>T&&(p=1);break}}return p},o.prototype.gtn=function(l){return this.cmpn(l)===1},o.prototype.gt=function(l){return this.cmp(l)===1},o.prototype.gten=function(l){return this.cmpn(l)>=0},o.prototype.gte=function(l){return this.cmp(l)>=0},o.prototype.ltn=function(l){return this.cmpn(l)===-1},o.prototype.lt=function(l){return this.cmp(l)===-1},o.prototype.lten=function(l){return this.cmpn(l)<=0},o.prototype.lte=function(l){return this.cmp(l)<=0},o.prototype.eqn=function(l){return this.cmpn(l)===0},o.prototype.eq=function(l){return this.cmp(l)===0},o.red=function(l){return new G(l)},o.prototype.toRed=function(l){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(l){return this.red=l,this},o.prototype.forceRed=function(l){return n(!this.red,"Already a number in reduction context"),this._forceRed(l)},o.prototype.redAdd=function(l){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},o.prototype.redIAdd=function(l){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},o.prototype.redSub=function(l){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},o.prototype.redISub=function(l){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},o.prototype.redShl=function(l){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},o.prototype.redMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},o.prototype.redIMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(l){return n(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var F={k256:null,p224:null,p192:null,p25519:null};function U(O,l){this.name=O,this.p=new o(l,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var l=new o(null);return l.words=new Array(Math.ceil(this.n/13)),l},U.prototype.ireduce=function(l){var p=l,b;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),b=p.bitLength();while(b>this.n);var S=b<this.n?-1:p.ucmp(this.p);return S===0?(p.words[0]=0,p.length=1):S>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},U.prototype.split=function(l,p){l.iushrn(this.n,0,p)},U.prototype.imulK=function(l){return l.imul(this.k)};function j(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(j,U),j.prototype.split=function(l,p){for(var b=4194303,S=Math.min(l.length,9),T=0;T<S;T++)p.words[T]=l.words[T];if(p.length=S,l.length<=9){l.words[0]=0,l.length=1;return}var B=l.words[9];for(p.words[p.length++]=B&b,T=10;T<l.length;T++){var $=l.words[T]|0;l.words[T-10]=($&b)<<4|B>>>22,B=$}B>>>=22,l.words[T-10]=B,B===0&&l.length>10?l.length-=10:l.length-=9},j.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,b=0;b<l.length;b++){var S=l.words[b]|0;p+=S*977,l.words[b]=p&67108863,p=S*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function W(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(W,U);function X(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(X,U);function J(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(J,U),J.prototype.imulK=function(l){for(var p=0,b=0;b<l.length;b++){var S=(l.words[b]|0)*19+p,T=S&67108863;S>>>=26,l.words[b]=T,p=S}return p!==0&&(l.words[l.length++]=p),l},o._prime=function(l){if(F[l])return F[l];var p;if(l==="k256")p=new j;else if(l==="p224")p=new W;else if(l==="p192")p=new X;else if(l==="p25519")p=new J;else throw new Error("Unknown prime "+l);return F[l]=p,p};function G(O){if(typeof O=="string"){var l=o._prime(O);this.m=l.p,this.prime=l}else n(O.gtn(1),"modulus must be greater than 1"),this.m=O,this.prime=null}G.prototype._verify1=function(l){n(l.negative===0,"red works only with positives"),n(l.red,"red works only with red numbers")},G.prototype._verify2=function(l,p){n((l.negative|p.negative)===0,"red works only with positives"),n(l.red&&l.red===p.red,"red works only with red numbers")},G.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):l.umod(this.m)._forceRed(this)},G.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},G.prototype.add=function(l,p){this._verify2(l,p);var b=l.add(p);return b.cmp(this.m)>=0&&b.isub(this.m),b._forceRed(this)},G.prototype.iadd=function(l,p){this._verify2(l,p);var b=l.iadd(p);return b.cmp(this.m)>=0&&b.isub(this.m),b},G.prototype.sub=function(l,p){this._verify2(l,p);var b=l.sub(p);return b.cmpn(0)<0&&b.iadd(this.m),b._forceRed(this)},G.prototype.isub=function(l,p){this._verify2(l,p);var b=l.isub(p);return b.cmpn(0)<0&&b.iadd(this.m),b},G.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},G.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},G.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},G.prototype.isqr=function(l){return this.imul(l,l.clone())},G.prototype.sqr=function(l){return this.mul(l,l)},G.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(n(p%2===1),p===3){var b=this.m.add(new o(1)).iushrn(2);return this.pow(l,b)}for(var S=this.m.subn(1),T=0;!S.isZero()&&S.andln(1)===0;)T++,S.iushrn(1);n(!S.isZero());var B=new o(1).toRed(this),$=B.redNeg(),A=this.m.subn(1).iushrn(1),g=this.m.bitLength();for(g=new o(2*g*g).toRed(this);this.pow(g,A).cmp($)!==0;)g.redIAdd($);for(var k=this.pow(g,S),H=this.pow(l,S.addn(1).iushrn(1)),z=this.pow(l,S),Q=T;z.cmp(B)!==0;){for(var ie=z,ne=0;ie.cmp(B)!==0;ne++)ie=ie.redSqr();n(ne<Q);var Z=this.pow(k,new o(1).iushln(Q-ne-1));H=H.redMul(Z),k=Z.redSqr(),z=z.redMul(k),Q=ne}return H},G.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},G.prototype.pow=function(l,p){if(p.isZero())return new o(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var b=4,S=new Array(1<<b);S[0]=new o(1).toRed(this),S[1]=l;for(var T=2;T<S.length;T++)S[T]=this.mul(S[T-1],l);var B=S[0],$=0,A=0,g=p.bitLength()%26;for(g===0&&(g=26),T=p.length-1;T>=0;T--){for(var k=p.words[T],H=g-1;H>=0;H--){var z=k>>H&1;if(B!==S[0]&&(B=this.sqr(B)),z===0&&$===0){A=0;continue}$<<=1,$|=z,A++,!(A!==b&&(T!==0||H!==0))&&(B=this.mul(B,S[$]),A=0,$=0)}g=26}return B},G.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},G.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},o.mont=function(l){return new oe(l)};function oe(O){G.call(this,O),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(oe,G),oe.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},oe.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},oe.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var b=l.imul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new o(0)._forceRed(this);var b=l.mul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,commonjsGlobal)}(bn$6)),bn$6.exports}var bn$5={exports:{}};bn$5.exports;var hasRequiredBn$5;function requireBn$5(){return hasRequiredBn$5||(hasRequiredBn$5=1,function(r){(function(e,t){function n(O,l){if(!O)throw new Error(l||"Assertion failed")}function a(O,l){O.super_=l;var p=function(){};p.prototype=l.prototype,O.prototype=new p,O.prototype.constructor=O}function o(O,l,p){if(o.isBN(O))return O;this.negative=0,this.words=null,this.length=0,this.red=null,O!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(O||0,l||10,p||"be"))}typeof e=="object"?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=bufferPolyfill.Buffer}catch{}o.isBN=function(l){return l instanceof o?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===o.wordSize&&Array.isArray(l.words)},o.max=function(l,p){return l.cmp(p)>0?l:p},o.min=function(l,p){return l.cmp(p)<0?l:p},o.prototype._init=function(l,p,b){if(typeof l=="number")return this._initNumber(l,p,b);if(typeof l=="object")return this._initArray(l,p,b);p==="hex"&&(p=16),n(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var S=0;l[0]==="-"&&(S++,this.negative=1),S<l.length&&(p===16?this._parseHex(l,S,b):(this._parseBase(l,p,S),b==="le"&&this._initArray(this.toArray(),p,b)))},o.prototype._initNumber=function(l,p,b){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(n(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),b==="le"&&this._initArray(this.toArray(),p,b)},o.prototype._initArray=function(l,p,b){if(n(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T,B,$=0;if(b==="be")for(S=l.length-1,T=0;S>=0;S-=3)B=l[S]|l[S-1]<<8|l[S-2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);else if(b==="le")for(S=0,T=0;S<l.length;S+=3)B=l[S]|l[S+1]<<8|l[S+2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);return this.strip()};function u(O,l){var p=O.charCodeAt(l);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function v(O,l,p){var b=u(O,p);return p-1>=l&&(b|=u(O,p-1)<<4),b}o.prototype._parseHex=function(l,p,b){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T=0,B=0,$;if(b==="be")for(S=l.length-1;S>=p;S-=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8;else{var A=l.length-p;for(S=A%2===0?p+1:p;S<l.length;S+=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8}this.strip()};function _(O,l,p,b){for(var S=0,T=Math.min(O.length,p),B=l;B<T;B++){var $=O.charCodeAt(B)-48;S*=b,$>=49?S+=$-49+10:$>=17?S+=$-17+10:S+=$}return S}o.prototype._parseBase=function(l,p,b){this.words=[0],this.length=1;for(var S=0,T=1;T<=67108863;T*=p)S++;S--,T=T/p|0;for(var B=l.length-b,$=B%S,A=Math.min(B,B-$)+b,g=0,k=b;k<A;k+=S)g=_(l,k,k+S,p),this.imuln(T),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g);if($!==0){var H=1;for(g=_(l,k,l.length,p),k=0;k<$;k++)H*=p;this.imuln(H),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g)}this.strip()},o.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red},o.prototype.clone=function(){var l=new o(null);return this.copy(l),l},o.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],E=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],M=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(l,p){l=l||10,p=p|0||1;var b;if(l===16||l==="hex"){b="";for(var S=0,T=0,B=0;B<this.length;B++){var $=this.words[B],A=(($<<S|T)&16777215).toString(16);T=$>>>24-S&16777215,S+=2,S>=26&&(S-=26,B--),T!==0||B!==this.length-1?b=x[6-A.length]+A+b:b=A+b}for(T!==0&&(b=T.toString(16)+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}if(l===(l|0)&&l>=2&&l<=36){var g=E[l],k=M[l];b="";var H=this.clone();for(H.negative=0;!H.isZero();){var z=H.modn(k).toString(l);H=H.idivn(k),H.isZero()?b=z+b:b=x[g-z.length]+z+b}for(this.isZero()&&(b="0"+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(l,p){return n(typeof c<"u"),this.toArrayLike(c,l,p)},o.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)},o.prototype.toArrayLike=function(l,p,b){var S=this.byteLength(),T=b||Math.max(1,S);n(S<=T,"byte array longer than desired length"),n(T>0,"Requested array length <= 0"),this.strip();var B=p==="le",$=new l(T),A,g,k=this.clone();if(B){for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[g]=A;for(;g<T;g++)$[g]=0}else{for(g=0;g<T-S;g++)$[g]=0;for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[T-g-1]=A}return $},Math.clz32?o.prototype._countBits=function(l){return 32-Math.clz32(l)}:o.prototype._countBits=function(l){var p=l,b=0;return p>=4096&&(b+=13,p>>>=13),p>=64&&(b+=7,p>>>=7),p>=8&&(b+=4,p>>>=4),p>=2&&(b+=2,p>>>=2),b+p},o.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,b=0;return p&8191||(b+=13,p>>>=13),p&127||(b+=7,p>>>=7),p&15||(b+=4,p>>>=4),p&3||(b+=2,p>>>=2),p&1||b++,b},o.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function C(O){for(var l=new Array(O.bitLength()),p=0;p<l.length;p++){var b=p/26|0,S=p%26;l[p]=(O.words[b]&1<<S)>>>S}return l}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var b=this._zeroBits(this.words[p]);if(l+=b,b!==26)break}return l},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},o.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this.strip()},o.prototype.ior=function(l){return n((this.negative|l.negative)===0),this.iuor(l)},o.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},o.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},o.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var b=0;b<p.length;b++)this.words[b]=this.words[b]&l.words[b];return this.length=p.length,this.strip()},o.prototype.iand=function(l){return n((this.negative|l.negative)===0),this.iuand(l)},o.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},o.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},o.prototype.iuxor=function(l){var p,b;this.length>l.length?(p=this,b=l):(p=l,b=this);for(var S=0;S<b.length;S++)this.words[S]=p.words[S]^b.words[S];if(this!==p)for(;S<p.length;S++)this.words[S]=p.words[S];return this.length=p.length,this.strip()},o.prototype.ixor=function(l){return n((this.negative|l.negative)===0),this.iuxor(l)},o.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},o.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},o.prototype.inotn=function(l){n(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,b=l%26;this._expand(p),b>0&&p--;for(var S=0;S<p;S++)this.words[S]=~this.words[S]&67108863;return b>0&&(this.words[S]=~this.words[S]&67108863>>26-b),this.strip()},o.prototype.notn=function(l){return this.clone().inotn(l)},o.prototype.setn=function(l,p){n(typeof l=="number"&&l>=0);var b=l/26|0,S=l%26;return this._expand(b+1),p?this.words[b]=this.words[b]|1<<S:this.words[b]=this.words[b]&~(1<<S),this.strip()},o.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var b,S;this.length>l.length?(b=this,S=l):(b=l,S=this);for(var T=0,B=0;B<S.length;B++)p=(b.words[B]|0)+(S.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;for(;T!==0&&B<b.length;B++)p=(b.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;if(this.length=b.length,T!==0)this.words[this.length]=T,this.length++;else if(b!==this)for(;B<b.length;B++)this.words[B]=b.words[B];return this},o.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},o.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var b=this.cmp(l);if(b===0)return this.negative=0,this.length=1,this.words[0]=0,this;var S,T;b>0?(S=this,T=l):(S=l,T=this);for(var B=0,$=0;$<T.length;$++)p=(S.words[$]|0)-(T.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;for(;B!==0&&$<S.length;$++)p=(S.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;if(B===0&&$<S.length&&S!==this)for(;$<S.length;$++)this.words[$]=S.words[$];return this.length=Math.max(this.length,$),S!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(l){return this.clone().isub(l)};function I(O,l,p){p.negative=l.negative^O.negative;var b=O.length+l.length|0;p.length=b,b=b-1|0;var S=O.words[0]|0,T=l.words[0]|0,B=S*T,$=B&67108863,A=B/67108864|0;p.words[0]=$;for(var g=1;g<b;g++){for(var k=A>>>26,H=A&67108863,z=Math.min(g,l.length-1),Q=Math.max(0,g-O.length+1);Q<=z;Q++){var ie=g-Q|0;S=O.words[ie]|0,T=l.words[Q]|0,B=S*T+H,k+=B/67108864|0,H=B&67108863}p.words[g]=H|0,A=k|0}return A!==0?p.words[g]=A|0:p.length--,p.strip()}var D=function(l,p,b){var S=l.words,T=p.words,B=b.words,$=0,A,g,k,H=S[0]|0,z=H&8191,Q=H>>>13,ie=S[1]|0,ne=ie&8191,Z=ie>>>13,se=S[2]|0,ae=se&8191,ce=se>>>13,le=S[3]|0,te=le&8191,he=le>>>13,Ae=S[4]|0,ge=Ae&8191,me=Ae>>>13,je=S[5]|0,we=je&8191,pe=je>>>13,Ke=S[6]|0,ye=Ke&8191,xe=Ke>>>13,Ve=S[7]|0,be=Ve&8191,Ee=Ve>>>13,Ge=S[8]|0,re=Ge&8191,Y=Ge>>>13,ee=S[9]|0,fe=ee&8191,ue=ee>>>13,ve=T[0]|0,de=ve&8191,Se=ve>>>13,We=T[1]|0,_e=We&8191,Me=We>>>13,ze=T[2]|0,Te=ze&8191,$e=ze>>>13,Je=T[3]|0,ke=Je&8191,Oe=Je>>>13,Ze=T[4]|0,Be=Ze&8191,Le=Ze>>>13,Qe=T[5]|0,Re=Qe&8191,Ne=Qe>>>13,et=T[6]|0,Ce=et&8191,qe=et>>>13,tt=T[7]|0,Ie=tt&8191,Fe=tt>>>13,rt=T[8]|0,De=rt&8191,Ue=rt>>>13,nt=T[9]|0,Pe=nt&8191,He=nt>>>13;b.negative=l.negative^p.negative,b.length=19,A=Math.imul(z,de),g=Math.imul(z,Se),g=g+Math.imul(Q,de)|0,k=Math.imul(Q,Se);var Xe=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Xe>>>26)|0,Xe&=67108863,A=Math.imul(ne,de),g=Math.imul(ne,Se),g=g+Math.imul(Z,de)|0,k=Math.imul(Z,Se),A=A+Math.imul(z,_e)|0,g=g+Math.imul(z,Me)|0,g=g+Math.imul(Q,_e)|0,k=k+Math.imul(Q,Me)|0;var Ye=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,A=Math.imul(ae,de),g=Math.imul(ae,Se),g=g+Math.imul(ce,de)|0,k=Math.imul(ce,Se),A=A+Math.imul(ne,_e)|0,g=g+Math.imul(ne,Me)|0,g=g+Math.imul(Z,_e)|0,k=k+Math.imul(Z,Me)|0,A=A+Math.imul(z,Te)|0,g=g+Math.imul(z,$e)|0,g=g+Math.imul(Q,Te)|0,k=k+Math.imul(Q,$e)|0;var it=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(it>>>26)|0,it&=67108863,A=Math.imul(te,de),g=Math.imul(te,Se),g=g+Math.imul(he,de)|0,k=Math.imul(he,Se),A=A+Math.imul(ae,_e)|0,g=g+Math.imul(ae,Me)|0,g=g+Math.imul(ce,_e)|0,k=k+Math.imul(ce,Me)|0,A=A+Math.imul(ne,Te)|0,g=g+Math.imul(ne,$e)|0,g=g+Math.imul(Z,Te)|0,k=k+Math.imul(Z,$e)|0,A=A+Math.imul(z,ke)|0,g=g+Math.imul(z,Oe)|0,g=g+Math.imul(Q,ke)|0,k=k+Math.imul(Q,Oe)|0;var st=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(st>>>26)|0,st&=67108863,A=Math.imul(ge,de),g=Math.imul(ge,Se),g=g+Math.imul(me,de)|0,k=Math.imul(me,Se),A=A+Math.imul(te,_e)|0,g=g+Math.imul(te,Me)|0,g=g+Math.imul(he,_e)|0,k=k+Math.imul(he,Me)|0,A=A+Math.imul(ae,Te)|0,g=g+Math.imul(ae,$e)|0,g=g+Math.imul(ce,Te)|0,k=k+Math.imul(ce,$e)|0,A=A+Math.imul(ne,ke)|0,g=g+Math.imul(ne,Oe)|0,g=g+Math.imul(Z,ke)|0,k=k+Math.imul(Z,Oe)|0,A=A+Math.imul(z,Be)|0,g=g+Math.imul(z,Le)|0,g=g+Math.imul(Q,Be)|0,k=k+Math.imul(Q,Le)|0;var ot=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ot>>>26)|0,ot&=67108863,A=Math.imul(we,de),g=Math.imul(we,Se),g=g+Math.imul(pe,de)|0,k=Math.imul(pe,Se),A=A+Math.imul(ge,_e)|0,g=g+Math.imul(ge,Me)|0,g=g+Math.imul(me,_e)|0,k=k+Math.imul(me,Me)|0,A=A+Math.imul(te,Te)|0,g=g+Math.imul(te,$e)|0,g=g+Math.imul(he,Te)|0,k=k+Math.imul(he,$e)|0,A=A+Math.imul(ae,ke)|0,g=g+Math.imul(ae,Oe)|0,g=g+Math.imul(ce,ke)|0,k=k+Math.imul(ce,Oe)|0,A=A+Math.imul(ne,Be)|0,g=g+Math.imul(ne,Le)|0,g=g+Math.imul(Z,Be)|0,k=k+Math.imul(Z,Le)|0,A=A+Math.imul(z,Re)|0,g=g+Math.imul(z,Ne)|0,g=g+Math.imul(Q,Re)|0,k=k+Math.imul(Q,Ne)|0;var at=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(at>>>26)|0,at&=67108863,A=Math.imul(ye,de),g=Math.imul(ye,Se),g=g+Math.imul(xe,de)|0,k=Math.imul(xe,Se),A=A+Math.imul(we,_e)|0,g=g+Math.imul(we,Me)|0,g=g+Math.imul(pe,_e)|0,k=k+Math.imul(pe,Me)|0,A=A+Math.imul(ge,Te)|0,g=g+Math.imul(ge,$e)|0,g=g+Math.imul(me,Te)|0,k=k+Math.imul(me,$e)|0,A=A+Math.imul(te,ke)|0,g=g+Math.imul(te,Oe)|0,g=g+Math.imul(he,ke)|0,k=k+Math.imul(he,Oe)|0,A=A+Math.imul(ae,Be)|0,g=g+Math.imul(ae,Le)|0,g=g+Math.imul(ce,Be)|0,k=k+Math.imul(ce,Le)|0,A=A+Math.imul(ne,Re)|0,g=g+Math.imul(ne,Ne)|0,g=g+Math.imul(Z,Re)|0,k=k+Math.imul(Z,Ne)|0,A=A+Math.imul(z,Ce)|0,g=g+Math.imul(z,qe)|0,g=g+Math.imul(Q,Ce)|0,k=k+Math.imul(Q,qe)|0;var ft=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ft>>>26)|0,ft&=67108863,A=Math.imul(be,de),g=Math.imul(be,Se),g=g+Math.imul(Ee,de)|0,k=Math.imul(Ee,Se),A=A+Math.imul(ye,_e)|0,g=g+Math.imul(ye,Me)|0,g=g+Math.imul(xe,_e)|0,k=k+Math.imul(xe,Me)|0,A=A+Math.imul(we,Te)|0,g=g+Math.imul(we,$e)|0,g=g+Math.imul(pe,Te)|0,k=k+Math.imul(pe,$e)|0,A=A+Math.imul(ge,ke)|0,g=g+Math.imul(ge,Oe)|0,g=g+Math.imul(me,ke)|0,k=k+Math.imul(me,Oe)|0,A=A+Math.imul(te,Be)|0,g=g+Math.imul(te,Le)|0,g=g+Math.imul(he,Be)|0,k=k+Math.imul(he,Le)|0,A=A+Math.imul(ae,Re)|0,g=g+Math.imul(ae,Ne)|0,g=g+Math.imul(ce,Re)|0,k=k+Math.imul(ce,Ne)|0,A=A+Math.imul(ne,Ce)|0,g=g+Math.imul(ne,qe)|0,g=g+Math.imul(Z,Ce)|0,k=k+Math.imul(Z,qe)|0,A=A+Math.imul(z,Ie)|0,g=g+Math.imul(z,Fe)|0,g=g+Math.imul(Q,Ie)|0,k=k+Math.imul(Q,Fe)|0;var lt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(lt>>>26)|0,lt&=67108863,A=Math.imul(re,de),g=Math.imul(re,Se),g=g+Math.imul(Y,de)|0,k=Math.imul(Y,Se),A=A+Math.imul(be,_e)|0,g=g+Math.imul(be,Me)|0,g=g+Math.imul(Ee,_e)|0,k=k+Math.imul(Ee,Me)|0,A=A+Math.imul(ye,Te)|0,g=g+Math.imul(ye,$e)|0,g=g+Math.imul(xe,Te)|0,k=k+Math.imul(xe,$e)|0,A=A+Math.imul(we,ke)|0,g=g+Math.imul(we,Oe)|0,g=g+Math.imul(pe,ke)|0,k=k+Math.imul(pe,Oe)|0,A=A+Math.imul(ge,Be)|0,g=g+Math.imul(ge,Le)|0,g=g+Math.imul(me,Be)|0,k=k+Math.imul(me,Le)|0,A=A+Math.imul(te,Re)|0,g=g+Math.imul(te,Ne)|0,g=g+Math.imul(he,Re)|0,k=k+Math.imul(he,Ne)|0,A=A+Math.imul(ae,Ce)|0,g=g+Math.imul(ae,qe)|0,g=g+Math.imul(ce,Ce)|0,k=k+Math.imul(ce,qe)|0,A=A+Math.imul(ne,Ie)|0,g=g+Math.imul(ne,Fe)|0,g=g+Math.imul(Z,Ie)|0,k=k+Math.imul(Z,Fe)|0,A=A+Math.imul(z,De)|0,g=g+Math.imul(z,Ue)|0,g=g+Math.imul(Q,De)|0,k=k+Math.imul(Q,Ue)|0;var ct=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ct>>>26)|0,ct&=67108863,A=Math.imul(fe,de),g=Math.imul(fe,Se),g=g+Math.imul(ue,de)|0,k=Math.imul(ue,Se),A=A+Math.imul(re,_e)|0,g=g+Math.imul(re,Me)|0,g=g+Math.imul(Y,_e)|0,k=k+Math.imul(Y,Me)|0,A=A+Math.imul(be,Te)|0,g=g+Math.imul(be,$e)|0,g=g+Math.imul(Ee,Te)|0,k=k+Math.imul(Ee,$e)|0,A=A+Math.imul(ye,ke)|0,g=g+Math.imul(ye,Oe)|0,g=g+Math.imul(xe,ke)|0,k=k+Math.imul(xe,Oe)|0,A=A+Math.imul(we,Be)|0,g=g+Math.imul(we,Le)|0,g=g+Math.imul(pe,Be)|0,k=k+Math.imul(pe,Le)|0,A=A+Math.imul(ge,Re)|0,g=g+Math.imul(ge,Ne)|0,g=g+Math.imul(me,Re)|0,k=k+Math.imul(me,Ne)|0,A=A+Math.imul(te,Ce)|0,g=g+Math.imul(te,qe)|0,g=g+Math.imul(he,Ce)|0,k=k+Math.imul(he,qe)|0,A=A+Math.imul(ae,Ie)|0,g=g+Math.imul(ae,Fe)|0,g=g+Math.imul(ce,Ie)|0,k=k+Math.imul(ce,Fe)|0,A=A+Math.imul(ne,De)|0,g=g+Math.imul(ne,Ue)|0,g=g+Math.imul(Z,De)|0,k=k+Math.imul(Z,Ue)|0,A=A+Math.imul(z,Pe)|0,g=g+Math.imul(z,He)|0,g=g+Math.imul(Q,Pe)|0,k=k+Math.imul(Q,He)|0;var ht=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ht>>>26)|0,ht&=67108863,A=Math.imul(fe,_e),g=Math.imul(fe,Me),g=g+Math.imul(ue,_e)|0,k=Math.imul(ue,Me),A=A+Math.imul(re,Te)|0,g=g+Math.imul(re,$e)|0,g=g+Math.imul(Y,Te)|0,k=k+Math.imul(Y,$e)|0,A=A+Math.imul(be,ke)|0,g=g+Math.imul(be,Oe)|0,g=g+Math.imul(Ee,ke)|0,k=k+Math.imul(Ee,Oe)|0,A=A+Math.imul(ye,Be)|0,g=g+Math.imul(ye,Le)|0,g=g+Math.imul(xe,Be)|0,k=k+Math.imul(xe,Le)|0,A=A+Math.imul(we,Re)|0,g=g+Math.imul(we,Ne)|0,g=g+Math.imul(pe,Re)|0,k=k+Math.imul(pe,Ne)|0,A=A+Math.imul(ge,Ce)|0,g=g+Math.imul(ge,qe)|0,g=g+Math.imul(me,Ce)|0,k=k+Math.imul(me,qe)|0,A=A+Math.imul(te,Ie)|0,g=g+Math.imul(te,Fe)|0,g=g+Math.imul(he,Ie)|0,k=k+Math.imul(he,Fe)|0,A=A+Math.imul(ae,De)|0,g=g+Math.imul(ae,Ue)|0,g=g+Math.imul(ce,De)|0,k=k+Math.imul(ce,Ue)|0,A=A+Math.imul(ne,Pe)|0,g=g+Math.imul(ne,He)|0,g=g+Math.imul(Z,Pe)|0,k=k+Math.imul(Z,He)|0;var dt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(dt>>>26)|0,dt&=67108863,A=Math.imul(fe,Te),g=Math.imul(fe,$e),g=g+Math.imul(ue,Te)|0,k=Math.imul(ue,$e),A=A+Math.imul(re,ke)|0,g=g+Math.imul(re,Oe)|0,g=g+Math.imul(Y,ke)|0,k=k+Math.imul(Y,Oe)|0,A=A+Math.imul(be,Be)|0,g=g+Math.imul(be,Le)|0,g=g+Math.imul(Ee,Be)|0,k=k+Math.imul(Ee,Le)|0,A=A+Math.imul(ye,Re)|0,g=g+Math.imul(ye,Ne)|0,g=g+Math.imul(xe,Re)|0,k=k+Math.imul(xe,Ne)|0,A=A+Math.imul(we,Ce)|0,g=g+Math.imul(we,qe)|0,g=g+Math.imul(pe,Ce)|0,k=k+Math.imul(pe,qe)|0,A=A+Math.imul(ge,Ie)|0,g=g+Math.imul(ge,Fe)|0,g=g+Math.imul(me,Ie)|0,k=k+Math.imul(me,Fe)|0,A=A+Math.imul(te,De)|0,g=g+Math.imul(te,Ue)|0,g=g+Math.imul(he,De)|0,k=k+Math.imul(he,Ue)|0,A=A+Math.imul(ae,Pe)|0,g=g+Math.imul(ae,He)|0,g=g+Math.imul(ce,Pe)|0,k=k+Math.imul(ce,He)|0;var pt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(pt>>>26)|0,pt&=67108863,A=Math.imul(fe,ke),g=Math.imul(fe,Oe),g=g+Math.imul(ue,ke)|0,k=Math.imul(ue,Oe),A=A+Math.imul(re,Be)|0,g=g+Math.imul(re,Le)|0,g=g+Math.imul(Y,Be)|0,k=k+Math.imul(Y,Le)|0,A=A+Math.imul(be,Re)|0,g=g+Math.imul(be,Ne)|0,g=g+Math.imul(Ee,Re)|0,k=k+Math.imul(Ee,Ne)|0,A=A+Math.imul(ye,Ce)|0,g=g+Math.imul(ye,qe)|0,g=g+Math.imul(xe,Ce)|0,k=k+Math.imul(xe,qe)|0,A=A+Math.imul(we,Ie)|0,g=g+Math.imul(we,Fe)|0,g=g+Math.imul(pe,Ie)|0,k=k+Math.imul(pe,Fe)|0,A=A+Math.imul(ge,De)|0,g=g+Math.imul(ge,Ue)|0,g=g+Math.imul(me,De)|0,k=k+Math.imul(me,Ue)|0,A=A+Math.imul(te,Pe)|0,g=g+Math.imul(te,He)|0,g=g+Math.imul(he,Pe)|0,k=k+Math.imul(he,He)|0;var gt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(gt>>>26)|0,gt&=67108863,A=Math.imul(fe,Be),g=Math.imul(fe,Le),g=g+Math.imul(ue,Be)|0,k=Math.imul(ue,Le),A=A+Math.imul(re,Re)|0,g=g+Math.imul(re,Ne)|0,g=g+Math.imul(Y,Re)|0,k=k+Math.imul(Y,Ne)|0,A=A+Math.imul(be,Ce)|0,g=g+Math.imul(be,qe)|0,g=g+Math.imul(Ee,Ce)|0,k=k+Math.imul(Ee,qe)|0,A=A+Math.imul(ye,Ie)|0,g=g+Math.imul(ye,Fe)|0,g=g+Math.imul(xe,Ie)|0,k=k+Math.imul(xe,Fe)|0,A=A+Math.imul(we,De)|0,g=g+Math.imul(we,Ue)|0,g=g+Math.imul(pe,De)|0,k=k+Math.imul(pe,Ue)|0,A=A+Math.imul(ge,Pe)|0,g=g+Math.imul(ge,He)|0,g=g+Math.imul(me,Pe)|0,k=k+Math.imul(me,He)|0;var mt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(mt>>>26)|0,mt&=67108863,A=Math.imul(fe,Re),g=Math.imul(fe,Ne),g=g+Math.imul(ue,Re)|0,k=Math.imul(ue,Ne),A=A+Math.imul(re,Ce)|0,g=g+Math.imul(re,qe)|0,g=g+Math.imul(Y,Ce)|0,k=k+Math.imul(Y,qe)|0,A=A+Math.imul(be,Ie)|0,g=g+Math.imul(be,Fe)|0,g=g+Math.imul(Ee,Ie)|0,k=k+Math.imul(Ee,Fe)|0,A=A+Math.imul(ye,De)|0,g=g+Math.imul(ye,Ue)|0,g=g+Math.imul(xe,De)|0,k=k+Math.imul(xe,Ue)|0,A=A+Math.imul(we,Pe)|0,g=g+Math.imul(we,He)|0,g=g+Math.imul(pe,Pe)|0,k=k+Math.imul(pe,He)|0;var yt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(yt>>>26)|0,yt&=67108863,A=Math.imul(fe,Ce),g=Math.imul(fe,qe),g=g+Math.imul(ue,Ce)|0,k=Math.imul(ue,qe),A=A+Math.imul(re,Ie)|0,g=g+Math.imul(re,Fe)|0,g=g+Math.imul(Y,Ie)|0,k=k+Math.imul(Y,Fe)|0,A=A+Math.imul(be,De)|0,g=g+Math.imul(be,Ue)|0,g=g+Math.imul(Ee,De)|0,k=k+Math.imul(Ee,Ue)|0,A=A+Math.imul(ye,Pe)|0,g=g+Math.imul(ye,He)|0,g=g+Math.imul(xe,Pe)|0,k=k+Math.imul(xe,He)|0;var vt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(vt>>>26)|0,vt&=67108863,A=Math.imul(fe,Ie),g=Math.imul(fe,Fe),g=g+Math.imul(ue,Ie)|0,k=Math.imul(ue,Fe),A=A+Math.imul(re,De)|0,g=g+Math.imul(re,Ue)|0,g=g+Math.imul(Y,De)|0,k=k+Math.imul(Y,Ue)|0,A=A+Math.imul(be,Pe)|0,g=g+Math.imul(be,He)|0,g=g+Math.imul(Ee,Pe)|0,k=k+Math.imul(Ee,He)|0;var bt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(bt>>>26)|0,bt&=67108863,A=Math.imul(fe,De),g=Math.imul(fe,Ue),g=g+Math.imul(ue,De)|0,k=Math.imul(ue,Ue),A=A+Math.imul(re,Pe)|0,g=g+Math.imul(re,He)|0,g=g+Math.imul(Y,Pe)|0,k=k+Math.imul(Y,He)|0;var wt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(wt>>>26)|0,wt&=67108863,A=Math.imul(fe,Pe),g=Math.imul(fe,He),g=g+Math.imul(ue,Pe)|0,k=Math.imul(ue,He);var _t=($+A|0)+((g&8191)<<13)|0;return $=(k+(g>>>13)|0)+(_t>>>26)|0,_t&=67108863,B[0]=Xe,B[1]=Ye,B[2]=it,B[3]=st,B[4]=ot,B[5]=at,B[6]=ft,B[7]=lt,B[8]=ct,B[9]=ht,B[10]=dt,B[11]=pt,B[12]=gt,B[13]=mt,B[14]=yt,B[15]=vt,B[16]=bt,B[17]=wt,B[18]=_t,$!==0&&(B[19]=$,b.length++),b};Math.imul||(D=I);function L(O,l,p){p.negative=l.negative^O.negative,p.length=O.length+l.length;for(var b=0,S=0,T=0;T<p.length-1;T++){var B=S;S=0;for(var $=b&67108863,A=Math.min(T,l.length-1),g=Math.max(0,T-O.length+1);g<=A;g++){var k=T-g,H=O.words[k]|0,z=l.words[g]|0,Q=H*z,ie=Q&67108863;B=B+(Q/67108864|0)|0,ie=ie+$|0,$=ie&67108863,B=B+(ie>>>26)|0,S+=B>>>26,B&=67108863}p.words[T]=$,b=B,B=S}return b!==0?p.words[T]=b:p.length--,p.strip()}function N(O,l,p){var b=new q;return b.mulp(O,l,p)}o.prototype.mulTo=function(l,p){var b,S=this.length+l.length;return this.length===10&&l.length===10?b=D(this,l,p):S<63?b=I(this,l,p):S<1024?b=L(this,l,p):b=N(this,l,p),b};function q(O,l){this.x=O,this.y=l}q.prototype.makeRBT=function(l){for(var p=new Array(l),b=o.prototype._countBits(l)-1,S=0;S<l;S++)p[S]=this.revBin(S,b,l);return p},q.prototype.revBin=function(l,p,b){if(l===0||l===b-1)return l;for(var S=0,T=0;T<p;T++)S|=(l&1)<<p-T-1,l>>=1;return S},q.prototype.permute=function(l,p,b,S,T,B){for(var $=0;$<B;$++)S[$]=p[l[$]],T[$]=b[l[$]]},q.prototype.transform=function(l,p,b,S,T,B){this.permute(B,l,p,b,S,T);for(var $=1;$<T;$<<=1)for(var A=$<<1,g=Math.cos(2*Math.PI/A),k=Math.sin(2*Math.PI/A),H=0;H<T;H+=A)for(var z=g,Q=k,ie=0;ie<$;ie++){var ne=b[H+ie],Z=S[H+ie],se=b[H+ie+$],ae=S[H+ie+$],ce=z*se-Q*ae;ae=z*ae+Q*se,se=ce,b[H+ie]=ne+se,S[H+ie]=Z+ae,b[H+ie+$]=ne-se,S[H+ie+$]=Z-ae,ie!==A&&(ce=g*z-k*Q,Q=g*Q+k*z,z=ce)}},q.prototype.guessLen13b=function(l,p){var b=Math.max(p,l)|1,S=b&1,T=0;for(b=b/2|0;b;b=b>>>1)T++;return 1<<T+1+S},q.prototype.conjugate=function(l,p,b){if(!(b<=1))for(var S=0;S<b/2;S++){var T=l[S];l[S]=l[b-S-1],l[b-S-1]=T,T=p[S],p[S]=-p[b-S-1],p[b-S-1]=-T}},q.prototype.normalize13b=function(l,p){for(var b=0,S=0;S<p/2;S++){var T=Math.round(l[2*S+1]/p)*8192+Math.round(l[2*S]/p)+b;l[S]=T&67108863,T<67108864?b=0:b=T/67108864|0}return l},q.prototype.convert13b=function(l,p,b,S){for(var T=0,B=0;B<p;B++)T=T+(l[B]|0),b[2*B]=T&8191,T=T>>>13,b[2*B+1]=T&8191,T=T>>>13;for(B=2*p;B<S;++B)b[B]=0;n(T===0),n((T&-8192)===0)},q.prototype.stub=function(l){for(var p=new Array(l),b=0;b<l;b++)p[b]=0;return p},q.prototype.mulp=function(l,p,b){var S=2*this.guessLen13b(l.length,p.length),T=this.makeRBT(S),B=this.stub(S),$=new Array(S),A=new Array(S),g=new Array(S),k=new Array(S),H=new Array(S),z=new Array(S),Q=b.words;Q.length=S,this.convert13b(l.words,l.length,$,S),this.convert13b(p.words,p.length,k,S),this.transform($,B,A,g,S,T),this.transform(k,B,H,z,S,T);for(var ie=0;ie<S;ie++){var ne=A[ie]*H[ie]-g[ie]*z[ie];g[ie]=A[ie]*z[ie]+g[ie]*H[ie],A[ie]=ne}return this.conjugate(A,g,S),this.transform(A,g,Q,B,S,T),this.conjugate(Q,B,S),this.normalize13b(Q,S),b.negative=l.negative^p.negative,b.length=l.length+p.length,b.strip()},o.prototype.mul=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},o.prototype.mulf=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),N(this,l,p)},o.prototype.imul=function(l){return this.clone().mulTo(l,this)},o.prototype.imuln=function(l){n(typeof l=="number"),n(l<67108864);for(var p=0,b=0;b<this.length;b++){var S=(this.words[b]|0)*l,T=(S&67108863)+(p&67108863);p>>=26,p+=S/67108864|0,p+=T>>>26,this.words[b]=T&67108863}return p!==0&&(this.words[b]=p,this.length++),this},o.prototype.muln=function(l){return this.clone().imuln(l)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(l){var p=C(l);if(p.length===0)return new o(1);for(var b=this,S=0;S<p.length&&p[S]===0;S++,b=b.sqr());if(++S<p.length)for(var T=b.sqr();S<p.length;S++,T=T.sqr())p[S]!==0&&(b=b.mul(T));return b},o.prototype.iushln=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=67108863>>>26-p<<26-p,T;if(p!==0){var B=0;for(T=0;T<this.length;T++){var $=this.words[T]&S,A=(this.words[T]|0)-$<<p;this.words[T]=A|B,B=$>>>26-p}B&&(this.words[T]=B,this.length++)}if(b!==0){for(T=this.length-1;T>=0;T--)this.words[T+b]=this.words[T];for(T=0;T<b;T++)this.words[T]=0;this.length+=b}return this.strip()},o.prototype.ishln=function(l){return n(this.negative===0),this.iushln(l)},o.prototype.iushrn=function(l,p,b){n(typeof l=="number"&&l>=0);var S;p?S=(p-p%26)/26:S=0;var T=l%26,B=Math.min((l-T)/26,this.length),$=67108863^67108863>>>T<<T,A=b;if(S-=B,S=Math.max(0,S),A){for(var g=0;g<B;g++)A.words[g]=this.words[g];A.length=B}if(B!==0)if(this.length>B)for(this.length-=B,g=0;g<this.length;g++)this.words[g]=this.words[g+B];else this.words[0]=0,this.length=1;var k=0;for(g=this.length-1;g>=0&&(k!==0||g>=S);g--){var H=this.words[g]|0;this.words[g]=k<<26-T|H>>>T,k=H&$}return A&&k!==0&&(A.words[A.length++]=k),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(l,p,b){return n(this.negative===0),this.iushrn(l,p,b)},o.prototype.shln=function(l){return this.clone().ishln(l)},o.prototype.ushln=function(l){return this.clone().iushln(l)},o.prototype.shrn=function(l){return this.clone().ishrn(l)},o.prototype.ushrn=function(l){return this.clone().iushrn(l)},o.prototype.testn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return!1;var T=this.words[b];return!!(T&S)},o.prototype.imaskn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=b)return this;if(p!==0&&b++,this.length=Math.min(b,this.length),p!==0){var S=67108863^67108863>>>p<<p;this.words[this.length-1]&=S}return this.strip()},o.prototype.maskn=function(l){return this.clone().imaskn(l)},o.prototype.iaddn=function(l){return n(typeof l=="number"),n(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},o.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},o.prototype.isubn=function(l){if(n(typeof l=="number"),n(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},o.prototype.addn=function(l){return this.clone().iaddn(l)},o.prototype.subn=function(l){return this.clone().isubn(l)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(l,p,b){var S=l.length+b,T;this._expand(S);var B,$=0;for(T=0;T<l.length;T++){B=(this.words[T+b]|0)+$;var A=(l.words[T]|0)*p;B-=A&67108863,$=(B>>26)-(A/67108864|0),this.words[T+b]=B&67108863}for(;T<this.length-b;T++)B=(this.words[T+b]|0)+$,$=B>>26,this.words[T+b]=B&67108863;if($===0)return this.strip();for(n($===-1),$=0,T=0;T<this.length;T++)B=-(this.words[T]|0)+$,$=B>>26,this.words[T]=B&67108863;return this.negative=1,this.strip()},o.prototype._wordDiv=function(l,p){var b=this.length-l.length,S=this.clone(),T=l,B=T.words[T.length-1]|0,$=this._countBits(B);b=26-$,b!==0&&(T=T.ushln(b),S.iushln(b),B=T.words[T.length-1]|0);var A=S.length-T.length,g;if(p!=="mod"){g=new o(null),g.length=A+1,g.words=new Array(g.length);for(var k=0;k<g.length;k++)g.words[k]=0}var H=S.clone()._ishlnsubmul(T,1,A);H.negative===0&&(S=H,g&&(g.words[A]=1));for(var z=A-1;z>=0;z--){var Q=(S.words[T.length+z]|0)*67108864+(S.words[T.length+z-1]|0);for(Q=Math.min(Q/B|0,67108863),S._ishlnsubmul(T,Q,z);S.negative!==0;)Q--,S.negative=0,S._ishlnsubmul(T,1,z),S.isZero()||(S.negative^=1);g&&(g.words[z]=Q)}return g&&g.strip(),S.strip(),p!=="div"&&b!==0&&S.iushrn(b),{div:g||null,mod:S}},o.prototype.divmod=function(l,p,b){if(n(!l.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var S,T,B;return this.negative!==0&&l.negative===0?(B=this.neg().divmod(l,p),p!=="mod"&&(S=B.div.neg()),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.iadd(l)),{div:S,mod:T}):this.negative===0&&l.negative!==0?(B=this.divmod(l.neg(),p),p!=="mod"&&(S=B.div.neg()),{div:S,mod:B.mod}):this.negative&l.negative?(B=this.neg().divmod(l.neg(),p),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.isub(l)),{div:B.div,mod:T}):l.length>this.length||this.cmp(l)<0?{div:new o(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new o(this.modn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new o(this.modn(l.words[0]))}:this._wordDiv(l,p)},o.prototype.div=function(l){return this.divmod(l,"div",!1).div},o.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},o.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},o.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var b=p.div.negative!==0?p.mod.isub(l):p.mod,S=l.ushrn(1),T=l.andln(1),B=b.cmp(S);return B<0||T===1&&B===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},o.prototype.modn=function(l){n(l<=67108863);for(var p=(1<<26)%l,b=0,S=this.length-1;S>=0;S--)b=(p*b+(this.words[S]|0))%l;return b},o.prototype.idivn=function(l){n(l<=67108863);for(var p=0,b=this.length-1;b>=0;b--){var S=(this.words[b]|0)+p*67108864;this.words[b]=S/l|0,p=S%l}return this.strip()},o.prototype.divn=function(l){return this.clone().idivn(l)},o.prototype.egcd=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=new o(0),$=new o(1),A=0;p.isEven()&&b.isEven();)p.iushrn(1),b.iushrn(1),++A;for(var g=b.clone(),k=p.clone();!p.isZero();){for(var H=0,z=1;!(p.words[0]&z)&&H<26;++H,z<<=1);if(H>0)for(p.iushrn(H);H-- >0;)(S.isOdd()||T.isOdd())&&(S.iadd(g),T.isub(k)),S.iushrn(1),T.iushrn(1);for(var Q=0,ie=1;!(b.words[0]&ie)&&Q<26;++Q,ie<<=1);if(Q>0)for(b.iushrn(Q);Q-- >0;)(B.isOdd()||$.isOdd())&&(B.iadd(g),$.isub(k)),B.iushrn(1),$.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(B),T.isub($)):(b.isub(p),B.isub(S),$.isub(T))}return{a:B,b:$,gcd:b.iushln(A)}},o.prototype._invmp=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=b.clone();p.cmpn(1)>0&&b.cmpn(1)>0;){for(var $=0,A=1;!(p.words[0]&A)&&$<26;++$,A<<=1);if($>0)for(p.iushrn($);$-- >0;)S.isOdd()&&S.iadd(B),S.iushrn(1);for(var g=0,k=1;!(b.words[0]&k)&&g<26;++g,k<<=1);if(g>0)for(b.iushrn(g);g-- >0;)T.isOdd()&&T.iadd(B),T.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(T)):(b.isub(p),T.isub(S))}var H;return p.cmpn(1)===0?H=S:H=T,H.cmpn(0)<0&&H.iadd(l),H},o.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),b=l.clone();p.negative=0,b.negative=0;for(var S=0;p.isEven()&&b.isEven();S++)p.iushrn(1),b.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;b.isEven();)b.iushrn(1);var T=p.cmp(b);if(T<0){var B=p;p=b,b=B}else if(T===0||b.cmpn(1)===0)break;p.isub(b)}while(!0);return b.iushln(S)},o.prototype.invm=function(l){return this.egcd(l).a.umod(l)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(l){return this.words[0]&l},o.prototype.bincn=function(l){n(typeof l=="number");var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return this._expand(b+1),this.words[b]|=S,this;for(var T=S,B=b;T!==0&&B<this.length;B++){var $=this.words[B]|0;$+=T,T=$>>>26,$&=67108863,this.words[B]=$}return T!==0&&(this.words[B]=T,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var b;if(this.length>1)b=1;else{p&&(l=-l),n(l<=67108863,"Number is too big");var S=this.words[0]|0;b=S===l?0:S<l?-1:1}return this.negative!==0?-b|0:b},o.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},o.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,b=this.length-1;b>=0;b--){var S=this.words[b]|0,T=l.words[b]|0;if(S!==T){S<T?p=-1:S>T&&(p=1);break}}return p},o.prototype.gtn=function(l){return this.cmpn(l)===1},o.prototype.gt=function(l){return this.cmp(l)===1},o.prototype.gten=function(l){return this.cmpn(l)>=0},o.prototype.gte=function(l){return this.cmp(l)>=0},o.prototype.ltn=function(l){return this.cmpn(l)===-1},o.prototype.lt=function(l){return this.cmp(l)===-1},o.prototype.lten=function(l){return this.cmpn(l)<=0},o.prototype.lte=function(l){return this.cmp(l)<=0},o.prototype.eqn=function(l){return this.cmpn(l)===0},o.prototype.eq=function(l){return this.cmp(l)===0},o.red=function(l){return new G(l)},o.prototype.toRed=function(l){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(l){return this.red=l,this},o.prototype.forceRed=function(l){return n(!this.red,"Already a number in reduction context"),this._forceRed(l)},o.prototype.redAdd=function(l){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},o.prototype.redIAdd=function(l){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},o.prototype.redSub=function(l){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},o.prototype.redISub=function(l){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},o.prototype.redShl=function(l){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},o.prototype.redMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},o.prototype.redIMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(l){return n(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var F={k256:null,p224:null,p192:null,p25519:null};function U(O,l){this.name=O,this.p=new o(l,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var l=new o(null);return l.words=new Array(Math.ceil(this.n/13)),l},U.prototype.ireduce=function(l){var p=l,b;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),b=p.bitLength();while(b>this.n);var S=b<this.n?-1:p.ucmp(this.p);return S===0?(p.words[0]=0,p.length=1):S>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},U.prototype.split=function(l,p){l.iushrn(this.n,0,p)},U.prototype.imulK=function(l){return l.imul(this.k)};function j(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(j,U),j.prototype.split=function(l,p){for(var b=4194303,S=Math.min(l.length,9),T=0;T<S;T++)p.words[T]=l.words[T];if(p.length=S,l.length<=9){l.words[0]=0,l.length=1;return}var B=l.words[9];for(p.words[p.length++]=B&b,T=10;T<l.length;T++){var $=l.words[T]|0;l.words[T-10]=($&b)<<4|B>>>22,B=$}B>>>=22,l.words[T-10]=B,B===0&&l.length>10?l.length-=10:l.length-=9},j.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,b=0;b<l.length;b++){var S=l.words[b]|0;p+=S*977,l.words[b]=p&67108863,p=S*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function W(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(W,U);function X(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(X,U);function J(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(J,U),J.prototype.imulK=function(l){for(var p=0,b=0;b<l.length;b++){var S=(l.words[b]|0)*19+p,T=S&67108863;S>>>=26,l.words[b]=T,p=S}return p!==0&&(l.words[l.length++]=p),l},o._prime=function(l){if(F[l])return F[l];var p;if(l==="k256")p=new j;else if(l==="p224")p=new W;else if(l==="p192")p=new X;else if(l==="p25519")p=new J;else throw new Error("Unknown prime "+l);return F[l]=p,p};function G(O){if(typeof O=="string"){var l=o._prime(O);this.m=l.p,this.prime=l}else n(O.gtn(1),"modulus must be greater than 1"),this.m=O,this.prime=null}G.prototype._verify1=function(l){n(l.negative===0,"red works only with positives"),n(l.red,"red works only with red numbers")},G.prototype._verify2=function(l,p){n((l.negative|p.negative)===0,"red works only with positives"),n(l.red&&l.red===p.red,"red works only with red numbers")},G.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):l.umod(this.m)._forceRed(this)},G.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},G.prototype.add=function(l,p){this._verify2(l,p);var b=l.add(p);return b.cmp(this.m)>=0&&b.isub(this.m),b._forceRed(this)},G.prototype.iadd=function(l,p){this._verify2(l,p);var b=l.iadd(p);return b.cmp(this.m)>=0&&b.isub(this.m),b},G.prototype.sub=function(l,p){this._verify2(l,p);var b=l.sub(p);return b.cmpn(0)<0&&b.iadd(this.m),b._forceRed(this)},G.prototype.isub=function(l,p){this._verify2(l,p);var b=l.isub(p);return b.cmpn(0)<0&&b.iadd(this.m),b},G.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},G.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},G.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},G.prototype.isqr=function(l){return this.imul(l,l.clone())},G.prototype.sqr=function(l){return this.mul(l,l)},G.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(n(p%2===1),p===3){var b=this.m.add(new o(1)).iushrn(2);return this.pow(l,b)}for(var S=this.m.subn(1),T=0;!S.isZero()&&S.andln(1)===0;)T++,S.iushrn(1);n(!S.isZero());var B=new o(1).toRed(this),$=B.redNeg(),A=this.m.subn(1).iushrn(1),g=this.m.bitLength();for(g=new o(2*g*g).toRed(this);this.pow(g,A).cmp($)!==0;)g.redIAdd($);for(var k=this.pow(g,S),H=this.pow(l,S.addn(1).iushrn(1)),z=this.pow(l,S),Q=T;z.cmp(B)!==0;){for(var ie=z,ne=0;ie.cmp(B)!==0;ne++)ie=ie.redSqr();n(ne<Q);var Z=this.pow(k,new o(1).iushln(Q-ne-1));H=H.redMul(Z),k=Z.redSqr(),z=z.redMul(k),Q=ne}return H},G.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},G.prototype.pow=function(l,p){if(p.isZero())return new o(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var b=4,S=new Array(1<<b);S[0]=new o(1).toRed(this),S[1]=l;for(var T=2;T<S.length;T++)S[T]=this.mul(S[T-1],l);var B=S[0],$=0,A=0,g=p.bitLength()%26;for(g===0&&(g=26),T=p.length-1;T>=0;T--){for(var k=p.words[T],H=g-1;H>=0;H--){var z=k>>H&1;if(B!==S[0]&&(B=this.sqr(B)),z===0&&$===0){A=0;continue}$<<=1,$|=z,A++,!(A!==b&&(T!==0||H!==0))&&(B=this.mul(B,S[$]),A=0,$=0)}g=26}return B},G.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},G.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},o.mont=function(l){return new oe(l)};function oe(O){G.call(this,O),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(oe,G),oe.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},oe.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},oe.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var b=l.imul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new o(0)._forceRed(this);var b=l.mul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,commonjsGlobal)}(bn$5)),bn$5.exports}var brorand={exports:{}},hasRequiredBrorand;function requireBrorand(){if(hasRequiredBrorand)return brorand.exports;hasRequiredBrorand=1;var r;brorand.exports=function(a){return r||(r=new e(null)),r.generate(a)};function e(n){this.rand=n}if(brorand.exports.Rand=e,e.prototype.generate=function(a){return this._rand(a)},e.prototype._rand=function(a){if(this.rand.getBytes)return this.rand.getBytes(a);for(var o=new Uint8Array(a),c=0;c<o.length;c++)o[c]=this.rand.getByte();return o},typeof self=="object")self.crypto&&self.crypto.getRandomValues?e.prototype._rand=function(a){var o=new Uint8Array(a);return self.crypto.getRandomValues(o),o}:self.msCrypto&&self.msCrypto.getRandomValues?e.prototype._rand=function(a){var o=new Uint8Array(a);return self.msCrypto.getRandomValues(o),o}:typeof window=="object"&&(e.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var t=requireCryptoBrowserify();if(typeof t.randomBytes!="function")throw new Error("Not supported");e.prototype._rand=function(a){return t.randomBytes(a)}}catch{}return brorand.exports}var mr,hasRequiredMr;function requireMr(){if(hasRequiredMr)return mr;hasRequiredMr=1;var r=requireBn$5(),e=requireBrorand();function t(n){this.rand=n||new e.Rand}return mr=t,t.create=function(a){return new t(a)},t.prototype._randbelow=function(a){var o=a.bitLength(),c=Math.ceil(o/8);do var u=new r(this.rand.generate(c));while(u.cmp(a)>=0);return u},t.prototype._randrange=function(a,o){var c=o.sub(a);return a.add(this._randbelow(c))},t.prototype.test=function(a,o,c){var u=a.bitLength(),v=r.mont(a),_=new r(1).toRed(v);o||(o=Math.max(1,u/48|0));for(var x=a.subn(1),E=0;!x.testn(E);E++);for(var M=a.shrn(E),C=x.toRed(v),I=!0;o>0;o--){var D=this._randrange(new r(2),x);c&&c(D);var L=D.toRed(v).redPow(M);if(!(L.cmp(_)===0||L.cmp(C)===0)){for(var N=1;N<E;N++){if(L=L.redSqr(),L.cmp(_)===0)return!1;if(L.cmp(C)===0)break}if(N===E)return!1}}return I},t.prototype.getDivisor=function(a,o){var c=a.bitLength(),u=r.mont(a),v=new r(1).toRed(u);o||(o=Math.max(1,c/48|0));for(var _=a.subn(1),x=0;!_.testn(x);x++);for(var E=a.shrn(x),M=_.toRed(u);o>0;o--){var C=this._randrange(new r(2),_),I=a.gcd(C);if(I.cmpn(1)!==0)return I;var D=C.toRed(u).redPow(E);if(!(D.cmp(v)===0||D.cmp(M)===0)){for(var L=1;L<x;L++){if(D=D.redSqr(),D.cmp(v)===0)return D.fromRed().subn(1).gcd(a);if(D.cmp(M)===0)break}if(L===x)return D=D.redSqr(),D.fromRed().subn(1).gcd(a)}}return!1},mr}var generatePrime,hasRequiredGeneratePrime;function requireGeneratePrime(){if(hasRequiredGeneratePrime)return generatePrime;hasRequiredGeneratePrime=1;var r=requireBrowser$b();generatePrime=L,L.simpleSieve=I,L.fermatTest=D;var e=requireBn$6(),t=new e(24),n=requireMr(),a=new n,o=new e(1),c=new e(2),u=new e(5);new e(16),new e(8);var v=new e(10),_=new e(3);new e(7);var x=new e(11),E=new e(4);new e(12);var M=null;function C(){if(M!==null)return M;var N=1048576,q=[];q[0]=2;for(var F=1,U=3;U<N;U+=2){for(var j=Math.ceil(Math.sqrt(U)),W=0;W<F&&q[W]<=j&&U%q[W]!==0;W++);F!==W&&q[W]<=j||(q[F++]=U)}return M=q,q}function I(N){for(var q=C(),F=0;F<q.length;F++)if(N.modn(q[F])===0)return N.cmpn(q[F])===0;return!0}function D(N){var q=e.mont(N);return c.toRed(q).redPow(N.subn(1)).fromRed().cmpn(1)===0}function L(N,q){if(N<16)return q===2||q===5?new e([140,123]):new e([140,39]);q=new e(q);for(var F,U;;){for(F=new e(r(Math.ceil(N/8)));F.bitLength()>N;)F.ishrn(1);if(F.isEven()&&F.iadd(o),F.testn(1)||F.iadd(c),q.cmp(c)){if(!q.cmp(u))for(;F.mod(v).cmp(_);)F.iadd(E)}else for(;F.mod(t).cmp(x);)F.iadd(E);if(U=F.shrn(1),I(U)&&I(F)&&D(U)&&D(F)&&a.test(U)&&a.test(F))return F}}return generatePrime}const modp1={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"},require$$1$1={modp1,modp2,modp5,modp14,modp15,modp16,modp17,modp18};var dh,hasRequiredDh;function requireDh(){if(hasRequiredDh)return dh;hasRequiredDh=1;var r=requireBn$6(),e=requireMr(),t=new e,n=new r(24),a=new r(11),o=new r(10),c=new r(3),u=new r(7),v=requireGeneratePrime(),_=requireBrowser$b();dh=I;function x(L,N){return N=N||"utf8",dist.Buffer.isBuffer(L)||(L=new dist.Buffer(L,N)),this._pub=new r(L),this}function E(L,N){return N=N||"utf8",dist.Buffer.isBuffer(L)||(L=new dist.Buffer(L,N)),this._priv=new r(L),this}var M={};function C(L,N){var q=N.toString("hex"),F=[q,L.toString(16)].join("_");if(F in M)return M[F];var U=0;if(L.isEven()||!v.simpleSieve||!v.fermatTest(L)||!t.test(L))return U+=1,q==="02"||q==="05"?U+=8:U+=4,M[F]=U,U;t.test(L.shrn(1))||(U+=2);var j;switch(q){case"02":L.mod(n).cmp(a)&&(U+=8);break;case"05":j=L.mod(o),j.cmp(c)&&j.cmp(u)&&(U+=8);break;default:U+=4}return M[F]=U,U}function I(L,N,q){this.setGenerator(N),this.__prime=new r(L),this._prime=r.mont(this.__prime),this._primeLen=L.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,q?(this.setPublicKey=x,this.setPrivateKey=E):this._primeCode=8}Object.defineProperty(I.prototype,"verifyError",{enumerable:!0,get:function(){return typeof this._primeCode!="number"&&(this._primeCode=C(this.__prime,this.__gen)),this._primeCode}}),I.prototype.generateKeys=function(){return this._priv||(this._priv=new r(_(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},I.prototype.computeSecret=function(L){L=new r(L),L=L.toRed(this._prime);var N=L.redPow(this._priv).fromRed(),q=new dist.Buffer(N.toArray()),F=this.getPrime();if(q.length<F.length){var U=new dist.Buffer(F.length-q.length);U.fill(0),q=dist.Buffer.concat([U,q])}return q},I.prototype.getPublicKey=function(N){return D(this._pub,N)},I.prototype.getPrivateKey=function(N){return D(this._priv,N)},I.prototype.getPrime=function(L){return D(this.__prime,L)},I.prototype.getGenerator=function(L){return D(this._gen,L)},I.prototype.setGenerator=function(L,N){return N=N||"utf8",dist.Buffer.isBuffer(L)||(L=new dist.Buffer(L,N)),this.__gen=L,this._gen=new r(L),this};function D(L,N){var q=new dist.Buffer(L.toArray());return N?q.toString(N):q}return dh}var hasRequiredBrowser$4;function requireBrowser$4(){if(hasRequiredBrowser$4)return browser$5;hasRequiredBrowser$4=1;var r=requireGeneratePrime(),e=require$$1$1,t=requireDh();function n(c){var u=new dist.Buffer(e[c].prime,"hex"),v=new dist.Buffer(e[c].gen,"hex");return new t(u,v)}var a={binary:!0,hex:!0,base64:!0};function o(c,u,v,_){return dist.Buffer.isBuffer(u)||a[u]===void 0?o(c,"binary",u,v):(u=u||"binary",_=_||"binary",v=v||new dist.Buffer([2]),dist.Buffer.isBuffer(v)||(v=new dist.Buffer(v,_)),typeof c=="number"?new t(r(c,v),v,!0):(dist.Buffer.isBuffer(c)||(c=new dist.Buffer(c,u)),new t(c,v,!0)))}return browser$5.DiffieHellmanGroup=browser$5.createDiffieHellmanGroup=browser$5.getDiffieHellman=n,browser$5.createDiffieHellman=browser$5.DiffieHellman=o,browser$5}var readableBrowser={exports:{}},processNextickArgs={exports:{}},hasRequiredProcessNextickArgs;function requireProcessNextickArgs(){if(hasRequiredProcessNextickArgs)return processNextickArgs.exports;hasRequiredProcessNextickArgs=1,typeof dist.process>"u"||!dist.process.version||dist.process.version.indexOf("v0.")===0||dist.process.version.indexOf("v1.")===0&&dist.process.version.indexOf("v1.8.")!==0?processNextickArgs.exports={nextTick:r}:processNextickArgs.exports=dist.process;function r(e,t,n,a){if(typeof e!="function")throw new TypeError('"callback" argument must be a function');var o=arguments.length,c,u;switch(o){case 0:case 1:return dist.process.nextTick(e);case 2:return dist.process.nextTick(function(){e.call(null,t)});case 3:return dist.process.nextTick(function(){e.call(null,t,n)});case 4:return dist.process.nextTick(function(){e.call(null,t,n,a)});default:for(c=new Array(o-1),u=0;u<c.length;)c[u++]=arguments[u];return dist.process.nextTick(function(){e.apply(null,c)})}}return processNextickArgs.exports}var isarray,hasRequiredIsarray;function requireIsarray(){if(hasRequiredIsarray)return isarray;hasRequiredIsarray=1;var r={}.toString;return isarray=Array.isArray||function(e){return r.call(e)=="[object Array]"},isarray}var streamBrowser,hasRequiredStreamBrowser;function requireStreamBrowser(){return hasRequiredStreamBrowser||(hasRequiredStreamBrowser=1,streamBrowser=eventsExports.EventEmitter),streamBrowser}var safeBuffer={exports:{}},hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,function(r,e){var t=bufferPolyfill,n=t.Buffer;function a(c,u){for(var v in c)u[v]=c[v]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=o);function o(c,u,v){return n(c,u,v)}a(n,o),o.from=function(c,u,v){if(typeof c=="number")throw new TypeError("Argument must not be a number");return n(c,u,v)},o.alloc=function(c,u,v){if(typeof c!="number")throw new TypeError("Argument must be a number");var _=n(c);return u!==void 0?typeof v=="string"?_.fill(u,v):_.fill(u):_.fill(0),_},o.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return n(c)},o.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(c)}}(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var util={},hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1;function r(D){return Array.isArray?Array.isArray(D):I(D)==="[object Array]"}util.isArray=r;function e(D){return typeof D=="boolean"}util.isBoolean=e;function t(D){return D===null}util.isNull=t;function n(D){return D==null}util.isNullOrUndefined=n;function a(D){return typeof D=="number"}util.isNumber=a;function o(D){return typeof D=="string"}util.isString=o;function c(D){return typeof D=="symbol"}util.isSymbol=c;function u(D){return D===void 0}util.isUndefined=u;function v(D){return I(D)==="[object RegExp]"}util.isRegExp=v;function _(D){return typeof D=="object"&&D!==null}util.isObject=_;function x(D){return I(D)==="[object Date]"}util.isDate=x;function E(D){return I(D)==="[object Error]"||D instanceof Error}util.isError=E;function M(D){return typeof D=="function"}util.isFunction=M;function C(D){return D===null||typeof D=="boolean"||typeof D=="number"||typeof D=="string"||typeof D=="symbol"||typeof D>"u"}util.isPrimitive=C,util.isBuffer=bufferPolyfill.Buffer.isBuffer;function I(D){return Object.prototype.toString.call(D)}return util}var BufferList={exports:{}},hasRequiredBufferList;function requireBufferList(){return hasRequiredBufferList||(hasRequiredBufferList=1,function(r){function e(o,c){if(!(o instanceof c))throw new TypeError("Cannot call a class as a function")}var t=requireSafeBuffer().Buffer,n=requireUtil$1();function a(o,c,u){o.copy(c,u)}r.exports=function(){function o(){e(this,o),this.head=null,this.tail=null,this.length=0}return o.prototype.push=function(u){var v={data:u,next:null};this.length>0?this.tail.next=v:this.head=v,this.tail=v,++this.length},o.prototype.unshift=function(u){var v={data:u,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length},o.prototype.shift=function(){if(this.length!==0){var u=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,u}},o.prototype.clear=function(){this.head=this.tail=null,this.length=0},o.prototype.join=function(u){if(this.length===0)return"";for(var v=this.head,_=""+v.data;v=v.next;)_+=u+v.data;return _},o.prototype.concat=function(u){if(this.length===0)return t.alloc(0);for(var v=t.allocUnsafe(u>>>0),_=this.head,x=0;_;)a(_.data,v,x),x+=_.data.length,_=_.next;return v},o}(),n&&n.inspect&&n.inspect.custom&&(r.exports.prototype[n.inspect.custom]=function(){var o=n.inspect({length:this.length});return this.constructor.name+" "+o})}(BufferList)),BufferList.exports}var destroy_1,hasRequiredDestroy;function requireDestroy(){if(hasRequiredDestroy)return destroy_1;hasRequiredDestroy=1;var r=requireProcessNextickArgs();function e(a,o){var c=this,u=this._readableState&&this._readableState.destroyed,v=this._writableState&&this._writableState.destroyed;return u||v?(o?o(a):a&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(n,this,a)):r.nextTick(n,this,a)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(a||null,function(_){!o&&_?c._writableState?c._writableState.errorEmitted||(c._writableState.errorEmitted=!0,r.nextTick(n,c,_)):r.nextTick(n,c,_):o&&o(_)}),this)}function t(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function n(a,o){a.emit("error",o)}return destroy_1={destroy:e,undestroy:t},destroy_1}var _stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1;var r=requireProcessNextickArgs();_stream_writable=D;function e(B){var $=this;this.next=null,this.entry=null,this.finish=function(){T($,B)}}var t=!dist.process.browser&&["v0.10","v0.9."].indexOf(dist.process.version.slice(0,5))>-1?setImmediate:r.nextTick,n;D.WritableState=C;var a=Object.create(requireUtil());a.inherits=requireInherits_browser();var o={deprecate:requireBrowser$a()},c=requireStreamBrowser(),u=requireSafeBuffer().Buffer,v=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function _(B){return u.from(B)}function x(B){return u.isBuffer(B)||B instanceof v}var E=requireDestroy();a.inherits(D,c);function M(){}function C(B,$){n=n||require_stream_duplex(),B=B||{};var A=$ instanceof n;this.objectMode=!!B.objectMode,A&&(this.objectMode=this.objectMode||!!B.writableObjectMode);var g=B.highWaterMark,k=B.writableHighWaterMark,H=this.objectMode?16:16*1024;g||g===0?this.highWaterMark=g:A&&(k||k===0)?this.highWaterMark=k:this.highWaterMark=H,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var z=B.decodeStrings===!1;this.decodeStrings=!z,this.defaultEncoding=B.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Q){X($,Q)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}C.prototype.getBuffer=function(){for(var $=this.bufferedRequest,A=[];$;)A.push($),$=$.next;return A},function(){try{Object.defineProperty(C.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var I;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(I=Function.prototype[Symbol.hasInstance],Object.defineProperty(D,Symbol.hasInstance,{value:function(B){return I.call(this,B)?!0:this!==D?!1:B&&B._writableState instanceof C}})):I=function(B){return B instanceof this};function D(B){if(n=n||require_stream_duplex(),!I.call(D,this)&&!(this instanceof n))return new D(B);this._writableState=new C(B,this),this.writable=!0,B&&(typeof B.write=="function"&&(this._write=B.write),typeof B.writev=="function"&&(this._writev=B.writev),typeof B.destroy=="function"&&(this._destroy=B.destroy),typeof B.final=="function"&&(this._final=B.final)),c.call(this)}D.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function L(B,$){var A=new Error("write after end");B.emit("error",A),r.nextTick($,A)}function N(B,$,A,g){var k=!0,H=!1;return A===null?H=new TypeError("May not write null values to stream"):typeof A!="string"&&A!==void 0&&!$.objectMode&&(H=new TypeError("Invalid non-string/buffer chunk")),H&&(B.emit("error",H),r.nextTick(g,H),k=!1),k}D.prototype.write=function(B,$,A){var g=this._writableState,k=!1,H=!g.objectMode&&x(B);return H&&!u.isBuffer(B)&&(B=_(B)),typeof $=="function"&&(A=$,$=null),H?$="buffer":$||($=g.defaultEncoding),typeof A!="function"&&(A=M),g.ended?L(this,A):(H||N(this,g,B,A))&&(g.pendingcb++,k=F(this,g,H,B,$,A)),k},D.prototype.cork=function(){var B=this._writableState;B.corked++},D.prototype.uncork=function(){var B=this._writableState;B.corked&&(B.corked--,!B.writing&&!B.corked&&!B.bufferProcessing&&B.bufferedRequest&&oe(this,B))},D.prototype.setDefaultEncoding=function($){if(typeof $=="string"&&($=$.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf(($+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+$);return this._writableState.defaultEncoding=$,this};function q(B,$,A){return!B.objectMode&&B.decodeStrings!==!1&&typeof $=="string"&&($=u.from($,A)),$}Object.defineProperty(D.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function F(B,$,A,g,k,H){if(!A){var z=q($,g,k);g!==z&&(A=!0,k="buffer",g=z)}var Q=$.objectMode?1:g.length;$.length+=Q;var ie=$.length<$.highWaterMark;if(ie||($.needDrain=!0),$.writing||$.corked){var ne=$.lastBufferedRequest;$.lastBufferedRequest={chunk:g,encoding:k,isBuf:A,callback:H,next:null},ne?ne.next=$.lastBufferedRequest:$.bufferedRequest=$.lastBufferedRequest,$.bufferedRequestCount+=1}else U(B,$,!1,Q,g,k,H);return ie}function U(B,$,A,g,k,H,z){$.writelen=g,$.writecb=z,$.writing=!0,$.sync=!0,A?B._writev(k,$.onwrite):B._write(k,H,$.onwrite),$.sync=!1}function j(B,$,A,g,k){--$.pendingcb,A?(r.nextTick(k,g),r.nextTick(b,B,$),B._writableState.errorEmitted=!0,B.emit("error",g)):(k(g),B._writableState.errorEmitted=!0,B.emit("error",g),b(B,$))}function W(B){B.writing=!1,B.writecb=null,B.length-=B.writelen,B.writelen=0}function X(B,$){var A=B._writableState,g=A.sync,k=A.writecb;if(W(A),$)j(B,A,g,$,k);else{var H=O(A);!H&&!A.corked&&!A.bufferProcessing&&A.bufferedRequest&&oe(B,A),g?t(J,B,A,H,k):J(B,A,H,k)}}function J(B,$,A,g){A||G(B,$),$.pendingcb--,g(),b(B,$)}function G(B,$){$.length===0&&$.needDrain&&($.needDrain=!1,B.emit("drain"))}function oe(B,$){$.bufferProcessing=!0;var A=$.bufferedRequest;if(B._writev&&A&&A.next){var g=$.bufferedRequestCount,k=new Array(g),H=$.corkedRequestsFree;H.entry=A;for(var z=0,Q=!0;A;)k[z]=A,A.isBuf||(Q=!1),A=A.next,z+=1;k.allBuffers=Q,U(B,$,!0,$.length,k,"",H.finish),$.pendingcb++,$.lastBufferedRequest=null,H.next?($.corkedRequestsFree=H.next,H.next=null):$.corkedRequestsFree=new e($),$.bufferedRequestCount=0}else{for(;A;){var ie=A.chunk,ne=A.encoding,Z=A.callback,se=$.objectMode?1:ie.length;if(U(B,$,!1,se,ie,ne,Z),A=A.next,$.bufferedRequestCount--,$.writing)break}A===null&&($.lastBufferedRequest=null)}$.bufferedRequest=A,$.bufferProcessing=!1}D.prototype._write=function(B,$,A){A(new Error("_write() is not implemented"))},D.prototype._writev=null,D.prototype.end=function(B,$,A){var g=this._writableState;typeof B=="function"?(A=B,B=null,$=null):typeof $=="function"&&(A=$,$=null),B!=null&&this.write(B,$),g.corked&&(g.corked=1,this.uncork()),g.ending||S(this,g,A)};function O(B){return B.ending&&B.length===0&&B.bufferedRequest===null&&!B.finished&&!B.writing}function l(B,$){B._final(function(A){$.pendingcb--,A&&B.emit("error",A),$.prefinished=!0,B.emit("prefinish"),b(B,$)})}function p(B,$){!$.prefinished&&!$.finalCalled&&(typeof B._final=="function"?($.pendingcb++,$.finalCalled=!0,r.nextTick(l,B,$)):($.prefinished=!0,B.emit("prefinish")))}function b(B,$){var A=O($);return A&&(p(B,$),$.pendingcb===0&&($.finished=!0,B.emit("finish"))),A}function S(B,$,A){$.ending=!0,b(B,$),A&&($.finished?r.nextTick(A):B.once("finish",A)),$.ended=!0,B.writable=!1}function T(B,$,A){var g=B.entry;for(B.entry=null;g;){var k=g.callback;$.pendingcb--,k(A),g=g.next}$.corkedRequestsFree.next=B}return Object.defineProperty(D.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(B){this._writableState&&(this._writableState.destroyed=B)}}),D.prototype.destroy=E.destroy,D.prototype._undestroy=E.undestroy,D.prototype._destroy=function(B,$){this.end(),$(B)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var r=requireProcessNextickArgs(),e=Object.keys||function(E){var M=[];for(var C in E)M.push(C);return M};_stream_duplex=v;var t=Object.create(requireUtil());t.inherits=requireInherits_browser();var n=require_stream_readable(),a=require_stream_writable();t.inherits(v,n);for(var o=e(a.prototype),c=0;c<o.length;c++){var u=o[c];v.prototype[u]||(v.prototype[u]=a.prototype[u])}function v(E){if(!(this instanceof v))return new v(E);n.call(this,E),a.call(this,E),E&&E.readable===!1&&(this.readable=!1),E&&E.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,E&&E.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",_)}Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function _(){this.allowHalfOpen||this._writableState.ended||r.nextTick(x,this)}function x(E){E.end()}return Object.defineProperty(v.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(E){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=E,this._writableState.destroyed=E)}}),v.prototype._destroy=function(E,M){this.push(null),this.end(),r.nextTick(M,E)},_stream_duplex}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1;var r=requireProcessNextickArgs();_stream_readable=q;var e=requireIsarray(),t;q.ReadableState=N,eventsExports.EventEmitter;var n=function(Z,se){return Z.listeners(se).length},a=requireStreamBrowser(),o=requireSafeBuffer().Buffer,c=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function u(Z){return o.from(Z)}function v(Z){return o.isBuffer(Z)||Z instanceof c}var _=Object.create(requireUtil());_.inherits=requireInherits_browser();var x=requireUtil$1(),E=void 0;x&&x.debuglog?E=x.debuglog("stream"):E=function(){};var M=requireBufferList(),C=requireDestroy(),I;_.inherits(q,a);var D=["error","close","destroy","pause","resume"];function L(Z,se,ae){if(typeof Z.prependListener=="function")return Z.prependListener(se,ae);!Z._events||!Z._events[se]?Z.on(se,ae):e(Z._events[se])?Z._events[se].unshift(ae):Z._events[se]=[ae,Z._events[se]]}function N(Z,se){t=t||require_stream_duplex(),Z=Z||{};var ae=se instanceof t;this.objectMode=!!Z.objectMode,ae&&(this.objectMode=this.objectMode||!!Z.readableObjectMode);var ce=Z.highWaterMark,le=Z.readableHighWaterMark,te=this.objectMode?16:16*1024;ce||ce===0?this.highWaterMark=ce:ae&&(le||le===0)?this.highWaterMark=le:this.highWaterMark=te,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new M,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=Z.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Z.encoding&&(I||(I=requireString_decoder().StringDecoder),this.decoder=new I(Z.encoding),this.encoding=Z.encoding)}function q(Z){if(t=t||require_stream_duplex(),!(this instanceof q))return new q(Z);this._readableState=new N(Z,this),this.readable=!0,Z&&(typeof Z.read=="function"&&(this._read=Z.read),typeof Z.destroy=="function"&&(this._destroy=Z.destroy)),a.call(this)}Object.defineProperty(q.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Z){this._readableState&&(this._readableState.destroyed=Z)}}),q.prototype.destroy=C.destroy,q.prototype._undestroy=C.undestroy,q.prototype._destroy=function(Z,se){this.push(null),se(Z)},q.prototype.push=function(Z,se){var ae=this._readableState,ce;return ae.objectMode?ce=!0:typeof Z=="string"&&(se=se||ae.defaultEncoding,se!==ae.encoding&&(Z=o.from(Z,se),se=""),ce=!0),F(this,Z,se,!1,ce)},q.prototype.unshift=function(Z){return F(this,Z,null,!0,!1)};function F(Z,se,ae,ce,le){var te=Z._readableState;if(se===null)te.reading=!1,oe(Z,te);else{var he;le||(he=j(te,se)),he?Z.emit("error",he):te.objectMode||se&&se.length>0?(typeof se!="string"&&!te.objectMode&&Object.getPrototypeOf(se)!==o.prototype&&(se=u(se)),ce?te.endEmitted?Z.emit("error",new Error("stream.unshift() after end event")):U(Z,te,se,!0):te.ended?Z.emit("error",new Error("stream.push() after EOF")):(te.reading=!1,te.decoder&&!ae?(se=te.decoder.write(se),te.objectMode||se.length!==0?U(Z,te,se,!1):p(Z,te)):U(Z,te,se,!1))):ce||(te.reading=!1)}return W(te)}function U(Z,se,ae,ce){se.flowing&&se.length===0&&!se.sync?(Z.emit("data",ae),Z.read(0)):(se.length+=se.objectMode?1:ae.length,ce?se.buffer.unshift(ae):se.buffer.push(ae),se.needReadable&&O(Z)),p(Z,se)}function j(Z,se){var ae;return!v(se)&&typeof se!="string"&&se!==void 0&&!Z.objectMode&&(ae=new TypeError("Invalid non-string/buffer chunk")),ae}function W(Z){return!Z.ended&&(Z.needReadable||Z.length<Z.highWaterMark||Z.length===0)}q.prototype.isPaused=function(){return this._readableState.flowing===!1},q.prototype.setEncoding=function(Z){return I||(I=requireString_decoder().StringDecoder),this._readableState.decoder=new I(Z),this._readableState.encoding=Z,this};var X=8388608;function J(Z){return Z>=X?Z=X:(Z--,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,Z|=Z>>>16,Z++),Z}function G(Z,se){return Z<=0||se.length===0&&se.ended?0:se.objectMode?1:Z!==Z?se.flowing&&se.length?se.buffer.head.data.length:se.length:(Z>se.highWaterMark&&(se.highWaterMark=J(Z)),Z<=se.length?Z:se.ended?se.length:(se.needReadable=!0,0))}q.prototype.read=function(Z){E("read",Z),Z=parseInt(Z,10);var se=this._readableState,ae=Z;if(Z!==0&&(se.emittedReadable=!1),Z===0&&se.needReadable&&(se.length>=se.highWaterMark||se.ended))return E("read: emitReadable",se.length,se.ended),se.length===0&&se.ended?Q(this):O(this),null;if(Z=G(Z,se),Z===0&&se.ended)return se.length===0&&Q(this),null;var ce=se.needReadable;E("need readable",ce),(se.length===0||se.length-Z<se.highWaterMark)&&(ce=!0,E("length less than watermark",ce)),se.ended||se.reading?(ce=!1,E("reading or ended",ce)):ce&&(E("do read"),se.reading=!0,se.sync=!0,se.length===0&&(se.needReadable=!0),this._read(se.highWaterMark),se.sync=!1,se.reading||(Z=G(ae,se)));var le;return Z>0?le=g(Z,se):le=null,le===null?(se.needReadable=!0,Z=0):se.length-=Z,se.length===0&&(se.ended||(se.needReadable=!0),ae!==Z&&se.ended&&Q(this)),le!==null&&this.emit("data",le),le};function oe(Z,se){if(!se.ended){if(se.decoder){var ae=se.decoder.end();ae&&ae.length&&(se.buffer.push(ae),se.length+=se.objectMode?1:ae.length)}se.ended=!0,O(Z)}}function O(Z){var se=Z._readableState;se.needReadable=!1,se.emittedReadable||(E("emitReadable",se.flowing),se.emittedReadable=!0,se.sync?r.nextTick(l,Z):l(Z))}function l(Z){E("emit readable"),Z.emit("readable"),A(Z)}function p(Z,se){se.readingMore||(se.readingMore=!0,r.nextTick(b,Z,se))}function b(Z,se){for(var ae=se.length;!se.reading&&!se.flowing&&!se.ended&&se.length<se.highWaterMark&&(E("maybeReadMore read 0"),Z.read(0),ae!==se.length);)ae=se.length;se.readingMore=!1}q.prototype._read=function(Z){this.emit("error",new Error("_read() is not implemented"))},q.prototype.pipe=function(Z,se){var ae=this,ce=this._readableState;switch(ce.pipesCount){case 0:ce.pipes=Z;break;case 1:ce.pipes=[ce.pipes,Z];break;default:ce.pipes.push(Z);break}ce.pipesCount+=1,E("pipe count=%d opts=%j",ce.pipesCount,se);var le=(!se||se.end!==!1)&&Z!==dist.process.stdout&&Z!==dist.process.stderr,te=le?Ae:Ve;ce.endEmitted?r.nextTick(te):ae.once("end",te),Z.on("unpipe",he);function he(be,Ee){E("onunpipe"),be===ae&&Ee&&Ee.hasUnpiped===!1&&(Ee.hasUnpiped=!0,je())}function Ae(){E("onend"),Z.end()}var ge=S(ae);Z.on("drain",ge);var me=!1;function je(){E("cleanup"),Z.removeListener("close",ye),Z.removeListener("finish",xe),Z.removeListener("drain",ge),Z.removeListener("error",Ke),Z.removeListener("unpipe",he),ae.removeListener("end",Ae),ae.removeListener("end",Ve),ae.removeListener("data",pe),me=!0,ce.awaitDrain&&(!Z._writableState||Z._writableState.needDrain)&&ge()}var we=!1;ae.on("data",pe);function pe(be){E("ondata"),we=!1;var Ee=Z.write(be);Ee===!1&&!we&&((ce.pipesCount===1&&ce.pipes===Z||ce.pipesCount>1&&ne(ce.pipes,Z)!==-1)&&!me&&(E("false write response, pause",ce.awaitDrain),ce.awaitDrain++,we=!0),ae.pause())}function Ke(be){E("onerror",be),Ve(),Z.removeListener("error",Ke),n(Z,"error")===0&&Z.emit("error",be)}L(Z,"error",Ke);function ye(){Z.removeListener("finish",xe),Ve()}Z.once("close",ye);function xe(){E("onfinish"),Z.removeListener("close",ye),Ve()}Z.once("finish",xe);function Ve(){E("unpipe"),ae.unpipe(Z)}return Z.emit("pipe",ae),ce.flowing||(E("pipe resume"),ae.resume()),Z};function S(Z){return function(){var se=Z._readableState;E("pipeOnDrain",se.awaitDrain),se.awaitDrain&&se.awaitDrain--,se.awaitDrain===0&&n(Z,"data")&&(se.flowing=!0,A(Z))}}q.prototype.unpipe=function(Z){var se=this._readableState,ae={hasUnpiped:!1};if(se.pipesCount===0)return this;if(se.pipesCount===1)return Z&&Z!==se.pipes?this:(Z||(Z=se.pipes),se.pipes=null,se.pipesCount=0,se.flowing=!1,Z&&Z.emit("unpipe",this,ae),this);if(!Z){var ce=se.pipes,le=se.pipesCount;se.pipes=null,se.pipesCount=0,se.flowing=!1;for(var te=0;te<le;te++)ce[te].emit("unpipe",this,{hasUnpiped:!1});return this}var he=ne(se.pipes,Z);return he===-1?this:(se.pipes.splice(he,1),se.pipesCount-=1,se.pipesCount===1&&(se.pipes=se.pipes[0]),Z.emit("unpipe",this,ae),this)},q.prototype.on=function(Z,se){var ae=a.prototype.on.call(this,Z,se);if(Z==="data")this._readableState.flowing!==!1&&this.resume();else if(Z==="readable"){var ce=this._readableState;!ce.endEmitted&&!ce.readableListening&&(ce.readableListening=ce.needReadable=!0,ce.emittedReadable=!1,ce.reading?ce.length&&O(this):r.nextTick(T,this))}return ae},q.prototype.addListener=q.prototype.on;function T(Z){E("readable nexttick read 0"),Z.read(0)}q.prototype.resume=function(){var Z=this._readableState;return Z.flowing||(E("resume"),Z.flowing=!0,B(this,Z)),this};function B(Z,se){se.resumeScheduled||(se.resumeScheduled=!0,r.nextTick($,Z,se))}function $(Z,se){se.reading||(E("resume read 0"),Z.read(0)),se.resumeScheduled=!1,se.awaitDrain=0,Z.emit("resume"),A(Z),se.flowing&&!se.reading&&Z.read(0)}q.prototype.pause=function(){return E("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(E("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function A(Z){var se=Z._readableState;for(E("flow",se.flowing);se.flowing&&Z.read()!==null;);}q.prototype.wrap=function(Z){var se=this,ae=this._readableState,ce=!1;Z.on("end",function(){if(E("wrapped end"),ae.decoder&&!ae.ended){var he=ae.decoder.end();he&&he.length&&se.push(he)}se.push(null)}),Z.on("data",function(he){if(E("wrapped data"),ae.decoder&&(he=ae.decoder.write(he)),!(ae.objectMode&&he==null)&&!(!ae.objectMode&&(!he||!he.length))){var Ae=se.push(he);Ae||(ce=!0,Z.pause())}});for(var le in Z)this[le]===void 0&&typeof Z[le]=="function"&&(this[le]=function(he){return function(){return Z[he].apply(Z,arguments)}}(le));for(var te=0;te<D.length;te++)Z.on(D[te],this.emit.bind(this,D[te]));return this._read=function(he){E("wrapped _read",he),ce&&(ce=!1,Z.resume())},this},Object.defineProperty(q.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),q._fromList=g;function g(Z,se){if(se.length===0)return null;var ae;return se.objectMode?ae=se.buffer.shift():!Z||Z>=se.length?(se.decoder?ae=se.buffer.join(""):se.buffer.length===1?ae=se.buffer.head.data:ae=se.buffer.concat(se.length),se.buffer.clear()):ae=k(Z,se.buffer,se.decoder),ae}function k(Z,se,ae){var ce;return Z<se.head.data.length?(ce=se.head.data.slice(0,Z),se.head.data=se.head.data.slice(Z)):Z===se.head.data.length?ce=se.shift():ce=ae?H(Z,se):z(Z,se),ce}function H(Z,se){var ae=se.head,ce=1,le=ae.data;for(Z-=le.length;ae=ae.next;){var te=ae.data,he=Z>te.length?te.length:Z;if(he===te.length?le+=te:le+=te.slice(0,Z),Z-=he,Z===0){he===te.length?(++ce,ae.next?se.head=ae.next:se.head=se.tail=null):(se.head=ae,ae.data=te.slice(he));break}++ce}return se.length-=ce,le}function z(Z,se){var ae=o.allocUnsafe(Z),ce=se.head,le=1;for(ce.data.copy(ae),Z-=ce.data.length;ce=ce.next;){var te=ce.data,he=Z>te.length?te.length:Z;if(te.copy(ae,ae.length-Z,0,he),Z-=he,Z===0){he===te.length?(++le,ce.next?se.head=ce.next:se.head=se.tail=null):(se.head=ce,ce.data=te.slice(he));break}++le}return se.length-=le,ae}function Q(Z){var se=Z._readableState;if(se.length>0)throw new Error('"endReadable()" called on non-empty stream');se.endEmitted||(se.ended=!0,r.nextTick(ie,se,Z))}function ie(Z,se){!Z.endEmitted&&Z.length===0&&(Z.endEmitted=!0,se.readable=!1,se.emit("end"))}function ne(Z,se){for(var ae=0,ce=Z.length;ae<ce;ae++)if(Z[ae]===se)return ae;return-1}return _stream_readable}var _stream_transform,hasRequired_stream_transform;function require_stream_transform(){if(hasRequired_stream_transform)return _stream_transform;hasRequired_stream_transform=1,_stream_transform=n;var r=require_stream_duplex(),e=Object.create(requireUtil());e.inherits=requireInherits_browser(),e.inherits(n,r);function t(c,u){var v=this._transformState;v.transforming=!1;var _=v.writecb;if(!_)return this.emit("error",new Error("write callback called multiple times"));v.writechunk=null,v.writecb=null,u!=null&&this.push(u),_(c);var x=this._readableState;x.reading=!1,(x.needReadable||x.length<x.highWaterMark)&&this._read(x.highWaterMark)}function n(c){if(!(this instanceof n))return new n(c);r.call(this,c),this._transformState={afterTransform:t.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,c&&(typeof c.transform=="function"&&(this._transform=c.transform),typeof c.flush=="function"&&(this._flush=c.flush)),this.on("prefinish",a)}function a(){var c=this;typeof this._flush=="function"?this._flush(function(u,v){o(c,u,v)}):o(this,null,null)}n.prototype.push=function(c,u){return this._transformState.needTransform=!1,r.prototype.push.call(this,c,u)},n.prototype._transform=function(c,u,v){throw new Error("_transform() is not implemented")},n.prototype._write=function(c,u,v){var _=this._transformState;if(_.writecb=v,_.writechunk=c,_.writeencoding=u,!_.transforming){var x=this._readableState;(_.needTransform||x.needReadable||x.length<x.highWaterMark)&&this._read(x.highWaterMark)}},n.prototype._read=function(c){var u=this._transformState;u.writechunk!==null&&u.writecb&&!u.transforming?(u.transforming=!0,this._transform(u.writechunk,u.writeencoding,u.afterTransform)):u.needTransform=!0},n.prototype._destroy=function(c,u){var v=this;r.prototype._destroy.call(this,c,function(_){u(_),v.emit("close")})};function o(c,u,v){if(u)return c.emit("error",u);if(v!=null&&c.push(v),c._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(c._transformState.transforming)throw new Error("Calling transform done when still transforming");return c.push(null)}return _stream_transform}var _stream_passthrough,hasRequired_stream_passthrough;function require_stream_passthrough(){if(hasRequired_stream_passthrough)return _stream_passthrough;hasRequired_stream_passthrough=1,_stream_passthrough=t;var r=require_stream_transform(),e=Object.create(requireUtil());e.inherits=requireInherits_browser(),e.inherits(t,r);function t(n){if(!(this instanceof t))return new t(n);r.call(this,n)}return t.prototype._transform=function(n,a,o){o(null,n)},_stream_passthrough}var hasRequiredReadableBrowser;function requireReadableBrowser(){return hasRequiredReadableBrowser||(hasRequiredReadableBrowser=1,function(r,e){e=r.exports=require_stream_readable(),e.Stream=e,e.Readable=e,e.Writable=require_stream_writable(),e.Duplex=require_stream_duplex(),e.Transform=require_stream_transform(),e.PassThrough=require_stream_passthrough()}(readableBrowser,readableBrowser.exports)),readableBrowser.exports}var sign$2={exports:{}},bn$4={exports:{}};bn$4.exports;var hasRequiredBn$4;function requireBn$4(){return hasRequiredBn$4||(hasRequiredBn$4=1,function(r){(function(e,t){function n(p,b){if(!p)throw new Error(b||"Assertion failed")}function a(p,b){p.super_=b;var S=function(){};S.prototype=b.prototype,p.prototype=new S,p.prototype.constructor=p}function o(p,b,S){if(o.isBN(p))return p;this.negative=0,this.words=null,this.length=0,this.red=null,p!==null&&((b==="le"||b==="be")&&(S=b,b=10),this._init(p||0,b||10,S||"be"))}typeof e=="object"?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=bufferPolyfill.Buffer}catch{}o.isBN=function(b){return b instanceof o?!0:b!==null&&typeof b=="object"&&b.constructor.wordSize===o.wordSize&&Array.isArray(b.words)},o.max=function(b,S){return b.cmp(S)>0?b:S},o.min=function(b,S){return b.cmp(S)<0?b:S},o.prototype._init=function(b,S,T){if(typeof b=="number")return this._initNumber(b,S,T);if(typeof b=="object")return this._initArray(b,S,T);S==="hex"&&(S=16),n(S===(S|0)&&S>=2&&S<=36),b=b.toString().replace(/\s+/g,"");var B=0;b[0]==="-"&&(B++,this.negative=1),B<b.length&&(S===16?this._parseHex(b,B,T):(this._parseBase(b,S,B),T==="le"&&this._initArray(this.toArray(),S,T)))},o.prototype._initNumber=function(b,S,T){b<0&&(this.negative=1,b=-b),b<67108864?(this.words=[b&67108863],this.length=1):b<4503599627370496?(this.words=[b&67108863,b/67108864&67108863],this.length=2):(n(b<9007199254740992),this.words=[b&67108863,b/67108864&67108863,1],this.length=3),T==="le"&&this._initArray(this.toArray(),S,T)},o.prototype._initArray=function(b,S,T){if(n(typeof b.length=="number"),b.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(b.length/3),this.words=new Array(this.length);for(var B=0;B<this.length;B++)this.words[B]=0;var $,A,g=0;if(T==="be")for(B=b.length-1,$=0;B>=0;B-=3)A=b[B]|b[B-1]<<8|b[B-2]<<16,this.words[$]|=A<<g&67108863,this.words[$+1]=A>>>26-g&67108863,g+=24,g>=26&&(g-=26,$++);else if(T==="le")for(B=0,$=0;B<b.length;B+=3)A=b[B]|b[B+1]<<8|b[B+2]<<16,this.words[$]|=A<<g&67108863,this.words[$+1]=A>>>26-g&67108863,g+=24,g>=26&&(g-=26,$++);return this._strip()};function u(p,b){var S=p.charCodeAt(b);if(S>=48&&S<=57)return S-48;if(S>=65&&S<=70)return S-55;if(S>=97&&S<=102)return S-87;n(!1,"Invalid character in "+p)}function v(p,b,S){var T=u(p,S);return S-1>=b&&(T|=u(p,S-1)<<4),T}o.prototype._parseHex=function(b,S,T){this.length=Math.ceil((b.length-S)/6),this.words=new Array(this.length);for(var B=0;B<this.length;B++)this.words[B]=0;var $=0,A=0,g;if(T==="be")for(B=b.length-1;B>=S;B-=2)g=v(b,S,B)<<$,this.words[A]|=g&67108863,$>=18?($-=18,A+=1,this.words[A]|=g>>>26):$+=8;else{var k=b.length-S;for(B=k%2===0?S+1:S;B<b.length;B+=2)g=v(b,S,B)<<$,this.words[A]|=g&67108863,$>=18?($-=18,A+=1,this.words[A]|=g>>>26):$+=8}this._strip()};function _(p,b,S,T){for(var B=0,$=0,A=Math.min(p.length,S),g=b;g<A;g++){var k=p.charCodeAt(g)-48;B*=T,k>=49?$=k-49+10:k>=17?$=k-17+10:$=k,n(k>=0&&$<T,"Invalid character"),B+=$}return B}o.prototype._parseBase=function(b,S,T){this.words=[0],this.length=1;for(var B=0,$=1;$<=67108863;$*=S)B++;B--,$=$/S|0;for(var A=b.length-T,g=A%B,k=Math.min(A,A-g)+T,H=0,z=T;z<k;z+=B)H=_(b,z,z+B,S),this.imuln($),this.words[0]+H<67108864?this.words[0]+=H:this._iaddn(H);if(g!==0){var Q=1;for(H=_(b,z,b.length,S),z=0;z<g;z++)Q*=S;this.imuln(Q),this.words[0]+H<67108864?this.words[0]+=H:this._iaddn(H)}this._strip()},o.prototype.copy=function(b){b.words=new Array(this.length);for(var S=0;S<this.length;S++)b.words[S]=this.words[S];b.length=this.length,b.negative=this.negative,b.red=this.red};function x(p,b){p.words=b.words,p.length=b.length,p.negative=b.negative,p.red=b.red}if(o.prototype._move=function(b){x(b,this)},o.prototype.clone=function(){var b=new o(null);return this.copy(b),b},o.prototype._expand=function(b){for(;this.length<b;)this.words[this.length++]=0;return this},o.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{o.prototype[Symbol.for("nodejs.util.inspect.custom")]=E}catch{o.prototype.inspect=E}else o.prototype.inspect=E;function E(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var M=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],C=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],I=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(b,S){b=b||10,S=S|0||1;var T;if(b===16||b==="hex"){T="";for(var B=0,$=0,A=0;A<this.length;A++){var g=this.words[A],k=((g<<B|$)&16777215).toString(16);$=g>>>24-B&16777215,B+=2,B>=26&&(B-=26,A--),$!==0||A!==this.length-1?T=M[6-k.length]+k+T:T=k+T}for($!==0&&(T=$.toString(16)+T);T.length%S!==0;)T="0"+T;return this.negative!==0&&(T="-"+T),T}if(b===(b|0)&&b>=2&&b<=36){var H=C[b],z=I[b];T="";var Q=this.clone();for(Q.negative=0;!Q.isZero();){var ie=Q.modrn(z).toString(b);Q=Q.idivn(z),Q.isZero()?T=ie+T:T=M[H-ie.length]+ie+T}for(this.isZero()&&(T="0"+T);T.length%S!==0;)T="0"+T;return this.negative!==0&&(T="-"+T),T}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var b=this.words[0];return this.length===2?b+=this.words[1]*67108864:this.length===3&&this.words[2]===1?b+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-b:b},o.prototype.toJSON=function(){return this.toString(16,2)},c&&(o.prototype.toBuffer=function(b,S){return this.toArrayLike(c,b,S)}),o.prototype.toArray=function(b,S){return this.toArrayLike(Array,b,S)};var D=function(b,S){return b.allocUnsafe?b.allocUnsafe(S):new b(S)};o.prototype.toArrayLike=function(b,S,T){this._strip();var B=this.byteLength(),$=T||Math.max(1,B);n(B<=$,"byte array longer than desired length"),n($>0,"Requested array length <= 0");var A=D(b,$),g=S==="le"?"LE":"BE";return this["_toArrayLike"+g](A,B),A},o.prototype._toArrayLikeLE=function(b,S){for(var T=0,B=0,$=0,A=0;$<this.length;$++){var g=this.words[$]<<A|B;b[T++]=g&255,T<b.length&&(b[T++]=g>>8&255),T<b.length&&(b[T++]=g>>16&255),A===6?(T<b.length&&(b[T++]=g>>24&255),B=0,A=0):(B=g>>>24,A+=2)}if(T<b.length)for(b[T++]=B;T<b.length;)b[T++]=0},o.prototype._toArrayLikeBE=function(b,S){for(var T=b.length-1,B=0,$=0,A=0;$<this.length;$++){var g=this.words[$]<<A|B;b[T--]=g&255,T>=0&&(b[T--]=g>>8&255),T>=0&&(b[T--]=g>>16&255),A===6?(T>=0&&(b[T--]=g>>24&255),B=0,A=0):(B=g>>>24,A+=2)}if(T>=0)for(b[T--]=B;T>=0;)b[T--]=0},Math.clz32?o.prototype._countBits=function(b){return 32-Math.clz32(b)}:o.prototype._countBits=function(b){var S=b,T=0;return S>=4096&&(T+=13,S>>>=13),S>=64&&(T+=7,S>>>=7),S>=8&&(T+=4,S>>>=4),S>=2&&(T+=2,S>>>=2),T+S},o.prototype._zeroBits=function(b){if(b===0)return 26;var S=b,T=0;return S&8191||(T+=13,S>>>=13),S&127||(T+=7,S>>>=7),S&15||(T+=4,S>>>=4),S&3||(T+=2,S>>>=2),S&1||T++,T},o.prototype.bitLength=function(){var b=this.words[this.length-1],S=this._countBits(b);return(this.length-1)*26+S};function L(p){for(var b=new Array(p.bitLength()),S=0;S<b.length;S++){var T=S/26|0,B=S%26;b[S]=p.words[T]>>>B&1}return b}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var b=0,S=0;S<this.length;S++){var T=this._zeroBits(this.words[S]);if(b+=T,T!==26)break}return b},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(b){return this.negative!==0?this.abs().inotn(b).iaddn(1):this.clone()},o.prototype.fromTwos=function(b){return this.testn(b-1)?this.notn(b).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(b){for(;this.length<b.length;)this.words[this.length++]=0;for(var S=0;S<b.length;S++)this.words[S]=this.words[S]|b.words[S];return this._strip()},o.prototype.ior=function(b){return n((this.negative|b.negative)===0),this.iuor(b)},o.prototype.or=function(b){return this.length>b.length?this.clone().ior(b):b.clone().ior(this)},o.prototype.uor=function(b){return this.length>b.length?this.clone().iuor(b):b.clone().iuor(this)},o.prototype.iuand=function(b){var S;this.length>b.length?S=b:S=this;for(var T=0;T<S.length;T++)this.words[T]=this.words[T]&b.words[T];return this.length=S.length,this._strip()},o.prototype.iand=function(b){return n((this.negative|b.negative)===0),this.iuand(b)},o.prototype.and=function(b){return this.length>b.length?this.clone().iand(b):b.clone().iand(this)},o.prototype.uand=function(b){return this.length>b.length?this.clone().iuand(b):b.clone().iuand(this)},o.prototype.iuxor=function(b){var S,T;this.length>b.length?(S=this,T=b):(S=b,T=this);for(var B=0;B<T.length;B++)this.words[B]=S.words[B]^T.words[B];if(this!==S)for(;B<S.length;B++)this.words[B]=S.words[B];return this.length=S.length,this._strip()},o.prototype.ixor=function(b){return n((this.negative|b.negative)===0),this.iuxor(b)},o.prototype.xor=function(b){return this.length>b.length?this.clone().ixor(b):b.clone().ixor(this)},o.prototype.uxor=function(b){return this.length>b.length?this.clone().iuxor(b):b.clone().iuxor(this)},o.prototype.inotn=function(b){n(typeof b=="number"&&b>=0);var S=Math.ceil(b/26)|0,T=b%26;this._expand(S),T>0&&S--;for(var B=0;B<S;B++)this.words[B]=~this.words[B]&67108863;return T>0&&(this.words[B]=~this.words[B]&67108863>>26-T),this._strip()},o.prototype.notn=function(b){return this.clone().inotn(b)},o.prototype.setn=function(b,S){n(typeof b=="number"&&b>=0);var T=b/26|0,B=b%26;return this._expand(T+1),S?this.words[T]=this.words[T]|1<<B:this.words[T]=this.words[T]&~(1<<B),this._strip()},o.prototype.iadd=function(b){var S;if(this.negative!==0&&b.negative===0)return this.negative=0,S=this.isub(b),this.negative^=1,this._normSign();if(this.negative===0&&b.negative!==0)return b.negative=0,S=this.isub(b),b.negative=1,S._normSign();var T,B;this.length>b.length?(T=this,B=b):(T=b,B=this);for(var $=0,A=0;A<B.length;A++)S=(T.words[A]|0)+(B.words[A]|0)+$,this.words[A]=S&67108863,$=S>>>26;for(;$!==0&&A<T.length;A++)S=(T.words[A]|0)+$,this.words[A]=S&67108863,$=S>>>26;if(this.length=T.length,$!==0)this.words[this.length]=$,this.length++;else if(T!==this)for(;A<T.length;A++)this.words[A]=T.words[A];return this},o.prototype.add=function(b){var S;return b.negative!==0&&this.negative===0?(b.negative=0,S=this.sub(b),b.negative^=1,S):b.negative===0&&this.negative!==0?(this.negative=0,S=b.sub(this),this.negative=1,S):this.length>b.length?this.clone().iadd(b):b.clone().iadd(this)},o.prototype.isub=function(b){if(b.negative!==0){b.negative=0;var S=this.iadd(b);return b.negative=1,S._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(b),this.negative=1,this._normSign();var T=this.cmp(b);if(T===0)return this.negative=0,this.length=1,this.words[0]=0,this;var B,$;T>0?(B=this,$=b):(B=b,$=this);for(var A=0,g=0;g<$.length;g++)S=(B.words[g]|0)-($.words[g]|0)+A,A=S>>26,this.words[g]=S&67108863;for(;A!==0&&g<B.length;g++)S=(B.words[g]|0)+A,A=S>>26,this.words[g]=S&67108863;if(A===0&&g<B.length&&B!==this)for(;g<B.length;g++)this.words[g]=B.words[g];return this.length=Math.max(this.length,g),B!==this&&(this.negative=1),this._strip()},o.prototype.sub=function(b){return this.clone().isub(b)};function N(p,b,S){S.negative=b.negative^p.negative;var T=p.length+b.length|0;S.length=T,T=T-1|0;var B=p.words[0]|0,$=b.words[0]|0,A=B*$,g=A&67108863,k=A/67108864|0;S.words[0]=g;for(var H=1;H<T;H++){for(var z=k>>>26,Q=k&67108863,ie=Math.min(H,b.length-1),ne=Math.max(0,H-p.length+1);ne<=ie;ne++){var Z=H-ne|0;B=p.words[Z]|0,$=b.words[ne]|0,A=B*$+Q,z+=A/67108864|0,Q=A&67108863}S.words[H]=Q|0,k=z|0}return k!==0?S.words[H]=k|0:S.length--,S._strip()}var q=function(b,S,T){var B=b.words,$=S.words,A=T.words,g=0,k,H,z,Q=B[0]|0,ie=Q&8191,ne=Q>>>13,Z=B[1]|0,se=Z&8191,ae=Z>>>13,ce=B[2]|0,le=ce&8191,te=ce>>>13,he=B[3]|0,Ae=he&8191,ge=he>>>13,me=B[4]|0,je=me&8191,we=me>>>13,pe=B[5]|0,Ke=pe&8191,ye=pe>>>13,xe=B[6]|0,Ve=xe&8191,be=xe>>>13,Ee=B[7]|0,Ge=Ee&8191,re=Ee>>>13,Y=B[8]|0,ee=Y&8191,fe=Y>>>13,ue=B[9]|0,ve=ue&8191,de=ue>>>13,Se=$[0]|0,We=Se&8191,_e=Se>>>13,Me=$[1]|0,ze=Me&8191,Te=Me>>>13,$e=$[2]|0,Je=$e&8191,ke=$e>>>13,Oe=$[3]|0,Ze=Oe&8191,Be=Oe>>>13,Le=$[4]|0,Qe=Le&8191,Re=Le>>>13,Ne=$[5]|0,et=Ne&8191,Ce=Ne>>>13,qe=$[6]|0,tt=qe&8191,Ie=qe>>>13,Fe=$[7]|0,rt=Fe&8191,De=Fe>>>13,Ue=$[8]|0,nt=Ue&8191,Pe=Ue>>>13,He=$[9]|0,Xe=He&8191,Ye=He>>>13;T.negative=b.negative^S.negative,T.length=19,k=Math.imul(ie,We),H=Math.imul(ie,_e),H=H+Math.imul(ne,We)|0,z=Math.imul(ne,_e);var it=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(it>>>26)|0,it&=67108863,k=Math.imul(se,We),H=Math.imul(se,_e),H=H+Math.imul(ae,We)|0,z=Math.imul(ae,_e),k=k+Math.imul(ie,ze)|0,H=H+Math.imul(ie,Te)|0,H=H+Math.imul(ne,ze)|0,z=z+Math.imul(ne,Te)|0;var st=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(st>>>26)|0,st&=67108863,k=Math.imul(le,We),H=Math.imul(le,_e),H=H+Math.imul(te,We)|0,z=Math.imul(te,_e),k=k+Math.imul(se,ze)|0,H=H+Math.imul(se,Te)|0,H=H+Math.imul(ae,ze)|0,z=z+Math.imul(ae,Te)|0,k=k+Math.imul(ie,Je)|0,H=H+Math.imul(ie,ke)|0,H=H+Math.imul(ne,Je)|0,z=z+Math.imul(ne,ke)|0;var ot=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(ot>>>26)|0,ot&=67108863,k=Math.imul(Ae,We),H=Math.imul(Ae,_e),H=H+Math.imul(ge,We)|0,z=Math.imul(ge,_e),k=k+Math.imul(le,ze)|0,H=H+Math.imul(le,Te)|0,H=H+Math.imul(te,ze)|0,z=z+Math.imul(te,Te)|0,k=k+Math.imul(se,Je)|0,H=H+Math.imul(se,ke)|0,H=H+Math.imul(ae,Je)|0,z=z+Math.imul(ae,ke)|0,k=k+Math.imul(ie,Ze)|0,H=H+Math.imul(ie,Be)|0,H=H+Math.imul(ne,Ze)|0,z=z+Math.imul(ne,Be)|0;var at=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(at>>>26)|0,at&=67108863,k=Math.imul(je,We),H=Math.imul(je,_e),H=H+Math.imul(we,We)|0,z=Math.imul(we,_e),k=k+Math.imul(Ae,ze)|0,H=H+Math.imul(Ae,Te)|0,H=H+Math.imul(ge,ze)|0,z=z+Math.imul(ge,Te)|0,k=k+Math.imul(le,Je)|0,H=H+Math.imul(le,ke)|0,H=H+Math.imul(te,Je)|0,z=z+Math.imul(te,ke)|0,k=k+Math.imul(se,Ze)|0,H=H+Math.imul(se,Be)|0,H=H+Math.imul(ae,Ze)|0,z=z+Math.imul(ae,Be)|0,k=k+Math.imul(ie,Qe)|0,H=H+Math.imul(ie,Re)|0,H=H+Math.imul(ne,Qe)|0,z=z+Math.imul(ne,Re)|0;var ft=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(ft>>>26)|0,ft&=67108863,k=Math.imul(Ke,We),H=Math.imul(Ke,_e),H=H+Math.imul(ye,We)|0,z=Math.imul(ye,_e),k=k+Math.imul(je,ze)|0,H=H+Math.imul(je,Te)|0,H=H+Math.imul(we,ze)|0,z=z+Math.imul(we,Te)|0,k=k+Math.imul(Ae,Je)|0,H=H+Math.imul(Ae,ke)|0,H=H+Math.imul(ge,Je)|0,z=z+Math.imul(ge,ke)|0,k=k+Math.imul(le,Ze)|0,H=H+Math.imul(le,Be)|0,H=H+Math.imul(te,Ze)|0,z=z+Math.imul(te,Be)|0,k=k+Math.imul(se,Qe)|0,H=H+Math.imul(se,Re)|0,H=H+Math.imul(ae,Qe)|0,z=z+Math.imul(ae,Re)|0,k=k+Math.imul(ie,et)|0,H=H+Math.imul(ie,Ce)|0,H=H+Math.imul(ne,et)|0,z=z+Math.imul(ne,Ce)|0;var lt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(lt>>>26)|0,lt&=67108863,k=Math.imul(Ve,We),H=Math.imul(Ve,_e),H=H+Math.imul(be,We)|0,z=Math.imul(be,_e),k=k+Math.imul(Ke,ze)|0,H=H+Math.imul(Ke,Te)|0,H=H+Math.imul(ye,ze)|0,z=z+Math.imul(ye,Te)|0,k=k+Math.imul(je,Je)|0,H=H+Math.imul(je,ke)|0,H=H+Math.imul(we,Je)|0,z=z+Math.imul(we,ke)|0,k=k+Math.imul(Ae,Ze)|0,H=H+Math.imul(Ae,Be)|0,H=H+Math.imul(ge,Ze)|0,z=z+Math.imul(ge,Be)|0,k=k+Math.imul(le,Qe)|0,H=H+Math.imul(le,Re)|0,H=H+Math.imul(te,Qe)|0,z=z+Math.imul(te,Re)|0,k=k+Math.imul(se,et)|0,H=H+Math.imul(se,Ce)|0,H=H+Math.imul(ae,et)|0,z=z+Math.imul(ae,Ce)|0,k=k+Math.imul(ie,tt)|0,H=H+Math.imul(ie,Ie)|0,H=H+Math.imul(ne,tt)|0,z=z+Math.imul(ne,Ie)|0;var ct=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(ct>>>26)|0,ct&=67108863,k=Math.imul(Ge,We),H=Math.imul(Ge,_e),H=H+Math.imul(re,We)|0,z=Math.imul(re,_e),k=k+Math.imul(Ve,ze)|0,H=H+Math.imul(Ve,Te)|0,H=H+Math.imul(be,ze)|0,z=z+Math.imul(be,Te)|0,k=k+Math.imul(Ke,Je)|0,H=H+Math.imul(Ke,ke)|0,H=H+Math.imul(ye,Je)|0,z=z+Math.imul(ye,ke)|0,k=k+Math.imul(je,Ze)|0,H=H+Math.imul(je,Be)|0,H=H+Math.imul(we,Ze)|0,z=z+Math.imul(we,Be)|0,k=k+Math.imul(Ae,Qe)|0,H=H+Math.imul(Ae,Re)|0,H=H+Math.imul(ge,Qe)|0,z=z+Math.imul(ge,Re)|0,k=k+Math.imul(le,et)|0,H=H+Math.imul(le,Ce)|0,H=H+Math.imul(te,et)|0,z=z+Math.imul(te,Ce)|0,k=k+Math.imul(se,tt)|0,H=H+Math.imul(se,Ie)|0,H=H+Math.imul(ae,tt)|0,z=z+Math.imul(ae,Ie)|0,k=k+Math.imul(ie,rt)|0,H=H+Math.imul(ie,De)|0,H=H+Math.imul(ne,rt)|0,z=z+Math.imul(ne,De)|0;var ht=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(ht>>>26)|0,ht&=67108863,k=Math.imul(ee,We),H=Math.imul(ee,_e),H=H+Math.imul(fe,We)|0,z=Math.imul(fe,_e),k=k+Math.imul(Ge,ze)|0,H=H+Math.imul(Ge,Te)|0,H=H+Math.imul(re,ze)|0,z=z+Math.imul(re,Te)|0,k=k+Math.imul(Ve,Je)|0,H=H+Math.imul(Ve,ke)|0,H=H+Math.imul(be,Je)|0,z=z+Math.imul(be,ke)|0,k=k+Math.imul(Ke,Ze)|0,H=H+Math.imul(Ke,Be)|0,H=H+Math.imul(ye,Ze)|0,z=z+Math.imul(ye,Be)|0,k=k+Math.imul(je,Qe)|0,H=H+Math.imul(je,Re)|0,H=H+Math.imul(we,Qe)|0,z=z+Math.imul(we,Re)|0,k=k+Math.imul(Ae,et)|0,H=H+Math.imul(Ae,Ce)|0,H=H+Math.imul(ge,et)|0,z=z+Math.imul(ge,Ce)|0,k=k+Math.imul(le,tt)|0,H=H+Math.imul(le,Ie)|0,H=H+Math.imul(te,tt)|0,z=z+Math.imul(te,Ie)|0,k=k+Math.imul(se,rt)|0,H=H+Math.imul(se,De)|0,H=H+Math.imul(ae,rt)|0,z=z+Math.imul(ae,De)|0,k=k+Math.imul(ie,nt)|0,H=H+Math.imul(ie,Pe)|0,H=H+Math.imul(ne,nt)|0,z=z+Math.imul(ne,Pe)|0;var dt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(dt>>>26)|0,dt&=67108863,k=Math.imul(ve,We),H=Math.imul(ve,_e),H=H+Math.imul(de,We)|0,z=Math.imul(de,_e),k=k+Math.imul(ee,ze)|0,H=H+Math.imul(ee,Te)|0,H=H+Math.imul(fe,ze)|0,z=z+Math.imul(fe,Te)|0,k=k+Math.imul(Ge,Je)|0,H=H+Math.imul(Ge,ke)|0,H=H+Math.imul(re,Je)|0,z=z+Math.imul(re,ke)|0,k=k+Math.imul(Ve,Ze)|0,H=H+Math.imul(Ve,Be)|0,H=H+Math.imul(be,Ze)|0,z=z+Math.imul(be,Be)|0,k=k+Math.imul(Ke,Qe)|0,H=H+Math.imul(Ke,Re)|0,H=H+Math.imul(ye,Qe)|0,z=z+Math.imul(ye,Re)|0,k=k+Math.imul(je,et)|0,H=H+Math.imul(je,Ce)|0,H=H+Math.imul(we,et)|0,z=z+Math.imul(we,Ce)|0,k=k+Math.imul(Ae,tt)|0,H=H+Math.imul(Ae,Ie)|0,H=H+Math.imul(ge,tt)|0,z=z+Math.imul(ge,Ie)|0,k=k+Math.imul(le,rt)|0,H=H+Math.imul(le,De)|0,H=H+Math.imul(te,rt)|0,z=z+Math.imul(te,De)|0,k=k+Math.imul(se,nt)|0,H=H+Math.imul(se,Pe)|0,H=H+Math.imul(ae,nt)|0,z=z+Math.imul(ae,Pe)|0,k=k+Math.imul(ie,Xe)|0,H=H+Math.imul(ie,Ye)|0,H=H+Math.imul(ne,Xe)|0,z=z+Math.imul(ne,Ye)|0;var pt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(pt>>>26)|0,pt&=67108863,k=Math.imul(ve,ze),H=Math.imul(ve,Te),H=H+Math.imul(de,ze)|0,z=Math.imul(de,Te),k=k+Math.imul(ee,Je)|0,H=H+Math.imul(ee,ke)|0,H=H+Math.imul(fe,Je)|0,z=z+Math.imul(fe,ke)|0,k=k+Math.imul(Ge,Ze)|0,H=H+Math.imul(Ge,Be)|0,H=H+Math.imul(re,Ze)|0,z=z+Math.imul(re,Be)|0,k=k+Math.imul(Ve,Qe)|0,H=H+Math.imul(Ve,Re)|0,H=H+Math.imul(be,Qe)|0,z=z+Math.imul(be,Re)|0,k=k+Math.imul(Ke,et)|0,H=H+Math.imul(Ke,Ce)|0,H=H+Math.imul(ye,et)|0,z=z+Math.imul(ye,Ce)|0,k=k+Math.imul(je,tt)|0,H=H+Math.imul(je,Ie)|0,H=H+Math.imul(we,tt)|0,z=z+Math.imul(we,Ie)|0,k=k+Math.imul(Ae,rt)|0,H=H+Math.imul(Ae,De)|0,H=H+Math.imul(ge,rt)|0,z=z+Math.imul(ge,De)|0,k=k+Math.imul(le,nt)|0,H=H+Math.imul(le,Pe)|0,H=H+Math.imul(te,nt)|0,z=z+Math.imul(te,Pe)|0,k=k+Math.imul(se,Xe)|0,H=H+Math.imul(se,Ye)|0,H=H+Math.imul(ae,Xe)|0,z=z+Math.imul(ae,Ye)|0;var gt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(gt>>>26)|0,gt&=67108863,k=Math.imul(ve,Je),H=Math.imul(ve,ke),H=H+Math.imul(de,Je)|0,z=Math.imul(de,ke),k=k+Math.imul(ee,Ze)|0,H=H+Math.imul(ee,Be)|0,H=H+Math.imul(fe,Ze)|0,z=z+Math.imul(fe,Be)|0,k=k+Math.imul(Ge,Qe)|0,H=H+Math.imul(Ge,Re)|0,H=H+Math.imul(re,Qe)|0,z=z+Math.imul(re,Re)|0,k=k+Math.imul(Ve,et)|0,H=H+Math.imul(Ve,Ce)|0,H=H+Math.imul(be,et)|0,z=z+Math.imul(be,Ce)|0,k=k+Math.imul(Ke,tt)|0,H=H+Math.imul(Ke,Ie)|0,H=H+Math.imul(ye,tt)|0,z=z+Math.imul(ye,Ie)|0,k=k+Math.imul(je,rt)|0,H=H+Math.imul(je,De)|0,H=H+Math.imul(we,rt)|0,z=z+Math.imul(we,De)|0,k=k+Math.imul(Ae,nt)|0,H=H+Math.imul(Ae,Pe)|0,H=H+Math.imul(ge,nt)|0,z=z+Math.imul(ge,Pe)|0,k=k+Math.imul(le,Xe)|0,H=H+Math.imul(le,Ye)|0,H=H+Math.imul(te,Xe)|0,z=z+Math.imul(te,Ye)|0;var mt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(mt>>>26)|0,mt&=67108863,k=Math.imul(ve,Ze),H=Math.imul(ve,Be),H=H+Math.imul(de,Ze)|0,z=Math.imul(de,Be),k=k+Math.imul(ee,Qe)|0,H=H+Math.imul(ee,Re)|0,H=H+Math.imul(fe,Qe)|0,z=z+Math.imul(fe,Re)|0,k=k+Math.imul(Ge,et)|0,H=H+Math.imul(Ge,Ce)|0,H=H+Math.imul(re,et)|0,z=z+Math.imul(re,Ce)|0,k=k+Math.imul(Ve,tt)|0,H=H+Math.imul(Ve,Ie)|0,H=H+Math.imul(be,tt)|0,z=z+Math.imul(be,Ie)|0,k=k+Math.imul(Ke,rt)|0,H=H+Math.imul(Ke,De)|0,H=H+Math.imul(ye,rt)|0,z=z+Math.imul(ye,De)|0,k=k+Math.imul(je,nt)|0,H=H+Math.imul(je,Pe)|0,H=H+Math.imul(we,nt)|0,z=z+Math.imul(we,Pe)|0,k=k+Math.imul(Ae,Xe)|0,H=H+Math.imul(Ae,Ye)|0,H=H+Math.imul(ge,Xe)|0,z=z+Math.imul(ge,Ye)|0;var yt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(yt>>>26)|0,yt&=67108863,k=Math.imul(ve,Qe),H=Math.imul(ve,Re),H=H+Math.imul(de,Qe)|0,z=Math.imul(de,Re),k=k+Math.imul(ee,et)|0,H=H+Math.imul(ee,Ce)|0,H=H+Math.imul(fe,et)|0,z=z+Math.imul(fe,Ce)|0,k=k+Math.imul(Ge,tt)|0,H=H+Math.imul(Ge,Ie)|0,H=H+Math.imul(re,tt)|0,z=z+Math.imul(re,Ie)|0,k=k+Math.imul(Ve,rt)|0,H=H+Math.imul(Ve,De)|0,H=H+Math.imul(be,rt)|0,z=z+Math.imul(be,De)|0,k=k+Math.imul(Ke,nt)|0,H=H+Math.imul(Ke,Pe)|0,H=H+Math.imul(ye,nt)|0,z=z+Math.imul(ye,Pe)|0,k=k+Math.imul(je,Xe)|0,H=H+Math.imul(je,Ye)|0,H=H+Math.imul(we,Xe)|0,z=z+Math.imul(we,Ye)|0;var vt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(vt>>>26)|0,vt&=67108863,k=Math.imul(ve,et),H=Math.imul(ve,Ce),H=H+Math.imul(de,et)|0,z=Math.imul(de,Ce),k=k+Math.imul(ee,tt)|0,H=H+Math.imul(ee,Ie)|0,H=H+Math.imul(fe,tt)|0,z=z+Math.imul(fe,Ie)|0,k=k+Math.imul(Ge,rt)|0,H=H+Math.imul(Ge,De)|0,H=H+Math.imul(re,rt)|0,z=z+Math.imul(re,De)|0,k=k+Math.imul(Ve,nt)|0,H=H+Math.imul(Ve,Pe)|0,H=H+Math.imul(be,nt)|0,z=z+Math.imul(be,Pe)|0,k=k+Math.imul(Ke,Xe)|0,H=H+Math.imul(Ke,Ye)|0,H=H+Math.imul(ye,Xe)|0,z=z+Math.imul(ye,Ye)|0;var bt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(bt>>>26)|0,bt&=67108863,k=Math.imul(ve,tt),H=Math.imul(ve,Ie),H=H+Math.imul(de,tt)|0,z=Math.imul(de,Ie),k=k+Math.imul(ee,rt)|0,H=H+Math.imul(ee,De)|0,H=H+Math.imul(fe,rt)|0,z=z+Math.imul(fe,De)|0,k=k+Math.imul(Ge,nt)|0,H=H+Math.imul(Ge,Pe)|0,H=H+Math.imul(re,nt)|0,z=z+Math.imul(re,Pe)|0,k=k+Math.imul(Ve,Xe)|0,H=H+Math.imul(Ve,Ye)|0,H=H+Math.imul(be,Xe)|0,z=z+Math.imul(be,Ye)|0;var wt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(wt>>>26)|0,wt&=67108863,k=Math.imul(ve,rt),H=Math.imul(ve,De),H=H+Math.imul(de,rt)|0,z=Math.imul(de,De),k=k+Math.imul(ee,nt)|0,H=H+Math.imul(ee,Pe)|0,H=H+Math.imul(fe,nt)|0,z=z+Math.imul(fe,Pe)|0,k=k+Math.imul(Ge,Xe)|0,H=H+Math.imul(Ge,Ye)|0,H=H+Math.imul(re,Xe)|0,z=z+Math.imul(re,Ye)|0;var _t=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(_t>>>26)|0,_t&=67108863,k=Math.imul(ve,nt),H=Math.imul(ve,Pe),H=H+Math.imul(de,nt)|0,z=Math.imul(de,Pe),k=k+Math.imul(ee,Xe)|0,H=H+Math.imul(ee,Ye)|0,H=H+Math.imul(fe,Xe)|0,z=z+Math.imul(fe,Ye)|0;var xt=(g+k|0)+((H&8191)<<13)|0;g=(z+(H>>>13)|0)+(xt>>>26)|0,xt&=67108863,k=Math.imul(ve,Xe),H=Math.imul(ve,Ye),H=H+Math.imul(de,Xe)|0,z=Math.imul(de,Ye);var St=(g+k|0)+((H&8191)<<13)|0;return g=(z+(H>>>13)|0)+(St>>>26)|0,St&=67108863,A[0]=it,A[1]=st,A[2]=ot,A[3]=at,A[4]=ft,A[5]=lt,A[6]=ct,A[7]=ht,A[8]=dt,A[9]=pt,A[10]=gt,A[11]=mt,A[12]=yt,A[13]=vt,A[14]=bt,A[15]=wt,A[16]=_t,A[17]=xt,A[18]=St,g!==0&&(A[19]=g,T.length++),T};Math.imul||(q=N);function F(p,b,S){S.negative=b.negative^p.negative,S.length=p.length+b.length;for(var T=0,B=0,$=0;$<S.length-1;$++){var A=B;B=0;for(var g=T&67108863,k=Math.min($,b.length-1),H=Math.max(0,$-p.length+1);H<=k;H++){var z=$-H,Q=p.words[z]|0,ie=b.words[H]|0,ne=Q*ie,Z=ne&67108863;A=A+(ne/67108864|0)|0,Z=Z+g|0,g=Z&67108863,A=A+(Z>>>26)|0,B+=A>>>26,A&=67108863}S.words[$]=g,T=A,A=B}return T!==0?S.words[$]=T:S.length--,S._strip()}function U(p,b,S){return F(p,b,S)}o.prototype.mulTo=function(b,S){var T,B=this.length+b.length;return this.length===10&&b.length===10?T=q(this,b,S):B<63?T=N(this,b,S):B<1024?T=F(this,b,S):T=U(this,b,S),T},o.prototype.mul=function(b){var S=new o(null);return S.words=new Array(this.length+b.length),this.mulTo(b,S)},o.prototype.mulf=function(b){var S=new o(null);return S.words=new Array(this.length+b.length),U(this,b,S)},o.prototype.imul=function(b){return this.clone().mulTo(b,this)},o.prototype.imuln=function(b){var S=b<0;S&&(b=-b),n(typeof b=="number"),n(b<67108864);for(var T=0,B=0;B<this.length;B++){var $=(this.words[B]|0)*b,A=($&67108863)+(T&67108863);T>>=26,T+=$/67108864|0,T+=A>>>26,this.words[B]=A&67108863}return T!==0&&(this.words[B]=T,this.length++),S?this.ineg():this},o.prototype.muln=function(b){return this.clone().imuln(b)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(b){var S=L(b);if(S.length===0)return new o(1);for(var T=this,B=0;B<S.length&&S[B]===0;B++,T=T.sqr());if(++B<S.length)for(var $=T.sqr();B<S.length;B++,$=$.sqr())S[B]!==0&&(T=T.mul($));return T},o.prototype.iushln=function(b){n(typeof b=="number"&&b>=0);var S=b%26,T=(b-S)/26,B=67108863>>>26-S<<26-S,$;if(S!==0){var A=0;for($=0;$<this.length;$++){var g=this.words[$]&B,k=(this.words[$]|0)-g<<S;this.words[$]=k|A,A=g>>>26-S}A&&(this.words[$]=A,this.length++)}if(T!==0){for($=this.length-1;$>=0;$--)this.words[$+T]=this.words[$];for($=0;$<T;$++)this.words[$]=0;this.length+=T}return this._strip()},o.prototype.ishln=function(b){return n(this.negative===0),this.iushln(b)},o.prototype.iushrn=function(b,S,T){n(typeof b=="number"&&b>=0);var B;S?B=(S-S%26)/26:B=0;var $=b%26,A=Math.min((b-$)/26,this.length),g=67108863^67108863>>>$<<$,k=T;if(B-=A,B=Math.max(0,B),k){for(var H=0;H<A;H++)k.words[H]=this.words[H];k.length=A}if(A!==0)if(this.length>A)for(this.length-=A,H=0;H<this.length;H++)this.words[H]=this.words[H+A];else this.words[0]=0,this.length=1;var z=0;for(H=this.length-1;H>=0&&(z!==0||H>=B);H--){var Q=this.words[H]|0;this.words[H]=z<<26-$|Q>>>$,z=Q&g}return k&&z!==0&&(k.words[k.length++]=z),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},o.prototype.ishrn=function(b,S,T){return n(this.negative===0),this.iushrn(b,S,T)},o.prototype.shln=function(b){return this.clone().ishln(b)},o.prototype.ushln=function(b){return this.clone().iushln(b)},o.prototype.shrn=function(b){return this.clone().ishrn(b)},o.prototype.ushrn=function(b){return this.clone().iushrn(b)},o.prototype.testn=function(b){n(typeof b=="number"&&b>=0);var S=b%26,T=(b-S)/26,B=1<<S;if(this.length<=T)return!1;var $=this.words[T];return!!($&B)},o.prototype.imaskn=function(b){n(typeof b=="number"&&b>=0);var S=b%26,T=(b-S)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=T)return this;if(S!==0&&T++,this.length=Math.min(T,this.length),S!==0){var B=67108863^67108863>>>S<<S;this.words[this.length-1]&=B}return this._strip()},o.prototype.maskn=function(b){return this.clone().imaskn(b)},o.prototype.iaddn=function(b){return n(typeof b=="number"),n(b<67108864),b<0?this.isubn(-b):this.negative!==0?this.length===1&&(this.words[0]|0)<=b?(this.words[0]=b-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(b),this.negative=1,this):this._iaddn(b)},o.prototype._iaddn=function(b){this.words[0]+=b;for(var S=0;S<this.length&&this.words[S]>=67108864;S++)this.words[S]-=67108864,S===this.length-1?this.words[S+1]=1:this.words[S+1]++;return this.length=Math.max(this.length,S+1),this},o.prototype.isubn=function(b){if(n(typeof b=="number"),n(b<67108864),b<0)return this.iaddn(-b);if(this.negative!==0)return this.negative=0,this.iaddn(b),this.negative=1,this;if(this.words[0]-=b,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var S=0;S<this.length&&this.words[S]<0;S++)this.words[S]+=67108864,this.words[S+1]-=1;return this._strip()},o.prototype.addn=function(b){return this.clone().iaddn(b)},o.prototype.subn=function(b){return this.clone().isubn(b)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(b,S,T){var B=b.length+T,$;this._expand(B);var A,g=0;for($=0;$<b.length;$++){A=(this.words[$+T]|0)+g;var k=(b.words[$]|0)*S;A-=k&67108863,g=(A>>26)-(k/67108864|0),this.words[$+T]=A&67108863}for(;$<this.length-T;$++)A=(this.words[$+T]|0)+g,g=A>>26,this.words[$+T]=A&67108863;if(g===0)return this._strip();for(n(g===-1),g=0,$=0;$<this.length;$++)A=-(this.words[$]|0)+g,g=A>>26,this.words[$]=A&67108863;return this.negative=1,this._strip()},o.prototype._wordDiv=function(b,S){var T=this.length-b.length,B=this.clone(),$=b,A=$.words[$.length-1]|0,g=this._countBits(A);T=26-g,T!==0&&($=$.ushln(T),B.iushln(T),A=$.words[$.length-1]|0);var k=B.length-$.length,H;if(S!=="mod"){H=new o(null),H.length=k+1,H.words=new Array(H.length);for(var z=0;z<H.length;z++)H.words[z]=0}var Q=B.clone()._ishlnsubmul($,1,k);Q.negative===0&&(B=Q,H&&(H.words[k]=1));for(var ie=k-1;ie>=0;ie--){var ne=(B.words[$.length+ie]|0)*67108864+(B.words[$.length+ie-1]|0);for(ne=Math.min(ne/A|0,67108863),B._ishlnsubmul($,ne,ie);B.negative!==0;)ne--,B.negative=0,B._ishlnsubmul($,1,ie),B.isZero()||(B.negative^=1);H&&(H.words[ie]=ne)}return H&&H._strip(),B._strip(),S!=="div"&&T!==0&&B.iushrn(T),{div:H||null,mod:B}},o.prototype.divmod=function(b,S,T){if(n(!b.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var B,$,A;return this.negative!==0&&b.negative===0?(A=this.neg().divmod(b,S),S!=="mod"&&(B=A.div.neg()),S!=="div"&&($=A.mod.neg(),T&&$.negative!==0&&$.iadd(b)),{div:B,mod:$}):this.negative===0&&b.negative!==0?(A=this.divmod(b.neg(),S),S!=="mod"&&(B=A.div.neg()),{div:B,mod:A.mod}):this.negative&b.negative?(A=this.neg().divmod(b.neg(),S),S!=="div"&&($=A.mod.neg(),T&&$.negative!==0&&$.isub(b)),{div:A.div,mod:$}):b.length>this.length||this.cmp(b)<0?{div:new o(0),mod:this}:b.length===1?S==="div"?{div:this.divn(b.words[0]),mod:null}:S==="mod"?{div:null,mod:new o(this.modrn(b.words[0]))}:{div:this.divn(b.words[0]),mod:new o(this.modrn(b.words[0]))}:this._wordDiv(b,S)},o.prototype.div=function(b){return this.divmod(b,"div",!1).div},o.prototype.mod=function(b){return this.divmod(b,"mod",!1).mod},o.prototype.umod=function(b){return this.divmod(b,"mod",!0).mod},o.prototype.divRound=function(b){var S=this.divmod(b);if(S.mod.isZero())return S.div;var T=S.div.negative!==0?S.mod.isub(b):S.mod,B=b.ushrn(1),$=b.andln(1),A=T.cmp(B);return A<0||$===1&&A===0?S.div:S.div.negative!==0?S.div.isubn(1):S.div.iaddn(1)},o.prototype.modrn=function(b){var S=b<0;S&&(b=-b),n(b<=67108863);for(var T=(1<<26)%b,B=0,$=this.length-1;$>=0;$--)B=(T*B+(this.words[$]|0))%b;return S?-B:B},o.prototype.modn=function(b){return this.modrn(b)},o.prototype.idivn=function(b){var S=b<0;S&&(b=-b),n(b<=67108863);for(var T=0,B=this.length-1;B>=0;B--){var $=(this.words[B]|0)+T*67108864;this.words[B]=$/b|0,T=$%b}return this._strip(),S?this.ineg():this},o.prototype.divn=function(b){return this.clone().idivn(b)},o.prototype.egcd=function(b){n(b.negative===0),n(!b.isZero());var S=this,T=b.clone();S.negative!==0?S=S.umod(b):S=S.clone();for(var B=new o(1),$=new o(0),A=new o(0),g=new o(1),k=0;S.isEven()&&T.isEven();)S.iushrn(1),T.iushrn(1),++k;for(var H=T.clone(),z=S.clone();!S.isZero();){for(var Q=0,ie=1;!(S.words[0]&ie)&&Q<26;++Q,ie<<=1);if(Q>0)for(S.iushrn(Q);Q-- >0;)(B.isOdd()||$.isOdd())&&(B.iadd(H),$.isub(z)),B.iushrn(1),$.iushrn(1);for(var ne=0,Z=1;!(T.words[0]&Z)&&ne<26;++ne,Z<<=1);if(ne>0)for(T.iushrn(ne);ne-- >0;)(A.isOdd()||g.isOdd())&&(A.iadd(H),g.isub(z)),A.iushrn(1),g.iushrn(1);S.cmp(T)>=0?(S.isub(T),B.isub(A),$.isub(g)):(T.isub(S),A.isub(B),g.isub($))}return{a:A,b:g,gcd:T.iushln(k)}},o.prototype._invmp=function(b){n(b.negative===0),n(!b.isZero());var S=this,T=b.clone();S.negative!==0?S=S.umod(b):S=S.clone();for(var B=new o(1),$=new o(0),A=T.clone();S.cmpn(1)>0&&T.cmpn(1)>0;){for(var g=0,k=1;!(S.words[0]&k)&&g<26;++g,k<<=1);if(g>0)for(S.iushrn(g);g-- >0;)B.isOdd()&&B.iadd(A),B.iushrn(1);for(var H=0,z=1;!(T.words[0]&z)&&H<26;++H,z<<=1);if(H>0)for(T.iushrn(H);H-- >0;)$.isOdd()&&$.iadd(A),$.iushrn(1);S.cmp(T)>=0?(S.isub(T),B.isub($)):(T.isub(S),$.isub(B))}var Q;return S.cmpn(1)===0?Q=B:Q=$,Q.cmpn(0)<0&&Q.iadd(b),Q},o.prototype.gcd=function(b){if(this.isZero())return b.abs();if(b.isZero())return this.abs();var S=this.clone(),T=b.clone();S.negative=0,T.negative=0;for(var B=0;S.isEven()&&T.isEven();B++)S.iushrn(1),T.iushrn(1);do{for(;S.isEven();)S.iushrn(1);for(;T.isEven();)T.iushrn(1);var $=S.cmp(T);if($<0){var A=S;S=T,T=A}else if($===0||T.cmpn(1)===0)break;S.isub(T)}while(!0);return T.iushln(B)},o.prototype.invm=function(b){return this.egcd(b).a.umod(b)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(b){return this.words[0]&b},o.prototype.bincn=function(b){n(typeof b=="number");var S=b%26,T=(b-S)/26,B=1<<S;if(this.length<=T)return this._expand(T+1),this.words[T]|=B,this;for(var $=B,A=T;$!==0&&A<this.length;A++){var g=this.words[A]|0;g+=$,$=g>>>26,g&=67108863,this.words[A]=g}return $!==0&&(this.words[A]=$,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(b){var S=b<0;if(this.negative!==0&&!S)return-1;if(this.negative===0&&S)return 1;this._strip();var T;if(this.length>1)T=1;else{S&&(b=-b),n(b<=67108863,"Number is too big");var B=this.words[0]|0;T=B===b?0:B<b?-1:1}return this.negative!==0?-T|0:T},o.prototype.cmp=function(b){if(this.negative!==0&&b.negative===0)return-1;if(this.negative===0&&b.negative!==0)return 1;var S=this.ucmp(b);return this.negative!==0?-S|0:S},o.prototype.ucmp=function(b){if(this.length>b.length)return 1;if(this.length<b.length)return-1;for(var S=0,T=this.length-1;T>=0;T--){var B=this.words[T]|0,$=b.words[T]|0;if(B!==$){B<$?S=-1:B>$&&(S=1);break}}return S},o.prototype.gtn=function(b){return this.cmpn(b)===1},o.prototype.gt=function(b){return this.cmp(b)===1},o.prototype.gten=function(b){return this.cmpn(b)>=0},o.prototype.gte=function(b){return this.cmp(b)>=0},o.prototype.ltn=function(b){return this.cmpn(b)===-1},o.prototype.lt=function(b){return this.cmp(b)===-1},o.prototype.lten=function(b){return this.cmpn(b)<=0},o.prototype.lte=function(b){return this.cmp(b)<=0},o.prototype.eqn=function(b){return this.cmpn(b)===0},o.prototype.eq=function(b){return this.cmp(b)===0},o.red=function(b){return new O(b)},o.prototype.toRed=function(b){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),b.convertTo(this)._forceRed(b)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(b){return this.red=b,this},o.prototype.forceRed=function(b){return n(!this.red,"Already a number in reduction context"),this._forceRed(b)},o.prototype.redAdd=function(b){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,b)},o.prototype.redIAdd=function(b){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,b)},o.prototype.redSub=function(b){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,b)},o.prototype.redISub=function(b){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,b)},o.prototype.redShl=function(b){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,b)},o.prototype.redMul=function(b){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,b),this.red.mul(this,b)},o.prototype.redIMul=function(b){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,b),this.red.imul(this,b)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(b){return n(this.red&&!b.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,b)};var j={k256:null,p224:null,p192:null,p25519:null};function W(p,b){this.name=p,this.p=new o(b,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}W.prototype._tmp=function(){var b=new o(null);return b.words=new Array(Math.ceil(this.n/13)),b},W.prototype.ireduce=function(b){var S=b,T;do this.split(S,this.tmp),S=this.imulK(S),S=S.iadd(this.tmp),T=S.bitLength();while(T>this.n);var B=T<this.n?-1:S.ucmp(this.p);return B===0?(S.words[0]=0,S.length=1):B>0?S.isub(this.p):S.strip!==void 0?S.strip():S._strip(),S},W.prototype.split=function(b,S){b.iushrn(this.n,0,S)},W.prototype.imulK=function(b){return b.imul(this.k)};function X(){W.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(X,W),X.prototype.split=function(b,S){for(var T=4194303,B=Math.min(b.length,9),$=0;$<B;$++)S.words[$]=b.words[$];if(S.length=B,b.length<=9){b.words[0]=0,b.length=1;return}var A=b.words[9];for(S.words[S.length++]=A&T,$=10;$<b.length;$++){var g=b.words[$]|0;b.words[$-10]=(g&T)<<4|A>>>22,A=g}A>>>=22,b.words[$-10]=A,A===0&&b.length>10?b.length-=10:b.length-=9},X.prototype.imulK=function(b){b.words[b.length]=0,b.words[b.length+1]=0,b.length+=2;for(var S=0,T=0;T<b.length;T++){var B=b.words[T]|0;S+=B*977,b.words[T]=S&67108863,S=B*64+(S/67108864|0)}return b.words[b.length-1]===0&&(b.length--,b.words[b.length-1]===0&&b.length--),b};function J(){W.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(J,W);function G(){W.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(G,W);function oe(){W.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(oe,W),oe.prototype.imulK=function(b){for(var S=0,T=0;T<b.length;T++){var B=(b.words[T]|0)*19+S,$=B&67108863;B>>>=26,b.words[T]=$,S=B}return S!==0&&(b.words[b.length++]=S),b},o._prime=function(b){if(j[b])return j[b];var S;if(b==="k256")S=new X;else if(b==="p224")S=new J;else if(b==="p192")S=new G;else if(b==="p25519")S=new oe;else throw new Error("Unknown prime "+b);return j[b]=S,S};function O(p){if(typeof p=="string"){var b=o._prime(p);this.m=b.p,this.prime=b}else n(p.gtn(1),"modulus must be greater than 1"),this.m=p,this.prime=null}O.prototype._verify1=function(b){n(b.negative===0,"red works only with positives"),n(b.red,"red works only with red numbers")},O.prototype._verify2=function(b,S){n((b.negative|S.negative)===0,"red works only with positives"),n(b.red&&b.red===S.red,"red works only with red numbers")},O.prototype.imod=function(b){return this.prime?this.prime.ireduce(b)._forceRed(this):(x(b,b.umod(this.m)._forceRed(this)),b)},O.prototype.neg=function(b){return b.isZero()?b.clone():this.m.sub(b)._forceRed(this)},O.prototype.add=function(b,S){this._verify2(b,S);var T=b.add(S);return T.cmp(this.m)>=0&&T.isub(this.m),T._forceRed(this)},O.prototype.iadd=function(b,S){this._verify2(b,S);var T=b.iadd(S);return T.cmp(this.m)>=0&&T.isub(this.m),T},O.prototype.sub=function(b,S){this._verify2(b,S);var T=b.sub(S);return T.cmpn(0)<0&&T.iadd(this.m),T._forceRed(this)},O.prototype.isub=function(b,S){this._verify2(b,S);var T=b.isub(S);return T.cmpn(0)<0&&T.iadd(this.m),T},O.prototype.shl=function(b,S){return this._verify1(b),this.imod(b.ushln(S))},O.prototype.imul=function(b,S){return this._verify2(b,S),this.imod(b.imul(S))},O.prototype.mul=function(b,S){return this._verify2(b,S),this.imod(b.mul(S))},O.prototype.isqr=function(b){return this.imul(b,b.clone())},O.prototype.sqr=function(b){return this.mul(b,b)},O.prototype.sqrt=function(b){if(b.isZero())return b.clone();var S=this.m.andln(3);if(n(S%2===1),S===3){var T=this.m.add(new o(1)).iushrn(2);return this.pow(b,T)}for(var B=this.m.subn(1),$=0;!B.isZero()&&B.andln(1)===0;)$++,B.iushrn(1);n(!B.isZero());var A=new o(1).toRed(this),g=A.redNeg(),k=this.m.subn(1).iushrn(1),H=this.m.bitLength();for(H=new o(2*H*H).toRed(this);this.pow(H,k).cmp(g)!==0;)H.redIAdd(g);for(var z=this.pow(H,B),Q=this.pow(b,B.addn(1).iushrn(1)),ie=this.pow(b,B),ne=$;ie.cmp(A)!==0;){for(var Z=ie,se=0;Z.cmp(A)!==0;se++)Z=Z.redSqr();n(se<ne);var ae=this.pow(z,new o(1).iushln(ne-se-1));Q=Q.redMul(ae),z=ae.redSqr(),ie=ie.redMul(z),ne=se}return Q},O.prototype.invm=function(b){var S=b._invmp(this.m);return S.negative!==0?(S.negative=0,this.imod(S).redNeg()):this.imod(S)},O.prototype.pow=function(b,S){if(S.isZero())return new o(1).toRed(this);if(S.cmpn(1)===0)return b.clone();var T=4,B=new Array(1<<T);B[0]=new o(1).toRed(this),B[1]=b;for(var $=2;$<B.length;$++)B[$]=this.mul(B[$-1],b);var A=B[0],g=0,k=0,H=S.bitLength()%26;for(H===0&&(H=26),$=S.length-1;$>=0;$--){for(var z=S.words[$],Q=H-1;Q>=0;Q--){var ie=z>>Q&1;if(A!==B[0]&&(A=this.sqr(A)),ie===0&&g===0){k=0;continue}g<<=1,g|=ie,k++,!(k!==T&&($!==0||Q!==0))&&(A=this.mul(A,B[g]),k=0,g=0)}H=26}return A},O.prototype.convertTo=function(b){var S=b.umod(this.m);return S===b?S.clone():S},O.prototype.convertFrom=function(b){var S=b.clone();return S.red=null,S},o.mont=function(b){return new l(b)};function l(p){O.call(this,p),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(l,O),l.prototype.convertTo=function(b){return this.imod(b.ushln(this.shift))},l.prototype.convertFrom=function(b){var S=this.imod(b.mul(this.rinv));return S.red=null,S},l.prototype.imul=function(b,S){if(b.isZero()||S.isZero())return b.words[0]=0,b.length=1,b;var T=b.imul(S),B=T.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),$=T.isub(B).iushrn(this.shift),A=$;return $.cmp(this.m)>=0?A=$.isub(this.m):$.cmpn(0)<0&&(A=$.iadd(this.m)),A._forceRed(this)},l.prototype.mul=function(b,S){if(b.isZero()||S.isZero())return new o(0)._forceRed(this);var T=b.mul(S),B=T.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),$=T.isub(B).iushrn(this.shift),A=$;return $.cmp(this.m)>=0?A=$.isub(this.m):$.cmpn(0)<0&&(A=$.iadd(this.m)),A._forceRed(this)},l.prototype.invm=function(b){var S=this.imod(b._invmp(this.m).mul(this.r2));return S._forceRed(this)}})(r,commonjsGlobal)}(bn$4)),bn$4.exports}var browserifyRsa,hasRequiredBrowserifyRsa;function requireBrowserifyRsa(){if(hasRequiredBrowserifyRsa)return browserifyRsa;hasRequiredBrowserifyRsa=1;var r=requireBn$4(),e=requireBrowser$b(),t=requireSafeBuffer$1().Buffer;function n(c){var u=c.modulus.byteLength(),v;do v=new r(e(u));while(v.cmp(c.modulus)>=0||!v.umod(c.prime1)||!v.umod(c.prime2));return v}function a(c){var u=n(c),v=u.toRed(r.mont(c.modulus)).redPow(new r(c.publicExponent)).fromRed();return{blinder:v,unblinder:u.invm(c.modulus)}}function o(c,u){var v=a(u),_=u.modulus.byteLength(),x=new r(c).mul(v.blinder).umod(u.modulus),E=x.toRed(r.mont(u.prime1)),M=x.toRed(r.mont(u.prime2)),C=u.coefficient,I=u.prime1,D=u.prime2,L=E.redPow(u.exponent1).fromRed(),N=M.redPow(u.exponent2).fromRed(),q=L.isub(N).imul(C).umod(I).imul(D);return N.iadd(q).imul(v.unblinder).umod(u.modulus).toArrayLike(t,"be",_)}return o.getr=n,browserifyRsa=o,browserifyRsa}var elliptic={};const version$2="6.6.1",require$$0={version:version$2};var utils$2={},bn$3={exports:{}};bn$3.exports;var hasRequiredBn$3;function requireBn$3(){return hasRequiredBn$3||(hasRequiredBn$3=1,function(r){(function(e,t){function n(O,l){if(!O)throw new Error(l||"Assertion failed")}function a(O,l){O.super_=l;var p=function(){};p.prototype=l.prototype,O.prototype=new p,O.prototype.constructor=O}function o(O,l,p){if(o.isBN(O))return O;this.negative=0,this.words=null,this.length=0,this.red=null,O!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(O||0,l||10,p||"be"))}typeof e=="object"?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=bufferPolyfill.Buffer}catch{}o.isBN=function(l){return l instanceof o?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===o.wordSize&&Array.isArray(l.words)},o.max=function(l,p){return l.cmp(p)>0?l:p},o.min=function(l,p){return l.cmp(p)<0?l:p},o.prototype._init=function(l,p,b){if(typeof l=="number")return this._initNumber(l,p,b);if(typeof l=="object")return this._initArray(l,p,b);p==="hex"&&(p=16),n(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var S=0;l[0]==="-"&&(S++,this.negative=1),S<l.length&&(p===16?this._parseHex(l,S,b):(this._parseBase(l,p,S),b==="le"&&this._initArray(this.toArray(),p,b)))},o.prototype._initNumber=function(l,p,b){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(n(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),b==="le"&&this._initArray(this.toArray(),p,b)},o.prototype._initArray=function(l,p,b){if(n(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T,B,$=0;if(b==="be")for(S=l.length-1,T=0;S>=0;S-=3)B=l[S]|l[S-1]<<8|l[S-2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);else if(b==="le")for(S=0,T=0;S<l.length;S+=3)B=l[S]|l[S+1]<<8|l[S+2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);return this.strip()};function u(O,l){var p=O.charCodeAt(l);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function v(O,l,p){var b=u(O,p);return p-1>=l&&(b|=u(O,p-1)<<4),b}o.prototype._parseHex=function(l,p,b){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T=0,B=0,$;if(b==="be")for(S=l.length-1;S>=p;S-=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8;else{var A=l.length-p;for(S=A%2===0?p+1:p;S<l.length;S+=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8}this.strip()};function _(O,l,p,b){for(var S=0,T=Math.min(O.length,p),B=l;B<T;B++){var $=O.charCodeAt(B)-48;S*=b,$>=49?S+=$-49+10:$>=17?S+=$-17+10:S+=$}return S}o.prototype._parseBase=function(l,p,b){this.words=[0],this.length=1;for(var S=0,T=1;T<=67108863;T*=p)S++;S--,T=T/p|0;for(var B=l.length-b,$=B%S,A=Math.min(B,B-$)+b,g=0,k=b;k<A;k+=S)g=_(l,k,k+S,p),this.imuln(T),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g);if($!==0){var H=1;for(g=_(l,k,l.length,p),k=0;k<$;k++)H*=p;this.imuln(H),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g)}this.strip()},o.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red},o.prototype.clone=function(){var l=new o(null);return this.copy(l),l},o.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],E=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],M=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(l,p){l=l||10,p=p|0||1;var b;if(l===16||l==="hex"){b="";for(var S=0,T=0,B=0;B<this.length;B++){var $=this.words[B],A=(($<<S|T)&16777215).toString(16);T=$>>>24-S&16777215,S+=2,S>=26&&(S-=26,B--),T!==0||B!==this.length-1?b=x[6-A.length]+A+b:b=A+b}for(T!==0&&(b=T.toString(16)+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}if(l===(l|0)&&l>=2&&l<=36){var g=E[l],k=M[l];b="";var H=this.clone();for(H.negative=0;!H.isZero();){var z=H.modn(k).toString(l);H=H.idivn(k),H.isZero()?b=z+b:b=x[g-z.length]+z+b}for(this.isZero()&&(b="0"+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(l,p){return n(typeof c<"u"),this.toArrayLike(c,l,p)},o.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)},o.prototype.toArrayLike=function(l,p,b){var S=this.byteLength(),T=b||Math.max(1,S);n(S<=T,"byte array longer than desired length"),n(T>0,"Requested array length <= 0"),this.strip();var B=p==="le",$=new l(T),A,g,k=this.clone();if(B){for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[g]=A;for(;g<T;g++)$[g]=0}else{for(g=0;g<T-S;g++)$[g]=0;for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[T-g-1]=A}return $},Math.clz32?o.prototype._countBits=function(l){return 32-Math.clz32(l)}:o.prototype._countBits=function(l){var p=l,b=0;return p>=4096&&(b+=13,p>>>=13),p>=64&&(b+=7,p>>>=7),p>=8&&(b+=4,p>>>=4),p>=2&&(b+=2,p>>>=2),b+p},o.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,b=0;return p&8191||(b+=13,p>>>=13),p&127||(b+=7,p>>>=7),p&15||(b+=4,p>>>=4),p&3||(b+=2,p>>>=2),p&1||b++,b},o.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function C(O){for(var l=new Array(O.bitLength()),p=0;p<l.length;p++){var b=p/26|0,S=p%26;l[p]=(O.words[b]&1<<S)>>>S}return l}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var b=this._zeroBits(this.words[p]);if(l+=b,b!==26)break}return l},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},o.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this.strip()},o.prototype.ior=function(l){return n((this.negative|l.negative)===0),this.iuor(l)},o.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},o.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},o.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var b=0;b<p.length;b++)this.words[b]=this.words[b]&l.words[b];return this.length=p.length,this.strip()},o.prototype.iand=function(l){return n((this.negative|l.negative)===0),this.iuand(l)},o.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},o.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},o.prototype.iuxor=function(l){var p,b;this.length>l.length?(p=this,b=l):(p=l,b=this);for(var S=0;S<b.length;S++)this.words[S]=p.words[S]^b.words[S];if(this!==p)for(;S<p.length;S++)this.words[S]=p.words[S];return this.length=p.length,this.strip()},o.prototype.ixor=function(l){return n((this.negative|l.negative)===0),this.iuxor(l)},o.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},o.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},o.prototype.inotn=function(l){n(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,b=l%26;this._expand(p),b>0&&p--;for(var S=0;S<p;S++)this.words[S]=~this.words[S]&67108863;return b>0&&(this.words[S]=~this.words[S]&67108863>>26-b),this.strip()},o.prototype.notn=function(l){return this.clone().inotn(l)},o.prototype.setn=function(l,p){n(typeof l=="number"&&l>=0);var b=l/26|0,S=l%26;return this._expand(b+1),p?this.words[b]=this.words[b]|1<<S:this.words[b]=this.words[b]&~(1<<S),this.strip()},o.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var b,S;this.length>l.length?(b=this,S=l):(b=l,S=this);for(var T=0,B=0;B<S.length;B++)p=(b.words[B]|0)+(S.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;for(;T!==0&&B<b.length;B++)p=(b.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;if(this.length=b.length,T!==0)this.words[this.length]=T,this.length++;else if(b!==this)for(;B<b.length;B++)this.words[B]=b.words[B];return this},o.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},o.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var b=this.cmp(l);if(b===0)return this.negative=0,this.length=1,this.words[0]=0,this;var S,T;b>0?(S=this,T=l):(S=l,T=this);for(var B=0,$=0;$<T.length;$++)p=(S.words[$]|0)-(T.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;for(;B!==0&&$<S.length;$++)p=(S.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;if(B===0&&$<S.length&&S!==this)for(;$<S.length;$++)this.words[$]=S.words[$];return this.length=Math.max(this.length,$),S!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(l){return this.clone().isub(l)};function I(O,l,p){p.negative=l.negative^O.negative;var b=O.length+l.length|0;p.length=b,b=b-1|0;var S=O.words[0]|0,T=l.words[0]|0,B=S*T,$=B&67108863,A=B/67108864|0;p.words[0]=$;for(var g=1;g<b;g++){for(var k=A>>>26,H=A&67108863,z=Math.min(g,l.length-1),Q=Math.max(0,g-O.length+1);Q<=z;Q++){var ie=g-Q|0;S=O.words[ie]|0,T=l.words[Q]|0,B=S*T+H,k+=B/67108864|0,H=B&67108863}p.words[g]=H|0,A=k|0}return A!==0?p.words[g]=A|0:p.length--,p.strip()}var D=function(l,p,b){var S=l.words,T=p.words,B=b.words,$=0,A,g,k,H=S[0]|0,z=H&8191,Q=H>>>13,ie=S[1]|0,ne=ie&8191,Z=ie>>>13,se=S[2]|0,ae=se&8191,ce=se>>>13,le=S[3]|0,te=le&8191,he=le>>>13,Ae=S[4]|0,ge=Ae&8191,me=Ae>>>13,je=S[5]|0,we=je&8191,pe=je>>>13,Ke=S[6]|0,ye=Ke&8191,xe=Ke>>>13,Ve=S[7]|0,be=Ve&8191,Ee=Ve>>>13,Ge=S[8]|0,re=Ge&8191,Y=Ge>>>13,ee=S[9]|0,fe=ee&8191,ue=ee>>>13,ve=T[0]|0,de=ve&8191,Se=ve>>>13,We=T[1]|0,_e=We&8191,Me=We>>>13,ze=T[2]|0,Te=ze&8191,$e=ze>>>13,Je=T[3]|0,ke=Je&8191,Oe=Je>>>13,Ze=T[4]|0,Be=Ze&8191,Le=Ze>>>13,Qe=T[5]|0,Re=Qe&8191,Ne=Qe>>>13,et=T[6]|0,Ce=et&8191,qe=et>>>13,tt=T[7]|0,Ie=tt&8191,Fe=tt>>>13,rt=T[8]|0,De=rt&8191,Ue=rt>>>13,nt=T[9]|0,Pe=nt&8191,He=nt>>>13;b.negative=l.negative^p.negative,b.length=19,A=Math.imul(z,de),g=Math.imul(z,Se),g=g+Math.imul(Q,de)|0,k=Math.imul(Q,Se);var Xe=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Xe>>>26)|0,Xe&=67108863,A=Math.imul(ne,de),g=Math.imul(ne,Se),g=g+Math.imul(Z,de)|0,k=Math.imul(Z,Se),A=A+Math.imul(z,_e)|0,g=g+Math.imul(z,Me)|0,g=g+Math.imul(Q,_e)|0,k=k+Math.imul(Q,Me)|0;var Ye=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,A=Math.imul(ae,de),g=Math.imul(ae,Se),g=g+Math.imul(ce,de)|0,k=Math.imul(ce,Se),A=A+Math.imul(ne,_e)|0,g=g+Math.imul(ne,Me)|0,g=g+Math.imul(Z,_e)|0,k=k+Math.imul(Z,Me)|0,A=A+Math.imul(z,Te)|0,g=g+Math.imul(z,$e)|0,g=g+Math.imul(Q,Te)|0,k=k+Math.imul(Q,$e)|0;var it=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(it>>>26)|0,it&=67108863,A=Math.imul(te,de),g=Math.imul(te,Se),g=g+Math.imul(he,de)|0,k=Math.imul(he,Se),A=A+Math.imul(ae,_e)|0,g=g+Math.imul(ae,Me)|0,g=g+Math.imul(ce,_e)|0,k=k+Math.imul(ce,Me)|0,A=A+Math.imul(ne,Te)|0,g=g+Math.imul(ne,$e)|0,g=g+Math.imul(Z,Te)|0,k=k+Math.imul(Z,$e)|0,A=A+Math.imul(z,ke)|0,g=g+Math.imul(z,Oe)|0,g=g+Math.imul(Q,ke)|0,k=k+Math.imul(Q,Oe)|0;var st=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(st>>>26)|0,st&=67108863,A=Math.imul(ge,de),g=Math.imul(ge,Se),g=g+Math.imul(me,de)|0,k=Math.imul(me,Se),A=A+Math.imul(te,_e)|0,g=g+Math.imul(te,Me)|0,g=g+Math.imul(he,_e)|0,k=k+Math.imul(he,Me)|0,A=A+Math.imul(ae,Te)|0,g=g+Math.imul(ae,$e)|0,g=g+Math.imul(ce,Te)|0,k=k+Math.imul(ce,$e)|0,A=A+Math.imul(ne,ke)|0,g=g+Math.imul(ne,Oe)|0,g=g+Math.imul(Z,ke)|0,k=k+Math.imul(Z,Oe)|0,A=A+Math.imul(z,Be)|0,g=g+Math.imul(z,Le)|0,g=g+Math.imul(Q,Be)|0,k=k+Math.imul(Q,Le)|0;var ot=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ot>>>26)|0,ot&=67108863,A=Math.imul(we,de),g=Math.imul(we,Se),g=g+Math.imul(pe,de)|0,k=Math.imul(pe,Se),A=A+Math.imul(ge,_e)|0,g=g+Math.imul(ge,Me)|0,g=g+Math.imul(me,_e)|0,k=k+Math.imul(me,Me)|0,A=A+Math.imul(te,Te)|0,g=g+Math.imul(te,$e)|0,g=g+Math.imul(he,Te)|0,k=k+Math.imul(he,$e)|0,A=A+Math.imul(ae,ke)|0,g=g+Math.imul(ae,Oe)|0,g=g+Math.imul(ce,ke)|0,k=k+Math.imul(ce,Oe)|0,A=A+Math.imul(ne,Be)|0,g=g+Math.imul(ne,Le)|0,g=g+Math.imul(Z,Be)|0,k=k+Math.imul(Z,Le)|0,A=A+Math.imul(z,Re)|0,g=g+Math.imul(z,Ne)|0,g=g+Math.imul(Q,Re)|0,k=k+Math.imul(Q,Ne)|0;var at=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(at>>>26)|0,at&=67108863,A=Math.imul(ye,de),g=Math.imul(ye,Se),g=g+Math.imul(xe,de)|0,k=Math.imul(xe,Se),A=A+Math.imul(we,_e)|0,g=g+Math.imul(we,Me)|0,g=g+Math.imul(pe,_e)|0,k=k+Math.imul(pe,Me)|0,A=A+Math.imul(ge,Te)|0,g=g+Math.imul(ge,$e)|0,g=g+Math.imul(me,Te)|0,k=k+Math.imul(me,$e)|0,A=A+Math.imul(te,ke)|0,g=g+Math.imul(te,Oe)|0,g=g+Math.imul(he,ke)|0,k=k+Math.imul(he,Oe)|0,A=A+Math.imul(ae,Be)|0,g=g+Math.imul(ae,Le)|0,g=g+Math.imul(ce,Be)|0,k=k+Math.imul(ce,Le)|0,A=A+Math.imul(ne,Re)|0,g=g+Math.imul(ne,Ne)|0,g=g+Math.imul(Z,Re)|0,k=k+Math.imul(Z,Ne)|0,A=A+Math.imul(z,Ce)|0,g=g+Math.imul(z,qe)|0,g=g+Math.imul(Q,Ce)|0,k=k+Math.imul(Q,qe)|0;var ft=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ft>>>26)|0,ft&=67108863,A=Math.imul(be,de),g=Math.imul(be,Se),g=g+Math.imul(Ee,de)|0,k=Math.imul(Ee,Se),A=A+Math.imul(ye,_e)|0,g=g+Math.imul(ye,Me)|0,g=g+Math.imul(xe,_e)|0,k=k+Math.imul(xe,Me)|0,A=A+Math.imul(we,Te)|0,g=g+Math.imul(we,$e)|0,g=g+Math.imul(pe,Te)|0,k=k+Math.imul(pe,$e)|0,A=A+Math.imul(ge,ke)|0,g=g+Math.imul(ge,Oe)|0,g=g+Math.imul(me,ke)|0,k=k+Math.imul(me,Oe)|0,A=A+Math.imul(te,Be)|0,g=g+Math.imul(te,Le)|0,g=g+Math.imul(he,Be)|0,k=k+Math.imul(he,Le)|0,A=A+Math.imul(ae,Re)|0,g=g+Math.imul(ae,Ne)|0,g=g+Math.imul(ce,Re)|0,k=k+Math.imul(ce,Ne)|0,A=A+Math.imul(ne,Ce)|0,g=g+Math.imul(ne,qe)|0,g=g+Math.imul(Z,Ce)|0,k=k+Math.imul(Z,qe)|0,A=A+Math.imul(z,Ie)|0,g=g+Math.imul(z,Fe)|0,g=g+Math.imul(Q,Ie)|0,k=k+Math.imul(Q,Fe)|0;var lt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(lt>>>26)|0,lt&=67108863,A=Math.imul(re,de),g=Math.imul(re,Se),g=g+Math.imul(Y,de)|0,k=Math.imul(Y,Se),A=A+Math.imul(be,_e)|0,g=g+Math.imul(be,Me)|0,g=g+Math.imul(Ee,_e)|0,k=k+Math.imul(Ee,Me)|0,A=A+Math.imul(ye,Te)|0,g=g+Math.imul(ye,$e)|0,g=g+Math.imul(xe,Te)|0,k=k+Math.imul(xe,$e)|0,A=A+Math.imul(we,ke)|0,g=g+Math.imul(we,Oe)|0,g=g+Math.imul(pe,ke)|0,k=k+Math.imul(pe,Oe)|0,A=A+Math.imul(ge,Be)|0,g=g+Math.imul(ge,Le)|0,g=g+Math.imul(me,Be)|0,k=k+Math.imul(me,Le)|0,A=A+Math.imul(te,Re)|0,g=g+Math.imul(te,Ne)|0,g=g+Math.imul(he,Re)|0,k=k+Math.imul(he,Ne)|0,A=A+Math.imul(ae,Ce)|0,g=g+Math.imul(ae,qe)|0,g=g+Math.imul(ce,Ce)|0,k=k+Math.imul(ce,qe)|0,A=A+Math.imul(ne,Ie)|0,g=g+Math.imul(ne,Fe)|0,g=g+Math.imul(Z,Ie)|0,k=k+Math.imul(Z,Fe)|0,A=A+Math.imul(z,De)|0,g=g+Math.imul(z,Ue)|0,g=g+Math.imul(Q,De)|0,k=k+Math.imul(Q,Ue)|0;var ct=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ct>>>26)|0,ct&=67108863,A=Math.imul(fe,de),g=Math.imul(fe,Se),g=g+Math.imul(ue,de)|0,k=Math.imul(ue,Se),A=A+Math.imul(re,_e)|0,g=g+Math.imul(re,Me)|0,g=g+Math.imul(Y,_e)|0,k=k+Math.imul(Y,Me)|0,A=A+Math.imul(be,Te)|0,g=g+Math.imul(be,$e)|0,g=g+Math.imul(Ee,Te)|0,k=k+Math.imul(Ee,$e)|0,A=A+Math.imul(ye,ke)|0,g=g+Math.imul(ye,Oe)|0,g=g+Math.imul(xe,ke)|0,k=k+Math.imul(xe,Oe)|0,A=A+Math.imul(we,Be)|0,g=g+Math.imul(we,Le)|0,g=g+Math.imul(pe,Be)|0,k=k+Math.imul(pe,Le)|0,A=A+Math.imul(ge,Re)|0,g=g+Math.imul(ge,Ne)|0,g=g+Math.imul(me,Re)|0,k=k+Math.imul(me,Ne)|0,A=A+Math.imul(te,Ce)|0,g=g+Math.imul(te,qe)|0,g=g+Math.imul(he,Ce)|0,k=k+Math.imul(he,qe)|0,A=A+Math.imul(ae,Ie)|0,g=g+Math.imul(ae,Fe)|0,g=g+Math.imul(ce,Ie)|0,k=k+Math.imul(ce,Fe)|0,A=A+Math.imul(ne,De)|0,g=g+Math.imul(ne,Ue)|0,g=g+Math.imul(Z,De)|0,k=k+Math.imul(Z,Ue)|0,A=A+Math.imul(z,Pe)|0,g=g+Math.imul(z,He)|0,g=g+Math.imul(Q,Pe)|0,k=k+Math.imul(Q,He)|0;var ht=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ht>>>26)|0,ht&=67108863,A=Math.imul(fe,_e),g=Math.imul(fe,Me),g=g+Math.imul(ue,_e)|0,k=Math.imul(ue,Me),A=A+Math.imul(re,Te)|0,g=g+Math.imul(re,$e)|0,g=g+Math.imul(Y,Te)|0,k=k+Math.imul(Y,$e)|0,A=A+Math.imul(be,ke)|0,g=g+Math.imul(be,Oe)|0,g=g+Math.imul(Ee,ke)|0,k=k+Math.imul(Ee,Oe)|0,A=A+Math.imul(ye,Be)|0,g=g+Math.imul(ye,Le)|0,g=g+Math.imul(xe,Be)|0,k=k+Math.imul(xe,Le)|0,A=A+Math.imul(we,Re)|0,g=g+Math.imul(we,Ne)|0,g=g+Math.imul(pe,Re)|0,k=k+Math.imul(pe,Ne)|0,A=A+Math.imul(ge,Ce)|0,g=g+Math.imul(ge,qe)|0,g=g+Math.imul(me,Ce)|0,k=k+Math.imul(me,qe)|0,A=A+Math.imul(te,Ie)|0,g=g+Math.imul(te,Fe)|0,g=g+Math.imul(he,Ie)|0,k=k+Math.imul(he,Fe)|0,A=A+Math.imul(ae,De)|0,g=g+Math.imul(ae,Ue)|0,g=g+Math.imul(ce,De)|0,k=k+Math.imul(ce,Ue)|0,A=A+Math.imul(ne,Pe)|0,g=g+Math.imul(ne,He)|0,g=g+Math.imul(Z,Pe)|0,k=k+Math.imul(Z,He)|0;var dt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(dt>>>26)|0,dt&=67108863,A=Math.imul(fe,Te),g=Math.imul(fe,$e),g=g+Math.imul(ue,Te)|0,k=Math.imul(ue,$e),A=A+Math.imul(re,ke)|0,g=g+Math.imul(re,Oe)|0,g=g+Math.imul(Y,ke)|0,k=k+Math.imul(Y,Oe)|0,A=A+Math.imul(be,Be)|0,g=g+Math.imul(be,Le)|0,g=g+Math.imul(Ee,Be)|0,k=k+Math.imul(Ee,Le)|0,A=A+Math.imul(ye,Re)|0,g=g+Math.imul(ye,Ne)|0,g=g+Math.imul(xe,Re)|0,k=k+Math.imul(xe,Ne)|0,A=A+Math.imul(we,Ce)|0,g=g+Math.imul(we,qe)|0,g=g+Math.imul(pe,Ce)|0,k=k+Math.imul(pe,qe)|0,A=A+Math.imul(ge,Ie)|0,g=g+Math.imul(ge,Fe)|0,g=g+Math.imul(me,Ie)|0,k=k+Math.imul(me,Fe)|0,A=A+Math.imul(te,De)|0,g=g+Math.imul(te,Ue)|0,g=g+Math.imul(he,De)|0,k=k+Math.imul(he,Ue)|0,A=A+Math.imul(ae,Pe)|0,g=g+Math.imul(ae,He)|0,g=g+Math.imul(ce,Pe)|0,k=k+Math.imul(ce,He)|0;var pt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(pt>>>26)|0,pt&=67108863,A=Math.imul(fe,ke),g=Math.imul(fe,Oe),g=g+Math.imul(ue,ke)|0,k=Math.imul(ue,Oe),A=A+Math.imul(re,Be)|0,g=g+Math.imul(re,Le)|0,g=g+Math.imul(Y,Be)|0,k=k+Math.imul(Y,Le)|0,A=A+Math.imul(be,Re)|0,g=g+Math.imul(be,Ne)|0,g=g+Math.imul(Ee,Re)|0,k=k+Math.imul(Ee,Ne)|0,A=A+Math.imul(ye,Ce)|0,g=g+Math.imul(ye,qe)|0,g=g+Math.imul(xe,Ce)|0,k=k+Math.imul(xe,qe)|0,A=A+Math.imul(we,Ie)|0,g=g+Math.imul(we,Fe)|0,g=g+Math.imul(pe,Ie)|0,k=k+Math.imul(pe,Fe)|0,A=A+Math.imul(ge,De)|0,g=g+Math.imul(ge,Ue)|0,g=g+Math.imul(me,De)|0,k=k+Math.imul(me,Ue)|0,A=A+Math.imul(te,Pe)|0,g=g+Math.imul(te,He)|0,g=g+Math.imul(he,Pe)|0,k=k+Math.imul(he,He)|0;var gt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(gt>>>26)|0,gt&=67108863,A=Math.imul(fe,Be),g=Math.imul(fe,Le),g=g+Math.imul(ue,Be)|0,k=Math.imul(ue,Le),A=A+Math.imul(re,Re)|0,g=g+Math.imul(re,Ne)|0,g=g+Math.imul(Y,Re)|0,k=k+Math.imul(Y,Ne)|0,A=A+Math.imul(be,Ce)|0,g=g+Math.imul(be,qe)|0,g=g+Math.imul(Ee,Ce)|0,k=k+Math.imul(Ee,qe)|0,A=A+Math.imul(ye,Ie)|0,g=g+Math.imul(ye,Fe)|0,g=g+Math.imul(xe,Ie)|0,k=k+Math.imul(xe,Fe)|0,A=A+Math.imul(we,De)|0,g=g+Math.imul(we,Ue)|0,g=g+Math.imul(pe,De)|0,k=k+Math.imul(pe,Ue)|0,A=A+Math.imul(ge,Pe)|0,g=g+Math.imul(ge,He)|0,g=g+Math.imul(me,Pe)|0,k=k+Math.imul(me,He)|0;var mt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(mt>>>26)|0,mt&=67108863,A=Math.imul(fe,Re),g=Math.imul(fe,Ne),g=g+Math.imul(ue,Re)|0,k=Math.imul(ue,Ne),A=A+Math.imul(re,Ce)|0,g=g+Math.imul(re,qe)|0,g=g+Math.imul(Y,Ce)|0,k=k+Math.imul(Y,qe)|0,A=A+Math.imul(be,Ie)|0,g=g+Math.imul(be,Fe)|0,g=g+Math.imul(Ee,Ie)|0,k=k+Math.imul(Ee,Fe)|0,A=A+Math.imul(ye,De)|0,g=g+Math.imul(ye,Ue)|0,g=g+Math.imul(xe,De)|0,k=k+Math.imul(xe,Ue)|0,A=A+Math.imul(we,Pe)|0,g=g+Math.imul(we,He)|0,g=g+Math.imul(pe,Pe)|0,k=k+Math.imul(pe,He)|0;var yt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(yt>>>26)|0,yt&=67108863,A=Math.imul(fe,Ce),g=Math.imul(fe,qe),g=g+Math.imul(ue,Ce)|0,k=Math.imul(ue,qe),A=A+Math.imul(re,Ie)|0,g=g+Math.imul(re,Fe)|0,g=g+Math.imul(Y,Ie)|0,k=k+Math.imul(Y,Fe)|0,A=A+Math.imul(be,De)|0,g=g+Math.imul(be,Ue)|0,g=g+Math.imul(Ee,De)|0,k=k+Math.imul(Ee,Ue)|0,A=A+Math.imul(ye,Pe)|0,g=g+Math.imul(ye,He)|0,g=g+Math.imul(xe,Pe)|0,k=k+Math.imul(xe,He)|0;var vt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(vt>>>26)|0,vt&=67108863,A=Math.imul(fe,Ie),g=Math.imul(fe,Fe),g=g+Math.imul(ue,Ie)|0,k=Math.imul(ue,Fe),A=A+Math.imul(re,De)|0,g=g+Math.imul(re,Ue)|0,g=g+Math.imul(Y,De)|0,k=k+Math.imul(Y,Ue)|0,A=A+Math.imul(be,Pe)|0,g=g+Math.imul(be,He)|0,g=g+Math.imul(Ee,Pe)|0,k=k+Math.imul(Ee,He)|0;var bt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(bt>>>26)|0,bt&=67108863,A=Math.imul(fe,De),g=Math.imul(fe,Ue),g=g+Math.imul(ue,De)|0,k=Math.imul(ue,Ue),A=A+Math.imul(re,Pe)|0,g=g+Math.imul(re,He)|0,g=g+Math.imul(Y,Pe)|0,k=k+Math.imul(Y,He)|0;var wt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(wt>>>26)|0,wt&=67108863,A=Math.imul(fe,Pe),g=Math.imul(fe,He),g=g+Math.imul(ue,Pe)|0,k=Math.imul(ue,He);var _t=($+A|0)+((g&8191)<<13)|0;return $=(k+(g>>>13)|0)+(_t>>>26)|0,_t&=67108863,B[0]=Xe,B[1]=Ye,B[2]=it,B[3]=st,B[4]=ot,B[5]=at,B[6]=ft,B[7]=lt,B[8]=ct,B[9]=ht,B[10]=dt,B[11]=pt,B[12]=gt,B[13]=mt,B[14]=yt,B[15]=vt,B[16]=bt,B[17]=wt,B[18]=_t,$!==0&&(B[19]=$,b.length++),b};Math.imul||(D=I);function L(O,l,p){p.negative=l.negative^O.negative,p.length=O.length+l.length;for(var b=0,S=0,T=0;T<p.length-1;T++){var B=S;S=0;for(var $=b&67108863,A=Math.min(T,l.length-1),g=Math.max(0,T-O.length+1);g<=A;g++){var k=T-g,H=O.words[k]|0,z=l.words[g]|0,Q=H*z,ie=Q&67108863;B=B+(Q/67108864|0)|0,ie=ie+$|0,$=ie&67108863,B=B+(ie>>>26)|0,S+=B>>>26,B&=67108863}p.words[T]=$,b=B,B=S}return b!==0?p.words[T]=b:p.length--,p.strip()}function N(O,l,p){var b=new q;return b.mulp(O,l,p)}o.prototype.mulTo=function(l,p){var b,S=this.length+l.length;return this.length===10&&l.length===10?b=D(this,l,p):S<63?b=I(this,l,p):S<1024?b=L(this,l,p):b=N(this,l,p),b};function q(O,l){this.x=O,this.y=l}q.prototype.makeRBT=function(l){for(var p=new Array(l),b=o.prototype._countBits(l)-1,S=0;S<l;S++)p[S]=this.revBin(S,b,l);return p},q.prototype.revBin=function(l,p,b){if(l===0||l===b-1)return l;for(var S=0,T=0;T<p;T++)S|=(l&1)<<p-T-1,l>>=1;return S},q.prototype.permute=function(l,p,b,S,T,B){for(var $=0;$<B;$++)S[$]=p[l[$]],T[$]=b[l[$]]},q.prototype.transform=function(l,p,b,S,T,B){this.permute(B,l,p,b,S,T);for(var $=1;$<T;$<<=1)for(var A=$<<1,g=Math.cos(2*Math.PI/A),k=Math.sin(2*Math.PI/A),H=0;H<T;H+=A)for(var z=g,Q=k,ie=0;ie<$;ie++){var ne=b[H+ie],Z=S[H+ie],se=b[H+ie+$],ae=S[H+ie+$],ce=z*se-Q*ae;ae=z*ae+Q*se,se=ce,b[H+ie]=ne+se,S[H+ie]=Z+ae,b[H+ie+$]=ne-se,S[H+ie+$]=Z-ae,ie!==A&&(ce=g*z-k*Q,Q=g*Q+k*z,z=ce)}},q.prototype.guessLen13b=function(l,p){var b=Math.max(p,l)|1,S=b&1,T=0;for(b=b/2|0;b;b=b>>>1)T++;return 1<<T+1+S},q.prototype.conjugate=function(l,p,b){if(!(b<=1))for(var S=0;S<b/2;S++){var T=l[S];l[S]=l[b-S-1],l[b-S-1]=T,T=p[S],p[S]=-p[b-S-1],p[b-S-1]=-T}},q.prototype.normalize13b=function(l,p){for(var b=0,S=0;S<p/2;S++){var T=Math.round(l[2*S+1]/p)*8192+Math.round(l[2*S]/p)+b;l[S]=T&67108863,T<67108864?b=0:b=T/67108864|0}return l},q.prototype.convert13b=function(l,p,b,S){for(var T=0,B=0;B<p;B++)T=T+(l[B]|0),b[2*B]=T&8191,T=T>>>13,b[2*B+1]=T&8191,T=T>>>13;for(B=2*p;B<S;++B)b[B]=0;n(T===0),n((T&-8192)===0)},q.prototype.stub=function(l){for(var p=new Array(l),b=0;b<l;b++)p[b]=0;return p},q.prototype.mulp=function(l,p,b){var S=2*this.guessLen13b(l.length,p.length),T=this.makeRBT(S),B=this.stub(S),$=new Array(S),A=new Array(S),g=new Array(S),k=new Array(S),H=new Array(S),z=new Array(S),Q=b.words;Q.length=S,this.convert13b(l.words,l.length,$,S),this.convert13b(p.words,p.length,k,S),this.transform($,B,A,g,S,T),this.transform(k,B,H,z,S,T);for(var ie=0;ie<S;ie++){var ne=A[ie]*H[ie]-g[ie]*z[ie];g[ie]=A[ie]*z[ie]+g[ie]*H[ie],A[ie]=ne}return this.conjugate(A,g,S),this.transform(A,g,Q,B,S,T),this.conjugate(Q,B,S),this.normalize13b(Q,S),b.negative=l.negative^p.negative,b.length=l.length+p.length,b.strip()},o.prototype.mul=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},o.prototype.mulf=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),N(this,l,p)},o.prototype.imul=function(l){return this.clone().mulTo(l,this)},o.prototype.imuln=function(l){n(typeof l=="number"),n(l<67108864);for(var p=0,b=0;b<this.length;b++){var S=(this.words[b]|0)*l,T=(S&67108863)+(p&67108863);p>>=26,p+=S/67108864|0,p+=T>>>26,this.words[b]=T&67108863}return p!==0&&(this.words[b]=p,this.length++),this},o.prototype.muln=function(l){return this.clone().imuln(l)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(l){var p=C(l);if(p.length===0)return new o(1);for(var b=this,S=0;S<p.length&&p[S]===0;S++,b=b.sqr());if(++S<p.length)for(var T=b.sqr();S<p.length;S++,T=T.sqr())p[S]!==0&&(b=b.mul(T));return b},o.prototype.iushln=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=67108863>>>26-p<<26-p,T;if(p!==0){var B=0;for(T=0;T<this.length;T++){var $=this.words[T]&S,A=(this.words[T]|0)-$<<p;this.words[T]=A|B,B=$>>>26-p}B&&(this.words[T]=B,this.length++)}if(b!==0){for(T=this.length-1;T>=0;T--)this.words[T+b]=this.words[T];for(T=0;T<b;T++)this.words[T]=0;this.length+=b}return this.strip()},o.prototype.ishln=function(l){return n(this.negative===0),this.iushln(l)},o.prototype.iushrn=function(l,p,b){n(typeof l=="number"&&l>=0);var S;p?S=(p-p%26)/26:S=0;var T=l%26,B=Math.min((l-T)/26,this.length),$=67108863^67108863>>>T<<T,A=b;if(S-=B,S=Math.max(0,S),A){for(var g=0;g<B;g++)A.words[g]=this.words[g];A.length=B}if(B!==0)if(this.length>B)for(this.length-=B,g=0;g<this.length;g++)this.words[g]=this.words[g+B];else this.words[0]=0,this.length=1;var k=0;for(g=this.length-1;g>=0&&(k!==0||g>=S);g--){var H=this.words[g]|0;this.words[g]=k<<26-T|H>>>T,k=H&$}return A&&k!==0&&(A.words[A.length++]=k),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(l,p,b){return n(this.negative===0),this.iushrn(l,p,b)},o.prototype.shln=function(l){return this.clone().ishln(l)},o.prototype.ushln=function(l){return this.clone().iushln(l)},o.prototype.shrn=function(l){return this.clone().ishrn(l)},o.prototype.ushrn=function(l){return this.clone().iushrn(l)},o.prototype.testn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return!1;var T=this.words[b];return!!(T&S)},o.prototype.imaskn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=b)return this;if(p!==0&&b++,this.length=Math.min(b,this.length),p!==0){var S=67108863^67108863>>>p<<p;this.words[this.length-1]&=S}return this.strip()},o.prototype.maskn=function(l){return this.clone().imaskn(l)},o.prototype.iaddn=function(l){return n(typeof l=="number"),n(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},o.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},o.prototype.isubn=function(l){if(n(typeof l=="number"),n(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},o.prototype.addn=function(l){return this.clone().iaddn(l)},o.prototype.subn=function(l){return this.clone().isubn(l)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(l,p,b){var S=l.length+b,T;this._expand(S);var B,$=0;for(T=0;T<l.length;T++){B=(this.words[T+b]|0)+$;var A=(l.words[T]|0)*p;B-=A&67108863,$=(B>>26)-(A/67108864|0),this.words[T+b]=B&67108863}for(;T<this.length-b;T++)B=(this.words[T+b]|0)+$,$=B>>26,this.words[T+b]=B&67108863;if($===0)return this.strip();for(n($===-1),$=0,T=0;T<this.length;T++)B=-(this.words[T]|0)+$,$=B>>26,this.words[T]=B&67108863;return this.negative=1,this.strip()},o.prototype._wordDiv=function(l,p){var b=this.length-l.length,S=this.clone(),T=l,B=T.words[T.length-1]|0,$=this._countBits(B);b=26-$,b!==0&&(T=T.ushln(b),S.iushln(b),B=T.words[T.length-1]|0);var A=S.length-T.length,g;if(p!=="mod"){g=new o(null),g.length=A+1,g.words=new Array(g.length);for(var k=0;k<g.length;k++)g.words[k]=0}var H=S.clone()._ishlnsubmul(T,1,A);H.negative===0&&(S=H,g&&(g.words[A]=1));for(var z=A-1;z>=0;z--){var Q=(S.words[T.length+z]|0)*67108864+(S.words[T.length+z-1]|0);for(Q=Math.min(Q/B|0,67108863),S._ishlnsubmul(T,Q,z);S.negative!==0;)Q--,S.negative=0,S._ishlnsubmul(T,1,z),S.isZero()||(S.negative^=1);g&&(g.words[z]=Q)}return g&&g.strip(),S.strip(),p!=="div"&&b!==0&&S.iushrn(b),{div:g||null,mod:S}},o.prototype.divmod=function(l,p,b){if(n(!l.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var S,T,B;return this.negative!==0&&l.negative===0?(B=this.neg().divmod(l,p),p!=="mod"&&(S=B.div.neg()),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.iadd(l)),{div:S,mod:T}):this.negative===0&&l.negative!==0?(B=this.divmod(l.neg(),p),p!=="mod"&&(S=B.div.neg()),{div:S,mod:B.mod}):this.negative&l.negative?(B=this.neg().divmod(l.neg(),p),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.isub(l)),{div:B.div,mod:T}):l.length>this.length||this.cmp(l)<0?{div:new o(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new o(this.modn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new o(this.modn(l.words[0]))}:this._wordDiv(l,p)},o.prototype.div=function(l){return this.divmod(l,"div",!1).div},o.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},o.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},o.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var b=p.div.negative!==0?p.mod.isub(l):p.mod,S=l.ushrn(1),T=l.andln(1),B=b.cmp(S);return B<0||T===1&&B===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},o.prototype.modn=function(l){n(l<=67108863);for(var p=(1<<26)%l,b=0,S=this.length-1;S>=0;S--)b=(p*b+(this.words[S]|0))%l;return b},o.prototype.idivn=function(l){n(l<=67108863);for(var p=0,b=this.length-1;b>=0;b--){var S=(this.words[b]|0)+p*67108864;this.words[b]=S/l|0,p=S%l}return this.strip()},o.prototype.divn=function(l){return this.clone().idivn(l)},o.prototype.egcd=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=new o(0),$=new o(1),A=0;p.isEven()&&b.isEven();)p.iushrn(1),b.iushrn(1),++A;for(var g=b.clone(),k=p.clone();!p.isZero();){for(var H=0,z=1;!(p.words[0]&z)&&H<26;++H,z<<=1);if(H>0)for(p.iushrn(H);H-- >0;)(S.isOdd()||T.isOdd())&&(S.iadd(g),T.isub(k)),S.iushrn(1),T.iushrn(1);for(var Q=0,ie=1;!(b.words[0]&ie)&&Q<26;++Q,ie<<=1);if(Q>0)for(b.iushrn(Q);Q-- >0;)(B.isOdd()||$.isOdd())&&(B.iadd(g),$.isub(k)),B.iushrn(1),$.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(B),T.isub($)):(b.isub(p),B.isub(S),$.isub(T))}return{a:B,b:$,gcd:b.iushln(A)}},o.prototype._invmp=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=b.clone();p.cmpn(1)>0&&b.cmpn(1)>0;){for(var $=0,A=1;!(p.words[0]&A)&&$<26;++$,A<<=1);if($>0)for(p.iushrn($);$-- >0;)S.isOdd()&&S.iadd(B),S.iushrn(1);for(var g=0,k=1;!(b.words[0]&k)&&g<26;++g,k<<=1);if(g>0)for(b.iushrn(g);g-- >0;)T.isOdd()&&T.iadd(B),T.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(T)):(b.isub(p),T.isub(S))}var H;return p.cmpn(1)===0?H=S:H=T,H.cmpn(0)<0&&H.iadd(l),H},o.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),b=l.clone();p.negative=0,b.negative=0;for(var S=0;p.isEven()&&b.isEven();S++)p.iushrn(1),b.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;b.isEven();)b.iushrn(1);var T=p.cmp(b);if(T<0){var B=p;p=b,b=B}else if(T===0||b.cmpn(1)===0)break;p.isub(b)}while(!0);return b.iushln(S)},o.prototype.invm=function(l){return this.egcd(l).a.umod(l)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(l){return this.words[0]&l},o.prototype.bincn=function(l){n(typeof l=="number");var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return this._expand(b+1),this.words[b]|=S,this;for(var T=S,B=b;T!==0&&B<this.length;B++){var $=this.words[B]|0;$+=T,T=$>>>26,$&=67108863,this.words[B]=$}return T!==0&&(this.words[B]=T,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var b;if(this.length>1)b=1;else{p&&(l=-l),n(l<=67108863,"Number is too big");var S=this.words[0]|0;b=S===l?0:S<l?-1:1}return this.negative!==0?-b|0:b},o.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},o.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,b=this.length-1;b>=0;b--){var S=this.words[b]|0,T=l.words[b]|0;if(S!==T){S<T?p=-1:S>T&&(p=1);break}}return p},o.prototype.gtn=function(l){return this.cmpn(l)===1},o.prototype.gt=function(l){return this.cmp(l)===1},o.prototype.gten=function(l){return this.cmpn(l)>=0},o.prototype.gte=function(l){return this.cmp(l)>=0},o.prototype.ltn=function(l){return this.cmpn(l)===-1},o.prototype.lt=function(l){return this.cmp(l)===-1},o.prototype.lten=function(l){return this.cmpn(l)<=0},o.prototype.lte=function(l){return this.cmp(l)<=0},o.prototype.eqn=function(l){return this.cmpn(l)===0},o.prototype.eq=function(l){return this.cmp(l)===0},o.red=function(l){return new G(l)},o.prototype.toRed=function(l){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(l){return this.red=l,this},o.prototype.forceRed=function(l){return n(!this.red,"Already a number in reduction context"),this._forceRed(l)},o.prototype.redAdd=function(l){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},o.prototype.redIAdd=function(l){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},o.prototype.redSub=function(l){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},o.prototype.redISub=function(l){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},o.prototype.redShl=function(l){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},o.prototype.redMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},o.prototype.redIMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(l){return n(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var F={k256:null,p224:null,p192:null,p25519:null};function U(O,l){this.name=O,this.p=new o(l,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var l=new o(null);return l.words=new Array(Math.ceil(this.n/13)),l},U.prototype.ireduce=function(l){var p=l,b;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),b=p.bitLength();while(b>this.n);var S=b<this.n?-1:p.ucmp(this.p);return S===0?(p.words[0]=0,p.length=1):S>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},U.prototype.split=function(l,p){l.iushrn(this.n,0,p)},U.prototype.imulK=function(l){return l.imul(this.k)};function j(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(j,U),j.prototype.split=function(l,p){for(var b=4194303,S=Math.min(l.length,9),T=0;T<S;T++)p.words[T]=l.words[T];if(p.length=S,l.length<=9){l.words[0]=0,l.length=1;return}var B=l.words[9];for(p.words[p.length++]=B&b,T=10;T<l.length;T++){var $=l.words[T]|0;l.words[T-10]=($&b)<<4|B>>>22,B=$}B>>>=22,l.words[T-10]=B,B===0&&l.length>10?l.length-=10:l.length-=9},j.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,b=0;b<l.length;b++){var S=l.words[b]|0;p+=S*977,l.words[b]=p&67108863,p=S*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function W(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(W,U);function X(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(X,U);function J(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(J,U),J.prototype.imulK=function(l){for(var p=0,b=0;b<l.length;b++){var S=(l.words[b]|0)*19+p,T=S&67108863;S>>>=26,l.words[b]=T,p=S}return p!==0&&(l.words[l.length++]=p),l},o._prime=function(l){if(F[l])return F[l];var p;if(l==="k256")p=new j;else if(l==="p224")p=new W;else if(l==="p192")p=new X;else if(l==="p25519")p=new J;else throw new Error("Unknown prime "+l);return F[l]=p,p};function G(O){if(typeof O=="string"){var l=o._prime(O);this.m=l.p,this.prime=l}else n(O.gtn(1),"modulus must be greater than 1"),this.m=O,this.prime=null}G.prototype._verify1=function(l){n(l.negative===0,"red works only with positives"),n(l.red,"red works only with red numbers")},G.prototype._verify2=function(l,p){n((l.negative|p.negative)===0,"red works only with positives"),n(l.red&&l.red===p.red,"red works only with red numbers")},G.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):l.umod(this.m)._forceRed(this)},G.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},G.prototype.add=function(l,p){this._verify2(l,p);var b=l.add(p);return b.cmp(this.m)>=0&&b.isub(this.m),b._forceRed(this)},G.prototype.iadd=function(l,p){this._verify2(l,p);var b=l.iadd(p);return b.cmp(this.m)>=0&&b.isub(this.m),b},G.prototype.sub=function(l,p){this._verify2(l,p);var b=l.sub(p);return b.cmpn(0)<0&&b.iadd(this.m),b._forceRed(this)},G.prototype.isub=function(l,p){this._verify2(l,p);var b=l.isub(p);return b.cmpn(0)<0&&b.iadd(this.m),b},G.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},G.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},G.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},G.prototype.isqr=function(l){return this.imul(l,l.clone())},G.prototype.sqr=function(l){return this.mul(l,l)},G.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(n(p%2===1),p===3){var b=this.m.add(new o(1)).iushrn(2);return this.pow(l,b)}for(var S=this.m.subn(1),T=0;!S.isZero()&&S.andln(1)===0;)T++,S.iushrn(1);n(!S.isZero());var B=new o(1).toRed(this),$=B.redNeg(),A=this.m.subn(1).iushrn(1),g=this.m.bitLength();for(g=new o(2*g*g).toRed(this);this.pow(g,A).cmp($)!==0;)g.redIAdd($);for(var k=this.pow(g,S),H=this.pow(l,S.addn(1).iushrn(1)),z=this.pow(l,S),Q=T;z.cmp(B)!==0;){for(var ie=z,ne=0;ie.cmp(B)!==0;ne++)ie=ie.redSqr();n(ne<Q);var Z=this.pow(k,new o(1).iushln(Q-ne-1));H=H.redMul(Z),k=Z.redSqr(),z=z.redMul(k),Q=ne}return H},G.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},G.prototype.pow=function(l,p){if(p.isZero())return new o(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var b=4,S=new Array(1<<b);S[0]=new o(1).toRed(this),S[1]=l;for(var T=2;T<S.length;T++)S[T]=this.mul(S[T-1],l);var B=S[0],$=0,A=0,g=p.bitLength()%26;for(g===0&&(g=26),T=p.length-1;T>=0;T--){for(var k=p.words[T],H=g-1;H>=0;H--){var z=k>>H&1;if(B!==S[0]&&(B=this.sqr(B)),z===0&&$===0){A=0;continue}$<<=1,$|=z,A++,!(A!==b&&(T!==0||H!==0))&&(B=this.mul(B,S[$]),A=0,$=0)}g=26}return B},G.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},G.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},o.mont=function(l){return new oe(l)};function oe(O){G.call(this,O),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(oe,G),oe.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},oe.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},oe.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var b=l.imul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new o(0)._forceRed(this);var b=l.mul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,commonjsGlobal)}(bn$3)),bn$3.exports}var utils$1={},hasRequiredUtils$2;function requireUtils$2(){return hasRequiredUtils$2||(hasRequiredUtils$2=1,function(r){var e=r;function t(o,c){if(Array.isArray(o))return o.slice();if(!o)return[];var u=[];if(typeof o!="string"){for(var v=0;v<o.length;v++)u[v]=o[v]|0;return u}if(c==="hex"){o=o.replace(/[^a-z0-9]+/ig,""),o.length%2!==0&&(o="0"+o);for(var v=0;v<o.length;v+=2)u.push(parseInt(o[v]+o[v+1],16))}else for(var v=0;v<o.length;v++){var _=o.charCodeAt(v),x=_>>8,E=_&255;x?u.push(x,E):u.push(E)}return u}e.toArray=t;function n(o){return o.length===1?"0"+o:o}e.zero2=n;function a(o){for(var c="",u=0;u<o.length;u++)c+=n(o[u].toString(16));return c}e.toHex=a,e.encode=function(c,u){return u==="hex"?a(c):c}}(utils$1)),utils$1}var hasRequiredUtils$1;function requireUtils$1(){return hasRequiredUtils$1||(hasRequiredUtils$1=1,function(r){var e=r,t=requireBn$3(),n=requireMinimalisticAssert(),a=requireUtils$2();e.assert=n,e.toArray=a.toArray,e.zero2=a.zero2,e.toHex=a.toHex,e.encode=a.encode;function o(x,E,M){var C=new Array(Math.max(x.bitLength(),M)+1),I;for(I=0;I<C.length;I+=1)C[I]=0;var D=1<<E+1,L=x.clone();for(I=0;I<C.length;I++){var N,q=L.andln(D-1);L.isOdd()?(q>(D>>1)-1?N=(D>>1)-q:N=q,L.isubn(N)):N=0,C[I]=N,L.iushrn(1)}return C}e.getNAF=o;function c(x,E){var M=[[],[]];x=x.clone(),E=E.clone();for(var C=0,I=0,D;x.cmpn(-C)>0||E.cmpn(-I)>0;){var L=x.andln(3)+C&3,N=E.andln(3)+I&3;L===3&&(L=-1),N===3&&(N=-1);var q;L&1?(D=x.andln(7)+C&7,(D===3||D===5)&&N===2?q=-L:q=L):q=0,M[0].push(q);var F;N&1?(D=E.andln(7)+I&7,(D===3||D===5)&&L===2?F=-N:F=N):F=0,M[1].push(F),2*C===q+1&&(C=1-C),2*I===F+1&&(I=1-I),x.iushrn(1),E.iushrn(1)}return M}e.getJSF=c;function u(x,E,M){var C="_"+E;x.prototype[E]=function(){return this[C]!==void 0?this[C]:this[C]=M.call(this)}}e.cachedProperty=u;function v(x){return typeof x=="string"?e.toArray(x,"hex"):x}e.parseBytes=v;function _(x){return new t(x,"hex","le")}e.intFromLE=_}(utils$2)),utils$2}var curve={},base$2,hasRequiredBase$1;function requireBase$1(){if(hasRequiredBase$1)return base$2;hasRequiredBase$1=1;var r=requireBn$3(),e=requireUtils$1(),t=e.getNAF,n=e.getJSF,a=e.assert;function o(u,v){this.type=u,this.p=new r(v.p,16),this.red=v.prime?r.red(v.prime):r.mont(this.p),this.zero=new r(0).toRed(this.red),this.one=new r(1).toRed(this.red),this.two=new r(2).toRed(this.red),this.n=v.n&&new r(v.n,16),this.g=v.g&&this.pointFromJSON(v.g,v.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var _=this.n&&this.p.div(this.n);!_||_.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}base$2=o,o.prototype.point=function(){throw new Error("Not implemented")},o.prototype.validate=function(){throw new Error("Not implemented")},o.prototype._fixedNafMul=function(v,_){a(v.precomputed);var x=v._getDoubles(),E=t(_,1,this._bitLength),M=(1<<x.step+1)-(x.step%2===0?2:1);M/=3;var C=[],I,D;for(I=0;I<E.length;I+=x.step){D=0;for(var L=I+x.step-1;L>=I;L--)D=(D<<1)+E[L];C.push(D)}for(var N=this.jpoint(null,null,null),q=this.jpoint(null,null,null),F=M;F>0;F--){for(I=0;I<C.length;I++)D=C[I],D===F?q=q.mixedAdd(x.points[I]):D===-F&&(q=q.mixedAdd(x.points[I].neg()));N=N.add(q)}return N.toP()},o.prototype._wnafMul=function(v,_){var x=4,E=v._getNAFPoints(x);x=E.wnd;for(var M=E.points,C=t(_,x,this._bitLength),I=this.jpoint(null,null,null),D=C.length-1;D>=0;D--){for(var L=0;D>=0&&C[D]===0;D--)L++;if(D>=0&&L++,I=I.dblp(L),D<0)break;var N=C[D];a(N!==0),v.type==="affine"?N>0?I=I.mixedAdd(M[N-1>>1]):I=I.mixedAdd(M[-N-1>>1].neg()):N>0?I=I.add(M[N-1>>1]):I=I.add(M[-N-1>>1].neg())}return v.type==="affine"?I.toP():I},o.prototype._wnafMulAdd=function(v,_,x,E,M){var C=this._wnafT1,I=this._wnafT2,D=this._wnafT3,L=0,N,q,F;for(N=0;N<E;N++){F=_[N];var U=F._getNAFPoints(v);C[N]=U.wnd,I[N]=U.points}for(N=E-1;N>=1;N-=2){var j=N-1,W=N;if(C[j]!==1||C[W]!==1){D[j]=t(x[j],C[j],this._bitLength),D[W]=t(x[W],C[W],this._bitLength),L=Math.max(D[j].length,L),L=Math.max(D[W].length,L);continue}var X=[_[j],null,null,_[W]];_[j].y.cmp(_[W].y)===0?(X[1]=_[j].add(_[W]),X[2]=_[j].toJ().mixedAdd(_[W].neg())):_[j].y.cmp(_[W].y.redNeg())===0?(X[1]=_[j].toJ().mixedAdd(_[W]),X[2]=_[j].add(_[W].neg())):(X[1]=_[j].toJ().mixedAdd(_[W]),X[2]=_[j].toJ().mixedAdd(_[W].neg()));var J=[-3,-1,-5,-7,0,7,5,1,3],G=n(x[j],x[W]);for(L=Math.max(G[0].length,L),D[j]=new Array(L),D[W]=new Array(L),q=0;q<L;q++){var oe=G[0][q]|0,O=G[1][q]|0;D[j][q]=J[(oe+1)*3+(O+1)],D[W][q]=0,I[j]=X}}var l=this.jpoint(null,null,null),p=this._wnafT4;for(N=L;N>=0;N--){for(var b=0;N>=0;){var S=!0;for(q=0;q<E;q++)p[q]=D[q][N]|0,p[q]!==0&&(S=!1);if(!S)break;b++,N--}if(N>=0&&b++,l=l.dblp(b),N<0)break;for(q=0;q<E;q++){var T=p[q];T!==0&&(T>0?F=I[q][T-1>>1]:T<0&&(F=I[q][-T-1>>1].neg()),F.type==="affine"?l=l.mixedAdd(F):l=l.add(F))}}for(N=0;N<E;N++)I[N]=null;return M?l:l.toP()};function c(u,v){this.curve=u,this.type=v,this.precomputed=null}return o.BasePoint=c,c.prototype.eq=function(){throw new Error("Not implemented")},c.prototype.validate=function(){return this.curve.validate(this)},o.prototype.decodePoint=function(v,_){v=e.toArray(v,_);var x=this.p.byteLength();if((v[0]===4||v[0]===6||v[0]===7)&&v.length-1===2*x){v[0]===6?a(v[v.length-1]%2===0):v[0]===7&&a(v[v.length-1]%2===1);var E=this.point(v.slice(1,1+x),v.slice(1+x,1+2*x));return E}else if((v[0]===2||v[0]===3)&&v.length-1===x)return this.pointFromX(v.slice(1,1+x),v[0]===3);throw new Error("Unknown point format")},c.prototype.encodeCompressed=function(v){return this.encode(v,!0)},c.prototype._encode=function(v){var _=this.curve.p.byteLength(),x=this.getX().toArray("be",_);return v?[this.getY().isEven()?2:3].concat(x):[4].concat(x,this.getY().toArray("be",_))},c.prototype.encode=function(v,_){return e.encode(this._encode(_),v)},c.prototype.precompute=function(v){if(this.precomputed)return this;var _={doubles:null,naf:null,beta:null};return _.naf=this._getNAFPoints(8),_.doubles=this._getDoubles(4,v),_.beta=this._getBeta(),this.precomputed=_,this},c.prototype._hasDoubles=function(v){if(!this.precomputed)return!1;var _=this.precomputed.doubles;return _?_.points.length>=Math.ceil((v.bitLength()+1)/_.step):!1},c.prototype._getDoubles=function(v,_){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var x=[this],E=this,M=0;M<_;M+=v){for(var C=0;C<v;C++)E=E.dbl();x.push(E)}return{step:v,points:x}},c.prototype._getNAFPoints=function(v){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var _=[this],x=(1<<v)-1,E=x===1?null:this.dbl(),M=1;M<x;M++)_[M]=_[M-1].add(E);return{wnd:v,points:_}},c.prototype._getBeta=function(){return null},c.prototype.dblp=function(v){for(var _=this,x=0;x<v;x++)_=_.dbl();return _},base$2}var short,hasRequiredShort;function requireShort(){if(hasRequiredShort)return short;hasRequiredShort=1;var r=requireUtils$1(),e=requireBn$3(),t=requireInherits_browser(),n=requireBase$1(),a=r.assert;function o(v){n.call(this,"short",v),this.a=new e(v.a,16).toRed(this.red),this.b=new e(v.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(v),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}t(o,n),short=o,o.prototype._getEndomorphism=function(_){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var x,E;if(_.beta)x=new e(_.beta,16).toRed(this.red);else{var M=this._getEndoRoots(this.p);x=M[0].cmp(M[1])<0?M[0]:M[1],x=x.toRed(this.red)}if(_.lambda)E=new e(_.lambda,16);else{var C=this._getEndoRoots(this.n);this.g.mul(C[0]).x.cmp(this.g.x.redMul(x))===0?E=C[0]:(E=C[1],a(this.g.mul(E).x.cmp(this.g.x.redMul(x))===0))}var I;return _.basis?I=_.basis.map(function(D){return{a:new e(D.a,16),b:new e(D.b,16)}}):I=this._getEndoBasis(E),{beta:x,lambda:E,basis:I}}},o.prototype._getEndoRoots=function(_){var x=_===this.p?this.red:e.mont(_),E=new e(2).toRed(x).redInvm(),M=E.redNeg(),C=new e(3).toRed(x).redNeg().redSqrt().redMul(E),I=M.redAdd(C).fromRed(),D=M.redSub(C).fromRed();return[I,D]},o.prototype._getEndoBasis=function(_){for(var x=this.n.ushrn(Math.floor(this.n.bitLength()/2)),E=_,M=this.n.clone(),C=new e(1),I=new e(0),D=new e(0),L=new e(1),N,q,F,U,j,W,X,J=0,G,oe;E.cmpn(0)!==0;){var O=M.div(E);G=M.sub(O.mul(E)),oe=D.sub(O.mul(C));var l=L.sub(O.mul(I));if(!F&&G.cmp(x)<0)N=X.neg(),q=C,F=G.neg(),U=oe;else if(F&&++J===2)break;X=G,M=E,E=G,D=C,C=oe,L=I,I=l}j=G.neg(),W=oe;var p=F.sqr().add(U.sqr()),b=j.sqr().add(W.sqr());return b.cmp(p)>=0&&(j=N,W=q),F.negative&&(F=F.neg(),U=U.neg()),j.negative&&(j=j.neg(),W=W.neg()),[{a:F,b:U},{a:j,b:W}]},o.prototype._endoSplit=function(_){var x=this.endo.basis,E=x[0],M=x[1],C=M.b.mul(_).divRound(this.n),I=E.b.neg().mul(_).divRound(this.n),D=C.mul(E.a),L=I.mul(M.a),N=C.mul(E.b),q=I.mul(M.b),F=_.sub(D).sub(L),U=N.add(q).neg();return{k1:F,k2:U}},o.prototype.pointFromX=function(_,x){_=new e(_,16),_.red||(_=_.toRed(this.red));var E=_.redSqr().redMul(_).redIAdd(_.redMul(this.a)).redIAdd(this.b),M=E.redSqrt();if(M.redSqr().redSub(E).cmp(this.zero)!==0)throw new Error("invalid point");var C=M.fromRed().isOdd();return(x&&!C||!x&&C)&&(M=M.redNeg()),this.point(_,M)},o.prototype.validate=function(_){if(_.inf)return!0;var x=_.x,E=_.y,M=this.a.redMul(x),C=x.redSqr().redMul(x).redIAdd(M).redIAdd(this.b);return E.redSqr().redISub(C).cmpn(0)===0},o.prototype._endoWnafMulAdd=function(_,x,E){for(var M=this._endoWnafT1,C=this._endoWnafT2,I=0;I<_.length;I++){var D=this._endoSplit(x[I]),L=_[I],N=L._getBeta();D.k1.negative&&(D.k1.ineg(),L=L.neg(!0)),D.k2.negative&&(D.k2.ineg(),N=N.neg(!0)),M[I*2]=L,M[I*2+1]=N,C[I*2]=D.k1,C[I*2+1]=D.k2}for(var q=this._wnafMulAdd(1,M,C,I*2,E),F=0;F<I*2;F++)M[F]=null,C[F]=null;return q};function c(v,_,x,E){n.BasePoint.call(this,v,"affine"),_===null&&x===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new e(_,16),this.y=new e(x,16),E&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}t(c,n.BasePoint),o.prototype.point=function(_,x,E){return new c(this,_,x,E)},o.prototype.pointFromJSON=function(_,x){return c.fromJSON(this,_,x)},c.prototype._getBeta=function(){if(this.curve.endo){var _=this.precomputed;if(_&&_.beta)return _.beta;var x=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(_){var E=this.curve,M=function(C){return E.point(C.x.redMul(E.endo.beta),C.y)};_.beta=x,x.precomputed={beta:null,naf:_.naf&&{wnd:_.naf.wnd,points:_.naf.points.map(M)},doubles:_.doubles&&{step:_.doubles.step,points:_.doubles.points.map(M)}}}return x}},c.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},c.fromJSON=function(_,x,E){typeof x=="string"&&(x=JSON.parse(x));var M=_.point(x[0],x[1],E);if(!x[2])return M;function C(D){return _.point(D[0],D[1],E)}var I=x[2];return M.precomputed={beta:null,doubles:I.doubles&&{step:I.doubles.step,points:[M].concat(I.doubles.points.map(C))},naf:I.naf&&{wnd:I.naf.wnd,points:[M].concat(I.naf.points.map(C))}},M},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return this.inf},c.prototype.add=function(_){if(this.inf)return _;if(_.inf)return this;if(this.eq(_))return this.dbl();if(this.neg().eq(_))return this.curve.point(null,null);if(this.x.cmp(_.x)===0)return this.curve.point(null,null);var x=this.y.redSub(_.y);x.cmpn(0)!==0&&(x=x.redMul(this.x.redSub(_.x).redInvm()));var E=x.redSqr().redISub(this.x).redISub(_.x),M=x.redMul(this.x.redSub(E)).redISub(this.y);return this.curve.point(E,M)},c.prototype.dbl=function(){if(this.inf)return this;var _=this.y.redAdd(this.y);if(_.cmpn(0)===0)return this.curve.point(null,null);var x=this.curve.a,E=this.x.redSqr(),M=_.redInvm(),C=E.redAdd(E).redIAdd(E).redIAdd(x).redMul(M),I=C.redSqr().redISub(this.x.redAdd(this.x)),D=C.redMul(this.x.redSub(I)).redISub(this.y);return this.curve.point(I,D)},c.prototype.getX=function(){return this.x.fromRed()},c.prototype.getY=function(){return this.y.fromRed()},c.prototype.mul=function(_){return _=new e(_,16),this.isInfinity()?this:this._hasDoubles(_)?this.curve._fixedNafMul(this,_):this.curve.endo?this.curve._endoWnafMulAdd([this],[_]):this.curve._wnafMul(this,_)},c.prototype.mulAdd=function(_,x,E){var M=[this,x],C=[_,E];return this.curve.endo?this.curve._endoWnafMulAdd(M,C):this.curve._wnafMulAdd(1,M,C,2)},c.prototype.jmulAdd=function(_,x,E){var M=[this,x],C=[_,E];return this.curve.endo?this.curve._endoWnafMulAdd(M,C,!0):this.curve._wnafMulAdd(1,M,C,2,!0)},c.prototype.eq=function(_){return this===_||this.inf===_.inf&&(this.inf||this.x.cmp(_.x)===0&&this.y.cmp(_.y)===0)},c.prototype.neg=function(_){if(this.inf)return this;var x=this.curve.point(this.x,this.y.redNeg());if(_&&this.precomputed){var E=this.precomputed,M=function(C){return C.neg()};x.precomputed={naf:E.naf&&{wnd:E.naf.wnd,points:E.naf.points.map(M)},doubles:E.doubles&&{step:E.doubles.step,points:E.doubles.points.map(M)}}}return x},c.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var _=this.curve.jpoint(this.x,this.y,this.curve.one);return _};function u(v,_,x,E){n.BasePoint.call(this,v,"jacobian"),_===null&&x===null&&E===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new e(0)):(this.x=new e(_,16),this.y=new e(x,16),this.z=new e(E,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}return t(u,n.BasePoint),o.prototype.jpoint=function(_,x,E){return new u(this,_,x,E)},u.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var _=this.z.redInvm(),x=_.redSqr(),E=this.x.redMul(x),M=this.y.redMul(x).redMul(_);return this.curve.point(E,M)},u.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},u.prototype.add=function(_){if(this.isInfinity())return _;if(_.isInfinity())return this;var x=_.z.redSqr(),E=this.z.redSqr(),M=this.x.redMul(x),C=_.x.redMul(E),I=this.y.redMul(x.redMul(_.z)),D=_.y.redMul(E.redMul(this.z)),L=M.redSub(C),N=I.redSub(D);if(L.cmpn(0)===0)return N.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var q=L.redSqr(),F=q.redMul(L),U=M.redMul(q),j=N.redSqr().redIAdd(F).redISub(U).redISub(U),W=N.redMul(U.redISub(j)).redISub(I.redMul(F)),X=this.z.redMul(_.z).redMul(L);return this.curve.jpoint(j,W,X)},u.prototype.mixedAdd=function(_){if(this.isInfinity())return _.toJ();if(_.isInfinity())return this;var x=this.z.redSqr(),E=this.x,M=_.x.redMul(x),C=this.y,I=_.y.redMul(x).redMul(this.z),D=E.redSub(M),L=C.redSub(I);if(D.cmpn(0)===0)return L.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var N=D.redSqr(),q=N.redMul(D),F=E.redMul(N),U=L.redSqr().redIAdd(q).redISub(F).redISub(F),j=L.redMul(F.redISub(U)).redISub(C.redMul(q)),W=this.z.redMul(D);return this.curve.jpoint(U,j,W)},u.prototype.dblp=function(_){if(_===0)return this;if(this.isInfinity())return this;if(!_)return this.dbl();var x;if(this.curve.zeroA||this.curve.threeA){var E=this;for(x=0;x<_;x++)E=E.dbl();return E}var M=this.curve.a,C=this.curve.tinv,I=this.x,D=this.y,L=this.z,N=L.redSqr().redSqr(),q=D.redAdd(D);for(x=0;x<_;x++){var F=I.redSqr(),U=q.redSqr(),j=U.redSqr(),W=F.redAdd(F).redIAdd(F).redIAdd(M.redMul(N)),X=I.redMul(U),J=W.redSqr().redISub(X.redAdd(X)),G=X.redISub(J),oe=W.redMul(G);oe=oe.redIAdd(oe).redISub(j);var O=q.redMul(L);x+1<_&&(N=N.redMul(j)),I=J,L=O,q=oe}return this.curve.jpoint(I,q.redMul(C),L)},u.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},u.prototype._zeroDbl=function(){var _,x,E;if(this.zOne){var M=this.x.redSqr(),C=this.y.redSqr(),I=C.redSqr(),D=this.x.redAdd(C).redSqr().redISub(M).redISub(I);D=D.redIAdd(D);var L=M.redAdd(M).redIAdd(M),N=L.redSqr().redISub(D).redISub(D),q=I.redIAdd(I);q=q.redIAdd(q),q=q.redIAdd(q),_=N,x=L.redMul(D.redISub(N)).redISub(q),E=this.y.redAdd(this.y)}else{var F=this.x.redSqr(),U=this.y.redSqr(),j=U.redSqr(),W=this.x.redAdd(U).redSqr().redISub(F).redISub(j);W=W.redIAdd(W);var X=F.redAdd(F).redIAdd(F),J=X.redSqr(),G=j.redIAdd(j);G=G.redIAdd(G),G=G.redIAdd(G),_=J.redISub(W).redISub(W),x=X.redMul(W.redISub(_)).redISub(G),E=this.y.redMul(this.z),E=E.redIAdd(E)}return this.curve.jpoint(_,x,E)},u.prototype._threeDbl=function(){var _,x,E;if(this.zOne){var M=this.x.redSqr(),C=this.y.redSqr(),I=C.redSqr(),D=this.x.redAdd(C).redSqr().redISub(M).redISub(I);D=D.redIAdd(D);var L=M.redAdd(M).redIAdd(M).redIAdd(this.curve.a),N=L.redSqr().redISub(D).redISub(D);_=N;var q=I.redIAdd(I);q=q.redIAdd(q),q=q.redIAdd(q),x=L.redMul(D.redISub(N)).redISub(q),E=this.y.redAdd(this.y)}else{var F=this.z.redSqr(),U=this.y.redSqr(),j=this.x.redMul(U),W=this.x.redSub(F).redMul(this.x.redAdd(F));W=W.redAdd(W).redIAdd(W);var X=j.redIAdd(j);X=X.redIAdd(X);var J=X.redAdd(X);_=W.redSqr().redISub(J),E=this.y.redAdd(this.z).redSqr().redISub(U).redISub(F);var G=U.redSqr();G=G.redIAdd(G),G=G.redIAdd(G),G=G.redIAdd(G),x=W.redMul(X.redISub(_)).redISub(G)}return this.curve.jpoint(_,x,E)},u.prototype._dbl=function(){var _=this.curve.a,x=this.x,E=this.y,M=this.z,C=M.redSqr().redSqr(),I=x.redSqr(),D=E.redSqr(),L=I.redAdd(I).redIAdd(I).redIAdd(_.redMul(C)),N=x.redAdd(x);N=N.redIAdd(N);var q=N.redMul(D),F=L.redSqr().redISub(q.redAdd(q)),U=q.redISub(F),j=D.redSqr();j=j.redIAdd(j),j=j.redIAdd(j),j=j.redIAdd(j);var W=L.redMul(U).redISub(j),X=E.redAdd(E).redMul(M);return this.curve.jpoint(F,W,X)},u.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var _=this.x.redSqr(),x=this.y.redSqr(),E=this.z.redSqr(),M=x.redSqr(),C=_.redAdd(_).redIAdd(_),I=C.redSqr(),D=this.x.redAdd(x).redSqr().redISub(_).redISub(M);D=D.redIAdd(D),D=D.redAdd(D).redIAdd(D),D=D.redISub(I);var L=D.redSqr(),N=M.redIAdd(M);N=N.redIAdd(N),N=N.redIAdd(N),N=N.redIAdd(N);var q=C.redIAdd(D).redSqr().redISub(I).redISub(L).redISub(N),F=x.redMul(q);F=F.redIAdd(F),F=F.redIAdd(F);var U=this.x.redMul(L).redISub(F);U=U.redIAdd(U),U=U.redIAdd(U);var j=this.y.redMul(q.redMul(N.redISub(q)).redISub(D.redMul(L)));j=j.redIAdd(j),j=j.redIAdd(j),j=j.redIAdd(j);var W=this.z.redAdd(D).redSqr().redISub(E).redISub(L);return this.curve.jpoint(U,j,W)},u.prototype.mul=function(_,x){return _=new e(_,x),this.curve._wnafMul(this,_)},u.prototype.eq=function(_){if(_.type==="affine")return this.eq(_.toJ());if(this===_)return!0;var x=this.z.redSqr(),E=_.z.redSqr();if(this.x.redMul(E).redISub(_.x.redMul(x)).cmpn(0)!==0)return!1;var M=x.redMul(this.z),C=E.redMul(_.z);return this.y.redMul(C).redISub(_.y.redMul(M)).cmpn(0)===0},u.prototype.eqXToP=function(_){var x=this.z.redSqr(),E=_.toRed(this.curve.red).redMul(x);if(this.x.cmp(E)===0)return!0;for(var M=_.clone(),C=this.curve.redN.redMul(x);;){if(M.iadd(this.curve.n),M.cmp(this.curve.p)>=0)return!1;if(E.redIAdd(C),this.x.cmp(E)===0)return!0}},u.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},u.prototype.isInfinity=function(){return this.z.cmpn(0)===0},short}var mont,hasRequiredMont;function requireMont(){if(hasRequiredMont)return mont;hasRequiredMont=1;var r=requireBn$3(),e=requireInherits_browser(),t=requireBase$1(),n=requireUtils$1();function a(c){t.call(this,"mont",c),this.a=new r(c.a,16).toRed(this.red),this.b=new r(c.b,16).toRed(this.red),this.i4=new r(4).toRed(this.red).redInvm(),this.two=new r(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}e(a,t),mont=a,a.prototype.validate=function(u){var v=u.normalize().x,_=v.redSqr(),x=_.redMul(v).redAdd(_.redMul(this.a)).redAdd(v),E=x.redSqrt();return E.redSqr().cmp(x)===0};function o(c,u,v){t.BasePoint.call(this,c,"projective"),u===null&&v===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new r(u,16),this.z=new r(v,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}return e(o,t.BasePoint),a.prototype.decodePoint=function(u,v){return this.point(n.toArray(u,v),1)},a.prototype.point=function(u,v){return new o(this,u,v)},a.prototype.pointFromJSON=function(u){return o.fromJSON(this,u)},o.prototype.precompute=function(){},o.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},o.fromJSON=function(u,v){return new o(u,v[0],v[1]||u.one)},o.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},o.prototype.isInfinity=function(){return this.z.cmpn(0)===0},o.prototype.dbl=function(){var u=this.x.redAdd(this.z),v=u.redSqr(),_=this.x.redSub(this.z),x=_.redSqr(),E=v.redSub(x),M=v.redMul(x),C=E.redMul(x.redAdd(this.curve.a24.redMul(E)));return this.curve.point(M,C)},o.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},o.prototype.diffAdd=function(u,v){var _=this.x.redAdd(this.z),x=this.x.redSub(this.z),E=u.x.redAdd(u.z),M=u.x.redSub(u.z),C=M.redMul(_),I=E.redMul(x),D=v.z.redMul(C.redAdd(I).redSqr()),L=v.x.redMul(C.redISub(I).redSqr());return this.curve.point(D,L)},o.prototype.mul=function(u){for(var v=u.clone(),_=this,x=this.curve.point(null,null),E=this,M=[];v.cmpn(0)!==0;v.iushrn(1))M.push(v.andln(1));for(var C=M.length-1;C>=0;C--)M[C]===0?(_=_.diffAdd(x,E),x=x.dbl()):(x=_.diffAdd(x,E),_=_.dbl());return x},o.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},o.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},o.prototype.eq=function(u){return this.getX().cmp(u.getX())===0},o.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},o.prototype.getX=function(){return this.normalize(),this.x.fromRed()},mont}var edwards,hasRequiredEdwards;function requireEdwards(){if(hasRequiredEdwards)return edwards;hasRequiredEdwards=1;var r=requireUtils$1(),e=requireBn$3(),t=requireInherits_browser(),n=requireBase$1(),a=r.assert;function o(u){this.twisted=(u.a|0)!==1,this.mOneA=this.twisted&&(u.a|0)===-1,this.extended=this.mOneA,n.call(this,"edwards",u),this.a=new e(u.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new e(u.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new e(u.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),a(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(u.c|0)===1}t(o,n),edwards=o,o.prototype._mulA=function(v){return this.mOneA?v.redNeg():this.a.redMul(v)},o.prototype._mulC=function(v){return this.oneC?v:this.c.redMul(v)},o.prototype.jpoint=function(v,_,x,E){return this.point(v,_,x,E)},o.prototype.pointFromX=function(v,_){v=new e(v,16),v.red||(v=v.toRed(this.red));var x=v.redSqr(),E=this.c2.redSub(this.a.redMul(x)),M=this.one.redSub(this.c2.redMul(this.d).redMul(x)),C=E.redMul(M.redInvm()),I=C.redSqrt();if(I.redSqr().redSub(C).cmp(this.zero)!==0)throw new Error("invalid point");var D=I.fromRed().isOdd();return(_&&!D||!_&&D)&&(I=I.redNeg()),this.point(v,I)},o.prototype.pointFromY=function(v,_){v=new e(v,16),v.red||(v=v.toRed(this.red));var x=v.redSqr(),E=x.redSub(this.c2),M=x.redMul(this.d).redMul(this.c2).redSub(this.a),C=E.redMul(M.redInvm());if(C.cmp(this.zero)===0){if(_)throw new Error("invalid point");return this.point(this.zero,v)}var I=C.redSqrt();if(I.redSqr().redSub(C).cmp(this.zero)!==0)throw new Error("invalid point");return I.fromRed().isOdd()!==_&&(I=I.redNeg()),this.point(I,v)},o.prototype.validate=function(v){if(v.isInfinity())return!0;v.normalize();var _=v.x.redSqr(),x=v.y.redSqr(),E=_.redMul(this.a).redAdd(x),M=this.c2.redMul(this.one.redAdd(this.d.redMul(_).redMul(x)));return E.cmp(M)===0};function c(u,v,_,x,E){n.BasePoint.call(this,u,"projective"),v===null&&_===null&&x===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new e(v,16),this.y=new e(_,16),this.z=x?new e(x,16):this.curve.one,this.t=E&&new e(E,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}return t(c,n.BasePoint),o.prototype.pointFromJSON=function(v){return c.fromJSON(this,v)},o.prototype.point=function(v,_,x,E){return new c(this,v,_,x,E)},c.fromJSON=function(v,_){return new c(v,_[0],_[1],_[2])},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)},c.prototype._extDbl=function(){var v=this.x.redSqr(),_=this.y.redSqr(),x=this.z.redSqr();x=x.redIAdd(x);var E=this.curve._mulA(v),M=this.x.redAdd(this.y).redSqr().redISub(v).redISub(_),C=E.redAdd(_),I=C.redSub(x),D=E.redSub(_),L=M.redMul(I),N=C.redMul(D),q=M.redMul(D),F=I.redMul(C);return this.curve.point(L,N,F,q)},c.prototype._projDbl=function(){var v=this.x.redAdd(this.y).redSqr(),_=this.x.redSqr(),x=this.y.redSqr(),E,M,C,I,D,L;if(this.curve.twisted){I=this.curve._mulA(_);var N=I.redAdd(x);this.zOne?(E=v.redSub(_).redSub(x).redMul(N.redSub(this.curve.two)),M=N.redMul(I.redSub(x)),C=N.redSqr().redSub(N).redSub(N)):(D=this.z.redSqr(),L=N.redSub(D).redISub(D),E=v.redSub(_).redISub(x).redMul(L),M=N.redMul(I.redSub(x)),C=N.redMul(L))}else I=_.redAdd(x),D=this.curve._mulC(this.z).redSqr(),L=I.redSub(D).redSub(D),E=this.curve._mulC(v.redISub(I)).redMul(L),M=this.curve._mulC(I).redMul(_.redISub(x)),C=I.redMul(L);return this.curve.point(E,M,C)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},c.prototype._extAdd=function(v){var _=this.y.redSub(this.x).redMul(v.y.redSub(v.x)),x=this.y.redAdd(this.x).redMul(v.y.redAdd(v.x)),E=this.t.redMul(this.curve.dd).redMul(v.t),M=this.z.redMul(v.z.redAdd(v.z)),C=x.redSub(_),I=M.redSub(E),D=M.redAdd(E),L=x.redAdd(_),N=C.redMul(I),q=D.redMul(L),F=C.redMul(L),U=I.redMul(D);return this.curve.point(N,q,U,F)},c.prototype._projAdd=function(v){var _=this.z.redMul(v.z),x=_.redSqr(),E=this.x.redMul(v.x),M=this.y.redMul(v.y),C=this.curve.d.redMul(E).redMul(M),I=x.redSub(C),D=x.redAdd(C),L=this.x.redAdd(this.y).redMul(v.x.redAdd(v.y)).redISub(E).redISub(M),N=_.redMul(I).redMul(L),q,F;return this.curve.twisted?(q=_.redMul(D).redMul(M.redSub(this.curve._mulA(E))),F=I.redMul(D)):(q=_.redMul(D).redMul(M.redSub(E)),F=this.curve._mulC(I).redMul(D)),this.curve.point(N,q,F)},c.prototype.add=function(v){return this.isInfinity()?v:v.isInfinity()?this:this.curve.extended?this._extAdd(v):this._projAdd(v)},c.prototype.mul=function(v){return this._hasDoubles(v)?this.curve._fixedNafMul(this,v):this.curve._wnafMul(this,v)},c.prototype.mulAdd=function(v,_,x){return this.curve._wnafMulAdd(1,[this,_],[v,x],2,!1)},c.prototype.jmulAdd=function(v,_,x){return this.curve._wnafMulAdd(1,[this,_],[v,x],2,!0)},c.prototype.normalize=function(){if(this.zOne)return this;var v=this.z.redInvm();return this.x=this.x.redMul(v),this.y=this.y.redMul(v),this.t&&(this.t=this.t.redMul(v)),this.z=this.curve.one,this.zOne=!0,this},c.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()},c.prototype.getY=function(){return this.normalize(),this.y.fromRed()},c.prototype.eq=function(v){return this===v||this.getX().cmp(v.getX())===0&&this.getY().cmp(v.getY())===0},c.prototype.eqXToP=function(v){var _=v.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(_)===0)return!0;for(var x=v.clone(),E=this.curve.redN.redMul(this.z);;){if(x.iadd(this.curve.n),x.cmp(this.curve.p)>=0)return!1;if(_.redIAdd(E),this.x.cmp(_)===0)return!0}},c.prototype.toP=c.prototype.normalize,c.prototype.mixedAdd=c.prototype.add,edwards}var hasRequiredCurve;function requireCurve(){return hasRequiredCurve||(hasRequiredCurve=1,function(r){var e=r;e.base=requireBase$1(),e.short=requireShort(),e.mont=requireMont(),e.edwards=requireEdwards()}(curve)),curve}var curves={},hash={},utils={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;var r=requireMinimalisticAssert(),e=requireInherits_browser();utils.inherits=e;function t(l,p){return(l.charCodeAt(p)&64512)!==55296||p<0||p+1>=l.length?!1:(l.charCodeAt(p+1)&64512)===56320}function n(l,p){if(Array.isArray(l))return l.slice();if(!l)return[];var b=[];if(typeof l=="string")if(p){if(p==="hex")for(l=l.replace(/[^a-z0-9]+/ig,""),l.length%2!==0&&(l="0"+l),T=0;T<l.length;T+=2)b.push(parseInt(l[T]+l[T+1],16))}else for(var S=0,T=0;T<l.length;T++){var B=l.charCodeAt(T);B<128?b[S++]=B:B<2048?(b[S++]=B>>6|192,b[S++]=B&63|128):t(l,T)?(B=65536+((B&1023)<<10)+(l.charCodeAt(++T)&1023),b[S++]=B>>18|240,b[S++]=B>>12&63|128,b[S++]=B>>6&63|128,b[S++]=B&63|128):(b[S++]=B>>12|224,b[S++]=B>>6&63|128,b[S++]=B&63|128)}else for(T=0;T<l.length;T++)b[T]=l[T]|0;return b}utils.toArray=n;function a(l){for(var p="",b=0;b<l.length;b++)p+=u(l[b].toString(16));return p}utils.toHex=a;function o(l){var p=l>>>24|l>>>8&65280|l<<8&16711680|(l&255)<<24;return p>>>0}utils.htonl=o;function c(l,p){for(var b="",S=0;S<l.length;S++){var T=l[S];p==="little"&&(T=o(T)),b+=v(T.toString(16))}return b}utils.toHex32=c;function u(l){return l.length===1?"0"+l:l}utils.zero2=u;function v(l){return l.length===7?"0"+l:l.length===6?"00"+l:l.length===5?"000"+l:l.length===4?"0000"+l:l.length===3?"00000"+l:l.length===2?"000000"+l:l.length===1?"0000000"+l:l}utils.zero8=v;function _(l,p,b,S){var T=b-p;r(T%4===0);for(var B=new Array(T/4),$=0,A=p;$<B.length;$++,A+=4){var g;S==="big"?g=l[A]<<24|l[A+1]<<16|l[A+2]<<8|l[A+3]:g=l[A+3]<<24|l[A+2]<<16|l[A+1]<<8|l[A],B[$]=g>>>0}return B}utils.join32=_;function x(l,p){for(var b=new Array(l.length*4),S=0,T=0;S<l.length;S++,T+=4){var B=l[S];p==="big"?(b[T]=B>>>24,b[T+1]=B>>>16&255,b[T+2]=B>>>8&255,b[T+3]=B&255):(b[T+3]=B>>>24,b[T+2]=B>>>16&255,b[T+1]=B>>>8&255,b[T]=B&255)}return b}utils.split32=x;function E(l,p){return l>>>p|l<<32-p}utils.rotr32=E;function M(l,p){return l<<p|l>>>32-p}utils.rotl32=M;function C(l,p){return l+p>>>0}utils.sum32=C;function I(l,p,b){return l+p+b>>>0}utils.sum32_3=I;function D(l,p,b,S){return l+p+b+S>>>0}utils.sum32_4=D;function L(l,p,b,S,T){return l+p+b+S+T>>>0}utils.sum32_5=L;function N(l,p,b,S){var T=l[p],B=l[p+1],$=S+B>>>0,A=($<S?1:0)+b+T;l[p]=A>>>0,l[p+1]=$}utils.sum64=N;function q(l,p,b,S){var T=p+S>>>0,B=(T<p?1:0)+l+b;return B>>>0}utils.sum64_hi=q;function F(l,p,b,S){var T=p+S;return T>>>0}utils.sum64_lo=F;function U(l,p,b,S,T,B,$,A){var g=0,k=p;k=k+S>>>0,g+=k<p?1:0,k=k+B>>>0,g+=k<B?1:0,k=k+A>>>0,g+=k<A?1:0;var H=l+b+T+$+g;return H>>>0}utils.sum64_4_hi=U;function j(l,p,b,S,T,B,$,A){var g=p+S+B+A;return g>>>0}utils.sum64_4_lo=j;function W(l,p,b,S,T,B,$,A,g,k){var H=0,z=p;z=z+S>>>0,H+=z<p?1:0,z=z+B>>>0,H+=z<B?1:0,z=z+A>>>0,H+=z<A?1:0,z=z+k>>>0,H+=z<k?1:0;var Q=l+b+T+$+g+H;return Q>>>0}utils.sum64_5_hi=W;function X(l,p,b,S,T,B,$,A,g,k){var H=p+S+B+A+k;return H>>>0}utils.sum64_5_lo=X;function J(l,p,b){var S=p<<32-b|l>>>b;return S>>>0}utils.rotr64_hi=J;function G(l,p,b){var S=l<<32-b|p>>>b;return S>>>0}utils.rotr64_lo=G;function oe(l,p,b){return l>>>b}utils.shr64_hi=oe;function O(l,p,b){var S=l<<32-b|p>>>b;return S>>>0}return utils.shr64_lo=O,utils}var common$1={},hasRequiredCommon$1;function requireCommon$1(){if(hasRequiredCommon$1)return common$1;hasRequiredCommon$1=1;var r=requireUtils(),e=requireMinimalisticAssert();function t(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}return common$1.BlockHash=t,t.prototype.update=function(a,o){if(a=r.toArray(a,o),this.pending?this.pending=this.pending.concat(a):this.pending=a,this.pendingTotal+=a.length,this.pending.length>=this._delta8){a=this.pending;var c=a.length%this._delta8;this.pending=a.slice(a.length-c,a.length),this.pending.length===0&&(this.pending=null),a=r.join32(a,0,a.length-c,this.endian);for(var u=0;u<a.length;u+=this._delta32)this._update(a,u,u+this._delta32)}return this},t.prototype.digest=function(a){return this.update(this._pad()),e(this.pending===null),this._digest(a)},t.prototype._pad=function(){var a=this.pendingTotal,o=this._delta8,c=o-(a+this.padLength)%o,u=new Array(c+this.padLength);u[0]=128;for(var v=1;v<c;v++)u[v]=0;if(a<<=3,this.endian==="big"){for(var _=8;_<this.padLength;_++)u[v++]=0;u[v++]=0,u[v++]=0,u[v++]=0,u[v++]=0,u[v++]=a>>>24&255,u[v++]=a>>>16&255,u[v++]=a>>>8&255,u[v++]=a&255}else for(u[v++]=a&255,u[v++]=a>>>8&255,u[v++]=a>>>16&255,u[v++]=a>>>24&255,u[v++]=0,u[v++]=0,u[v++]=0,u[v++]=0,_=8;_<this.padLength;_++)u[v++]=0;return u},common$1}var sha={},common={},hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;var r=requireUtils(),e=r.rotr32;function t(x,E,M,C){if(x===0)return n(E,M,C);if(x===1||x===3)return o(E,M,C);if(x===2)return a(E,M,C)}common.ft_1=t;function n(x,E,M){return x&E^~x&M}common.ch32=n;function a(x,E,M){return x&E^x&M^E&M}common.maj32=a;function o(x,E,M){return x^E^M}common.p32=o;function c(x){return e(x,2)^e(x,13)^e(x,22)}common.s0_256=c;function u(x){return e(x,6)^e(x,11)^e(x,25)}common.s1_256=u;function v(x){return e(x,7)^e(x,18)^x>>>3}common.g0_256=v;function _(x){return e(x,17)^e(x,19)^x>>>10}return common.g1_256=_,common}var _1,hasRequired_1;function require_1(){if(hasRequired_1)return _1;hasRequired_1=1;var r=requireUtils(),e=requireCommon$1(),t=requireCommon(),n=r.rotl32,a=r.sum32,o=r.sum32_5,c=t.ft_1,u=e.BlockHash,v=[1518500249,1859775393,2400959708,3395469782];function _(){if(!(this instanceof _))return new _;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}return r.inherits(_,u),_1=_,_.blockSize=512,_.outSize=160,_.hmacStrength=80,_.padLength=64,_.prototype._update=function(E,M){for(var C=this.W,I=0;I<16;I++)C[I]=E[M+I];for(;I<C.length;I++)C[I]=n(C[I-3]^C[I-8]^C[I-14]^C[I-16],1);var D=this.h[0],L=this.h[1],N=this.h[2],q=this.h[3],F=this.h[4];for(I=0;I<C.length;I++){var U=~~(I/20),j=o(n(D,5),c(U,L,N,q),F,C[I],v[U]);F=q,q=N,N=n(L,30),L=D,D=j}this.h[0]=a(this.h[0],D),this.h[1]=a(this.h[1],L),this.h[2]=a(this.h[2],N),this.h[3]=a(this.h[3],q),this.h[4]=a(this.h[4],F)},_.prototype._digest=function(E){return E==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")},_1}var _256,hasRequired_256;function require_256(){if(hasRequired_256)return _256;hasRequired_256=1;var r=requireUtils(),e=requireCommon$1(),t=requireCommon(),n=requireMinimalisticAssert(),a=r.sum32,o=r.sum32_4,c=r.sum32_5,u=t.ch32,v=t.maj32,_=t.s0_256,x=t.s1_256,E=t.g0_256,M=t.g1_256,C=e.BlockHash,I=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function D(){if(!(this instanceof D))return new D;C.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=I,this.W=new Array(64)}return r.inherits(D,C),_256=D,D.blockSize=512,D.outSize=256,D.hmacStrength=192,D.padLength=64,D.prototype._update=function(N,q){for(var F=this.W,U=0;U<16;U++)F[U]=N[q+U];for(;U<F.length;U++)F[U]=o(M(F[U-2]),F[U-7],E(F[U-15]),F[U-16]);var j=this.h[0],W=this.h[1],X=this.h[2],J=this.h[3],G=this.h[4],oe=this.h[5],O=this.h[6],l=this.h[7];for(n(this.k.length===F.length),U=0;U<F.length;U++){var p=c(l,x(G),u(G,oe,O),this.k[U],F[U]),b=a(_(j),v(j,W,X));l=O,O=oe,oe=G,G=a(J,p),J=X,X=W,W=j,j=a(p,b)}this.h[0]=a(this.h[0],j),this.h[1]=a(this.h[1],W),this.h[2]=a(this.h[2],X),this.h[3]=a(this.h[3],J),this.h[4]=a(this.h[4],G),this.h[5]=a(this.h[5],oe),this.h[6]=a(this.h[6],O),this.h[7]=a(this.h[7],l)},D.prototype._digest=function(N){return N==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")},_256}var _224,hasRequired_224;function require_224(){if(hasRequired_224)return _224;hasRequired_224=1;var r=requireUtils(),e=require_256();function t(){if(!(this instanceof t))return new t;e.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}return r.inherits(t,e),_224=t,t.blockSize=512,t.outSize=224,t.hmacStrength=192,t.padLength=64,t.prototype._digest=function(a){return a==="hex"?r.toHex32(this.h.slice(0,7),"big"):r.split32(this.h.slice(0,7),"big")},_224}var _512,hasRequired_512;function require_512(){if(hasRequired_512)return _512;hasRequired_512=1;var r=requireUtils(),e=requireCommon$1(),t=requireMinimalisticAssert(),n=r.rotr64_hi,a=r.rotr64_lo,o=r.shr64_hi,c=r.shr64_lo,u=r.sum64,v=r.sum64_hi,_=r.sum64_lo,x=r.sum64_4_hi,E=r.sum64_4_lo,M=r.sum64_5_hi,C=r.sum64_5_lo,I=e.BlockHash,D=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function L(){if(!(this instanceof L))return new L;I.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=D,this.W=new Array(160)}r.inherits(L,I),_512=L,L.blockSize=1024,L.outSize=512,L.hmacStrength=192,L.padLength=128,L.prototype._prepareBlock=function(b,S){for(var T=this.W,B=0;B<32;B++)T[B]=b[S+B];for(;B<T.length;B+=2){var $=O(T[B-4],T[B-3]),A=l(T[B-4],T[B-3]),g=T[B-14],k=T[B-13],H=G(T[B-30],T[B-29]),z=oe(T[B-30],T[B-29]),Q=T[B-32],ie=T[B-31];T[B]=x($,A,g,k,H,z,Q,ie),T[B+1]=E($,A,g,k,H,z,Q,ie)}},L.prototype._update=function(b,S){this._prepareBlock(b,S);var T=this.W,B=this.h[0],$=this.h[1],A=this.h[2],g=this.h[3],k=this.h[4],H=this.h[5],z=this.h[6],Q=this.h[7],ie=this.h[8],ne=this.h[9],Z=this.h[10],se=this.h[11],ae=this.h[12],ce=this.h[13],le=this.h[14],te=this.h[15];t(this.k.length===T.length);for(var he=0;he<T.length;he+=2){var Ae=le,ge=te,me=X(ie,ne),je=J(ie,ne),we=N(ie,ne,Z,se,ae),pe=q(ie,ne,Z,se,ae,ce),Ke=this.k[he],ye=this.k[he+1],xe=T[he],Ve=T[he+1],be=M(Ae,ge,me,je,we,pe,Ke,ye,xe,Ve),Ee=C(Ae,ge,me,je,we,pe,Ke,ye,xe,Ve);Ae=j(B,$),ge=W(B,$),me=F(B,$,A,g,k),je=U(B,$,A,g,k,H);var Ge=v(Ae,ge,me,je),re=_(Ae,ge,me,je);le=ae,te=ce,ae=Z,ce=se,Z=ie,se=ne,ie=v(z,Q,be,Ee),ne=_(Q,Q,be,Ee),z=k,Q=H,k=A,H=g,A=B,g=$,B=v(be,Ee,Ge,re),$=_(be,Ee,Ge,re)}u(this.h,0,B,$),u(this.h,2,A,g),u(this.h,4,k,H),u(this.h,6,z,Q),u(this.h,8,ie,ne),u(this.h,10,Z,se),u(this.h,12,ae,ce),u(this.h,14,le,te)},L.prototype._digest=function(b){return b==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")};function N(p,b,S,T,B){var $=p&S^~p&B;return $<0&&($+=4294967296),$}function q(p,b,S,T,B,$){var A=b&T^~b&$;return A<0&&(A+=4294967296),A}function F(p,b,S,T,B){var $=p&S^p&B^S&B;return $<0&&($+=4294967296),$}function U(p,b,S,T,B,$){var A=b&T^b&$^T&$;return A<0&&(A+=4294967296),A}function j(p,b){var S=n(p,b,28),T=n(b,p,2),B=n(b,p,7),$=S^T^B;return $<0&&($+=4294967296),$}function W(p,b){var S=a(p,b,28),T=a(b,p,2),B=a(b,p,7),$=S^T^B;return $<0&&($+=4294967296),$}function X(p,b){var S=n(p,b,14),T=n(p,b,18),B=n(b,p,9),$=S^T^B;return $<0&&($+=4294967296),$}function J(p,b){var S=a(p,b,14),T=a(p,b,18),B=a(b,p,9),$=S^T^B;return $<0&&($+=4294967296),$}function G(p,b){var S=n(p,b,1),T=n(p,b,8),B=o(p,b,7),$=S^T^B;return $<0&&($+=4294967296),$}function oe(p,b){var S=a(p,b,1),T=a(p,b,8),B=c(p,b,7),$=S^T^B;return $<0&&($+=4294967296),$}function O(p,b){var S=n(p,b,19),T=n(b,p,29),B=o(p,b,6),$=S^T^B;return $<0&&($+=4294967296),$}function l(p,b){var S=a(p,b,19),T=a(b,p,29),B=c(p,b,6),$=S^T^B;return $<0&&($+=4294967296),$}return _512}var _384,hasRequired_384;function require_384(){if(hasRequired_384)return _384;hasRequired_384=1;var r=requireUtils(),e=require_512();function t(){if(!(this instanceof t))return new t;e.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}return r.inherits(t,e),_384=t,t.blockSize=1024,t.outSize=384,t.hmacStrength=192,t.padLength=128,t.prototype._digest=function(a){return a==="hex"?r.toHex32(this.h.slice(0,12),"big"):r.split32(this.h.slice(0,12),"big")},_384}var hasRequiredSha;function requireSha(){return hasRequiredSha||(hasRequiredSha=1,sha.sha1=require_1(),sha.sha224=require_224(),sha.sha256=require_256(),sha.sha384=require_384(),sha.sha512=require_512()),sha}var ripemd={},hasRequiredRipemd;function requireRipemd(){if(hasRequiredRipemd)return ripemd;hasRequiredRipemd=1;var r=requireUtils(),e=requireCommon$1(),t=r.rotl32,n=r.sum32,a=r.sum32_3,o=r.sum32_4,c=e.BlockHash;function u(){if(!(this instanceof u))return new u;c.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}r.inherits(u,c),ripemd.ripemd160=u,u.blockSize=512,u.outSize=160,u.hmacStrength=192,u.padLength=64,u.prototype._update=function(L,N){for(var q=this.h[0],F=this.h[1],U=this.h[2],j=this.h[3],W=this.h[4],X=q,J=F,G=U,oe=j,O=W,l=0;l<80;l++){var p=n(t(o(q,v(l,F,U,j),L[E[l]+N],_(l)),C[l]),W);q=W,W=j,j=t(U,10),U=F,F=p,p=n(t(o(X,v(79-l,J,G,oe),L[M[l]+N],x(l)),I[l]),O),X=O,O=oe,oe=t(G,10),G=J,J=p}p=a(this.h[1],U,oe),this.h[1]=a(this.h[2],j,O),this.h[2]=a(this.h[3],W,X),this.h[3]=a(this.h[4],q,J),this.h[4]=a(this.h[0],F,G),this.h[0]=p},u.prototype._digest=function(L){return L==="hex"?r.toHex32(this.h,"little"):r.split32(this.h,"little")};function v(D,L,N,q){return D<=15?L^N^q:D<=31?L&N|~L&q:D<=47?(L|~N)^q:D<=63?L&q|N&~q:L^(N|~q)}function _(D){return D<=15?0:D<=31?1518500249:D<=47?1859775393:D<=63?2400959708:2840853838}function x(D){return D<=15?1352829926:D<=31?1548603684:D<=47?1836072691:D<=63?2053994217:0}var E=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],M=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],C=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],I=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];return ripemd}var hmac,hasRequiredHmac;function requireHmac(){if(hasRequiredHmac)return hmac;hasRequiredHmac=1;var r=requireUtils(),e=requireMinimalisticAssert();function t(n,a,o){if(!(this instanceof t))return new t(n,a,o);this.Hash=n,this.blockSize=n.blockSize/8,this.outSize=n.outSize/8,this.inner=null,this.outer=null,this._init(r.toArray(a,o))}return hmac=t,t.prototype._init=function(a){a.length>this.blockSize&&(a=new this.Hash().update(a).digest()),e(a.length<=this.blockSize);for(var o=a.length;o<this.blockSize;o++)a.push(0);for(o=0;o<a.length;o++)a[o]^=54;for(this.inner=new this.Hash().update(a),o=0;o<a.length;o++)a[o]^=106;this.outer=new this.Hash().update(a)},t.prototype.update=function(a,o){return this.inner.update(a,o),this},t.prototype.digest=function(a){return this.outer.update(this.inner.digest()),this.outer.digest(a)},hmac}var hasRequiredHash;function requireHash(){return hasRequiredHash||(hasRequiredHash=1,function(r){var e=r;e.utils=requireUtils(),e.common=requireCommon$1(),e.sha=requireSha(),e.ripemd=requireRipemd(),e.hmac=requireHmac(),e.sha1=e.sha.sha1,e.sha256=e.sha.sha256,e.sha224=e.sha.sha224,e.sha384=e.sha.sha384,e.sha512=e.sha.sha512,e.ripemd160=e.ripemd.ripemd160}(hash)),hash}var secp256k1$1,hasRequiredSecp256k1;function requireSecp256k1(){return hasRequiredSecp256k1||(hasRequiredSecp256k1=1,secp256k1$1={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),secp256k1$1}var hasRequiredCurves;function requireCurves(){return hasRequiredCurves||(hasRequiredCurves=1,function(r){var e=r,t=requireHash(),n=requireCurve(),a=requireUtils$1(),o=a.assert;function c(_){_.type==="short"?this.curve=new n.short(_):_.type==="edwards"?this.curve=new n.edwards(_):this.curve=new n.mont(_),this.g=this.curve.g,this.n=this.curve.n,this.hash=_.hash,o(this.g.validate(),"Invalid curve"),o(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=c;function u(_,x){Object.defineProperty(e,_,{configurable:!0,enumerable:!0,get:function(){var E=new c(x);return Object.defineProperty(e,_,{configurable:!0,enumerable:!0,value:E}),E}})}u("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:t.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),u("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:t.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),u("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:t.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),u("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:t.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),u("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:t.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),u("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:t.sha256,gRed:!1,g:["9"]}),u("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:t.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var v;try{v=requireSecp256k1()}catch{v=void 0}u("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:t.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",v]})}(curves)),curves}var hmacDrbg,hasRequiredHmacDrbg;function requireHmacDrbg(){if(hasRequiredHmacDrbg)return hmacDrbg;hasRequiredHmacDrbg=1;var r=requireHash(),e=requireUtils$2(),t=requireMinimalisticAssert();function n(a){if(!(this instanceof n))return new n(a);this.hash=a.hash,this.predResist=!!a.predResist,this.outLen=this.hash.outSize,this.minEntropy=a.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var o=e.toArray(a.entropy,a.entropyEnc||"hex"),c=e.toArray(a.nonce,a.nonceEnc||"hex"),u=e.toArray(a.pers,a.persEnc||"hex");t(o.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(o,c,u)}return hmacDrbg=n,n.prototype._init=function(o,c,u){var v=o.concat(c).concat(u);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var _=0;_<this.V.length;_++)this.K[_]=0,this.V[_]=1;this._update(v),this._reseed=1,this.reseedInterval=281474976710656},n.prototype._hmac=function(){return new r.hmac(this.hash,this.K)},n.prototype._update=function(o){var c=this._hmac().update(this.V).update([0]);o&&(c=c.update(o)),this.K=c.digest(),this.V=this._hmac().update(this.V).digest(),o&&(this.K=this._hmac().update(this.V).update([1]).update(o).digest(),this.V=this._hmac().update(this.V).digest())},n.prototype.reseed=function(o,c,u,v){typeof c!="string"&&(v=u,u=c,c=null),o=e.toArray(o,c),u=e.toArray(u,v),t(o.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(o.concat(u||[])),this._reseed=1},n.prototype.generate=function(o,c,u,v){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof c!="string"&&(v=u,u=c,c=null),u&&(u=e.toArray(u,v||"hex"),this._update(u));for(var _=[];_.length<o;)this.V=this._hmac().update(this.V).digest(),_=_.concat(this.V);var x=_.slice(0,o);return this._update(u),this._reseed++,e.encode(x,c)},hmacDrbg}var key$1,hasRequiredKey$1;function requireKey$1(){if(hasRequiredKey$1)return key$1;hasRequiredKey$1=1;var r=requireBn$3(),e=requireUtils$1(),t=e.assert;function n(a,o){this.ec=a,this.priv=null,this.pub=null,o.priv&&this._importPrivate(o.priv,o.privEnc),o.pub&&this._importPublic(o.pub,o.pubEnc)}return key$1=n,n.fromPublic=function(o,c,u){return c instanceof n?c:new n(o,{pub:c,pubEnc:u})},n.fromPrivate=function(o,c,u){return c instanceof n?c:new n(o,{priv:c,privEnc:u})},n.prototype.validate=function(){var o=this.getPublic();return o.isInfinity()?{result:!1,reason:"Invalid public key"}:o.validate()?o.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},n.prototype.getPublic=function(o,c){return typeof o=="string"&&(c=o,o=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),c?this.pub.encode(c,o):this.pub},n.prototype.getPrivate=function(o){return o==="hex"?this.priv.toString(16,2):this.priv},n.prototype._importPrivate=function(o,c){this.priv=new r(o,c||16),this.priv=this.priv.umod(this.ec.curve.n)},n.prototype._importPublic=function(o,c){if(o.x||o.y){this.ec.curve.type==="mont"?t(o.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&t(o.x&&o.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(o.x,o.y);return}this.pub=this.ec.curve.decodePoint(o,c)},n.prototype.derive=function(o){return o.validate()||t(o.validate(),"public point not validated"),o.mul(this.priv).getX()},n.prototype.sign=function(o,c,u){return this.ec.sign(o,this,c,u)},n.prototype.verify=function(o,c,u){return this.ec.verify(o,c,this,void 0,u)},n.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"},key$1}var signature$1,hasRequiredSignature$1;function requireSignature$1(){if(hasRequiredSignature$1)return signature$1;hasRequiredSignature$1=1;var r=requireBn$3(),e=requireUtils$1(),t=e.assert;function n(v,_){if(v instanceof n)return v;this._importDER(v,_)||(t(v.r&&v.s,"Signature without r or s"),this.r=new r(v.r,16),this.s=new r(v.s,16),v.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=v.recoveryParam)}signature$1=n;function a(){this.place=0}function o(v,_){var x=v[_.place++];if(!(x&128))return x;var E=x&15;if(E===0||E>4||v[_.place]===0)return!1;for(var M=0,C=0,I=_.place;C<E;C++,I++)M<<=8,M|=v[I],M>>>=0;return M<=127?!1:(_.place=I,M)}function c(v){for(var _=0,x=v.length-1;!v[_]&&!(v[_+1]&128)&&_<x;)_++;return _===0?v:v.slice(_)}n.prototype._importDER=function(_,x){_=e.toArray(_,x);var E=new a;if(_[E.place++]!==48)return!1;var M=o(_,E);if(M===!1||M+E.place!==_.length||_[E.place++]!==2)return!1;var C=o(_,E);if(C===!1||_[E.place]&128)return!1;var I=_.slice(E.place,C+E.place);if(E.place+=C,_[E.place++]!==2)return!1;var D=o(_,E);if(D===!1||_.length!==D+E.place||_[E.place]&128)return!1;var L=_.slice(E.place,D+E.place);if(I[0]===0)if(I[1]&128)I=I.slice(1);else return!1;if(L[0]===0)if(L[1]&128)L=L.slice(1);else return!1;return this.r=new r(I),this.s=new r(L),this.recoveryParam=null,!0};function u(v,_){if(_<128){v.push(_);return}var x=1+(Math.log(_)/Math.LN2>>>3);for(v.push(x|128);--x;)v.push(_>>>(x<<3)&255);v.push(_)}return n.prototype.toDER=function(_){var x=this.r.toArray(),E=this.s.toArray();for(x[0]&128&&(x=[0].concat(x)),E[0]&128&&(E=[0].concat(E)),x=c(x),E=c(E);!E[0]&&!(E[1]&128);)E=E.slice(1);var M=[2];u(M,x.length),M=M.concat(x),M.push(2),u(M,E.length);var C=M.concat(E),I=[48];return u(I,C.length),I=I.concat(C),e.encode(I,_)},signature$1}var ec,hasRequiredEc;function requireEc(){if(hasRequiredEc)return ec;hasRequiredEc=1;var r=requireBn$3(),e=requireHmacDrbg(),t=requireUtils$1(),n=requireCurves(),a=requireBrorand(),o=t.assert,c=requireKey$1(),u=requireSignature$1();function v(_){if(!(this instanceof v))return new v(_);typeof _=="string"&&(o(Object.prototype.hasOwnProperty.call(n,_),"Unknown curve "+_),_=n[_]),_ instanceof n.PresetCurve&&(_={curve:_}),this.curve=_.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=_.curve.g,this.g.precompute(_.curve.n.bitLength()+1),this.hash=_.hash||_.curve.hash}return ec=v,v.prototype.keyPair=function(x){return new c(this,x)},v.prototype.keyFromPrivate=function(x,E){return c.fromPrivate(this,x,E)},v.prototype.keyFromPublic=function(x,E){return c.fromPublic(this,x,E)},v.prototype.genKeyPair=function(x){x||(x={});for(var E=new e({hash:this.hash,pers:x.pers,persEnc:x.persEnc||"utf8",entropy:x.entropy||a(this.hash.hmacStrength),entropyEnc:x.entropy&&x.entropyEnc||"utf8",nonce:this.n.toArray()}),M=this.n.byteLength(),C=this.n.sub(new r(2));;){var I=new r(E.generate(M));if(!(I.cmp(C)>0))return I.iaddn(1),this.keyFromPrivate(I)}},v.prototype._truncateToN=function(x,E,M){var C;if(r.isBN(x)||typeof x=="number")x=new r(x,16),C=x.byteLength();else if(typeof x=="object")C=x.length,x=new r(x,16);else{var I=x.toString();C=I.length+1>>>1,x=new r(I,16)}typeof M!="number"&&(M=C*8);var D=M-this.n.bitLength();return D>0&&(x=x.ushrn(D)),!E&&x.cmp(this.n)>=0?x.sub(this.n):x},v.prototype.sign=function(x,E,M,C){if(typeof M=="object"&&(C=M,M=null),C||(C={}),typeof x!="string"&&typeof x!="number"&&!r.isBN(x)){o(typeof x=="object"&&x&&typeof x.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),o(x.length>>>0===x.length);for(var I=0;I<x.length;I++)o((x[I]&255)===x[I])}E=this.keyFromPrivate(E,M),x=this._truncateToN(x,!1,C.msgBitLength),o(!x.isNeg(),"Can not sign a negative message");var D=this.n.byteLength(),L=E.getPrivate().toArray("be",D),N=x.toArray("be",D);o(new r(N).eq(x),"Can not sign message");for(var q=new e({hash:this.hash,entropy:L,nonce:N,pers:C.pers,persEnc:C.persEnc||"utf8"}),F=this.n.sub(new r(1)),U=0;;U++){var j=C.k?C.k(U):new r(q.generate(this.n.byteLength()));if(j=this._truncateToN(j,!0),!(j.cmpn(1)<=0||j.cmp(F)>=0)){var W=this.g.mul(j);if(!W.isInfinity()){var X=W.getX(),J=X.umod(this.n);if(J.cmpn(0)!==0){var G=j.invm(this.n).mul(J.mul(E.getPrivate()).iadd(x));if(G=G.umod(this.n),G.cmpn(0)!==0){var oe=(W.getY().isOdd()?1:0)|(X.cmp(J)!==0?2:0);return C.canonical&&G.cmp(this.nh)>0&&(G=this.n.sub(G),oe^=1),new u({r:J,s:G,recoveryParam:oe})}}}}}},v.prototype.verify=function(x,E,M,C,I){I||(I={}),x=this._truncateToN(x,!1,I.msgBitLength),M=this.keyFromPublic(M,C),E=new u(E,"hex");var D=E.r,L=E.s;if(D.cmpn(1)<0||D.cmp(this.n)>=0||L.cmpn(1)<0||L.cmp(this.n)>=0)return!1;var N=L.invm(this.n),q=N.mul(x).umod(this.n),F=N.mul(D).umod(this.n),U;return this.curve._maxwellTrick?(U=this.g.jmulAdd(q,M.getPublic(),F),U.isInfinity()?!1:U.eqXToP(D)):(U=this.g.mulAdd(q,M.getPublic(),F),U.isInfinity()?!1:U.getX().umod(this.n).cmp(D)===0)},v.prototype.recoverPubKey=function(_,x,E,M){o((3&E)===E,"The recovery param is more than two bits"),x=new u(x,M);var C=this.n,I=new r(_),D=x.r,L=x.s,N=E&1,q=E>>1;if(D.cmp(this.curve.p.umod(this.curve.n))>=0&&q)throw new Error("Unable to find sencond key candinate");q?D=this.curve.pointFromX(D.add(this.curve.n),N):D=this.curve.pointFromX(D,N);var F=x.r.invm(C),U=C.sub(I).mul(F).umod(C),j=L.mul(F).umod(C);return this.g.mulAdd(U,D,j)},v.prototype.getKeyRecoveryParam=function(_,x,E,M){if(x=new u(x,M),x.recoveryParam!==null)return x.recoveryParam;for(var C=0;C<4;C++){var I;try{I=this.recoverPubKey(_,x,C)}catch{continue}if(I.eq(E))return C}throw new Error("Unable to find valid recovery factor")},ec}var key,hasRequiredKey;function requireKey(){if(hasRequiredKey)return key;hasRequiredKey=1;var r=requireUtils$1(),e=r.assert,t=r.parseBytes,n=r.cachedProperty;function a(o,c){this.eddsa=o,this._secret=t(c.secret),o.isPoint(c.pub)?this._pub=c.pub:this._pubBytes=t(c.pub)}return a.fromPublic=function(c,u){return u instanceof a?u:new a(c,{pub:u})},a.fromSecret=function(c,u){return u instanceof a?u:new a(c,{secret:u})},a.prototype.secret=function(){return this._secret},n(a,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),n(a,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),n(a,"privBytes",function(){var c=this.eddsa,u=this.hash(),v=c.encodingLength-1,_=u.slice(0,c.encodingLength);return _[0]&=248,_[v]&=127,_[v]|=64,_}),n(a,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),n(a,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),n(a,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),a.prototype.sign=function(c){return e(this._secret,"KeyPair can only verify"),this.eddsa.sign(c,this)},a.prototype.verify=function(c,u){return this.eddsa.verify(c,u,this)},a.prototype.getSecret=function(c){return e(this._secret,"KeyPair is public only"),r.encode(this.secret(),c)},a.prototype.getPublic=function(c){return r.encode(this.pubBytes(),c)},key=a,key}var signature,hasRequiredSignature;function requireSignature(){if(hasRequiredSignature)return signature;hasRequiredSignature=1;var r=requireBn$3(),e=requireUtils$1(),t=e.assert,n=e.cachedProperty,a=e.parseBytes;function o(c,u){this.eddsa=c,typeof u!="object"&&(u=a(u)),Array.isArray(u)&&(t(u.length===c.encodingLength*2,"Signature has invalid size"),u={R:u.slice(0,c.encodingLength),S:u.slice(c.encodingLength)}),t(u.R&&u.S,"Signature without R or S"),c.isPoint(u.R)&&(this._R=u.R),u.S instanceof r&&(this._S=u.S),this._Rencoded=Array.isArray(u.R)?u.R:u.Rencoded,this._Sencoded=Array.isArray(u.S)?u.S:u.Sencoded}return n(o,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),n(o,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),n(o,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),n(o,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),o.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},o.prototype.toHex=function(){return e.encode(this.toBytes(),"hex").toUpperCase()},signature=o,signature}var eddsa,hasRequiredEddsa;function requireEddsa(){if(hasRequiredEddsa)return eddsa;hasRequiredEddsa=1;var r=requireHash(),e=requireCurves(),t=requireUtils$1(),n=t.assert,a=t.parseBytes,o=requireKey(),c=requireSignature();function u(v){if(n(v==="ed25519","only tested with ed25519 so far"),!(this instanceof u))return new u(v);v=e[v].curve,this.curve=v,this.g=v.g,this.g.precompute(v.n.bitLength()+1),this.pointClass=v.point().constructor,this.encodingLength=Math.ceil(v.n.bitLength()/8),this.hash=r.sha512}return eddsa=u,u.prototype.sign=function(_,x){_=a(_);var E=this.keyFromSecret(x),M=this.hashInt(E.messagePrefix(),_),C=this.g.mul(M),I=this.encodePoint(C),D=this.hashInt(I,E.pubBytes(),_).mul(E.priv()),L=M.add(D).umod(this.curve.n);return this.makeSignature({R:C,S:L,Rencoded:I})},u.prototype.verify=function(_,x,E){if(_=a(_),x=this.makeSignature(x),x.S().gte(x.eddsa.curve.n)||x.S().isNeg())return!1;var M=this.keyFromPublic(E),C=this.hashInt(x.Rencoded(),M.pubBytes(),_),I=this.g.mul(x.S()),D=x.R().add(M.pub().mul(C));return D.eq(I)},u.prototype.hashInt=function(){for(var _=this.hash(),x=0;x<arguments.length;x++)_.update(arguments[x]);return t.intFromLE(_.digest()).umod(this.curve.n)},u.prototype.keyFromPublic=function(_){return o.fromPublic(this,_)},u.prototype.keyFromSecret=function(_){return o.fromSecret(this,_)},u.prototype.makeSignature=function(_){return _ instanceof c?_:new c(this,_)},u.prototype.encodePoint=function(_){var x=_.getY().toArray("le",this.encodingLength);return x[this.encodingLength-1]|=_.getX().isOdd()?128:0,x},u.prototype.decodePoint=function(_){_=t.parseBytes(_);var x=_.length-1,E=_.slice(0,x).concat(_[x]&-129),M=(_[x]&128)!==0,C=t.intFromLE(E);return this.curve.pointFromY(C,M)},u.prototype.encodeInt=function(_){return _.toArray("le",this.encodingLength)},u.prototype.decodeInt=function(_){return t.intFromLE(_)},u.prototype.isPoint=function(_){return _ instanceof this.pointClass},eddsa}var hasRequiredElliptic;function requireElliptic(){return hasRequiredElliptic||(hasRequiredElliptic=1,function(r){var e=r;e.version=require$$0.version,e.utils=requireUtils$1(),e.rand=requireBrorand(),e.curve=requireCurve(),e.curves=requireCurves(),e.ec=requireEc(),e.eddsa=requireEddsa()}(elliptic)),elliptic}var asn1$1={},asn1={},bn$2={exports:{}};bn$2.exports;var hasRequiredBn$2;function requireBn$2(){return hasRequiredBn$2||(hasRequiredBn$2=1,function(r){(function(e,t){function n(O,l){if(!O)throw new Error(l||"Assertion failed")}function a(O,l){O.super_=l;var p=function(){};p.prototype=l.prototype,O.prototype=new p,O.prototype.constructor=O}function o(O,l,p){if(o.isBN(O))return O;this.negative=0,this.words=null,this.length=0,this.red=null,O!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(O||0,l||10,p||"be"))}typeof e=="object"?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=bufferPolyfill.Buffer}catch{}o.isBN=function(l){return l instanceof o?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===o.wordSize&&Array.isArray(l.words)},o.max=function(l,p){return l.cmp(p)>0?l:p},o.min=function(l,p){return l.cmp(p)<0?l:p},o.prototype._init=function(l,p,b){if(typeof l=="number")return this._initNumber(l,p,b);if(typeof l=="object")return this._initArray(l,p,b);p==="hex"&&(p=16),n(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var S=0;l[0]==="-"&&(S++,this.negative=1),S<l.length&&(p===16?this._parseHex(l,S,b):(this._parseBase(l,p,S),b==="le"&&this._initArray(this.toArray(),p,b)))},o.prototype._initNumber=function(l,p,b){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(n(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),b==="le"&&this._initArray(this.toArray(),p,b)},o.prototype._initArray=function(l,p,b){if(n(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T,B,$=0;if(b==="be")for(S=l.length-1,T=0;S>=0;S-=3)B=l[S]|l[S-1]<<8|l[S-2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);else if(b==="le")for(S=0,T=0;S<l.length;S+=3)B=l[S]|l[S+1]<<8|l[S+2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);return this.strip()};function u(O,l){var p=O.charCodeAt(l);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function v(O,l,p){var b=u(O,p);return p-1>=l&&(b|=u(O,p-1)<<4),b}o.prototype._parseHex=function(l,p,b){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T=0,B=0,$;if(b==="be")for(S=l.length-1;S>=p;S-=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8;else{var A=l.length-p;for(S=A%2===0?p+1:p;S<l.length;S+=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8}this.strip()};function _(O,l,p,b){for(var S=0,T=Math.min(O.length,p),B=l;B<T;B++){var $=O.charCodeAt(B)-48;S*=b,$>=49?S+=$-49+10:$>=17?S+=$-17+10:S+=$}return S}o.prototype._parseBase=function(l,p,b){this.words=[0],this.length=1;for(var S=0,T=1;T<=67108863;T*=p)S++;S--,T=T/p|0;for(var B=l.length-b,$=B%S,A=Math.min(B,B-$)+b,g=0,k=b;k<A;k+=S)g=_(l,k,k+S,p),this.imuln(T),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g);if($!==0){var H=1;for(g=_(l,k,l.length,p),k=0;k<$;k++)H*=p;this.imuln(H),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g)}this.strip()},o.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red},o.prototype.clone=function(){var l=new o(null);return this.copy(l),l},o.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],E=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],M=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(l,p){l=l||10,p=p|0||1;var b;if(l===16||l==="hex"){b="";for(var S=0,T=0,B=0;B<this.length;B++){var $=this.words[B],A=(($<<S|T)&16777215).toString(16);T=$>>>24-S&16777215,S+=2,S>=26&&(S-=26,B--),T!==0||B!==this.length-1?b=x[6-A.length]+A+b:b=A+b}for(T!==0&&(b=T.toString(16)+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}if(l===(l|0)&&l>=2&&l<=36){var g=E[l],k=M[l];b="";var H=this.clone();for(H.negative=0;!H.isZero();){var z=H.modn(k).toString(l);H=H.idivn(k),H.isZero()?b=z+b:b=x[g-z.length]+z+b}for(this.isZero()&&(b="0"+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(l,p){return n(typeof c<"u"),this.toArrayLike(c,l,p)},o.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)},o.prototype.toArrayLike=function(l,p,b){var S=this.byteLength(),T=b||Math.max(1,S);n(S<=T,"byte array longer than desired length"),n(T>0,"Requested array length <= 0"),this.strip();var B=p==="le",$=new l(T),A,g,k=this.clone();if(B){for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[g]=A;for(;g<T;g++)$[g]=0}else{for(g=0;g<T-S;g++)$[g]=0;for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[T-g-1]=A}return $},Math.clz32?o.prototype._countBits=function(l){return 32-Math.clz32(l)}:o.prototype._countBits=function(l){var p=l,b=0;return p>=4096&&(b+=13,p>>>=13),p>=64&&(b+=7,p>>>=7),p>=8&&(b+=4,p>>>=4),p>=2&&(b+=2,p>>>=2),b+p},o.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,b=0;return p&8191||(b+=13,p>>>=13),p&127||(b+=7,p>>>=7),p&15||(b+=4,p>>>=4),p&3||(b+=2,p>>>=2),p&1||b++,b},o.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function C(O){for(var l=new Array(O.bitLength()),p=0;p<l.length;p++){var b=p/26|0,S=p%26;l[p]=(O.words[b]&1<<S)>>>S}return l}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var b=this._zeroBits(this.words[p]);if(l+=b,b!==26)break}return l},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},o.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this.strip()},o.prototype.ior=function(l){return n((this.negative|l.negative)===0),this.iuor(l)},o.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},o.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},o.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var b=0;b<p.length;b++)this.words[b]=this.words[b]&l.words[b];return this.length=p.length,this.strip()},o.prototype.iand=function(l){return n((this.negative|l.negative)===0),this.iuand(l)},o.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},o.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},o.prototype.iuxor=function(l){var p,b;this.length>l.length?(p=this,b=l):(p=l,b=this);for(var S=0;S<b.length;S++)this.words[S]=p.words[S]^b.words[S];if(this!==p)for(;S<p.length;S++)this.words[S]=p.words[S];return this.length=p.length,this.strip()},o.prototype.ixor=function(l){return n((this.negative|l.negative)===0),this.iuxor(l)},o.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},o.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},o.prototype.inotn=function(l){n(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,b=l%26;this._expand(p),b>0&&p--;for(var S=0;S<p;S++)this.words[S]=~this.words[S]&67108863;return b>0&&(this.words[S]=~this.words[S]&67108863>>26-b),this.strip()},o.prototype.notn=function(l){return this.clone().inotn(l)},o.prototype.setn=function(l,p){n(typeof l=="number"&&l>=0);var b=l/26|0,S=l%26;return this._expand(b+1),p?this.words[b]=this.words[b]|1<<S:this.words[b]=this.words[b]&~(1<<S),this.strip()},o.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var b,S;this.length>l.length?(b=this,S=l):(b=l,S=this);for(var T=0,B=0;B<S.length;B++)p=(b.words[B]|0)+(S.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;for(;T!==0&&B<b.length;B++)p=(b.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;if(this.length=b.length,T!==0)this.words[this.length]=T,this.length++;else if(b!==this)for(;B<b.length;B++)this.words[B]=b.words[B];return this},o.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},o.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var b=this.cmp(l);if(b===0)return this.negative=0,this.length=1,this.words[0]=0,this;var S,T;b>0?(S=this,T=l):(S=l,T=this);for(var B=0,$=0;$<T.length;$++)p=(S.words[$]|0)-(T.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;for(;B!==0&&$<S.length;$++)p=(S.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;if(B===0&&$<S.length&&S!==this)for(;$<S.length;$++)this.words[$]=S.words[$];return this.length=Math.max(this.length,$),S!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(l){return this.clone().isub(l)};function I(O,l,p){p.negative=l.negative^O.negative;var b=O.length+l.length|0;p.length=b,b=b-1|0;var S=O.words[0]|0,T=l.words[0]|0,B=S*T,$=B&67108863,A=B/67108864|0;p.words[0]=$;for(var g=1;g<b;g++){for(var k=A>>>26,H=A&67108863,z=Math.min(g,l.length-1),Q=Math.max(0,g-O.length+1);Q<=z;Q++){var ie=g-Q|0;S=O.words[ie]|0,T=l.words[Q]|0,B=S*T+H,k+=B/67108864|0,H=B&67108863}p.words[g]=H|0,A=k|0}return A!==0?p.words[g]=A|0:p.length--,p.strip()}var D=function(l,p,b){var S=l.words,T=p.words,B=b.words,$=0,A,g,k,H=S[0]|0,z=H&8191,Q=H>>>13,ie=S[1]|0,ne=ie&8191,Z=ie>>>13,se=S[2]|0,ae=se&8191,ce=se>>>13,le=S[3]|0,te=le&8191,he=le>>>13,Ae=S[4]|0,ge=Ae&8191,me=Ae>>>13,je=S[5]|0,we=je&8191,pe=je>>>13,Ke=S[6]|0,ye=Ke&8191,xe=Ke>>>13,Ve=S[7]|0,be=Ve&8191,Ee=Ve>>>13,Ge=S[8]|0,re=Ge&8191,Y=Ge>>>13,ee=S[9]|0,fe=ee&8191,ue=ee>>>13,ve=T[0]|0,de=ve&8191,Se=ve>>>13,We=T[1]|0,_e=We&8191,Me=We>>>13,ze=T[2]|0,Te=ze&8191,$e=ze>>>13,Je=T[3]|0,ke=Je&8191,Oe=Je>>>13,Ze=T[4]|0,Be=Ze&8191,Le=Ze>>>13,Qe=T[5]|0,Re=Qe&8191,Ne=Qe>>>13,et=T[6]|0,Ce=et&8191,qe=et>>>13,tt=T[7]|0,Ie=tt&8191,Fe=tt>>>13,rt=T[8]|0,De=rt&8191,Ue=rt>>>13,nt=T[9]|0,Pe=nt&8191,He=nt>>>13;b.negative=l.negative^p.negative,b.length=19,A=Math.imul(z,de),g=Math.imul(z,Se),g=g+Math.imul(Q,de)|0,k=Math.imul(Q,Se);var Xe=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Xe>>>26)|0,Xe&=67108863,A=Math.imul(ne,de),g=Math.imul(ne,Se),g=g+Math.imul(Z,de)|0,k=Math.imul(Z,Se),A=A+Math.imul(z,_e)|0,g=g+Math.imul(z,Me)|0,g=g+Math.imul(Q,_e)|0,k=k+Math.imul(Q,Me)|0;var Ye=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,A=Math.imul(ae,de),g=Math.imul(ae,Se),g=g+Math.imul(ce,de)|0,k=Math.imul(ce,Se),A=A+Math.imul(ne,_e)|0,g=g+Math.imul(ne,Me)|0,g=g+Math.imul(Z,_e)|0,k=k+Math.imul(Z,Me)|0,A=A+Math.imul(z,Te)|0,g=g+Math.imul(z,$e)|0,g=g+Math.imul(Q,Te)|0,k=k+Math.imul(Q,$e)|0;var it=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(it>>>26)|0,it&=67108863,A=Math.imul(te,de),g=Math.imul(te,Se),g=g+Math.imul(he,de)|0,k=Math.imul(he,Se),A=A+Math.imul(ae,_e)|0,g=g+Math.imul(ae,Me)|0,g=g+Math.imul(ce,_e)|0,k=k+Math.imul(ce,Me)|0,A=A+Math.imul(ne,Te)|0,g=g+Math.imul(ne,$e)|0,g=g+Math.imul(Z,Te)|0,k=k+Math.imul(Z,$e)|0,A=A+Math.imul(z,ke)|0,g=g+Math.imul(z,Oe)|0,g=g+Math.imul(Q,ke)|0,k=k+Math.imul(Q,Oe)|0;var st=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(st>>>26)|0,st&=67108863,A=Math.imul(ge,de),g=Math.imul(ge,Se),g=g+Math.imul(me,de)|0,k=Math.imul(me,Se),A=A+Math.imul(te,_e)|0,g=g+Math.imul(te,Me)|0,g=g+Math.imul(he,_e)|0,k=k+Math.imul(he,Me)|0,A=A+Math.imul(ae,Te)|0,g=g+Math.imul(ae,$e)|0,g=g+Math.imul(ce,Te)|0,k=k+Math.imul(ce,$e)|0,A=A+Math.imul(ne,ke)|0,g=g+Math.imul(ne,Oe)|0,g=g+Math.imul(Z,ke)|0,k=k+Math.imul(Z,Oe)|0,A=A+Math.imul(z,Be)|0,g=g+Math.imul(z,Le)|0,g=g+Math.imul(Q,Be)|0,k=k+Math.imul(Q,Le)|0;var ot=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ot>>>26)|0,ot&=67108863,A=Math.imul(we,de),g=Math.imul(we,Se),g=g+Math.imul(pe,de)|0,k=Math.imul(pe,Se),A=A+Math.imul(ge,_e)|0,g=g+Math.imul(ge,Me)|0,g=g+Math.imul(me,_e)|0,k=k+Math.imul(me,Me)|0,A=A+Math.imul(te,Te)|0,g=g+Math.imul(te,$e)|0,g=g+Math.imul(he,Te)|0,k=k+Math.imul(he,$e)|0,A=A+Math.imul(ae,ke)|0,g=g+Math.imul(ae,Oe)|0,g=g+Math.imul(ce,ke)|0,k=k+Math.imul(ce,Oe)|0,A=A+Math.imul(ne,Be)|0,g=g+Math.imul(ne,Le)|0,g=g+Math.imul(Z,Be)|0,k=k+Math.imul(Z,Le)|0,A=A+Math.imul(z,Re)|0,g=g+Math.imul(z,Ne)|0,g=g+Math.imul(Q,Re)|0,k=k+Math.imul(Q,Ne)|0;var at=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(at>>>26)|0,at&=67108863,A=Math.imul(ye,de),g=Math.imul(ye,Se),g=g+Math.imul(xe,de)|0,k=Math.imul(xe,Se),A=A+Math.imul(we,_e)|0,g=g+Math.imul(we,Me)|0,g=g+Math.imul(pe,_e)|0,k=k+Math.imul(pe,Me)|0,A=A+Math.imul(ge,Te)|0,g=g+Math.imul(ge,$e)|0,g=g+Math.imul(me,Te)|0,k=k+Math.imul(me,$e)|0,A=A+Math.imul(te,ke)|0,g=g+Math.imul(te,Oe)|0,g=g+Math.imul(he,ke)|0,k=k+Math.imul(he,Oe)|0,A=A+Math.imul(ae,Be)|0,g=g+Math.imul(ae,Le)|0,g=g+Math.imul(ce,Be)|0,k=k+Math.imul(ce,Le)|0,A=A+Math.imul(ne,Re)|0,g=g+Math.imul(ne,Ne)|0,g=g+Math.imul(Z,Re)|0,k=k+Math.imul(Z,Ne)|0,A=A+Math.imul(z,Ce)|0,g=g+Math.imul(z,qe)|0,g=g+Math.imul(Q,Ce)|0,k=k+Math.imul(Q,qe)|0;var ft=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ft>>>26)|0,ft&=67108863,A=Math.imul(be,de),g=Math.imul(be,Se),g=g+Math.imul(Ee,de)|0,k=Math.imul(Ee,Se),A=A+Math.imul(ye,_e)|0,g=g+Math.imul(ye,Me)|0,g=g+Math.imul(xe,_e)|0,k=k+Math.imul(xe,Me)|0,A=A+Math.imul(we,Te)|0,g=g+Math.imul(we,$e)|0,g=g+Math.imul(pe,Te)|0,k=k+Math.imul(pe,$e)|0,A=A+Math.imul(ge,ke)|0,g=g+Math.imul(ge,Oe)|0,g=g+Math.imul(me,ke)|0,k=k+Math.imul(me,Oe)|0,A=A+Math.imul(te,Be)|0,g=g+Math.imul(te,Le)|0,g=g+Math.imul(he,Be)|0,k=k+Math.imul(he,Le)|0,A=A+Math.imul(ae,Re)|0,g=g+Math.imul(ae,Ne)|0,g=g+Math.imul(ce,Re)|0,k=k+Math.imul(ce,Ne)|0,A=A+Math.imul(ne,Ce)|0,g=g+Math.imul(ne,qe)|0,g=g+Math.imul(Z,Ce)|0,k=k+Math.imul(Z,qe)|0,A=A+Math.imul(z,Ie)|0,g=g+Math.imul(z,Fe)|0,g=g+Math.imul(Q,Ie)|0,k=k+Math.imul(Q,Fe)|0;var lt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(lt>>>26)|0,lt&=67108863,A=Math.imul(re,de),g=Math.imul(re,Se),g=g+Math.imul(Y,de)|0,k=Math.imul(Y,Se),A=A+Math.imul(be,_e)|0,g=g+Math.imul(be,Me)|0,g=g+Math.imul(Ee,_e)|0,k=k+Math.imul(Ee,Me)|0,A=A+Math.imul(ye,Te)|0,g=g+Math.imul(ye,$e)|0,g=g+Math.imul(xe,Te)|0,k=k+Math.imul(xe,$e)|0,A=A+Math.imul(we,ke)|0,g=g+Math.imul(we,Oe)|0,g=g+Math.imul(pe,ke)|0,k=k+Math.imul(pe,Oe)|0,A=A+Math.imul(ge,Be)|0,g=g+Math.imul(ge,Le)|0,g=g+Math.imul(me,Be)|0,k=k+Math.imul(me,Le)|0,A=A+Math.imul(te,Re)|0,g=g+Math.imul(te,Ne)|0,g=g+Math.imul(he,Re)|0,k=k+Math.imul(he,Ne)|0,A=A+Math.imul(ae,Ce)|0,g=g+Math.imul(ae,qe)|0,g=g+Math.imul(ce,Ce)|0,k=k+Math.imul(ce,qe)|0,A=A+Math.imul(ne,Ie)|0,g=g+Math.imul(ne,Fe)|0,g=g+Math.imul(Z,Ie)|0,k=k+Math.imul(Z,Fe)|0,A=A+Math.imul(z,De)|0,g=g+Math.imul(z,Ue)|0,g=g+Math.imul(Q,De)|0,k=k+Math.imul(Q,Ue)|0;var ct=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ct>>>26)|0,ct&=67108863,A=Math.imul(fe,de),g=Math.imul(fe,Se),g=g+Math.imul(ue,de)|0,k=Math.imul(ue,Se),A=A+Math.imul(re,_e)|0,g=g+Math.imul(re,Me)|0,g=g+Math.imul(Y,_e)|0,k=k+Math.imul(Y,Me)|0,A=A+Math.imul(be,Te)|0,g=g+Math.imul(be,$e)|0,g=g+Math.imul(Ee,Te)|0,k=k+Math.imul(Ee,$e)|0,A=A+Math.imul(ye,ke)|0,g=g+Math.imul(ye,Oe)|0,g=g+Math.imul(xe,ke)|0,k=k+Math.imul(xe,Oe)|0,A=A+Math.imul(we,Be)|0,g=g+Math.imul(we,Le)|0,g=g+Math.imul(pe,Be)|0,k=k+Math.imul(pe,Le)|0,A=A+Math.imul(ge,Re)|0,g=g+Math.imul(ge,Ne)|0,g=g+Math.imul(me,Re)|0,k=k+Math.imul(me,Ne)|0,A=A+Math.imul(te,Ce)|0,g=g+Math.imul(te,qe)|0,g=g+Math.imul(he,Ce)|0,k=k+Math.imul(he,qe)|0,A=A+Math.imul(ae,Ie)|0,g=g+Math.imul(ae,Fe)|0,g=g+Math.imul(ce,Ie)|0,k=k+Math.imul(ce,Fe)|0,A=A+Math.imul(ne,De)|0,g=g+Math.imul(ne,Ue)|0,g=g+Math.imul(Z,De)|0,k=k+Math.imul(Z,Ue)|0,A=A+Math.imul(z,Pe)|0,g=g+Math.imul(z,He)|0,g=g+Math.imul(Q,Pe)|0,k=k+Math.imul(Q,He)|0;var ht=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ht>>>26)|0,ht&=67108863,A=Math.imul(fe,_e),g=Math.imul(fe,Me),g=g+Math.imul(ue,_e)|0,k=Math.imul(ue,Me),A=A+Math.imul(re,Te)|0,g=g+Math.imul(re,$e)|0,g=g+Math.imul(Y,Te)|0,k=k+Math.imul(Y,$e)|0,A=A+Math.imul(be,ke)|0,g=g+Math.imul(be,Oe)|0,g=g+Math.imul(Ee,ke)|0,k=k+Math.imul(Ee,Oe)|0,A=A+Math.imul(ye,Be)|0,g=g+Math.imul(ye,Le)|0,g=g+Math.imul(xe,Be)|0,k=k+Math.imul(xe,Le)|0,A=A+Math.imul(we,Re)|0,g=g+Math.imul(we,Ne)|0,g=g+Math.imul(pe,Re)|0,k=k+Math.imul(pe,Ne)|0,A=A+Math.imul(ge,Ce)|0,g=g+Math.imul(ge,qe)|0,g=g+Math.imul(me,Ce)|0,k=k+Math.imul(me,qe)|0,A=A+Math.imul(te,Ie)|0,g=g+Math.imul(te,Fe)|0,g=g+Math.imul(he,Ie)|0,k=k+Math.imul(he,Fe)|0,A=A+Math.imul(ae,De)|0,g=g+Math.imul(ae,Ue)|0,g=g+Math.imul(ce,De)|0,k=k+Math.imul(ce,Ue)|0,A=A+Math.imul(ne,Pe)|0,g=g+Math.imul(ne,He)|0,g=g+Math.imul(Z,Pe)|0,k=k+Math.imul(Z,He)|0;var dt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(dt>>>26)|0,dt&=67108863,A=Math.imul(fe,Te),g=Math.imul(fe,$e),g=g+Math.imul(ue,Te)|0,k=Math.imul(ue,$e),A=A+Math.imul(re,ke)|0,g=g+Math.imul(re,Oe)|0,g=g+Math.imul(Y,ke)|0,k=k+Math.imul(Y,Oe)|0,A=A+Math.imul(be,Be)|0,g=g+Math.imul(be,Le)|0,g=g+Math.imul(Ee,Be)|0,k=k+Math.imul(Ee,Le)|0,A=A+Math.imul(ye,Re)|0,g=g+Math.imul(ye,Ne)|0,g=g+Math.imul(xe,Re)|0,k=k+Math.imul(xe,Ne)|0,A=A+Math.imul(we,Ce)|0,g=g+Math.imul(we,qe)|0,g=g+Math.imul(pe,Ce)|0,k=k+Math.imul(pe,qe)|0,A=A+Math.imul(ge,Ie)|0,g=g+Math.imul(ge,Fe)|0,g=g+Math.imul(me,Ie)|0,k=k+Math.imul(me,Fe)|0,A=A+Math.imul(te,De)|0,g=g+Math.imul(te,Ue)|0,g=g+Math.imul(he,De)|0,k=k+Math.imul(he,Ue)|0,A=A+Math.imul(ae,Pe)|0,g=g+Math.imul(ae,He)|0,g=g+Math.imul(ce,Pe)|0,k=k+Math.imul(ce,He)|0;var pt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(pt>>>26)|0,pt&=67108863,A=Math.imul(fe,ke),g=Math.imul(fe,Oe),g=g+Math.imul(ue,ke)|0,k=Math.imul(ue,Oe),A=A+Math.imul(re,Be)|0,g=g+Math.imul(re,Le)|0,g=g+Math.imul(Y,Be)|0,k=k+Math.imul(Y,Le)|0,A=A+Math.imul(be,Re)|0,g=g+Math.imul(be,Ne)|0,g=g+Math.imul(Ee,Re)|0,k=k+Math.imul(Ee,Ne)|0,A=A+Math.imul(ye,Ce)|0,g=g+Math.imul(ye,qe)|0,g=g+Math.imul(xe,Ce)|0,k=k+Math.imul(xe,qe)|0,A=A+Math.imul(we,Ie)|0,g=g+Math.imul(we,Fe)|0,g=g+Math.imul(pe,Ie)|0,k=k+Math.imul(pe,Fe)|0,A=A+Math.imul(ge,De)|0,g=g+Math.imul(ge,Ue)|0,g=g+Math.imul(me,De)|0,k=k+Math.imul(me,Ue)|0,A=A+Math.imul(te,Pe)|0,g=g+Math.imul(te,He)|0,g=g+Math.imul(he,Pe)|0,k=k+Math.imul(he,He)|0;var gt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(gt>>>26)|0,gt&=67108863,A=Math.imul(fe,Be),g=Math.imul(fe,Le),g=g+Math.imul(ue,Be)|0,k=Math.imul(ue,Le),A=A+Math.imul(re,Re)|0,g=g+Math.imul(re,Ne)|0,g=g+Math.imul(Y,Re)|0,k=k+Math.imul(Y,Ne)|0,A=A+Math.imul(be,Ce)|0,g=g+Math.imul(be,qe)|0,g=g+Math.imul(Ee,Ce)|0,k=k+Math.imul(Ee,qe)|0,A=A+Math.imul(ye,Ie)|0,g=g+Math.imul(ye,Fe)|0,g=g+Math.imul(xe,Ie)|0,k=k+Math.imul(xe,Fe)|0,A=A+Math.imul(we,De)|0,g=g+Math.imul(we,Ue)|0,g=g+Math.imul(pe,De)|0,k=k+Math.imul(pe,Ue)|0,A=A+Math.imul(ge,Pe)|0,g=g+Math.imul(ge,He)|0,g=g+Math.imul(me,Pe)|0,k=k+Math.imul(me,He)|0;var mt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(mt>>>26)|0,mt&=67108863,A=Math.imul(fe,Re),g=Math.imul(fe,Ne),g=g+Math.imul(ue,Re)|0,k=Math.imul(ue,Ne),A=A+Math.imul(re,Ce)|0,g=g+Math.imul(re,qe)|0,g=g+Math.imul(Y,Ce)|0,k=k+Math.imul(Y,qe)|0,A=A+Math.imul(be,Ie)|0,g=g+Math.imul(be,Fe)|0,g=g+Math.imul(Ee,Ie)|0,k=k+Math.imul(Ee,Fe)|0,A=A+Math.imul(ye,De)|0,g=g+Math.imul(ye,Ue)|0,g=g+Math.imul(xe,De)|0,k=k+Math.imul(xe,Ue)|0,A=A+Math.imul(we,Pe)|0,g=g+Math.imul(we,He)|0,g=g+Math.imul(pe,Pe)|0,k=k+Math.imul(pe,He)|0;var yt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(yt>>>26)|0,yt&=67108863,A=Math.imul(fe,Ce),g=Math.imul(fe,qe),g=g+Math.imul(ue,Ce)|0,k=Math.imul(ue,qe),A=A+Math.imul(re,Ie)|0,g=g+Math.imul(re,Fe)|0,g=g+Math.imul(Y,Ie)|0,k=k+Math.imul(Y,Fe)|0,A=A+Math.imul(be,De)|0,g=g+Math.imul(be,Ue)|0,g=g+Math.imul(Ee,De)|0,k=k+Math.imul(Ee,Ue)|0,A=A+Math.imul(ye,Pe)|0,g=g+Math.imul(ye,He)|0,g=g+Math.imul(xe,Pe)|0,k=k+Math.imul(xe,He)|0;var vt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(vt>>>26)|0,vt&=67108863,A=Math.imul(fe,Ie),g=Math.imul(fe,Fe),g=g+Math.imul(ue,Ie)|0,k=Math.imul(ue,Fe),A=A+Math.imul(re,De)|0,g=g+Math.imul(re,Ue)|0,g=g+Math.imul(Y,De)|0,k=k+Math.imul(Y,Ue)|0,A=A+Math.imul(be,Pe)|0,g=g+Math.imul(be,He)|0,g=g+Math.imul(Ee,Pe)|0,k=k+Math.imul(Ee,He)|0;var bt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(bt>>>26)|0,bt&=67108863,A=Math.imul(fe,De),g=Math.imul(fe,Ue),g=g+Math.imul(ue,De)|0,k=Math.imul(ue,Ue),A=A+Math.imul(re,Pe)|0,g=g+Math.imul(re,He)|0,g=g+Math.imul(Y,Pe)|0,k=k+Math.imul(Y,He)|0;var wt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(wt>>>26)|0,wt&=67108863,A=Math.imul(fe,Pe),g=Math.imul(fe,He),g=g+Math.imul(ue,Pe)|0,k=Math.imul(ue,He);var _t=($+A|0)+((g&8191)<<13)|0;return $=(k+(g>>>13)|0)+(_t>>>26)|0,_t&=67108863,B[0]=Xe,B[1]=Ye,B[2]=it,B[3]=st,B[4]=ot,B[5]=at,B[6]=ft,B[7]=lt,B[8]=ct,B[9]=ht,B[10]=dt,B[11]=pt,B[12]=gt,B[13]=mt,B[14]=yt,B[15]=vt,B[16]=bt,B[17]=wt,B[18]=_t,$!==0&&(B[19]=$,b.length++),b};Math.imul||(D=I);function L(O,l,p){p.negative=l.negative^O.negative,p.length=O.length+l.length;for(var b=0,S=0,T=0;T<p.length-1;T++){var B=S;S=0;for(var $=b&67108863,A=Math.min(T,l.length-1),g=Math.max(0,T-O.length+1);g<=A;g++){var k=T-g,H=O.words[k]|0,z=l.words[g]|0,Q=H*z,ie=Q&67108863;B=B+(Q/67108864|0)|0,ie=ie+$|0,$=ie&67108863,B=B+(ie>>>26)|0,S+=B>>>26,B&=67108863}p.words[T]=$,b=B,B=S}return b!==0?p.words[T]=b:p.length--,p.strip()}function N(O,l,p){var b=new q;return b.mulp(O,l,p)}o.prototype.mulTo=function(l,p){var b,S=this.length+l.length;return this.length===10&&l.length===10?b=D(this,l,p):S<63?b=I(this,l,p):S<1024?b=L(this,l,p):b=N(this,l,p),b};function q(O,l){this.x=O,this.y=l}q.prototype.makeRBT=function(l){for(var p=new Array(l),b=o.prototype._countBits(l)-1,S=0;S<l;S++)p[S]=this.revBin(S,b,l);return p},q.prototype.revBin=function(l,p,b){if(l===0||l===b-1)return l;for(var S=0,T=0;T<p;T++)S|=(l&1)<<p-T-1,l>>=1;return S},q.prototype.permute=function(l,p,b,S,T,B){for(var $=0;$<B;$++)S[$]=p[l[$]],T[$]=b[l[$]]},q.prototype.transform=function(l,p,b,S,T,B){this.permute(B,l,p,b,S,T);for(var $=1;$<T;$<<=1)for(var A=$<<1,g=Math.cos(2*Math.PI/A),k=Math.sin(2*Math.PI/A),H=0;H<T;H+=A)for(var z=g,Q=k,ie=0;ie<$;ie++){var ne=b[H+ie],Z=S[H+ie],se=b[H+ie+$],ae=S[H+ie+$],ce=z*se-Q*ae;ae=z*ae+Q*se,se=ce,b[H+ie]=ne+se,S[H+ie]=Z+ae,b[H+ie+$]=ne-se,S[H+ie+$]=Z-ae,ie!==A&&(ce=g*z-k*Q,Q=g*Q+k*z,z=ce)}},q.prototype.guessLen13b=function(l,p){var b=Math.max(p,l)|1,S=b&1,T=0;for(b=b/2|0;b;b=b>>>1)T++;return 1<<T+1+S},q.prototype.conjugate=function(l,p,b){if(!(b<=1))for(var S=0;S<b/2;S++){var T=l[S];l[S]=l[b-S-1],l[b-S-1]=T,T=p[S],p[S]=-p[b-S-1],p[b-S-1]=-T}},q.prototype.normalize13b=function(l,p){for(var b=0,S=0;S<p/2;S++){var T=Math.round(l[2*S+1]/p)*8192+Math.round(l[2*S]/p)+b;l[S]=T&67108863,T<67108864?b=0:b=T/67108864|0}return l},q.prototype.convert13b=function(l,p,b,S){for(var T=0,B=0;B<p;B++)T=T+(l[B]|0),b[2*B]=T&8191,T=T>>>13,b[2*B+1]=T&8191,T=T>>>13;for(B=2*p;B<S;++B)b[B]=0;n(T===0),n((T&-8192)===0)},q.prototype.stub=function(l){for(var p=new Array(l),b=0;b<l;b++)p[b]=0;return p},q.prototype.mulp=function(l,p,b){var S=2*this.guessLen13b(l.length,p.length),T=this.makeRBT(S),B=this.stub(S),$=new Array(S),A=new Array(S),g=new Array(S),k=new Array(S),H=new Array(S),z=new Array(S),Q=b.words;Q.length=S,this.convert13b(l.words,l.length,$,S),this.convert13b(p.words,p.length,k,S),this.transform($,B,A,g,S,T),this.transform(k,B,H,z,S,T);for(var ie=0;ie<S;ie++){var ne=A[ie]*H[ie]-g[ie]*z[ie];g[ie]=A[ie]*z[ie]+g[ie]*H[ie],A[ie]=ne}return this.conjugate(A,g,S),this.transform(A,g,Q,B,S,T),this.conjugate(Q,B,S),this.normalize13b(Q,S),b.negative=l.negative^p.negative,b.length=l.length+p.length,b.strip()},o.prototype.mul=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},o.prototype.mulf=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),N(this,l,p)},o.prototype.imul=function(l){return this.clone().mulTo(l,this)},o.prototype.imuln=function(l){n(typeof l=="number"),n(l<67108864);for(var p=0,b=0;b<this.length;b++){var S=(this.words[b]|0)*l,T=(S&67108863)+(p&67108863);p>>=26,p+=S/67108864|0,p+=T>>>26,this.words[b]=T&67108863}return p!==0&&(this.words[b]=p,this.length++),this},o.prototype.muln=function(l){return this.clone().imuln(l)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(l){var p=C(l);if(p.length===0)return new o(1);for(var b=this,S=0;S<p.length&&p[S]===0;S++,b=b.sqr());if(++S<p.length)for(var T=b.sqr();S<p.length;S++,T=T.sqr())p[S]!==0&&(b=b.mul(T));return b},o.prototype.iushln=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=67108863>>>26-p<<26-p,T;if(p!==0){var B=0;for(T=0;T<this.length;T++){var $=this.words[T]&S,A=(this.words[T]|0)-$<<p;this.words[T]=A|B,B=$>>>26-p}B&&(this.words[T]=B,this.length++)}if(b!==0){for(T=this.length-1;T>=0;T--)this.words[T+b]=this.words[T];for(T=0;T<b;T++)this.words[T]=0;this.length+=b}return this.strip()},o.prototype.ishln=function(l){return n(this.negative===0),this.iushln(l)},o.prototype.iushrn=function(l,p,b){n(typeof l=="number"&&l>=0);var S;p?S=(p-p%26)/26:S=0;var T=l%26,B=Math.min((l-T)/26,this.length),$=67108863^67108863>>>T<<T,A=b;if(S-=B,S=Math.max(0,S),A){for(var g=0;g<B;g++)A.words[g]=this.words[g];A.length=B}if(B!==0)if(this.length>B)for(this.length-=B,g=0;g<this.length;g++)this.words[g]=this.words[g+B];else this.words[0]=0,this.length=1;var k=0;for(g=this.length-1;g>=0&&(k!==0||g>=S);g--){var H=this.words[g]|0;this.words[g]=k<<26-T|H>>>T,k=H&$}return A&&k!==0&&(A.words[A.length++]=k),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(l,p,b){return n(this.negative===0),this.iushrn(l,p,b)},o.prototype.shln=function(l){return this.clone().ishln(l)},o.prototype.ushln=function(l){return this.clone().iushln(l)},o.prototype.shrn=function(l){return this.clone().ishrn(l)},o.prototype.ushrn=function(l){return this.clone().iushrn(l)},o.prototype.testn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return!1;var T=this.words[b];return!!(T&S)},o.prototype.imaskn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=b)return this;if(p!==0&&b++,this.length=Math.min(b,this.length),p!==0){var S=67108863^67108863>>>p<<p;this.words[this.length-1]&=S}return this.strip()},o.prototype.maskn=function(l){return this.clone().imaskn(l)},o.prototype.iaddn=function(l){return n(typeof l=="number"),n(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},o.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},o.prototype.isubn=function(l){if(n(typeof l=="number"),n(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},o.prototype.addn=function(l){return this.clone().iaddn(l)},o.prototype.subn=function(l){return this.clone().isubn(l)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(l,p,b){var S=l.length+b,T;this._expand(S);var B,$=0;for(T=0;T<l.length;T++){B=(this.words[T+b]|0)+$;var A=(l.words[T]|0)*p;B-=A&67108863,$=(B>>26)-(A/67108864|0),this.words[T+b]=B&67108863}for(;T<this.length-b;T++)B=(this.words[T+b]|0)+$,$=B>>26,this.words[T+b]=B&67108863;if($===0)return this.strip();for(n($===-1),$=0,T=0;T<this.length;T++)B=-(this.words[T]|0)+$,$=B>>26,this.words[T]=B&67108863;return this.negative=1,this.strip()},o.prototype._wordDiv=function(l,p){var b=this.length-l.length,S=this.clone(),T=l,B=T.words[T.length-1]|0,$=this._countBits(B);b=26-$,b!==0&&(T=T.ushln(b),S.iushln(b),B=T.words[T.length-1]|0);var A=S.length-T.length,g;if(p!=="mod"){g=new o(null),g.length=A+1,g.words=new Array(g.length);for(var k=0;k<g.length;k++)g.words[k]=0}var H=S.clone()._ishlnsubmul(T,1,A);H.negative===0&&(S=H,g&&(g.words[A]=1));for(var z=A-1;z>=0;z--){var Q=(S.words[T.length+z]|0)*67108864+(S.words[T.length+z-1]|0);for(Q=Math.min(Q/B|0,67108863),S._ishlnsubmul(T,Q,z);S.negative!==0;)Q--,S.negative=0,S._ishlnsubmul(T,1,z),S.isZero()||(S.negative^=1);g&&(g.words[z]=Q)}return g&&g.strip(),S.strip(),p!=="div"&&b!==0&&S.iushrn(b),{div:g||null,mod:S}},o.prototype.divmod=function(l,p,b){if(n(!l.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var S,T,B;return this.negative!==0&&l.negative===0?(B=this.neg().divmod(l,p),p!=="mod"&&(S=B.div.neg()),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.iadd(l)),{div:S,mod:T}):this.negative===0&&l.negative!==0?(B=this.divmod(l.neg(),p),p!=="mod"&&(S=B.div.neg()),{div:S,mod:B.mod}):this.negative&l.negative?(B=this.neg().divmod(l.neg(),p),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.isub(l)),{div:B.div,mod:T}):l.length>this.length||this.cmp(l)<0?{div:new o(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new o(this.modn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new o(this.modn(l.words[0]))}:this._wordDiv(l,p)},o.prototype.div=function(l){return this.divmod(l,"div",!1).div},o.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},o.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},o.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var b=p.div.negative!==0?p.mod.isub(l):p.mod,S=l.ushrn(1),T=l.andln(1),B=b.cmp(S);return B<0||T===1&&B===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},o.prototype.modn=function(l){n(l<=67108863);for(var p=(1<<26)%l,b=0,S=this.length-1;S>=0;S--)b=(p*b+(this.words[S]|0))%l;return b},o.prototype.idivn=function(l){n(l<=67108863);for(var p=0,b=this.length-1;b>=0;b--){var S=(this.words[b]|0)+p*67108864;this.words[b]=S/l|0,p=S%l}return this.strip()},o.prototype.divn=function(l){return this.clone().idivn(l)},o.prototype.egcd=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=new o(0),$=new o(1),A=0;p.isEven()&&b.isEven();)p.iushrn(1),b.iushrn(1),++A;for(var g=b.clone(),k=p.clone();!p.isZero();){for(var H=0,z=1;!(p.words[0]&z)&&H<26;++H,z<<=1);if(H>0)for(p.iushrn(H);H-- >0;)(S.isOdd()||T.isOdd())&&(S.iadd(g),T.isub(k)),S.iushrn(1),T.iushrn(1);for(var Q=0,ie=1;!(b.words[0]&ie)&&Q<26;++Q,ie<<=1);if(Q>0)for(b.iushrn(Q);Q-- >0;)(B.isOdd()||$.isOdd())&&(B.iadd(g),$.isub(k)),B.iushrn(1),$.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(B),T.isub($)):(b.isub(p),B.isub(S),$.isub(T))}return{a:B,b:$,gcd:b.iushln(A)}},o.prototype._invmp=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=b.clone();p.cmpn(1)>0&&b.cmpn(1)>0;){for(var $=0,A=1;!(p.words[0]&A)&&$<26;++$,A<<=1);if($>0)for(p.iushrn($);$-- >0;)S.isOdd()&&S.iadd(B),S.iushrn(1);for(var g=0,k=1;!(b.words[0]&k)&&g<26;++g,k<<=1);if(g>0)for(b.iushrn(g);g-- >0;)T.isOdd()&&T.iadd(B),T.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(T)):(b.isub(p),T.isub(S))}var H;return p.cmpn(1)===0?H=S:H=T,H.cmpn(0)<0&&H.iadd(l),H},o.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),b=l.clone();p.negative=0,b.negative=0;for(var S=0;p.isEven()&&b.isEven();S++)p.iushrn(1),b.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;b.isEven();)b.iushrn(1);var T=p.cmp(b);if(T<0){var B=p;p=b,b=B}else if(T===0||b.cmpn(1)===0)break;p.isub(b)}while(!0);return b.iushln(S)},o.prototype.invm=function(l){return this.egcd(l).a.umod(l)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(l){return this.words[0]&l},o.prototype.bincn=function(l){n(typeof l=="number");var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return this._expand(b+1),this.words[b]|=S,this;for(var T=S,B=b;T!==0&&B<this.length;B++){var $=this.words[B]|0;$+=T,T=$>>>26,$&=67108863,this.words[B]=$}return T!==0&&(this.words[B]=T,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var b;if(this.length>1)b=1;else{p&&(l=-l),n(l<=67108863,"Number is too big");var S=this.words[0]|0;b=S===l?0:S<l?-1:1}return this.negative!==0?-b|0:b},o.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},o.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,b=this.length-1;b>=0;b--){var S=this.words[b]|0,T=l.words[b]|0;if(S!==T){S<T?p=-1:S>T&&(p=1);break}}return p},o.prototype.gtn=function(l){return this.cmpn(l)===1},o.prototype.gt=function(l){return this.cmp(l)===1},o.prototype.gten=function(l){return this.cmpn(l)>=0},o.prototype.gte=function(l){return this.cmp(l)>=0},o.prototype.ltn=function(l){return this.cmpn(l)===-1},o.prototype.lt=function(l){return this.cmp(l)===-1},o.prototype.lten=function(l){return this.cmpn(l)<=0},o.prototype.lte=function(l){return this.cmp(l)<=0},o.prototype.eqn=function(l){return this.cmpn(l)===0},o.prototype.eq=function(l){return this.cmp(l)===0},o.red=function(l){return new G(l)},o.prototype.toRed=function(l){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(l){return this.red=l,this},o.prototype.forceRed=function(l){return n(!this.red,"Already a number in reduction context"),this._forceRed(l)},o.prototype.redAdd=function(l){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},o.prototype.redIAdd=function(l){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},o.prototype.redSub=function(l){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},o.prototype.redISub=function(l){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},o.prototype.redShl=function(l){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},o.prototype.redMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},o.prototype.redIMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(l){return n(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var F={k256:null,p224:null,p192:null,p25519:null};function U(O,l){this.name=O,this.p=new o(l,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var l=new o(null);return l.words=new Array(Math.ceil(this.n/13)),l},U.prototype.ireduce=function(l){var p=l,b;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),b=p.bitLength();while(b>this.n);var S=b<this.n?-1:p.ucmp(this.p);return S===0?(p.words[0]=0,p.length=1):S>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},U.prototype.split=function(l,p){l.iushrn(this.n,0,p)},U.prototype.imulK=function(l){return l.imul(this.k)};function j(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(j,U),j.prototype.split=function(l,p){for(var b=4194303,S=Math.min(l.length,9),T=0;T<S;T++)p.words[T]=l.words[T];if(p.length=S,l.length<=9){l.words[0]=0,l.length=1;return}var B=l.words[9];for(p.words[p.length++]=B&b,T=10;T<l.length;T++){var $=l.words[T]|0;l.words[T-10]=($&b)<<4|B>>>22,B=$}B>>>=22,l.words[T-10]=B,B===0&&l.length>10?l.length-=10:l.length-=9},j.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,b=0;b<l.length;b++){var S=l.words[b]|0;p+=S*977,l.words[b]=p&67108863,p=S*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function W(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(W,U);function X(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(X,U);function J(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(J,U),J.prototype.imulK=function(l){for(var p=0,b=0;b<l.length;b++){var S=(l.words[b]|0)*19+p,T=S&67108863;S>>>=26,l.words[b]=T,p=S}return p!==0&&(l.words[l.length++]=p),l},o._prime=function(l){if(F[l])return F[l];var p;if(l==="k256")p=new j;else if(l==="p224")p=new W;else if(l==="p192")p=new X;else if(l==="p25519")p=new J;else throw new Error("Unknown prime "+l);return F[l]=p,p};function G(O){if(typeof O=="string"){var l=o._prime(O);this.m=l.p,this.prime=l}else n(O.gtn(1),"modulus must be greater than 1"),this.m=O,this.prime=null}G.prototype._verify1=function(l){n(l.negative===0,"red works only with positives"),n(l.red,"red works only with red numbers")},G.prototype._verify2=function(l,p){n((l.negative|p.negative)===0,"red works only with positives"),n(l.red&&l.red===p.red,"red works only with red numbers")},G.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):l.umod(this.m)._forceRed(this)},G.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},G.prototype.add=function(l,p){this._verify2(l,p);var b=l.add(p);return b.cmp(this.m)>=0&&b.isub(this.m),b._forceRed(this)},G.prototype.iadd=function(l,p){this._verify2(l,p);var b=l.iadd(p);return b.cmp(this.m)>=0&&b.isub(this.m),b},G.prototype.sub=function(l,p){this._verify2(l,p);var b=l.sub(p);return b.cmpn(0)<0&&b.iadd(this.m),b._forceRed(this)},G.prototype.isub=function(l,p){this._verify2(l,p);var b=l.isub(p);return b.cmpn(0)<0&&b.iadd(this.m),b},G.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},G.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},G.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},G.prototype.isqr=function(l){return this.imul(l,l.clone())},G.prototype.sqr=function(l){return this.mul(l,l)},G.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(n(p%2===1),p===3){var b=this.m.add(new o(1)).iushrn(2);return this.pow(l,b)}for(var S=this.m.subn(1),T=0;!S.isZero()&&S.andln(1)===0;)T++,S.iushrn(1);n(!S.isZero());var B=new o(1).toRed(this),$=B.redNeg(),A=this.m.subn(1).iushrn(1),g=this.m.bitLength();for(g=new o(2*g*g).toRed(this);this.pow(g,A).cmp($)!==0;)g.redIAdd($);for(var k=this.pow(g,S),H=this.pow(l,S.addn(1).iushrn(1)),z=this.pow(l,S),Q=T;z.cmp(B)!==0;){for(var ie=z,ne=0;ie.cmp(B)!==0;ne++)ie=ie.redSqr();n(ne<Q);var Z=this.pow(k,new o(1).iushln(Q-ne-1));H=H.redMul(Z),k=Z.redSqr(),z=z.redMul(k),Q=ne}return H},G.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},G.prototype.pow=function(l,p){if(p.isZero())return new o(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var b=4,S=new Array(1<<b);S[0]=new o(1).toRed(this),S[1]=l;for(var T=2;T<S.length;T++)S[T]=this.mul(S[T-1],l);var B=S[0],$=0,A=0,g=p.bitLength()%26;for(g===0&&(g=26),T=p.length-1;T>=0;T--){for(var k=p.words[T],H=g-1;H>=0;H--){var z=k>>H&1;if(B!==S[0]&&(B=this.sqr(B)),z===0&&$===0){A=0;continue}$<<=1,$|=z,A++,!(A!==b&&(T!==0||H!==0))&&(B=this.mul(B,S[$]),A=0,$=0)}g=26}return B},G.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},G.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},o.mont=function(l){return new oe(l)};function oe(O){G.call(this,O),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(oe,G),oe.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},oe.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},oe.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var b=l.imul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new o(0)._forceRed(this);var b=l.mul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,commonjsGlobal)}(bn$2)),bn$2.exports}var api={},vmBrowserify={},hasRequiredVmBrowserify;function requireVmBrowserify(){return hasRequiredVmBrowserify||(hasRequiredVmBrowserify=1,function(exports){var indexOf=function(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0;t<r.length;t++)if(r[t]===e)return t;return-1},Object_keys=function(r){if(Object.keys)return Object.keys(r);var e=[];for(var t in r)e.push(t);return e},forEach=function(r,e){if(r.forEach)return r.forEach(e);for(var t=0;t<r.length;t++)e(r[t],t,r)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(r,e,t){Object.defineProperty(r,e,{writable:!0,enumerable:!1,configurable:!0,value:t})}}catch{return function(e,t,n){e[t]=n}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(r){if(!(r instanceof Context))throw new TypeError("needs a 'context' argument.");var e=document.createElement("iframe");e.style||(e.style={}),e.style.display="none",document.body.appendChild(e);var t=e.contentWindow,n=t.eval,a=t.execScript;!n&&a&&(a.call(t,"null"),n=t.eval),forEach(Object_keys(r),function(u){t[u]=r[u]}),forEach(globals,function(u){r[u]&&(t[u]=r[u])});var o=Object_keys(t),c=n.call(t,this.code);return forEach(Object_keys(t),function(u){(u in r||indexOf(o,u)===-1)&&(r[u]=t[u])}),forEach(globals,function(u){u in r||defineProp(r,u,t[u])}),document.body.removeChild(e),c},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(r){var e=Script.createContext(r),t=this.runInContext(e);return r&&forEach(Object_keys(e),function(n){r[n]=e[n]}),t},forEach(Object_keys(Script.prototype),function(r){exports[r]=Script[r]=function(e){var t=Script(e);return t[r].apply(t,[].slice.call(arguments,1))}}),exports.isContext=function(r){return r instanceof Context},exports.createScript=function(r){return exports.Script(r)},exports.createContext=Script.createContext=function(r){var e=new Context;return typeof r=="object"&&forEach(Object_keys(r),function(t){e[t]=r[t]}),e}}(vmBrowserify)),vmBrowserify}var hasRequiredApi;function requireApi(){return hasRequiredApi||(hasRequiredApi=1,function(r){var e=requireAsn1$1(),t=requireInherits_browser(),n=r;n.define=function(c,u){return new a(c,u)};function a(o,c){this.name=o,this.body=c,this.decoders={},this.encoders={}}a.prototype._createNamed=function(c){var u;try{u=requireVmBrowserify().runInThisContext("(function "+this.name+`(entity) {
  this._initNamed(entity);
})`)}catch{u=function(_){this._initNamed(_)}}return t(u,c),u.prototype._initNamed=function(_){c.call(this,_)},new u(this)},a.prototype._getDecoder=function(c){return c=c||"der",this.decoders.hasOwnProperty(c)||(this.decoders[c]=this._createNamed(e.decoders[c])),this.decoders[c]},a.prototype.decode=function(c,u,v){return this._getDecoder(u).decode(c,v)},a.prototype._getEncoder=function(c){return c=c||"der",this.encoders.hasOwnProperty(c)||(this.encoders[c]=this._createNamed(e.encoders[c])),this.encoders[c]},a.prototype.encode=function(c,u,v){return this._getEncoder(u).encode(c,v)}}(api)),api}var base$1={},reporter={},hasRequiredReporter;function requireReporter(){if(hasRequiredReporter)return reporter;hasRequiredReporter=1;var r=requireInherits_browser();function e(n){this._reporterState={obj:null,path:[],options:n||{},errors:[]}}reporter.Reporter=e,e.prototype.isError=function(a){return a instanceof t},e.prototype.save=function(){var a=this._reporterState;return{obj:a.obj,pathLen:a.path.length}},e.prototype.restore=function(a){var o=this._reporterState;o.obj=a.obj,o.path=o.path.slice(0,a.pathLen)},e.prototype.enterKey=function(a){return this._reporterState.path.push(a)},e.prototype.exitKey=function(a){var o=this._reporterState;o.path=o.path.slice(0,a-1)},e.prototype.leaveKey=function(a,o,c){var u=this._reporterState;this.exitKey(a),u.obj!==null&&(u.obj[o]=c)},e.prototype.path=function(){return this._reporterState.path.join("/")},e.prototype.enterObject=function(){var a=this._reporterState,o=a.obj;return a.obj={},o},e.prototype.leaveObject=function(a){var o=this._reporterState,c=o.obj;return o.obj=a,c},e.prototype.error=function(a){var o,c=this._reporterState,u=a instanceof t;if(u?o=a:o=new t(c.path.map(function(v){return"["+JSON.stringify(v)+"]"}).join(""),a.message||a,a.stack),!c.options.partial)throw o;return u||c.errors.push(o),o},e.prototype.wrapResult=function(a){var o=this._reporterState;return o.options.partial?{result:this.isError(a)?null:a,errors:o.errors}:a};function t(n,a){this.path=n,this.rethrow(a)}return r(t,Error),t.prototype.rethrow=function(a){if(this.message=a+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,t),!this.stack)try{throw new Error(this.message)}catch(o){this.stack=o.stack}return this},reporter}var buffer={},hasRequiredBuffer;function requireBuffer(){if(hasRequiredBuffer)return buffer;hasRequiredBuffer=1;var r=requireInherits_browser(),e=requireBase().Reporter,t=bufferPolyfill.Buffer;function n(o,c){if(e.call(this,c),!t.isBuffer(o)){this.error("Input not Buffer");return}this.base=o,this.offset=0,this.length=o.length}r(n,e),buffer.DecoderBuffer=n,n.prototype.save=function(){return{offset:this.offset,reporter:e.prototype.save.call(this)}},n.prototype.restore=function(c){var u=new n(this.base);return u.offset=c.offset,u.length=this.offset,this.offset=c.offset,e.prototype.restore.call(this,c.reporter),u},n.prototype.isEmpty=function(){return this.offset===this.length},n.prototype.readUInt8=function(c){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(c||"DecoderBuffer overrun")},n.prototype.skip=function(c,u){if(!(this.offset+c<=this.length))return this.error(u||"DecoderBuffer overrun");var v=new n(this.base);return v._reporterState=this._reporterState,v.offset=this.offset,v.length=this.offset+c,this.offset+=c,v},n.prototype.raw=function(c){return this.base.slice(c?c.offset:this.offset,this.length)};function a(o,c){if(Array.isArray(o))this.length=0,this.value=o.map(function(u){return u instanceof a||(u=new a(u,c)),this.length+=u.length,u},this);else if(typeof o=="number"){if(!(0<=o&&o<=255))return c.error("non-byte EncoderBuffer value");this.value=o,this.length=1}else if(typeof o=="string")this.value=o,this.length=t.byteLength(o);else if(t.isBuffer(o))this.value=o,this.length=o.length;else return c.error("Unsupported type: "+typeof o)}return buffer.EncoderBuffer=a,a.prototype.join=function(c,u){return c||(c=new t(this.length)),u||(u=0),this.length===0||(Array.isArray(this.value)?this.value.forEach(function(v){v.join(c,u),u+=v.length}):(typeof this.value=="number"?c[u]=this.value:typeof this.value=="string"?c.write(this.value,u):t.isBuffer(this.value)&&this.value.copy(c,u),u+=this.length)),c},buffer}var node,hasRequiredNode;function requireNode(){if(hasRequiredNode)return node;hasRequiredNode=1;var r=requireBase().Reporter,e=requireBase().EncoderBuffer,t=requireBase().DecoderBuffer,n=requireMinimalisticAssert(),a=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],o=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(a),c=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function u(_,x){var E={};this._baseState=E,E.enc=_,E.parent=x||null,E.children=null,E.tag=null,E.args=null,E.reverseArgs=null,E.choice=null,E.optional=!1,E.any=!1,E.obj=!1,E.use=null,E.useDecoder=null,E.key=null,E.default=null,E.explicit=null,E.implicit=null,E.contains=null,E.parent||(E.children=[],this._wrap())}node=u;var v=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];return u.prototype.clone=function(){var x=this._baseState,E={};v.forEach(function(C){E[C]=x[C]});var M=new this.constructor(E.parent);return M._baseState=E,M},u.prototype._wrap=function(){var x=this._baseState;o.forEach(function(E){this[E]=function(){var C=new this.constructor(this);return x.children.push(C),C[E].apply(C,arguments)}},this)},u.prototype._init=function(x){var E=this._baseState;n(E.parent===null),x.call(this),E.children=E.children.filter(function(M){return M._baseState.parent===this},this),n.equal(E.children.length,1,"Root node can have only one child")},u.prototype._useArgs=function(x){var E=this._baseState,M=x.filter(function(C){return C instanceof this.constructor},this);x=x.filter(function(C){return!(C instanceof this.constructor)},this),M.length!==0&&(n(E.children===null),E.children=M,M.forEach(function(C){C._baseState.parent=this},this)),x.length!==0&&(n(E.args===null),E.args=x,E.reverseArgs=x.map(function(C){if(typeof C!="object"||C.constructor!==Object)return C;var I={};return Object.keys(C).forEach(function(D){D==(D|0)&&(D|=0);var L=C[D];I[L]=D}),I}))},c.forEach(function(_){u.prototype[_]=function(){var E=this._baseState;throw new Error(_+" not implemented for encoding: "+E.enc)}}),a.forEach(function(_){u.prototype[_]=function(){var E=this._baseState,M=Array.prototype.slice.call(arguments);return n(E.tag===null),E.tag=_,this._useArgs(M),this}}),u.prototype.use=function(x){n(x);var E=this._baseState;return n(E.use===null),E.use=x,this},u.prototype.optional=function(){var x=this._baseState;return x.optional=!0,this},u.prototype.def=function(x){var E=this._baseState;return n(E.default===null),E.default=x,E.optional=!0,this},u.prototype.explicit=function(x){var E=this._baseState;return n(E.explicit===null&&E.implicit===null),E.explicit=x,this},u.prototype.implicit=function(x){var E=this._baseState;return n(E.explicit===null&&E.implicit===null),E.implicit=x,this},u.prototype.obj=function(){var x=this._baseState,E=Array.prototype.slice.call(arguments);return x.obj=!0,E.length!==0&&this._useArgs(E),this},u.prototype.key=function(x){var E=this._baseState;return n(E.key===null),E.key=x,this},u.prototype.any=function(){var x=this._baseState;return x.any=!0,this},u.prototype.choice=function(x){var E=this._baseState;return n(E.choice===null),E.choice=x,this._useArgs(Object.keys(x).map(function(M){return x[M]})),this},u.prototype.contains=function(x){var E=this._baseState;return n(E.use===null),E.contains=x,this},u.prototype._decode=function(x,E){var M=this._baseState;if(M.parent===null)return x.wrapResult(M.children[0]._decode(x,E));var C=M.default,I=!0,D=null;if(M.key!==null&&(D=x.enterKey(M.key)),M.optional){var L=null;if(M.explicit!==null?L=M.explicit:M.implicit!==null?L=M.implicit:M.tag!==null&&(L=M.tag),L===null&&!M.any){var N=x.save();try{M.choice===null?this._decodeGeneric(M.tag,x,E):this._decodeChoice(x,E),I=!0}catch{I=!1}x.restore(N)}else if(I=this._peekTag(x,L,M.any),x.isError(I))return I}var q;if(M.obj&&I&&(q=x.enterObject()),I){if(M.explicit!==null){var F=this._decodeTag(x,M.explicit);if(x.isError(F))return F;x=F}var U=x.offset;if(M.use===null&&M.choice===null){if(M.any)var N=x.save();var j=this._decodeTag(x,M.implicit!==null?M.implicit:M.tag,M.any);if(x.isError(j))return j;M.any?C=x.raw(N):x=j}if(E&&E.track&&M.tag!==null&&E.track(x.path(),U,x.length,"tagged"),E&&E.track&&M.tag!==null&&E.track(x.path(),x.offset,x.length,"content"),M.any?C=C:M.choice===null?C=this._decodeGeneric(M.tag,x,E):C=this._decodeChoice(x,E),x.isError(C))return C;if(!M.any&&M.choice===null&&M.children!==null&&M.children.forEach(function(J){J._decode(x,E)}),M.contains&&(M.tag==="octstr"||M.tag==="bitstr")){var W=new t(C);C=this._getUse(M.contains,x._reporterState.obj)._decode(W,E)}}return M.obj&&I&&(C=x.leaveObject(q)),M.key!==null&&(C!==null||I===!0)?x.leaveKey(D,M.key,C):D!==null&&x.exitKey(D),C},u.prototype._decodeGeneric=function(x,E,M){var C=this._baseState;return x==="seq"||x==="set"?null:x==="seqof"||x==="setof"?this._decodeList(E,x,C.args[0],M):/str$/.test(x)?this._decodeStr(E,x,M):x==="objid"&&C.args?this._decodeObjid(E,C.args[0],C.args[1],M):x==="objid"?this._decodeObjid(E,null,null,M):x==="gentime"||x==="utctime"?this._decodeTime(E,x,M):x==="null_"?this._decodeNull(E,M):x==="bool"?this._decodeBool(E,M):x==="objDesc"?this._decodeStr(E,x,M):x==="int"||x==="enum"?this._decodeInt(E,C.args&&C.args[0],M):C.use!==null?this._getUse(C.use,E._reporterState.obj)._decode(E,M):E.error("unknown tag: "+x)},u.prototype._getUse=function(x,E){var M=this._baseState;return M.useDecoder=this._use(x,E),n(M.useDecoder._baseState.parent===null),M.useDecoder=M.useDecoder._baseState.children[0],M.implicit!==M.useDecoder._baseState.implicit&&(M.useDecoder=M.useDecoder.clone(),M.useDecoder._baseState.implicit=M.implicit),M.useDecoder},u.prototype._decodeChoice=function(x,E){var M=this._baseState,C=null,I=!1;return Object.keys(M.choice).some(function(D){var L=x.save(),N=M.choice[D];try{var q=N._decode(x,E);if(x.isError(q))return!1;C={type:D,value:q},I=!0}catch{return x.restore(L),!1}return!0},this),I?C:x.error("Choice not matched")},u.prototype._createEncoderBuffer=function(x){return new e(x,this.reporter)},u.prototype._encode=function(x,E,M){var C=this._baseState;if(!(C.default!==null&&C.default===x)){var I=this._encodeValue(x,E,M);if(I!==void 0&&!this._skipDefault(I,E,M))return I}},u.prototype._encodeValue=function(x,E,M){var C=this._baseState;if(C.parent===null)return C.children[0]._encode(x,E||new r);var N=null;if(this.reporter=E,C.optional&&x===void 0)if(C.default!==null)x=C.default;else return;var I=null,D=!1;if(C.any)N=this._createEncoderBuffer(x);else if(C.choice)N=this._encodeChoice(x,E);else if(C.contains)I=this._getUse(C.contains,M)._encode(x,E),D=!0;else if(C.children)I=C.children.map(function(U){if(U._baseState.tag==="null_")return U._encode(null,E,x);if(U._baseState.key===null)return E.error("Child should have a key");var j=E.enterKey(U._baseState.key);if(typeof x!="object")return E.error("Child expected, but input is not object");var W=U._encode(x[U._baseState.key],E,x);return E.leaveKey(j),W},this).filter(function(U){return U}),I=this._createEncoderBuffer(I);else if(C.tag==="seqof"||C.tag==="setof"){if(!(C.args&&C.args.length===1))return E.error("Too many args for : "+C.tag);if(!Array.isArray(x))return E.error("seqof/setof, but data is not Array");var L=this.clone();L._baseState.implicit=null,I=this._createEncoderBuffer(x.map(function(U){var j=this._baseState;return this._getUse(j.args[0],x)._encode(U,E)},L))}else C.use!==null?N=this._getUse(C.use,M)._encode(x,E):(I=this._encodePrimitive(C.tag,x),D=!0);var N;if(!C.any&&C.choice===null){var q=C.implicit!==null?C.implicit:C.tag,F=C.implicit===null?"universal":"context";q===null?C.use===null&&E.error("Tag could be omitted only for .use()"):C.use===null&&(N=this._encodeComposite(q,D,F,I))}return C.explicit!==null&&(N=this._encodeComposite(C.explicit,!1,"context",N)),N},u.prototype._encodeChoice=function(x,E){var M=this._baseState,C=M.choice[x.type];return C||n(!1,x.type+" not found in "+JSON.stringify(Object.keys(M.choice))),C._encode(x.value,E)},u.prototype._encodePrimitive=function(x,E){var M=this._baseState;if(/str$/.test(x))return this._encodeStr(E,x);if(x==="objid"&&M.args)return this._encodeObjid(E,M.reverseArgs[0],M.args[1]);if(x==="objid")return this._encodeObjid(E,null,null);if(x==="gentime"||x==="utctime")return this._encodeTime(E,x);if(x==="null_")return this._encodeNull();if(x==="int"||x==="enum")return this._encodeInt(E,M.args&&M.reverseArgs[0]);if(x==="bool")return this._encodeBool(E);if(x==="objDesc")return this._encodeStr(E,x);throw new Error("Unsupported tag: "+x)},u.prototype._isNumstr=function(x){return/^[0-9 ]*$/.test(x)},u.prototype._isPrintstr=function(x){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(x)},node}var hasRequiredBase;function requireBase(){return hasRequiredBase||(hasRequiredBase=1,function(r){var e=r;e.Reporter=requireReporter().Reporter,e.DecoderBuffer=requireBuffer().DecoderBuffer,e.EncoderBuffer=requireBuffer().EncoderBuffer,e.Node=requireNode()}(base$1)),base$1}var constants={},der={},hasRequiredDer$2;function requireDer$2(){return hasRequiredDer$2||(hasRequiredDer$2=1,function(r){var e=requireConstants();r.tagClass={0:"universal",1:"application",2:"context",3:"private"},r.tagClassByName=e._reverse(r.tagClass),r.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},r.tagByName=e._reverse(r.tag)}(der)),der}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,function(r){var e=r;e._reverse=function(n){var a={};return Object.keys(n).forEach(function(o){(o|0)==o&&(o=o|0);var c=n[o];a[c]=o}),a},e.der=requireDer$2()}(constants)),constants}var decoders$1={},der_1$1,hasRequiredDer$1;function requireDer$1(){if(hasRequiredDer$1)return der_1$1;hasRequiredDer$1=1;var r=requireInherits_browser(),e=requireAsn1$1(),t=e.base,n=e.bignum,a=e.constants.der;function o(_){this.enc="der",this.name=_.name,this.entity=_,this.tree=new c,this.tree._init(_.body)}der_1$1=o,o.prototype.decode=function(x,E){return x instanceof t.DecoderBuffer||(x=new t.DecoderBuffer(x,E)),this.tree._decode(x,E)};function c(_){t.Node.call(this,"der",_)}r(c,t.Node),c.prototype._peekTag=function(x,E,M){if(x.isEmpty())return!1;var C=x.save(),I=u(x,'Failed to peek tag: "'+E+'"');return x.isError(I)?I:(x.restore(C),I.tag===E||I.tagStr===E||I.tagStr+"of"===E||M)},c.prototype._decodeTag=function(x,E,M){var C=u(x,'Failed to decode tag of "'+E+'"');if(x.isError(C))return C;var I=v(x,C.primitive,'Failed to get length of "'+E+'"');if(x.isError(I))return I;if(!M&&C.tag!==E&&C.tagStr!==E&&C.tagStr+"of"!==E)return x.error('Failed to match tag: "'+E+'"');if(C.primitive||I!==null)return x.skip(I,'Failed to match body of: "'+E+'"');var D=x.save(),L=this._skipUntilEnd(x,'Failed to skip indefinite length body: "'+this.tag+'"');return x.isError(L)?L:(I=x.offset-D.offset,x.restore(D),x.skip(I,'Failed to match body of: "'+E+'"'))},c.prototype._skipUntilEnd=function(x,E){for(;;){var M=u(x,E);if(x.isError(M))return M;var C=v(x,M.primitive,E);if(x.isError(C))return C;var I;if(M.primitive||C!==null?I=x.skip(C):I=this._skipUntilEnd(x,E),x.isError(I))return I;if(M.tagStr==="end")break}},c.prototype._decodeList=function(x,E,M,C){for(var I=[];!x.isEmpty();){var D=this._peekTag(x,"end");if(x.isError(D))return D;var L=M.decode(x,"der",C);if(x.isError(L)&&D)break;I.push(L)}return I},c.prototype._decodeStr=function(x,E){if(E==="bitstr"){var M=x.readUInt8();return x.isError(M)?M:{unused:M,data:x.raw()}}else if(E==="bmpstr"){var C=x.raw();if(C.length%2===1)return x.error("Decoding of string type: bmpstr length mismatch");for(var I="",D=0;D<C.length/2;D++)I+=String.fromCharCode(C.readUInt16BE(D*2));return I}else if(E==="numstr"){var L=x.raw().toString("ascii");return this._isNumstr(L)?L:x.error("Decoding of string type: numstr unsupported characters")}else{if(E==="octstr")return x.raw();if(E==="objDesc")return x.raw();if(E==="printstr"){var N=x.raw().toString("ascii");return this._isPrintstr(N)?N:x.error("Decoding of string type: printstr unsupported characters")}else return/str$/.test(E)?x.raw().toString():x.error("Decoding of string type: "+E+" unsupported")}},c.prototype._decodeObjid=function(x,E,M){for(var C,I=[],D=0;!x.isEmpty();){var L=x.readUInt8();D<<=7,D|=L&127,L&128||(I.push(D),D=0)}L&128&&I.push(D);var N=I[0]/40|0,q=I[0]%40;if(M?C=I:C=[N,q].concat(I.slice(1)),E){var F=E[C.join(" ")];F===void 0&&(F=E[C.join(".")]),F!==void 0&&(C=F)}return C},c.prototype._decodeTime=function(x,E){var M=x.raw().toString();if(E==="gentime")var C=M.slice(0,4)|0,I=M.slice(4,6)|0,D=M.slice(6,8)|0,L=M.slice(8,10)|0,N=M.slice(10,12)|0,q=M.slice(12,14)|0;else if(E==="utctime"){var C=M.slice(0,2)|0,I=M.slice(2,4)|0,D=M.slice(4,6)|0,L=M.slice(6,8)|0,N=M.slice(8,10)|0,q=M.slice(10,12)|0;C<70?C=2e3+C:C=1900+C}else return x.error("Decoding "+E+" time is not supported yet");return Date.UTC(C,I-1,D,L,N,q,0)},c.prototype._decodeNull=function(x){return null},c.prototype._decodeBool=function(x){var E=x.readUInt8();return x.isError(E)?E:E!==0},c.prototype._decodeInt=function(x,E){var M=x.raw(),C=new n(M);return E&&(C=E[C.toString(10)]||C),C},c.prototype._use=function(x,E){return typeof x=="function"&&(x=x(E)),x._getDecoder("der").tree};function u(_,x){var E=_.readUInt8(x);if(_.isError(E))return E;var M=a.tagClass[E>>6],C=(E&32)===0;if((E&31)===31){var I=E;for(E=0;(I&128)===128;){if(I=_.readUInt8(x),_.isError(I))return I;E<<=7,E|=I&127}}else E&=31;var D=a.tag[E];return{cls:M,primitive:C,tag:E,tagStr:D}}function v(_,x,E){var M=_.readUInt8(E);if(_.isError(M))return M;if(!x&&M===128)return null;if(!(M&128))return M;var C=M&127;if(C>4)return _.error("length octect is too long");M=0;for(var I=0;I<C;I++){M<<=8;var D=_.readUInt8(E);if(_.isError(D))return D;M|=D}return M}return der_1$1}var pem$1,hasRequiredPem$1;function requirePem$1(){if(hasRequiredPem$1)return pem$1;hasRequiredPem$1=1;var r=requireInherits_browser(),e=bufferPolyfill.Buffer,t=requireDer$1();function n(a){t.call(this,a),this.enc="pem"}return r(n,t),pem$1=n,n.prototype.decode=function(o,c){for(var u=o.toString().split(/[\r\n]+/g),v=c.label.toUpperCase(),_=/^-----(BEGIN|END) ([^-]+)-----$/,x=-1,E=-1,M=0;M<u.length;M++){var C=u[M].match(_);if(C!==null&&C[2]===v)if(x===-1){if(C[1]!=="BEGIN")break;x=M}else{if(C[1]!=="END")break;E=M;break}}if(x===-1||E===-1)throw new Error("PEM section not found for: "+v);var I=u.slice(x+1,E).join("");I.replace(/[^a-z0-9\+\/=]+/gi,"");var D=new e(I,"base64");return t.prototype.decode.call(this,D,c)},pem$1}var hasRequiredDecoders;function requireDecoders(){return hasRequiredDecoders||(hasRequiredDecoders=1,function(r){var e=r;e.der=requireDer$1(),e.pem=requirePem$1()}(decoders$1)),decoders$1}var encoders={},der_1,hasRequiredDer;function requireDer(){if(hasRequiredDer)return der_1;hasRequiredDer=1;var r=requireInherits_browser(),e=bufferPolyfill.Buffer,t=requireAsn1$1(),n=t.base,a=t.constants.der;function o(_){this.enc="der",this.name=_.name,this.entity=_,this.tree=new c,this.tree._init(_.body)}der_1=o,o.prototype.encode=function(x,E){return this.tree._encode(x,E).join()};function c(_){n.Node.call(this,"der",_)}r(c,n.Node),c.prototype._encodeComposite=function(x,E,M,C){var I=v(x,E,M,this.reporter);if(C.length<128){var N=new e(2);return N[0]=I,N[1]=C.length,this._createEncoderBuffer([N,C])}for(var D=1,L=C.length;L>=256;L>>=8)D++;var N=new e(2+D);N[0]=I,N[1]=128|D;for(var L=1+D,q=C.length;q>0;L--,q>>=8)N[L]=q&255;return this._createEncoderBuffer([N,C])},c.prototype._encodeStr=function(x,E){if(E==="bitstr")return this._createEncoderBuffer([x.unused|0,x.data]);if(E==="bmpstr"){for(var M=new e(x.length*2),C=0;C<x.length;C++)M.writeUInt16BE(x.charCodeAt(C),C*2);return this._createEncoderBuffer(M)}else return E==="numstr"?this._isNumstr(x)?this._createEncoderBuffer(x):this.reporter.error("Encoding of string type: numstr supports only digits and space"):E==="printstr"?this._isPrintstr(x)?this._createEncoderBuffer(x):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(E)?this._createEncoderBuffer(x):E==="objDesc"?this._createEncoderBuffer(x):this.reporter.error("Encoding of string type: "+E+" unsupported")},c.prototype._encodeObjid=function(x,E,M){if(typeof x=="string"){if(!E)return this.reporter.error("string objid given, but no values map found");if(!E.hasOwnProperty(x))return this.reporter.error("objid not found in values map");x=E[x].split(/[\s\.]+/g);for(var C=0;C<x.length;C++)x[C]|=0}else if(Array.isArray(x)){x=x.slice();for(var C=0;C<x.length;C++)x[C]|=0}if(!Array.isArray(x))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(x));if(!M){if(x[1]>=40)return this.reporter.error("Second objid identifier OOB");x.splice(0,2,x[0]*40+x[1])}for(var I=0,C=0;C<x.length;C++){var D=x[C];for(I++;D>=128;D>>=7)I++}for(var L=new e(I),N=L.length-1,C=x.length-1;C>=0;C--){var D=x[C];for(L[N--]=D&127;(D>>=7)>0;)L[N--]=128|D&127}return this._createEncoderBuffer(L)};function u(_){return _<10?"0"+_:_}c.prototype._encodeTime=function(x,E){var M,C=new Date(x);return E==="gentime"?M=[u(C.getFullYear()),u(C.getUTCMonth()+1),u(C.getUTCDate()),u(C.getUTCHours()),u(C.getUTCMinutes()),u(C.getUTCSeconds()),"Z"].join(""):E==="utctime"?M=[u(C.getFullYear()%100),u(C.getUTCMonth()+1),u(C.getUTCDate()),u(C.getUTCHours()),u(C.getUTCMinutes()),u(C.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+E+" time is not supported yet"),this._encodeStr(M,"octstr")},c.prototype._encodeNull=function(){return this._createEncoderBuffer("")},c.prototype._encodeInt=function(x,E){if(typeof x=="string"){if(!E)return this.reporter.error("String int or enum given, but no values map");if(!E.hasOwnProperty(x))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(x));x=E[x]}if(typeof x!="number"&&!e.isBuffer(x)){var M=x.toArray();!x.sign&&M[0]&128&&M.unshift(0),x=new e(M)}if(e.isBuffer(x)){var C=x.length;x.length===0&&C++;var D=new e(C);return x.copy(D),x.length===0&&(D[0]=0),this._createEncoderBuffer(D)}if(x<128)return this._createEncoderBuffer(x);if(x<256)return this._createEncoderBuffer([0,x]);for(var C=1,I=x;I>=256;I>>=8)C++;for(var D=new Array(C),I=D.length-1;I>=0;I--)D[I]=x&255,x>>=8;return D[0]&128&&D.unshift(0),this._createEncoderBuffer(new e(D))},c.prototype._encodeBool=function(x){return this._createEncoderBuffer(x?255:0)},c.prototype._use=function(x,E){return typeof x=="function"&&(x=x(E)),x._getEncoder("der").tree},c.prototype._skipDefault=function(x,E,M){var C=this._baseState,I;if(C.default===null)return!1;var D=x.join();if(C.defaultBuffer===void 0&&(C.defaultBuffer=this._encodeValue(C.default,E,M).join()),D.length!==C.defaultBuffer.length)return!1;for(I=0;I<D.length;I++)if(D[I]!==C.defaultBuffer[I])return!1;return!0};function v(_,x,E,M){var C;if(_==="seqof"?_="seq":_==="setof"&&(_="set"),a.tagByName.hasOwnProperty(_))C=a.tagByName[_];else if(typeof _=="number"&&(_|0)===_)C=_;else return M.error("Unknown tag: "+_);return C>=31?M.error("Multi-octet tag encoding unsupported"):(x||(C|=32),C|=a.tagClassByName[E||"universal"]<<6,C)}return der_1}var pem,hasRequiredPem;function requirePem(){if(hasRequiredPem)return pem;hasRequiredPem=1;var r=requireInherits_browser(),e=requireDer();function t(n){e.call(this,n),this.enc="pem"}return r(t,e),pem=t,t.prototype.encode=function(a,o){for(var c=e.prototype.encode.call(this,a),u=c.toString("base64"),v=["-----BEGIN "+o.label+"-----"],_=0;_<u.length;_+=64)v.push(u.slice(_,_+64));return v.push("-----END "+o.label+"-----"),v.join(`
`)},pem}var hasRequiredEncoders;function requireEncoders(){return hasRequiredEncoders||(hasRequiredEncoders=1,function(r){var e=r;e.der=requireDer(),e.pem=requirePem()}(encoders)),encoders}var hasRequiredAsn1$1;function requireAsn1$1(){return hasRequiredAsn1$1||(hasRequiredAsn1$1=1,function(r){var e=r;e.bignum=requireBn$2(),e.define=requireApi().define,e.base=requireBase(),e.constants=requireConstants(),e.decoders=requireDecoders(),e.encoders=requireEncoders()}(asn1)),asn1}var certificate,hasRequiredCertificate;function requireCertificate(){if(hasRequiredCertificate)return certificate;hasRequiredCertificate=1;var r=requireAsn1$1(),e=r.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),t=r.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),n=r.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),a=r.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(n),this.key("subjectPublicKey").bitstr())}),o=r.define("RelativeDistinguishedName",function(){this.setof(t)}),c=r.define("RDNSequence",function(){this.seqof(o)}),u=r.define("Name",function(){this.choice({rdnSequence:this.use(c)})}),v=r.define("Validity",function(){this.seq().obj(this.key("notBefore").use(e),this.key("notAfter").use(e))}),_=r.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),x=r.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(n),this.key("issuer").use(u),this.key("validity").use(v),this.key("subject").use(u),this.key("subjectPublicKeyInfo").use(a),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(_).optional())}),E=r.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(x),this.key("signatureAlgorithm").use(n),this.key("signatureValue").bitstr())});return certificate=E,certificate}var hasRequiredAsn1;function requireAsn1(){if(hasRequiredAsn1)return asn1$1;hasRequiredAsn1=1;var r=requireAsn1$1();asn1$1.certificate=requireCertificate();var e=r.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});asn1$1.RSAPrivateKey=e;var t=r.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});asn1$1.RSAPublicKey=t;var n=r.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),a=r.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(n),this.key("subjectPublicKey").bitstr())});asn1$1.PublicKey=a;var o=r.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(n),this.key("subjectPrivateKey").octstr())});asn1$1.PrivateKey=o;var c=r.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});asn1$1.EncryptedPrivateKey=c;var u=r.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});asn1$1.DSAPrivateKey=u,asn1$1.DSAparam=r.define("DSAparam",function(){this.int()});var v=r.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),_=r.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(v),this.key("publicKey").optional().explicit(1).bitstr())});return asn1$1.ECPrivateKey=_,asn1$1.signature=r.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())}),asn1$1}const require$$1={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"};var fixProc,hasRequiredFixProc;function requireFixProc(){if(hasRequiredFixProc)return fixProc;hasRequiredFixProc=1;var r=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,e=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,t=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,n=requireEvp_bytestokey(),a=requireBrowser$6(),o=requireSafeBuffer$1().Buffer;return fixProc=function(c,u){var v=c.toString(),_=v.match(r),x;if(_){var M="aes"+_[1],C=o.from(_[2],"hex"),I=o.from(_[3].replace(/[\r\n]/g,""),"base64"),D=n(u,C.slice(0,8),parseInt(_[1],10)).key,L=[],N=a.createDecipheriv(M,D,C);L.push(N.update(I)),L.push(N.final()),x=o.concat(L)}else{var E=v.match(t);x=o.from(E[2].replace(/[\r\n]/g,""),"base64")}var q=v.match(e)[1];return{tag:q,data:x}},fixProc}var parseAsn1,hasRequiredParseAsn1;function requireParseAsn1(){if(hasRequiredParseAsn1)return parseAsn1;hasRequiredParseAsn1=1;var r=requireAsn1(),e=require$$1,t=requireFixProc(),n=requireBrowser$6(),a=requireBrowser$7(),o=requireSafeBuffer$1().Buffer;function c(v,_){var x=v.algorithm.decrypt.kde.kdeparams.salt,E=parseInt(v.algorithm.decrypt.kde.kdeparams.iters.toString(),10),M=e[v.algorithm.decrypt.cipher.algo.join(".")],C=v.algorithm.decrypt.cipher.iv,I=v.subjectPrivateKey,D=parseInt(M.split("-")[1],10)/8,L=a.pbkdf2Sync(_,x,E,D,"sha1"),N=n.createDecipheriv(M,L,C),q=[];return q.push(N.update(I)),q.push(N.final()),o.concat(q)}function u(v){var _;typeof v=="object"&&!o.isBuffer(v)&&(_=v.passphrase,v=v.key),typeof v=="string"&&(v=o.from(v));var x=t(v,_),E=x.tag,M=x.data,C,I;switch(E){case"CERTIFICATE":I=r.certificate.decode(M,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(I||(I=r.PublicKey.decode(M,"der")),C=I.algorithm.algorithm.join("."),C){case"1.2.840.113549.1.1.1":return r.RSAPublicKey.decode(I.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return I.subjectPrivateKey=I.subjectPublicKey,{type:"ec",data:I};case"1.2.840.10040.4.1":return I.algorithm.params.pub_key=r.DSAparam.decode(I.subjectPublicKey.data,"der"),{type:"dsa",data:I.algorithm.params};default:throw new Error("unknown key id "+C)}case"ENCRYPTED PRIVATE KEY":M=r.EncryptedPrivateKey.decode(M,"der"),M=c(M,_);case"PRIVATE KEY":switch(I=r.PrivateKey.decode(M,"der"),C=I.algorithm.algorithm.join("."),C){case"1.2.840.113549.1.1.1":return r.RSAPrivateKey.decode(I.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:I.algorithm.curve,privateKey:r.ECPrivateKey.decode(I.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return I.algorithm.params.priv_key=r.DSAparam.decode(I.subjectPrivateKey,"der"),{type:"dsa",params:I.algorithm.params};default:throw new Error("unknown key id "+C)}case"RSA PUBLIC KEY":return r.RSAPublicKey.decode(M,"der");case"RSA PRIVATE KEY":return r.RSAPrivateKey.decode(M,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:r.DSAPrivateKey.decode(M,"der")};case"EC PRIVATE KEY":return M=r.ECPrivateKey.decode(M,"der"),{curve:M.parameters.value,privateKey:M.privateKey};default:throw new Error("unknown key type "+E)}}return u.signature=r.signature,parseAsn1=u,parseAsn1}const require$$4={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"};var hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign$2.exports;hasRequiredSign=1;var r=requireSafeBuffer$1().Buffer,e=requireBrowser$8(),t=requireBrowserifyRsa(),n=requireElliptic().ec,a=requireBn$4(),o=requireParseAsn1(),c=require$$4,u=1;function v(N,q,F,U,j){var W=o(q);if(W.curve){if(U!=="ecdsa"&&U!=="ecdsa/rsa")throw new Error("wrong private key type");return _(N,W)}else if(W.type==="dsa"){if(U!=="dsa")throw new Error("wrong private key type");return x(N,W,F)}if(U!=="rsa"&&U!=="ecdsa/rsa")throw new Error("wrong private key type");if(q.padding!==void 0&&q.padding!==u)throw new Error("illegal or unsupported padding mode");N=r.concat([j,N]);for(var X=W.modulus.byteLength(),J=[0,1];N.length+J.length+1<X;)J.push(255);J.push(0);for(var G=-1;++G<N.length;)J.push(N[G]);var oe=t(J,W);return oe}function _(N,q){var F=c[q.curve.join(".")];if(!F)throw new Error("unknown curve "+q.curve.join("."));var U=new n(F),j=U.keyFromPrivate(q.privateKey),W=j.sign(N);return r.from(W.toDER())}function x(N,q,F){for(var U=q.params.priv_key,j=q.params.p,W=q.params.q,X=q.params.g,J=new a(0),G,oe=C(N,W).mod(W),O=!1,l=M(U,W,N,F);O===!1;)G=D(W,l,F),J=L(X,G,j,W),O=G.invm(W).imul(oe.add(U.mul(J))).mod(W),O.cmpn(0)===0&&(O=!1,J=new a(0));return E(J,O)}function E(N,q){N=N.toArray(),q=q.toArray(),N[0]&128&&(N=[0].concat(N)),q[0]&128&&(q=[0].concat(q));var F=N.length+q.length+4,U=[48,F,2,N.length];return U=U.concat(N,[2,q.length],q),r.from(U)}function M(N,q,F,U){if(N=r.from(N.toArray()),N.length<q.byteLength()){var j=r.alloc(q.byteLength()-N.length);N=r.concat([j,N])}var W=F.length,X=I(F,q),J=r.alloc(W);J.fill(1);var G=r.alloc(W);return G=e(U,G).update(J).update(r.from([0])).update(N).update(X).digest(),J=e(U,G).update(J).digest(),G=e(U,G).update(J).update(r.from([1])).update(N).update(X).digest(),J=e(U,G).update(J).digest(),{k:G,v:J}}function C(N,q){var F=new a(N),U=(N.length<<3)-q.bitLength();return U>0&&F.ishrn(U),F}function I(N,q){N=C(N,q),N=N.mod(q);var F=r.from(N.toArray());if(F.length<q.byteLength()){var U=r.alloc(q.byteLength()-F.length);F=r.concat([U,F])}return F}function D(N,q,F){var U,j;do{for(U=r.alloc(0);U.length*8<N.bitLength();)q.v=e(F,q.k).update(q.v).digest(),U=r.concat([U,q.v]);j=C(U,N),q.k=e(F,q.k).update(q.v).update(r.from([0])).digest(),q.v=e(F,q.k).update(q.v).digest()}while(j.cmp(N)!==-1);return j}function L(N,q,F,U){return N.toRed(a.mont(F)).redPow(q).fromRed().mod(U)}return sign$2.exports=v,sign$2.exports.getKey=M,sign$2.exports.makeKey=D,sign$2.exports}var verify_1,hasRequiredVerify;function requireVerify(){if(hasRequiredVerify)return verify_1;hasRequiredVerify=1;var r=requireSafeBuffer$1().Buffer,e=requireBn$4(),t=requireElliptic().ec,n=requireParseAsn1(),a=require$$4;function o(_,x,E,M,C){var I=n(E);if(I.type==="ec"){if(M!=="ecdsa"&&M!=="ecdsa/rsa")throw new Error("wrong public key type");return c(_,x,I)}else if(I.type==="dsa"){if(M!=="dsa")throw new Error("wrong public key type");return u(_,x,I)}if(M!=="rsa"&&M!=="ecdsa/rsa")throw new Error("wrong public key type");x=r.concat([C,x]);for(var D=I.modulus.byteLength(),L=[1],N=0;x.length+L.length+2<D;)L.push(255),N+=1;L.push(0);for(var q=-1;++q<x.length;)L.push(x[q]);L=r.from(L);var F=e.mont(I.modulus);_=new e(_).toRed(F),_=_.redPow(new e(I.publicExponent)),_=r.from(_.fromRed().toArray());var U=N<8?1:0;for(D=Math.min(_.length,L.length),_.length!==L.length&&(U=1),q=-1;++q<D;)U|=_[q]^L[q];return U===0}function c(_,x,E){var M=a[E.data.algorithm.curve.join(".")];if(!M)throw new Error("unknown curve "+E.data.algorithm.curve.join("."));var C=new t(M),I=E.data.subjectPrivateKey.data;return C.verify(x,_,I)}function u(_,x,E){var M=E.data.p,C=E.data.q,I=E.data.g,D=E.data.pub_key,L=n.signature.decode(_,"der"),N=L.s,q=L.r;v(N,C),v(q,C);var F=e.mont(M),U=N.invm(C),j=I.toRed(F).redPow(new e(x).mul(U).mod(C)).fromRed().mul(D.toRed(F).redPow(q.mul(U).mod(C)).fromRed()).mod(M).mod(C);return j.cmp(q)===0}function v(_,x){if(_.cmpn(0)<=0)throw new Error("invalid sig");if(_.cmp(x)>=0)throw new Error("invalid sig")}return verify_1=o,verify_1}var browser$4,hasRequiredBrowser$3;function requireBrowser$3(){if(hasRequiredBrowser$3)return browser$4;hasRequiredBrowser$3=1;var r=requireSafeBuffer$1().Buffer,e=requireBrowser$9(),t=requireReadableBrowser(),n=requireInherits_browser(),a=requireSign(),o=requireVerify(),c=require$$6;Object.keys(c).forEach(function(E){c[E].id=r.from(c[E].id,"hex"),c[E.toLowerCase()]=c[E]});function u(E){t.Writable.call(this);var M=c[E];if(!M)throw new Error("Unknown message digest");this._hashType=M.hash,this._hash=e(M.hash),this._tag=M.id,this._signType=M.sign}n(u,t.Writable),u.prototype._write=function(M,C,I){this._hash.update(M),I()},u.prototype.update=function(M,C){return this._hash.update(typeof M=="string"?r.from(M,C):M),this},u.prototype.sign=function(M,C){this.end();var I=this._hash.digest(),D=a(I,M,this._hashType,this._signType,this._tag);return C?D.toString(C):D};function v(E){t.Writable.call(this);var M=c[E];if(!M)throw new Error("Unknown message digest");this._hash=e(M.hash),this._tag=M.id,this._signType=M.sign}n(v,t.Writable),v.prototype._write=function(M,C,I){this._hash.update(M),I()},v.prototype.update=function(M,C){return this._hash.update(typeof M=="string"?r.from(M,C):M),this},v.prototype.verify=function(M,C,I){var D=typeof C=="string"?r.from(C,I):C;this.end();var L=this._hash.digest();return o(D,L,M,this._signType,this._tag)};function _(E){return new u(E)}function x(E){return new v(E)}return browser$4={Sign:_,Verify:x,createSign:_,createVerify:x},browser$4}var bn$1={exports:{}};bn$1.exports;var hasRequiredBn$1;function requireBn$1(){return hasRequiredBn$1||(hasRequiredBn$1=1,function(r){(function(e,t){function n(O,l){if(!O)throw new Error(l||"Assertion failed")}function a(O,l){O.super_=l;var p=function(){};p.prototype=l.prototype,O.prototype=new p,O.prototype.constructor=O}function o(O,l,p){if(o.isBN(O))return O;this.negative=0,this.words=null,this.length=0,this.red=null,O!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(O||0,l||10,p||"be"))}typeof e=="object"?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=bufferPolyfill.Buffer}catch{}o.isBN=function(l){return l instanceof o?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===o.wordSize&&Array.isArray(l.words)},o.max=function(l,p){return l.cmp(p)>0?l:p},o.min=function(l,p){return l.cmp(p)<0?l:p},o.prototype._init=function(l,p,b){if(typeof l=="number")return this._initNumber(l,p,b);if(typeof l=="object")return this._initArray(l,p,b);p==="hex"&&(p=16),n(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var S=0;l[0]==="-"&&(S++,this.negative=1),S<l.length&&(p===16?this._parseHex(l,S,b):(this._parseBase(l,p,S),b==="le"&&this._initArray(this.toArray(),p,b)))},o.prototype._initNumber=function(l,p,b){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(n(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),b==="le"&&this._initArray(this.toArray(),p,b)},o.prototype._initArray=function(l,p,b){if(n(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T,B,$=0;if(b==="be")for(S=l.length-1,T=0;S>=0;S-=3)B=l[S]|l[S-1]<<8|l[S-2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);else if(b==="le")for(S=0,T=0;S<l.length;S+=3)B=l[S]|l[S+1]<<8|l[S+2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);return this.strip()};function u(O,l){var p=O.charCodeAt(l);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function v(O,l,p){var b=u(O,p);return p-1>=l&&(b|=u(O,p-1)<<4),b}o.prototype._parseHex=function(l,p,b){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T=0,B=0,$;if(b==="be")for(S=l.length-1;S>=p;S-=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8;else{var A=l.length-p;for(S=A%2===0?p+1:p;S<l.length;S+=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8}this.strip()};function _(O,l,p,b){for(var S=0,T=Math.min(O.length,p),B=l;B<T;B++){var $=O.charCodeAt(B)-48;S*=b,$>=49?S+=$-49+10:$>=17?S+=$-17+10:S+=$}return S}o.prototype._parseBase=function(l,p,b){this.words=[0],this.length=1;for(var S=0,T=1;T<=67108863;T*=p)S++;S--,T=T/p|0;for(var B=l.length-b,$=B%S,A=Math.min(B,B-$)+b,g=0,k=b;k<A;k+=S)g=_(l,k,k+S,p),this.imuln(T),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g);if($!==0){var H=1;for(g=_(l,k,l.length,p),k=0;k<$;k++)H*=p;this.imuln(H),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g)}this.strip()},o.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red},o.prototype.clone=function(){var l=new o(null);return this.copy(l),l},o.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],E=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],M=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(l,p){l=l||10,p=p|0||1;var b;if(l===16||l==="hex"){b="";for(var S=0,T=0,B=0;B<this.length;B++){var $=this.words[B],A=(($<<S|T)&16777215).toString(16);T=$>>>24-S&16777215,S+=2,S>=26&&(S-=26,B--),T!==0||B!==this.length-1?b=x[6-A.length]+A+b:b=A+b}for(T!==0&&(b=T.toString(16)+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}if(l===(l|0)&&l>=2&&l<=36){var g=E[l],k=M[l];b="";var H=this.clone();for(H.negative=0;!H.isZero();){var z=H.modn(k).toString(l);H=H.idivn(k),H.isZero()?b=z+b:b=x[g-z.length]+z+b}for(this.isZero()&&(b="0"+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(l,p){return n(typeof c<"u"),this.toArrayLike(c,l,p)},o.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)},o.prototype.toArrayLike=function(l,p,b){var S=this.byteLength(),T=b||Math.max(1,S);n(S<=T,"byte array longer than desired length"),n(T>0,"Requested array length <= 0"),this.strip();var B=p==="le",$=new l(T),A,g,k=this.clone();if(B){for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[g]=A;for(;g<T;g++)$[g]=0}else{for(g=0;g<T-S;g++)$[g]=0;for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[T-g-1]=A}return $},Math.clz32?o.prototype._countBits=function(l){return 32-Math.clz32(l)}:o.prototype._countBits=function(l){var p=l,b=0;return p>=4096&&(b+=13,p>>>=13),p>=64&&(b+=7,p>>>=7),p>=8&&(b+=4,p>>>=4),p>=2&&(b+=2,p>>>=2),b+p},o.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,b=0;return p&8191||(b+=13,p>>>=13),p&127||(b+=7,p>>>=7),p&15||(b+=4,p>>>=4),p&3||(b+=2,p>>>=2),p&1||b++,b},o.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function C(O){for(var l=new Array(O.bitLength()),p=0;p<l.length;p++){var b=p/26|0,S=p%26;l[p]=(O.words[b]&1<<S)>>>S}return l}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var b=this._zeroBits(this.words[p]);if(l+=b,b!==26)break}return l},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},o.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this.strip()},o.prototype.ior=function(l){return n((this.negative|l.negative)===0),this.iuor(l)},o.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},o.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},o.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var b=0;b<p.length;b++)this.words[b]=this.words[b]&l.words[b];return this.length=p.length,this.strip()},o.prototype.iand=function(l){return n((this.negative|l.negative)===0),this.iuand(l)},o.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},o.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},o.prototype.iuxor=function(l){var p,b;this.length>l.length?(p=this,b=l):(p=l,b=this);for(var S=0;S<b.length;S++)this.words[S]=p.words[S]^b.words[S];if(this!==p)for(;S<p.length;S++)this.words[S]=p.words[S];return this.length=p.length,this.strip()},o.prototype.ixor=function(l){return n((this.negative|l.negative)===0),this.iuxor(l)},o.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},o.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},o.prototype.inotn=function(l){n(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,b=l%26;this._expand(p),b>0&&p--;for(var S=0;S<p;S++)this.words[S]=~this.words[S]&67108863;return b>0&&(this.words[S]=~this.words[S]&67108863>>26-b),this.strip()},o.prototype.notn=function(l){return this.clone().inotn(l)},o.prototype.setn=function(l,p){n(typeof l=="number"&&l>=0);var b=l/26|0,S=l%26;return this._expand(b+1),p?this.words[b]=this.words[b]|1<<S:this.words[b]=this.words[b]&~(1<<S),this.strip()},o.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var b,S;this.length>l.length?(b=this,S=l):(b=l,S=this);for(var T=0,B=0;B<S.length;B++)p=(b.words[B]|0)+(S.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;for(;T!==0&&B<b.length;B++)p=(b.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;if(this.length=b.length,T!==0)this.words[this.length]=T,this.length++;else if(b!==this)for(;B<b.length;B++)this.words[B]=b.words[B];return this},o.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},o.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var b=this.cmp(l);if(b===0)return this.negative=0,this.length=1,this.words[0]=0,this;var S,T;b>0?(S=this,T=l):(S=l,T=this);for(var B=0,$=0;$<T.length;$++)p=(S.words[$]|0)-(T.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;for(;B!==0&&$<S.length;$++)p=(S.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;if(B===0&&$<S.length&&S!==this)for(;$<S.length;$++)this.words[$]=S.words[$];return this.length=Math.max(this.length,$),S!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(l){return this.clone().isub(l)};function I(O,l,p){p.negative=l.negative^O.negative;var b=O.length+l.length|0;p.length=b,b=b-1|0;var S=O.words[0]|0,T=l.words[0]|0,B=S*T,$=B&67108863,A=B/67108864|0;p.words[0]=$;for(var g=1;g<b;g++){for(var k=A>>>26,H=A&67108863,z=Math.min(g,l.length-1),Q=Math.max(0,g-O.length+1);Q<=z;Q++){var ie=g-Q|0;S=O.words[ie]|0,T=l.words[Q]|0,B=S*T+H,k+=B/67108864|0,H=B&67108863}p.words[g]=H|0,A=k|0}return A!==0?p.words[g]=A|0:p.length--,p.strip()}var D=function(l,p,b){var S=l.words,T=p.words,B=b.words,$=0,A,g,k,H=S[0]|0,z=H&8191,Q=H>>>13,ie=S[1]|0,ne=ie&8191,Z=ie>>>13,se=S[2]|0,ae=se&8191,ce=se>>>13,le=S[3]|0,te=le&8191,he=le>>>13,Ae=S[4]|0,ge=Ae&8191,me=Ae>>>13,je=S[5]|0,we=je&8191,pe=je>>>13,Ke=S[6]|0,ye=Ke&8191,xe=Ke>>>13,Ve=S[7]|0,be=Ve&8191,Ee=Ve>>>13,Ge=S[8]|0,re=Ge&8191,Y=Ge>>>13,ee=S[9]|0,fe=ee&8191,ue=ee>>>13,ve=T[0]|0,de=ve&8191,Se=ve>>>13,We=T[1]|0,_e=We&8191,Me=We>>>13,ze=T[2]|0,Te=ze&8191,$e=ze>>>13,Je=T[3]|0,ke=Je&8191,Oe=Je>>>13,Ze=T[4]|0,Be=Ze&8191,Le=Ze>>>13,Qe=T[5]|0,Re=Qe&8191,Ne=Qe>>>13,et=T[6]|0,Ce=et&8191,qe=et>>>13,tt=T[7]|0,Ie=tt&8191,Fe=tt>>>13,rt=T[8]|0,De=rt&8191,Ue=rt>>>13,nt=T[9]|0,Pe=nt&8191,He=nt>>>13;b.negative=l.negative^p.negative,b.length=19,A=Math.imul(z,de),g=Math.imul(z,Se),g=g+Math.imul(Q,de)|0,k=Math.imul(Q,Se);var Xe=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Xe>>>26)|0,Xe&=67108863,A=Math.imul(ne,de),g=Math.imul(ne,Se),g=g+Math.imul(Z,de)|0,k=Math.imul(Z,Se),A=A+Math.imul(z,_e)|0,g=g+Math.imul(z,Me)|0,g=g+Math.imul(Q,_e)|0,k=k+Math.imul(Q,Me)|0;var Ye=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,A=Math.imul(ae,de),g=Math.imul(ae,Se),g=g+Math.imul(ce,de)|0,k=Math.imul(ce,Se),A=A+Math.imul(ne,_e)|0,g=g+Math.imul(ne,Me)|0,g=g+Math.imul(Z,_e)|0,k=k+Math.imul(Z,Me)|0,A=A+Math.imul(z,Te)|0,g=g+Math.imul(z,$e)|0,g=g+Math.imul(Q,Te)|0,k=k+Math.imul(Q,$e)|0;var it=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(it>>>26)|0,it&=67108863,A=Math.imul(te,de),g=Math.imul(te,Se),g=g+Math.imul(he,de)|0,k=Math.imul(he,Se),A=A+Math.imul(ae,_e)|0,g=g+Math.imul(ae,Me)|0,g=g+Math.imul(ce,_e)|0,k=k+Math.imul(ce,Me)|0,A=A+Math.imul(ne,Te)|0,g=g+Math.imul(ne,$e)|0,g=g+Math.imul(Z,Te)|0,k=k+Math.imul(Z,$e)|0,A=A+Math.imul(z,ke)|0,g=g+Math.imul(z,Oe)|0,g=g+Math.imul(Q,ke)|0,k=k+Math.imul(Q,Oe)|0;var st=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(st>>>26)|0,st&=67108863,A=Math.imul(ge,de),g=Math.imul(ge,Se),g=g+Math.imul(me,de)|0,k=Math.imul(me,Se),A=A+Math.imul(te,_e)|0,g=g+Math.imul(te,Me)|0,g=g+Math.imul(he,_e)|0,k=k+Math.imul(he,Me)|0,A=A+Math.imul(ae,Te)|0,g=g+Math.imul(ae,$e)|0,g=g+Math.imul(ce,Te)|0,k=k+Math.imul(ce,$e)|0,A=A+Math.imul(ne,ke)|0,g=g+Math.imul(ne,Oe)|0,g=g+Math.imul(Z,ke)|0,k=k+Math.imul(Z,Oe)|0,A=A+Math.imul(z,Be)|0,g=g+Math.imul(z,Le)|0,g=g+Math.imul(Q,Be)|0,k=k+Math.imul(Q,Le)|0;var ot=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ot>>>26)|0,ot&=67108863,A=Math.imul(we,de),g=Math.imul(we,Se),g=g+Math.imul(pe,de)|0,k=Math.imul(pe,Se),A=A+Math.imul(ge,_e)|0,g=g+Math.imul(ge,Me)|0,g=g+Math.imul(me,_e)|0,k=k+Math.imul(me,Me)|0,A=A+Math.imul(te,Te)|0,g=g+Math.imul(te,$e)|0,g=g+Math.imul(he,Te)|0,k=k+Math.imul(he,$e)|0,A=A+Math.imul(ae,ke)|0,g=g+Math.imul(ae,Oe)|0,g=g+Math.imul(ce,ke)|0,k=k+Math.imul(ce,Oe)|0,A=A+Math.imul(ne,Be)|0,g=g+Math.imul(ne,Le)|0,g=g+Math.imul(Z,Be)|0,k=k+Math.imul(Z,Le)|0,A=A+Math.imul(z,Re)|0,g=g+Math.imul(z,Ne)|0,g=g+Math.imul(Q,Re)|0,k=k+Math.imul(Q,Ne)|0;var at=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(at>>>26)|0,at&=67108863,A=Math.imul(ye,de),g=Math.imul(ye,Se),g=g+Math.imul(xe,de)|0,k=Math.imul(xe,Se),A=A+Math.imul(we,_e)|0,g=g+Math.imul(we,Me)|0,g=g+Math.imul(pe,_e)|0,k=k+Math.imul(pe,Me)|0,A=A+Math.imul(ge,Te)|0,g=g+Math.imul(ge,$e)|0,g=g+Math.imul(me,Te)|0,k=k+Math.imul(me,$e)|0,A=A+Math.imul(te,ke)|0,g=g+Math.imul(te,Oe)|0,g=g+Math.imul(he,ke)|0,k=k+Math.imul(he,Oe)|0,A=A+Math.imul(ae,Be)|0,g=g+Math.imul(ae,Le)|0,g=g+Math.imul(ce,Be)|0,k=k+Math.imul(ce,Le)|0,A=A+Math.imul(ne,Re)|0,g=g+Math.imul(ne,Ne)|0,g=g+Math.imul(Z,Re)|0,k=k+Math.imul(Z,Ne)|0,A=A+Math.imul(z,Ce)|0,g=g+Math.imul(z,qe)|0,g=g+Math.imul(Q,Ce)|0,k=k+Math.imul(Q,qe)|0;var ft=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ft>>>26)|0,ft&=67108863,A=Math.imul(be,de),g=Math.imul(be,Se),g=g+Math.imul(Ee,de)|0,k=Math.imul(Ee,Se),A=A+Math.imul(ye,_e)|0,g=g+Math.imul(ye,Me)|0,g=g+Math.imul(xe,_e)|0,k=k+Math.imul(xe,Me)|0,A=A+Math.imul(we,Te)|0,g=g+Math.imul(we,$e)|0,g=g+Math.imul(pe,Te)|0,k=k+Math.imul(pe,$e)|0,A=A+Math.imul(ge,ke)|0,g=g+Math.imul(ge,Oe)|0,g=g+Math.imul(me,ke)|0,k=k+Math.imul(me,Oe)|0,A=A+Math.imul(te,Be)|0,g=g+Math.imul(te,Le)|0,g=g+Math.imul(he,Be)|0,k=k+Math.imul(he,Le)|0,A=A+Math.imul(ae,Re)|0,g=g+Math.imul(ae,Ne)|0,g=g+Math.imul(ce,Re)|0,k=k+Math.imul(ce,Ne)|0,A=A+Math.imul(ne,Ce)|0,g=g+Math.imul(ne,qe)|0,g=g+Math.imul(Z,Ce)|0,k=k+Math.imul(Z,qe)|0,A=A+Math.imul(z,Ie)|0,g=g+Math.imul(z,Fe)|0,g=g+Math.imul(Q,Ie)|0,k=k+Math.imul(Q,Fe)|0;var lt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(lt>>>26)|0,lt&=67108863,A=Math.imul(re,de),g=Math.imul(re,Se),g=g+Math.imul(Y,de)|0,k=Math.imul(Y,Se),A=A+Math.imul(be,_e)|0,g=g+Math.imul(be,Me)|0,g=g+Math.imul(Ee,_e)|0,k=k+Math.imul(Ee,Me)|0,A=A+Math.imul(ye,Te)|0,g=g+Math.imul(ye,$e)|0,g=g+Math.imul(xe,Te)|0,k=k+Math.imul(xe,$e)|0,A=A+Math.imul(we,ke)|0,g=g+Math.imul(we,Oe)|0,g=g+Math.imul(pe,ke)|0,k=k+Math.imul(pe,Oe)|0,A=A+Math.imul(ge,Be)|0,g=g+Math.imul(ge,Le)|0,g=g+Math.imul(me,Be)|0,k=k+Math.imul(me,Le)|0,A=A+Math.imul(te,Re)|0,g=g+Math.imul(te,Ne)|0,g=g+Math.imul(he,Re)|0,k=k+Math.imul(he,Ne)|0,A=A+Math.imul(ae,Ce)|0,g=g+Math.imul(ae,qe)|0,g=g+Math.imul(ce,Ce)|0,k=k+Math.imul(ce,qe)|0,A=A+Math.imul(ne,Ie)|0,g=g+Math.imul(ne,Fe)|0,g=g+Math.imul(Z,Ie)|0,k=k+Math.imul(Z,Fe)|0,A=A+Math.imul(z,De)|0,g=g+Math.imul(z,Ue)|0,g=g+Math.imul(Q,De)|0,k=k+Math.imul(Q,Ue)|0;var ct=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ct>>>26)|0,ct&=67108863,A=Math.imul(fe,de),g=Math.imul(fe,Se),g=g+Math.imul(ue,de)|0,k=Math.imul(ue,Se),A=A+Math.imul(re,_e)|0,g=g+Math.imul(re,Me)|0,g=g+Math.imul(Y,_e)|0,k=k+Math.imul(Y,Me)|0,A=A+Math.imul(be,Te)|0,g=g+Math.imul(be,$e)|0,g=g+Math.imul(Ee,Te)|0,k=k+Math.imul(Ee,$e)|0,A=A+Math.imul(ye,ke)|0,g=g+Math.imul(ye,Oe)|0,g=g+Math.imul(xe,ke)|0,k=k+Math.imul(xe,Oe)|0,A=A+Math.imul(we,Be)|0,g=g+Math.imul(we,Le)|0,g=g+Math.imul(pe,Be)|0,k=k+Math.imul(pe,Le)|0,A=A+Math.imul(ge,Re)|0,g=g+Math.imul(ge,Ne)|0,g=g+Math.imul(me,Re)|0,k=k+Math.imul(me,Ne)|0,A=A+Math.imul(te,Ce)|0,g=g+Math.imul(te,qe)|0,g=g+Math.imul(he,Ce)|0,k=k+Math.imul(he,qe)|0,A=A+Math.imul(ae,Ie)|0,g=g+Math.imul(ae,Fe)|0,g=g+Math.imul(ce,Ie)|0,k=k+Math.imul(ce,Fe)|0,A=A+Math.imul(ne,De)|0,g=g+Math.imul(ne,Ue)|0,g=g+Math.imul(Z,De)|0,k=k+Math.imul(Z,Ue)|0,A=A+Math.imul(z,Pe)|0,g=g+Math.imul(z,He)|0,g=g+Math.imul(Q,Pe)|0,k=k+Math.imul(Q,He)|0;var ht=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ht>>>26)|0,ht&=67108863,A=Math.imul(fe,_e),g=Math.imul(fe,Me),g=g+Math.imul(ue,_e)|0,k=Math.imul(ue,Me),A=A+Math.imul(re,Te)|0,g=g+Math.imul(re,$e)|0,g=g+Math.imul(Y,Te)|0,k=k+Math.imul(Y,$e)|0,A=A+Math.imul(be,ke)|0,g=g+Math.imul(be,Oe)|0,g=g+Math.imul(Ee,ke)|0,k=k+Math.imul(Ee,Oe)|0,A=A+Math.imul(ye,Be)|0,g=g+Math.imul(ye,Le)|0,g=g+Math.imul(xe,Be)|0,k=k+Math.imul(xe,Le)|0,A=A+Math.imul(we,Re)|0,g=g+Math.imul(we,Ne)|0,g=g+Math.imul(pe,Re)|0,k=k+Math.imul(pe,Ne)|0,A=A+Math.imul(ge,Ce)|0,g=g+Math.imul(ge,qe)|0,g=g+Math.imul(me,Ce)|0,k=k+Math.imul(me,qe)|0,A=A+Math.imul(te,Ie)|0,g=g+Math.imul(te,Fe)|0,g=g+Math.imul(he,Ie)|0,k=k+Math.imul(he,Fe)|0,A=A+Math.imul(ae,De)|0,g=g+Math.imul(ae,Ue)|0,g=g+Math.imul(ce,De)|0,k=k+Math.imul(ce,Ue)|0,A=A+Math.imul(ne,Pe)|0,g=g+Math.imul(ne,He)|0,g=g+Math.imul(Z,Pe)|0,k=k+Math.imul(Z,He)|0;var dt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(dt>>>26)|0,dt&=67108863,A=Math.imul(fe,Te),g=Math.imul(fe,$e),g=g+Math.imul(ue,Te)|0,k=Math.imul(ue,$e),A=A+Math.imul(re,ke)|0,g=g+Math.imul(re,Oe)|0,g=g+Math.imul(Y,ke)|0,k=k+Math.imul(Y,Oe)|0,A=A+Math.imul(be,Be)|0,g=g+Math.imul(be,Le)|0,g=g+Math.imul(Ee,Be)|0,k=k+Math.imul(Ee,Le)|0,A=A+Math.imul(ye,Re)|0,g=g+Math.imul(ye,Ne)|0,g=g+Math.imul(xe,Re)|0,k=k+Math.imul(xe,Ne)|0,A=A+Math.imul(we,Ce)|0,g=g+Math.imul(we,qe)|0,g=g+Math.imul(pe,Ce)|0,k=k+Math.imul(pe,qe)|0,A=A+Math.imul(ge,Ie)|0,g=g+Math.imul(ge,Fe)|0,g=g+Math.imul(me,Ie)|0,k=k+Math.imul(me,Fe)|0,A=A+Math.imul(te,De)|0,g=g+Math.imul(te,Ue)|0,g=g+Math.imul(he,De)|0,k=k+Math.imul(he,Ue)|0,A=A+Math.imul(ae,Pe)|0,g=g+Math.imul(ae,He)|0,g=g+Math.imul(ce,Pe)|0,k=k+Math.imul(ce,He)|0;var pt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(pt>>>26)|0,pt&=67108863,A=Math.imul(fe,ke),g=Math.imul(fe,Oe),g=g+Math.imul(ue,ke)|0,k=Math.imul(ue,Oe),A=A+Math.imul(re,Be)|0,g=g+Math.imul(re,Le)|0,g=g+Math.imul(Y,Be)|0,k=k+Math.imul(Y,Le)|0,A=A+Math.imul(be,Re)|0,g=g+Math.imul(be,Ne)|0,g=g+Math.imul(Ee,Re)|0,k=k+Math.imul(Ee,Ne)|0,A=A+Math.imul(ye,Ce)|0,g=g+Math.imul(ye,qe)|0,g=g+Math.imul(xe,Ce)|0,k=k+Math.imul(xe,qe)|0,A=A+Math.imul(we,Ie)|0,g=g+Math.imul(we,Fe)|0,g=g+Math.imul(pe,Ie)|0,k=k+Math.imul(pe,Fe)|0,A=A+Math.imul(ge,De)|0,g=g+Math.imul(ge,Ue)|0,g=g+Math.imul(me,De)|0,k=k+Math.imul(me,Ue)|0,A=A+Math.imul(te,Pe)|0,g=g+Math.imul(te,He)|0,g=g+Math.imul(he,Pe)|0,k=k+Math.imul(he,He)|0;var gt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(gt>>>26)|0,gt&=67108863,A=Math.imul(fe,Be),g=Math.imul(fe,Le),g=g+Math.imul(ue,Be)|0,k=Math.imul(ue,Le),A=A+Math.imul(re,Re)|0,g=g+Math.imul(re,Ne)|0,g=g+Math.imul(Y,Re)|0,k=k+Math.imul(Y,Ne)|0,A=A+Math.imul(be,Ce)|0,g=g+Math.imul(be,qe)|0,g=g+Math.imul(Ee,Ce)|0,k=k+Math.imul(Ee,qe)|0,A=A+Math.imul(ye,Ie)|0,g=g+Math.imul(ye,Fe)|0,g=g+Math.imul(xe,Ie)|0,k=k+Math.imul(xe,Fe)|0,A=A+Math.imul(we,De)|0,g=g+Math.imul(we,Ue)|0,g=g+Math.imul(pe,De)|0,k=k+Math.imul(pe,Ue)|0,A=A+Math.imul(ge,Pe)|0,g=g+Math.imul(ge,He)|0,g=g+Math.imul(me,Pe)|0,k=k+Math.imul(me,He)|0;var mt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(mt>>>26)|0,mt&=67108863,A=Math.imul(fe,Re),g=Math.imul(fe,Ne),g=g+Math.imul(ue,Re)|0,k=Math.imul(ue,Ne),A=A+Math.imul(re,Ce)|0,g=g+Math.imul(re,qe)|0,g=g+Math.imul(Y,Ce)|0,k=k+Math.imul(Y,qe)|0,A=A+Math.imul(be,Ie)|0,g=g+Math.imul(be,Fe)|0,g=g+Math.imul(Ee,Ie)|0,k=k+Math.imul(Ee,Fe)|0,A=A+Math.imul(ye,De)|0,g=g+Math.imul(ye,Ue)|0,g=g+Math.imul(xe,De)|0,k=k+Math.imul(xe,Ue)|0,A=A+Math.imul(we,Pe)|0,g=g+Math.imul(we,He)|0,g=g+Math.imul(pe,Pe)|0,k=k+Math.imul(pe,He)|0;var yt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(yt>>>26)|0,yt&=67108863,A=Math.imul(fe,Ce),g=Math.imul(fe,qe),g=g+Math.imul(ue,Ce)|0,k=Math.imul(ue,qe),A=A+Math.imul(re,Ie)|0,g=g+Math.imul(re,Fe)|0,g=g+Math.imul(Y,Ie)|0,k=k+Math.imul(Y,Fe)|0,A=A+Math.imul(be,De)|0,g=g+Math.imul(be,Ue)|0,g=g+Math.imul(Ee,De)|0,k=k+Math.imul(Ee,Ue)|0,A=A+Math.imul(ye,Pe)|0,g=g+Math.imul(ye,He)|0,g=g+Math.imul(xe,Pe)|0,k=k+Math.imul(xe,He)|0;var vt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(vt>>>26)|0,vt&=67108863,A=Math.imul(fe,Ie),g=Math.imul(fe,Fe),g=g+Math.imul(ue,Ie)|0,k=Math.imul(ue,Fe),A=A+Math.imul(re,De)|0,g=g+Math.imul(re,Ue)|0,g=g+Math.imul(Y,De)|0,k=k+Math.imul(Y,Ue)|0,A=A+Math.imul(be,Pe)|0,g=g+Math.imul(be,He)|0,g=g+Math.imul(Ee,Pe)|0,k=k+Math.imul(Ee,He)|0;var bt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(bt>>>26)|0,bt&=67108863,A=Math.imul(fe,De),g=Math.imul(fe,Ue),g=g+Math.imul(ue,De)|0,k=Math.imul(ue,Ue),A=A+Math.imul(re,Pe)|0,g=g+Math.imul(re,He)|0,g=g+Math.imul(Y,Pe)|0,k=k+Math.imul(Y,He)|0;var wt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(wt>>>26)|0,wt&=67108863,A=Math.imul(fe,Pe),g=Math.imul(fe,He),g=g+Math.imul(ue,Pe)|0,k=Math.imul(ue,He);var _t=($+A|0)+((g&8191)<<13)|0;return $=(k+(g>>>13)|0)+(_t>>>26)|0,_t&=67108863,B[0]=Xe,B[1]=Ye,B[2]=it,B[3]=st,B[4]=ot,B[5]=at,B[6]=ft,B[7]=lt,B[8]=ct,B[9]=ht,B[10]=dt,B[11]=pt,B[12]=gt,B[13]=mt,B[14]=yt,B[15]=vt,B[16]=bt,B[17]=wt,B[18]=_t,$!==0&&(B[19]=$,b.length++),b};Math.imul||(D=I);function L(O,l,p){p.negative=l.negative^O.negative,p.length=O.length+l.length;for(var b=0,S=0,T=0;T<p.length-1;T++){var B=S;S=0;for(var $=b&67108863,A=Math.min(T,l.length-1),g=Math.max(0,T-O.length+1);g<=A;g++){var k=T-g,H=O.words[k]|0,z=l.words[g]|0,Q=H*z,ie=Q&67108863;B=B+(Q/67108864|0)|0,ie=ie+$|0,$=ie&67108863,B=B+(ie>>>26)|0,S+=B>>>26,B&=67108863}p.words[T]=$,b=B,B=S}return b!==0?p.words[T]=b:p.length--,p.strip()}function N(O,l,p){var b=new q;return b.mulp(O,l,p)}o.prototype.mulTo=function(l,p){var b,S=this.length+l.length;return this.length===10&&l.length===10?b=D(this,l,p):S<63?b=I(this,l,p):S<1024?b=L(this,l,p):b=N(this,l,p),b};function q(O,l){this.x=O,this.y=l}q.prototype.makeRBT=function(l){for(var p=new Array(l),b=o.prototype._countBits(l)-1,S=0;S<l;S++)p[S]=this.revBin(S,b,l);return p},q.prototype.revBin=function(l,p,b){if(l===0||l===b-1)return l;for(var S=0,T=0;T<p;T++)S|=(l&1)<<p-T-1,l>>=1;return S},q.prototype.permute=function(l,p,b,S,T,B){for(var $=0;$<B;$++)S[$]=p[l[$]],T[$]=b[l[$]]},q.prototype.transform=function(l,p,b,S,T,B){this.permute(B,l,p,b,S,T);for(var $=1;$<T;$<<=1)for(var A=$<<1,g=Math.cos(2*Math.PI/A),k=Math.sin(2*Math.PI/A),H=0;H<T;H+=A)for(var z=g,Q=k,ie=0;ie<$;ie++){var ne=b[H+ie],Z=S[H+ie],se=b[H+ie+$],ae=S[H+ie+$],ce=z*se-Q*ae;ae=z*ae+Q*se,se=ce,b[H+ie]=ne+se,S[H+ie]=Z+ae,b[H+ie+$]=ne-se,S[H+ie+$]=Z-ae,ie!==A&&(ce=g*z-k*Q,Q=g*Q+k*z,z=ce)}},q.prototype.guessLen13b=function(l,p){var b=Math.max(p,l)|1,S=b&1,T=0;for(b=b/2|0;b;b=b>>>1)T++;return 1<<T+1+S},q.prototype.conjugate=function(l,p,b){if(!(b<=1))for(var S=0;S<b/2;S++){var T=l[S];l[S]=l[b-S-1],l[b-S-1]=T,T=p[S],p[S]=-p[b-S-1],p[b-S-1]=-T}},q.prototype.normalize13b=function(l,p){for(var b=0,S=0;S<p/2;S++){var T=Math.round(l[2*S+1]/p)*8192+Math.round(l[2*S]/p)+b;l[S]=T&67108863,T<67108864?b=0:b=T/67108864|0}return l},q.prototype.convert13b=function(l,p,b,S){for(var T=0,B=0;B<p;B++)T=T+(l[B]|0),b[2*B]=T&8191,T=T>>>13,b[2*B+1]=T&8191,T=T>>>13;for(B=2*p;B<S;++B)b[B]=0;n(T===0),n((T&-8192)===0)},q.prototype.stub=function(l){for(var p=new Array(l),b=0;b<l;b++)p[b]=0;return p},q.prototype.mulp=function(l,p,b){var S=2*this.guessLen13b(l.length,p.length),T=this.makeRBT(S),B=this.stub(S),$=new Array(S),A=new Array(S),g=new Array(S),k=new Array(S),H=new Array(S),z=new Array(S),Q=b.words;Q.length=S,this.convert13b(l.words,l.length,$,S),this.convert13b(p.words,p.length,k,S),this.transform($,B,A,g,S,T),this.transform(k,B,H,z,S,T);for(var ie=0;ie<S;ie++){var ne=A[ie]*H[ie]-g[ie]*z[ie];g[ie]=A[ie]*z[ie]+g[ie]*H[ie],A[ie]=ne}return this.conjugate(A,g,S),this.transform(A,g,Q,B,S,T),this.conjugate(Q,B,S),this.normalize13b(Q,S),b.negative=l.negative^p.negative,b.length=l.length+p.length,b.strip()},o.prototype.mul=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},o.prototype.mulf=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),N(this,l,p)},o.prototype.imul=function(l){return this.clone().mulTo(l,this)},o.prototype.imuln=function(l){n(typeof l=="number"),n(l<67108864);for(var p=0,b=0;b<this.length;b++){var S=(this.words[b]|0)*l,T=(S&67108863)+(p&67108863);p>>=26,p+=S/67108864|0,p+=T>>>26,this.words[b]=T&67108863}return p!==0&&(this.words[b]=p,this.length++),this},o.prototype.muln=function(l){return this.clone().imuln(l)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(l){var p=C(l);if(p.length===0)return new o(1);for(var b=this,S=0;S<p.length&&p[S]===0;S++,b=b.sqr());if(++S<p.length)for(var T=b.sqr();S<p.length;S++,T=T.sqr())p[S]!==0&&(b=b.mul(T));return b},o.prototype.iushln=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=67108863>>>26-p<<26-p,T;if(p!==0){var B=0;for(T=0;T<this.length;T++){var $=this.words[T]&S,A=(this.words[T]|0)-$<<p;this.words[T]=A|B,B=$>>>26-p}B&&(this.words[T]=B,this.length++)}if(b!==0){for(T=this.length-1;T>=0;T--)this.words[T+b]=this.words[T];for(T=0;T<b;T++)this.words[T]=0;this.length+=b}return this.strip()},o.prototype.ishln=function(l){return n(this.negative===0),this.iushln(l)},o.prototype.iushrn=function(l,p,b){n(typeof l=="number"&&l>=0);var S;p?S=(p-p%26)/26:S=0;var T=l%26,B=Math.min((l-T)/26,this.length),$=67108863^67108863>>>T<<T,A=b;if(S-=B,S=Math.max(0,S),A){for(var g=0;g<B;g++)A.words[g]=this.words[g];A.length=B}if(B!==0)if(this.length>B)for(this.length-=B,g=0;g<this.length;g++)this.words[g]=this.words[g+B];else this.words[0]=0,this.length=1;var k=0;for(g=this.length-1;g>=0&&(k!==0||g>=S);g--){var H=this.words[g]|0;this.words[g]=k<<26-T|H>>>T,k=H&$}return A&&k!==0&&(A.words[A.length++]=k),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(l,p,b){return n(this.negative===0),this.iushrn(l,p,b)},o.prototype.shln=function(l){return this.clone().ishln(l)},o.prototype.ushln=function(l){return this.clone().iushln(l)},o.prototype.shrn=function(l){return this.clone().ishrn(l)},o.prototype.ushrn=function(l){return this.clone().iushrn(l)},o.prototype.testn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return!1;var T=this.words[b];return!!(T&S)},o.prototype.imaskn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=b)return this;if(p!==0&&b++,this.length=Math.min(b,this.length),p!==0){var S=67108863^67108863>>>p<<p;this.words[this.length-1]&=S}return this.strip()},o.prototype.maskn=function(l){return this.clone().imaskn(l)},o.prototype.iaddn=function(l){return n(typeof l=="number"),n(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},o.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},o.prototype.isubn=function(l){if(n(typeof l=="number"),n(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},o.prototype.addn=function(l){return this.clone().iaddn(l)},o.prototype.subn=function(l){return this.clone().isubn(l)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(l,p,b){var S=l.length+b,T;this._expand(S);var B,$=0;for(T=0;T<l.length;T++){B=(this.words[T+b]|0)+$;var A=(l.words[T]|0)*p;B-=A&67108863,$=(B>>26)-(A/67108864|0),this.words[T+b]=B&67108863}for(;T<this.length-b;T++)B=(this.words[T+b]|0)+$,$=B>>26,this.words[T+b]=B&67108863;if($===0)return this.strip();for(n($===-1),$=0,T=0;T<this.length;T++)B=-(this.words[T]|0)+$,$=B>>26,this.words[T]=B&67108863;return this.negative=1,this.strip()},o.prototype._wordDiv=function(l,p){var b=this.length-l.length,S=this.clone(),T=l,B=T.words[T.length-1]|0,$=this._countBits(B);b=26-$,b!==0&&(T=T.ushln(b),S.iushln(b),B=T.words[T.length-1]|0);var A=S.length-T.length,g;if(p!=="mod"){g=new o(null),g.length=A+1,g.words=new Array(g.length);for(var k=0;k<g.length;k++)g.words[k]=0}var H=S.clone()._ishlnsubmul(T,1,A);H.negative===0&&(S=H,g&&(g.words[A]=1));for(var z=A-1;z>=0;z--){var Q=(S.words[T.length+z]|0)*67108864+(S.words[T.length+z-1]|0);for(Q=Math.min(Q/B|0,67108863),S._ishlnsubmul(T,Q,z);S.negative!==0;)Q--,S.negative=0,S._ishlnsubmul(T,1,z),S.isZero()||(S.negative^=1);g&&(g.words[z]=Q)}return g&&g.strip(),S.strip(),p!=="div"&&b!==0&&S.iushrn(b),{div:g||null,mod:S}},o.prototype.divmod=function(l,p,b){if(n(!l.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var S,T,B;return this.negative!==0&&l.negative===0?(B=this.neg().divmod(l,p),p!=="mod"&&(S=B.div.neg()),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.iadd(l)),{div:S,mod:T}):this.negative===0&&l.negative!==0?(B=this.divmod(l.neg(),p),p!=="mod"&&(S=B.div.neg()),{div:S,mod:B.mod}):this.negative&l.negative?(B=this.neg().divmod(l.neg(),p),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.isub(l)),{div:B.div,mod:T}):l.length>this.length||this.cmp(l)<0?{div:new o(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new o(this.modn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new o(this.modn(l.words[0]))}:this._wordDiv(l,p)},o.prototype.div=function(l){return this.divmod(l,"div",!1).div},o.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},o.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},o.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var b=p.div.negative!==0?p.mod.isub(l):p.mod,S=l.ushrn(1),T=l.andln(1),B=b.cmp(S);return B<0||T===1&&B===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},o.prototype.modn=function(l){n(l<=67108863);for(var p=(1<<26)%l,b=0,S=this.length-1;S>=0;S--)b=(p*b+(this.words[S]|0))%l;return b},o.prototype.idivn=function(l){n(l<=67108863);for(var p=0,b=this.length-1;b>=0;b--){var S=(this.words[b]|0)+p*67108864;this.words[b]=S/l|0,p=S%l}return this.strip()},o.prototype.divn=function(l){return this.clone().idivn(l)},o.prototype.egcd=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=new o(0),$=new o(1),A=0;p.isEven()&&b.isEven();)p.iushrn(1),b.iushrn(1),++A;for(var g=b.clone(),k=p.clone();!p.isZero();){for(var H=0,z=1;!(p.words[0]&z)&&H<26;++H,z<<=1);if(H>0)for(p.iushrn(H);H-- >0;)(S.isOdd()||T.isOdd())&&(S.iadd(g),T.isub(k)),S.iushrn(1),T.iushrn(1);for(var Q=0,ie=1;!(b.words[0]&ie)&&Q<26;++Q,ie<<=1);if(Q>0)for(b.iushrn(Q);Q-- >0;)(B.isOdd()||$.isOdd())&&(B.iadd(g),$.isub(k)),B.iushrn(1),$.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(B),T.isub($)):(b.isub(p),B.isub(S),$.isub(T))}return{a:B,b:$,gcd:b.iushln(A)}},o.prototype._invmp=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=b.clone();p.cmpn(1)>0&&b.cmpn(1)>0;){for(var $=0,A=1;!(p.words[0]&A)&&$<26;++$,A<<=1);if($>0)for(p.iushrn($);$-- >0;)S.isOdd()&&S.iadd(B),S.iushrn(1);for(var g=0,k=1;!(b.words[0]&k)&&g<26;++g,k<<=1);if(g>0)for(b.iushrn(g);g-- >0;)T.isOdd()&&T.iadd(B),T.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(T)):(b.isub(p),T.isub(S))}var H;return p.cmpn(1)===0?H=S:H=T,H.cmpn(0)<0&&H.iadd(l),H},o.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),b=l.clone();p.negative=0,b.negative=0;for(var S=0;p.isEven()&&b.isEven();S++)p.iushrn(1),b.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;b.isEven();)b.iushrn(1);var T=p.cmp(b);if(T<0){var B=p;p=b,b=B}else if(T===0||b.cmpn(1)===0)break;p.isub(b)}while(!0);return b.iushln(S)},o.prototype.invm=function(l){return this.egcd(l).a.umod(l)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(l){return this.words[0]&l},o.prototype.bincn=function(l){n(typeof l=="number");var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return this._expand(b+1),this.words[b]|=S,this;for(var T=S,B=b;T!==0&&B<this.length;B++){var $=this.words[B]|0;$+=T,T=$>>>26,$&=67108863,this.words[B]=$}return T!==0&&(this.words[B]=T,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var b;if(this.length>1)b=1;else{p&&(l=-l),n(l<=67108863,"Number is too big");var S=this.words[0]|0;b=S===l?0:S<l?-1:1}return this.negative!==0?-b|0:b},o.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},o.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,b=this.length-1;b>=0;b--){var S=this.words[b]|0,T=l.words[b]|0;if(S!==T){S<T?p=-1:S>T&&(p=1);break}}return p},o.prototype.gtn=function(l){return this.cmpn(l)===1},o.prototype.gt=function(l){return this.cmp(l)===1},o.prototype.gten=function(l){return this.cmpn(l)>=0},o.prototype.gte=function(l){return this.cmp(l)>=0},o.prototype.ltn=function(l){return this.cmpn(l)===-1},o.prototype.lt=function(l){return this.cmp(l)===-1},o.prototype.lten=function(l){return this.cmpn(l)<=0},o.prototype.lte=function(l){return this.cmp(l)<=0},o.prototype.eqn=function(l){return this.cmpn(l)===0},o.prototype.eq=function(l){return this.cmp(l)===0},o.red=function(l){return new G(l)},o.prototype.toRed=function(l){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(l){return this.red=l,this},o.prototype.forceRed=function(l){return n(!this.red,"Already a number in reduction context"),this._forceRed(l)},o.prototype.redAdd=function(l){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},o.prototype.redIAdd=function(l){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},o.prototype.redSub=function(l){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},o.prototype.redISub=function(l){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},o.prototype.redShl=function(l){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},o.prototype.redMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},o.prototype.redIMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(l){return n(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var F={k256:null,p224:null,p192:null,p25519:null};function U(O,l){this.name=O,this.p=new o(l,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var l=new o(null);return l.words=new Array(Math.ceil(this.n/13)),l},U.prototype.ireduce=function(l){var p=l,b;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),b=p.bitLength();while(b>this.n);var S=b<this.n?-1:p.ucmp(this.p);return S===0?(p.words[0]=0,p.length=1):S>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},U.prototype.split=function(l,p){l.iushrn(this.n,0,p)},U.prototype.imulK=function(l){return l.imul(this.k)};function j(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(j,U),j.prototype.split=function(l,p){for(var b=4194303,S=Math.min(l.length,9),T=0;T<S;T++)p.words[T]=l.words[T];if(p.length=S,l.length<=9){l.words[0]=0,l.length=1;return}var B=l.words[9];for(p.words[p.length++]=B&b,T=10;T<l.length;T++){var $=l.words[T]|0;l.words[T-10]=($&b)<<4|B>>>22,B=$}B>>>=22,l.words[T-10]=B,B===0&&l.length>10?l.length-=10:l.length-=9},j.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,b=0;b<l.length;b++){var S=l.words[b]|0;p+=S*977,l.words[b]=p&67108863,p=S*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function W(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(W,U);function X(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(X,U);function J(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(J,U),J.prototype.imulK=function(l){for(var p=0,b=0;b<l.length;b++){var S=(l.words[b]|0)*19+p,T=S&67108863;S>>>=26,l.words[b]=T,p=S}return p!==0&&(l.words[l.length++]=p),l},o._prime=function(l){if(F[l])return F[l];var p;if(l==="k256")p=new j;else if(l==="p224")p=new W;else if(l==="p192")p=new X;else if(l==="p25519")p=new J;else throw new Error("Unknown prime "+l);return F[l]=p,p};function G(O){if(typeof O=="string"){var l=o._prime(O);this.m=l.p,this.prime=l}else n(O.gtn(1),"modulus must be greater than 1"),this.m=O,this.prime=null}G.prototype._verify1=function(l){n(l.negative===0,"red works only with positives"),n(l.red,"red works only with red numbers")},G.prototype._verify2=function(l,p){n((l.negative|p.negative)===0,"red works only with positives"),n(l.red&&l.red===p.red,"red works only with red numbers")},G.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):l.umod(this.m)._forceRed(this)},G.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},G.prototype.add=function(l,p){this._verify2(l,p);var b=l.add(p);return b.cmp(this.m)>=0&&b.isub(this.m),b._forceRed(this)},G.prototype.iadd=function(l,p){this._verify2(l,p);var b=l.iadd(p);return b.cmp(this.m)>=0&&b.isub(this.m),b},G.prototype.sub=function(l,p){this._verify2(l,p);var b=l.sub(p);return b.cmpn(0)<0&&b.iadd(this.m),b._forceRed(this)},G.prototype.isub=function(l,p){this._verify2(l,p);var b=l.isub(p);return b.cmpn(0)<0&&b.iadd(this.m),b},G.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},G.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},G.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},G.prototype.isqr=function(l){return this.imul(l,l.clone())},G.prototype.sqr=function(l){return this.mul(l,l)},G.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(n(p%2===1),p===3){var b=this.m.add(new o(1)).iushrn(2);return this.pow(l,b)}for(var S=this.m.subn(1),T=0;!S.isZero()&&S.andln(1)===0;)T++,S.iushrn(1);n(!S.isZero());var B=new o(1).toRed(this),$=B.redNeg(),A=this.m.subn(1).iushrn(1),g=this.m.bitLength();for(g=new o(2*g*g).toRed(this);this.pow(g,A).cmp($)!==0;)g.redIAdd($);for(var k=this.pow(g,S),H=this.pow(l,S.addn(1).iushrn(1)),z=this.pow(l,S),Q=T;z.cmp(B)!==0;){for(var ie=z,ne=0;ie.cmp(B)!==0;ne++)ie=ie.redSqr();n(ne<Q);var Z=this.pow(k,new o(1).iushln(Q-ne-1));H=H.redMul(Z),k=Z.redSqr(),z=z.redMul(k),Q=ne}return H},G.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},G.prototype.pow=function(l,p){if(p.isZero())return new o(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var b=4,S=new Array(1<<b);S[0]=new o(1).toRed(this),S[1]=l;for(var T=2;T<S.length;T++)S[T]=this.mul(S[T-1],l);var B=S[0],$=0,A=0,g=p.bitLength()%26;for(g===0&&(g=26),T=p.length-1;T>=0;T--){for(var k=p.words[T],H=g-1;H>=0;H--){var z=k>>H&1;if(B!==S[0]&&(B=this.sqr(B)),z===0&&$===0){A=0;continue}$<<=1,$|=z,A++,!(A!==b&&(T!==0||H!==0))&&(B=this.mul(B,S[$]),A=0,$=0)}g=26}return B},G.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},G.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},o.mont=function(l){return new oe(l)};function oe(O){G.call(this,O),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(oe,G),oe.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},oe.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},oe.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var b=l.imul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new o(0)._forceRed(this);var b=l.mul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,commonjsGlobal)}(bn$1)),bn$1.exports}var browser$3,hasRequiredBrowser$2;function requireBrowser$2(){if(hasRequiredBrowser$2)return browser$3;hasRequiredBrowser$2=1;var r=requireElliptic(),e=requireBn$1();browser$3=function(c){return new n(c)};var t={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};t.p224=t.secp224r1,t.p256=t.secp256r1=t.prime256v1,t.p192=t.secp192r1=t.prime192v1,t.p384=t.secp384r1,t.p521=t.secp521r1;function n(o){this.curveType=t[o],this.curveType||(this.curveType={name:o}),this.curve=new r.ec(this.curveType.name),this.keys=void 0}n.prototype.generateKeys=function(o,c){return this.keys=this.curve.genKeyPair(),this.getPublicKey(o,c)},n.prototype.computeSecret=function(o,c,u){c=c||"utf8",dist.Buffer.isBuffer(o)||(o=new dist.Buffer(o,c));var v=this.curve.keyFromPublic(o).getPublic(),_=v.mul(this.keys.getPrivate()).getX();return a(_,u,this.curveType.byteLength)},n.prototype.getPublicKey=function(o,c){var u=this.keys.getPublic(c==="compressed",!0);return c==="hybrid"&&(u[u.length-1]%2?u[0]=7:u[0]=6),a(u,o)},n.prototype.getPrivateKey=function(o){return a(this.keys.getPrivate(),o)},n.prototype.setPublicKey=function(o,c){return c=c||"utf8",dist.Buffer.isBuffer(o)||(o=new dist.Buffer(o,c)),this.keys._importPublic(o),this},n.prototype.setPrivateKey=function(o,c){c=c||"utf8",dist.Buffer.isBuffer(o)||(o=new dist.Buffer(o,c));var u=new e(o);return u=u.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(u),this};function a(o,c,u){Array.isArray(o)||(o=o.toArray());var v=new dist.Buffer(o);if(u&&v.length<u){var _=new dist.Buffer(u-v.length);_.fill(0),v=dist.Buffer.concat([_,v])}return c?v.toString(c):v}return browser$3}var browser$2={},mgf,hasRequiredMgf;function requireMgf(){if(hasRequiredMgf)return mgf;hasRequiredMgf=1;var r=requireBrowser$9(),e=requireSafeBuffer$1().Buffer;mgf=function(n,a){for(var o=e.alloc(0),c=0,u;o.length<a;)u=t(c++),o=e.concat([o,r("sha1").update(n).update(u).digest()]);return o.slice(0,a)};function t(n){var a=e.allocUnsafe(4);return a.writeUInt32BE(n,0),a}return mgf}var xor,hasRequiredXor;function requireXor(){return hasRequiredXor||(hasRequiredXor=1,xor=function(e,t){for(var n=e.length,a=-1;++a<n;)e[a]^=t[a];return e}),xor}var bn={exports:{}};bn.exports;var hasRequiredBn;function requireBn(){return hasRequiredBn||(hasRequiredBn=1,function(r){(function(e,t){function n(O,l){if(!O)throw new Error(l||"Assertion failed")}function a(O,l){O.super_=l;var p=function(){};p.prototype=l.prototype,O.prototype=new p,O.prototype.constructor=O}function o(O,l,p){if(o.isBN(O))return O;this.negative=0,this.words=null,this.length=0,this.red=null,O!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(O||0,l||10,p||"be"))}typeof e=="object"?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=bufferPolyfill.Buffer}catch{}o.isBN=function(l){return l instanceof o?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===o.wordSize&&Array.isArray(l.words)},o.max=function(l,p){return l.cmp(p)>0?l:p},o.min=function(l,p){return l.cmp(p)<0?l:p},o.prototype._init=function(l,p,b){if(typeof l=="number")return this._initNumber(l,p,b);if(typeof l=="object")return this._initArray(l,p,b);p==="hex"&&(p=16),n(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var S=0;l[0]==="-"&&(S++,this.negative=1),S<l.length&&(p===16?this._parseHex(l,S,b):(this._parseBase(l,p,S),b==="le"&&this._initArray(this.toArray(),p,b)))},o.prototype._initNumber=function(l,p,b){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(n(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),b==="le"&&this._initArray(this.toArray(),p,b)},o.prototype._initArray=function(l,p,b){if(n(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T,B,$=0;if(b==="be")for(S=l.length-1,T=0;S>=0;S-=3)B=l[S]|l[S-1]<<8|l[S-2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);else if(b==="le")for(S=0,T=0;S<l.length;S+=3)B=l[S]|l[S+1]<<8|l[S+2]<<16,this.words[T]|=B<<$&67108863,this.words[T+1]=B>>>26-$&67108863,$+=24,$>=26&&($-=26,T++);return this.strip()};function u(O,l){var p=O.charCodeAt(l);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function v(O,l,p){var b=u(O,p);return p-1>=l&&(b|=u(O,p-1)<<4),b}o.prototype._parseHex=function(l,p,b){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var T=0,B=0,$;if(b==="be")for(S=l.length-1;S>=p;S-=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8;else{var A=l.length-p;for(S=A%2===0?p+1:p;S<l.length;S+=2)$=v(l,p,S)<<T,this.words[B]|=$&67108863,T>=18?(T-=18,B+=1,this.words[B]|=$>>>26):T+=8}this.strip()};function _(O,l,p,b){for(var S=0,T=Math.min(O.length,p),B=l;B<T;B++){var $=O.charCodeAt(B)-48;S*=b,$>=49?S+=$-49+10:$>=17?S+=$-17+10:S+=$}return S}o.prototype._parseBase=function(l,p,b){this.words=[0],this.length=1;for(var S=0,T=1;T<=67108863;T*=p)S++;S--,T=T/p|0;for(var B=l.length-b,$=B%S,A=Math.min(B,B-$)+b,g=0,k=b;k<A;k+=S)g=_(l,k,k+S,p),this.imuln(T),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g);if($!==0){var H=1;for(g=_(l,k,l.length,p),k=0;k<$;k++)H*=p;this.imuln(H),this.words[0]+g<67108864?this.words[0]+=g:this._iaddn(g)}this.strip()},o.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red},o.prototype.clone=function(){var l=new o(null);return this.copy(l),l},o.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],E=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],M=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(l,p){l=l||10,p=p|0||1;var b;if(l===16||l==="hex"){b="";for(var S=0,T=0,B=0;B<this.length;B++){var $=this.words[B],A=(($<<S|T)&16777215).toString(16);T=$>>>24-S&16777215,S+=2,S>=26&&(S-=26,B--),T!==0||B!==this.length-1?b=x[6-A.length]+A+b:b=A+b}for(T!==0&&(b=T.toString(16)+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}if(l===(l|0)&&l>=2&&l<=36){var g=E[l],k=M[l];b="";var H=this.clone();for(H.negative=0;!H.isZero();){var z=H.modn(k).toString(l);H=H.idivn(k),H.isZero()?b=z+b:b=x[g-z.length]+z+b}for(this.isZero()&&(b="0"+b);b.length%p!==0;)b="0"+b;return this.negative!==0&&(b="-"+b),b}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(l,p){return n(typeof c<"u"),this.toArrayLike(c,l,p)},o.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)},o.prototype.toArrayLike=function(l,p,b){var S=this.byteLength(),T=b||Math.max(1,S);n(S<=T,"byte array longer than desired length"),n(T>0,"Requested array length <= 0"),this.strip();var B=p==="le",$=new l(T),A,g,k=this.clone();if(B){for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[g]=A;for(;g<T;g++)$[g]=0}else{for(g=0;g<T-S;g++)$[g]=0;for(g=0;!k.isZero();g++)A=k.andln(255),k.iushrn(8),$[T-g-1]=A}return $},Math.clz32?o.prototype._countBits=function(l){return 32-Math.clz32(l)}:o.prototype._countBits=function(l){var p=l,b=0;return p>=4096&&(b+=13,p>>>=13),p>=64&&(b+=7,p>>>=7),p>=8&&(b+=4,p>>>=4),p>=2&&(b+=2,p>>>=2),b+p},o.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,b=0;return p&8191||(b+=13,p>>>=13),p&127||(b+=7,p>>>=7),p&15||(b+=4,p>>>=4),p&3||(b+=2,p>>>=2),p&1||b++,b},o.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function C(O){for(var l=new Array(O.bitLength()),p=0;p<l.length;p++){var b=p/26|0,S=p%26;l[p]=(O.words[b]&1<<S)>>>S}return l}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var b=this._zeroBits(this.words[p]);if(l+=b,b!==26)break}return l},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},o.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this.strip()},o.prototype.ior=function(l){return n((this.negative|l.negative)===0),this.iuor(l)},o.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},o.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},o.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var b=0;b<p.length;b++)this.words[b]=this.words[b]&l.words[b];return this.length=p.length,this.strip()},o.prototype.iand=function(l){return n((this.negative|l.negative)===0),this.iuand(l)},o.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},o.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},o.prototype.iuxor=function(l){var p,b;this.length>l.length?(p=this,b=l):(p=l,b=this);for(var S=0;S<b.length;S++)this.words[S]=p.words[S]^b.words[S];if(this!==p)for(;S<p.length;S++)this.words[S]=p.words[S];return this.length=p.length,this.strip()},o.prototype.ixor=function(l){return n((this.negative|l.negative)===0),this.iuxor(l)},o.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},o.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},o.prototype.inotn=function(l){n(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,b=l%26;this._expand(p),b>0&&p--;for(var S=0;S<p;S++)this.words[S]=~this.words[S]&67108863;return b>0&&(this.words[S]=~this.words[S]&67108863>>26-b),this.strip()},o.prototype.notn=function(l){return this.clone().inotn(l)},o.prototype.setn=function(l,p){n(typeof l=="number"&&l>=0);var b=l/26|0,S=l%26;return this._expand(b+1),p?this.words[b]=this.words[b]|1<<S:this.words[b]=this.words[b]&~(1<<S),this.strip()},o.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var b,S;this.length>l.length?(b=this,S=l):(b=l,S=this);for(var T=0,B=0;B<S.length;B++)p=(b.words[B]|0)+(S.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;for(;T!==0&&B<b.length;B++)p=(b.words[B]|0)+T,this.words[B]=p&67108863,T=p>>>26;if(this.length=b.length,T!==0)this.words[this.length]=T,this.length++;else if(b!==this)for(;B<b.length;B++)this.words[B]=b.words[B];return this},o.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},o.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var b=this.cmp(l);if(b===0)return this.negative=0,this.length=1,this.words[0]=0,this;var S,T;b>0?(S=this,T=l):(S=l,T=this);for(var B=0,$=0;$<T.length;$++)p=(S.words[$]|0)-(T.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;for(;B!==0&&$<S.length;$++)p=(S.words[$]|0)+B,B=p>>26,this.words[$]=p&67108863;if(B===0&&$<S.length&&S!==this)for(;$<S.length;$++)this.words[$]=S.words[$];return this.length=Math.max(this.length,$),S!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(l){return this.clone().isub(l)};function I(O,l,p){p.negative=l.negative^O.negative;var b=O.length+l.length|0;p.length=b,b=b-1|0;var S=O.words[0]|0,T=l.words[0]|0,B=S*T,$=B&67108863,A=B/67108864|0;p.words[0]=$;for(var g=1;g<b;g++){for(var k=A>>>26,H=A&67108863,z=Math.min(g,l.length-1),Q=Math.max(0,g-O.length+1);Q<=z;Q++){var ie=g-Q|0;S=O.words[ie]|0,T=l.words[Q]|0,B=S*T+H,k+=B/67108864|0,H=B&67108863}p.words[g]=H|0,A=k|0}return A!==0?p.words[g]=A|0:p.length--,p.strip()}var D=function(l,p,b){var S=l.words,T=p.words,B=b.words,$=0,A,g,k,H=S[0]|0,z=H&8191,Q=H>>>13,ie=S[1]|0,ne=ie&8191,Z=ie>>>13,se=S[2]|0,ae=se&8191,ce=se>>>13,le=S[3]|0,te=le&8191,he=le>>>13,Ae=S[4]|0,ge=Ae&8191,me=Ae>>>13,je=S[5]|0,we=je&8191,pe=je>>>13,Ke=S[6]|0,ye=Ke&8191,xe=Ke>>>13,Ve=S[7]|0,be=Ve&8191,Ee=Ve>>>13,Ge=S[8]|0,re=Ge&8191,Y=Ge>>>13,ee=S[9]|0,fe=ee&8191,ue=ee>>>13,ve=T[0]|0,de=ve&8191,Se=ve>>>13,We=T[1]|0,_e=We&8191,Me=We>>>13,ze=T[2]|0,Te=ze&8191,$e=ze>>>13,Je=T[3]|0,ke=Je&8191,Oe=Je>>>13,Ze=T[4]|0,Be=Ze&8191,Le=Ze>>>13,Qe=T[5]|0,Re=Qe&8191,Ne=Qe>>>13,et=T[6]|0,Ce=et&8191,qe=et>>>13,tt=T[7]|0,Ie=tt&8191,Fe=tt>>>13,rt=T[8]|0,De=rt&8191,Ue=rt>>>13,nt=T[9]|0,Pe=nt&8191,He=nt>>>13;b.negative=l.negative^p.negative,b.length=19,A=Math.imul(z,de),g=Math.imul(z,Se),g=g+Math.imul(Q,de)|0,k=Math.imul(Q,Se);var Xe=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Xe>>>26)|0,Xe&=67108863,A=Math.imul(ne,de),g=Math.imul(ne,Se),g=g+Math.imul(Z,de)|0,k=Math.imul(Z,Se),A=A+Math.imul(z,_e)|0,g=g+Math.imul(z,Me)|0,g=g+Math.imul(Q,_e)|0,k=k+Math.imul(Q,Me)|0;var Ye=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,A=Math.imul(ae,de),g=Math.imul(ae,Se),g=g+Math.imul(ce,de)|0,k=Math.imul(ce,Se),A=A+Math.imul(ne,_e)|0,g=g+Math.imul(ne,Me)|0,g=g+Math.imul(Z,_e)|0,k=k+Math.imul(Z,Me)|0,A=A+Math.imul(z,Te)|0,g=g+Math.imul(z,$e)|0,g=g+Math.imul(Q,Te)|0,k=k+Math.imul(Q,$e)|0;var it=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(it>>>26)|0,it&=67108863,A=Math.imul(te,de),g=Math.imul(te,Se),g=g+Math.imul(he,de)|0,k=Math.imul(he,Se),A=A+Math.imul(ae,_e)|0,g=g+Math.imul(ae,Me)|0,g=g+Math.imul(ce,_e)|0,k=k+Math.imul(ce,Me)|0,A=A+Math.imul(ne,Te)|0,g=g+Math.imul(ne,$e)|0,g=g+Math.imul(Z,Te)|0,k=k+Math.imul(Z,$e)|0,A=A+Math.imul(z,ke)|0,g=g+Math.imul(z,Oe)|0,g=g+Math.imul(Q,ke)|0,k=k+Math.imul(Q,Oe)|0;var st=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(st>>>26)|0,st&=67108863,A=Math.imul(ge,de),g=Math.imul(ge,Se),g=g+Math.imul(me,de)|0,k=Math.imul(me,Se),A=A+Math.imul(te,_e)|0,g=g+Math.imul(te,Me)|0,g=g+Math.imul(he,_e)|0,k=k+Math.imul(he,Me)|0,A=A+Math.imul(ae,Te)|0,g=g+Math.imul(ae,$e)|0,g=g+Math.imul(ce,Te)|0,k=k+Math.imul(ce,$e)|0,A=A+Math.imul(ne,ke)|0,g=g+Math.imul(ne,Oe)|0,g=g+Math.imul(Z,ke)|0,k=k+Math.imul(Z,Oe)|0,A=A+Math.imul(z,Be)|0,g=g+Math.imul(z,Le)|0,g=g+Math.imul(Q,Be)|0,k=k+Math.imul(Q,Le)|0;var ot=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ot>>>26)|0,ot&=67108863,A=Math.imul(we,de),g=Math.imul(we,Se),g=g+Math.imul(pe,de)|0,k=Math.imul(pe,Se),A=A+Math.imul(ge,_e)|0,g=g+Math.imul(ge,Me)|0,g=g+Math.imul(me,_e)|0,k=k+Math.imul(me,Me)|0,A=A+Math.imul(te,Te)|0,g=g+Math.imul(te,$e)|0,g=g+Math.imul(he,Te)|0,k=k+Math.imul(he,$e)|0,A=A+Math.imul(ae,ke)|0,g=g+Math.imul(ae,Oe)|0,g=g+Math.imul(ce,ke)|0,k=k+Math.imul(ce,Oe)|0,A=A+Math.imul(ne,Be)|0,g=g+Math.imul(ne,Le)|0,g=g+Math.imul(Z,Be)|0,k=k+Math.imul(Z,Le)|0,A=A+Math.imul(z,Re)|0,g=g+Math.imul(z,Ne)|0,g=g+Math.imul(Q,Re)|0,k=k+Math.imul(Q,Ne)|0;var at=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(at>>>26)|0,at&=67108863,A=Math.imul(ye,de),g=Math.imul(ye,Se),g=g+Math.imul(xe,de)|0,k=Math.imul(xe,Se),A=A+Math.imul(we,_e)|0,g=g+Math.imul(we,Me)|0,g=g+Math.imul(pe,_e)|0,k=k+Math.imul(pe,Me)|0,A=A+Math.imul(ge,Te)|0,g=g+Math.imul(ge,$e)|0,g=g+Math.imul(me,Te)|0,k=k+Math.imul(me,$e)|0,A=A+Math.imul(te,ke)|0,g=g+Math.imul(te,Oe)|0,g=g+Math.imul(he,ke)|0,k=k+Math.imul(he,Oe)|0,A=A+Math.imul(ae,Be)|0,g=g+Math.imul(ae,Le)|0,g=g+Math.imul(ce,Be)|0,k=k+Math.imul(ce,Le)|0,A=A+Math.imul(ne,Re)|0,g=g+Math.imul(ne,Ne)|0,g=g+Math.imul(Z,Re)|0,k=k+Math.imul(Z,Ne)|0,A=A+Math.imul(z,Ce)|0,g=g+Math.imul(z,qe)|0,g=g+Math.imul(Q,Ce)|0,k=k+Math.imul(Q,qe)|0;var ft=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ft>>>26)|0,ft&=67108863,A=Math.imul(be,de),g=Math.imul(be,Se),g=g+Math.imul(Ee,de)|0,k=Math.imul(Ee,Se),A=A+Math.imul(ye,_e)|0,g=g+Math.imul(ye,Me)|0,g=g+Math.imul(xe,_e)|0,k=k+Math.imul(xe,Me)|0,A=A+Math.imul(we,Te)|0,g=g+Math.imul(we,$e)|0,g=g+Math.imul(pe,Te)|0,k=k+Math.imul(pe,$e)|0,A=A+Math.imul(ge,ke)|0,g=g+Math.imul(ge,Oe)|0,g=g+Math.imul(me,ke)|0,k=k+Math.imul(me,Oe)|0,A=A+Math.imul(te,Be)|0,g=g+Math.imul(te,Le)|0,g=g+Math.imul(he,Be)|0,k=k+Math.imul(he,Le)|0,A=A+Math.imul(ae,Re)|0,g=g+Math.imul(ae,Ne)|0,g=g+Math.imul(ce,Re)|0,k=k+Math.imul(ce,Ne)|0,A=A+Math.imul(ne,Ce)|0,g=g+Math.imul(ne,qe)|0,g=g+Math.imul(Z,Ce)|0,k=k+Math.imul(Z,qe)|0,A=A+Math.imul(z,Ie)|0,g=g+Math.imul(z,Fe)|0,g=g+Math.imul(Q,Ie)|0,k=k+Math.imul(Q,Fe)|0;var lt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(lt>>>26)|0,lt&=67108863,A=Math.imul(re,de),g=Math.imul(re,Se),g=g+Math.imul(Y,de)|0,k=Math.imul(Y,Se),A=A+Math.imul(be,_e)|0,g=g+Math.imul(be,Me)|0,g=g+Math.imul(Ee,_e)|0,k=k+Math.imul(Ee,Me)|0,A=A+Math.imul(ye,Te)|0,g=g+Math.imul(ye,$e)|0,g=g+Math.imul(xe,Te)|0,k=k+Math.imul(xe,$e)|0,A=A+Math.imul(we,ke)|0,g=g+Math.imul(we,Oe)|0,g=g+Math.imul(pe,ke)|0,k=k+Math.imul(pe,Oe)|0,A=A+Math.imul(ge,Be)|0,g=g+Math.imul(ge,Le)|0,g=g+Math.imul(me,Be)|0,k=k+Math.imul(me,Le)|0,A=A+Math.imul(te,Re)|0,g=g+Math.imul(te,Ne)|0,g=g+Math.imul(he,Re)|0,k=k+Math.imul(he,Ne)|0,A=A+Math.imul(ae,Ce)|0,g=g+Math.imul(ae,qe)|0,g=g+Math.imul(ce,Ce)|0,k=k+Math.imul(ce,qe)|0,A=A+Math.imul(ne,Ie)|0,g=g+Math.imul(ne,Fe)|0,g=g+Math.imul(Z,Ie)|0,k=k+Math.imul(Z,Fe)|0,A=A+Math.imul(z,De)|0,g=g+Math.imul(z,Ue)|0,g=g+Math.imul(Q,De)|0,k=k+Math.imul(Q,Ue)|0;var ct=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ct>>>26)|0,ct&=67108863,A=Math.imul(fe,de),g=Math.imul(fe,Se),g=g+Math.imul(ue,de)|0,k=Math.imul(ue,Se),A=A+Math.imul(re,_e)|0,g=g+Math.imul(re,Me)|0,g=g+Math.imul(Y,_e)|0,k=k+Math.imul(Y,Me)|0,A=A+Math.imul(be,Te)|0,g=g+Math.imul(be,$e)|0,g=g+Math.imul(Ee,Te)|0,k=k+Math.imul(Ee,$e)|0,A=A+Math.imul(ye,ke)|0,g=g+Math.imul(ye,Oe)|0,g=g+Math.imul(xe,ke)|0,k=k+Math.imul(xe,Oe)|0,A=A+Math.imul(we,Be)|0,g=g+Math.imul(we,Le)|0,g=g+Math.imul(pe,Be)|0,k=k+Math.imul(pe,Le)|0,A=A+Math.imul(ge,Re)|0,g=g+Math.imul(ge,Ne)|0,g=g+Math.imul(me,Re)|0,k=k+Math.imul(me,Ne)|0,A=A+Math.imul(te,Ce)|0,g=g+Math.imul(te,qe)|0,g=g+Math.imul(he,Ce)|0,k=k+Math.imul(he,qe)|0,A=A+Math.imul(ae,Ie)|0,g=g+Math.imul(ae,Fe)|0,g=g+Math.imul(ce,Ie)|0,k=k+Math.imul(ce,Fe)|0,A=A+Math.imul(ne,De)|0,g=g+Math.imul(ne,Ue)|0,g=g+Math.imul(Z,De)|0,k=k+Math.imul(Z,Ue)|0,A=A+Math.imul(z,Pe)|0,g=g+Math.imul(z,He)|0,g=g+Math.imul(Q,Pe)|0,k=k+Math.imul(Q,He)|0;var ht=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(ht>>>26)|0,ht&=67108863,A=Math.imul(fe,_e),g=Math.imul(fe,Me),g=g+Math.imul(ue,_e)|0,k=Math.imul(ue,Me),A=A+Math.imul(re,Te)|0,g=g+Math.imul(re,$e)|0,g=g+Math.imul(Y,Te)|0,k=k+Math.imul(Y,$e)|0,A=A+Math.imul(be,ke)|0,g=g+Math.imul(be,Oe)|0,g=g+Math.imul(Ee,ke)|0,k=k+Math.imul(Ee,Oe)|0,A=A+Math.imul(ye,Be)|0,g=g+Math.imul(ye,Le)|0,g=g+Math.imul(xe,Be)|0,k=k+Math.imul(xe,Le)|0,A=A+Math.imul(we,Re)|0,g=g+Math.imul(we,Ne)|0,g=g+Math.imul(pe,Re)|0,k=k+Math.imul(pe,Ne)|0,A=A+Math.imul(ge,Ce)|0,g=g+Math.imul(ge,qe)|0,g=g+Math.imul(me,Ce)|0,k=k+Math.imul(me,qe)|0,A=A+Math.imul(te,Ie)|0,g=g+Math.imul(te,Fe)|0,g=g+Math.imul(he,Ie)|0,k=k+Math.imul(he,Fe)|0,A=A+Math.imul(ae,De)|0,g=g+Math.imul(ae,Ue)|0,g=g+Math.imul(ce,De)|0,k=k+Math.imul(ce,Ue)|0,A=A+Math.imul(ne,Pe)|0,g=g+Math.imul(ne,He)|0,g=g+Math.imul(Z,Pe)|0,k=k+Math.imul(Z,He)|0;var dt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(dt>>>26)|0,dt&=67108863,A=Math.imul(fe,Te),g=Math.imul(fe,$e),g=g+Math.imul(ue,Te)|0,k=Math.imul(ue,$e),A=A+Math.imul(re,ke)|0,g=g+Math.imul(re,Oe)|0,g=g+Math.imul(Y,ke)|0,k=k+Math.imul(Y,Oe)|0,A=A+Math.imul(be,Be)|0,g=g+Math.imul(be,Le)|0,g=g+Math.imul(Ee,Be)|0,k=k+Math.imul(Ee,Le)|0,A=A+Math.imul(ye,Re)|0,g=g+Math.imul(ye,Ne)|0,g=g+Math.imul(xe,Re)|0,k=k+Math.imul(xe,Ne)|0,A=A+Math.imul(we,Ce)|0,g=g+Math.imul(we,qe)|0,g=g+Math.imul(pe,Ce)|0,k=k+Math.imul(pe,qe)|0,A=A+Math.imul(ge,Ie)|0,g=g+Math.imul(ge,Fe)|0,g=g+Math.imul(me,Ie)|0,k=k+Math.imul(me,Fe)|0,A=A+Math.imul(te,De)|0,g=g+Math.imul(te,Ue)|0,g=g+Math.imul(he,De)|0,k=k+Math.imul(he,Ue)|0,A=A+Math.imul(ae,Pe)|0,g=g+Math.imul(ae,He)|0,g=g+Math.imul(ce,Pe)|0,k=k+Math.imul(ce,He)|0;var pt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(pt>>>26)|0,pt&=67108863,A=Math.imul(fe,ke),g=Math.imul(fe,Oe),g=g+Math.imul(ue,ke)|0,k=Math.imul(ue,Oe),A=A+Math.imul(re,Be)|0,g=g+Math.imul(re,Le)|0,g=g+Math.imul(Y,Be)|0,k=k+Math.imul(Y,Le)|0,A=A+Math.imul(be,Re)|0,g=g+Math.imul(be,Ne)|0,g=g+Math.imul(Ee,Re)|0,k=k+Math.imul(Ee,Ne)|0,A=A+Math.imul(ye,Ce)|0,g=g+Math.imul(ye,qe)|0,g=g+Math.imul(xe,Ce)|0,k=k+Math.imul(xe,qe)|0,A=A+Math.imul(we,Ie)|0,g=g+Math.imul(we,Fe)|0,g=g+Math.imul(pe,Ie)|0,k=k+Math.imul(pe,Fe)|0,A=A+Math.imul(ge,De)|0,g=g+Math.imul(ge,Ue)|0,g=g+Math.imul(me,De)|0,k=k+Math.imul(me,Ue)|0,A=A+Math.imul(te,Pe)|0,g=g+Math.imul(te,He)|0,g=g+Math.imul(he,Pe)|0,k=k+Math.imul(he,He)|0;var gt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(gt>>>26)|0,gt&=67108863,A=Math.imul(fe,Be),g=Math.imul(fe,Le),g=g+Math.imul(ue,Be)|0,k=Math.imul(ue,Le),A=A+Math.imul(re,Re)|0,g=g+Math.imul(re,Ne)|0,g=g+Math.imul(Y,Re)|0,k=k+Math.imul(Y,Ne)|0,A=A+Math.imul(be,Ce)|0,g=g+Math.imul(be,qe)|0,g=g+Math.imul(Ee,Ce)|0,k=k+Math.imul(Ee,qe)|0,A=A+Math.imul(ye,Ie)|0,g=g+Math.imul(ye,Fe)|0,g=g+Math.imul(xe,Ie)|0,k=k+Math.imul(xe,Fe)|0,A=A+Math.imul(we,De)|0,g=g+Math.imul(we,Ue)|0,g=g+Math.imul(pe,De)|0,k=k+Math.imul(pe,Ue)|0,A=A+Math.imul(ge,Pe)|0,g=g+Math.imul(ge,He)|0,g=g+Math.imul(me,Pe)|0,k=k+Math.imul(me,He)|0;var mt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(mt>>>26)|0,mt&=67108863,A=Math.imul(fe,Re),g=Math.imul(fe,Ne),g=g+Math.imul(ue,Re)|0,k=Math.imul(ue,Ne),A=A+Math.imul(re,Ce)|0,g=g+Math.imul(re,qe)|0,g=g+Math.imul(Y,Ce)|0,k=k+Math.imul(Y,qe)|0,A=A+Math.imul(be,Ie)|0,g=g+Math.imul(be,Fe)|0,g=g+Math.imul(Ee,Ie)|0,k=k+Math.imul(Ee,Fe)|0,A=A+Math.imul(ye,De)|0,g=g+Math.imul(ye,Ue)|0,g=g+Math.imul(xe,De)|0,k=k+Math.imul(xe,Ue)|0,A=A+Math.imul(we,Pe)|0,g=g+Math.imul(we,He)|0,g=g+Math.imul(pe,Pe)|0,k=k+Math.imul(pe,He)|0;var yt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(yt>>>26)|0,yt&=67108863,A=Math.imul(fe,Ce),g=Math.imul(fe,qe),g=g+Math.imul(ue,Ce)|0,k=Math.imul(ue,qe),A=A+Math.imul(re,Ie)|0,g=g+Math.imul(re,Fe)|0,g=g+Math.imul(Y,Ie)|0,k=k+Math.imul(Y,Fe)|0,A=A+Math.imul(be,De)|0,g=g+Math.imul(be,Ue)|0,g=g+Math.imul(Ee,De)|0,k=k+Math.imul(Ee,Ue)|0,A=A+Math.imul(ye,Pe)|0,g=g+Math.imul(ye,He)|0,g=g+Math.imul(xe,Pe)|0,k=k+Math.imul(xe,He)|0;var vt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(vt>>>26)|0,vt&=67108863,A=Math.imul(fe,Ie),g=Math.imul(fe,Fe),g=g+Math.imul(ue,Ie)|0,k=Math.imul(ue,Fe),A=A+Math.imul(re,De)|0,g=g+Math.imul(re,Ue)|0,g=g+Math.imul(Y,De)|0,k=k+Math.imul(Y,Ue)|0,A=A+Math.imul(be,Pe)|0,g=g+Math.imul(be,He)|0,g=g+Math.imul(Ee,Pe)|0,k=k+Math.imul(Ee,He)|0;var bt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(bt>>>26)|0,bt&=67108863,A=Math.imul(fe,De),g=Math.imul(fe,Ue),g=g+Math.imul(ue,De)|0,k=Math.imul(ue,Ue),A=A+Math.imul(re,Pe)|0,g=g+Math.imul(re,He)|0,g=g+Math.imul(Y,Pe)|0,k=k+Math.imul(Y,He)|0;var wt=($+A|0)+((g&8191)<<13)|0;$=(k+(g>>>13)|0)+(wt>>>26)|0,wt&=67108863,A=Math.imul(fe,Pe),g=Math.imul(fe,He),g=g+Math.imul(ue,Pe)|0,k=Math.imul(ue,He);var _t=($+A|0)+((g&8191)<<13)|0;return $=(k+(g>>>13)|0)+(_t>>>26)|0,_t&=67108863,B[0]=Xe,B[1]=Ye,B[2]=it,B[3]=st,B[4]=ot,B[5]=at,B[6]=ft,B[7]=lt,B[8]=ct,B[9]=ht,B[10]=dt,B[11]=pt,B[12]=gt,B[13]=mt,B[14]=yt,B[15]=vt,B[16]=bt,B[17]=wt,B[18]=_t,$!==0&&(B[19]=$,b.length++),b};Math.imul||(D=I);function L(O,l,p){p.negative=l.negative^O.negative,p.length=O.length+l.length;for(var b=0,S=0,T=0;T<p.length-1;T++){var B=S;S=0;for(var $=b&67108863,A=Math.min(T,l.length-1),g=Math.max(0,T-O.length+1);g<=A;g++){var k=T-g,H=O.words[k]|0,z=l.words[g]|0,Q=H*z,ie=Q&67108863;B=B+(Q/67108864|0)|0,ie=ie+$|0,$=ie&67108863,B=B+(ie>>>26)|0,S+=B>>>26,B&=67108863}p.words[T]=$,b=B,B=S}return b!==0?p.words[T]=b:p.length--,p.strip()}function N(O,l,p){var b=new q;return b.mulp(O,l,p)}o.prototype.mulTo=function(l,p){var b,S=this.length+l.length;return this.length===10&&l.length===10?b=D(this,l,p):S<63?b=I(this,l,p):S<1024?b=L(this,l,p):b=N(this,l,p),b};function q(O,l){this.x=O,this.y=l}q.prototype.makeRBT=function(l){for(var p=new Array(l),b=o.prototype._countBits(l)-1,S=0;S<l;S++)p[S]=this.revBin(S,b,l);return p},q.prototype.revBin=function(l,p,b){if(l===0||l===b-1)return l;for(var S=0,T=0;T<p;T++)S|=(l&1)<<p-T-1,l>>=1;return S},q.prototype.permute=function(l,p,b,S,T,B){for(var $=0;$<B;$++)S[$]=p[l[$]],T[$]=b[l[$]]},q.prototype.transform=function(l,p,b,S,T,B){this.permute(B,l,p,b,S,T);for(var $=1;$<T;$<<=1)for(var A=$<<1,g=Math.cos(2*Math.PI/A),k=Math.sin(2*Math.PI/A),H=0;H<T;H+=A)for(var z=g,Q=k,ie=0;ie<$;ie++){var ne=b[H+ie],Z=S[H+ie],se=b[H+ie+$],ae=S[H+ie+$],ce=z*se-Q*ae;ae=z*ae+Q*se,se=ce,b[H+ie]=ne+se,S[H+ie]=Z+ae,b[H+ie+$]=ne-se,S[H+ie+$]=Z-ae,ie!==A&&(ce=g*z-k*Q,Q=g*Q+k*z,z=ce)}},q.prototype.guessLen13b=function(l,p){var b=Math.max(p,l)|1,S=b&1,T=0;for(b=b/2|0;b;b=b>>>1)T++;return 1<<T+1+S},q.prototype.conjugate=function(l,p,b){if(!(b<=1))for(var S=0;S<b/2;S++){var T=l[S];l[S]=l[b-S-1],l[b-S-1]=T,T=p[S],p[S]=-p[b-S-1],p[b-S-1]=-T}},q.prototype.normalize13b=function(l,p){for(var b=0,S=0;S<p/2;S++){var T=Math.round(l[2*S+1]/p)*8192+Math.round(l[2*S]/p)+b;l[S]=T&67108863,T<67108864?b=0:b=T/67108864|0}return l},q.prototype.convert13b=function(l,p,b,S){for(var T=0,B=0;B<p;B++)T=T+(l[B]|0),b[2*B]=T&8191,T=T>>>13,b[2*B+1]=T&8191,T=T>>>13;for(B=2*p;B<S;++B)b[B]=0;n(T===0),n((T&-8192)===0)},q.prototype.stub=function(l){for(var p=new Array(l),b=0;b<l;b++)p[b]=0;return p},q.prototype.mulp=function(l,p,b){var S=2*this.guessLen13b(l.length,p.length),T=this.makeRBT(S),B=this.stub(S),$=new Array(S),A=new Array(S),g=new Array(S),k=new Array(S),H=new Array(S),z=new Array(S),Q=b.words;Q.length=S,this.convert13b(l.words,l.length,$,S),this.convert13b(p.words,p.length,k,S),this.transform($,B,A,g,S,T),this.transform(k,B,H,z,S,T);for(var ie=0;ie<S;ie++){var ne=A[ie]*H[ie]-g[ie]*z[ie];g[ie]=A[ie]*z[ie]+g[ie]*H[ie],A[ie]=ne}return this.conjugate(A,g,S),this.transform(A,g,Q,B,S,T),this.conjugate(Q,B,S),this.normalize13b(Q,S),b.negative=l.negative^p.negative,b.length=l.length+p.length,b.strip()},o.prototype.mul=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},o.prototype.mulf=function(l){var p=new o(null);return p.words=new Array(this.length+l.length),N(this,l,p)},o.prototype.imul=function(l){return this.clone().mulTo(l,this)},o.prototype.imuln=function(l){n(typeof l=="number"),n(l<67108864);for(var p=0,b=0;b<this.length;b++){var S=(this.words[b]|0)*l,T=(S&67108863)+(p&67108863);p>>=26,p+=S/67108864|0,p+=T>>>26,this.words[b]=T&67108863}return p!==0&&(this.words[b]=p,this.length++),this},o.prototype.muln=function(l){return this.clone().imuln(l)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(l){var p=C(l);if(p.length===0)return new o(1);for(var b=this,S=0;S<p.length&&p[S]===0;S++,b=b.sqr());if(++S<p.length)for(var T=b.sqr();S<p.length;S++,T=T.sqr())p[S]!==0&&(b=b.mul(T));return b},o.prototype.iushln=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=67108863>>>26-p<<26-p,T;if(p!==0){var B=0;for(T=0;T<this.length;T++){var $=this.words[T]&S,A=(this.words[T]|0)-$<<p;this.words[T]=A|B,B=$>>>26-p}B&&(this.words[T]=B,this.length++)}if(b!==0){for(T=this.length-1;T>=0;T--)this.words[T+b]=this.words[T];for(T=0;T<b;T++)this.words[T]=0;this.length+=b}return this.strip()},o.prototype.ishln=function(l){return n(this.negative===0),this.iushln(l)},o.prototype.iushrn=function(l,p,b){n(typeof l=="number"&&l>=0);var S;p?S=(p-p%26)/26:S=0;var T=l%26,B=Math.min((l-T)/26,this.length),$=67108863^67108863>>>T<<T,A=b;if(S-=B,S=Math.max(0,S),A){for(var g=0;g<B;g++)A.words[g]=this.words[g];A.length=B}if(B!==0)if(this.length>B)for(this.length-=B,g=0;g<this.length;g++)this.words[g]=this.words[g+B];else this.words[0]=0,this.length=1;var k=0;for(g=this.length-1;g>=0&&(k!==0||g>=S);g--){var H=this.words[g]|0;this.words[g]=k<<26-T|H>>>T,k=H&$}return A&&k!==0&&(A.words[A.length++]=k),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(l,p,b){return n(this.negative===0),this.iushrn(l,p,b)},o.prototype.shln=function(l){return this.clone().ishln(l)},o.prototype.ushln=function(l){return this.clone().iushln(l)},o.prototype.shrn=function(l){return this.clone().ishrn(l)},o.prototype.ushrn=function(l){return this.clone().iushrn(l)},o.prototype.testn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return!1;var T=this.words[b];return!!(T&S)},o.prototype.imaskn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,b=(l-p)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=b)return this;if(p!==0&&b++,this.length=Math.min(b,this.length),p!==0){var S=67108863^67108863>>>p<<p;this.words[this.length-1]&=S}return this.strip()},o.prototype.maskn=function(l){return this.clone().imaskn(l)},o.prototype.iaddn=function(l){return n(typeof l=="number"),n(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},o.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},o.prototype.isubn=function(l){if(n(typeof l=="number"),n(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},o.prototype.addn=function(l){return this.clone().iaddn(l)},o.prototype.subn=function(l){return this.clone().isubn(l)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(l,p,b){var S=l.length+b,T;this._expand(S);var B,$=0;for(T=0;T<l.length;T++){B=(this.words[T+b]|0)+$;var A=(l.words[T]|0)*p;B-=A&67108863,$=(B>>26)-(A/67108864|0),this.words[T+b]=B&67108863}for(;T<this.length-b;T++)B=(this.words[T+b]|0)+$,$=B>>26,this.words[T+b]=B&67108863;if($===0)return this.strip();for(n($===-1),$=0,T=0;T<this.length;T++)B=-(this.words[T]|0)+$,$=B>>26,this.words[T]=B&67108863;return this.negative=1,this.strip()},o.prototype._wordDiv=function(l,p){var b=this.length-l.length,S=this.clone(),T=l,B=T.words[T.length-1]|0,$=this._countBits(B);b=26-$,b!==0&&(T=T.ushln(b),S.iushln(b),B=T.words[T.length-1]|0);var A=S.length-T.length,g;if(p!=="mod"){g=new o(null),g.length=A+1,g.words=new Array(g.length);for(var k=0;k<g.length;k++)g.words[k]=0}var H=S.clone()._ishlnsubmul(T,1,A);H.negative===0&&(S=H,g&&(g.words[A]=1));for(var z=A-1;z>=0;z--){var Q=(S.words[T.length+z]|0)*67108864+(S.words[T.length+z-1]|0);for(Q=Math.min(Q/B|0,67108863),S._ishlnsubmul(T,Q,z);S.negative!==0;)Q--,S.negative=0,S._ishlnsubmul(T,1,z),S.isZero()||(S.negative^=1);g&&(g.words[z]=Q)}return g&&g.strip(),S.strip(),p!=="div"&&b!==0&&S.iushrn(b),{div:g||null,mod:S}},o.prototype.divmod=function(l,p,b){if(n(!l.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var S,T,B;return this.negative!==0&&l.negative===0?(B=this.neg().divmod(l,p),p!=="mod"&&(S=B.div.neg()),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.iadd(l)),{div:S,mod:T}):this.negative===0&&l.negative!==0?(B=this.divmod(l.neg(),p),p!=="mod"&&(S=B.div.neg()),{div:S,mod:B.mod}):this.negative&l.negative?(B=this.neg().divmod(l.neg(),p),p!=="div"&&(T=B.mod.neg(),b&&T.negative!==0&&T.isub(l)),{div:B.div,mod:T}):l.length>this.length||this.cmp(l)<0?{div:new o(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new o(this.modn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new o(this.modn(l.words[0]))}:this._wordDiv(l,p)},o.prototype.div=function(l){return this.divmod(l,"div",!1).div},o.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},o.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},o.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var b=p.div.negative!==0?p.mod.isub(l):p.mod,S=l.ushrn(1),T=l.andln(1),B=b.cmp(S);return B<0||T===1&&B===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},o.prototype.modn=function(l){n(l<=67108863);for(var p=(1<<26)%l,b=0,S=this.length-1;S>=0;S--)b=(p*b+(this.words[S]|0))%l;return b},o.prototype.idivn=function(l){n(l<=67108863);for(var p=0,b=this.length-1;b>=0;b--){var S=(this.words[b]|0)+p*67108864;this.words[b]=S/l|0,p=S%l}return this.strip()},o.prototype.divn=function(l){return this.clone().idivn(l)},o.prototype.egcd=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=new o(0),$=new o(1),A=0;p.isEven()&&b.isEven();)p.iushrn(1),b.iushrn(1),++A;for(var g=b.clone(),k=p.clone();!p.isZero();){for(var H=0,z=1;!(p.words[0]&z)&&H<26;++H,z<<=1);if(H>0)for(p.iushrn(H);H-- >0;)(S.isOdd()||T.isOdd())&&(S.iadd(g),T.isub(k)),S.iushrn(1),T.iushrn(1);for(var Q=0,ie=1;!(b.words[0]&ie)&&Q<26;++Q,ie<<=1);if(Q>0)for(b.iushrn(Q);Q-- >0;)(B.isOdd()||$.isOdd())&&(B.iadd(g),$.isub(k)),B.iushrn(1),$.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(B),T.isub($)):(b.isub(p),B.isub(S),$.isub(T))}return{a:B,b:$,gcd:b.iushln(A)}},o.prototype._invmp=function(l){n(l.negative===0),n(!l.isZero());var p=this,b=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var S=new o(1),T=new o(0),B=b.clone();p.cmpn(1)>0&&b.cmpn(1)>0;){for(var $=0,A=1;!(p.words[0]&A)&&$<26;++$,A<<=1);if($>0)for(p.iushrn($);$-- >0;)S.isOdd()&&S.iadd(B),S.iushrn(1);for(var g=0,k=1;!(b.words[0]&k)&&g<26;++g,k<<=1);if(g>0)for(b.iushrn(g);g-- >0;)T.isOdd()&&T.iadd(B),T.iushrn(1);p.cmp(b)>=0?(p.isub(b),S.isub(T)):(b.isub(p),T.isub(S))}var H;return p.cmpn(1)===0?H=S:H=T,H.cmpn(0)<0&&H.iadd(l),H},o.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),b=l.clone();p.negative=0,b.negative=0;for(var S=0;p.isEven()&&b.isEven();S++)p.iushrn(1),b.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;b.isEven();)b.iushrn(1);var T=p.cmp(b);if(T<0){var B=p;p=b,b=B}else if(T===0||b.cmpn(1)===0)break;p.isub(b)}while(!0);return b.iushln(S)},o.prototype.invm=function(l){return this.egcd(l).a.umod(l)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(l){return this.words[0]&l},o.prototype.bincn=function(l){n(typeof l=="number");var p=l%26,b=(l-p)/26,S=1<<p;if(this.length<=b)return this._expand(b+1),this.words[b]|=S,this;for(var T=S,B=b;T!==0&&B<this.length;B++){var $=this.words[B]|0;$+=T,T=$>>>26,$&=67108863,this.words[B]=$}return T!==0&&(this.words[B]=T,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var b;if(this.length>1)b=1;else{p&&(l=-l),n(l<=67108863,"Number is too big");var S=this.words[0]|0;b=S===l?0:S<l?-1:1}return this.negative!==0?-b|0:b},o.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},o.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,b=this.length-1;b>=0;b--){var S=this.words[b]|0,T=l.words[b]|0;if(S!==T){S<T?p=-1:S>T&&(p=1);break}}return p},o.prototype.gtn=function(l){return this.cmpn(l)===1},o.prototype.gt=function(l){return this.cmp(l)===1},o.prototype.gten=function(l){return this.cmpn(l)>=0},o.prototype.gte=function(l){return this.cmp(l)>=0},o.prototype.ltn=function(l){return this.cmpn(l)===-1},o.prototype.lt=function(l){return this.cmp(l)===-1},o.prototype.lten=function(l){return this.cmpn(l)<=0},o.prototype.lte=function(l){return this.cmp(l)<=0},o.prototype.eqn=function(l){return this.cmpn(l)===0},o.prototype.eq=function(l){return this.cmp(l)===0},o.red=function(l){return new G(l)},o.prototype.toRed=function(l){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(l){return this.red=l,this},o.prototype.forceRed=function(l){return n(!this.red,"Already a number in reduction context"),this._forceRed(l)},o.prototype.redAdd=function(l){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},o.prototype.redIAdd=function(l){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},o.prototype.redSub=function(l){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},o.prototype.redISub=function(l){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},o.prototype.redShl=function(l){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},o.prototype.redMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},o.prototype.redIMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(l){return n(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var F={k256:null,p224:null,p192:null,p25519:null};function U(O,l){this.name=O,this.p=new o(l,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var l=new o(null);return l.words=new Array(Math.ceil(this.n/13)),l},U.prototype.ireduce=function(l){var p=l,b;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),b=p.bitLength();while(b>this.n);var S=b<this.n?-1:p.ucmp(this.p);return S===0?(p.words[0]=0,p.length=1):S>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},U.prototype.split=function(l,p){l.iushrn(this.n,0,p)},U.prototype.imulK=function(l){return l.imul(this.k)};function j(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(j,U),j.prototype.split=function(l,p){for(var b=4194303,S=Math.min(l.length,9),T=0;T<S;T++)p.words[T]=l.words[T];if(p.length=S,l.length<=9){l.words[0]=0,l.length=1;return}var B=l.words[9];for(p.words[p.length++]=B&b,T=10;T<l.length;T++){var $=l.words[T]|0;l.words[T-10]=($&b)<<4|B>>>22,B=$}B>>>=22,l.words[T-10]=B,B===0&&l.length>10?l.length-=10:l.length-=9},j.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,b=0;b<l.length;b++){var S=l.words[b]|0;p+=S*977,l.words[b]=p&67108863,p=S*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function W(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(W,U);function X(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(X,U);function J(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(J,U),J.prototype.imulK=function(l){for(var p=0,b=0;b<l.length;b++){var S=(l.words[b]|0)*19+p,T=S&67108863;S>>>=26,l.words[b]=T,p=S}return p!==0&&(l.words[l.length++]=p),l},o._prime=function(l){if(F[l])return F[l];var p;if(l==="k256")p=new j;else if(l==="p224")p=new W;else if(l==="p192")p=new X;else if(l==="p25519")p=new J;else throw new Error("Unknown prime "+l);return F[l]=p,p};function G(O){if(typeof O=="string"){var l=o._prime(O);this.m=l.p,this.prime=l}else n(O.gtn(1),"modulus must be greater than 1"),this.m=O,this.prime=null}G.prototype._verify1=function(l){n(l.negative===0,"red works only with positives"),n(l.red,"red works only with red numbers")},G.prototype._verify2=function(l,p){n((l.negative|p.negative)===0,"red works only with positives"),n(l.red&&l.red===p.red,"red works only with red numbers")},G.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):l.umod(this.m)._forceRed(this)},G.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},G.prototype.add=function(l,p){this._verify2(l,p);var b=l.add(p);return b.cmp(this.m)>=0&&b.isub(this.m),b._forceRed(this)},G.prototype.iadd=function(l,p){this._verify2(l,p);var b=l.iadd(p);return b.cmp(this.m)>=0&&b.isub(this.m),b},G.prototype.sub=function(l,p){this._verify2(l,p);var b=l.sub(p);return b.cmpn(0)<0&&b.iadd(this.m),b._forceRed(this)},G.prototype.isub=function(l,p){this._verify2(l,p);var b=l.isub(p);return b.cmpn(0)<0&&b.iadd(this.m),b},G.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},G.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},G.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},G.prototype.isqr=function(l){return this.imul(l,l.clone())},G.prototype.sqr=function(l){return this.mul(l,l)},G.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(n(p%2===1),p===3){var b=this.m.add(new o(1)).iushrn(2);return this.pow(l,b)}for(var S=this.m.subn(1),T=0;!S.isZero()&&S.andln(1)===0;)T++,S.iushrn(1);n(!S.isZero());var B=new o(1).toRed(this),$=B.redNeg(),A=this.m.subn(1).iushrn(1),g=this.m.bitLength();for(g=new o(2*g*g).toRed(this);this.pow(g,A).cmp($)!==0;)g.redIAdd($);for(var k=this.pow(g,S),H=this.pow(l,S.addn(1).iushrn(1)),z=this.pow(l,S),Q=T;z.cmp(B)!==0;){for(var ie=z,ne=0;ie.cmp(B)!==0;ne++)ie=ie.redSqr();n(ne<Q);var Z=this.pow(k,new o(1).iushln(Q-ne-1));H=H.redMul(Z),k=Z.redSqr(),z=z.redMul(k),Q=ne}return H},G.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},G.prototype.pow=function(l,p){if(p.isZero())return new o(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var b=4,S=new Array(1<<b);S[0]=new o(1).toRed(this),S[1]=l;for(var T=2;T<S.length;T++)S[T]=this.mul(S[T-1],l);var B=S[0],$=0,A=0,g=p.bitLength()%26;for(g===0&&(g=26),T=p.length-1;T>=0;T--){for(var k=p.words[T],H=g-1;H>=0;H--){var z=k>>H&1;if(B!==S[0]&&(B=this.sqr(B)),z===0&&$===0){A=0;continue}$<<=1,$|=z,A++,!(A!==b&&(T!==0||H!==0))&&(B=this.mul(B,S[$]),A=0,$=0)}g=26}return B},G.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},G.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},o.mont=function(l){return new oe(l)};function oe(O){G.call(this,O),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(oe,G),oe.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},oe.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},oe.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var b=l.imul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new o(0)._forceRed(this);var b=l.mul(p),S=b.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),T=b.isub(S).iushrn(this.shift),B=T;return T.cmp(this.m)>=0?B=T.isub(this.m):T.cmpn(0)<0&&(B=T.iadd(this.m)),B._forceRed(this)},oe.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,commonjsGlobal)}(bn)),bn.exports}var withPublic_1,hasRequiredWithPublic;function requireWithPublic(){if(hasRequiredWithPublic)return withPublic_1;hasRequiredWithPublic=1;var r=requireBn(),e=requireSafeBuffer$1().Buffer;function t(n,a){return e.from(n.toRed(r.mont(a.modulus)).redPow(new r(a.publicExponent)).fromRed().toArray())}return withPublic_1=t,withPublic_1}var publicEncrypt,hasRequiredPublicEncrypt;function requirePublicEncrypt(){if(hasRequiredPublicEncrypt)return publicEncrypt;hasRequiredPublicEncrypt=1;var r=requireParseAsn1(),e=requireBrowser$b(),t=requireBrowser$9(),n=requireMgf(),a=requireXor(),o=requireBn(),c=requireWithPublic(),u=requireBrowserifyRsa(),v=requireSafeBuffer$1().Buffer;publicEncrypt=function(C,I,D){var L;C.padding?L=C.padding:D?L=1:L=4;var N=r(C),q;if(L===4)q=_(N,I);else if(L===1)q=x(N,I,D);else if(L===3){if(q=new o(I),q.cmp(N.modulus)>=0)throw new Error("data too long for modulus")}else throw new Error("unknown padding");return D?u(q,N):c(q,N)};function _(M,C){var I=M.modulus.byteLength(),D=C.length,L=t("sha1").update(v.alloc(0)).digest(),N=L.length,q=2*N;if(D>I-q-2)throw new Error("message too long");var F=v.alloc(I-D-q-2),U=I-N-1,j=e(N),W=a(v.concat([L,F,v.alloc(1,1),C],U),n(j,U)),X=a(j,n(W,N));return new o(v.concat([v.alloc(1),X,W],I))}function x(M,C,I){var D=C.length,L=M.modulus.byteLength();if(D>L-11)throw new Error("message too long");var N;return I?N=v.alloc(L-D-3,255):N=E(L-D-3),new o(v.concat([v.from([0,I?1:2]),N,v.alloc(1),C],L))}function E(M){for(var C=v.allocUnsafe(M),I=0,D=e(M*2),L=0,N;I<M;)L===D.length&&(D=e(M*2),L=0),N=D[L++],N&&(C[I++]=N);return C}return publicEncrypt}var privateDecrypt,hasRequiredPrivateDecrypt;function requirePrivateDecrypt(){if(hasRequiredPrivateDecrypt)return privateDecrypt;hasRequiredPrivateDecrypt=1;var r=requireParseAsn1(),e=requireMgf(),t=requireXor(),n=requireBn(),a=requireBrowserifyRsa(),o=requireBrowser$9(),c=requireWithPublic(),u=requireSafeBuffer$1().Buffer;privateDecrypt=function(M,C,I){var D;M.padding?D=M.padding:I?D=1:D=4;var L=r(M),N=L.modulus.byteLength();if(C.length>N||new n(C).cmp(L.modulus)>=0)throw new Error("decryption error");var q;I?q=c(new n(C),L):q=a(C,L);var F=u.alloc(N-q.length);if(q=u.concat([F,q],N),D===4)return v(L,q);if(D===1)return _(L,q,I);if(D===3)return q;throw new Error("unknown padding")};function v(E,M){var C=E.modulus.byteLength(),I=o("sha1").update(u.alloc(0)).digest(),D=I.length;if(M[0]!==0)throw new Error("decryption error");var L=M.slice(1,D+1),N=M.slice(D+1),q=t(L,e(N,D)),F=t(N,e(q,C-D-1));if(x(I,F.slice(0,D)))throw new Error("decryption error");for(var U=D;F[U]===0;)U++;if(F[U++]!==1)throw new Error("decryption error");return F.slice(U)}function _(E,M,C){for(var I=M.slice(0,2),D=2,L=0;M[D++]!==0;)if(D>=M.length){L++;break}var N=M.slice(2,D-1);if((I.toString("hex")!=="0002"&&!C||I.toString("hex")!=="0001"&&C)&&L++,N.length<8&&L++,L)throw new Error("decryption error");return M.slice(D)}function x(E,M){E=u.from(E),M=u.from(M);var C=0,I=E.length;E.length!==M.length&&(C++,I=Math.min(E.length,M.length));for(var D=-1;++D<I;)C+=E[D]^M[D];return C}return privateDecrypt}var hasRequiredBrowser$1;function requireBrowser$1(){return hasRequiredBrowser$1||(hasRequiredBrowser$1=1,function(r){r.publicEncrypt=requirePublicEncrypt(),r.privateDecrypt=requirePrivateDecrypt(),r.privateEncrypt=function(t,n){return r.publicEncrypt(t,n,!0)},r.publicDecrypt=function(t,n){return r.privateDecrypt(t,n,!0)}}(browser$2)),browser$2}var browser$1={},hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser$1;hasRequiredBrowser=1;function r(){throw new Error(`secure random number generation not supported by this browser
use chrome, FireFox or Internet Explorer 11`)}var e=requireSafeBuffer$1(),t=requireBrowser$b(),n=e.Buffer,a=e.kMaxLength,o=commonjsGlobal.crypto||commonjsGlobal.msCrypto,c=Math.pow(2,32)-1;function u(M,C){if(typeof M!="number"||M!==M)throw new TypeError("offset must be a number");if(M>c||M<0)throw new TypeError("offset must be a uint32");if(M>a||M>C)throw new RangeError("offset out of range")}function v(M,C,I){if(typeof M!="number"||M!==M)throw new TypeError("size must be a number");if(M>c||M<0)throw new TypeError("size must be a uint32");if(M+C>I||M>a)throw new RangeError("buffer too small")}o&&o.getRandomValues||!dist.process.browser?(browser$1.randomFill=_,browser$1.randomFillSync=E):(browser$1.randomFill=r,browser$1.randomFillSync=r);function _(M,C,I,D){if(!n.isBuffer(M)&&!(M instanceof commonjsGlobal.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if(typeof C=="function")D=C,C=0,I=M.length;else if(typeof I=="function")D=I,I=M.length-C;else if(typeof D!="function")throw new TypeError('"cb" argument must be a function');return u(C,M.length),v(I,C,M.length),x(M,C,I,D)}function x(M,C,I,D){if(dist.process.browser){var L=M.buffer,N=new Uint8Array(L,C,I);if(o.getRandomValues(N),D){dist.process.nextTick(function(){D(null,M)});return}return M}if(D){t(I,function(F,U){if(F)return D(F);U.copy(M,C),D(null,M)});return}var q=t(I);return q.copy(M,C),M}function E(M,C,I){if(typeof C>"u"&&(C=0),!n.isBuffer(M)&&!(M instanceof commonjsGlobal.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return u(C,M.length),I===void 0&&(I=M.length-C),v(I,C,M.length),x(M,C,I)}return browser$1}var hasRequiredCryptoBrowserify;function requireCryptoBrowserify(){if(hasRequiredCryptoBrowserify)return cryptoBrowserify;hasRequiredCryptoBrowserify=1,cryptoBrowserify.randomBytes=cryptoBrowserify.rng=cryptoBrowserify.pseudoRandomBytes=cryptoBrowserify.prng=requireBrowser$b(),cryptoBrowserify.createHash=cryptoBrowserify.Hash=requireBrowser$9(),cryptoBrowserify.createHmac=cryptoBrowserify.Hmac=requireBrowser$8();var r=requireAlgos(),e=Object.keys(r),t=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(e);cryptoBrowserify.getHashes=function(){return t};var n=requireBrowser$7();cryptoBrowserify.pbkdf2=n.pbkdf2,cryptoBrowserify.pbkdf2Sync=n.pbkdf2Sync;var a=requireBrowser$5();cryptoBrowserify.Cipher=a.Cipher,cryptoBrowserify.createCipher=a.createCipher,cryptoBrowserify.Cipheriv=a.Cipheriv,cryptoBrowserify.createCipheriv=a.createCipheriv,cryptoBrowserify.Decipher=a.Decipher,cryptoBrowserify.createDecipher=a.createDecipher,cryptoBrowserify.Decipheriv=a.Decipheriv,cryptoBrowserify.createDecipheriv=a.createDecipheriv,cryptoBrowserify.getCiphers=a.getCiphers,cryptoBrowserify.listCiphers=a.listCiphers;var o=requireBrowser$4();cryptoBrowserify.DiffieHellmanGroup=o.DiffieHellmanGroup,cryptoBrowserify.createDiffieHellmanGroup=o.createDiffieHellmanGroup,cryptoBrowserify.getDiffieHellman=o.getDiffieHellman,cryptoBrowserify.createDiffieHellman=o.createDiffieHellman,cryptoBrowserify.DiffieHellman=o.DiffieHellman;var c=requireBrowser$3();cryptoBrowserify.createSign=c.createSign,cryptoBrowserify.Sign=c.Sign,cryptoBrowserify.createVerify=c.createVerify,cryptoBrowserify.Verify=c.Verify,cryptoBrowserify.createECDH=requireBrowser$2();var u=requireBrowser$1();cryptoBrowserify.publicEncrypt=u.publicEncrypt,cryptoBrowserify.privateEncrypt=u.privateEncrypt,cryptoBrowserify.publicDecrypt=u.publicDecrypt,cryptoBrowserify.privateDecrypt=u.privateDecrypt;var v=requireBrowser();return cryptoBrowserify.randomFill=v.randomFill,cryptoBrowserify.randomFillSync=v.randomFillSync,cryptoBrowserify.createCredentials=function(){throw new Error(`sorry, createCredentials is not implemented yet
we accept pull requests
https://github.com/browserify/crypto-browserify`)},cryptoBrowserify.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6},cryptoBrowserify}Object.defineProperty(node$1,"__esModule",{value:!0});node$1.NodeRandomSource=void 0;const wipe_1=wipe$1;class NodeRandomSource{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof commonjsRequire<"u"){const e=requireCryptoBrowserify();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const n=new Uint8Array(e);for(let a=0;a<n.length;a++)n[a]=t[a];return(0,wipe_1.wipe)(t),n}}node$1.NodeRandomSource=NodeRandomSource;Object.defineProperty(system,"__esModule",{value:!0});system.SystemRandomSource=void 0;const browser_1=browser$d,node_1=node$1;class SystemRandomSource{constructor(){if(this.isAvailable=!1,this.name="",this._source=new browser_1.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new node_1.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}system.SystemRandomSource=SystemRandomSource;var binary={},int={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});function e(u,v){var _=u>>>16&65535,x=u&65535,E=v>>>16&65535,M=v&65535;return x*M+(_*M+x*E<<16>>>0)|0}r.mul=Math.imul||e;function t(u,v){return u+v|0}r.add=t;function n(u,v){return u-v|0}r.sub=n;function a(u,v){return u<<v|u>>>32-v}r.rotl=a;function o(u,v){return u<<32-v|u>>>v}r.rotr=o;function c(u){return typeof u=="number"&&isFinite(u)&&Math.floor(u)===u}r.isInteger=Number.isInteger||c,r.MAX_SAFE_INTEGER=9007199254740991,r.isSafeInteger=function(u){return r.isInteger(u)&&u>=-r.MAX_SAFE_INTEGER&&u<=r.MAX_SAFE_INTEGER}})(int);Object.defineProperty(binary,"__esModule",{value:!0});var int_1=int;function readInt16BE(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}binary.readInt16BE=readInt16BE;function readUint16BE(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}binary.readUint16BE=readUint16BE;function readInt16LE(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}binary.readInt16LE=readInt16LE;function readUint16LE(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}binary.readUint16LE=readUint16LE;function writeUint16BE(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}binary.writeUint16BE=writeUint16BE;binary.writeInt16BE=writeUint16BE;function writeUint16LE(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}binary.writeUint16LE=writeUint16LE;binary.writeInt16LE=writeUint16LE;function readInt32BE(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}binary.readInt32BE=readInt32BE;function readUint32BE(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}binary.readUint32BE=readUint32BE;function readInt32LE(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}binary.readInt32LE=readInt32LE;function readUint32LE(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}binary.readUint32LE=readUint32LE;function writeUint32BE(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}binary.writeUint32BE=writeUint32BE;binary.writeInt32BE=writeUint32BE;function writeUint32LE(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}binary.writeUint32LE=writeUint32LE;binary.writeInt32LE=writeUint32LE;function readInt64BE(r,e){e===void 0&&(e=0);var t=readInt32BE(r,e),n=readInt32BE(r,e+4);return t*4294967296+n-(n>>31)*4294967296}binary.readInt64BE=readInt64BE;function readUint64BE(r,e){e===void 0&&(e=0);var t=readUint32BE(r,e),n=readUint32BE(r,e+4);return t*4294967296+n}binary.readUint64BE=readUint64BE;function readInt64LE(r,e){e===void 0&&(e=0);var t=readInt32LE(r,e),n=readInt32LE(r,e+4);return n*4294967296+t-(t>>31)*4294967296}binary.readInt64LE=readInt64LE;function readUint64LE(r,e){e===void 0&&(e=0);var t=readUint32LE(r,e),n=readUint32LE(r,e+4);return n*4294967296+t}binary.readUint64LE=readUint64LE;function writeUint64BE(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),writeUint32BE(r/4294967296>>>0,e,t),writeUint32BE(r>>>0,e,t+4),e}binary.writeUint64BE=writeUint64BE;binary.writeInt64BE=writeUint64BE;function writeUint64LE(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),writeUint32LE(r>>>0,e,t),writeUint32LE(r/4294967296>>>0,e,t+4),e}binary.writeUint64LE=writeUint64LE;binary.writeInt64LE=writeUint64LE;function readUintBE(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,a=1,o=r/8+t-1;o>=t;o--)n+=e[o]*a,a*=256;return n}binary.readUintBE=readUintBE;function readUintLE(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,a=1,o=t;o<t+r/8;o++)n+=e[o]*a,a*=256;return n}binary.readUintLE=readUintLE;function writeUintBE(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!int_1.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var a=1,o=r/8+n-1;o>=n;o--)t[o]=e/a&255,a*=256;return t}binary.writeUintBE=writeUintBE;function writeUintLE(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!int_1.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var a=1,o=n;o<n+r/8;o++)t[o]=e/a&255,a*=256;return t}binary.writeUintLE=writeUintLE;function readFloat32BE(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}binary.readFloat32BE=readFloat32BE;function readFloat32LE(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}binary.readFloat32LE=readFloat32LE;function readFloat64BE(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}binary.readFloat64BE=readFloat64BE;function readFloat64LE(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}binary.readFloat64LE=readFloat64LE;function writeFloat32BE(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r),e}binary.writeFloat32BE=writeFloat32BE;function writeFloat32LE(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r,!0),e}binary.writeFloat32LE=writeFloat32LE;function writeFloat64BE(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r),e}binary.writeFloat64BE=writeFloat64BE;function writeFloat64LE(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r,!0),e}binary.writeFloat64LE=writeFloat64LE;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.randomStringForEntropy=r.randomString=r.randomUint32=r.randomBytes=r.defaultRandomSource=void 0;const e=system,t=binary,n=wipe$1;r.defaultRandomSource=new e.SystemRandomSource;function a(_,x=r.defaultRandomSource){return x.randomBytes(_)}r.randomBytes=a;function o(_=r.defaultRandomSource){const x=a(4,_),E=(0,t.readUint32LE)(x);return(0,n.wipe)(x),E}r.randomUint32=o;const c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function u(_,x=c,E=r.defaultRandomSource){if(x.length<2)throw new Error("randomString charset is too short");if(x.length>256)throw new Error("randomString charset is too long");let M="";const C=x.length,I=256-256%C;for(;_>0;){const D=a(Math.ceil(_*256/I),E);for(let L=0;L<D.length&&_>0;L++){const N=D[L];N<I&&(M+=x.charAt(N%C),_--)}(0,n.wipe)(D)}return M}r.randomString=u;function v(_,x=c,E=r.defaultRandomSource){const M=Math.ceil(_/(Math.log(x.length)/Math.LN2));return u(M,x,E)}r.randomStringForEntropy=v})(random);function getEIP191Verifier(){return{eip191:async(r,e)=>{verifyEIP191Signature(r,e)}}}const LEGACY_CHAIN_ID_REORG_DATE=new Date("2022-09-20").valueOf(),MESSAGE_PREFIX=`Ethereum Signed Message:
`;function verifyMessage(r,e){const t=typeof r=="string"?utf8ToBytes$5(r):r,n=keccak_256$1(concatBytes$1(utf8ToBytes$5(MESSAGE_PREFIX),utf8ToBytes$5(String(r.length)),t)),a=hexToBytes$3(e.replace(/^0x/,""));let o=a[64];(o===0||o===1)&&(o+=27);const c=secp256k1$2.Signature.fromCompact(a.slice(0,64)).addRecoveryBit(o-27).recoverPublicKey(n).toRawBytes(!1),u=keccak_256$1(c.subarray(1)).subarray(-20);return`0x${bytesToHex$2(u)}`}function verifyEIP191Signature(r,e){assertSigned(r),verifyTimeChecks(r,e);const t=AccountId.parse(r.p.iss.replace("did:pkh:","")).address.toLowerCase();let n=verifyMessage(SiweMessage.fromCacao(r).toMessage(),r.s.s);if(n!==t&&(n=verifyMessage(SiweMessage.fromCacao(r).toMessageEip55(),r.s.s)),n!==t&&Date.parse(r.p.iat)<=LEGACY_CHAIN_ID_REORG_DATE&&(n=verifyMessage(asLegacyChainIdString(SiweMessage.fromCacao(r),"Ethereum"),r.s.s)),n!==t)throw new Error("Signature does not belong to issuer")}function isUint8Array(r){return r instanceof Uint8Array}new TrivialCodec("Uint8Array",isUint8Array);function createUint8ArrayAsString(r){return new Type(`Uint8Array-as-${String(r)}`,isUint8Array,(e,t)=>{try{return t.success(fromString(e,r))}catch{return t.failure()}},e=>toString$1(e,r))}createUint8ArrayAsString("base64");const uint8ArrayAsBase64pad=createUint8ArrayAsString("base64pad"),uint8ArrayAsBase64url=createUint8ArrayAsString("base64url");function randomString(){return toString$1(random.randomBytes(16),"base64")}function encodeBase64(r){return uint8ArrayAsBase64pad.encode(r)}function encodeBase64Url(r){return uint8ArrayAsBase64url.encode(r)}function decodeBase64(r){return decode$4(uint8ArrayAsBase64pad,r)}function base64urlToJSON(r){const e=decode$4(uint8ArrayAsBase64url,r);return JSON.parse(toString$1(e))}function fromDagJWS(r){if(r.signatures.length>1)throw new Error("Cant convert to compact jws");return`${r.signatures[0].protected}.${r.payload}.${r.signatures[0].signature}`}function didWithTime(r,e){if(e){const t=e.toISOString().split(".")[0]+"Z";return`${r}?versionTime=${t}`}else return r}function extractControllers(r){return r?Array.isArray(r)?r:[r]:[]}function _define_property$1(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}const verifiers={...getEIP191Verifier()};function isResolver(r){return"registry"in r&&"cache"in r}function issuerEquals(r,e){return r===e?!0:r.startsWith("did:pkh:eip155:")?r.toLowerCase()===e.toLowerCase():!1}class DID{get capability(){if(!this._capability)throw new Error("DID has no capability attached");return this._capability}get hasCapability(){return this._capability!=null}get parent(){if(!this._parentId)throw new Error("DID has no parent DID");return this._parentId}get hasParent(){return this._parentId!=null}get id(){if(this._id==null)throw new Error("DID is not authenticated");return this._id}get authenticated(){return this._id!=null}withCapability(e){return new DID({provider:this._client?.connection,resolver:this._resolver,capability:e,parent:this._parentId})}setProvider(e){if(this._client==null)this._client=new RPCClient(e);else if(this._client.connection!==e)throw new Error("A different provider is already set, create a new DID instance to use another provider")}setResolver(e,t){this._resolver=isResolver(e)?e:new Resolver(e,t)}async authenticate({provider:e,paths:t=[],aud:n}={}){if(e!=null&&this.setProvider(e),this._client==null)throw new Error("No provider available");const a=randomString(),o=await this._client.request("did_authenticate",{nonce:a,aud:n,paths:t}),{kid:c}=await this.verifyJWS(o),u=base64urlToJSON(o.payload);if(!c.includes(u.did))throw new Error("Invalid authencation response, kid mismatch");if(u.nonce!==a)throw new Error("Invalid authencation response, wrong nonce");if(u.aud!==n)throw new Error("Invalid authencation response, wrong aud");if(u.exp<Date.now()/1e3)throw new Error("Invalid authencation response, expired");return this._id=u.did,this._id}async createJWS(e,t={}){if(this._client==null)throw new Error("No provider available");if(this._id==null)throw new Error("DID is not authenticated");if(this._capability){const a=this._capability.p.exp;if(a&&Date.parse(a)<Date.now())throw new Error("Capability is expired, cannot create a valid signature");const o=await CacaoBlock.fromCacao(this._capability),c=CID.asCID(o.cid);if(!c)throw new Error("Capability CID of the JWS cannot be set to the capability payload cid as they are incompatible");t.protected=t.protected||{},t.protected.cap=`ipfs://${c?.toString()}`}const{jws:n}=await this._client.request("did_createJWS",{did:this._id,...t,payload:e});return n}async createDagJWS(e,t={}){const{cid:n,linkedBlock:a}=await encodePayload(e),o=encodeBase64Url(n.bytes);Object.assign(t,{linkedBlock:encodeBase64(a)});const c=await this.createJWS(o,t),u=CID.asCID(n);if(!u)throw new Error("CID of the JWS cannot be set to the encoded payload cid as they are incompatible");if(c.link=u,this._capability){const v=await CacaoBlock.fromCacao(this._capability);return{jws:c,linkedBlock:a,cacaoBlock:v.bytes}}return{jws:c,linkedBlock:a}}async verifyJWS(e,t={}){t=Object.assign({verifiers},t),typeof e!="string"&&(e=fromDagJWS(e));const n=base64urlToJSON(e.split(".")[0]).kid;if(!n)throw new Error('No "kid" found in jws');const a=await this.resolve(n);if(!t.disableTimecheck){const _=a.didDocumentMetadata?.nextUpdate;if(_){const E=t.revocationPhaseOutSecs?t.revocationPhaseOutSecs*1e3:0,M=new Date(_).valueOf()+E;if(!(t.atTime&&t.atTime.getTime()<M))throw new Error(`invalid_jws: signature authored with a revoked DID version: ${n}`)}const x=a.didDocumentMetadata?.updated;if(x&&t.atTime&&t.atTime.getTime()<new Date(x).valueOf())throw new Error(`invalid_jws: signature authored before creation of DID version: ${n}`)}const c=a.didDocument?.id;if(t.issuer&&t.capability&&issuerEquals(t.issuer,t.capability?.p.iss)&&c===t.capability.p.aud){if(!t.verifiers)throw new Error("Registered verifiers needed for CACAO");await Cacao.verify(t.capability,{disableExpirationCheck:t.disableTimecheck,atTime:t.atTime?t.atTime:void 0,revocationPhaseOutSecs:t.revocationPhaseOutSecs,verifiers:t.verifiers??{}})}else if(t.issuer&&t.issuer!==c){const _=didWithTime(t.issuer,t.atTime),E=(await this.resolve(_)).didDocument?.controller,M=extractControllers(E);if(t.capability?.s&&t.capability.p.aud===c&&M.includes(t.capability.p.iss))await Cacao.verify(t.capability,{atTime:t.atTime?t.atTime:void 0,revocationPhaseOutSecs:t.revocationPhaseOutSecs,verifiers:t.verifiers??{}});else if(!(c?M.includes(c):!1))throw new Error(`invalid_jws: not a valid verificationMethod for issuer: ${n}`)}const u=a.didDocument?.verificationMethod||[];verifyJWS(e,u);let v;try{v=base64urlToJSON(e.split(".")[1])}catch{}return{kid:n,payload:v,didResolutionResult:a}}async createJWE(e,t,n={}){const a=await resolveX25519Encrypters(t,this._resolver);return createJWE(e,a,n.protectedHeader,n.aad)}async createDagJWE(e,t,n={}){const a=await prepareCleartext(e);return this.createJWE(a,t,n)}async decryptJWE(e,t={}){if(this._client==null)throw new Error("No provider available");if(this._id==null)throw new Error("DID is not authenticated");const{cleartext:n}=await this._client.request("did_decryptJWE",{did:this._id,...t,jwe:e});return decodeBase64(n)}async decryptDagJWE(e){const t=await this.decryptJWE(e);return decodeCleartext(t)}async resolve(e){const t=await this._resolver.resolve(e);if(t.didResolutionMetadata.error){const{error:n,message:a}=t.didResolutionMetadata,o=a?`, ${a}`:"";throw new Error(`Failed to resolve ${e}: ${n}${o}`)}return t}constructor({provider:e,resolver:t={},resolverOptions:n,capability:a,parent:o}={}){if(_define_property$1(this,"_client",void 0),_define_property$1(this,"_id",void 0),_define_property$1(this,"_resolver",void 0),_define_property$1(this,"_capability",void 0),_define_property$1(this,"_parentId",void 0),e!=null&&(this._client=new RPCClient(e)),a){if(this._capability=a,this._parentId=this._capability.p.iss,this._parentId.startsWith("did:pkh:eip155:1:")&&(this._parentId=this._parentId.toLowerCase()),o&&this._parentId!==o)throw new Error("Capability issuer and parent not equal")}else o&&(this._parentId=o);this.setResolver(t,n)}}var fastJsonStableStringify=function(r,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,n=e.cmp&&function(o){return function(c){return function(u,v){var _={key:u,value:c[u]},x={key:v,value:c[v]};return o(_,x)}}}(e.cmp),a=[];return function o(c){if(c&&c.toJSON&&typeof c.toJSON=="function"&&(c=c.toJSON()),c!==void 0){if(typeof c=="number")return isFinite(c)?""+c:"null";if(typeof c!="object")return JSON.stringify(c);var u,v;if(Array.isArray(c)){for(v="[",u=0;u<c.length;u++)u&&(v+=","),v+=o(c[u])||"null";return v+"]"}if(c===null)return"null";if(a.indexOf(c)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var _=a.push(c)-1,x=Object.keys(c).sort(n&&n(c));for(v="",u=0;u<x.length;u++){var E=x[u],M=o(c[E]);M&&(v&&(v+=","),v+=JSON.stringify(E)+":"+M)}return a.splice(_,1),"{"+v+"}"}}(r)};const stringify=getDefaultExportFromCjs(fastJsonStableStringify);function _define_property(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}const B64="base64pad";function toStableObject(r){return JSON.parse(stringify(r))}function encodeDID(r){const e=new Uint8Array(r.length+2);return e[0]=237,e[1]=1,e.set(r,2),`did:key:z${toString$1(e,"base58btc")}`}function toGeneralJWS(r){const[e,t,n]=r.split(".");return{payload:t,signatures:[{protected:e,signature:n}]}}const sign$1=async(r,e,t,n={})=>{const a=`${e}#${e.split(":")[2]}`,o=EdDSASigner(t),c=toStableObject(Object.assign(n,{kid:a,alg:"EdDSA"}));return createJWS(typeof r=="string"?r:toStableObject(r),o,c)},didMethods={did_authenticate:async({did:r,secretKey:e},t)=>{const n=await sign$1({did:r,aud:t.aud,nonce:t.nonce,paths:t.paths,exp:Math.floor(Date.now()/1e3)+600},r,e);return toGeneralJWS(n)},did_createJWS:async({did:r,secretKey:e},t)=>{if(t.did.split("#")[0]!==r)throw new RPCError(4100,`Unknown DID: ${r}`);const a=await sign$1(t.payload,r,e,t.protected);return{jws:toGeneralJWS(a)}},did_decryptJWE:async({secretKey:r},e)=>{const t=edwardsToMontgomeryPriv(r.subarray(0,32)),n=x25519Decrypter(t);try{const a=await decryptJWE(e.jwe,n);return{cleartext:toString$1(a,B64)}}catch(a){throw new RPCError(-32e3,a.message)}}};class Ed25519Provider{get isDidProvider(){return!0}async send(e){return await this._handle(e)}constructor(e){_define_property(this,"_handle",void 0);const t=ed25519$1.getPublicKey(e),n=concat$1([e,ed25519$1.getPublicKey(e)]),a=encodeDID(t),o=createHandler(didMethods);this._handle=async c=>await o({did:a,secretKey:n},c)}}var encode_1=encode$3,MSB$3=128,MSBALL=-128,INT=Math.pow(2,31);function encode$3(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw encode$3.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=INT;)e[t++]=r&255|MSB$3,r/=128;for(;r&MSBALL;)e[t++]=r&255|MSB$3,r>>>=7;return e[t]=r|0,encode$3.bytes=t-n+1,e}var decode$2=read$2,MSB$2=128,REST$2=127;function read$2(r,n){var t=0,n=n||0,a=0,o=n,c,u=r.length;do{if(o>=u||a>49)throw read$2.bytes=0,new RangeError("Could not decode varint");c=r[o++],t+=a<28?(c&REST$2)<<a:(c&REST$2)*Math.pow(2,a),a+=7}while(c>=MSB$2);return read$2.bytes=o-n,t}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length$2=function(r){return r<N1$1?1:r<N2$1?2:r<N3$1?3:r<N4$1?4:r<N5$1?5:r<N6$1?6:r<N7$1?7:r<N8?8:r<N9?9:10},varint={encode:encode_1,decode:decode$2,encodingLength:length$2};const varint$1=getDefaultExportFromCjs(varint);function keyToDidDoc$4(r,e){const t=`did:key:${e}`,n=`${t}#${e}`;return{id:t,verificationMethod:[{id:n,type:"Secp256k1VerificationKey2018",controller:t,publicKeyBase58:toString$1(r,"base58btc")}],authentication:[n],assertionMethod:[n],capabilityDelegation:[n],capabilityInvocation:[n]}}const secp256k1=Object.freeze(Object.defineProperty({__proto__:null,keyToDidDoc:keyToDidDoc$4},Symbol.toStringTag,{value:"Module"}));function encodeKey(r){const e=new Uint8Array(r.length+2);return e[0]=236,e[1]=1,e.set(r,2),`z${toString$1(e,"base58btc")}`}function keyToDidDoc$3(r,e){const t=`did:key:${e}`,n=`${t}#${e}`,a=edwardsToMontgomeryPub(r),o=`${t}#${encodeKey(a)}`;return{id:t,verificationMethod:[{id:n,type:"Ed25519VerificationKey2018",controller:t,publicKeyBase58:toString$1(r,"base58btc")}],authentication:[n],assertionMethod:[n],capabilityDelegation:[n],capabilityInvocation:[n],keyAgreement:[{id:o,type:"X25519KeyAgreementKey2019",controller:t,publicKeyBase58:toString$1(a,"base58btc")}]}}const ed25519=Object.freeze(Object.defineProperty({__proto__:null,keyToDidDoc:keyToDidDoc$3},Symbol.toStringTag,{value:"Module"}));function keyToDidDoc$2(r,e){const t=`did:key:${e}`,n=`${t}#${e}`,a=p256.ProjectivePoint.fromHex(normalizePubKeyBytes$1(r));return{id:t,verificationMethod:[{id:n,type:"JsonWebKey2020",controller:t,publicKeyJwk:{kty:"EC",crv:"P-256",x:toString$1(numberToVarBytesBE(a.x),"base64url"),y:toString$1(numberToVarBytesBE(a.y),"base64url")}}],authentication:[n],assertionMethod:[n],capabilityDelegation:[n],capabilityInvocation:[n]}}function normalizePubKeyBytes$1(r){return r.length===64?concat$1([new Uint8Array([4]),r]):r}const secp256r1=Object.freeze(Object.defineProperty({__proto__:null,keyToDidDoc:keyToDidDoc$2},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const P$1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),Fp384=Field(P$1),CURVE_A=Fp384.create(BigInt("-3")),CURVE_B=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),p384=createCurve({a:CURVE_A,b:CURVE_B,Fp:Fp384,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},sha384$2);function keyToDidDoc$1(r,e){const t=`did:key:${e}`,n=`${t}#${e}`,a=p384.ProjectivePoint.fromHex(normalizePubKeyBytes(r));return{id:t,verificationMethod:[{id:n,type:"JsonWebKey2020",controller:t,publicKeyJwk:{kty:"EC",crv:"P-384",x:toString$1(numberToVarBytesBE(a.x),"base64url"),y:toString$1(numberToVarBytesBE(a.y),"base64url")}}],authentication:[n],assertionMethod:[n],capabilityDelegation:[n],capabilityInvocation:[n]}}function normalizePubKeyBytes(r){return r.length===96?concat$1([new Uint8Array([4]),r]):r}const secp384r1=Object.freeze(Object.defineProperty({__proto__:null,keyToDidDoc:keyToDidDoc$1},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const P=BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Fp521=Field(P),CURVE={a:Fp521.create(BigInt("-3")),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1)},p521=createCurve({a:CURVE.a,b:CURVE.b,Fp:Fp521,n:CURVE.n,Gx:CURVE.Gx,Gy:CURVE.Gy,h:CURVE.h,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},sha512$2);function keyToDidDoc(r,e){const t=`did:key:${e}`,n=`${t}#${e}`,a=p521.ProjectivePoint.fromHex(r);return{id:t,verificationMethod:[{id:n,type:"JsonWebKey2020",controller:t,publicKeyJwk:{kty:"EC",crv:"P-521",x:toString$1(numberToVarBytesBE(a.x),"base64url"),y:toString$1(numberToVarBytesBE(a.y),"base64url")}}],authentication:[n],assertionMethod:[n],capabilityDelegation:[n],capabilityInvocation:[n]}}const secp521r1=Object.freeze(Object.defineProperty({__proto__:null,keyToDidDoc},Symbol.toStringTag,{value:"Module"})),DID_LD_JSON="application/did+ld+json",DID_JSON="application/did+json",prefixToDriverMap={231:secp256k1,237:ed25519,4608:secp256r1,4609:secp384r1,4610:secp521r1};function getResolver$1(){return{key:async(r,e,t,n)=>{const a=n.accept||DID_JSON,o={didResolutionMetadata:{contentType:a},didDocument:null,didDocumentMetadata:{}};try{const c=base58btc.decode(e.id),u=varint$1.decode(c),v=c.slice(varint$1.decode.bytes),_=await prefixToDriverMap[u].keyToDidDoc(v,e.id);a===DID_LD_JSON?(_["@context"]="https://w3id.org/did/v1",o.didDocument=_):a===DID_JSON?o.didDocument=_:(delete o.didResolutionMetadata.contentType,o.didResolutionMetadata.error="representationNotSupported")}catch(c){o.didResolutionMetadata.error="invalidDid",o.didResolutionMetadata.message=c.toString()}return o}}}class IdentityManager{constructor(){this.did=null}async init(){const e=await this.getSeed(),t=new Ed25519Provider(e);return this.did=new DID({provider:t,resolver:getResolver$1()}),await this.did.authenticate(),this.did}async getSeed(){let e=localStorage.getItem("did-seed");return e?e=fromString(e,"hex"):(e=crypto.getRandomValues(new Uint8Array(32)),localStorage.setItem("did-seed",dist.Buffer.from(e).toString("hex"))),e}async createProof(e){return await this.did.createJWS(e)}async verifyProof(e){return await this.did.verifyJWS(e)}}const identityManager=new IdentityManager,dataProcessing={async processFormData(r,e,t,n){const a={formData:r,otherValues:e,otherChecked:t,phenotype:n};console.log("rawData in processFormData (JSON):",a);try{const o=a,c=this.serializeData(o),u=await encryption.encryptData(c),v=u.encrypted;await identityManager.init();const _=await this.signData(c);return{payload:v,signature:_,encryptionMetadata:{iv:u.iv,key:u.key}}}catch(o){throw console.error("Error in processFormData (JSON):",o),o}},serializeData(r){try{const e=JSON.stringify(r);return console.log("Serialized Data (JSON):",e),e}catch(e){throw console.error("Serialization Error (JSON):",e),e}},deserializeData(r){try{const e=JSON.parse(r);return console.log("Deserialized Data (JSON):",e),e}catch(e){throw console.error("Deserialization Error (JSON):",e),e}},async signData(r){return await identityManager.createProof(r)}},connectionSymbol=Symbol.for("@libp2p/connection"),contentRoutingSymbol=Symbol.for("@libp2p/content-routing"),peerDiscoverySymbol=Symbol.for("@libp2p/peer-discovery"),peerIdSymbol=Symbol.for("@libp2p/peer-id");function isPeerId(r){return!!r?.[peerIdSymbol]}const peerRoutingSymbol=Symbol.for("@libp2p/peer-routing"),KEEP_ALIVE="keep-alive",transportSymbol=Symbol.for("@libp2p/transport");var FaultTolerance;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(FaultTolerance||(FaultTolerance={}));let AbortError$6=class extends Error{static name="AbortError";constructor(e="The operation was aborted"){super(e),this.name="AbortError"}};class UnexpectedPeerError extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}class InvalidParametersError extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}class InvalidPublicKeyError extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}class ConnectionClosingError extends Error{static name="ConnectionClosingError";constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}class ConnectionClosedError extends Error{static name="ConnectionClosedError";constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}class ConnectionFailedError extends Error{static name="ConnectionFailedError";constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}class MuxerClosedError extends Error{static name="MuxerClosedError";constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}class StreamResetError extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}class StreamStateError extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}let NotFoundError$1=class extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}};class InvalidPeerIdError extends Error{static name="InvalidPeerIdError";constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}class InvalidMultiaddrError extends Error{static name="InvalidMultiaddrError";constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}class InvalidCIDError extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}class InvalidMultihashError extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}class UnsupportedProtocolError extends Error{static name="UnsupportedProtocolError";constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}class InvalidMessageError extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}let TimeoutError$1=class extends Error{static name="TimeoutError";constructor(e="Timed out"){super(e),this.name="TimeoutError"}};class NotStartedError extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}}class DialError extends Error{static name="DialError";constructor(e="Dial error"){super(e),this.name="DialError"}}class LimitedConnectionError extends Error{static name="LimitedConnectionError";constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}class TooManyInboundProtocolStreamsError extends Error{static name="TooManyInboundProtocolStreamsError";constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}class TooManyOutboundProtocolStreamsError extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}class UnsupportedKeyTypeError extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}const setMaxListeners=(r,...e)=>{try{eventsExports.setMaxListeners(r,...e)}catch{}};class TypedEventEmitter extends EventTarget{#e=new Map;constructor(){super(),setMaxListeners(1/0,this)}listenerCount(e){const t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let a=this.#e.get(e);a==null&&(a=[],this.#e.set(e,a)),a.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let a=this.#e.get(e);a!=null&&(a=a.filter(({callback:o})=>o!==t),this.#e.set(e,a))}dispatchEvent(e){const t=super.dispatchEvent(e);let n=this.#e.get(e.type);return n==null||(n=n.filter(({once:a})=>!a),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}function isStartable(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function start(...r){const e=[];for(const t of r)isStartable(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function stop(...r){const e=[];for(const t of r)isStartable(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const serviceCapabilities=Symbol.for("@libp2p/service-capabilities"),serviceDependencies=Symbol.for("@libp2p/service-dependencies"),PUBLIC_KEY_BYTE_LENGTH=32,PRIVATE_KEY_BYTE_LENGTH=64,KEYS_BYTE_LENGTH=32;function generateKey(){const r=ed25519$1.utils.randomPrivateKey(),e=ed25519$1.getPublicKey(r);return{privateKey:concatKeys(r,e),publicKey:e}}function hashAndSign(r,e){const t=r.subarray(0,KEYS_BYTE_LENGTH);return ed25519$1.sign(e instanceof Uint8Array?e:e.subarray(),t)}function hashAndVerify$2(r,e,t){return ed25519$1.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function concatKeys(r,e){const t=new Uint8Array(PRIVATE_KEY_BYTE_LENGTH);for(let n=0;n<KEYS_BYTE_LENGTH;n++)t[n]=r[n],t[KEYS_BYTE_LENGTH+n]=e[n];return t}class Ed25519PublicKey{type="Ed25519";raw;constructor(e){this.raw=ensureEd25519Key(e,PUBLIC_KEY_BYTE_LENGTH)}toMultihash(){return identity$2.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:equals(this.raw,e.raw)}verify(e,t){return hashAndVerify$2(this.raw,t,e)}}class Ed25519PrivateKey{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=ensureEd25519Key(e,PRIVATE_KEY_BYTE_LENGTH),this.publicKey=new Ed25519PublicKey(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:equals(this.raw,e.raw)}sign(e){return hashAndSign(this.raw,e)}}function unmarshalEd25519PublicKey(r){return r=ensureEd25519Key(r,PUBLIC_KEY_BYTE_LENGTH),new Ed25519PublicKey(r)}async function generateEd25519KeyPair(){const{privateKey:r,publicKey:e}=generateKey();return new Ed25519PrivateKey(r,e)}function ensureEd25519Key(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new InvalidParametersError(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),MSB$1=128,REST$1=127;function encodingLength(r){if(r<N1)return 1;if(r<N2)return 2;if(r<N3)return 3;if(r<N4)return 4;if(r<N5)return 5;if(r<N6)return 6;if(r<N7)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function encodeUint8Array(r,e,t=0){switch(encodingLength(r)){case 8:e[t++]=r&255|MSB$1,r/=128;case 7:e[t++]=r&255|MSB$1,r/=128;case 6:e[t++]=r&255|MSB$1,r/=128;case 5:e[t++]=r&255|MSB$1,r/=128;case 4:e[t++]=r&255|MSB$1,r>>>=7;case 3:e[t++]=r&255|MSB$1,r>>>=7;case 2:e[t++]=r&255|MSB$1,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function encodeUint8ArrayList(r,e,t=0){switch(encodingLength(r)){case 8:e.set(t++,r&255|MSB$1),r/=128;case 7:e.set(t++,r&255|MSB$1),r/=128;case 6:e.set(t++,r&255|MSB$1),r/=128;case 5:e.set(t++,r&255|MSB$1),r/=128;case 4:e.set(t++,r&255|MSB$1),r>>>=7;case 3:e.set(t++,r&255|MSB$1),r>>>=7;case 2:e.set(t++,r&255|MSB$1),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function decodeUint8Array(r,e){let t=r[e],n=0;if(n+=t&REST$1,t<MSB$1||(t=r[e+1],n+=(t&REST$1)<<7,t<MSB$1)||(t=r[e+2],n+=(t&REST$1)<<14,t<MSB$1)||(t=r[e+3],n+=(t&REST$1)<<21,t<MSB$1)||(t=r[e+4],n+=(t&REST$1)*N4,t<MSB$1)||(t=r[e+5],n+=(t&REST$1)*N5,t<MSB$1)||(t=r[e+6],n+=(t&REST$1)*N6,t<MSB$1)||(t=r[e+7],n+=(t&REST$1)*N7,t<MSB$1))return n;throw new RangeError("Could not decode varint")}function decodeUint8ArrayList(r,e){let t=r.get(e),n=0;if(n+=t&REST$1,t<MSB$1||(t=r.get(e+1),n+=(t&REST$1)<<7,t<MSB$1)||(t=r.get(e+2),n+=(t&REST$1)<<14,t<MSB$1)||(t=r.get(e+3),n+=(t&REST$1)<<21,t<MSB$1)||(t=r.get(e+4),n+=(t&REST$1)*N4,t<MSB$1)||(t=r.get(e+5),n+=(t&REST$1)*N5,t<MSB$1)||(t=r.get(e+6),n+=(t&REST$1)*N6,t<MSB$1)||(t=r.get(e+7),n+=(t&REST$1)*N7,t<MSB$1))return n;throw new RangeError("Could not decode varint")}function encode$2(r,e,t=0){return e==null&&(e=allocUnsafe(encodingLength(r))),e instanceof Uint8Array?encodeUint8Array(r,e,t):encodeUint8ArrayList(r,e,t)}function decode$1(r,e=0){return r instanceof Uint8Array?decodeUint8Array(r,e):decodeUint8ArrayList(r,e)}const f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer);function writeFloatLE(r,e,t){f32[0]=r,e[t]=f8b[0],e[t+1]=f8b[1],e[t+2]=f8b[2],e[t+3]=f8b[3]}function readFloatLE(r,e){return f8b[0]=r[e],f8b[1]=r[e+1],f8b[2]=r[e+2],f8b[3]=r[e+3],f32[0]}const f64=new Float64Array([-0]),d8b=new Uint8Array(f64.buffer);function writeDoubleLE(r,e,t){f64[0]=r,e[t]=d8b[0],e[t+1]=d8b[1],e[t+2]=d8b[2],e[t+3]=d8b[3],e[t+4]=d8b[4],e[t+5]=d8b[5],e[t+6]=d8b[6],e[t+7]=d8b[7]}function readDoubleLE(r,e){return d8b[0]=r[e],d8b[1]=r[e+1],d8b[2]=r[e+2],d8b[3]=r[e+3],d8b[4]=r[e+4],d8b[5]=r[e+5],d8b[6]=r[e+6],d8b[7]=r[e+7],f64[0]}const MAX_SAFE_NUMBER_INTEGER=BigInt(Number.MAX_SAFE_INTEGER),MIN_SAFE_NUMBER_INTEGER=BigInt(Number.MIN_SAFE_INTEGER);class LongBits{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return zero;if(e<MAX_SAFE_NUMBER_INTEGER&&e>MIN_SAFE_NUMBER_INTEGER)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,a=e-(n<<32n);return t&&(n=~n|0n,a=~a|0n,++a>TWO_32&&(a=0n,++n>TWO_32&&(n=0n))),new LongBits(Number(a),Number(n))}static fromNumber(e){if(e===0)return zero;const t=e<0;t&&(e=-e);let n=e>>>0,a=(e-n)/4294967296>>>0;return t&&(a=~a>>>0,n=~n>>>0,++n>4294967295&&(n=0,++a>4294967295&&(a=0))),new LongBits(n,a)}static from(e){return typeof e=="number"?LongBits.fromNumber(e):typeof e=="bigint"?LongBits.fromBigInt(e):typeof e=="string"?LongBits.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new LongBits(e.low>>>0,e.high>>>0):zero}}const zero=new LongBits(0,0);zero.toBigInt=function(){return 0n};zero.zzEncode=zero.zzDecode=function(){return this};zero.length=function(){return 1};const TWO_32=4294967296n;function length$1(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function read$1(r,e,t){if(t-e<1)return"";let a;const o=[];let c=0,u;for(;e<t;)u=r[e++],u<128?o[c++]=u:u>191&&u<224?o[c++]=(u&31)<<6|r[e++]&63:u>239&&u<365?(u=((u&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,o[c++]=55296+(u>>10),o[c++]=56320+(u&1023)):o[c++]=(u&15)<<12|(r[e++]&63)<<6|r[e++]&63,c>8191&&((a??(a=[])).push(String.fromCharCode.apply(String,o)),c=0);return a!=null?(c>0&&a.push(String.fromCharCode.apply(String,o.slice(0,c))),a.join("")):String.fromCharCode.apply(String,o.slice(0,c))}function write$1(r,e,t){const n=t;let a,o;for(let c=0;c<r.length;++c)a=r.charCodeAt(c),a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&((o=r.charCodeAt(c+1))&64512)===56320?(a=65536+((a&1023)<<10)+(o&1023),++c,e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128);return t-n}function indexOutOfRange(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function readFixed32End(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class Uint8ArrayReader{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);const e=readFloatLE(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);const e=readDoubleLE(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return read$1(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new LongBits(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);const e=readFixed32End(this.buf,this.pos+=4),t=readFixed32End(this.buf,this.pos+=4);return new LongBits(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=decodeUint8Array(this.buf,this.pos);return this.pos+=encodingLength(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function createReader(r){return new Uint8ArrayReader(r instanceof Uint8Array?r:r.subarray())}function decodeMessage(r,e,t){const n=createReader(r);return e.decode(n,void 0,t)}function pool(r){let n,a=8192;return function(c){if(c<1||c>4096)return allocUnsafe(c);a+c>8192&&(n=allocUnsafe(8192),a=0);const u=n.subarray(a,a+=c);return a&7&&(a=(a|7)+1),u}}class Op{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}}function noop$1(){}class State{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const bufferPool=pool();function alloc(r){return globalThis.Buffer!=null?allocUnsafe(r):bufferPool(r)}class Uint8ArrayWriter{len;head;tail;states;constructor(){this.len=0,this.head=new Op(noop$1,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Op(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(writeVarint64,10,LongBits.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=LongBits.fromBigInt(e);return this._push(writeVarint64,t.length(),t)}uint64Number(e){return this._push(encodeUint8Array,encodingLength(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=LongBits.fromBigInt(e).zzEncode();return this._push(writeVarint64,t.length(),t)}sint64Number(e){const t=LongBits.fromNumber(e).zzEncode();return this._push(writeVarint64,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(writeByte,1,e?1:0)}fixed32(e){return this._push(writeFixed32,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=LongBits.fromBigInt(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)}fixed64Number(e){const t=LongBits.fromNumber(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(writeFloatLE,4,e)}double(e){return this._push(writeDoubleLE,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(writeByte,1,0):this.uint32(t)._push(writeBytes,t,e)}string(e){const t=length$1(e);return t!==0?this.uint32(t)._push(write$1,t,e):this._push(writeByte,1,0)}fork(){return this.states=new State(this),this.head=this.tail=new Op(noop$1,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$1,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=alloc(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function writeByte(r,e,t){e[t]=r&255}function writeVarint32(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class VarintOp extends Op{next;constructor(e,t){super(writeVarint32,e,t),this.next=void 0}}function writeVarint64(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function writeFixed32(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function writeBytes(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Uint8ArrayWriter.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(writeBytesBuffer,e,r),this},Uint8ArrayWriter.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(writeStringBuffer,e,r),this});function writeBytesBuffer(r,e,t){e.set(r,t)}function writeStringBuffer(r,e,t){r.length<40?write$1(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(fromString(r),t)}function createWriter(){return new Uint8ArrayWriter}function encodeMessage(r,e){const t=createWriter();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var CODEC_TYPES;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(CODEC_TYPES||(CODEC_TYPES={}));function createCodec(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function enumeration(r){function e(a){if(r[a.toString()]==null)throw new Error("Invalid enum value");return r[a]}const t=function(o,c){const u=e(o);c.int32(u)},n=function(o){const c=o.int32();return e(c)};return createCodec("enum",CODEC_TYPES.VARINT,t,n)}function message(r,e){return createCodec("message",CODEC_TYPES.LENGTH_DELIMITED,r,e)}class MaxLengthError extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class MaxSizeError extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}var KeyType;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1"})(KeyType||(KeyType={}));var __KeyTypeValues;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1"})(__KeyTypeValues||(__KeyTypeValues={}));(function(r){r.codec=()=>enumeration(__KeyTypeValues)})(KeyType||(KeyType={}));var PublicKey;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),KeyType.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.Type=KeyType.codec().decode(t);break}case 2:{o.Data=t.bytes();break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(PublicKey||(PublicKey={}));var PrivateKey;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),KeyType.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.Type=KeyType.codec().decode(t);break}case 2:{o.Data=t.bytes();break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(PrivateKey||(PrivateKey={}));/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const ARRAY_BUFFER_NAME="[object ArrayBuffer]";class BufferSourceConverter{static isArrayBuffer(e){return Object.prototype.toString.call(e)===ARRAY_BUFFER_NAME}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=BufferSourceConverter.toUint8Array(e),a=BufferSourceConverter.toUint8Array(t);if(n.length!==a.byteLength)return!1;for(let o=0;o<n.length;o++)if(n[o]!==a[o])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const c of t)n+=c.byteLength;const a=new Uint8Array(n);let o=0;for(const c of t){const u=this.toUint8Array(c);a.set(u,o),o+=u.length}return e[e.length-1]instanceof Function?this.toView(a,e[e.length-1]):a.buffer}}const STRING_TYPE="string",HEX_REGEX=/^[0-9a-f\s]+$/i,BASE64_REGEX=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,BASE64URL_REGEX=/^[a-zA-Z0-9-_]+$/;class Utf8Converter{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n.buffer}static toString(e){const t=BufferSourceConverter.toUint8Array(e);let n="";for(let o=0;o<t.length;o++)n+=String.fromCharCode(t[o]);return decodeURIComponent(escape(n))}}class Utf16Converter{static toString(e,t=!1){const n=BufferSourceConverter.toArrayBuffer(e),a=new DataView(n);let o="";for(let c=0;c<n.byteLength;c+=2){const u=a.getUint16(c,t);o+=String.fromCharCode(u)}return o}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),a=new DataView(n);for(let o=0;o<e.length;o++)a.setUint16(o*2,e.charCodeAt(o),t);return n}}class Convert{static isHex(e){return typeof e===STRING_TYPE&&HEX_REGEX.test(e)}static isBase64(e){return typeof e===STRING_TYPE&&BASE64_REGEX.test(e)}static isBase64Url(e){return typeof e===STRING_TYPE&&BASE64URL_REGEX.test(e)}static ToString(e,t="utf8"){const n=BufferSourceConverter.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return Utf16Converter.toString(n,!0);case"utf16":case"utf16be":return Utf16Converter.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Utf16Converter.fromString(e,!0);case"utf16":case"utf16be":return Utf16Converter.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=BufferSourceConverter.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return dist.Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Convert.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(dist.Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Convert.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Convert.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Utf8Converter.fromString(e);case"utf16":case"utf16be":return Utf16Converter.fromString(e);case"utf16le":case"usc2":return Utf16Converter.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Convert.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Utf8Converter.toString(e);case"utf16":case"utf16be":return Utf16Converter.toString(e);case"utf16le":case"usc2":return Utf16Converter.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=e.charCodeAt(a);return n.buffer}static ToBinary(e){const t=BufferSourceConverter.toUint8Array(e);let n="";for(let a=0;a<t.length;a++)n+=String.fromCharCode(t[a]);return n}static ToHex(e){const t=BufferSourceConverter.toUint8Array(e);let n="";const a=t.length;for(let o=0;o<a;o++){const c=t[o];c<16&&(n+="0"),n+=c.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Convert.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let a=0;a<t.length;a=a+2){const o=t.slice(a,a+2);n[a/2]=parseInt(o,16)}return n.buffer}static ToUtf16String(e,t=!1){return Utf16Converter.toString(e,t)}static FromUtf16String(e,t=!1){return Utf16Converter.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}}Convert.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function utilFromBase(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function utilToBase(r,e,t=-1){const n=t;let a=r,o=0,c=Math.pow(2,e);for(let u=1;u<8;u++){if(r<c){let v;if(n<0)v=new ArrayBuffer(u),o=u;else{if(n<u)return new ArrayBuffer(0);v=new ArrayBuffer(n),o=n}const _=new Uint8Array(v);for(let x=u-1;x>=0;x--){const E=Math.pow(2,x*e);_[o-x-1]=Math.floor(a/E),a-=_[o-x-1]*E}return v}c*=Math.pow(2,e)}return new ArrayBuffer(0)}function utilConcatView(...r){let e=0,t=0;for(const o of r)e+=o.length;const n=new ArrayBuffer(e),a=new Uint8Array(n);for(const o of r)a.set(o,t),t+=o.length;return a}function utilDecodeTC(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const u=r[0]===255&&r[1]&128,v=r[0]===0&&(r[1]&128)===0;(u||v)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let u=0;u<this.valueHex.byteLength;u++)t[u]=0;t[0]=r[0]&128;const n=utilFromBase(t,8),a=new ArrayBuffer(this.valueHex.byteLength),o=new Uint8Array(a);for(let u=0;u<this.valueHex.byteLength;u++)o[u]=r[u];return o[0]&=127,utilFromBase(o,8)-n}function utilEncodeTC(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const c=t-e,u=utilToBase(c,8,n),v=new Uint8Array(u);return v[0]|=128,u}let a=utilToBase(e,8,n),o=new Uint8Array(a);if(o[0]&128){const c=a.slice(0),u=new Uint8Array(c);a=new ArrayBuffer(a.byteLength+1),o=new Uint8Array(a);for(let v=0;v<c.byteLength;v++)o[v+1]=u[v];o[0]=0}return a}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function isEqualBuffer(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let a=0;a<t.length;a++)if(t[a]!==n[a])return!1;return!0}function padNumber(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,a=new Array(n);for(let c=0;c<n;c++)a[c]="0";return a.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function assertBigInt(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function concat(r){let e=0,t=0;for(let a=0;a<r.length;a++){const o=r[a];e+=o.byteLength}const n=new Uint8Array(e);for(let a=0;a<r.length;a++){const o=r[a];n.set(new Uint8Array(o),t),t+=o.byteLength}return n.buffer}function checkBufferParams(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class ViewWriter{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return concat(this.items)}}const powers2=[new Uint8Array([1])],digitsString="0123456789",EMPTY_STRING="",EMPTY_BUFFER$1=new ArrayBuffer(0),EMPTY_VIEW=new Uint8Array(0),END_OF_CONTENT_NAME="EndOfContent",OCTET_STRING_NAME="OCTET STRING",BIT_STRING_NAME="BIT STRING";function HexBlock(r){var e;return e=class extends r{constructor(...n){var a;super(...n);const o=n[0]||{};this.isHexOnly=(a=o.isHexOnly)!==null&&a!==void 0?a:!1,this.valueHexView=o.valueHex?BufferSourceConverter.toUint8Array(o.valueHex):EMPTY_VIEW}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}fromBER(n,a,o){const c=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!checkBufferParams(this,c,a,o))return-1;const u=a+o;return this.valueHexView=c.subarray(a,u),this.valueHexView.length?(this.blockLength=o,u):(this.warnings.push("Zero buffer length"),a)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",EMPTY_BUFFER$1)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class LocalBaseBlock{constructor({blockLength:e=0,error:t=EMPTY_STRING,warnings:n=[],valueBeforeDecode:a=EMPTY_VIEW}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=BufferSourceConverter.toUint8Array(a)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Convert.ToHex(this.valueBeforeDecodeView)}}}LocalBaseBlock.NAME="baseBlock";class ValueBlock extends LocalBaseBlock{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}ValueBlock.NAME="valueBlock";class LocalIdentificationBlock extends HexBlock(LocalBaseBlock){constructor({idBlock:e={}}={}){var t,n,a,o;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?BufferSourceConverter.toUint8Array(e.valueHex):EMPTY_VIEW,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(a=e.tagNumber)!==null&&a!==void 0?a:-1,this.isConstructed=(o=e.isConstructed)!==null&&o!==void 0?o:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",EMPTY_BUFFER$1}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const a=new Uint8Array(1);if(!e){let o=this.tagNumber;o&=31,t|=o,a[0]=t}return a.buffer}if(!this.isHexOnly){const a=utilToBase(this.tagNumber,7),o=new Uint8Array(a),c=a.byteLength,u=new Uint8Array(c+1);if(u[0]=t|31,!e){for(let v=0;v<c-1;v++)u[v+1]=o[v]|128;u[c]=o[c-1]}return u.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const a=this.valueHexView;for(let o=0;o<a.length-1;o++)n[o+1]=a[o]|128;n[this.valueHexView.byteLength]=a[a.length-1]}return n.buffer}fromBER(e,t,n){const a=BufferSourceConverter.toUint8Array(e);if(!checkBufferParams(this,a,t,n))return-1;const o=a.subarray(t,t+n);if(o.length===0)return this.error="Zero buffer length",-1;switch(o[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(o[0]&32)===32,this.isHexOnly=!1;const u=o[0]&31;if(u!==31)this.tagNumber=u,this.blockLength=1;else{let v=1,_=this.valueHexView=new Uint8Array(255),x=255;for(;o[v]&128;){if(_[v-1]=o[v]&127,v++,v>=o.length)return this.error="End of input reached before message was fully decoded",-1;if(v===x){x+=255;const M=new Uint8Array(x);for(let C=0;C<_.length;C++)M[C]=_[C];_=this.valueHexView=new Uint8Array(x)}}this.blockLength=v+1,_[v-1]=o[v]&127;const E=new Uint8Array(v);for(let M=0;M<v;M++)E[M]=_[M];_=this.valueHexView=new Uint8Array(v),_.set(E),this.blockLength<=9?this.tagNumber=utilFromBase(_,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}LocalIdentificationBlock.NAME="identificationBlock";class LocalLengthBlock extends LocalBaseBlock{constructor({lenBlock:e={}}={}){var t,n,a;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(a=e.length)!==null&&a!==void 0?a:0}fromBER(e,t,n){const a=BufferSourceConverter.toUint8Array(e);if(!checkBufferParams(this,a,t,n))return-1;const o=a.subarray(t,t+n);if(o.length===0)return this.error="Zero buffer length",-1;if(o[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=o[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(o[0]&128),this.longFormUsed===!1)return this.length=o[0],this.blockLength=1,t+this.blockLength;const c=o[0]&127;if(c>8)return this.error="Too big integer",-1;if(c+1>o.length)return this.error="End of input reached before message was fully decoded",-1;const u=t+1,v=a.subarray(u,u+c);return v[c-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=utilFromBase(v,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=c+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const a=utilToBase(this.length,8);if(a.byteLength>127)return this.error="Too big length",EMPTY_BUFFER$1;if(t=new ArrayBuffer(a.byteLength+1),e)return t;const o=new Uint8Array(a);n=new Uint8Array(t),n[0]=a.byteLength|128;for(let c=0;c<a.byteLength;c++)n[c+1]=o[c];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}LocalLengthBlock.NAME="lengthBlock";const typeStore={};class BaseBlock extends LocalBaseBlock{constructor({name:e=EMPTY_STRING,optional:t=!1,primitiveSchema:n,...a}={},o){super(a),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new LocalIdentificationBlock(a),this.lenBlock=new LocalLengthBlock(a),this.valueBlock=o?new o(a):new ValueBlock(a)}fromBER(e,t,n){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}toBER(e,t){const n=t||new ViewWriter;t||prepareIndefiniteForm(this);const a=this.idBlock.toBER(e);if(n.write(a),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const o=this.valueBlock.toBER(e);this.lenBlock.length=o.byteLength;const c=this.lenBlock.toBER(e);n.write(c),n.write(o)}return t?EMPTY_BUFFER$1:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Convert.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${Convert.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return isEqualBuffer(t,n)}}BaseBlock.NAME="BaseBlock";function prepareIndefiniteForm(r){if(r instanceof typeStore.Constructed)for(const e of r.valueBlock.value)prepareIndefiniteForm(e)&&(r.lenBlock.isIndefiniteForm=!0);return!!r.lenBlock.isIndefiniteForm}class BaseStringBlock extends BaseBlock{constructor({value:e=EMPTY_STRING,...t}={},n){super(t,n),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,n){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}BaseStringBlock.NAME="BaseStringBlock";class LocalPrimitiveValueBlock extends HexBlock(ValueBlock){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}LocalPrimitiveValueBlock.NAME="PrimitiveValueBlock";var _a$w;class Primitive extends BaseBlock{constructor(e={}){super(e,LocalPrimitiveValueBlock),this.idBlock.isConstructed=!1}}_a$w=Primitive;typeStore.Primitive=_a$w;Primitive.NAME="PRIMITIVE";function localChangeType(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function localFromBER(r,e=0,t=r.length){const n=e;let a=new BaseBlock({},ValueBlock);const o=new LocalBaseBlock;if(!checkBufferParams(o,r,e,t))return a.error=o.error,{offset:-1,result:a};if(!r.subarray(e,e+t).length)return a.error="Zero buffer length",{offset:-1,result:a};let u=a.idBlock.fromBER(r,e,t);if(a.idBlock.warnings.length&&a.warnings.concat(a.idBlock.warnings),u===-1)return a.error=a.idBlock.error,{offset:-1,result:a};if(e=u,t-=a.idBlock.blockLength,u=a.lenBlock.fromBER(r,e,t),a.lenBlock.warnings.length&&a.warnings.concat(a.lenBlock.warnings),u===-1)return a.error=a.lenBlock.error,{offset:-1,result:a};if(e=u,t-=a.lenBlock.blockLength,!a.idBlock.isConstructed&&a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};let v=BaseBlock;switch(a.idBlock.tagClass){case 1:if(a.idBlock.tagNumber>=37&&a.idBlock.isHexOnly===!1)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};v=typeStore.EndOfContent;break;case 1:v=typeStore.Boolean;break;case 2:v=typeStore.Integer;break;case 3:v=typeStore.BitString;break;case 4:v=typeStore.OctetString;break;case 5:v=typeStore.Null;break;case 6:v=typeStore.ObjectIdentifier;break;case 10:v=typeStore.Enumerated;break;case 12:v=typeStore.Utf8String;break;case 13:v=typeStore.RelativeObjectIdentifier;break;case 14:v=typeStore.TIME;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:v=typeStore.Sequence;break;case 17:v=typeStore.Set;break;case 18:v=typeStore.NumericString;break;case 19:v=typeStore.PrintableString;break;case 20:v=typeStore.TeletexString;break;case 21:v=typeStore.VideotexString;break;case 22:v=typeStore.IA5String;break;case 23:v=typeStore.UTCTime;break;case 24:v=typeStore.GeneralizedTime;break;case 25:v=typeStore.GraphicString;break;case 26:v=typeStore.VisibleString;break;case 27:v=typeStore.GeneralString;break;case 28:v=typeStore.UniversalString;break;case 29:v=typeStore.CharacterString;break;case 30:v=typeStore.BmpString;break;case 31:v=typeStore.DATE;break;case 32:v=typeStore.TimeOfDay;break;case 33:v=typeStore.DateTime;break;case 34:v=typeStore.Duration;break;default:{const _=a.idBlock.isConstructed?new typeStore.Constructed:new typeStore.Primitive;_.idBlock=a.idBlock,_.lenBlock=a.lenBlock,_.warnings=a.warnings,a=_}}break;case 2:case 3:case 4:default:v=a.idBlock.isConstructed?typeStore.Constructed:typeStore.Primitive}return a=localChangeType(a,v),u=a.fromBER(r,e,a.lenBlock.isIndefiniteForm?t:a.lenBlock.length),a.valueBeforeDecodeView=r.subarray(n,n+a.blockLength),{offset:u,result:a}}function fromBER(r){if(!r.byteLength){const e=new BaseBlock({},ValueBlock);return e.error="Input buffer has zero length",{offset:-1,result:e}}return localFromBER(BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}function checkLen(r,e){return r?1:e}class LocalConstructedValueBlock extends ValueBlock{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const a=BufferSourceConverter.toUint8Array(e);if(!checkBufferParams(this,a,t,n))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let o=t;for(;checkLen(this.isIndefiniteForm,n)>0;){const c=localFromBER(a,o,n);if(c.offset===-1)return this.error=c.result.error,this.warnings.concat(c.result.warnings),-1;if(o=c.offset,this.blockLength+=c.result.blockLength,n-=c.result.blockLength,this.value.push(c.result),this.isIndefiniteForm&&c.result.constructor.NAME===END_OF_CONTENT_NAME)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===END_OF_CONTENT_NAME?this.value.pop():this.warnings.push("No EndOfContent block encoded")),o}toBER(e,t){const n=t||new ViewWriter;for(let a=0;a<this.value.length;a++)this.value[a].toBER(e,n);return t?EMPTY_BUFFER$1:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}LocalConstructedValueBlock.NAME="ConstructedValueBlock";var _a$v;class Constructed extends BaseBlock{constructor(e={}){super(e,LocalConstructedValueBlock),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(a=>`  ${a}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}_a$v=Constructed;typeStore.Constructed=_a$v;Constructed.NAME="CONSTRUCTED";class LocalEndOfContentValueBlock extends ValueBlock{fromBER(e,t,n){return t}toBER(e){return EMPTY_BUFFER$1}}LocalEndOfContentValueBlock.override="EndOfContentValueBlock";var _a$u;class EndOfContent extends BaseBlock{constructor(e={}){super(e,LocalEndOfContentValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}_a$u=EndOfContent;typeStore.EndOfContent=_a$u;EndOfContent.NAME=END_OF_CONTENT_NAME;var _a$t;class Null extends BaseBlock{constructor(e={}){super(e,ValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const a=new Uint8Array(n);a[0]=5,a[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}_a$t=Null;typeStore.Null=_a$t;Null.NAME="NULL";class LocalBooleanValueBlock extends HexBlock(ValueBlock){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=BufferSourceConverter.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,n){const a=BufferSourceConverter.toUint8Array(e);return checkBufferParams(this,a,t,n)?(this.valueHexView=a.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,utilDecodeTC.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}LocalBooleanValueBlock.NAME="BooleanValueBlock";var _a$s;let Boolean$1=class extends BaseBlock{constructor(e={}){super(e,LocalBooleanValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};_a$s=Boolean$1;typeStore.Boolean=_a$s;Boolean$1.NAME="BOOLEAN";class LocalOctetStringValueBlock extends HexBlock(LocalConstructedValueBlock){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let a=0;if(this.isConstructed){if(this.isHexOnly=!1,a=LocalConstructedValueBlock.prototype.fromBER.call(this,e,t,n),a===-1)return a;for(let o=0;o<this.value.length;o++){const c=this.value[o].constructor.NAME;if(c===END_OF_CONTENT_NAME){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(c!==OCTET_STRING_NAME)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=super.fromBER(e,t,n),this.blockLength=n;return a}toBER(e,t){return this.isConstructed?LocalConstructedValueBlock.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}LocalOctetStringValueBlock.NAME="OctetStringValueBlock";var _a$r;class OctetString extends BaseBlock{constructor({idBlock:e={},lenBlock:t={},...n}={}){var a,o;(a=n.isConstructed)!==null&&a!==void 0||(n.isConstructed=!!(!((o=n.value)===null||o===void 0)&&o.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},LocalOctetStringValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const o=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(o.byteLength){const c=localFromBER(o,0,o.byteLength);c.offset!==-1&&c.offset===n&&(this.valueBlock.value=[c.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Constructed.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${Convert.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof OctetString&&e.push(t.valueBlock.valueHexView);return BufferSourceConverter.concat(e)}}_a$r=OctetString;typeStore.OctetString=_a$r;OctetString.NAME=OCTET_STRING_NAME;class LocalBitStringValueBlock extends HexBlock(LocalConstructedValueBlock){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let a=-1;if(this.isConstructed){if(a=LocalConstructedValueBlock.prototype.fromBER.call(this,e,t,n),a===-1)return a;for(const u of this.value){const v=u.constructor.NAME;if(v===END_OF_CONTENT_NAME){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(v!==BIT_STRING_NAME)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const _=u.valueBlock;if(this.unusedBits>0&&_.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=_.unusedBits}return a}const o=BufferSourceConverter.toUint8Array(e);if(!checkBufferParams(this,o,t,n))return-1;const c=o.subarray(t,t+n);if(this.unusedBits=c[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const u=c.subarray(1);try{if(u.byteLength){const v=localFromBER(u,0,u.byteLength);v.offset!==-1&&v.offset===n-1&&(this.value=[v.result])}}catch{}}return this.valueHexView=c.subarray(1),this.blockLength=c.length,t+n}toBER(e,t){if(this.isConstructed)return LocalConstructedValueBlock.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return EMPTY_BUFFER$1;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}LocalBitStringValueBlock.NAME="BitStringValueBlock";var _a$q;class BitString extends BaseBlock{constructor({idBlock:e={},lenBlock:t={},...n}={}){var a,o;(a=n.isConstructed)!==null&&a!==void 0||(n.isConstructed=!!(!((o=n.value)===null||o===void 0)&&o.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},LocalBitStringValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Constructed.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const a of t)e.push(a.toString(2).padStart(8,"0"));const n=e.join("");return`${this.constructor.NAME} : ${n.substring(0,n.length-this.valueBlock.unusedBits)}`}}}_a$q=BitString;typeStore.BitString=_a$q;BitString.NAME=BIT_STRING_NAME;var _a$p;function viewAdd(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),a=new Uint8Array(e);let o=n.slice(0);const c=o.length-1,u=a.slice(0),v=u.length-1;let _=0;const x=v<c?c:v;let E=0;for(let M=x;M>=0;M--,E++){switch(!0){case E<u.length:_=o[c-E]+u[v-E]+t[0];break;default:_=o[c-E]+t[0]}switch(t[0]=_/10,!0){case E>=o.length:o=utilConcatView(new Uint8Array([_%10]),o);break;default:o[c-E]=_%10}}return t[0]>0&&(o=utilConcatView(t,o)),o}function power2(r){if(r>=powers2.length)for(let e=powers2.length;e<=r;e++){const t=new Uint8Array([0]);let n=powers2[e-1].slice(0);for(let a=n.length-1;a>=0;a--){const o=new Uint8Array([(n[a]<<1)+t[0]]);t[0]=o[0]/10,n[a]=o[0]%10}t[0]>0&&(n=utilConcatView(t,n)),powers2.push(n)}return powers2[r]}function viewSub(r,e){let t=0;const n=new Uint8Array(r),a=new Uint8Array(e),o=n.slice(0),c=o.length-1,u=a.slice(0),v=u.length-1;let _,x=0;for(let E=v;E>=0;E--,x++)switch(_=o[c-x]-u[v-x]-t,!0){case _<0:t=1,o[c-x]=_+10;break;default:t=0,o[c-x]=_}if(t>0)for(let E=c-v+1;E>=0;E--,x++)if(_=o[c-x]-t,_<0)t=1,o[c-x]=_+10;else{t=0,o[c-x]=_;break}return o.slice()}class LocalIntegerValueBlock extends HexBlock(ValueBlock){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=utilDecodeTC.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(utilEncodeTC(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,a=0){const o=this.fromBER(e,t,n);if(o===-1)return o;const c=this.valueHexView;return c[0]===0&&c[1]&128?this.valueHexView=c.subarray(1):a!==0&&c.length<a&&(a-c.length>1&&(a=c.length+1),this.valueHexView=c.subarray(a-c.length)),o}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const a=super.fromBER(e,t,n);return a===-1||this.setValueHex(),a}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,a;const o=this.valueHexView;let c="",u=!1;for(let v=o.byteLength-1;v>=0;v--){a=o[v];for(let _=0;_<8;_++){if((a&1)===1)switch(n){case e:t=viewSub(power2(n),t),c="-";break;default:t=viewAdd(t,power2(n))}n++,a>>=1}}for(let v=0;v<t.length;v++)t[v]&&(u=!0),u&&(c+=digitsString.charAt(t[v]));return u===!1&&(c+=digitsString.charAt(0)),c}}_a$p=LocalIntegerValueBlock;LocalIntegerValueBlock.NAME="IntegerValueBlock";Object.defineProperty(_a$p.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var _a$o;class Integer extends BaseBlock{constructor(e={}){super(e,LocalIntegerValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return assertBigInt(),BigInt(this.valueBlock.toString())}static fromBigInt(e){assertBigInt();const t=BigInt(e),n=new ViewWriter,a=t.toString(16).replace(/^-/,""),o=new Uint8Array(Convert.FromHex(a));if(t<0){const u=new Uint8Array(o.length+(o[0]&128?1:0));u[0]|=128;const _=BigInt(`0x${Convert.ToHex(u)}`)+t,x=BufferSourceConverter.toUint8Array(Convert.FromHex(_.toString(16)));x[0]|=128,n.write(x)}else o[0]&128&&n.write(new Uint8Array([0])),n.write(o);return new Integer({valueHex:n.final()})}convertToDER(){const e=new Integer({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Integer({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}_a$o=Integer;typeStore.Integer=_a$o;Integer.NAME="INTEGER";var _a$n;class Enumerated extends Integer{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}_a$n=Enumerated;typeStore.Enumerated=_a$n;Enumerated.NAME="ENUMERATED";class LocalSidValueBlock extends HexBlock(ValueBlock){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const a=BufferSourceConverter.toUint8Array(e);if(!checkBufferParams(this,a,t,n))return-1;const o=a.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let u=0;u<n&&(this.valueHexView[u]=o[u]&127,this.blockLength++,!!(o[u]&128));u++);const c=new Uint8Array(this.blockLength);for(let u=0;u<this.blockLength;u++)c[u]=this.valueHexView[u];return this.valueHexView=c,o[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){assertBigInt();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let a=0;a<n.length;a++)n[a]=parseInt(t.slice(a*7,a*7+7),2)+(a+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,o=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength-1;c++)o[c]=a[c]|128;return o[this.blockLength-1]=a[this.blockLength-1],o.buffer}const t=utilToBase(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",EMPTY_BUFFER$1;const n=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),o=t.byteLength-1;for(let c=0;c<o;c++)n[c]=a[c]|128;n[o]=a[o]}return n}toString(){let e="";if(this.isHexOnly)e=Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}LocalSidValueBlock.NAME="sidBlock";class LocalObjectIdentifierValueBlock extends ValueBlock{constructor({value:e=EMPTY_STRING,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let a=t;for(;n>0;){const o=new LocalSidValueBlock;if(a=o.fromBER(e,a,n),a===-1)return this.blockLength=0,this.error=o.error,a;this.value.length===0&&(o.isFirstSid=!0),this.blockLength+=o.blockLength,n-=o.blockLength,this.value.push(o)}return a}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const a=this.value[n].toBER(e);if(a.byteLength===0)return this.error=this.value[n].error,EMPTY_BUFFER$1;t.push(a)}return concat(t)}fromString(e){this.value=[];let t=0,n=0,a="",o=!1;do if(n=e.indexOf(".",t),n===-1?a=e.substring(t):a=e.substring(t,n),t=n+1,o){const c=this.value[0];let u=0;switch(c.valueDec){case 0:break;case 1:u=40;break;case 2:u=80;break;default:this.value=[];return}const v=parseInt(a,10);if(isNaN(v))return;c.valueDec=v+u,o=!1}else{const c=new LocalSidValueBlock;if(a>Number.MAX_SAFE_INTEGER){assertBigInt();const u=BigInt(a);c.valueBigInt=u}else if(c.valueDec=parseInt(a,10),isNaN(c.valueDec))return;this.value.length||(c.isFirstSid=!0,o=!0),this.value.push(c)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let a=this.value[n].toString();n!==0&&(e=`${e}.`),t?(a=`{${a}}`,this.value[n].isFirstSid?e=`2.{${a} - 80}`:e+=a):e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}LocalObjectIdentifierValueBlock.NAME="ObjectIdentifierValueBlock";var _a$m;class ObjectIdentifier extends BaseBlock{constructor(e={}){super(e,LocalObjectIdentifierValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}_a$m=ObjectIdentifier;typeStore.ObjectIdentifier=_a$m;ObjectIdentifier.NAME="OBJECT IDENTIFIER";class LocalRelativeSidValueBlock extends HexBlock(LocalBaseBlock){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const a=BufferSourceConverter.toUint8Array(e);if(!checkBufferParams(this,a,t,n))return-1;const o=a.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let u=0;u<n&&(this.valueHexView[u]=o[u]&127,this.blockLength++,!!(o[u]&128));u++);const c=new Uint8Array(this.blockLength);for(let u=0;u<this.blockLength;u++)c[u]=this.valueHexView[u];return this.valueHexView=c,o[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,o=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength-1;c++)o[c]=a[c]|128;return o[this.blockLength-1]=a[this.blockLength-1],o.buffer}const t=utilToBase(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",EMPTY_BUFFER$1;const n=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),o=t.byteLength-1;for(let c=0;c<o;c++)n[c]=a[c]|128;n[o]=a[o]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}LocalRelativeSidValueBlock.NAME="relativeSidBlock";class LocalRelativeObjectIdentifierValueBlock extends ValueBlock{constructor({value:e=EMPTY_STRING,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let a=t;for(;n>0;){const o=new LocalRelativeSidValueBlock;if(a=o.fromBER(e,a,n),a===-1)return this.blockLength=0,this.error=o.error,a;this.blockLength+=o.blockLength,n-=o.blockLength,this.value.push(o)}return a}toBER(e,t){const n=[];for(let a=0;a<this.value.length;a++){const o=this.value[a].toBER(e);if(o.byteLength===0)return this.error=this.value[a].error,EMPTY_BUFFER$1;n.push(o)}return concat(n)}fromString(e){this.value=[];let t=0,n=0,a="";do{n=e.indexOf(".",t),n===-1?a=e.substring(t):a=e.substring(t,n),t=n+1;const o=new LocalRelativeSidValueBlock;if(o.valueDec=parseInt(a,10),isNaN(o.valueDec))return!0;this.value.push(o)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let a=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(a=`{${a}}`),e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}LocalRelativeObjectIdentifierValueBlock.NAME="RelativeObjectIdentifierValueBlock";var _a$l;class RelativeObjectIdentifier extends BaseBlock{constructor(e={}){super(e,LocalRelativeObjectIdentifierValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}_a$l=RelativeObjectIdentifier;typeStore.RelativeObjectIdentifier=_a$l;RelativeObjectIdentifier.NAME="RelativeObjectIdentifier";var _a$k;class Sequence extends Constructed{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}_a$k=Sequence;typeStore.Sequence=_a$k;Sequence.NAME="SEQUENCE";var _a$j;let Set$1=class extends Constructed{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};_a$j=Set$1;typeStore.Set=_a$j;Set$1.NAME="SET";class LocalStringValueBlock extends HexBlock(ValueBlock){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=EMPTY_STRING}toJSON(){return{...super.toJSON(),value:this.value}}}LocalStringValueBlock.NAME="StringValueBlock";class LocalSimpleStringValueBlock extends LocalStringValueBlock{}LocalSimpleStringValueBlock.NAME="SimpleStringValueBlock";class LocalSimpleStringBlock extends BaseStringBlock{constructor({...e}={}){super(e,LocalSimpleStringValueBlock)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,BufferSourceConverter.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=e.charCodeAt(a);this.valueBlock.value=e}}LocalSimpleStringBlock.NAME="SIMPLE STRING";class LocalUtf8StringValueBlock extends LocalSimpleStringBlock{fromBuffer(e){this.valueBlock.valueHexView=BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=Convert.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Convert.FromUtf8String(e)),this.valueBlock.value=e}}LocalUtf8StringValueBlock.NAME="Utf8StringValueBlock";var _a$i;class Utf8String extends LocalUtf8StringValueBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}_a$i=Utf8String;typeStore.Utf8String=_a$i;Utf8String.NAME="UTF8String";class LocalBmpStringValueBlock extends LocalSimpleStringBlock{fromBuffer(e){this.valueBlock.value=Convert.ToUtf16String(e),this.valueBlock.valueHexView=BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Convert.FromUtf16String(e))}}LocalBmpStringValueBlock.NAME="BmpStringValueBlock";var _a$h;class BmpString extends LocalBmpStringValueBlock{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}_a$h=BmpString;typeStore.BmpString=_a$h;BmpString.NAME="BMPString";class LocalUniversalStringValueBlock extends LocalSimpleStringBlock{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let a=0;a<n.length;a+=4)n[a]=n[a+3],n[a+1]=n[a+2],n[a+2]=0,n[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let a=0;a<t;a++){const o=utilToBase(e.charCodeAt(a),8),c=new Uint8Array(o);if(c.length>4)continue;const u=4-c.length;for(let v=c.length-1;v>=0;v--)n[a*4+v+u]=c[v]}this.valueBlock.value=e}}LocalUniversalStringValueBlock.NAME="UniversalStringValueBlock";var _a$g;class UniversalString extends LocalUniversalStringValueBlock{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}_a$g=UniversalString;typeStore.UniversalString=_a$g;UniversalString.NAME="UniversalString";var _a$f;class NumericString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}_a$f=NumericString;typeStore.NumericString=_a$f;NumericString.NAME="NumericString";var _a$e;class PrintableString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}_a$e=PrintableString;typeStore.PrintableString=_a$e;PrintableString.NAME="PrintableString";var _a$d;class TeletexString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}_a$d=TeletexString;typeStore.TeletexString=_a$d;TeletexString.NAME="TeletexString";var _a$c;class VideotexString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}_a$c=VideotexString;typeStore.VideotexString=_a$c;VideotexString.NAME="VideotexString";var _a$b;class IA5String extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}_a$b=IA5String;typeStore.IA5String=_a$b;IA5String.NAME="IA5String";var _a$a;class GraphicString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}_a$a=GraphicString;typeStore.GraphicString=_a$a;GraphicString.NAME="GraphicString";var _a$9;class VisibleString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}_a$9=VisibleString;typeStore.VisibleString=_a$9;VisibleString.NAME="VisibleString";var _a$8;class GeneralString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}_a$8=GeneralString;typeStore.GeneralString=_a$8;GeneralString.NAME="GeneralString";var _a$7;class CharacterString extends LocalSimpleStringBlock{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}_a$7=CharacterString;typeStore.CharacterString=_a$7;CharacterString.NAME="CharacterString";var _a$6;class UTCTime extends VisibleString{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let a=0;a<e.length;a++)this.valueBlock.valueHexView[a]=e.charCodeAt(a)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,BufferSourceConverter.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let a=0;a<e.length;a++)n[a]=e.charCodeAt(a);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const a=parseInt(n[1],10);a>=50?this.year=1900+a:this.year=2e3+a,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=padNumber(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=padNumber(this.month,2),t[2]=padNumber(this.day,2),t[3]=padNumber(this.hour,2),t[4]=padNumber(this.minute,2),t[5]=padNumber(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}_a$6=UTCTime;typeStore.UTCTime=_a$6;UTCTime.NAME="UTCTime";var _a$5;class GeneralizedTime extends UTCTime{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t=!1,n="",a="",o=0,c,u=0,v=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const E=new Number(e[e.length-1]);if(isNaN(E.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let E=1,M=n.indexOf("+"),C="";if(M===-1&&(M=n.indexOf("-"),E=-1),M!==-1){if(C=n.substring(M+1),n=n.substring(0,M),C.length!==2&&C.length!==4)throw new Error("Wrong input string for conversion");let I=parseInt(C.substring(0,2),10);if(isNaN(I.valueOf()))throw new Error("Wrong input string for conversion");if(u=E*I,C.length===4){if(I=parseInt(C.substring(2,4),10),isNaN(I.valueOf()))throw new Error("Wrong input string for conversion");v=E*I}}}let _=n.indexOf(".");if(_===-1&&(_=n.indexOf(",")),_!==-1){const E=new Number(`0${n.substring(_)}`);if(isNaN(E.valueOf()))throw new Error("Wrong input string for conversion");o=E.valueOf(),a=n.substring(0,_)}else a=n;switch(!0){case a.length===8:if(c=/(\d{4})(\d{2})(\d{2})/ig,_!==-1)throw new Error("Wrong input string for conversion");break;case a.length===10:if(c=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,_!==-1){let E=60*o;this.minute=Math.floor(E),E=60*(E-this.minute),this.second=Math.floor(E),E=1e3*(E-this.second),this.millisecond=Math.floor(E)}break;case a.length===12:if(c=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,_!==-1){let E=60*o;this.second=Math.floor(E),E=1e3*(E-this.second),this.millisecond=Math.floor(E)}break;case a.length===14:if(c=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,_!==-1){const E=1e3*o;this.millisecond=Math.floor(E)}break;default:throw new Error("Wrong input string for conversion")}const x=c.exec(a);if(x===null)throw new Error("Wrong input string for conversion");for(let E=1;E<x.length;E++)switch(E){case 1:this.year=parseInt(x[E],10);break;case 2:this.month=parseInt(x[E],10);break;case 3:this.day=parseInt(x[E],10);break;case 4:this.hour=parseInt(x[E],10)+u;break;case 5:this.minute=parseInt(x[E],10)+v;break;case 6:this.second=parseInt(x[E],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const E=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=E.getUTCFullYear(),this.month=E.getUTCMonth(),this.day=E.getUTCDay(),this.hour=E.getUTCHours(),this.minute=E.getUTCMinutes(),this.second=E.getUTCSeconds(),this.millisecond=E.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(padNumber(this.year,4)),t.push(padNumber(this.month,2)),t.push(padNumber(this.day,2)),t.push(padNumber(this.hour,2)),t.push(padNumber(this.minute,2)),t.push(padNumber(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(padNumber(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}_a$5=GeneralizedTime;typeStore.GeneralizedTime=_a$5;GeneralizedTime.NAME="GeneralizedTime";var _a$4;class DATE extends Utf8String{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}_a$4=DATE;typeStore.DATE=_a$4;DATE.NAME="DATE";var _a$3;class TimeOfDay extends Utf8String{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}_a$3=TimeOfDay;typeStore.TimeOfDay=_a$3;TimeOfDay.NAME="TimeOfDay";var _a$2;class DateTime extends Utf8String{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}_a$2=DateTime;typeStore.DateTime=_a$2;DateTime.NAME="DateTime";var _a$1;class Duration extends Utf8String{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}_a$1=Duration;typeStore.Duration=_a$1;Duration.NAME="Duration";var _a;class TIME extends Utf8String{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}_a=TIME;typeStore.TIME=_a;TIME.NAME="TIME";function randomBytes(r){if(isNaN(r)||r<=0)throw new InvalidParametersError("random bytes length must be a Number bigger than 0");return randomBytes$1(r)}class VerificationError extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class WebCryptoMissingError extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const webcrypto={get(r=globalThis){const e=r.crypto;if(e?.subtle==null)throw new WebCryptoMissingError("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};async function hashAndVerify$1(r,e,t){const n=await webcrypto.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}function rsaKeySize(r){if(r.kty!=="RSA")throw new InvalidParametersError("invalid key type");if(r.n==null)throw new InvalidParametersError("invalid key modulus");return fromString(r.n,"base64url").length*8}class RSAPublicKey{type="RSA";_key;_raw;_multihash;constructor(e,t){this._key=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=jwkToPkix(this._key)),this._raw}toMultihash(){return this._multihash}toCID(){return CID.createV1(114,this._multihash)}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:equals(this.raw,e.raw)}verify(e,t){return hashAndVerify$1(this._key,t,e)}}const MAX_RSA_KEY_SIZE=8192,SHA2_256_CODE=18;function pkixToJwk(r){const{result:e}=fromBER(r),t=e.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:asn1jsIntegerToBase64(t[0]),e:asn1jsIntegerToBase64(t[1])}}function jwkToPkix(r){if(r.n==null||r.e==null)throw new InvalidParametersError("JWK was missing components");const t=new Sequence({value:[new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.1.1"}),new Null]}),new BitString({valueHex:new Sequence({value:[Integer.fromBigInt(bufToBn(fromString(r.n,"base64url"))),Integer.fromBigInt(bufToBn(fromString(r.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(t,0,t.byteLength)}function asn1jsIntegerToBase64(r){let e=r.valueBlock.valueHexView;for(;e[0]===0;)e=e.subarray(1);return toString$1(e,"base64url")}function bufToBn(r){const e=[];return r.forEach(function(t){let n=t.toString(16);n.length%2>0&&(n=`0${n}`),e.push(n)}),BigInt("0x"+e.join(""))}function pkixToRSAPublicKey(r){const e=pkixToJwk(r);if(rsaKeySize(e)>MAX_RSA_KEY_SIZE)throw new InvalidPublicKeyError("Key size is too large");const t=sha256$4(PublicKey.encode({Type:KeyType.RSA,Data:r})),n=create(SHA2_256_CODE,t);return new RSAPublicKey(e,n)}function isPromise$2(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function hashAndVerify(r,e,t){const n=sha256$2.digest(t instanceof Uint8Array?t:t.subarray());if(isPromise$2(n))return n.then(({digest:a})=>secp256k1$2.verify(e,a,r)).catch(a=>{throw new VerificationError(String(a))});try{return secp256k1$2.verify(e,n.digest,r)}catch(a){throw new VerificationError(String(a))}}class Secp256k1PublicKey{type="secp256k1";raw;_key;constructor(e){this._key=validateSecp256k1PublicKey(e),this.raw=compressSecp256k1PublicKey(this._key)}toMultihash(){return identity$2.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:equals(this.raw,e.raw)}verify(e,t){return hashAndVerify(this._key,t,e)}}function unmarshalSecp256k1PublicKey(r){return new Secp256k1PublicKey(r)}function compressSecp256k1PublicKey(r){return secp256k1$2.ProjectivePoint.fromHex(r).toRawBytes(!0)}function validateSecp256k1PublicKey(r){try{return secp256k1$2.ProjectivePoint.fromHex(r),r}catch(e){throw new InvalidPublicKeyError(String(e))}}async function generateKeyPair(r,e){return generateEd25519KeyPair()}function publicKeyFromProtobuf(r){const{Type:e,Data:t}=PublicKey.decode(r),n=t??new Uint8Array;switch(e){case KeyType.RSA:return pkixToRSAPublicKey(n);case KeyType.Ed25519:return unmarshalEd25519PublicKey(n);case KeyType.secp256k1:return unmarshalSecp256k1PublicKey(n);default:throw new UnsupportedKeyTypeError}}function publicKeyFromMultihash(r){const{Type:e,Data:t}=PublicKey.decode(r.digest),n=t??new Uint8Array;switch(e){case KeyType.Ed25519:return unmarshalEd25519PublicKey(n);case KeyType.secp256k1:return unmarshalSecp256k1PublicKey(n);default:throw new UnsupportedKeyTypeError}}function publicKeyToProtobuf(r){return PublicKey.encode({Type:KeyType[r.type],Data:r.raw})}const inspect$1=Symbol.for("nodejs.util.inspect.custom"),LIBP2P_KEY_CODE$1=114;class PeerIdImpl{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[peerIdSymbol]=!0;toString(){return this.string==null&&(this.string=base58btc.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return CID.createV1(LIBP2P_KEY_CODE$1,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return equals(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return equals(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[inspect$1](){return`PeerId(${this.toString()})`}}class RSAPeerId extends PeerIdImpl{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Ed25519PeerId extends PeerIdImpl{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}}class Secp256k1PeerId extends PeerIdImpl{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}}const TRANSPORT_IPFS_GATEWAY_HTTP_CODE$1=2336;class URLPeerId{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=identity$2.digest(fromString(this.url))}[inspect$1](){return`PeerId(${this.url})`}[peerIdSymbol]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return CID.createV1(TRANSPORT_IPFS_GATEWAY_HTTP_CODE$1,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=toString$1(e)),e.toString()===this.toString())}}const LIBP2P_KEY_CODE=114,TRANSPORT_IPFS_GATEWAY_HTTP_CODE=2336;function peerIdFromString$1(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=decode$8(base58btc.decode(`z${r}`));else throw new InvalidParametersError('Please pass a multibase decoder for strings that do not start with "1" or "Q"');return peerIdFromMultihash(t)}function peerIdFromPublicKey(r){if(r.type==="Ed25519")return new Ed25519PeerId({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new Secp256k1PeerId({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new RSAPeerId({multihash:r.toCID().multihash,publicKey:r});throw new UnsupportedKeyTypeError}function peerIdFromPrivateKey(r){return peerIdFromPublicKey(r.publicKey)}function peerIdFromMultihash(r){if(isSha256Multihash(r))return new RSAPeerId({multihash:r});if(isIdentityMultihash(r))try{const e=publicKeyFromMultihash(r);if(e.type==="Ed25519")return new Ed25519PeerId({multihash:r,publicKey:e});if(e.type==="secp256k1")return new Secp256k1PeerId({multihash:r,publicKey:e})}catch{const t=toString$1(r.digest);return new URLPeerId(new URL(t))}throw new InvalidMultihashError("Supplied PeerID Multihash is invalid")}function peerIdFromCID(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==LIBP2P_KEY_CODE&&r.code!==TRANSPORT_IPFS_GATEWAY_HTTP_CODE)throw new InvalidCIDError("Supplied PeerID CID is invalid");if(r.code===TRANSPORT_IPFS_GATEWAY_HTTP_CODE){const e=toString$1(r.multihash.digest);return new URLPeerId(new URL(e))}return peerIdFromMultihash(r.multihash)}function isIdentityMultihash(r){return r.code===identity$2.code}function isSha256Multihash(r){return r.code===sha256$2.code}class CustomProgressEvent extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}var eventemitter3={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function a(v,_,x){this.fn=v,this.context=_,this.once=x||!1}function o(v,_,x,E,M){if(typeof x!="function")throw new TypeError("The listener must be a function");var C=new a(x,E||v,M),I=t?t+_:_;return v._events[I]?v._events[I].fn?v._events[I]=[v._events[I],C]:v._events[I].push(C):(v._events[I]=C,v._eventsCount++),v}function c(v,_){--v._eventsCount===0?v._events=new n:delete v._events[_]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var _=[],x,E;if(this._eventsCount===0)return _;for(E in x=this._events)e.call(x,E)&&_.push(t?E.slice(1):E);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(x)):_},u.prototype.listeners=function(_){var x=t?t+_:_,E=this._events[x];if(!E)return[];if(E.fn)return[E.fn];for(var M=0,C=E.length,I=new Array(C);M<C;M++)I[M]=E[M].fn;return I},u.prototype.listenerCount=function(_){var x=t?t+_:_,E=this._events[x];return E?E.fn?1:E.length:0},u.prototype.emit=function(_,x,E,M,C,I){var D=t?t+_:_;if(!this._events[D])return!1;var L=this._events[D],N=arguments.length,q,F;if(L.fn){switch(L.once&&this.removeListener(_,L.fn,void 0,!0),N){case 1:return L.fn.call(L.context),!0;case 2:return L.fn.call(L.context,x),!0;case 3:return L.fn.call(L.context,x,E),!0;case 4:return L.fn.call(L.context,x,E,M),!0;case 5:return L.fn.call(L.context,x,E,M,C),!0;case 6:return L.fn.call(L.context,x,E,M,C,I),!0}for(F=1,q=new Array(N-1);F<N;F++)q[F-1]=arguments[F];L.fn.apply(L.context,q)}else{var U=L.length,j;for(F=0;F<U;F++)switch(L[F].once&&this.removeListener(_,L[F].fn,void 0,!0),N){case 1:L[F].fn.call(L[F].context);break;case 2:L[F].fn.call(L[F].context,x);break;case 3:L[F].fn.call(L[F].context,x,E);break;case 4:L[F].fn.call(L[F].context,x,E,M);break;default:if(!q)for(j=1,q=new Array(N-1);j<N;j++)q[j-1]=arguments[j];L[F].fn.apply(L[F].context,q)}}return!0},u.prototype.on=function(_,x,E){return o(this,_,x,E,!1)},u.prototype.once=function(_,x,E){return o(this,_,x,E,!0)},u.prototype.removeListener=function(_,x,E,M){var C=t?t+_:_;if(!this._events[C])return this;if(!x)return c(this,C),this;var I=this._events[C];if(I.fn)I.fn===x&&(!M||I.once)&&(!E||I.context===E)&&c(this,C);else{for(var D=0,L=[],N=I.length;D<N;D++)(I[D].fn!==x||M&&!I[D].once||E&&I[D].context!==E)&&L.push(I[D]);L.length?this._events[C]=L.length===1?L[0]:L:c(this,C)}return this},u.prototype.removeAllListeners=function(_){var x;return _?(x=t?t+_:_,this._events[x]&&c(this,x)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,r.exports=u})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}let AbortError$5=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const getDOMException=r=>globalThis.DOMException===void 0?new AbortError$5(r):new DOMException(r),getAbortedReason=r=>{const e=r.reason===void 0?getDOMException("This operation was aborted."):r.reason;return e instanceof Error?e:getDOMException(e)};function pTimeout(r,e){const{milliseconds:t,fallback:n,message:a,customTimers:o={setTimeout,clearTimeout}}=e;let c,u;const _=new Promise((x,E)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:C}=e;C.aborted&&E(getAbortedReason(C)),u=()=>{E(getAbortedReason(C))},C.addEventListener("abort",u,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(x,E);return}const M=new TimeoutError;c=o.setTimeout.call(void 0,()=>{if(n){try{x(n())}catch(C){E(C)}return}typeof r.cancel=="function"&&r.cancel(),a===!1?x():a instanceof Error?E(a):(M.message=a??`Promise timed out after ${t} milliseconds`,E(M))},t),(async()=>{try{x(await r)}catch(C){E(C)}})()}).finally(()=>{_.clear(),u&&e.signal&&e.signal.removeEventListener("abort",u)});return _.clear=()=>{o.clearTimeout.call(void 0,c),c=void 0},_}function lowerBound(r,e,t){let n=0,a=r.length;for(;a>0;){const o=Math.trunc(a/2);let c=n+o;t(r[c],e)<=0?(n=++c,a-=o+1):a=o}return n}let PriorityQueue$1=class{#e=[];enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||this.#e[this.size-1].priority>=t.priority){this.#e.push(n);return}const a=lowerBound(this.#e,n,(o,c)=>c.priority-o.priority);this.#e.splice(a,0,n)}setPriority(e,t){const n=this.#e.findIndex(o=>o.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[a]=this.#e.splice(n,1);this.enqueue(a.run,{priority:t,id:e})}dequeue(){return this.#e.shift()?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this.#e.length}};class PQueue extends EventEmitter{#e;#t;#s=0;#a;#f;#p=0;#n;#l;#r;#g;#i=0;#c;#o;#m;#b=1n;timeout;constructor(e){if(super(),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue$1,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#e=e.carryoverConcurrencyCount,this.#t=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this.#a=e.intervalCap,this.#f=e.interval,this.#r=new e.queueClass,this.#g=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#m=e.throwOnTimeout===!0,this.#o=e.autoStart===!1}get#w(){return this.#t||this.#s<this.#a}get#_(){return this.#i<this.#c}#x(){this.#i--,this.#u(),this.emit("next")}#S(){this.#v(),this.#y(),this.#l=void 0}get#E(){const e=Date.now();if(this.#n===void 0){const t=this.#p-e;if(t<0)this.#s=this.#e?this.#i:0;else return this.#l===void 0&&(this.#l=setTimeout(()=>{this.#S()},t)),!0}return!1}#u(){if(this.#r.size===0)return this.#n&&clearInterval(this.#n),this.#n=void 0,this.emit("empty"),this.#i===0&&this.emit("idle"),!1;if(!this.#o){const e=!this.#E;if(this.#w&&this.#_){const t=this.#r.dequeue();return t?(this.emit("active"),t(),e&&this.#y(),!0):!1}}return!1}#y(){this.#t||this.#n!==void 0||(this.#n=setInterval(()=>{this.#v()},this.#f),this.#p=Date.now()+this.#f)}#v(){this.#s===0&&this.#i===0&&this.#n&&(clearInterval(this.#n),this.#n=void 0),this.#s=this.#e?this.#i:0,this.#h()}#h(){for(;this.#u(););}get concurrency(){return this.#c}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#c=e,this.#h()}async#M(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(e.reason)},{once:!0})})}setPriority(e,t){this.#r.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#b++).toString(),t={timeout:this.timeout,throwOnTimeout:this.#m,...t},new Promise((n,a)=>{this.#r.enqueue(async()=>{this.#i++,this.#s++;try{t.signal?.throwIfAborted();let o=e({signal:t.signal});t.timeout&&(o=pTimeout(Promise.resolve(o),{milliseconds:t.timeout})),t.signal&&(o=Promise.race([o,this.#M(t.signal)]));const c=await o;n(c),this.emit("completed",c)}catch(o){if(o instanceof TimeoutError&&!t.throwOnTimeout){n();return}a(o),this.emit("error",o)}finally{this.#x()}},t),this.emit("add"),this.#u()})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this.#o?(this.#o=!1,this.#h(),this):this}pause(){this.#o=!0}clear(){this.#r=new this.#g}async onEmpty(){this.#r.size!==0&&await this.#d("empty")}async onSizeLessThan(e){this.#r.size<e||await this.#d("next",()=>this.#r.size<e)}async onIdle(){this.#i===0&&this.#r.size===0||await this.#d("idle")}async#d(e,t){return new Promise(n=>{const a=()=>{t&&!t()||(this.off(e,a),n())};this.on(e,a)})}get size(){return this.#r.size}sizeBy(e){return this.#r.filter(e).length}get pending(){return this.#i}get isPaused(){return this.#o}}function getTypes(r){const e=[RecordType.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const DEFAULT_TTL=60;function toDNSResponse(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:RecordType[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:RecordType[e.type],TTL:e.TTL??e.ttl??DEFAULT_TTL,data:e.data instanceof Uint8Array?toString$1(e.data):e.data}))}}const DEFAULT_QUERY_CONCURRENCY=4;function dnsJsonOverHttps(r,e={}){const t=new PQueue({concurrency:e.queryConcurrency??DEFAULT_QUERY_CONCURRENCY});return async(n,a={})=>{const o=new URLSearchParams;o.set("name",n),getTypes(a.types).forEach(u=>{o.append("type",RecordType[u])}),a.onProgress?.(new CustomProgressEvent("dns:query",{detail:n}));const c=await t.add(async()=>{const u=await fetch(`${r}?${o}`,{headers:{accept:"application/dns-json"},signal:a?.signal});if(u.status!==200)throw new Error(`Unexpected HTTP status: ${u.status} - ${u.statusText}`);const v=toDNSResponse(await u.json());return a.onProgress?.(new CustomProgressEvent("dns:response",{detail:v})),v},{signal:a.signal});if(c==null)throw new Error("No DNS response received");return c}}function defaultResolver(){return[dnsJsonOverHttps("https://cloudflare-dns.com/dns-query"),dnsJsonOverHttps("https://dns.google/resolve")]}var hashlru=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function a(o,c){t[o]=c,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(o){return t[o]!==void 0||n[o]!==void 0},remove:function(o){t[o]!==void 0&&(t[o]=void 0),n[o]!==void 0&&(n[o]=void 0)},get:function(o){var c=t[o];if(c!==void 0)return c;if((c=n[o])!==void 0)return a(o,c),c},set:function(o,c){t[o]!==void 0?t[o]=c:a(o,c)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const hashlru$1=getDefaultExportFromCjs(hashlru);class CachedAnswers{lru;constructor(e){this.lru=hashlru$1(e)}get(e,t){let n=!0;const a=[];for(const o of t){const c=this.getAnswers(e,o);if(c.length===0){n=!1;break}a.push(...c)}if(n)return toDNSResponse({answers:a})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,a=this.lru.get(n);if(a!=null){const o=a.filter(c=>c.expires>Date.now()).map(({expires:c,value:u})=>({...u,TTL:Math.round((c-Date.now())/1e3),type:RecordType[u.type]}));return o.length===0&&this.lru.remove(n),o}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,a=this.lru.get(n)??[];a.push({expires:Date.now()+(t.TTL??DEFAULT_TTL)*1e3,value:t}),this.lru.set(n,a)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function cache(r){return new CachedAnswers(r)}const DEFAULT_ANSWER_CACHE_SIZE=1e3;let DNS$1=class{resolvers;cache;constructor(e){this.resolvers={},this.cache=cache(e.cacheSize??DEFAULT_ANSWER_CACHE_SIZE),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=defaultResolver())}async query(e,t={}){const n=getTypes(t.types),a=t.cached!==!1?this.cache.get(e,n):void 0;if(a!=null)return t.onProgress?.(new CustomProgressEvent("dns:cache",{detail:a})),a;const o=`${e.split(".").pop()}.`,c=(this.resolvers[o]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),u=[];for(const v of c){if(t.signal?.aborted===!0)break;try{const _=await v(e,{...t,types:n});for(const x of _.Answer)this.cache.add(e,x);return _}catch(_){u.push(_),t.onProgress?.(new CustomProgressEvent("dns:error",{detail:_}))}}throw u.length===1?u[0]:new AggregateError(u,`DNS lookup of ${e} ${n} failed`)}};var RecordType;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(RecordType||(RecordType={}));function dns(r={}){return new DNS$1(r)}class Parser{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,a){return this.readAtomically(()=>{let o=0,c=0;const u=this.peekChar();if(u===void 0)return;const v=u==="0",_=2**(8*a)-1;for(;;){const x=this.readAtomically(()=>{const E=this.readChar();if(E===void 0)return;const M=Number.parseInt(E,e);if(!Number.isNaN(M))return M});if(x===void 0)break;if(o*=e,o+=x,o>_||(c+=1,t!==void 0&&c>t))return}if(c!==0)return!n&&v&&c>1?void 0:o})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const a=n*2;if(n<t.length-3){const c=this.readSeparator(":",n,()=>this.readIPv4Addr());if(c!==void 0)return t[a]=c[0],t[a+1]=c[1],t[a+2]=c[2],t[a+3]=c[3],[a+4,!0]}const o=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(o===void 0)return[a,!1];t[a]=o>>8,t[a+1]=o&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,a]=e(t);if(n===16)return t;if(a||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const o=new Uint8Array(14),c=16-(n+2),[u]=e(o.subarray(0,c));return t.set(o.subarray(0,u),16-u),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const MAX_IPV6_LENGTH=45,MAX_IPV4_LENGTH=15,parser=new Parser;function parseIPv4(r){if(!(r.length>MAX_IPV4_LENGTH))return parser.new(r).parseWith(()=>parser.readIPv4Addr())}function parseIPv6(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>MAX_IPV6_LENGTH))return parser.new(r).parseWith(()=>parser.readIPv6Addr())}function parseIP(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>MAX_IPV6_LENGTH)return;const t=parser.new(r).parseWith(()=>parser.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function allFF(r,e,t){let n=0;for(const a of r)if(!(n<e)){if(n>t)break;if(a!==255)return!1;n++}return!0}function deepEqual(r,e,t,n){let a=0;for(const o of r)if(!(a<t)){if(a>n)break;if(o!==e[a])return!1;a++}return!0}function ipToString(r){switch(r.length){case IPv4Len:return r.join(".");case IPv6Len:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function simpleMaskLength(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;n&128;)e++,n=n<<1;if(n&128)return-1;for(let a=t+1;a<r.length;a++)if(r[a]!=0)return-1;break}return e}function maskToHex(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const IPv4Len=4,IPv6Len=16,ipv4Prefix=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function maskIp(r,e){e.length===IPv6Len&&r.length===IPv4Len&&allFF(e,0,11)&&(e=e.slice(12)),e.length===IPv4Len&&r.length===IPv6Len&&deepEqual(r,ipv4Prefix,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=r[a]&e[a];return n}function containsIp(r,e){if(typeof e=="string"&&(e=parseIP(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function parseCidr(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=IPv4Len,a=parseIPv4(e);if(a==null&&(n=IPv6Len,a=parseIPv6(e),a==null))throw new Error("Failed to parse given CIDR: "+r);const o=parseInt(t,10);if(Number.isNaN(o)||String(o).length!==t.length||o<0||o>n*8)throw new Error("Failed to parse given CIDR: "+r);const c=cidrMask(o,8*n);return{network:maskIp(a,c),mask:c}}function cidrMask(r,e){if(e!==8*IPv4Len&&e!==8*IPv6Len)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let a=0;a<t;a++){if(r>=8){n[a]=255,r-=8;continue}n[a]=255-(255>>r),r=0}return n}class IpNet{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=parseCidr(e));else{const n=parseIP(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const a=parseInt(t,10);if(Number.isNaN(a)||String(a).length!==t.length||a<0||a>n.length*8){const o=parseIP(t);if(o==null)throw new Error("Failed to parse mask");this.mask=o}else this.mask=cidrMask(a,8*n.length);this.network=maskIp(n,this.mask)}}contains(e){return containsIp({network:this.network,mask:this.mask},e)}toString(){const e=simpleMaskLength(this.mask),t=e!==-1?String(e):maskToHex(this.mask);return ipToString(this.network)+"/"+t}}function isIPv4(r){return!!parseIPv4(r)}function isIPv6(r){return!!parseIPv6(r)}function isIP(r){return!!parseIP(r)}const isV4=isIPv4,isV6=isIPv6,toBytes$1=function(r){let e=0;if(r=r.toString().trim(),isV4(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(isV6(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const o=isV4(t[n]);let c;o&&(c=toBytes$1(t[n]),t[n]=toString$1(c.slice(0,2),"base16")),c!=null&&++n<8&&t.splice(n,0,toString$1(c.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const o=[n,1];for(n=9-t.length;n>0;n--)o.push("0");t.splice.apply(t,o)}const a=new Uint8Array(e+16);for(n=0;n<t.length;n++){const o=parseInt(t[n],16);a[e++]=o>>8&255,a[e++]=o&255}return a}throw new Error("invalid ip address")},toString=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const a=[];for(let o=0;o<t;o++)a.push(r[e+o]);return a.join(".")}if(t===16){const a=[];for(let o=0;o<t;o+=2)a.push(n.getUint16(e+o).toString(16));return a.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},V=-1,names$2={},codes={},table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,V,"ip6zone"],[43,8,"ipcidr"],[53,V,"dns",!0],[54,V,"dns4",!0],[55,V,"dns6",!0],[56,V,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,V,"unix",!1,!0],[421,V,"ipfs"],[421,V,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,V,"garlic64"],[448,0,"tls"],[449,V,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,V,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,V,"http-path"],[777,V,"memory"]];table.forEach(r=>{const e=createProtocol(...r);codes[e.code]=e,names$2[e.name]=e});function createProtocol(r,e,t,n,a){return{code:r,size:e,name:t,resolvable:!!n,path:!!a}}function getProtocol(r){if(typeof r=="number"){if(codes[r]!=null)return codes[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(names$2[r]!=null)return names$2[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const ip4Protocol=getProtocol("ip4"),ip6Protocol=getProtocol("ip6"),ipcidrProtocol=getProtocol("ipcidr");function convertToString(r,e){switch(getProtocol(r).code){case 4:case 41:return bytes2ip(e);case 42:return bytes2str(e);case 43:return toString$1(e,"base10");case 6:case 273:case 33:case 132:return bytes2port(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return bytes2str(e);case 421:return bytes2mh(e);case 444:return bytes2onion(e);case 445:return bytes2onion(e);case 466:return bytes2mb(e);case 481:return globalThis.encodeURIComponent(bytes2str(e));default:return toString$1(e,"base16")}}function convertToBytes(r,e){switch(getProtocol(r).code){case 4:return ip2bytes(e);case 41:return ip2bytes(e);case 42:return str2bytes(e);case 43:return fromString(e,"base10");case 6:case 273:case 33:case 132:return port2bytes(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return str2bytes(e);case 421:return mh2bytes(e);case 444:return onion2bytes(e);case 445:return onion32bytes(e);case 466:return mb2bytes(e);case 481:return str2bytes(globalThis.decodeURIComponent(e));default:return fromString(e,"base16")}}function convertToIpNet(r){let e,t;if(r.stringTuples().forEach(([n,a])=>{(n===ip4Protocol.code||n===ip6Protocol.code)&&(t=a),n===ipcidrProtocol.code&&(e=a)}),e==null||t==null)throw new Error("Invalid multiaddr");return new IpNet(t,e)}const decoders=Object.values(bases).map(r=>r.decoder),anybaseDecoder=function(){let r=decoders[0].or(decoders[1]);return decoders.slice(2).forEach(e=>r=r.or(e)),r}();function ip2bytes(r){if(!isIP(r))throw new Error("invalid ip address");return toBytes$1(r)}function bytes2ip(r){const e=toString(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!isIP(e))throw new Error("invalid ip address");return e}function port2bytes(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function bytes2port(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function str2bytes(r){const e=fromString(r),t=Uint8Array.from(encode$2(e.length));return concat$1([t,e],t.length+e.length)}function bytes2str(r){const e=decode$1(r);if(r=r.slice(encodingLength(e)),r.length!==e)throw new Error("inconsistent lengths");return toString$1(r)}function mh2bytes(r){let e;r[0]==="Q"||r[0]==="1"?e=decode$8(base58btc.decode(`z${r}`)).bytes:e=CID.parse(r).multihash.bytes;const t=Uint8Array.from(encode$2(e.length));return concat$1([t,e],t.length+e.length)}function mb2bytes(r){const e=anybaseDecoder.decode(r),t=Uint8Array.from(encode$2(e.length));return concat$1([t,e],t.length+e.length)}function bytes2mb(r){const e=decode$1(r),t=r.slice(encodingLength(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+toString$1(t,"base64url")}function bytes2mh(r){const e=decode$1(r),t=r.slice(encodingLength(e));if(t.length!==e)throw new Error("inconsistent lengths");return toString$1(t,"base58btc")}function onion2bytes(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=base32.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const a=port2bytes(n);return concat$1([t,a],t.length+a.length)}function onion32bytes(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=base32.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const a=port2bytes(n);return concat$1([t,a],t.length+a.length)}function bytes2onion(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=toString$1(e,"base32"),a=bytes2port(t);return`${n}:${a}`}function stringToMultiaddrParts(r){r=cleanPath(r);const e=[],t=[];let n=null;const a=r.split("/").slice(1);if(a.length===1&&a[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let o=0;o<a.length;o++){const c=a[o],u=getProtocol(c);if(u.size===0){e.push([u.code]),t.push([u.code]);continue}if(o++,o>=a.length)throw new ParseError("invalid address: "+r);if(u.path===!0){n=cleanPath(a.slice(o).join("/")),e.push([u.code,convertToBytes(u.code,n)]),t.push([u.code,n]);break}const v=convertToBytes(u.code,a[o]);e.push([u.code,v]),t.push([u.code,convertToString(u.code,v)])}return{string:stringTuplesToString(t),bytes:tuplesToBytes(e),tuples:e,stringTuples:t,path:n}}function bytesToMultiaddrParts(r){const e=[],t=[];let n=null,a=0;for(;a<r.length;){const o=decode$1(r,a),c=encodingLength(o),u=getProtocol(o),v=sizeForAddr(u,r.slice(a+c));if(v===0){e.push([o]),t.push([o]),a+=c;continue}const _=r.slice(a+c,a+c+v);if(a+=v+c,a>r.length)throw new ParseError("Invalid address Uint8Array: "+toString$1(r,"base16"));e.push([o,_]);const x=convertToString(o,_);if(t.push([o,x]),u.path===!0){n=x;break}}return{bytes:Uint8Array.from(r),string:stringTuplesToString(t),tuples:e,stringTuples:t,path:n}}function stringTuplesToString(r){const e=[];return r.map(t=>{const n=getProtocol(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),cleanPath(e.join("/"))}function tuplesToBytes(r){return concat$1(r.map(e=>{const t=getProtocol(e[0]);let n=Uint8Array.from(encode$2(t.code));return e.length>1&&e[1]!=null&&(n=concat$1([n,e[1]])),n}))}function sizeForAddr(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=decode$1(e instanceof Uint8Array?e:Uint8Array.from(e));return t+encodingLength(t)}}function cleanPath(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}class ParseError extends Error{static name="ParseError";name="ParseError";constructor(e){super(`Error parsing address: ${e}`)}}const inspect=Symbol.for("nodejs.util.inspect.custom"),symbol$1=Symbol.for("@multiformats/js-multiaddr/multiaddr"),DNS_CODES=[getProtocol("dns").code,getProtocol("dns4").code,getProtocol("dns6").code,getProtocol("dnsaddr").code];class NoAvailableResolverError extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}class Multiaddr{bytes;#e;#t;#s;#a;[symbol$1]=!0;constructor(e){e==null&&(e="");let t;if(e instanceof Uint8Array)t=bytesToMultiaddrParts(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=stringToMultiaddrParts(e)}else if(isMultiaddr(e))t=bytesToMultiaddrParts(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#s=t.stringTuples,this.#a=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,a,o="";const c=getProtocol("tcp"),u=getProtocol("udp"),v=getProtocol("ip4"),_=getProtocol("ip6"),x=getProtocol("dns6"),E=getProtocol("ip6zone");for(const[C,I]of this.stringTuples())C===E.code&&(o=`%${I??""}`),DNS_CODES.includes(C)&&(t=c.name==="tcp"?"tcp":"udp",a=443,n=`${I??""}${o}`,e=C===x.code?6:4),(C===c.code||C===u.code)&&(t=getProtocol(C).name==="tcp"?"tcp":"udp",a=parseInt(I??"")),(C===v.code||C===_.code)&&(t=getProtocol(C).name==="tcp"?"tcp":"udp",n=`${I??""}${o}`,e=C===_.code?6:4);if(e==null||t==null||n==null||a==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:a}}protos(){return this.#t.map(([e])=>Object.assign({},getProtocol(e)))}protoCodes(){return this.#t.map(([e])=>e)}protoNames(){return this.#t.map(([e])=>getProtocol(e).name)}tuples(){return this.#t.map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return this.#s.map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new Multiaddr(e),new Multiaddr(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),a=n.lastIndexOf(t);if(a<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Multiaddr(n.slice(0,a))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Multiaddr(tuplesToBytes(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,a])=>{n===names$2.p2p.code&&e.push([n,a]),n===names$2["p2p-circuit"].code&&(e=[])});const t=e.pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?toString$1(base58btc.decode(`z${n}`),"base58btc"):toString$1(CID.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#a}equals(e){return equals(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(o=>o.resolvable);if(t==null)return[this];const n=resolvers.get(t.name);if(n==null)throw new NoAvailableResolverError(`no available resolver for ${t.name}`);return(await n(this,e)).map(o=>multiaddr(o))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[inspect](){return`Multiaddr(${this.#e})`}}const resolvers=new Map;function isMultiaddr(r){return!!r?.[symbol$1]}function multiaddr(r){return new Multiaddr(r)}const MAX_RECURSIVE_DEPTH=32,{code:dnsaddrCode}=getProtocol("dnsaddr");class RecursionLimitError extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const dnsaddrResolver=async function r(e,t={}){const n=t.maxRecursiveDepth??MAX_RECURSIVE_DEPTH;if(n===0)throw new RecursionLimitError("Max recursive depth reached");const[,a]=e.stringTuples().find(([_])=>_===dnsaddrCode)??[],c=await(t?.dns??dns()).query(`_dnsaddr.${a}`,{signal:t?.signal,types:[RecordType.TXT]}),u=e.getPeerId(),v=[];for(const _ of c.Answer){const x=_.data.replace(/["']/g,"").trim().split("=")[1];if(x==null||u!=null&&!x.includes(u))continue;const E=multiaddr(x);if(x.startsWith("/dnsaddr")){const M=await E.resolve({...t,maxRecursiveDepth:n-1});v.push(...M.map(C=>C.toString()))}else v.push(E.toString())}return v};var isPlainObj=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const isOptionObject=isPlainObj,{hasOwnProperty}=Object.prototype,{propertyIsEnumerable}=Object,defineProperty=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),globalThis$1=commonjsGlobal,defaultMergeOptions={concatArrays:!1,ignoreUndefined:!1},getEnumerableOwnPropertyKeys=r=>{const e=[];for(const t in r)hasOwnProperty.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)propertyIsEnumerable.call(r,n)&&e.push(n)}return e};function clone$2(r){return Array.isArray(r)?cloneArray(r):isOptionObject(r)?cloneOptionObject(r):r}function cloneArray(r){const e=r.slice(0,0);return getEnumerableOwnPropertyKeys(r).forEach(t=>{defineProperty(e,t,clone$2(r[t]))}),e}function cloneOptionObject(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return getEnumerableOwnPropertyKeys(r).forEach(t=>{defineProperty(e,t,clone$2(r[t]))}),e}const mergeKeys=(r,e,t,n)=>(t.forEach(a=>{typeof e[a]>"u"&&n.ignoreUndefined||(a in r&&r[a]!==Object.getPrototypeOf(r)?defineProperty(r,a,merge$2(r[a],e[a],n)):defineProperty(r,a,clone$2(e[a])))}),r),concatArrays=(r,e,t)=>{let n=r.slice(0,0),a=0;return[r,e].forEach(o=>{const c=[];for(let u=0;u<o.length;u++)hasOwnProperty.call(o,u)&&(c.push(String(u)),o===r?defineProperty(n,a++,o[u]):defineProperty(n,a++,clone$2(o[u])));n=mergeKeys(n,o,getEnumerableOwnPropertyKeys(o).filter(u=>!c.includes(u)),t)}),n};function merge$2(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?concatArrays(r,e,t):!isOptionObject(e)||!isOptionObject(r)?clone$2(e):mergeKeys(r,e,getEnumerableOwnPropertyKeys(e),t)}var mergeOptions=function(...r){const e=merge$2(clone$2(defaultMergeOptions),this!==globalThis$1&&this||{},defaultMergeOptions);let t={_:{}};for(const n of r)if(n!==void 0){if(!isOptionObject(n))throw new TypeError("`"+n+"` is not an Option Object");t=merge$2(t,{_:n},e)}return t._};const mergeOptions$1=getDefaultExportFromCjs(mergeOptions),DefaultConfig={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:dnsaddrResolver}},transportManager:{faultTolerance:FaultTolerance.FATAL_ALL}};async function validateConfig(r){const e=mergeOptions$1(DefaultConfig,r);if(e.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new InvalidParametersError("Private network is enforced, but no protector was provided");return e}const s=1e3,m=s*60,h=m*60,d=h*24,w=d*7,y=d*365.25;function ms(r,e){try{if(typeof r=="string"&&r.length>0)return parse$1(r);if(typeof r=="number"&&isFinite(r))return e?.long?fmtLong(r):fmtShort(r);throw new Error("Value is not a string or number.")}catch(t){const n=isError$1(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function parse$1(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*y;case"weeks":case"week":case"w":return t*w;case"days":case"day":case"d":return t*d;case"hours":case"hour":case"hrs":case"hr":case"h":return t*h;case"minutes":case"minute":case"mins":case"min":case"m":return t*m;case"seconds":case"second":case"secs":case"sec":case"s":return t*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function fmtShort(r){const e=Math.abs(r);return e>=d?`${Math.round(r/d)}d`:e>=h?`${Math.round(r/h)}h`:e>=m?`${Math.round(r/m)}m`:e>=s?`${Math.round(r/s)}s`:`${r}ms`}function fmtLong(r){const e=Math.abs(r);return e>=d?plural(r,e,d,"day"):e>=h?plural(r,e,h,"hour"):e>=m?plural(r,e,m,"minute"):e>=s?plural(r,e,s,"second"):`${r} ms`}function plural(r,e,t,n){const a=e>=t*1.5;return`${Math.round(r/t)} ${n}${a?"s":""}`}function isError$1(r){return typeof r=="object"&&r!==null&&"message"in r}function setup(r){t.debug=t,t.default=t,t.coerce=v,t.disable=o,t.enable=a,t.enabled=c,t.humanize=ms,t.destroy=_,Object.keys(r).forEach(x=>{t[x]=r[x]}),t.names=[],t.skips=[],t.formatters={};function e(x){let E=0;for(let M=0;M<x.length;M++)E=(E<<5)-E+x.charCodeAt(M),E|=0;return t.colors[Math.abs(E)%t.colors.length]}t.selectColor=e;function t(x){let E,M=null,C,I;function D(...L){if(!D.enabled)return;const N=D,q=Number(new Date),F=q-(E||q);N.diff=F,N.prev=E,N.curr=q,E=q,L[0]=t.coerce(L[0]),typeof L[0]!="string"&&L.unshift("%O");let U=0;L[0]=L[0].replace(/%([a-zA-Z%])/g,(W,X)=>{if(W==="%%")return"%";U++;const J=t.formatters[X];if(typeof J=="function"){const G=L[U];W=J.call(N,G),L.splice(U,1),U--}return W}),t.formatArgs.call(N,L),(N.log||t.log).apply(N,L)}return D.namespace=x,D.useColors=t.useColors(),D.color=t.selectColor(x),D.extend=n,D.destroy=t.destroy,Object.defineProperty(D,"enabled",{enumerable:!0,configurable:!1,get:()=>M!==null?M:(C!==t.namespaces&&(C=t.namespaces,I=t.enabled(x)),I),set:L=>{M=L}}),typeof t.init=="function"&&t.init(D),D}function n(x,E){const M=t(this.namespace+(typeof E>"u"?":":E)+x);return M.log=this.log,M}function a(x){t.save(x),t.namespaces=x,t.names=[],t.skips=[];let E;const M=(typeof x=="string"?x:"").split(/[\s,]+/),C=M.length;for(E=0;E<C;E++)M[E]&&(x=M[E].replace(/\*/g,".*?"),x[0]==="-"?t.skips.push(new RegExp("^"+x.substr(1)+"$")):t.names.push(new RegExp("^"+x+"$")))}function o(){const x=[...t.names.map(u),...t.skips.map(u).map(E=>"-"+E)].join(",");return t.enable(""),x}function c(x){if(x[x.length-1]==="*")return!0;let E,M;for(E=0,M=t.skips.length;E<M;E++)if(t.skips[E].test(x))return!1;for(E=0,M=t.names.length;E<M;E++)if(t.names[E].test(x))return!0;return!1}function u(x){return x.toString().substring(2,x.toString().length-2).replace(/\.\*\?$/,"*")}function v(x){return x instanceof Error?x.stack??x.message:x}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var define_globalThis_process_env_default={};const storage=localstorage(),colors$1=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function formatArgs(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+ms(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(t++,a==="%c"&&(n=t))}),r.splice(n,0,e)}const log=console.debug??console.log??(()=>{});function save(r){try{r?storage?.setItem("debug",r):storage?.removeItem("debug")}catch{}}function load(){let r;try{r=storage?.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=define_globalThis_process_env_default.DEBUG),r}function localstorage(){try{return localStorage}catch{}}function setupFormatters(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const weald=setup({formatArgs,save,load,useColors,setupFormatters,colors:colors$1,storage,log});weald.formatters.b=r=>r==null?"undefined":base58btc.baseEncode(r);weald.formatters.t=r=>r==null?"undefined":base32.baseEncode(r);weald.formatters.m=r=>r==null?"undefined":base64.baseEncode(r);weald.formatters.p=r=>r==null?"undefined":r.toString();weald.formatters.c=r=>r==null?"undefined":r.toString();weald.formatters.k=r=>r==null?"undefined":r.toString();weald.formatters.a=r=>r==null?"undefined":r.toString();weald.formatters.e=r=>r==null?"undefined":notEmpty(r.stack)??notEmpty(r.message)??r.toString();function createDisabledLogger(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function defaultLogger(){return{forComponent(r){return logger(r)}}}function logger(r){let e=createDisabledLogger(`${r}:trace`);return weald.enabled(`${r}:trace`)&&weald.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=weald(`${r}:trace`)),Object.assign(weald(r),{error:weald(`${r}:error`),trace:e})}function notEmpty(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function mapIterable(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),a=n.value;return n.done===!0||a==null?{done:!0,value:void 0}:{done:!1,value:e(a)}}};return t}function peerIdFromString(r){const e=decode$8(base58btc.decode(`z${r}`));return peerIdFromMultihash(e)}class PeerMap{map;constructor(e){if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return mapIterable(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return mapIterable(this.map.values(),e=>e.key)}values(){return mapIterable(this.map.values(),e=>e.value)}get size(){return this.map.size}}class PeerSet{set;constructor(e){if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return mapIterable(this.set.entries(),e=>{const t=peerIdFromString(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=peerIdFromString(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return mapIterable(this.set.values(),e=>peerIdFromString(e))}intersection(e){const t=new PeerSet;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new PeerSet;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new PeerSet;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}var murmurHash3js={exports:{}};(function(r,e){(function(t,n){var a={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function o(D){if(!Array.isArray(D)&&!ArrayBuffer.isView(D))return!1;for(var L=0;L<D.length;L++)if(!Number.isInteger(D[L])||D[L]<0||D[L]>255)return!1;return!0}function c(D,L){return(D&65535)*L+(((D>>>16)*L&65535)<<16)}function u(D,L){return D<<L|D>>>32-L}function v(D){return D^=D>>>16,D=c(D,2246822507),D^=D>>>13,D=c(D,3266489909),D^=D>>>16,D}function _(D,L){D=[D[0]>>>16,D[0]&65535,D[1]>>>16,D[1]&65535],L=[L[0]>>>16,L[0]&65535,L[1]>>>16,L[1]&65535];var N=[0,0,0,0];return N[3]+=D[3]+L[3],N[2]+=N[3]>>>16,N[3]&=65535,N[2]+=D[2]+L[2],N[1]+=N[2]>>>16,N[2]&=65535,N[1]+=D[1]+L[1],N[0]+=N[1]>>>16,N[1]&=65535,N[0]+=D[0]+L[0],N[0]&=65535,[N[0]<<16|N[1],N[2]<<16|N[3]]}function x(D,L){D=[D[0]>>>16,D[0]&65535,D[1]>>>16,D[1]&65535],L=[L[0]>>>16,L[0]&65535,L[1]>>>16,L[1]&65535];var N=[0,0,0,0];return N[3]+=D[3]*L[3],N[2]+=N[3]>>>16,N[3]&=65535,N[2]+=D[2]*L[3],N[1]+=N[2]>>>16,N[2]&=65535,N[2]+=D[3]*L[2],N[1]+=N[2]>>>16,N[2]&=65535,N[1]+=D[1]*L[3],N[0]+=N[1]>>>16,N[1]&=65535,N[1]+=D[2]*L[2],N[0]+=N[1]>>>16,N[1]&=65535,N[1]+=D[3]*L[1],N[0]+=N[1]>>>16,N[1]&=65535,N[0]+=D[0]*L[3]+D[1]*L[2]+D[2]*L[1]+D[3]*L[0],N[0]&=65535,[N[0]<<16|N[1],N[2]<<16|N[3]]}function E(D,L){return L%=64,L===32?[D[1],D[0]]:L<32?[D[0]<<L|D[1]>>>32-L,D[1]<<L|D[0]>>>32-L]:(L-=32,[D[1]<<L|D[0]>>>32-L,D[0]<<L|D[1]>>>32-L])}function M(D,L){return L%=64,L===0?D:L<32?[D[0]<<L|D[1]>>>32-L,D[1]<<L]:[D[1]<<L-32,0]}function C(D,L){return[D[0]^L[0],D[1]^L[1]]}function I(D){return D=C(D,[0,D[0]>>>1]),D=x(D,[4283543511,3981806797]),D=C(D,[0,D[0]>>>1]),D=x(D,[3301882366,444984403]),D=C(D,[0,D[0]>>>1]),D}a.x86.hash32=function(D,L){if(a.inputValidation&&!o(D))return n;L=L||0;for(var N=D.length%4,q=D.length-N,F=L,U=0,j=3432918353,W=461845907,X=0;X<q;X=X+4)U=D[X]|D[X+1]<<8|D[X+2]<<16|D[X+3]<<24,U=c(U,j),U=u(U,15),U=c(U,W),F^=U,F=u(F,13),F=c(F,5)+3864292196;switch(U=0,N){case 3:U^=D[X+2]<<16;case 2:U^=D[X+1]<<8;case 1:U^=D[X],U=c(U,j),U=u(U,15),U=c(U,W),F^=U}return F^=D.length,F=v(F),F>>>0},a.x86.hash128=function(D,L){if(a.inputValidation&&!o(D))return n;L=L||0;for(var N=D.length%16,q=D.length-N,F=L,U=L,j=L,W=L,X=0,J=0,G=0,oe=0,O=597399067,l=2869860233,p=951274213,b=2716044179,S=0;S<q;S=S+16)X=D[S]|D[S+1]<<8|D[S+2]<<16|D[S+3]<<24,J=D[S+4]|D[S+5]<<8|D[S+6]<<16|D[S+7]<<24,G=D[S+8]|D[S+9]<<8|D[S+10]<<16|D[S+11]<<24,oe=D[S+12]|D[S+13]<<8|D[S+14]<<16|D[S+15]<<24,X=c(X,O),X=u(X,15),X=c(X,l),F^=X,F=u(F,19),F+=U,F=c(F,5)+1444728091,J=c(J,l),J=u(J,16),J=c(J,p),U^=J,U=u(U,17),U+=j,U=c(U,5)+197830471,G=c(G,p),G=u(G,17),G=c(G,b),j^=G,j=u(j,15),j+=W,j=c(j,5)+2530024501,oe=c(oe,b),oe=u(oe,18),oe=c(oe,O),W^=oe,W=u(W,13),W+=F,W=c(W,5)+850148119;switch(X=0,J=0,G=0,oe=0,N){case 15:oe^=D[S+14]<<16;case 14:oe^=D[S+13]<<8;case 13:oe^=D[S+12],oe=c(oe,b),oe=u(oe,18),oe=c(oe,O),W^=oe;case 12:G^=D[S+11]<<24;case 11:G^=D[S+10]<<16;case 10:G^=D[S+9]<<8;case 9:G^=D[S+8],G=c(G,p),G=u(G,17),G=c(G,b),j^=G;case 8:J^=D[S+7]<<24;case 7:J^=D[S+6]<<16;case 6:J^=D[S+5]<<8;case 5:J^=D[S+4],J=c(J,l),J=u(J,16),J=c(J,p),U^=J;case 4:X^=D[S+3]<<24;case 3:X^=D[S+2]<<16;case 2:X^=D[S+1]<<8;case 1:X^=D[S],X=c(X,O),X=u(X,15),X=c(X,l),F^=X}return F^=D.length,U^=D.length,j^=D.length,W^=D.length,F+=U,F+=j,F+=W,U+=F,j+=F,W+=F,F=v(F),U=v(U),j=v(j),W=v(W),F+=U,F+=j,F+=W,U+=F,j+=F,W+=F,("00000000"+(F>>>0).toString(16)).slice(-8)+("00000000"+(U>>>0).toString(16)).slice(-8)+("00000000"+(j>>>0).toString(16)).slice(-8)+("00000000"+(W>>>0).toString(16)).slice(-8)},a.x64.hash128=function(D,L){if(a.inputValidation&&!o(D))return n;L=L||0;for(var N=D.length%16,q=D.length-N,F=[0,L],U=[0,L],j=[0,0],W=[0,0],X=[2277735313,289559509],J=[1291169091,658871167],G=0;G<q;G=G+16)j=[D[G+4]|D[G+5]<<8|D[G+6]<<16|D[G+7]<<24,D[G]|D[G+1]<<8|D[G+2]<<16|D[G+3]<<24],W=[D[G+12]|D[G+13]<<8|D[G+14]<<16|D[G+15]<<24,D[G+8]|D[G+9]<<8|D[G+10]<<16|D[G+11]<<24],j=x(j,X),j=E(j,31),j=x(j,J),F=C(F,j),F=E(F,27),F=_(F,U),F=_(x(F,[0,5]),[0,1390208809]),W=x(W,J),W=E(W,33),W=x(W,X),U=C(U,W),U=E(U,31),U=_(U,F),U=_(x(U,[0,5]),[0,944331445]);switch(j=[0,0],W=[0,0],N){case 15:W=C(W,M([0,D[G+14]],48));case 14:W=C(W,M([0,D[G+13]],40));case 13:W=C(W,M([0,D[G+12]],32));case 12:W=C(W,M([0,D[G+11]],24));case 11:W=C(W,M([0,D[G+10]],16));case 10:W=C(W,M([0,D[G+9]],8));case 9:W=C(W,[0,D[G+8]]),W=x(W,J),W=E(W,33),W=x(W,X),U=C(U,W);case 8:j=C(j,M([0,D[G+7]],56));case 7:j=C(j,M([0,D[G+6]],48));case 6:j=C(j,M([0,D[G+5]],40));case 5:j=C(j,M([0,D[G+4]],32));case 4:j=C(j,M([0,D[G+3]],24));case 3:j=C(j,M([0,D[G+2]],16));case 2:j=C(j,M([0,D[G+1]],8));case 1:j=C(j,[0,D[G]]),j=x(j,X),j=E(j,31),j=x(j,J),F=C(F,j)}return F=C(F,[0,D.length]),U=C(U,[0,D.length]),F=_(F,U),U=_(U,F),F=I(F),U=I(U),F=_(F,U),U=_(U,F),("00000000"+(F[0]>>>0).toString(16)).slice(-8)+("00000000"+(F[1]>>>0).toString(16)).slice(-8)+("00000000"+(U[0]>>>0).toString(16)).slice(-8)+("00000000"+(U[1]>>>0).toString(16)).slice(-8)},r.exports&&(e=r.exports=a),e.murmurHash3=a})()})(murmurHash3js,murmurHash3js.exports);const symbol=Symbol.for("@achingbrain/uint8arraylist");function findBufAndOffset(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const a=t+n.byteLength;if(e<a)return{buf:n,index:e-t};t=a}throw new RangeError("index is out of bounds")}function isUint8ArrayList(r){return!!r?.[symbol]}class Uint8ArrayList{bufs;length;[symbol]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(isUint8ArrayList(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(isUint8ArrayList(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=findBufAndOffset(this.bufs,e);return t.buf[t.index]}set(e,t){const n=findBufAndOffset(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(isUint8ArrayList(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:a}=this._subList(e,t);return concat$1(n,a)}subarray(e,t){const{bufs:n,length:a}=this._subList(e,t);return n.length===1?n[0]:concat$1(n,a)}sublist(e,t){const{bufs:n,length:a}=this._subList(e,t),o=new Uint8ArrayList;return o.length=a,o.bufs=[...n],o}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let a=0;for(let o=0;o<this.bufs.length;o++){const c=this.bufs[o],u=a,v=u+c.byteLength;if(a=v,e>=v)continue;const _=e>=u&&e<v,x=t>u&&t<=v;if(_&&x){if(e===u&&t===v){n.push(c);break}const E=e-u;n.push(c.subarray(E,E+(t-e)));break}if(_){if(e===0){n.push(c);continue}n.push(c.subarray(e-u));continue}if(x){if(t===v){n.push(c);break}n.push(c.subarray(0,t-u));break}n.push(c)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!isUint8ArrayList(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const a=n.byteLength;if(a===0)throw new TypeError("search must be at least 1 byte long");const o=256,c=new Int32Array(o);for(let E=0;E<o;E++)c[E]=-1;for(let E=0;E<a;E++)c[n[E]]=E;const u=c,v=this.byteLength-n.byteLength,_=n.byteLength-1;let x;for(let E=t;E<=v;E+=x){x=0;for(let M=_;M>=0;M--){const C=this.get(E+M);if(n[M]!==C){x=Math.max(1,M-u[C]);break}}if(x===0)return E}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=allocUnsafe(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const a=alloc$1(2);new DataView(a.buffer,a.byteOffset,a.byteLength).setInt16(0,t,n),this.write(a,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const a=alloc$1(4);new DataView(a.buffer,a.byteOffset,a.byteLength).setInt32(0,t,n),this.write(a,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const a=alloc$1(8);new DataView(a.buffer,a.byteOffset,a.byteLength).setBigInt64(0,t,n),this.write(a,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=allocUnsafe(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const a=alloc$1(2);new DataView(a.buffer,a.byteOffset,a.byteLength).setUint16(0,t,n),this.write(a,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const a=alloc$1(4);new DataView(a.buffer,a.byteOffset,a.byteLength).setUint32(0,t,n),this.write(a,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const a=alloc$1(8);new DataView(a.buffer,a.byteOffset,a.byteLength).setBigUint64(0,t,n),this.write(a,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const a=alloc$1(4);new DataView(a.buffer,a.byteOffset,a.byteLength).setFloat32(0,t,n),this.write(a,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const a=alloc$1(8);new DataView(a.buffer,a.byteOffset,a.byteLength).setFloat64(0,t,n),this.write(a,e)}equals(e){if(e==null||!(e instanceof Uint8ArrayList)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!equals(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Uint8ArrayList;return n.bufs=e,t==null&&(t=e.reduce((a,o)=>a+o.byteLength,0)),n.length=t,n}}const MAX_FINGERPRINT_SIZE=64;class Fingerprint{fp;h;seed;constructor(e,t,n,a=2){if(a>MAX_FINGERPRINT_SIZE)throw new TypeError("Invalid Fingerprint Size");const o=t.hashV(e,n),c=alloc$1(a);for(let u=0;u<c.length;u++)c[u]=o[u];c.length===0&&(c[0]=7),this.fp=c,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array?equals(this.fp,e.fp):!1}}function getRandomInt(r,e){return Math.floor(Math.random()*(e-r))+r}class Bucket{contents;constructor(e){this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const t=getRandomInt(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const FNV_PRIMES={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},FNV_OFFSETS={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},cachedEncoder=new globalThis.TextEncoder;function fnv1aUint8Array(r,e){const t=FNV_PRIMES[e];let n=FNV_OFFSETS[e];for(let a=0;a<r.length;a++)n^=BigInt(r[a]),n=BigInt.asUintN(e,n*t);return n}function fnv1aEncodeInto(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=FNV_PRIMES[e];let a=FNV_OFFSETS[e],o=r;for(;o.length>0;){const c=cachedEncoder.encodeInto(o,t);o=o.slice(c.read);for(let u=0;u<c.written;u++)a^=BigInt(t[u]),a=BigInt.asUintN(e,a*n)}return a}function fnv1a$1(r,{size:e=32,utf8Buffer:t}={}){if(!FNV_PRIMES[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return fnv1aEncodeInto(r,e,t);r=cachedEncoder.encode(r)}return fnv1aUint8Array(r,e)}const fnv1a={hash:r=>Number(fnv1a$1(r,{size:32})),hashV:(r,e)=>numberToBuffer(fnv1a.hash(r,e))};function numberToBuffer(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),fromString(e,"base16")}const maxCuckooCount=500;class CuckooFilter{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??fnv1a,this.seed=e.seed??getRandomInt(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=fromString(e));const t=new Fingerprint(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,a=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new Bucket(this.bucketSize)),this.buckets[a]==null&&(this.buckets[a]=new Bucket(this.bucketSize)),this.buckets[n].add(t)||this.buckets[a].add(t))return this.count++,!0;const o=[n,a];let c=o[getRandomInt(0,o.length-1)];this.buckets[c]==null&&(this.buckets[c]=new Bucket(this.bucketSize));for(let u=0;u<maxCuckooCount;u++){const v=this.buckets[c].swap(t);if(v!=null&&(c=(c^v.hash())%this.filterSize,this.buckets[c]==null&&(this.buckets[c]=new Bucket(this.bucketSize)),this.buckets[c].add(v)))return this.count++,!0}return!1}has(e){typeof e=="string"&&(e=fromString(e));const t=new Fingerprint(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,a=this.buckets[n]?.has(t)??!1;if(a)return a;const o=(n^t.hash())%this.filterSize;return this.buckets[o]?.has(t)??!1}remove(e){typeof e=="string"&&(e=fromString(e));const t=new Fingerprint(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,a=this.buckets[n]?.remove(t)??!1;if(a)return this.count--,a;const o=(n^t.hash())%this.filterSize,c=this.buckets[o]?.remove(t)??!1;return c&&this.count--,c}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const MAX_LOAD={1:.5,2:.84,4:.95,8:.98};function calculateBucketSize(r=.001){return r>.002?2:r>1e-5?4:8}function optimize(r,e=.001){const t=calculateBucketSize(e),n=MAX_LOAD[t],a=Math.round(r/n),o=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),MAX_FINGERPRINT_SIZE);return{filterSize:a,bucketSize:t,fingerprintSize:o}}class ScalableCuckooFilter{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??fnv1a,this.seed=e.seed??getRandomInt(0,Math.pow(2,10)),this.filterSeries=[new CuckooFilter({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=fromString(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new CuckooFilter({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=fromString(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=fromString(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function createScalableCuckooFilter(r,e=.001,t){return new ScalableCuckooFilter({...optimize(r,e)})}var Envelope;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={publicKey:alloc$1(0),payloadType:alloc$1(0),payload:alloc$1(0),signature:alloc$1(0)},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.publicKey=t.bytes();break}case 2:{o.payloadType=t.bytes();break}case 3:{o.payload=t.bytes();break}case 5:{o.signature=t.bytes();break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(Envelope||(Envelope={}));class InvalidSignatureError extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}class RecordEnvelope{static createFromProtobuf=async e=>{const t=Envelope.decode(e),n=publicKeyFromProtobuf(t.publicKey);return new RecordEnvelope({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})};static seal=async(e,t)=>{if(t==null)throw new Error("Missing private key");const n=e.domain,a=e.codec,o=e.marshal(),c=formatSignaturePayload(n,a,o),u=await t.sign(c.subarray());return new RecordEnvelope({publicKey:t.publicKey,payloadType:a,payload:o,signature:u})};static openAndCertify=async(e,t)=>{const n=await RecordEnvelope.createFromProtobuf(e);if(!await n.validate(t))throw new InvalidSignatureError("Envelope signature is not valid for the given domain");return n};publicKey;payloadType;payload;signature;marshaled;constructor(e){const{publicKey:t,payloadType:n,payload:a,signature:o}=e;this.publicKey=t,this.payloadType=n,this.payload=a,this.signature=o}marshal(){return this.marshaled==null&&(this.marshaled=Envelope.encode({publicKey:publicKeyToProtobuf(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return equals(this.marshal(),e.marshal())}async validate(e){const t=formatSignaturePayload(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}}const formatSignaturePayload=(r,e,t)=>{const n=fromString(r),a=encode$2(n.byteLength),o=encode$2(e.length),c=encode$2(t.length);return new Uint8ArrayList(a,n,o,e,c,t)};function arrayEquals(r,e){const t=(n,a)=>n.toString().localeCompare(a.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,a)=>e[a].equals(n)))}const ENVELOPE_DOMAIN_PEER_RECORD="libp2p-peer-record",ENVELOPE_PAYLOAD_TYPE_PEER_RECORD=Uint8Array.from([3,1]);var PeerRecord$1;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=message((a,o,c={})=>{c.lengthDelimited!==!1&&o.fork(),a.multiaddr!=null&&a.multiaddr.byteLength>0&&(o.uint32(10),o.bytes(a.multiaddr)),c.lengthDelimited!==!1&&o.ldelim()},(a,o,c={})=>{const u={multiaddr:alloc$1(0)},v=o==null?a.len:a.pos+o;for(;a.pos<v;){const _=a.uint32();switch(_>>>3){case 1:{u.multiaddr=a.bytes();break}default:{a.skipType(_&7);break}}}return u})),n),t.encode=a=>encodeMessage(a,t.codec()),t.decode=(a,o)=>decodeMessage(a,t.codec(),o)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{if(a.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const o of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(o,n);a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={peerId:alloc$1(0),seq:0n,addresses:[]},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.peerId=t.bytes();break}case 2:{o.seq=t.uint64();break}case 3:{if(a.limits?.addresses!=null&&o.addresses.length===a.limits.addresses)throw new MaxLengthError('Decode error - map field "addresses" had too many elements');o.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:a.limits?.addresses$}));break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(PeerRecord$1||(PeerRecord$1={}));class PeerRecord{static createFromProtobuf=e=>{const t=PeerRecord$1.decode(e),n=peerIdFromMultihash(decode$8(t.peerId)),a=(t.addresses??[]).map(c=>multiaddr(c.multiaddr)),o=t.seq;return new PeerRecord({peerId:n,multiaddrs:a,seqNumber:o})};static DOMAIN=ENVELOPE_DOMAIN_PEER_RECORD;static CODEC=ENVELOPE_PAYLOAD_TYPE_PEER_RECORD;peerId;multiaddrs;seqNumber;domain=PeerRecord.DOMAIN;codec=PeerRecord.CODEC;marshaled;constructor(e){const{peerId:t,multiaddrs:n,seqNumber:a}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=a??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=PeerRecord$1.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof PeerRecord)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!arrayEquals(this.multiaddrs,e.multiaddrs))}}function isAsyncIterable$9(r){return r[Symbol.asyncIterator]!=null}function all(r){if(isAsyncIterable$9(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}const events={},observable=r=>{r.addEventListener("message",e=>{observable.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{observable.dispatchEvent("message",r,e)})};observable.addEventListener=(r,e)=>{events[r]==null&&(events[r]=[]),events[r].push(e)};observable.removeEventListener=(r,e)=>{events[r]!=null&&(events[r]=events[r].filter(t=>t===e))};observable.dispatchEvent=function(r,e,t){events[r]!=null&&events[r].forEach(n=>n(e,t))};const WORKER_REQUEST_READ_LOCK="lock:worker:request-read",WORKER_RELEASE_READ_LOCK="lock:worker:release-read",MASTER_GRANT_READ_LOCK="lock:master:grant-read",WORKER_REQUEST_WRITE_LOCK="lock:worker:request-write",WORKER_RELEASE_WRITE_LOCK="lock:worker:release-write",MASTER_GRANT_WRITE_LOCK="lock:master:grant-write",nanoid=(r=21)=>Math.random().toString().substring(2),handleWorkerLockRequest=(r,e,t,n,a)=>(o,c)=>{if(c.data.type!==t)return;const u={type:c.data.type,name:c.data.name,identifier:c.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:u.name,handler:async()=>{o.postMessage({type:a,name:u.name,identifier:u.identifier}),await new Promise(v=>{const _=x=>{if(x?.data==null)return;const E={type:x.data.type,name:x.data.name,identifier:x.data.identifier};E.type===n&&E.identifier===u.identifier&&(o.removeEventListener("message",_),v())};o.addEventListener("message",_)})}}}))},makeWorkerLockRequest=(r,e,t,n)=>async()=>{const a=nanoid();return globalThis.postMessage({type:e,identifier:a,name:r}),new Promise(o=>{const c=u=>{if(u?.data==null)return;const v={type:u.data.type,identifier:u.data.identifier};v.type===t&&v.identifier===a&&(globalThis.removeEventListener("message",c),o(()=>{globalThis.postMessage({type:n,identifier:a,name:r})}))};globalThis.addEventListener("message",c)})},defaultOptions$4={singleProcess:!1},impl=r=>{if(r=Object.assign({},defaultOptions$4,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return observable.addEventListener("message",handleWorkerLockRequest(t,"requestReadLock",WORKER_REQUEST_READ_LOCK,WORKER_RELEASE_READ_LOCK,MASTER_GRANT_READ_LOCK)),observable.addEventListener("message",handleWorkerLockRequest(t,"requestWriteLock",WORKER_REQUEST_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK)),t}return{isWorker:!0,readLock:t=>makeWorkerLockRequest(t,WORKER_REQUEST_READ_LOCK,MASTER_GRANT_READ_LOCK,WORKER_RELEASE_READ_LOCK),writeLock:t=>makeWorkerLockRequest(t,WORKER_REQUEST_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK)}},mutexes={};let implementation;async function createReleaseable(r,e){let t;const n=new Promise(a=>{t=a});return r.add(async()=>pTimeout((async()=>{await new Promise(a=>{t(()=>{a()})})})(),{milliseconds:e.timeout})),n}const createMutex=(r,e)=>{if(implementation.isWorker===!0)return{readLock:implementation.readLock(r,e),writeLock:implementation.writeLock(r,e)};const t=new PQueue({concurrency:1});let n;return{async readLock(){if(n!=null)return createReleaseable(n,e);n=new PQueue({concurrency:e.concurrency,autoStart:!1});const a=n,o=createReleaseable(n,e);return t.add(async()=>{a.start(),await a.onIdle().then(()=>{n===a&&(n=null)})}),o},async writeLock(){return n=null,createReleaseable(t,e)}}},defaultOptions$3={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function createMortice(r){const e=Object.assign({},defaultOptions$3,r);return implementation==null&&(implementation=impl(e),implementation.isWorker!==!0&&(implementation.addEventListener("requestReadLock",t=>{mutexes[t.data.name]!=null&&mutexes[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),implementation.addEventListener("requestWriteLock",async t=>{mutexes[t.data.name]!=null&&mutexes[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),mutexes[e.name]==null&&(mutexes[e.name]=createMutex(e.name,e)),mutexes[e.name]}var Peer;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=message((a,o,c={})=>{c.lengthDelimited!==!1&&o.fork(),a.key!=null&&a.key!==""&&(o.uint32(10),o.string(a.key)),a.value!=null&&a.value.byteLength>0&&(o.uint32(18),o.bytes(a.value)),c.lengthDelimited!==!1&&o.ldelim()},(a,o,c={})=>{const u={key:"",value:alloc$1(0)},v=o==null?a.len:a.pos+o;for(;a.pos<v;){const _=a.uint32();switch(_>>>3){case 1:{u.key=a.string();break}case 2:{u.value=a.bytes();break}default:{a.skipType(_&7);break}}}return u})),n),t.encode=a=>encodeMessage(a,t.codec()),t.decode=(a,o)=>decodeMessage(a,t.codec(),o)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=message((a,o,c={})=>{c.lengthDelimited!==!1&&o.fork(),a.key!=null&&a.key!==""&&(o.uint32(10),o.string(a.key)),a.value!=null&&(o.uint32(18),Tag.codec().encode(a.value,o)),c.lengthDelimited!==!1&&o.ldelim()},(a,o,c={})=>{const u={key:""},v=o==null?a.len:a.pos+o;for(;a.pos<v;){const _=a.uint32();switch(_>>>3){case 1:{u.key=a.string();break}case 2:{u.value=Tag.codec().decode(a,a.uint32(),{limits:c.limits?.value});break}default:{a.skipType(_&7);break}}}return u})),n),t.encode=a=>encodeMessage(a,t.codec()),t.decode=(a,o)=>decodeMessage(a,t.codec(),o)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{if(a.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const o of t.addresses)n.uint32(10),Address.codec().encode(o,n);if(t.protocols!=null)for(const o of t.protocols)n.uint32(18),n.string(o);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[o,c]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:o,value:c},n);if(t.tags!=null&&t.tags.size!==0)for(const[o,c]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:o,value:c},n);a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={addresses:[],protocols:[],metadata:new Map,tags:new Map},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{if(a.limits?.addresses!=null&&o.addresses.length===a.limits.addresses)throw new MaxLengthError('Decode error - map field "addresses" had too many elements');o.addresses.push(Address.codec().decode(t,t.uint32(),{limits:a.limits?.addresses$}));break}case 2:{if(a.limits?.protocols!=null&&o.protocols.length===a.limits.protocols)throw new MaxLengthError('Decode error - map field "protocols" had too many elements');o.protocols.push(t.string());break}case 4:{o.publicKey=t.bytes();break}case 5:{o.peerRecordEnvelope=t.bytes();break}case 6:{if(a.limits?.metadata!=null&&o.metadata.size===a.limits.metadata)throw new MaxSizeError('Decode error - map field "metadata" had too many elements');const v=r.Peer$metadataEntry.codec().decode(t,t.uint32());o.metadata.set(v.key,v.value);break}case 7:{if(a.limits?.tags!=null&&o.tags.size===a.limits.tags)throw new MaxSizeError('Decode error - map field "tags" had too many elements');const v=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:a.limits?.tags$value}});o.tags.set(v.key,v.value);break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(Peer||(Peer={}));var Address;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={multiaddr:alloc$1(0)},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.multiaddr=t.bytes();break}case 2:{o.isCertified=t.bool();break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(Address||(Address={}));var Tag;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={value:0},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.value=t.uint32();break}case 2:{o.expiry=t.uint64();break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(Tag||(Tag={}));function bytesToPeer(r,e){const t=Peer.decode(e);if(t.publicKey!=null&&r.publicKey==null){const o=publicKeyFromProtobuf(t.publicKey);r=peerIdFromPublicKey(o)}const n=new Map,a=BigInt(Date.now());for(const[o,c]of t.tags.entries())c.expiry!=null&&c.expiry<a||n.set(o,c);return{...t,id:r,addresses:t.addresses.map(({multiaddr:o,isCertified:c})=>({multiaddr:multiaddr(o),isCertified:c??!1})),metadata:t.metadata,peerRecordEnvelope:t.peerRecordEnvelope??void 0,tags:n}}const pathSepS="/",pathSepB=new TextEncoder().encode(pathSepS),pathSep=pathSepB[0];class Key{_buf;constructor(e,t){if(typeof e=="string")this._buf=fromString(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(e="utf8"){return toString$1(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Key(e.join(pathSepS))}static random(){return new Key(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Key(e):typeof e.uint8Array=="function"?new Key(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=pathSepB),this._buf[0]!==pathSep){const e=new Uint8Array(this._buf.byteLength+1);e.fill(pathSep,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let a=0;a<t.length;a++){if(n.length<a+1)return!1;const o=t[a],c=n[a];if(o<c)return!0;if(o>c)return!1}return t.length<n.length}reverse(){return Key.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(e){return new Key(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(pathSepS)||(e+=pathSepS),e+=this.type(),new Key(e)}parent(){const e=this.list();return e.length===1?new Key(pathSepS):new Key(e.slice(0,-1).join(pathSepS))}child(e){return this.toString()===pathSepS?e:e.toString()===pathSepS?this:new Key(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Key.withNamespaces([...this.namespaces(),...flatten(e.map(t=>t.namespaces()))])}}function namespaceType(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function namespaceValue(r){const e=r.split(":");return e[e.length-1]}function flatten(r){return[].concat(...r)}const NAMESPACE_COMMON="/peers/";function peerIdToDatastoreKey(r){if(!isPeerId(r)||r.type==null)throw new InvalidParametersError("Invalid PeerId");const e=r.toCID().toString();return new Key(`${NAMESPACE_COMMON}${e}`)}async function dedupeFilterAndSortAddresses(r,e,t){const n=new Map;for(const a of t){if(a==null)continue;if(a.multiaddr instanceof Uint8Array&&(a.multiaddr=multiaddr(a.multiaddr)),!isMultiaddr(a.multiaddr))throw new InvalidParametersError("Multiaddr was invalid");if(!await e(r,a.multiaddr))continue;const o=a.isCertified??!1,c=a.multiaddr.toString(),u=n.get(c);u!=null?a.isCertified=u.isCertified||o:n.set(c,{multiaddr:a.multiaddr,isCertified:o})}return[...n.values()].sort((a,o)=>a.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:a,multiaddr:o})=>({isCertified:a,multiaddr:o.bytes}))}async function toPeerPB(r,e,t,n){if(e==null)throw new InvalidParametersError("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new InvalidParametersError("publicKey bytes do not match peer id publicKey bytes");const a=n.existingPeer;if(a!=null&&!r.equals(a.id))throw new InvalidParametersError("peer id did not match existing peer id");let o=a?.addresses??[],c=new Set(a?.protocols??[]),u=a?.metadata??new Map,v=a?.tags??new Map,_=a?.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(o=[],e.multiaddrs!=null&&o.push(...e.multiaddrs.map(M=>({isCertified:!1,multiaddr:M}))),e.addresses!=null&&o.push(...e.addresses)),e.protocols!=null&&(c=new Set(e.protocols)),e.metadata!=null){const M=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);u=createSortedMap(M,{validate:validateMetadata})}if(e.tags!=null){const M=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);v=createSortedMap(M,{validate:validateTag,map:mapTag})}e.peerRecordEnvelope!=null&&(_=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&o.push(...e.multiaddrs.map(M=>({isCertified:!1,multiaddr:M}))),e.addresses!=null&&o.push(...e.addresses),e.protocols!=null&&(c=new Set([...c,...e.protocols])),e.metadata!=null){const M=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[C,I]of M)I==null?u.delete(C):u.set(C,I);u=createSortedMap([...u.entries()],{validate:validateMetadata})}if(e.tags!=null){const M=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),C=new Map(v);for(const[I,D]of M)D==null?C.delete(I):C.set(I,D);v=createSortedMap([...C.entries()],{validate:validateTag,map:mapTag})}e.peerRecordEnvelope!=null&&(_=e.peerRecordEnvelope)}let x;a?.id.publicKey!=null?x=publicKeyToProtobuf(a.id.publicKey):e.publicKey!=null?x=publicKeyToProtobuf(e.publicKey):r.publicKey!=null&&(x=publicKeyToProtobuf(r.publicKey));const E={addresses:await dedupeFilterAndSortAddresses(r,n.addressFilter??(async()=>!0),o),protocols:[...c.values()].sort((M,C)=>M.localeCompare(C)),metadata:u,tags:v,publicKey:x,peerRecordEnvelope:_};return r.type!=="RSA"&&delete E.publicKey,E}function createSortedMap(r,e){const t=new Map;for(const[n,a]of r)a!=null&&e.validate(n,a);for(const[n,a]of r.sort(([o],[c])=>o.localeCompare(c)))a!=null&&t.set(n,e.map?.(n,a)??a);return t}function validateMetadata(r,e){if(typeof r!="string")throw new InvalidParametersError("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new InvalidParametersError("Metadata value must be a Uint8Array")}function validateTag(r,e){if(typeof r!="string")throw new InvalidParametersError("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new InvalidParametersError("Tag value must be an integer");if(e.value<0||e.value>100)throw new InvalidParametersError("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new InvalidParametersError("Tag ttl must be an integer");if(e.ttl<0)throw new InvalidParametersError("Tag ttl must be between greater than 0")}}function mapTag(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function decodePeer(r,e){const t=r.toString().split("/")[2],n=CID.parse(t,base32),a=peerIdFromCID(n);return bytesToPeer(a,e)}function mapQuery(r){return r==null?{}:{prefix:NAMESPACE_COMMON,filters:(r.filters??[]).map(e=>({key:t,value:n})=>e(decodePeer(t,n))),orders:(r.orders??[]).map(e=>(t,n)=>e(decodePeer(t.key,t.value),decodePeer(n.key,n.value)))}}class PersistentStore{peerId;datastore;lock;addressFilter;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=createMortice({name:"peer-store",singleProcess:!0})}async has(e){return this.datastore.has(peerIdToDatastoreKey(e))}async delete(e){if(this.peerId.equals(e))throw new InvalidParametersError("Cannot delete self peer");await this.datastore.delete(peerIdToDatastoreKey(e))}async load(e){const t=await this.datastore.get(peerIdToDatastoreKey(e));return bytesToPeer(e,t)}async save(e,t){const{existingBuf:n,existingPeer:a}=await this.#e(e),o=await toPeerPB(e,t,"patch",{addressFilter:this.addressFilter});return this.#t(e,o,n,a)}async patch(e,t){const{existingBuf:n,existingPeer:a}=await this.#e(e),o=await toPeerPB(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:a});return this.#t(e,o,n,a)}async merge(e,t){const{existingBuf:n,existingPeer:a}=await this.#e(e),o=await toPeerPB(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:a});return this.#t(e,o,n,a)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(mapQuery(e??{}))){const a=decodePeer(t,n);a.id.equals(this.peerId)||(yield a)}}async#e(e){try{const t=await this.datastore.get(peerIdToDatastoreKey(e)),n=bytesToPeer(e,t);return{existingBuf:t,existingPeer:n}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}return{}}async#t(e,t,n,a){const o=Peer.encode(t);return n!=null&&equals(o,n)?{peer:bytesToPeer(e,o),previous:a,updated:!1}:(await this.datastore.put(peerIdToDatastoreKey(e),o),{peer:bytesToPeer(e,o),previous:a,updated:!0})}}class PersistentPeerStore{store;events;peerId;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new PersistentStore(e,t)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const a of this.store.all(t))e(a)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await all(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const a=await this.store.save(e,t);return this.#e(e,a),a.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const a=await this.store.patch(e,t);return this.#e(e,a),a.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const a=await this.store.merge(e,t);return this.#e(e,a),a.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){const n=await RecordEnvelope.openAndCertify(e,PeerRecord.DOMAIN),a=peerIdFromCID(n.publicKey.toCID());if(t?.equals(a)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,a),!1;const o=PeerRecord.createFromProtobuf(n.payload);let c;try{c=await this.get(a)}catch(u){if(u.name!=="NotFoundError")throw u}if(c?.peerRecordEnvelope!=null){const u=await RecordEnvelope.createFromProtobuf(c.peerRecordEnvelope),v=PeerRecord.createFromProtobuf(u.payload);if(v.seqNumber>=o.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",v.seqNumber,o.seqNumber),!1}return await this.patch(o.peerId,{peerRecordEnvelope:e,addresses:o.multiaddrs.map(u=>({isCertified:!0,multiaddr:u}))}),!0}#e(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}}function persistentPeerStore(r,e={}){return new PersistentPeerStore(r,e)}class NotFoundError extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=NotFoundError.name;code=NotFoundError.code;constructor(e="Not Found"){super(e)}}function isAsyncIterable$8(r){return r[Symbol.asyncIterator]!=null}function drain(r){if(isAsyncIterable$8(r))return(async()=>{for await(const e of r);})();for(const e of r);}function peekable(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:a=>{n.push(a)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function isAsyncIterable$7(r){return r[Symbol.asyncIterator]!=null}function filter(r,e){let t=0;if(isAsyncIterable$7(r))return async function*(){for await(const v of r)await e(v,t++)&&(yield v)}();const n=peekable(r),{value:a,done:o}=n.next();if(o===!0)return function*(){}();const c=e(a,t++);if(typeof c.then=="function")return async function*(){await c&&(yield a);for await(const v of n)await e(v,t++)&&(yield v)}();const u=e;return function*(){c===!0&&(yield a);for(const v of n)u(v,t++)&&(yield v)}()}function isAsyncIterable$6(r){return r[Symbol.asyncIterator]!=null}function sort(r,e){return isAsyncIterable$6(r)?async function*(){yield*(await all(r)).sort(e)}():function*(){yield*all(r).sort(e)}()}function isAsyncIterable$5(r){return r[Symbol.asyncIterator]!=null}function take(r,e){return isAsyncIterable$5(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class BaseDatastore{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:a}of e)await this.put(n,a,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,a){e.push({key:n,value:a})},delete(n){t.push(n)},commit:async n=>{await drain(this.putMany(e,n)),e=[],await drain(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const a=e.prefix;n=filter(n,o=>o.key.toString().startsWith(a))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((a,o)=>filter(a,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((a,o)=>sort(a,o),n)),e.offset!=null){let a=0;const o=e.offset;n=filter(n,()=>a++>=o)}return e.limit!=null&&(n=take(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const a=e.prefix;n=filter(n,o=>o.toString().startsWith(a))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((a,o)=>filter(a,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((a,o)=>sort(a,o),n)),e.offset!=null){const a=e.offset;let o=0;n=filter(n,()=>o++>=a)}return e.limit!=null&&(n=take(n,e.limit)),n}}class MemoryDatastore extends BaseDatastore{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){const t=this.data.get(e.toString());if(t==null)throw new NotFoundError;return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(const[e,t]of this.data.entries())yield{key:new Key(e),value:t}}*_allKeys(){for(const e of this.data.keys())yield new Key(e)}}function debounce$1(r,e){let t;const n=function(){const a=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(a,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}var Netmask_1;(function(){var r,e,t,n,a,o,c,u;u=function(v){var _,x,E,M;return _=(v&255<<24)>>>24,x=(v&255<<16)>>>16,E=(v&65280)>>>8,M=v&255,[_,x,E,M].join(".")},c=function(v){var _,x,E,M,C,I;for(_=[],E=M=0;M<=3&&v.length!==0;E=++M){if(E>0){if(v[0]!==".")throw new Error("Invalid IP");v=v.substring(1)}I=e(v),C=I[0],x=I[1],v=v.substring(x),_.push(C)}if(v.length!==0)throw new Error("Invalid IP");switch(_.length){case 1:if(_[0]>4294967295)throw new Error("Invalid IP");return _[0]>>>0;case 2:if(_[0]>255||_[1]>16777215)throw new Error("Invalid IP");return(_[0]<<24|_[1])>>>0;case 3:if(_[0]>255||_[1]>255||_[2]>65535)throw new Error("Invalid IP");return(_[0]<<24|_[1]<<16|_[2])>>>0;case 4:if(_[0]>255||_[1]>255||_[2]>255||_[3]>255)throw new Error("Invalid IP");return(_[0]<<24|_[1]<<16|_[2]<<8|_[3])>>>0;default:throw new Error("Invalid IP")}},t=function(v){return v.charCodeAt(0)},n=t("0"),o=t("a"),a=t("A"),e=function(v){var _,x,E,M,C;for(M=0,_=10,x="9",E=0,v.length>1&&v[E]==="0"&&(v[E+1]==="x"||v[E+1]==="X"?(E+=2,_=16):"0"<=v[E+1]&&v[E+1]<="9"&&(E++,_=8,x="7")),C=E;E<v.length;){if("0"<=v[E]&&v[E]<=x)M=M*_+(t(v[E])-n)>>>0;else if(_===16)if("a"<=v[E]&&v[E]<="f")M=M*_+(10+t(v[E])-o)>>>0;else if("A"<=v[E]&&v[E]<="F")M=M*_+(10+t(v[E])-a)>>>0;else break;else break;if(M>4294967295)throw new Error("too large");E++}if(E===C)throw new Error("empty octet");return[M,E]},r=function(){function v(_,x){var E,M,C;if(typeof _!="string")throw new Error("Missing `net' parameter");if(x||(C=_.split("/",2),_=C[0],x=C[1]),x||(x=32),typeof x=="string"&&x.indexOf(".")>-1){try{this.maskLong=c(x)}catch{throw new Error("Invalid mask: "+x)}for(E=M=32;M>=0;E=--M)if(this.maskLong===4294967295<<32-E>>>0){this.bitmask=E;break}}else if(x||x===0)this.bitmask=parseInt(x,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(c(_)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+_)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+x);this.size=Math.pow(2,32-this.bitmask),this.base=u(this.netLong),this.mask=u(this.maskLong),this.hostmask=u(~this.maskLong),this.first=this.bitmask<=30?u(this.netLong+1):this.base,this.last=this.bitmask<=30?u(this.netLong+this.size-2):u(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?u(this.netLong+this.size-1):void 0}return v.prototype.contains=function(_){return typeof _=="string"&&(_.indexOf("/")>0||_.split(".").length!==4)&&(_=new v(_)),_ instanceof v?this.contains(_.base)&&this.contains(_.broadcast||_.last):(c(_)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},v.prototype.next=function(_){return _==null&&(_=1),new v(u(this.netLong+this.size*_),this.mask)},v.prototype.forEach=function(_){var x,E,M;for(M=c(this.first),E=c(this.last),x=0;M<=E;)_(u(M),M,x),x++,M++},v.prototype.toString=function(){return this.base+"/"+this.bitmask},v}(),Netmask_1=r}).call(commonjsGlobal);const PRIVATE_IP_RANGES=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],NETMASK_RANGES=PRIVATE_IP_RANGES.map(r=>new Netmask_1(r));function ipv4Check(r){for(const e of NETMASK_RANGES)if(e.contains(r))return!0;return!1}function isIpv4MappedIpv6(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function ipv4MappedIpv6Check(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),a=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return ipv4Check(a)}function isIpv4EmbeddedIpv6(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function ipv4EmbeddedIpv6Check(r){const e=r.split(":"),t=e[e.length-1];return ipv4Check(t)}function ipv6Check(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function isPrivateIp(r){return isIPv4(r)?ipv4Check(r):isIpv4MappedIpv6(r)?ipv4MappedIpv6Check(r):isIpv4EmbeddedIpv6(r)?ipv4EmbeddedIpv6Check(r):isIPv6(r)?ipv6Check(r):void 0}const MAX_DATE=864e13,CODEC_TLS=448,CODEC_SNI=449,CODEC_DNS$1=53,CODEC_DNS4$1=54,CODEC_DNS6$1=55,CODEC_DNSADDR$1=56;class DNSMappings{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const a=isPrivateIp(n)===!0;this.mappings.set(n,{domain:e,verified:a,expires:a?MAX_DATE-Date.now():0,lastVerified:a?MAX_DATE-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[a,o]of this.mappings.entries())o.domain===t&&(this.log("removing %s to %s DNS mapping %e",a,o.domain,new Error("where")),this.mappings.delete(a),n=n||o.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const o=e[n].multiaddr.stringTuples(),c=o[0][1];if(c!=null)for(const[u,v]of this.mappings.entries()){if(c!==u)continue;this.maybeAddSNITuple(o,v.domain)&&(e.splice(n,1),n--,t.push({multiaddr:multiaddr(`/${o.map(x=>[getProtocol(x[0]).name,x[1]].join("/")).join("/")}`),verified:v.verified,type:"dns-mapping",expires:v.expires,lastVerified:v.lastVerified}))}}return t}maybeAddSNITuple(e,t){for(let n=0;n<e.length;n++)if(e[n][0]===CODEC_TLS&&e[n+1]?.[0]!==CODEC_SNI)return e.splice(n+1,0,[CODEC_SNI,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let a=!1;for(const[o,c]of this.mappings.entries())c.domain===n&&(this.log("marking %s to %s DNS mapping as verified",o,c.domain),a=c.verified,c.verified=!0,c.expires=Date.now()+t,c.lastVerified=Date.now());return a}unconfirm(e,t){const n=this.findHost(e);let a=!1;for(const[o,c]of this.mappings.entries())c.domain===n&&(this.log("removing verification of %s to %s DNS mapping",o,c.domain),a=a||c.verified,c.verified=!1,c.expires=Date.now()+t);return a}findHost(e){for(const t of e.stringTuples())if(t[0]===CODEC_SNI||t[0]===CODEC_DNS$1||t[0]===CODEC_DNS4$1||t[0]===CODEC_DNS6$1||t[0]===CODEC_DNSADDR$1)return t[1]}}const CODEC_IP4$3=4,CODEC_IP6$3=41,CODEC_TCP=6,CODEC_UDP=273;class IPMappings{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const a of n)if(a.externalIp===t[0][1])return!0;return!1}add(e,t,n,a=t,o="tcp"){const c=`${e}-${t}-${o}`,u=this.mappings.get(c)??[],v={internalIp:e,internalPort:t,externalIp:n,externalPort:a,externalFamily:isIPv4(n)?4:6,protocol:o,verified:!1,expires:0};u.push(v),this.mappings.set(c,u)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",a=t[1][0]===CODEC_TCP?"tcp":"udp",o=parseInt(t[1][1]??"0");let c=!1;for(const[u,v]of this.mappings.entries()){for(let _=0;_<v.length;_++){const x=v[_];x.externalIp===n&&x.externalPort===o&&x.protocol===a&&(this.log("removing %s:%s to %s:%s %s IP mapping",x.externalIp,x.externalPort,n,o,a),c=c||x.verified,v.splice(_,1),_--)}v.length===0&&this.mappings.delete(u)}return c}getAll(e){const t=[];for(const{multiaddr:n}of e){const a=n.stringTuples();let o;if((a[0][0]===CODEC_IP4$3||a[0][0]===CODEC_IP6$3)&&a[1][0]===CODEC_TCP?o=`${a[0][1]}-${a[1][1]}-tcp`:(a[0][0]===CODEC_IP4$3||a[0][0]===CODEC_IP6$3)&&a[1][0]===CODEC_UDP&&(o=`${a[0][1]}-${a[1][1]}-udp`),o==null)continue;const c=this.mappings.get(o);if(c!=null)for(const u of c)a[0][0]=u.externalFamily===4?CODEC_IP4$3:CODEC_IP6$3,a[0][1]=u.externalIp,a[1][1]=`${u.externalPort}`,t.push({multiaddr:multiaddr(`/${a.map(v=>[getProtocol(v[0]).name,v[1]].join("/")).join("/")}`),verified:u.verified,type:"ip-mapping",expires:u.expires,lastVerified:u.lastVerified})}return t}confirm(e,t){const a=e.stringTuples()[0][1];let o=!1;for(const c of this.mappings.values())for(const u of c)u.externalIp===a&&(this.log("marking %s to %s IP mapping as verified",u.internalIp,u.externalIp),o=u.verified,u.verified=!0,u.expires=Date.now()+t,u.lastVerified=Date.now());return o}unconfirm(e,t){const n=e.stringTuples(),a=n[0][1]??"",o=n[1][0]===CODEC_TCP?"tcp":"udp",c=parseInt(n[1][1]??"0");let u=!1;for(const v of this.mappings.values())for(let _=0;_<v.length;_++){const x=v[_];x.externalIp===a&&x.externalPort===c&&x.protocol===o&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",x.externalIp,x.externalPort,a,c,o),u=u||x.verified,x.verified=!1,x.expires=Date.now()+t)}return u}}const CODEC_IP4$2=4,CODEC_IP6$2=41;function isLinkLocal(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===CODEC_IP4$2)return t.startsWith("169.254.");if(e===CODEC_IP6$2)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const CODEC_IP4$1=4,CODEC_IP6$1=41,CODEC_DNS=53,CODEC_DNS4=54,CODEC_DNS6=55,CODEC_DNSADDR=56;function isPrivate(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!0;if(e===CODEC_DNS||e===CODEC_DNS4||e===CODEC_DNS6||e===CODEC_DNSADDR)return!1;if(e===CODEC_IP4$1||e===CODEC_IP6$1)return isPrivateIp(t)??!1}catch{}return!0}const defaultValues$2={maxObservedAddresses:10};class ObservedAddresses{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??defaultValues$2.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(isPrivate(e)||isLinkLocal(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:multiaddr(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){const t=this.addresses.get(e.toString())?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),a=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},o=a.verified;return a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,a),o}}const defaultValues$1={maxObservedAddresses:10};class TransportAddresses{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??defaultValues$1.maxObservedAddresses}get(e,t){if(isPrivate(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let a=this.addresses.get(n);return a==null&&(a={verified:!1,expires:0},this.addresses.set(n,a)),{multiaddr:e,verified:a.verified,type:"transport",expires:a.expires,lastVerified:a.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){const t=this.toKey(e),n=this.addresses.get(t)?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),a=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},o=a.verified;return a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now(),this.addresses.set(n,a),o}unconfirm(e,t){const n=this.toKey(e),a=this.addresses.get(n)??{verified:!1,expires:0},o=a.verified;return a.verified=!1,a.expires=Date.now()+t,this.addresses.set(n,a),o}toKey(e){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}}const ONE_MINUTE=6e4,defaultValues={addressVerificationTTL:ONE_MINUTE*10,addressVerificationRetry:ONE_MINUTE*5},defaultAddressFilter=r=>r;function stripPeerId(r,e){const t=r.getPeerId();return t!=null&&peerIdFromString$1(t).equals(e)&&(r=r.decapsulate(multiaddr(`/p2p/${e.toString()}`))),r}class AddressManager{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(e,t={}){const{listen:n=[],announce:a=[],appendAnnounce:o=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(c=>c.toString()),this.announce=new Set(a.map(c=>c.toString())),this.appendAnnounce=new Set(o.map(c=>c.toString())),this.observed=new ObservedAddresses(e,t),this.dnsMappings=new DNSMappings(e,t),this.ipMappings=new IPMappings(e,t),this.transportAddresses=new TransportAddresses(e,t),this.announceFilter=t.announceFilter??defaultAddressFilter,this.observedAddressFilter=createScalableCuckooFilter(1024),this.addressVerificationTTL=t.addressVerificationTTL??defaultValues.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??defaultValues.addressVerificationRetry,this._updatePeerStoreAddresses=debounce$1(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>multiaddr(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>multiaddr(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>multiaddr(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=stripPeerId(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=stripPeerId(e,this.components.peerId);let n=!0;(t?.type==="observed"||this.observed.has(e))&&(n=this.observed.confirm(e,t?.ttl??this.addressVerificationTTL)),(t?.type==="transport"||this.transportAddresses.has(e))&&(n=this.transportAddresses.confirm(e,t?.ttl??this.addressVerificationTTL)),(t?.type==="dns-mapping"||this.dnsMappings.has(e))&&(n=this.dnsMappings.confirm(e,t?.ttl??this.addressVerificationTTL)),(t?.type==="ip-mapping"||this.ipMappings.has(e))&&(n=this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=stripPeerId(e,this.components.peerId);let n=!1;this.observed.has(e)&&(n=this.observed.remove(e)),this.transportAddresses.has(e)&&(n=this.transportAddresses.unconfirm(e,t?.ttl??this.addressVerificationRetry)),this.dnsMappings.has(e)&&(n=this.dnsMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)),this.ipMappings.has(e)&&(n=this.ipMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)),n&&this._updatePeerStoreAddresses()}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const a=n.multiaddr.toString();return e.has(a)?!1:(e.add(a),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{const a=multiaddr(n);return a.protos().pop()?.path===!0||a.getPeerId()===this.components.peerId.toString()?a:a.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return e.map(n=>({multiaddr:n,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];return t=t.concat(this.components.transportManager.getAddrs().map(n=>this.transportAddresses.get(n,this.addressVerificationTTL))),t=t.concat(this.getAppendAnnounceAddrs().map(n=>({multiaddr:n,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(multiaddr(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,a=t,o="tcp"){this.ipMappings.add(e,t,n,a,o),this.observed.removePrefixed(`/ip${isIPv4(n)?4:6}/${n}/${o}/${a}`)}removePublicAddressMapping(e,t,n,a=t,o="tcp"){this.ipMappings.remove(multiaddr(`/ip${isIPv4(n)?4:6}/${n}/${o}/${a}`))&&this._updatePeerStoreAddresses()}}var messages;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(messages||(messages={}));class MissingServiceError extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class UnmetServiceDependenciesError extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class NoContentRoutersError extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class NoPeerRoutersError extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class QueriedForSelfError extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class UnhandledProtocolError extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class DuplicateProtocolHandlerError extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class DialDeniedError extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class NoValidAddressesError extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class ConnectionInterceptedError extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class ConnectionDeniedError extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class MuxerUnavailableError extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class EncryptionFailedError extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class TransportUnavailableError extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class DefaultComponents{components={};_started=!1;constructor(e={}){this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=defaultLogger())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>isStartable(t)).map(async t=>{await t[e]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const OPTIONAL_SERVICES=["metrics","connectionProtector","dns"],NON_SERVICE_PROPERTIES=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function defaultComponents(r={}){const e=new DefaultComponents(r);return new Proxy(e,{get(n,a,o){if(typeof a=="string"&&!NON_SERVICE_PROPERTIES.includes(a)){const c=e.components[a];if(c==null&&!OPTIONAL_SERVICES.includes(a))throw new MissingServiceError(`${a} not set`);return c}return Reflect.get(n,a,o)},set(n,a,o){return typeof a=="string"?e.components[a]=o:Reflect.set(n,a,o),!0}})}function checkServiceDependencies(r){const e={};for(const t of Object.values(r.components))for(const n of getServiceCapabilities(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of getServiceDependencies(t))if(e[n]!==!0)throw new UnmetServiceDependenciesError(`Service "${getServiceName(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function getServiceCapabilities(r){return Array.isArray(r?.[serviceCapabilities])?r[serviceCapabilities]:[]}function getServiceDependencies(r){return Array.isArray(r?.[serviceDependencies])?r[serviceDependencies]:[]}function getServiceName(r){return r?.[Symbol.toStringTag]??r?.toString()??"unknown"}const toParts=r=>r.toString().split("/").slice(1),func=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),literal=r=>({match:e=>func(t=>t===r).match(e),pattern:r}),string=()=>({match:r=>func(e=>typeof e=="string").match(r),pattern:"{string}"}),number$1=()=>({match:r=>func(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),peerId=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{base58btc.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),certhash=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{base64url.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),optional=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),or$1=(...r)=>({match:e=>{let t;for(const n of r){const a=n.match(e);a!==!1&&(t==null||a.length<t.length)&&(t=a)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),and$1=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function fmt(...r){function e(a){let o=toParts(a);for(const c of r){const u=c.match(o);if(u===!1)return!1;o=u}return o}function t(a){return e(a)!==!1}function n(a){const o=e(a);return o===!1?!1:o.length===0}return{matchers:r,matches:t,exactMatch:n}}const _DNS4=and$1(literal("dns4"),string()),_DNS6=and$1(literal("dns6"),string()),_DNSADDR=and$1(literal("dnsaddr"),string()),_DNS=and$1(literal("dns"),string());fmt(_DNS4,optional(peerId()));fmt(_DNS6,optional(peerId()));fmt(_DNSADDR,optional(peerId()));fmt(or$1(_DNS,_DNSADDR,_DNS4,_DNS6),optional(peerId()));const _IP4=and$1(literal("ip4"),func(isIPv4)),_IP6=and$1(literal("ip6"),func(isIPv6)),_IP=or$1(_IP4,_IP6),_IP_OR_DOMAIN=or$1(_IP,_DNS,_DNS4,_DNS6,_DNSADDR);fmt(or$1(_IP,and$1(or$1(_DNS,_DNSADDR,_DNS4,_DNS6),optional(peerId()))));fmt(_IP4);fmt(_IP6);fmt(_IP);const _TCP=and$1(_IP_OR_DOMAIN,literal("tcp"),number$1()),_UDP=and$1(_IP_OR_DOMAIN,literal("udp"),number$1()),TCP$1=fmt(and$1(_TCP,optional(peerId())));fmt(_UDP);const _QUIC=and$1(_UDP,literal("quic"),optional(peerId())),_QUICV1=and$1(_UDP,literal("quic-v1"),optional(peerId())),QUIC_V0_OR_V1=or$1(_QUIC,_QUICV1);fmt(_QUIC);fmt(_QUICV1);const _WEB=or$1(_IP_OR_DOMAIN,_TCP,_UDP,_QUIC,_QUICV1),_WebSockets$1=or$1(and$1(_WEB,literal("ws"),optional(peerId()))),WebSockets$1=fmt(_WebSockets$1),_WebSocketsSecure$1=or$1(and$1(_WEB,literal("wss"),optional(peerId())),and$1(_WEB,literal("tls"),optional(and$1(literal("sni"),string())),literal("ws"),optional(peerId()))),WebSocketsSecure$1=fmt(_WebSocketsSecure$1),_WebRTCDirect$1=and$1(_UDP,literal("webrtc-direct"),optional(certhash()),optional(certhash()),optional(peerId())),WebRTCDirect$1=fmt(_WebRTCDirect$1),_WebTransport$1=and$1(_QUICV1,literal("webtransport"),optional(certhash()),optional(certhash()),optional(peerId())),WebTransport$1=fmt(_WebTransport$1),_P2P$1=or$1(_WebSockets$1,_WebSocketsSecure$1,and$1(_TCP,optional(peerId())),and$1(QUIC_V0_OR_V1,optional(peerId())),and$1(_IP_OR_DOMAIN,optional(peerId())),_WebRTCDirect$1,_WebTransport$1,peerId()),P2P$1=fmt(_P2P$1),_Circuit$1=and$1(_P2P$1,literal("p2p-circuit"),peerId()),Circuit$2=fmt(_Circuit$1),_WebRTC=or$1(and$1(_P2P$1,literal("p2p-circuit"),literal("webrtc"),optional(peerId())),and$1(_P2P$1,literal("webrtc"),optional(peerId())),and$1(literal("webrtc"),optional(peerId()))),WebRTC=fmt(_WebRTC),_HTTP=or$1(and$1(_IP_OR_DOMAIN,literal("tcp"),number$1(),literal("http"),optional(peerId())),and$1(_IP_OR_DOMAIN,literal("http"),optional(peerId())));fmt(_HTTP);const _HTTPS=or$1(and$1(_IP_OR_DOMAIN,literal("tcp"),or$1(and$1(literal("443"),literal("http")),and$1(number$1(),literal("https"))),optional(peerId())),and$1(_IP_OR_DOMAIN,literal("tls"),literal("http"),optional(peerId())),and$1(_IP_OR_DOMAIN,literal("https"),optional(peerId())));fmt(_HTTPS);const _Memory=or$1(and$1(literal("memory"),string(),optional(peerId())));fmt(_Memory);const CODEC_IP4=4,CODEC_IP6=41;function connectionGater(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(WebSockets$1.matches(e))return!1;const t=e.stringTuples();return t[0][0]===CODEC_IP4||t[0][0]===CODEC_IP6?!!isPrivateIp(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}const createAbortError=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},clearMethods=new WeakMap;function createDelay({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:a}={})=>{if(a?.aborted)return Promise.reject(createAbortError());let o,c,u;const v=r??clearTimeout,_=()=>{v(o),u(createAbortError())},x=()=>{a&&a.removeEventListener("abort",_)},E=new Promise((M,C)=>{c=()=>{x(),M(n)},u=C,o=(e??setTimeout)(c,t)});return a&&a.addEventListener("abort",_,{once:!0}),clearMethods.set(E,()=>{v(o),o=null,c()}),E}}const delay=createDelay();class RateLimitError extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(e="Rate limit exceeded",t){super(e),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}}class QueueFullError extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}class RateLimiter{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(e={}){this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new MemoryStorage}async consume(e,t=1,n={}){const a=this.getKey(e),o=this._getKeySecDuration(n);let c=this.memoryStorage.incrby(a,t,o);if(c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c.consumedPoints>this.points)throw this.blockDuration>0&&c.consumedPoints<=this.points+t&&(c=this.memoryStorage.set(a,c.consumedPoints,this.blockDuration)),new RateLimitError("Rate limit exceeded",c);if(this.execEvenly&&c.msBeforeNext>0&&!c.isFirstInDuration){let u=Math.ceil(c.msBeforeNext/(c.remainingPoints+2));u<this.execEvenlyMinDelayMs&&(u=c.consumedPoints*this.execEvenlyMinDelayMs),await delay(u)}return c}penalty(e,t=1,n={}){const a=this.getKey(e),o=this._getKeySecDuration(n),c=this.memoryStorage.incrby(a,t,o);return c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c}reward(e,t=1,n={}){const a=this.getKey(e),o=this._getKeySecDuration(n),c=this.memoryStorage.incrby(a,-t,o);return c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c}block(e,t){const n=t*1e3,a=this.points+1;return this.memoryStorage.set(this.getKey(e),a,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:a,isFirstInDuration:!1}}set(e,t,n=0){const a=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:a===0?-1:a,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return e?.customDuration!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class MemoryStorage{storage;constructor(){this.storage=new Map}incrby(e,t,n){const a=this.storage.get(e);if(a!=null){const o=a.expiresAt!=null?a.expiresAt.getTime()-new Date().getTime():-1;return a.expiresAt==null||o>0?(a.value+=t,{remainingPoints:0,msBeforeNext:o,consumedPoints:a.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const a=n*1e3,o=this.storage.get(e);o!=null&&clearTimeout(o.timeoutId);const c={value:t,expiresAt:a>0?new Date(Date.now()+a):void 0};return this.storage.set(e,c),a>0&&(c.timeoutId=setTimeout(()=>{this.storage.delete(e)},a),c.timeoutId.unref!=null&&c.timeoutId.unref()),{remainingPoints:0,msBeforeNext:a===0?-1:a,consumedPoints:c.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}function getPeerAddress(r){if(isPeerId(r))return{peerId:r,multiaddrs:[]};Array.isArray(r)||(r=[r]);let e;if(r.length>0){const t=r[0].getPeerId();e=t==null?void 0:peerIdFromString$1(t),r.forEach(n=>{if(!isMultiaddr(n))throw new InvalidMultiaddrError("Invalid multiaddr");const a=n.getPeerId();if(a==null){if(e!=null)throw new InvalidParametersError("Multiaddrs must all have the same peer id or have no peer id")}else{const o=peerIdFromString$1(a);if(e?.equals(o)!==!0)throw new InvalidParametersError("Multiaddrs must all have the same peer id or have no peer id")}})}return{peerId:e,multiaddrs:r}}const DEFAULT_CLOSABLE_PROTOCOLS=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function safelyCloseConnectionIfUnused(r,e){const t=r?.streams?.map(a=>a.protocol)??[],n=e?.closableProtocols??DEFAULT_CLOSABLE_PROTOCOLS;if(!(t.filter(a=>a!=null&&!n.includes(a)).length>0))try{await r?.close(e)}catch(a){r?.abort(a)}}const DIAL_TIMEOUT=5e3,UPGRADE_TIMEOUT=3e3,PROTOCOL_NEGOTIATION_TIMEOUT=2e3,MAX_PEER_ADDRS_TO_DIAL=25,INBOUND_CONNECTION_THRESHOLD=5,MAX_INCOMING_PENDING_CONNECTIONS=10,MAX_PARALLEL_RECONNECTS=5,LAST_DIAL_FAILURE_KEY="last-dial-failure",LAST_DIAL_SUCCESS_KEY="last-dial-success",MAX_DIAL_QUEUE_LENGTH=500,MAX_CONNECTIONS=100,MAX_PARALLEL_DIALS=50;async function resolveMultiaddrs(r,e){let t=!1;for(const a of resolvers.keys())if(t=r.protoNames().includes(a),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(a=>a.toString())),n}function multiaddrToIpNet(r){try{let e;if(typeof r=="string"?e=multiaddr(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return convertToIpNet(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}const defaultOptions$2={maxConnections:MAX_CONNECTIONS};class ConnectionPruner{maxConnections;connectionManager;peerStore;allow;events;log;constructor(e,t={}){this.maxConnections=t.maxConnections??defaultOptions$2.maxConnections,this.allow=(t.allow??[]).map(n=>multiaddrToIpNet(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const n=new PeerMap;for(const u of e){const v=u.remotePeer;if(!n.has(v)){n.set(v,0);try{const _=await this.peerStore.get(v);n.set(v,[..._.tags.values()].reduce((x,E)=>x+E.value,0))}catch(_){_.name!=="NotFoundError"&&this.log.error("error loading peer tags",_)}}}const a=this.sortConnections(e,n),o=Math.max(t-this.maxConnections,0),c=[];for(const u of a)if(this.log("too many connections open - closing a connection to %p",u.remotePeer),this.allow.some(_=>_.contains(u.remoteAddr.nodeAddress().address))||c.push(u),c.length===o)break;await Promise.all(c.map(async u=>{await safelyCloseConnectionIfUnused(u,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:c})}sortConnections(e,t){return e.sort((n,a)=>{const o=n.timeline.open,c=a.timeline.open;return o<c?1:o>c?-1:0}).sort((n,a)=>n.direction==="outbound"&&a.direction==="inbound"?1:n.direction==="inbound"&&a.direction==="outbound"?-1:0).sort((n,a)=>n.streams.length>a.streams.length?1:n.streams.length<a.streams.length?-1:0).sort((n,a)=>{const o=t.get(n.remotePeer)??0,c=t.get(a.remotePeer)??0;return o>c?1:o<c?-1:0})}}function pDefer(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class FixedFIFO{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let AbortError$4=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function pushable(r={}){return _pushable(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function _pushable(r,e){e=e??{};let t=e.onEnd,n=new FIFO,a,o,c,u=pDefer();const v=async()=>{try{return n.isEmpty()?c?{done:!0}:await new Promise((L,N)=>{o=q=>{o=null,n.push(q);try{L(r(n))}catch(F){N(F)}return a}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{u.resolve(),u=pDefer()})}},_=L=>o!=null?o(L):(n.push(L),a),x=L=>(n=new FIFO,o!=null?o({error:L}):(n.push({error:L}),a)),E=L=>{if(c)return a;if(e?.objectMode!==!0&&L?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return _({done:!1,value:L})},M=L=>c?a:(c=!0,L!=null?x(L):_({done:!0})),C=()=>(n=new FIFO,M(),{done:!0}),I=L=>(M(L),{done:!0});if(a={[Symbol.asyncIterator](){return this},next:v,return:C,throw:I,push:E,end:M,get readableLength(){return n.size},onEmpty:async L=>{const N=L?.signal;if(N?.throwIfAborted(),n.isEmpty())return;let q,F;N!=null&&(q=new Promise((U,j)=>{F=()=>{j(new AbortError$4)},N.addEventListener("abort",F)}));try{await Promise.race([u.promise,q])}finally{F!=null&&N!=null&&N?.removeEventListener("abort",F)}}},t==null)return a;const D=a;return a={[Symbol.asyncIterator](){return this},next(){return D.next()},throw(L){return D.throw(L),t!=null&&(t(L),t=void 0),{done:!0}},return(){return D.return(),t!=null&&(t(),t=void 0),{done:!0}},push:E,end(L){return D.end(L),t!=null&&(t(L),t=void 0),a},get readableLength(){return D.readableLength},onEmpty:L=>D.onEmpty(L)},a}let AbortError$3=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}};async function raceEvent(r,e,t,n){const a=new AbortError$3(n?.errorMessage,n?.errorCode);return t?.aborted===!0?Promise.reject(a):new Promise((o,c)=>{function u(){t?.removeEventListener("abort",x),r.removeEventListener(e,v),n?.errorEvent!=null&&r.removeEventListener(n.errorEvent,_)}const v=E=>{try{if(n?.filter?.(E)===!1)return}catch(M){u(),c(M);return}u(),o(E)},_=E=>{u(),c(E.detail)},x=()=>{u(),c(a)};t?.addEventListener("abort",x),r.addEventListener(e,v),n?.errorEvent!=null&&r.addEventListener(n.errorEvent,_)})}let AbortError$2=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};async function raceSignal(r,e,t){if(e==null)return r;if(e.aborted)return Promise.reject(new AbortError$2(t?.errorMessage,t?.errorCode,t?.errorName));let n;const a=new AbortError$2(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([r,new Promise((o,c)=>{n=()=>{c(a)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}class JobRecipient{deferred;signal;constructor(e){this.signal=e,this.deferred=pDefer(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new AbortError$6)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function randomId(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Job{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=randomId(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,setMaxListeners(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>t&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new AbortError$6),this.cleanup())}async join(e={}){const t=new JobRecipient(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await raceSignal(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}class Queue extends TypedEventEmitter{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,e.metricName!=null&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if(t.status==="queued"){e=t;break}return e==null?!1:(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),this.sort!=null&&this.queue.sort(this.sort)}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new QueueFullError;const n=new Job(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.tryToStartAnother(),n.join(t).then(a=>(this.safeDispatchEvent("completed",{detail:a}),this.safeDispatchEvent("success",{detail:{job:n,result:a}}),a)).catch(a=>{if(n.status==="queued"){for(let o=0;o<this.queue.length;o++)if(this.queue[o]===n){this.queue.splice(o,1);break}}throw this.safeDispatchEvent("error",{detail:a}),this.safeDispatchEvent("failure",{detail:{job:n,error:a}}),a})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new AbortError$6)}),this.clear()}async onEmpty(e){this.size!==0&&await raceEvent(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await raceEvent(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){this.pending===0&&this.size===0||await raceEvent(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){e?.signal?.throwIfAborted();const t=pushable({objectMode:!0}),n=v=>{v!=null?this.abort():this.clear(),t.end(v)},a=v=>{v.detail!=null&&t.push(v.detail)},o=v=>{n(v.detail)},c=()=>{n()},u=()=>{n(new AbortError$6("Queue aborted"))};this.addEventListener("completed",a),this.addEventListener("error",o),this.addEventListener("idle",c),e?.signal?.addEventListener("abort",u);try{yield*t}finally{this.removeEventListener("completed",a),this.removeEventListener("error",o),this.removeEventListener("idle",c),e?.signal?.removeEventListener("abort",u),n()}}}class PriorityQueue extends Queue{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function anySignal(r){const e=new globalThis.AbortController;function t(){e.abort();for(const o of r)o?.removeEventListener!=null&&o.removeEventListener("abort",t)}for(const o of r){if(o?.aborted===!0){t();break}o?.addEventListener!=null&&o.addEventListener("abort",t)}function n(){for(const o of r)o?.removeEventListener!=null&&o.removeEventListener("abort",t)}const a=e.signal;return a.clear=n,a}function reliableTransportsFirst(r,e){const t=TCP$1.exactMatch(r.multiaddr),n=TCP$1.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const a=WebSocketsSecure$1.exactMatch(r.multiaddr),o=WebSocketsSecure$1.exactMatch(e.multiaddr);if(a&&!o)return-1;if(!a&&o)return 1;const c=WebSockets$1.exactMatch(r.multiaddr),u=WebSockets$1.exactMatch(e.multiaddr);if(c&&!u)return-1;if(!c&&u)return 1;const v=WebRTC.exactMatch(r.multiaddr),_=WebRTC.exactMatch(e.multiaddr);if(v&&!_)return-1;if(!v&&_)return 1;const x=WebRTCDirect$1.exactMatch(r.multiaddr),E=WebRTCDirect$1.exactMatch(e.multiaddr);if(x&&!E)return-1;if(!x&&E)return 1;const M=WebTransport$1.exactMatch(r.multiaddr),C=WebTransport$1.exactMatch(e.multiaddr);return M&&!C?-1:!M&&C?1:0}function publicAddressesFirst(r,e){const t=isPrivate(r.multiaddr),n=isPrivate(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function certifiedAddressesFirst(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function circuitRelayAddressesLast(r,e){const t=Circuit$2.exactMatch(r.multiaddr),n=Circuit$2.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function defaultAddressSorter(r){return r.sort(reliableTransportsFirst).sort(certifiedAddressesFirst).sort(circuitRelayAddressesLast).sort(publicAddressesFirst)}const defaultOptions$1={maxParallelDials:MAX_PARALLEL_DIALS,maxDialQueueLength:MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:MAX_PEER_ADDRS_TO_DIAL,dialTimeout:DIAL_TIMEOUT};class DialQueue{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;constructor(e,t={}){this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??defaultOptions$1.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??defaultOptions$1.maxDialQueueLength,this.dialTimeout=t.dialTimeout??defaultOptions$1.dialTimeout,this.connections=t.connections??new PeerMap,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal);for(const[n,a]of Object.entries(t.resolvers??{}))resolvers.set(n,a);this.queue=new PriorityQueue({concurrency:t.maxParallelDials??defaultOptions$1.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{n.detail.name!==AbortError$6.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal)}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){const{peerId:n,multiaddrs:a}=getPeerAddress(e),o=Array.from(this.connections.values()).flat().find(u=>t.force===!0?!1:u.remotePeer.equals(n)?!0:a.find(v=>v.equals(u.remoteAddr)));if(o?.status==="open")return this.log("already connected to %a",o.remoteAddr),t.onProgress?.(new CustomProgressEvent("dial-queue:already-connected")),o;const c=this.queue.queue.find(u=>{if(n?.equals(u.options.peerId)===!0)return!0;const v=u.options.multiaddrs;if(v==null)return!1;for(const _ of a)if(v.has(_.toString()))return!0;return!1});if(c!=null){this.log("joining existing dial target for %p",n);for(const u of a)c.options.multiaddrs.add(u.toString());return t.onProgress?.(new CustomProgressEvent("dial-queue:already-in-dial-queue")),c.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new DialError("Dial queue is full");return this.log("creating dial target for %p",n,a.map(u=>u.toString())),t.onProgress?.(new CustomProgressEvent("dial-queue:add-to-dial-queue")),this.queue.add(async u=>{u?.onProgress?.(new CustomProgressEvent("dial-queue:start-dial"));const v=anySignal([this.shutDownController.signal,u.signal]);setMaxListeners(1/0,v);let _;try{_=await this.calculateMultiaddrs(n,u?.multiaddrs,{...u,signal:v}),u?.onProgress?.(new CustomProgressEvent("dial-queue:calculated-addresses",_)),_.map(({multiaddr:x})=>x.toString()).forEach(x=>{u?.multiaddrs.add(x)})}catch(x){throw v.clear(),x}try{let x=0;const E=[];for(const M of _){if(x===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",x,n),new DialError("Peer had more than maxPeerAddrsToDial");x++;try{const C=await this.components.transportManager.dial(M.multiaddr,{...u,signal:v});this.log("dial to %a succeeded",M.multiaddr);try{await this.components.peerStore.merge(C.remotePeer,{multiaddrs:[C.remoteAddr],metadata:{[LAST_DIAL_SUCCESS_KEY]:fromString(Date.now().toString())}})}catch(I){this.log.error("could not update last dial failure key for %p",n,I)}return C}catch(C){if(this.log.error("dial failed to %a",M.multiaddr,C),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[LAST_DIAL_FAILURE_KEY]:fromString(Date.now().toString())}})}catch(I){this.log.error("could not update last dial failure key for %p",n,I)}if(v.aborted)throw new TimeoutError$1(C.message);E.push(C)}}throw E.length===1?E[0]:new AggregateError(E,"All multiaddr dials failed")}finally{v.clear()}},{peerId:n,priority:t.priority??DEFAULT_DIAL_PRIORITY,multiaddrs:new Set(a.map(u=>u.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async calculateMultiaddrs(e,t=new Set,n={}){const a=[...t].map(E=>({multiaddr:multiaddr(E),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new DialError("Tried to dial self");if(await this.components.connectionGater.denyDialPeer?.(e)===!0)throw new DialDeniedError("The dial request is blocked by gater.allowDialPeer");if(a.length===0){this.log("loading multiaddrs for %p",e);try{const E=await this.components.peerStore.get(e);a.push(...E.addresses),this.log("loaded multiaddrs for %p",e,a.map(({multiaddr:M})=>M.toString()))}catch(E){if(E.name!=="NotFoundError")throw E}}if(a.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const E=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,a.map(({multiaddr:M})=>M.toString())),a.push(...E.multiaddrs.map(M=>({multiaddr:M,isCertified:!1})))}catch(E){E.name!=="NoPeerRoutersError"&&this.log.error("looking up multiaddrs for %p in the peer routing failed",e,E)}}}let o=(await Promise.all(a.map(async E=>{const M=await resolveMultiaddrs(E.multiaddr,{dns:this.components.dns,...n,log:this.log});return M.length===1&&M[0].equals(E.multiaddr)?E:M.map(C=>({multiaddr:C,isCertified:!1}))}))).flat();if(e!=null){const E=`/p2p/${e.toString()}`;o=o.map(M=>M.multiaddr.protos().pop()?.path===!0?M:M.multiaddr.getPeerId()==null?{multiaddr:M.multiaddr.encapsulate(E),isCertified:M.isCertified}:M)}const c=o.filter(E=>{if(this.components.transportManager.dialTransportForMultiaddr(E.multiaddr)==null)return!1;const M=E.multiaddr.getPeerId();return e!=null&&M!=null?e.equals(M):!0}),u=new Map;for(const E of c){const M=E.multiaddr.toString(),C=u.get(M);if(C!=null){C.isCertified=C.isCertified||E.isCertified||!1;continue}u.set(M,E)}const v=[...u.values()];if(v.length===0)throw new NoValidAddressesError("The dial request has no valid addresses");const _=[];for(const E of v)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(E.multiaddr)||_.push(E);const x=this.addressSorter==null?defaultAddressSorter(_):_.sort(this.addressSorter);if(x.length===0)throw new DialDeniedError("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",o.map(({multiaddr:E})=>E.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",x.map(({multiaddr:E})=>E.toString())),x}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(a=>a.toString())),t);return t.runOnLimitedConnection===!1?n.find(a=>!Circuit$2.matches(a.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}class PeerQueue extends Queue{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}var retry$2={};function RetryOperation(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var retry_operation=RetryOperation;RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};RetryOperation.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};RetryOperation.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};RetryOperation.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};RetryOperation.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};RetryOperation.prototype.start=RetryOperation.prototype.try;RetryOperation.prototype.errors=function(){return this._errors};RetryOperation.prototype.attempts=function(){return this._attempts};RetryOperation.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var a=this._errors[n],o=a.message,c=(r[o]||0)+1;r[o]=c,c>=t&&(e=a,t=c)}return e};(function(r){var e=retry_operation;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in t)n[a]=t[a];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],c=0;c<n.retries;c++)o.push(this.createTimeout(c,n));return t&&t.forever&&!o.length&&o.push(this.createTimeout(c,n)),o.sort(function(u,v){return u-v}),o},r.createTimeout=function(t,n){var a=n.randomize?Math.random()+1:1,o=Math.round(a*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return o=Math.min(o,n.maxTimeout),o},r.wrap=function(t,n,a){if(n instanceof Array&&(a=n,n=null),!a){a=[];for(var o in t)typeof t[o]=="function"&&a.push(o)}for(var c=0;c<a.length;c++){var u=a[c],v=t[u];t[u]=function(x){var E=r.operation(n),M=Array.prototype.slice.call(arguments,1),C=M.pop();M.push(function(I){E.retry(I)||(I&&(arguments[0]=E.mainError()),C.apply(this,arguments))}),E.attempt(function(){x.apply(t,M)})}.bind(t,v),t[u].options=n}}})(retry$2);var retry=retry$2;const retry$1=getDefaultExportFromCjs(retry),objectToString=Object.prototype.toString,isError=r=>objectToString.call(r)==="[object Error]",errorMessages=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function isNetworkError(r){return r&&isError(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:errorMessages.has(r.message):!1}let AbortError$1=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};const decorateErrorWithCounts=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function pRetry(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,e.retries??=10;const a=retry$1.operation(e),o=()=>{a.stop(),n(e.signal?.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",o,{once:!0});const c=()=>{e.signal?.removeEventListener("abort",o),a.stop()};a.attempt(async u=>{try{const v=await r(u);c(),t(v)}catch(v){try{if(!(v instanceof Error))throw new TypeError(`Non-error was thrown: "${v}". You should only throw errors.`);if(v instanceof AbortError$1)throw v.originalError;if(v instanceof TypeError&&!isNetworkError(v))throw v;if(decorateErrorWithCounts(v,u,e),await e.shouldRetry(v)||(a.stop(),n(v)),await e.onFailedAttempt(v),!a.retry(v))throw a.mainError()}catch(_){decorateErrorWithCounts(_,u,e),c(),n(_)}}})})}class ReconnectQueue{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new PeerQueue({concurrency:t.maxParallelReconnects??MAX_PARALLEL_RECONNECTS,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(a=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,a)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);hasKeepAliveTag(t)&&(this.queue.has(e)||this.queue.add(async n=>{await pRetry(async a=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n?.signal})}catch(o){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,a,this.retries,o),o}},{signal:n?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const a={};[...t.tags.keys()].forEach(o=>{o.startsWith(KEEP_ALIVE)&&(a[o]=void 0)}),await this.peerStore.merge(e,{tags:a}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>hasKeepAliveTag(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function hasKeepAliveTag(r){for(const e of r.tags.keys())if(e.startsWith(KEEP_ALIVE))return!0;return!1}const DEFAULT_DIAL_PRIORITY=50,defaultOptions={maxConnections:MAX_CONNECTIONS,inboundConnectionThreshold:INBOUND_CONNECTION_THRESHOLD,maxIncomingPendingConnections:MAX_INCOMING_PENDING_CONNECTIONS};class DefaultConnectionManager{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(e,t={}){if(this.maxConnections=t.maxConnections??defaultOptions.maxConnections,this.maxConnections<1)throw new InvalidParametersError("Connection Manager maxConnections must be greater than 0");this.connections=new PeerMap,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(n=>multiaddrToIpNet(n)),this.deny=(t.deny??[]).map(n=>multiaddrToIpNet(n)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??defaultOptions.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new RateLimiter({points:t.inboundConnectionThreshold??defaultOptions.inboundConnectionThreshold,duration:1}),this.connectionPruner=new ConnectionPruner({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:t.allow?.map(n=>multiaddr(n))}),this.dialQueue=new DialQueue(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??MAX_PARALLEL_DIALS,maxDialQueueLength:t.maxDialQueueLength??MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:t.maxPeerAddrsToDial??MAX_PEER_ADDRS_TO_DIAL,dialTimeout:t.dialTimeout??DIAL_TIMEOUT,resolvers:t.resolvers??{dnsaddr:dnsaddrResolver},connections:this.connections}),this.reconnectQueue=new ReconnectQueue({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const t of this.connections.values())for(const n of t)e[n.direction]++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const n of t)for(const a of n.streams){const o=`${a.direction} ${a.protocol??"unnegotiated"}`;e[o]=(e[o]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const n of this.connections.values())for(const a of n){const o={};for(const c of a.streams){const u=`${c.direction} ${c.protocol??"unnegotiated"}`;o[u]=(o[u]??0)+1}for(const[c,u]of Object.entries(o))e[c]=e[c]??[],e[c].push(u)}const t={};for(let[n,a]of Object.entries(e)){a=a.sort((c,u)=>c-u);const o=Math.floor(a.length*.9);t[n]=a[o]}return t}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await start(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await stop(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(a){this.log.error(a)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,a=!this.connections.has(n),o=this.connections.get(n)??[];o.push(t),this.connections.set(n,o),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),a&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,o=(this.connections.get(n)??[]).filter(c=>c.id!==t.id);this.connections.set(n,o),o.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.started)throw new NotStartedError("Not started");this.outboundPendingConnections++;try{t.signal?.throwIfAborted();const{peerId:n}=getPeerAddress(e);if(this.peerId.equals(n))throw new InvalidPeerIdError("Can not dial self");if(n!=null&&t.force!==!0){this.log("dial %p",n);const u=this.getConnections(n).find(v=>v.limits==null);if(u!=null)return this.log("had an existing non-limited connection to %p",n),t.onProgress?.(new CustomProgressEvent("dial-queue:already-connected")),u}const a=await this.dialQueue.dial(e,{...t,priority:t.priority??DEFAULT_DIAL_PRIORITY});if(a.status!=="open")throw new ConnectionClosedError("Remote closed connection during opening");let o=this.connections.get(a.remotePeer);o==null&&(o=[],this.connections.set(a.remotePeer,o));let c=!1;for(const u of o)if(u.id===a.id&&(c=!0),t.force!==!0&&u.id!==a.id&&u.remoteAddr.equals(a.remoteAddr))return a.abort(new InvalidMultiaddrError("Duplicate multiaddr connection")),u;return c||o.push(a),a}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async a=>{try{await a.close(t)}catch(o){a.abort(o)}}))}async acceptIncomingConnection(e){if(this.deny.some(a=>a.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(a=>a.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const a=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(a,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,a),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>multiaddr(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}class MovingAverage{movingAverage;variance;deviation;forecast;timespan;previousTime;constructor(e){this.timespan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timespan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),a=e-this.movingAverage,o=n*a;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+a*o),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*a}else this.movingAverage=e;this.previousTime=t}}const DEFAULT_TIMEOUT_MULTIPLIER=1.2,DEFAULT_FAILURE_MULTIPLIER=2,DEFAULT_MIN_TIMEOUT=2e3;class AdaptiveTimeout{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;constructor(e={}){this.success=new MovingAverage(e.interval??5e3),this.failure=new MovingAverage(e.interval??5e3),this.next=new MovingAverage(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??DEFAULT_FAILURE_MULTIPLIER,this.timeoutMultiplier=e.timeoutMultiplier??DEFAULT_TIMEOUT_MULTIPLIER,this.minTimeout=e.minTimeout??DEFAULT_MIN_TIMEOUT,e.metricName!=null&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),n=AbortSignal.timeout(t),a=anySignal([e.signal,n]);return setMaxListeners(1/0,a,n),a.start=Date.now(),a.timeout=t,a}cleanUp(e){const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class QueuelessPushable{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=pDefer(),this.haveNext=pDefer()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=pDefer(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return await this._push(void 0),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=pDefer(),await raceSignal(this.readNext.promise,t?.signal,t)}}function queuelessPushable(){return new QueuelessPushable}let UnexpectedEOFError$1=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};class CodeError extends Error{code;constructor(e,t){super(e),this.code=t}}class AbortError extends CodeError{type;constructor(e){super(e,"ABORT_ERR"),this.type="aborted",this.name="AbortError"}}function byteStream(r,e){const t=queuelessPushable();r.sink(t).catch(async c=>{await t.end(c)}),r.sink=async c=>{for await(const u of c)await t.push(u);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const a=new Uint8ArrayList;return{read:async(c,u)=>{u?.signal?.throwIfAborted();let v;const _=new Promise((x,E)=>{v=()=>{E(new AbortError("Read aborted"))},u?.signal?.addEventListener("abort",v)});try{if(c==null){const{done:E,value:M}=await Promise.race([n.next(),_]);return E===!0?new Uint8ArrayList:M}for(;a.byteLength<c;){const{value:E,done:M}=await Promise.race([n.next(),_]);if(M===!0)throw new UnexpectedEOFError$1("unexpected end of input");a.append(E)}const x=a.sublist(0,c);return a.consume(c),x}finally{v!=null&&u?.signal?.removeEventListener("abort",v)}},write:async(c,u)=>{u?.signal?.throwIfAborted(),c instanceof Uint8Array?await t.push(c,u):await t.push(c.subarray(),u)},unwrap:()=>{if(a.byteLength>0){const c=r.source;r.source=async function*(){e?.yieldBytes===!1?yield a:yield*a,yield*c}()}return r}}}const DEFAULT_PING_INTERVAL_MS=1e4,PROTOCOL_VERSION="1.0.0",PROTOCOL_NAME="ping",PROTOCOL_PREFIX="ipfs",PING_LENGTH=32,DEFAULT_ABORT_CONNECTION_ON_PING_FAILURE=!0;class ConnectionMonitor{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(e,t={}){this.components=e,this.protocol=`/${t.protocolPrefix??PROTOCOL_PREFIX}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??DEFAULT_PING_INTERVAL_MS,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??DEFAULT_ABORT_CONNECTION_ON_PING_FAILURE,this.timeout=new AdaptiveTimeout({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[serviceCapabilities]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,setMaxListeners(1/0,this.abortController.signal),this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{let t=Date.now();try{const n=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),a=await e.newStream(this.protocol,{signal:n,runOnLimitedConnection:!0}),o=byteStream(a);t=Date.now(),await Promise.all([o.write(randomBytes(PING_LENGTH),{signal:n}),o.read(PING_LENGTH,{signal:n})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:n})}catch(n){if(n.name!=="UnsupportedProtocolError")throw n;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}function isAsyncIterable$4(r){return r[Symbol.asyncIterator]!=null}function merge$1(...r){const e=[];for(const t of r)isAsyncIterable$4(t)||e.push(t);return e.length===r.length?function*(){for(const t of e)yield*t}():async function*(){const t=pushable({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async n=>{for await(const a of n)t.push(a)})),t.end()}catch(n){t.end(n)}}),yield*t}()}class CompoundContentRouting{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=e.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],a)=>({...a,cid:n.toString()}),getAttributesFromYieldedValue:(n,a)=>({...a,providers:[...Array.isArray(a.providers)?a.providers:[],n.id.toString()]})})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],a)=>({...a,cid:n.toString()})})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],a)=>({...a,cid:n.toString()})})??this.cancelReprovide,this.put=e.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([n])=>({key:toString$1(n,"base36")})})??this.put,this.get=e.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([n])=>({key:toString$1(n,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");const n=this,a=new PeerSet;for await(const o of merge$1(...n.routers.map(c=>c.findProviders(e,t))))o!=null&&(o.multiaddrs.length>0&&await this.components.peerStore.merge(o.id,{multiaddrs:o.multiaddrs}),!a.has(o.id)&&(a.add(o.id),yield o))}async provide(e,t={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");await Promise.all(this.routers.map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new NotStartedError;await Promise.all(this.routers.map(async a=>{await a.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new NotStartedError;return Promise.any(this.routers.map(async n=>n.get(e,t)))}}const CustomEvent$1=globalThis.CustomEvent??Event;async function*parallel(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered==null?!1:e.ordered,a=new EventTarget,o=[];let c=pDefer(),u=pDefer(),v=!1,_,x=!1;a.addEventListener("task-complete",()=>{u.resolve()}),Promise.resolve().then(async()=>{try{for await(const I of r){if(o.length===t&&(c=pDefer(),await c.promise),x)break;const D={done:!1};o.push(D),I().then(L=>{D.done=!0,D.ok=!0,D.value=L,a.dispatchEvent(new CustomEvent$1("task-complete"))},L=>{D.done=!0,D.err=L,a.dispatchEvent(new CustomEvent$1("task-complete"))})}v=!0,a.dispatchEvent(new CustomEvent$1("task-complete"))}catch(I){_=I,a.dispatchEvent(new CustomEvent$1("task-complete"))}});function E(){return n?o[0]?.done:!!o.find(I=>I.done)}function*M(){for(;o.length>0&&o[0].done;){const I=o[0];if(o.shift(),I.ok)yield I.value;else throw x=!0,c.resolve(),I.err;c.resolve()}}function*C(){for(;E();)for(let I=0;I<o.length;I++)if(o[I].done){const D=o[I];if(o.splice(I,1),I--,D.ok)yield D.value;else throw x=!0,c.resolve(),D.err;c.resolve()}}for(;;){if(E()||(u=pDefer(),await u.promise),_!=null)throw _;if(n?yield*M():yield*C(),v&&o.length===0)break}}class DefaultPeerRouting{log;peerId;peerStore;routers;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=e.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],a)=>({...a,peer:n.toString()})})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],a)=>({...a,key:toString$1(n,"base36")}),getAttributesFromYieldedValue:(n,a)=>({...a,peers:[...Array.isArray(a.peers)?a.peers:[],n.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(e,t){if(this.routers.length===0)throw new NoPeerRoutersError("No peer routers available");if(e.toString()===this.peerId.toString())throw new QueriedForSelfError("Should not try to find self");const n=this,a=merge$1(...this.routers.map(o=>async function*(){try{yield await o.findPeer(e,t)}catch(c){n.log.error(c)}}()));for await(const o of a)if(o!=null)return o.multiaddrs.length>0&&await this.peerStore.merge(o.id,{multiaddrs:o.multiaddrs}),o;throw new NotFoundError$1}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new NoPeerRoutersError("No peer routers available");const n=this,a=createScalableCuckooFilter(1024);for await(const o of parallel(async function*(){const c=merge$1(...n.routers.map(u=>u.getClosestPeers(e,t)));for await(let u of c)yield async()=>{if(u.multiaddrs.length===0)try{u=await n.findPeer(u.id,{...t,useCache:!1})}catch(v){n.log.error("could not find peer multiaddrs",v);return}return u}}()))o!=null&&(o.multiaddrs.length>0&&await this.peerStore.merge(o.id,{multiaddrs:o.multiaddrs}),!a.has(o.id.toMultihash().bytes)&&(a.add(o.id.toMultihash().bytes),yield o))}}class RandomWalk extends TypedEventEmitter{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(e){super(),this.log=e.logger.forComponent("libp2p:random-walk"),this.peerRouting=e.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,setMaxListeners(1/0,this.shutdownController.signal)}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,setMaxListeners(1/0,this.shutdownController.signal)}stop(){this.shutdownController.abort()}async*walk(e){this.walking||this.startWalk(),this.walkers++;const t=anySignal([this.shutdownController.signal,e?.signal]);setMaxListeners(1/0,t);try{for(;;)this.needNext?.resolve(),this.needNext=pDefer(),yield(await raceEvent(this,"walk:peer",t,{errorEvent:"walk:error"})).detail}finally{t.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,setMaxListeners(1/0,this.walkController.signal);const e=anySignal([this.walkController.signal,this.shutdownController.signal]);setMaxListeners(1/0,e);const t=Date.now();let n=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const a=randomBytes(32);let o=Date.now();for await(const c of this.peerRouting.getClosestPeers(a,{signal:e}))e.aborted&&this.log("aborting walk"),e.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",c.id,Date.now()-o,this.walkers),n++,this.safeDispatchEvent("walk:peer",{detail:c}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await raceSignal(this.needNext.promise,e)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",a,this.walkers,n)}catch(a){this.log.error("randomwalk errored",a),this.safeDispatchEvent("walk:error",{detail:a})}this.log("no walkers left, ended walk")}).catch(a=>{this.log.error("randomwalk errored",a)}).finally(()=>{this.log("finished walk, found %d peers after %dms",n,Date.now()-t),this.walking=!1})}}const DEFAULT_MAX_INBOUND_STREAMS$1=32,DEFAULT_MAX_OUTBOUND_STREAMS$1=64;class DefaultRegistrar{log;topologies;handlers;components;constructor(e){this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new UnhandledProtocolError(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw new DuplicateProtocolHandlerError(`Handler already registered for protocol ${e}`);const a=mergeOptions$1.bind({ignoreUndefined:!0})({maxInboundStreams:DEFAULT_MAX_INBOUND_STREAMS$1,maxOutboundStreams:DEFAULT_MAX_OUTBOUND_STREAMS$1},n);this.handlers.set(e,{handler:t,options:a}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new InvalidParametersError("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let a=this.topologies.get(e);return a==null&&(a=new Map,this.topologies.set(e,a)),a.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(n=>{for(const a of n.protocols){const o=this.topologies.get(a);if(o!=null)for(const c of o.values())c.filter?.has(t)!==!1&&(c.filter?.remove(t),c.onDisconnect?.(t))}}).catch(n=>{n.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,n)})}_onPeerUpdate(e){const{peer:t,previous:n}=e.detail,a=(n?.protocols??[]).filter(o=>!t.protocols.includes(o));for(const o of a){const c=this.topologies.get(o);if(c!=null)for(const u of c.values())u.filter?.has(t.id)!==!1&&(u.filter?.remove(t.id),u.onDisconnect?.(t.id))}}_onPeerIdentify(e){const t=e.detail.protocols,n=e.detail.connection,a=e.detail.peerId;for(const o of t){const c=this.topologies.get(o);if(c!=null)for(const u of c.values())n.limits!=null&&u.notifyOnLimitedConnection!==!0||u.filter?.has(a)!==!0&&(u.filter?.add(a),u.onConnect?.(a,n))}}}class TrackedMap extends Map{metric;constructor(e){super();const{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedMap(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new TrackedMap({name:e,metrics:t}):n=new Map,n}class DefaultTransportManager{log;components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=trackedMap({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??FaultTolerance.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(e){const t=e[Symbol.toStringTag];if(t==null)throw new InvalidParametersError("Transport must have a valid tag");if(this.transports.has(t))throw new InvalidParametersError(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const a=n.pop();a!=null&&e.push(a.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){const n=this.dialTransportForMultiaddr(e);if(n==null)throw new TransportUnavailableError(`No transport available for address ${String(e)}`);return t?.onProgress?.(new CustomProgressEvent("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new NotStartedError("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t=[];for(const[n,a]of this.transports.entries()){const o=a.listenFilter(e),c=[];for(const _ of o){this.log("creating listener for %s on %a",n,_);const x=a.createListener({upgrader:this.components.upgrader});let E=this.listeners.get(n)??[];E==null&&(E=[],this.listeners.set(n,E)),E.push(x),x.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:x})}),x.addEventListener("close",()=>{const M=E.findIndex(C=>C===x);E.splice(M,1),this.components.events.safeDispatchEvent("transport:close",{detail:x})}),c.push(x.listen(_))}if(c.length===0){t.push(n);continue}if((await Promise.allSettled(c)).find(_=>_.status==="fulfilled")==null&&this.faultTolerance!==FaultTolerance.NO_FATAL)throw new NoValidAddressesError(`Transport (${n}) could not listen on any available address`)}if(t.length===this.transports.size){const n=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===FaultTolerance.FATAL_ALL)throw new NoValidAddressesError(n);this.log(`libp2p in dial mode only: ${n}`)}}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const a=t.pop();a!=null&&n.push(a.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const PROTOCOL_ID="/multistream/1.0.0",MAX_PROTOCOL_LENGTH=1024;let InvalidMessageLengthError$1=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},InvalidDataLengthError$1=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},InvalidDataLengthLengthError$1=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function lpStream(r,e={}){const t=byteStream(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=encodingLength(e.maxDataLength));const n=e?.lengthDecoder??decode$1,a=e?.lengthEncoder??encode$2;return{read:async c=>{let u=-1;const v=new Uint8ArrayList;for(;;){v.append(await t.read(1,c));try{u=n(v)}catch(_){if(_ instanceof RangeError)continue;throw _}if(u<0)throw new InvalidMessageLengthError$1("Invalid message length");if(e?.maxLengthLength!=null&&v.byteLength>e.maxLengthLength)throw new InvalidDataLengthLengthError$1("message length length too long");if(u>-1)break}if(e?.maxDataLength!=null&&u>e.maxDataLength)throw new InvalidDataLengthError$1("message length too long");return t.read(u,c)},write:async(c,u)=>{await t.write(new Uint8ArrayList(a(c.byteLength),c),u)},writeV:async(c,u)=>{const v=new Uint8ArrayList(...c.flatMap(_=>[a(_.byteLength),_]));await t.write(v,u)},unwrap:()=>t.unwrap()}}const NewLine=fromString(`
`);async function write(r,e,t){await r.write(e,t)}async function writeAll(r,e,t){await r.writeV(e,t)}async function read(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==NewLine[0])throw e.log.error("Invalid mss message - missing newline",t),new InvalidMessageError("Missing newline");return t.sublist(0,-1)}async function readString(r,e){const t=await read(r,e);return toString$1(t.subarray())}async function select(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return optimisticSelect(r,e[0],t);const n=lpStream(r,{...t,maxDataLength:MAX_PROTOCOL_LENGTH}),a=e.shift();if(a==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',PROTOCOL_ID,a);const o=fromString(`${PROTOCOL_ID}
`),c=fromString(`${a}
`);await writeAll(n,[o,c],t),t.log.trace("select: reading multistream-select header");let u=await readString(n,t);if(t.log.trace('select: read "%s"',u),u===PROTOCOL_ID&&(t.log.trace("select: reading protocol response"),u=await readString(n,t),t.log.trace('select: read "%s"',u)),u===a)return{stream:n.unwrap(),protocol:a};for(const v of e){t.log.trace('select: write "%s"',v),await write(n,fromString(`${v}
`),t),t.log.trace("select: reading protocol response");const _=await readString(n,t);if(t.log.trace('select: read "%s" for "%s"',_,v),_===v)return{stream:n.unwrap(),protocol:v}}throw new UnsupportedProtocolError("protocol selection failed")}function optimisticSelect(r,e,t){const n=r.sink.bind(r),a=r.source;let o=!1,c=!1;const u=pDefer();let v=!1,_=!1;const x=pDefer();let E=!1,M=!1;const C=pDefer(),I=lpStream({sink:n,source:a},{...t,maxDataLength:MAX_PROTOCOL_LENGTH});r.sink=async q=>{const{sink:F}=I.unwrap();await F(async function*(){let U=!1;for await(const j of q){if(_&&await x.promise,v)yield j;else{_=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',PROTOCOL_ID,e,j.byteLength);const W=`${e}
`;yield new Uint8ArrayList(Uint8Array.from([19]),fromString(`${PROTOCOL_ID}
`),encode$2(W.length),fromString(W),j).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',PROTOCOL_ID,e,j.byteLength),v=!0,_=!1,x.resolve(),D().catch(X=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,X)})}U=!0}U||await D()}())};async function D(){if(c){t.log.trace("optimistic: already negotiating %s stream",e),await u.promise;return}c=!0;try{v||(t.log.trace("optimistic: doing send protocol for %s stream",e),await L()),E||(t.log.trace("optimistic: doing read protocol for %s stream",e),await N())}finally{c=!1,o=!0,u.resolve()}}async function L(){if(_){await x.promise;return}_=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',PROTOCOL_ID,e),await I.writeV([fromString(`${PROTOCOL_ID}
`),fromString(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',PROTOCOL_ID,e)}finally{v=!0,_=!1,x.resolve()}}async function N(){if(M){await C.promise;return}M=!0;try{t.log.trace("optimistic: reading multistream select header");let q=await readString(I,t);if(t.log.trace('optimistic: read multistream select header "%s"',q),q===PROTOCOL_ID&&(q=await readString(I,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',q,e),q!==e)throw new UnsupportedProtocolError("protocol selection failed")}finally{E=!0,M=!1,C.resolve()}}if(r.source=async function*(){await D(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*I.unwrap().source}(),r.closeRead!=null){const q=r.closeRead.bind(r);r.closeRead=async F=>{o||await D().catch(U=>{t.log.error("could not negotiate protocol before close read",U)}),await q(F)}}if(r.closeWrite!=null){const q=r.closeWrite.bind(r);r.closeWrite=async F=>{o||await D().catch(U=>{t.log.error("could not negotiate protocol before close write",U)}),await q(F)}}if(r.close!=null){const q=r.close.bind(r);r.close=async F=>{const U=[];_&&U.push(x.promise),M&&U.push(C.promise),U.length>0?await raceSignal(Promise.all(U),F?.signal):(o=!0,c=!1,u.resolve()),await q(F)}}return{stream:r,protocol:e}}function isAsyncIterable$3(r){return r[Symbol.asyncIterator]!=null}const defaultEncoder=r=>{const e=encodingLength(r),t=allocUnsafe(e);return encode$2(r,t),defaultEncoder.bytes=e,t};defaultEncoder.bytes=0;function encode$1(r,e){e=e??{};const t=e.lengthEncoder??defaultEncoder;function*n(a){const o=t(a.byteLength);o instanceof Uint8Array?yield o:yield*o,a instanceof Uint8Array?yield a:yield*a}return isAsyncIterable$3(r)?async function*(){for await(const a of r)yield*n(a)}():function*(){for(const a of r)yield*n(a)}()}encode$1.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??defaultEncoder;return new Uint8ArrayList(t(r.byteLength),r)};class InvalidMessageLengthError extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class InvalidDataLengthError extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class InvalidDataLengthLengthError extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class UnexpectedEOFError extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}const MAX_LENGTH_LENGTH=8,MAX_DATA_LENGTH=1024*1024*4;var ReadMode;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ReadMode||(ReadMode={}));const defaultDecoder=r=>{const e=decode$1(r);return defaultDecoder.bytes=encodingLength(e),e};defaultDecoder.bytes=0;function decode(r,e){const t=new Uint8ArrayList;let n=ReadMode.LENGTH,a=-1;const o=e?.lengthDecoder??defaultDecoder,c=e?.maxLengthLength??MAX_LENGTH_LENGTH,u=e?.maxDataLength??MAX_DATA_LENGTH;function*v(){for(;t.byteLength>0;){if(n===ReadMode.LENGTH)try{if(a=o(t),a<0)throw new InvalidMessageLengthError("Invalid message length");if(a>u)throw new InvalidDataLengthError("Message length too long");const _=o.bytes;t.consume(_),e?.onLength!=null&&e.onLength(a),n=ReadMode.DATA}catch(_){if(_ instanceof RangeError){if(t.byteLength>c)throw new InvalidDataLengthLengthError("Message length length too long");break}throw _}if(n===ReadMode.DATA){if(t.byteLength<a)break;const _=t.sublist(0,a);t.consume(a),e?.onData!=null&&e.onData(_),yield _,n=ReadMode.LENGTH}}}return isAsyncIterable$3(r)?async function*(){for await(const _ of r)t.append(_),yield*v();if(t.byteLength>0)throw new UnexpectedEOFError("Unexpected end of input")}():function*(){for(const _ of r)t.append(_),yield*v();if(t.byteLength>0)throw new UnexpectedEOFError("Unexpected end of input")}()}decode.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:o,value:c}=await r.next(t);if(o===!0)return;c!=null&&(yield c)}catch(o){if(o.code==="ERR_UNDER_READ")return{done:!0,value:null};throw o}finally{t=1}}();return decode(n,{...e??{},onLength:o=>{t=o}})};async function handle(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=lpStream(r,{...t,maxDataLength:MAX_PROTOCOL_LENGTH,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const a=await readString(n,t);if(t.log.trace('handle: read "%s"',a),a===PROTOCOL_ID){t.log.trace('handle: respond with "%s" for "%s"',PROTOCOL_ID,a),await write(n,fromString(`${PROTOCOL_ID}
`),t),t.log.trace('handle: responded with "%s" for "%s"',PROTOCOL_ID,a);continue}if(e.includes(a))return t.log.trace('handle: respond with "%s" for "%s"',a,a),await write(n,fromString(`${a}
`),t),t.log.trace('handle: responded with "%s" for "%s"',a,a),{stream:n.unwrap(),protocol:a};if(a==="ls"){const o=new Uint8ArrayList(...e.map(c=>encode$1.single(fromString(`${c}
`))),fromString(`
`));t.log.trace('handle: respond with "%s" for %s',e,a),await write(n,o,t),t.log.trace('handle: responded with "%s" for %s',e,a);continue}t.log.trace('handle: respond with "na" for "%s"',a),await write(n,fromString(`na
`),t),t.log('handle: responded with "na" for "%s"',a)}}const CLOSE_TIMEOUT$1=500;class ConnectionImpl{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;_newStream;_close;_abort;_getStreams;constructor(e){const{remoteAddr:t,remotePeer:n,newStream:a,close:o,abort:c,getStreams:u}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=a,this._close=o,this._abort=c,this._getStreams=u,this.tags=[]}[Symbol.toStringTag]="Connection";[connectionSymbol]=!0;get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new ConnectionClosingError("the connection is being closed");if(this.status==="closed")throw new ConnectionClosedError("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&t?.runOnLimitedConnection!==!0)throw new LimitedConnectionError("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(CLOSE_TIMEOUT$1);setMaxListeners(1/0,t),e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function createConnection(r){return new ConnectionImpl(r)}function findIncomingStreamLimit(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return DEFAULT_MAX_INBOUND_STREAMS$1}function findOutgoingStreamLimit(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS$1}function countStreams(r,e,t){let n=0;return t.streams.forEach(a=>{a.direction===e&&a.protocol===r&&n++}),n}class DefaultUpgrader{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;outboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(e,t){this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(n=>{this.connectionEncrypters.set(n.protocol,n)}),this.streamMuxers=new Map,t.streamMuxers.forEach(n=>{this.streamMuxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??UPGRADE_TIMEOUT,this.outboundUpgradeTimeout=t.outboundUpgradeTimeout??UPGRADE_TIMEOUT,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.events=e.events,this.metrics={dials:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new ConnectionInterceptedError(`The multiaddr connection is blocked by gater.${e}`)}async upgradeInbound(e,t={}){let n=!1;try{if(this.metrics.dials?.increment({inbound:!0}),n=await this.components.connectionManager.acceptIncomingConnection(e),!n)throw new ConnectionDeniedError("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",t)}catch(a){throw this.metrics.errors?.increment({inbound:!0}),a}finally{n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t={}){try{this.metrics.dials?.increment({outbound:!0});const n=e.remoteAddr.getPeerId();let a;n!=null&&(a=peerIdFromString$1(n),await this.shouldBlockConnection("denyOutboundConnection",a,e));let o="outbound";return t.initiator===!1&&(o="inbound"),await this._performUpgrade(e,o,t)}catch(n){throw this.metrics.errors?.increment({outbound:!0}),n}}async _performUpgrade(e,t,n){let a,o,c,u,v;const _=AbortSignal.timeout(t==="inbound"?this.inboundUpgradeTimeout:this.outboundUpgradeTimeout),x=anySignal([_,n.signal]);setMaxListeners(1/0,_,x),n.signal=x,this.components.metrics?.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let E=e;if(n?.skipProtection!==!0){const M=this.components.connectionProtector;M!=null&&(e.log("protecting the %s connection",t),E=await M.protect(e,n))}try{if(a=E,n?.skipEncryption!==!0){n?.onProgress?.(new CustomProgressEvent(`upgrader:encrypt-${t}-connection`)),{conn:a,remotePeer:o,protocol:v}=await(t==="inbound"?this._encryptInbound(E,{...n,signal:x}):this._encryptOutbound(E,{...n,signal:x}));const M={...E,...a};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",o,M)}else{const M=e.remoteAddr.getPeerId();if(M==null)throw new InvalidMultiaddrError(`${t} connection that skipped encryption must have a peer id`);const C=peerIdFromString$1(M);v="native",o=C}if(o.equals(this.components.peerId)){const M=new InvalidPeerIdError("Can not dial self");throw e.abort(M),M}if(c=a,n?.muxerFactory!=null)u=n.muxerFactory;else if(this.streamMuxers.size>0){n?.onProgress?.(new CustomProgressEvent(`upgrader:multiplex-${t}-connection`));const M=await(t==="inbound"?this._multiplexInbound({...E,...a},this.streamMuxers,n):this._multiplexOutbound({...E,...a},this.streamMuxers,n));u=M.muxerFactory,c=M.stream}}catch(M){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,M),M}finally{x.clear()}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",o,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:v,direction:t,maConn:e,upgradedConn:c,muxerFactory:u,remotePeer:o,limits:n?.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:a,upgradedConn:o,remotePeer:c,muxerFactory:u,limits:v}=e;let _,x,E;u!=null&&(_=u.createStreamMuxer({direction:n,onIncomingStream:I=>{E!=null&&Promise.resolve().then(async()=>{const D=this.components.registrar.getProtocols(),L=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);setMaxListeners(1/0,L);const{stream:N,protocol:q}=await handle(I,D,{signal:L,log:I.log,yieldBytes:!1});if(E==null)return;E.log("incoming stream opened on %s",q);const F=findIncomingStreamLimit(q,this.components.registrar);if(countStreams(q,"inbound",E)===F){const j=new TooManyInboundProtocolStreamsError(`Too many inbound protocol streams for protocol "${q}" - limit ${F}`);throw I.abort(j),j}I.source=N.source,I.sink=N.sink,I.protocol=q,N.closeWrite!=null&&(I.closeWrite=N.closeWrite),N.closeRead!=null&&(I.closeRead=N.closeRead),N.close!=null&&(I.close=N.close),await this.components.peerStore.merge(c,{protocols:[q]}),this.components.metrics?.trackProtocolStream(I,E),this._onStream({connection:E,stream:I,protocol:q})}).catch(async D=>{E.log.error("error handling incoming stream id %s - %e",I.id,D),I.timeline.close==null&&await I.close()})}}),x=async(I,D={})=>{if(_==null)throw new MuxerUnavailableError("Connection is not multiplexed");E.log.trace("starting new stream for protocols %s",I);const L=await _.newStream();E.log.trace("started new stream %s for protocols %s",L.id,I);try{if(D.signal==null){L.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",I);const j=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);setMaxListeners(1/0,j),D={...D,signal:j}}L.log.trace("selecting protocol from protocols %s",I);const{stream:N,protocol:q}=await select(L,I,{...D,log:L.log,yieldBytes:!0});L.log.trace("selected protocol %s",q);const F=findOutgoingStreamLimit(q,this.components.registrar,D),U=countStreams(q,"outbound",E);if(U>=F){const j=new TooManyOutboundProtocolStreamsError(`Too many outbound protocol streams for protocol "${q}" - ${U}/${F}`);throw L.abort(j),j}return await this.components.peerStore.merge(c,{protocols:[q]}),L.source=N.source,L.sink=N.sink,L.protocol=q,N.closeWrite!=null&&(L.closeWrite=N.closeWrite),N.closeRead!=null&&(L.closeRead=N.closeRead),N.close!=null&&(L.close=N.close),this.components.metrics?.trackProtocolStream(L,E),L}catch(N){throw E.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,I,N),L.timeline.close==null&&L.abort(N),N}},Promise.all([_.sink(o.source),o.sink(_.source)]).catch(I=>{E.log.error("error piping data through muxer - %e",I)}));const M=a.timeline;a.timeline=new Proxy(M,{set:(...I)=>(I[1]==="close"&&I[2]!=null&&M.close==null&&(async()=>{try{E.status==="open"&&await E.close()}catch(D){E.log.error("error closing connection after timeline close %e",D)}finally{this.events.safeDispatchEvent("connection:close",{detail:E})}})().catch(D=>{E.log.error("error thrown while dispatching connection:close event %e",D)}),Reflect.set(...I))}),a.timeline.upgraded=Date.now();const C=()=>{throw new MuxerUnavailableError("Connection is not multiplexed")};return E=createConnection({remoteAddr:a.remoteAddr,remotePeer:c,status:"open",direction:n,timeline:a.timeline,multiplexer:_?.protocol,encryption:t,limits:v,logger:this.components.logger,newStream:x??C,getStreams:()=>_?.streams??[],close:async I=>{await _?.close(I),await a.close(I)},abort:I=>{a.abort(I),_?.abort(I)}}),this.events.safeDispatchEvent("connection:open",{detail:E}),E.__maConnTimeline=M,E}_onStream(e){const{connection:t,stream:n,protocol:a}=e,{handler:o,options:c}=this.components.registrar.getHandler(a);if(t.limits!=null&&c.runOnLimitedConnection!==!0)throw new LimitedConnectionError("Cannot open protocol stream on limited connection");o({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:a,protocol:o}=await handle(e,n,{...t,log:e.log}),c=this.connectionEncrypters.get(o);if(c==null)throw new EncryptionFailedError(`no crypto module found for ${o}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,o),{...await c.secureInbound(a,t),protocol:o}}catch(a){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,a),new EncryptionFailedError(a.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:a,protocol:o}=await select(e,n,{...t,log:e.log,yieldBytes:!0}),c=this.connectionEncrypters.get(o);if(c==null)throw new EncryptionFailedError(`no crypto module found for ${o}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,o),{...await c.secureOutbound(a,t),protocol:o}}catch(a){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,a),new EncryptionFailedError(a.message)}}async _multiplexOutbound(e,t,n){const a=Array.from(t.keys());e.log("outbound selecting muxer %s",a);try{e.log.trace("selecting stream muxer from %s",a);const{stream:o,protocol:c}=await select(e,a,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",c);const u=t.get(c);return{stream:o,muxerFactory:u}}catch(o){throw e.log.error("error multiplexing outbound connection",o),new MuxerUnavailableError(String(o))}}async _multiplexInbound(e,t,n){const a=Array.from(t.keys());e.log("inbound handling muxers %s",a);try{const{stream:o,protocol:c}=await handle(e,a,{...n,log:e.log}),u=t.get(c);return{stream:o,muxerFactory:u}}catch(o){throw e.log.error("error multiplexing inbound connection",o),new MuxerUnavailableError(String(o))}}}const version$1="2.5.2",name="js-libp2p";class Libp2p extends TypedEventEmitter{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(e){super(),this.status="stopped";const t=new TypedEventEmitter,n=t.dispatchEvent.bind(t);t.dispatchEvent=u=>{const v=n(u),_=this.dispatchEvent(new CustomEvent(u.type,{detail:u.detail}));return v||_},setMaxListeners(1/0,t),this.peerId=e.peerId,this.logger=e.logger??defaultLogger(),this.log=this.logger.forComponent("libp2p"),this.services={};const a=this.components=defaultComponents({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:e.nodeInfo??{name,version:version$1},logger:this.logger,events:t,datastore:e.datastore??new MemoryDatastore,connectionGater:connectionGater(e.connectionGater),dns:e.dns});this.peerStore=this.configureComponent("peerStore",persistentPeerStore(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),e.metrics!=null&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),a.events.addEventListener("peer:update",u=>{if(u.detail.previous==null){const v={id:u.detail.peer.id,multiaddrs:u.detail.peer.addresses.map(_=>_.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:v})}}),e.connectionProtector!=null&&this.configureComponent("connectionProtector",e.connectionProtector(a)),this.components.upgrader=new DefaultUpgrader(this.components,{connectionEncrypters:(e.connectionEncrypters??[]).map((u,v)=>this.configureComponent(`connection-encryption-${v}`,u(this.components))),streamMuxers:(e.streamMuxers??[]).map((u,v)=>this.configureComponent(`stream-muxers-${v}`,u(this.components))),inboundUpgradeTimeout:e.connectionManager?.inboundUpgradeTimeout,outboundUpgradeTimeout:e.connectionManager?.outboundUpgradeTimeout}),this.configureComponent("transportManager",new DefaultTransportManager(this.components,e.transportManager)),this.configureComponent("connectionManager",new DefaultConnectionManager(this.components,e.connectionManager)),e.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new ConnectionMonitor(this.components,e.connectionMonitor)),this.configureComponent("registrar",new DefaultRegistrar(this.components)),this.configureComponent("addressManager",new AddressManager(this.components,e.addresses));const o=(e.peerRouters??[]).map((u,v)=>this.configureComponent(`peer-router-${v}`,u(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new DefaultPeerRouting(this.components,{routers:o}));const c=(e.contentRouters??[]).map((u,v)=>this.configureComponent(`content-router-${v}`,u(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new CompoundContentRouting(this.components,{routers:c})),this.configureComponent("randomWalk",new RandomWalk(this.components)),(e.peerDiscovery??[]).forEach((u,v)=>{this.configureComponent(`peer-discovery-${v}`,u(this.components)).addEventListener("peer",x=>{this.#e(x)})}),e.transports?.forEach((u,v)=>{this.components.transportManager.add(this.configureComponent(`transport-${v}`,u(this.components)))}),e.services!=null)for(const u of Object.keys(e.services)){const v=e.services[u],_=v(this.components);if(_==null){this.log.error("service factory %s returned null or undefined instance",u);continue}this.services[u]=_,this.configureComponent(u,_),_[contentRoutingSymbol]!=null&&(this.log("registering service %s for content routing",u),c.push(_[contentRoutingSymbol])),_[peerRoutingSymbol]!=null&&(this.log("registering service %s for peer routing",u),o.push(_[peerRoutingSymbol])),_[peerDiscoverySymbol]!=null&&(this.log("registering service %s for peer discovery",u),_[peerDiscoverySymbol].addEventListener?.("peer",x=>{this.#e(x)}))}checkServiceDependencies(a)}configureComponent(e,t){return t==null&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(e){throw this.log.error("An error occurred starting libp2p",e),this.status="started",await this.stop(),e}}}async stop(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const e=new PeerSet;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return this.components.connectionManager.openConnection(e,{priority:75,...t})}async dialProtocol(e,t,n={}){if(t==null)throw new InvalidParametersError("no protocols were provided to open a stream");if(t=Array.isArray(t)?t:[t],t.length===0)throw new InvalidParametersError("no protocols were provided to open a stream");return(await this.dial(e,n)).newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e,t={}){isMultiaddr(e)&&(e=peerIdFromString$1(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e,t)}async getPublicKey(e,t={}){if(this.log("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;try{const c=await this.peerStore.get(e);if(c.id.publicKey!=null)return c.id.publicKey}catch(c){if(c.name!=="NotFoundError")throw c}const n=concat$1([fromString("/pk/"),e.toMultihash().bytes]),a=await this.contentRouting.get(n,t),o=publicKeyFromProtobuf(a);return await this.peerStore.patch(e,{publicKey:o}),o}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async a=>{await this.components.registrar.handle(a,t,n)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async t=>{await this.components.registrar.unhandle(t)}))}async register(e,t){return this.components.registrar.register(e,t)}unregister(e){this.components.registrar.unregister(e)}async isDialable(e,t={}){return this.components.connectionManager.isDialable(e,t)}#e(e){const{detail:t}=e;if(t.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch(n=>{this.log.error(n)})}}async function createLibp2p(r={}){r.privateKey??=await generateKeyPair();const e=new Libp2p({...await validateConfig(r),peerId:peerIdFromPrivateKey(r.privateKey)});return r.start!==!1&&await e.start(),e}var __spreadArray=function(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,o;n<a;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},BrowserInfo=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),NodeInfo=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=dist.process.platform}return r}(),SearchBotDeviceInfo=function(){function r(e,t,n,a){this.name=e,this.version=t,this.os=n,this.bot=a,this.type="bot-device"}return r}(),BotInfo=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),ReactNativeInfo=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(r){return r!==""&&userAgentRules.reduce(function(e,t){var n=t[0],a=t[1];if(e)return e;var o=a.exec(r);return!!o&&[n,o]},!1)}function parseUserAgent(r){var e=matchUserAgent(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new BotInfo;var a=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);a?a.length<REQUIRED_VERSION_PARTS&&(a=__spreadArray(__spreadArray([],a,!0),createVersionParts(REQUIRED_VERSION_PARTS-a.length),!0)):a=[];var o=a.join("."),c=detectOS(r),u=SEARCHBOT_OS_REGEX.exec(r);return u&&u[1]?new SearchBotDeviceInfo(t,o,c,u[1]):new BrowserInfo(t,o,c)}function detectOS(r){for(var e=0,t=operatingSystemRules.length;e<t;e++){var n=operatingSystemRules[e],a=n[0],o=n[1],c=o.exec(r);if(c)return a}return null}function getNodeVersion(){var r=typeof dist.process<"u"&&dist.process.version;return r?new NodeInfo(dist.process.version.slice(1)):null}function createVersionParts(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const DEFAULT_ICE_SERVERS=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],browser=detect(),isFirefox=browser!=null&&browser.name==="firefox",nopSource=async function*r(){},nopSink=async r=>{},DATA_CHANNEL_DRAIN_TIMEOUT=30*1e3;function drainAndClose(r,e,t=DATA_CHANNEL_DRAIN_TIMEOUT,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const a=pDefer();let o=!1;r.bufferedAmountLowThreshold=0;const c=()=>{o||(n.log("%s drain channel closed before drain",e),a.resolve())};r.addEventListener("close",c,{once:!0}),r.addEventListener("bufferedamountlow",()=>{o=!0,r.removeEventListener("close",c),a.resolve()}),await pTimeout(a.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(a=>{n.log.error("error closing outbound stream",a)})}async function getRtcConfiguration(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??DEFAULT_ICE_SERVERS.map(e=>({urls:[e]})),r}class WebRTCMultiaddrConnection{log;peerConnection;remoteAddr;timeline;metrics;source=nopSource();sink=nopSink;constructor(e,t){this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",this.peerConnection.connectionState,"initial state",n),(this.peerConnection.connectionState==="disconnected"||this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}function getIterator(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function isPromise$1(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function closeSource(r,e){const t=getIterator(r).return?.();isPromise$1(t)&&t.catch(n=>{e.error("could not cause iterator to return",n)})}const DEFAULT_SEND_CLOSE_WRITE_TIMEOUT=5e3;function isPromise(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class AbstractStream{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=pDefer(),this.closed=pDefer(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??DEFAULT_SEND_CLOSE_WRITE_TIMEOUT,this.onEnd=e.onEnd,this.onCloseRead=e?.onCloseRead,this.onCloseWrite=e?.onCloseWrite,this.onReset=e?.onReset,this.onAbort=e?.onAbort,this.source=this.streamSource=pushable({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new StreamStateError(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const a=this.sendNewStream(t);isPromise(a)&&await a}const n=()=>{closeSource(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let a of e){a=a instanceof Uint8Array?new Uint8ArrayList(a):a;const o=this.sendData(a,t);isPromise(o)&&(this.sendingData=pDefer(),await o,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await raceSignal(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await raceSignal(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await raceSignal(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await raceSignal(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();isPromise(t)&&t.catch(n=>{this.log.error("error sending reset message",n)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new StreamResetError("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}const normalizeEmitter=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function pEventMultiple(r,e,t){let n;const a=new Promise((o,c)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();const u=[e].flat(),v=[],{addListener:_,removeListener:x}=normalizeEmitter(r),E=(...C)=>{const I=t.multiArgs?C:C[0];t.filter&&!t.filter(I)||(v.push(I),t.count===v.length&&(n(),o(v)))},M=C=>{n(),c(C)};n=()=>{for(const C of u)x(C,E);for(const C of t.rejectionEvents)x(C,M)};for(const C of u)_(C,E);for(const C of t.rejectionEvents)_(C,M);t.signal&&t.signal.addEventListener("abort",()=>{M(t.signal.reason)},{once:!0}),t.resolveImmediately&&o(v)});if(a.cancel=n,typeof t.timeout=="number"){const o=pTimeout(a,{milliseconds:t.timeout});return o.cancel=n,o}return a}function pEvent(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=pEventMultiple(r,e,t),a=n.then(o=>o[0]);return a.cancel=n.cancel,a}var Message$2;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>enumeration(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=message((n,a,o={})=>{o.lengthDelimited!==!1&&a.fork(),n.flag!=null&&(a.uint32(8),r.Flag.codec().encode(n.flag,a)),n.message!=null&&(a.uint32(18),a.bytes(n.message)),o.lengthDelimited!==!1&&a.ldelim()},(n,a,o={})=>{const c={},u=a==null?n.len:n.pos+a;for(;n.pos<u;){const v=n.uint32();switch(v>>>3){case 1:{c.flag=r.Flag.codec().decode(n);break}case 2:{c.message=n.bytes();break}default:{n.skipType(v&7);break}}}return c})),t),r.encode=n=>encodeMessage(n,r.codec()),r.decode=(n,a)=>decodeMessage(n,r.codec(),a)})(Message$2||(Message$2={}));const MAX_BUFFERED_AMOUNT=2*1024*1024,BUFFERED_AMOUNT_LOW_TIMEOUT=30*1e3,MAX_MESSAGE_SIZE=16*1024;function calculateProtobufOverhead(r=MAX_MESSAGE_SIZE){const e=encodingLength(r-encodingLength(r)),t=1+encodingLength(Object.keys(Message$2.Flag).length-1),n=1,a=r-e-t-n,o=encodingLength(a);return e+t+n+o}const PROTOBUF_OVERHEAD=calculateProtobufOverhead(),FIN_ACK_TIMEOUT=5e3,OPEN_TIMEOUT=5e3;class WebRTCStream extends AbstractStream{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;constructor(e){const t=e.onEnd;switch(e.onEnd=a=>{this.log.trace("readable and writeable ends closed",this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await pTimeout(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),t?.(a)}).catch(o=>{this.log.error("error ending stream",o)})},super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=pushable(),this.bufferedAmountLowEventTimeout=e.bufferedAmountLowEventTimeout??BUFFERED_AMOUNT_LOW_TIMEOUT,this.maxBufferedAmount=e.maxBufferedAmount??MAX_BUFFERED_AMOUNT,this.maxMessageSize=(e.maxMessageSize??MAX_MESSAGE_SIZE)-PROTOBUF_OVERHEAD,this.receiveFinAck=pDefer(),this.finAckTimeout=e.closeTimeout??FIN_ACK_TIMEOUT,this.openTimeout=e.openTimeout??OPEN_TIMEOUT,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new StreamStateError("Unknown datachannel state")}this.channel.onopen=a=>{this.timeline.open=new Date().getTime()},this.channel.onclose=a=>{this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=a=>{const o=a.error;this.abort(o)},this.channel.onmessage=async a=>{const{data:o}=a;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const n=this;Promise.resolve().then(async()=>{for await(const a of decode(this.incomingData)){const o=n.processIncomingProtobuf(a);o!=null&&n.sourcePush(new Uint8ArrayList(o))}}).catch(a=>{this.log.error("error processing incoming data channel messages",a)})}sendNewStream(){}async _sendMessage(e,t=!0){if(t&&this.channel.bufferedAmount>this.maxBufferedAmount)try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await pEvent(this.channel,"bufferedamountlow",{timeout:this.bufferedAmountLowEventTimeout})}catch(n){throw n instanceof TimeoutError$1?new TimeoutError$1(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):n}if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new StreamStateError(`Invalid datachannel state - ${this.channel.readyState}`);this.channel.readyState!=="open"&&(this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await pEvent(this.channel,"open",{timeout:this.openTimeout}),this.log('channel state is now "%s", sending data',this.channel.readyState)),this.channel.send(e.subarray())}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxMessageSize),n=e.subarray(0,t),a=Message$2.encode({message:n}),o=encode$1.single(a);await this._sendMessage(o),e.consume(t)}}async sendReset(){try{await this._sendFlag(Message$2.Flag.RESET)}catch(e){this.log.error("failed to send reset - %e",e)}}async sendCloseWrite(e){if(await this._sendFlag(Message$2.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await raceSignal(this.receiveFinAck.promise,e?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(n){this.log.error("failed to await FIN_ACK",n)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){await this._sendFlag(Message$2.Flag.STOP_SENDING)}processIncomingProtobuf(e){const t=Message$2.decode(e);if(t.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===Message$2.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Message$2.Flag.FIN_ACK).catch(n=>{this.log.error("error sending FIN_ACK immediately",n)})),t.flag===Message$2.Flag.RESET&&this.reset(),t.flag===Message$2.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===Message$2.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return t.message}async _sendFlag(e){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',this.channel.readyState,e.toString()),!1;this.log.trace("sending flag %s",e.toString());const t=Message$2.encode({flag:e}),n=encode$1.single(t);try{return await this._sendMessage(n,!1),!0}catch(a){this.log.error("could not send flag %s - %e",e.toString(),a)}return!1}}function createStream$1(r){const{channel:e,direction:t}=r;return new WebRTCStream({id:t==="inbound"?`i${e.id}`:`r${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${t}:${e.id}`),...r})}const PROTOCOL$1="/webrtc";class DataChannelMuxerFactory{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(e,t){this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??PROTOCOL$1,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:datachannelmuxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const a={},o=createStream$1({channel:n,direction:"inbound",onEnd:c=>{a.onEnd(c)},logger:e.logger,...this.dataChannelOptions});a.stream=o,a.channel=n,a.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(c=>c.stream.id!==o.id)},this.bufferedStreams.push(a)}}createStreamMuxer(e){return new DataChannelMuxer(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class DataChannelMuxer{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(e,t){this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??PROTOCOL$1,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const a=n.id,o=createStream$1({channel:n,direction:"inbound",onEnd:()=>{this.#e(o,n),this.log("incoming channel %s ended",a)},logger:this.logger,...this.dataChannelOptions});this.streams.push(o),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(o)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),this.#e(n.stream,n.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(n.stream)})})}#e(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),drainAndClose(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(n=>n.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}source=nopSource();sink=nopSink;newStream(){const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=createStream$1({channel:e,direction:"outbound",onEnd:()=>{this.#e(n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),this.metrics?.increment({outgoing_stream:!0}),n}}const RTCPeerConnection=globalThis.RTCPeerConnection,RTCSessionDescription=globalThis.RTCSessionDescription,RTCIceCandidate=globalThis.RTCIceCandidate;function pbStream(r,e){const t=lpStream(r,e),n={read:async(a,o)=>{const c=await t.read(o);return a.decode(c)},write:async(a,o,c)=>{await t.write(o.encode(a),c)},writeV:async(a,o,c)=>{await t.writeV(a.map(u=>o.encode(u)),c)},pb:a=>({read:async o=>n.read(a,o),write:async(o,c)=>n.write(o,a,c),writeV:async(o,c)=>n.writeV(o,a,c),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}class WebRTCTransportError extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class SDPHandshakeFailedError extends WebRTCTransportError{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}var Message$1;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(n){n.codec=()=>enumeration(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=message((n,a,o={})=>{o.lengthDelimited!==!1&&a.fork(),n.type!=null&&(a.uint32(8),r.Type.codec().encode(n.type,a)),n.data!=null&&(a.uint32(18),a.string(n.data)),o.lengthDelimited!==!1&&a.ldelim()},(n,a,o={})=>{const c={},u=a==null?n.len:n.pos+a;for(;n.pos<u;){const v=n.uint32();switch(v>>>3){case 1:{c.type=r.Type.codec().decode(n);break}case 2:{c.data=n.string();break}default:{n.skipType(v&7);break}}}return c})),t),r.encode=n=>encodeMessage(n,r.codec()),r.decode=(n,a)=>decodeMessage(n,r.codec(),a)})(Message$1||(Message$1={}));const readCandidatesUntilConnected=async(r,e,t)=>{try{const n=pDefer();for(resolveOnConnected(r,n);;){const a=await Promise.race([n.promise,e.read({signal:t.signal}).catch(()=>{})]);if(a==null){t.signal?.throwIfAborted();break}if(a.type!==Message$1.Type.ICE_CANDIDATE)throw new InvalidMessageError("ICE candidate message expected");const o=JSON.parse(a.data??"null");if(o===""||o===null){t.onProgress?.(new CustomProgressEvent("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const c=new RTCIceCandidate(o);t.log.trace("%s received new ICE candidate %o",t.direction,o);try{t.onProgress?.(new CustomProgressEvent("webrtc:add-ice-candidate",c.candidate)),await r.addIceCandidate(c)}catch(u){t.log.error("%s bad candidate received",t.direction,o,u)}}}catch(n){if(t.log.error("%s error parsing ICE candidate",t.direction,n),t.signal?.aborted===!0&&getConnectionState(r)!=="connected")throw n}};function getConnectionState(r){return isFirefox?r.iceConnectionState:r.connectionState}function resolveOnConnected(r,e){r[isFirefox?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(getConnectionState(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new ConnectionFailedError("RTCPeerConnection was closed"));break}}}async function initiateConnection({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:a,connectionManager:o,transportManager:c,log:u,logger:v,onProgress:_}){const{baseAddr:x}=splitAddr(a);n?.dialerEvents.increment({open:!0}),u.trace("dialing base address: %a",x);const E=x.getPeerId();if(E==null)throw new InvalidParametersError("Relay peer was missing");const M=o.getConnections(peerIdFromString$1(E));let C,I=!1;M.length===0?(_?.(new CustomProgressEvent("webrtc:dial-relay")),C=await c.dial(x,{signal:t,onProgress:_}),I=!0):(_?.(new CustomProgressEvent("webrtc:reuse-relay-connection")),C=M[0]);try{_?.(new CustomProgressEvent("webrtc:open-signaling-stream"));const D=await C.newStream(SIGNALING_PROTO_ID,{signal:t,runOnLimitedConnection:!0}),L=pbStream(D).pb(Message$1),N=new RTCPeerConnection(r),q=new DataChannelMuxerFactory({logger:v},{peerConnection:N,dataChannelOptions:e});try{const F=N.createDataChannel("init");N.onicecandidate=({candidate:X})=>{const J=JSON.stringify(X?.toJSON()??null);u.trace("initiator sending ICE candidate %o",X),L.write({type:Message$1.Type.ICE_CANDIDATE,data:J},{signal:t}).catch(G=>{u.error("error sending ICE candidate",G)})},N.onicecandidateerror=X=>{u.error("initiator ICE candidate error",X)};const U=await N.createOffer().catch(X=>{throw u.error("could not execute createOffer",X),new SDPHandshakeFailedError("Failed to set createOffer")});u.trace("initiator send SDP offer %s",U.sdp),_?.(new CustomProgressEvent("webrtc:send-sdp-offer")),await L.write({type:Message$1.Type.SDP_OFFER,data:U.sdp},{signal:t}),await N.setLocalDescription(U).catch(X=>{throw u.error("could not execute setLocalDescription",X),new SDPHandshakeFailedError("Failed to set localDescription")}),_?.(new CustomProgressEvent("webrtc:read-sdp-answer")),u.trace("initiator read SDP answer");const j=await L.read({signal:t});if(j.type!==Message$1.Type.SDP_ANSWER)throw new SDPHandshakeFailedError("Remote should send an SDP answer");u.trace("initiator received SDP answer %s",j.data);const W=new RTCSessionDescription({type:"answer",sdp:j.data});return await N.setRemoteDescription(W).catch(X=>{throw u.error("could not execute setRemoteDescription",X),new SDPHandshakeFailedError("Failed to set remoteDescription")}),u.trace("initiator read candidates until connected"),_?.(new CustomProgressEvent("webrtc:read-ice-candidates")),await readCandidatesUntilConnected(N,L,{direction:"initiator",signal:t,log:u,onProgress:_}),u.trace("initiator connected, closing init channel"),F.close(),_?.(new CustomProgressEvent("webrtc:close-signaling-stream")),u.trace("closing signaling channel"),await D.close({signal:t}),u.trace("initiator connected to remote address %s",a),{remoteAddress:a,peerConnection:N,muxerFactory:q}}catch(F){throw u.error("outgoing signaling error",F),N.close(),D.abort(F),F}finally{N.onicecandidate=null,N.onicecandidateerror=null}}finally{if(I)try{await C.close({signal:t})}catch(D){C.abort(D)}}}const Circuit$1=fmt(P2P$1.matchers[0],literal("p2p-circuit"));class WebRTCPeerListener extends TypedEventEmitter{transportManager;shutdownController;constructor(e,t){super(),this.transportManager=e.transportManager,this.shutdownController=t.shutdownController}async listen(){queueMicrotask(()=>{this.safeDispatchEvent("listening")})}getAddrs(){return this.transportManager.getListeners().filter(e=>e!==this).map(e=>e.getAddrs().filter(t=>Circuit$1.exactMatch(t)).map(t=>t.encapsulate("/webrtc"))).flat()}async close(){this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function handleIncomingStream({peerConnection:r,stream:e,signal:t,connection:n,log:a}){a.trace("new inbound signaling stream");const o=pbStream(e).pb(Message$1);try{r.onicecandidate=({candidate:x})=>{const E=JSON.stringify(x?.toJSON()??null);a.trace("recipient sending ICE candidate %s",E),o.write({type:Message$1.Type.ICE_CANDIDATE,data:E},{signal:t}).catch(M=>{a.error("error sending ICE candidate",M)})},a.trace("recipient read SDP offer");const u=await o.read({signal:t});if(u.type!==Message$1.Type.SDP_OFFER)throw new SDPHandshakeFailedError(`expected message type SDP_OFFER, received: ${u.type??"undefined"} `);a.trace("recipient received SDP offer %s",u.data);const v=new RTCSessionDescription({type:"offer",sdp:u.data});await r.setRemoteDescription(v).catch(x=>{throw a.error("could not execute setRemoteDescription",x),new SDPHandshakeFailedError("Failed to set remoteDescription")});const _=await r.createAnswer().catch(x=>{throw a.error("could not execute createAnswer",x),new SDPHandshakeFailedError("Failed to create answer")});a.trace("recipient send SDP answer %s",_.sdp),await o.write({type:Message$1.Type.SDP_ANSWER,data:_.sdp},{signal:t}),await r.setLocalDescription(_).catch(x=>{throw a.error("could not execute setLocalDescription",x),new SDPHandshakeFailedError("Failed to set localDescription")}),a.trace("recipient read candidates until connected"),await readCandidatesUntilConnected(r,o,{direction:"recipient",signal:t,log:a})}catch(u){if(getConnectionState(r)!=="connected")throw a.error("error while handling signaling stream from peer %a",n.remoteAddr,u),r.close(),u;a("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,u)}const c=multiaddr(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return a.trace("recipient connected to remote address %s",c),{remoteAddress:c}}const WEBRTC_TRANSPORT="/webrtc",CIRCUIT_RELAY_TRANSPORT="/p2p-circuit",SIGNALING_PROTO_ID="/webrtc-signaling/0.0.1",INBOUND_CONNECTION_TIMEOUT=30*1e3;class WebRTCTransport{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,setMaxListeners(1/0,this.shutdownController.signal),e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[serviceCapabilities]=["@libp2p/transport"];[serviceDependencies]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(SIGNALING_PROTO_ID,e=>{this._onProtocol(e).catch(t=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,t)})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(SIGNALING_PROTO_ID),this._started=!1}createListener(e){return new WebRTCPeerListener(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(WebRTC.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:a,muxerFactory:o}=await initiateConnection({rtcConfiguration:await getRtcConfiguration(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),c=new WebRTCMultiaddrConnection(this.components,{peerConnection:a,timeline:{open:Date.now()},remoteAddr:n,metrics:this.metrics?.dialerEvents}),u=await t.upgrader.upgradeOutbound(c,{skipProtection:!0,skipEncryption:!0,muxerFactory:o,onProgress:t.onProgress});return this._closeOnShutdown(a,c),u}async _onProtocol({connection:e,stream:t}){const n=AbortSignal.timeout(this.init.inboundConnectionTimeout??INBOUND_CONNECTION_TIMEOUT),a=new RTCPeerConnection(await getRtcConfiguration(this.init.rtcConfiguration)),o=new DataChannelMuxerFactory(this.components,{peerConnection:a,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:c}=await handleIncomingStream({peerConnection:a,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});const u=new WebRTCMultiaddrConnection(this.components,{peerConnection:a,timeline:{open:new Date().getTime()},remoteAddr:c,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(u,{skipEncryption:!0,skipProtection:!0,muxerFactory:o}),this._closeOnShutdown(a,u)}catch(c){throw this.log.error("incoming signaling error",c),a.close(),t.abort(c),c}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(a=>{this.log.error("could not close WebRTCMultiaddrConnection",a)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function splitAddr(r){const e=r.toString().split(WEBRTC_TRANSPORT+"/");if(e.length!==2)throw new InvalidParametersError("webrtc protocol was not present in multiaddr");if(!e[0].includes(CIRCUIT_RELAY_TRANSPORT))throw new InvalidParametersError("p2p-circuit protocol was not present in multiaddr");let t=multiaddr(e[0]);const a=multiaddr("/"+e[1]).getPeerId();if(a==null)throw new InvalidParametersError("destination peer id was missing");const o=t.protos().pop();if(o===void 0)throw new InvalidParametersError("invalid multiaddr");return o.name!=="p2p"&&(t=t.encapsulate(`/p2p/${a}`)),{baseAddr:t,peerId:peerIdFromString$1(a)}}function pair(){const r=pDefer();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function duplexPair(){const r=pair(),e=pair();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}function pipe(r,...e){if(r==null)throw new Error("Empty pipeline");if(isDuplex(r)){const n=r;r=()=>n.source}else if(isIterable(r)||isAsyncIterable$2(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&isDuplex(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)isDuplex(t[n])&&(t[n]=duplexPipelineFn(t[n]));return rawPipe(...t)}const rawPipe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},isAsyncIterable$2=r=>r?.[Symbol.asyncIterator]!=null,isIterable=r=>r?.[Symbol.iterator]!=null,isDuplex=r=>r==null?!1:r.sink!=null&&r.source!=null,duplexPipelineFn=r=>e=>{const t=r.sink(e);if(t?.then!=null){const n=pushable({objectMode:!0});t.then(()=>{n.end()},c=>{n.end(c)});let a;const o=r.source;if(isAsyncIterable$2(o))a=async function*(){yield*o,n.end()};else if(isIterable(o))a=function*(){yield*o,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return merge$1(n,a())}return r.source},NOISE_MSG_MAX_LENGTH_BYTES=65535,NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=NOISE_MSG_MAX_LENGTH_BYTES-16,DUMP_SESSION_KEYS=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function number(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}function bool(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function isBytes(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function bytes(r,...e){if(!isBytes(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function exists(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function output(r,e){bytes(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),createView=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes(r){if(typeof r!="string")throw new Error(`string expected, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes(r){if(typeof r=="string")r=utf8ToBytes(r);else if(isBytes(r))r=copyBytes(r);else throw new Error(`Uint8Array expected, got ${typeof r}`);return r}function checkOpts(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function equalBytes(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const wrapCipher=(r,e)=>(Object.assign(e,r),e);function setBigUint64(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const a=BigInt(32),o=BigInt(4294967295),c=Number(t>>a&o),u=Number(t&o),v=4,_=0;r.setUint32(e+v,c,n),r.setUint32(e+_,u,n)}function copyBytes(r){return Uint8Array.from(r)}function clean(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const _utf8ToBytes=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl(r,e){return r<<e|r>>>32-e}function isAligned32(r){return r.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(r,e,t,n,a,o,c,u){const v=a.length,_=new Uint8Array(BLOCK_LEN),x=u32(_),E=isAligned32(a)&&isAligned32(o),M=E?u32(a):U32_EMPTY,C=E?u32(o):U32_EMPTY;for(let I=0;I<v;c++){if(r(e,t,n,x,c,u),c>=MAX_COUNTER)throw new Error("arx: counter overflow");const D=Math.min(BLOCK_LEN,v-I);if(E&&D===BLOCK_LEN){const L=I/4;if(I%4!==0)throw new Error("arx: invalid block position");for(let N=0,q;N<BLOCK_LEN32;N++)q=L+N,C[q]=M[q]^x[N];I+=BLOCK_LEN;continue}for(let L=0,N;L<D;L++)N=I+L,o[N]=a[N]^_[L];I+=D}}function createCipher(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:a,counterRight:o,rounds:c}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return number(a),number(c),bool(o),bool(t),(u,v,_,x,E=0)=>{bytes(u),bytes(v),bytes(_);const M=_.length;if(x===void 0&&(x=new Uint8Array(M)),bytes(x),number(E),E<0||E>=MAX_COUNTER)throw new Error("arx: counter overflow");if(x.length<M)throw new Error(`arx: output (${x.length}) is shorter than data (${M})`);const C=[];let I=u.length,D,L;if(I===32)C.push(D=copyBytes(u)),L=sigma32_32;else if(I===16&&t)D=new Uint8Array(32),D.set(u),D.set(u,16),L=sigma16_32,C.push(D);else throw new Error(`arx: invalid 32-byte key, got length=${I}`);isAligned32(v)||C.push(v=copyBytes(v));const N=u32(D);if(n){if(v.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(L,N,u32(v.subarray(0,16)),N),v=v.subarray(16)}const q=16-a;if(q!==v.length)throw new Error(`arx: nonce must be ${q} or 16 bytes`);if(q!==12){const U=new Uint8Array(12);U.set(v,o?0:12-v.length),v=U,C.push(v)}const F=u32(v);return runCipher(r,L,N,F,_,x,E,c),clean(...C),x}}const u8to16=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class Poly1305{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes(e),bytes(e,32);const t=u8to16(e,0),n=u8to16(e,2),a=u8to16(e,4),o=u8to16(e,6),c=u8to16(e,8),u=u8to16(e,10),v=u8to16(e,12),_=u8to16(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|a<<6)&7939,this.r[3]=(a>>>7|o<<9)&8191,this.r[4]=(o>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|u<<2)&8191,this.r[7]=(u>>>11|v<<5)&8065,this.r[8]=(v>>>8|_<<8)&8191,this.r[9]=_>>>5&127;for(let x=0;x<8;x++)this.pad[x]=u8to16(e,16+2*x)}process(e,t,n=!1){const a=n?0:2048,{h:o,r:c}=this,u=c[0],v=c[1],_=c[2],x=c[3],E=c[4],M=c[5],C=c[6],I=c[7],D=c[8],L=c[9],N=u8to16(e,t+0),q=u8to16(e,t+2),F=u8to16(e,t+4),U=u8to16(e,t+6),j=u8to16(e,t+8),W=u8to16(e,t+10),X=u8to16(e,t+12),J=u8to16(e,t+14);let G=o[0]+(N&8191),oe=o[1]+((N>>>13|q<<3)&8191),O=o[2]+((q>>>10|F<<6)&8191),l=o[3]+((F>>>7|U<<9)&8191),p=o[4]+((U>>>4|j<<12)&8191),b=o[5]+(j>>>1&8191),S=o[6]+((j>>>14|W<<2)&8191),T=o[7]+((W>>>11|X<<5)&8191),B=o[8]+((X>>>8|J<<8)&8191),$=o[9]+(J>>>5|a),A=0,g=A+G*u+oe*(5*L)+O*(5*D)+l*(5*I)+p*(5*C);A=g>>>13,g&=8191,g+=b*(5*M)+S*(5*E)+T*(5*x)+B*(5*_)+$*(5*v),A+=g>>>13,g&=8191;let k=A+G*v+oe*u+O*(5*L)+l*(5*D)+p*(5*I);A=k>>>13,k&=8191,k+=b*(5*C)+S*(5*M)+T*(5*E)+B*(5*x)+$*(5*_),A+=k>>>13,k&=8191;let H=A+G*_+oe*v+O*u+l*(5*L)+p*(5*D);A=H>>>13,H&=8191,H+=b*(5*I)+S*(5*C)+T*(5*M)+B*(5*E)+$*(5*x),A+=H>>>13,H&=8191;let z=A+G*x+oe*_+O*v+l*u+p*(5*L);A=z>>>13,z&=8191,z+=b*(5*D)+S*(5*I)+T*(5*C)+B*(5*M)+$*(5*E),A+=z>>>13,z&=8191;let Q=A+G*E+oe*x+O*_+l*v+p*u;A=Q>>>13,Q&=8191,Q+=b*(5*L)+S*(5*D)+T*(5*I)+B*(5*C)+$*(5*M),A+=Q>>>13,Q&=8191;let ie=A+G*M+oe*E+O*x+l*_+p*v;A=ie>>>13,ie&=8191,ie+=b*u+S*(5*L)+T*(5*D)+B*(5*I)+$*(5*C),A+=ie>>>13,ie&=8191;let ne=A+G*C+oe*M+O*E+l*x+p*_;A=ne>>>13,ne&=8191,ne+=b*v+S*u+T*(5*L)+B*(5*D)+$*(5*I),A+=ne>>>13,ne&=8191;let Z=A+G*I+oe*C+O*M+l*E+p*x;A=Z>>>13,Z&=8191,Z+=b*_+S*v+T*u+B*(5*L)+$*(5*D),A+=Z>>>13,Z&=8191;let se=A+G*D+oe*I+O*C+l*M+p*E;A=se>>>13,se&=8191,se+=b*x+S*_+T*v+B*u+$*(5*L),A+=se>>>13,se&=8191;let ae=A+G*L+oe*D+O*I+l*C+p*M;A=ae>>>13,ae&=8191,ae+=b*E+S*x+T*_+B*v+$*u,A+=ae>>>13,ae&=8191,A=(A<<2)+A|0,A=A+g|0,g=A&8191,A=A>>>13,k+=A,o[0]=g,o[1]=k,o[2]=H,o[3]=z,o[4]=Q,o[5]=ie,o[6]=ne,o[7]=Z,o[8]=se,o[9]=ae}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let a=e[1]>>>13;e[1]&=8191;for(let u=2;u<10;u++)e[u]+=a,a=e[u]>>>13,e[u]&=8191;e[0]+=a*5,a=e[0]>>>13,e[0]&=8191,e[1]+=a,a=e[1]>>>13,e[1]&=8191,e[2]+=a,n[0]=e[0]+5,a=n[0]>>>13,n[0]&=8191;for(let u=1;u<10;u++)n[u]=e[u]+a,a=n[u]>>>13,n[u]&=8191;n[9]-=8192;let o=(a^1)-1;for(let u=0;u<10;u++)n[u]&=o;o=~o;for(let u=0;u<10;u++)e[u]=e[u]&o|n[u];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let c=e[0]+t[0];e[0]=c&65535;for(let u=1;u<8;u++)c=(e[u]+t[u]|0)+(c>>>16)|0,e[u]=c&65535;clean(n)}update(e){exists(this);const{buffer:t,blockLen:n}=this;e=toBytes(e);const a=e.length;for(let o=0;o<a;){const c=Math.min(n-this.pos,a-o);if(c===n){for(;n<=a-o;o+=n)this.process(e,o);continue}t.set(e.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){clean(this.h,this.r,this.buffer,this.pad)}digestInto(e){exists(this),output(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:a}=this;if(a){for(t[a++]=1;a<16;a++)t[a]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let c=0;c<8;c++)e[o++]=n[c]>>>0,e[o++]=n[c]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function wrapConstructorWithKey(r){const e=(n,a)=>r(a).update(toBytes(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const poly1305=wrapConstructorWithKey(r=>new Poly1305(r));function chachaCore(r,e,t,n,a,o=20){let c=r[0],u=r[1],v=r[2],_=r[3],x=e[0],E=e[1],M=e[2],C=e[3],I=e[4],D=e[5],L=e[6],N=e[7],q=a,F=t[0],U=t[1],j=t[2],W=c,X=u,J=v,G=_,oe=x,O=E,l=M,p=C,b=I,S=D,T=L,B=N,$=q,A=F,g=U,k=j;for(let z=0;z<o;z+=2)W=W+oe|0,$=rotl($^W,16),b=b+$|0,oe=rotl(oe^b,12),W=W+oe|0,$=rotl($^W,8),b=b+$|0,oe=rotl(oe^b,7),X=X+O|0,A=rotl(A^X,16),S=S+A|0,O=rotl(O^S,12),X=X+O|0,A=rotl(A^X,8),S=S+A|0,O=rotl(O^S,7),J=J+l|0,g=rotl(g^J,16),T=T+g|0,l=rotl(l^T,12),J=J+l|0,g=rotl(g^J,8),T=T+g|0,l=rotl(l^T,7),G=G+p|0,k=rotl(k^G,16),B=B+k|0,p=rotl(p^B,12),G=G+p|0,k=rotl(k^G,8),B=B+k|0,p=rotl(p^B,7),W=W+O|0,k=rotl(k^W,16),T=T+k|0,O=rotl(O^T,12),W=W+O|0,k=rotl(k^W,8),T=T+k|0,O=rotl(O^T,7),X=X+l|0,$=rotl($^X,16),B=B+$|0,l=rotl(l^B,12),X=X+l|0,$=rotl($^X,8),B=B+$|0,l=rotl(l^B,7),J=J+p|0,A=rotl(A^J,16),b=b+A|0,p=rotl(p^b,12),J=J+p|0,A=rotl(A^J,8),b=b+A|0,p=rotl(p^b,7),G=G+oe|0,g=rotl(g^G,16),S=S+g|0,oe=rotl(oe^S,12),G=G+oe|0,g=rotl(g^G,8),S=S+g|0,oe=rotl(oe^S,7);let H=0;n[H++]=c+W|0,n[H++]=u+X|0,n[H++]=v+J|0,n[H++]=_+G|0,n[H++]=x+oe|0,n[H++]=E+O|0,n[H++]=M+l|0,n[H++]=C+p|0,n[H++]=I+b|0,n[H++]=D+S|0,n[H++]=L+T|0,n[H++]=N+B|0,n[H++]=q+$|0,n[H++]=F+A|0,n[H++]=U+g|0,n[H++]=j+k|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(ZEROS16.subarray(t))},ZEROS32=new Uint8Array(32);function computeTag(r,e,t,n,a){const o=r(e,t,ZEROS32),c=poly1305.create(o);a&&updatePadded(c,a),updatePadded(c,n);const u=new Uint8Array(16),v=createView(u);setBigUint64(v,0,BigInt(a?a.length:0),!0),setBigUint64(v,8,BigInt(n.length),!0),c.update(u);const _=c.digest();return clean(o,u),_}const _poly1305_aead=r=>(e,t,n)=>(bytes(e,32),bytes(t),{encrypt(o,c){const u=o.length,v=u+16;c?bytes(c,v):c=new Uint8Array(v),r(e,t,o,c,1);const _=computeTag(r,e,t,c.subarray(0,-16),n);return c.set(_,u),clean(_),c},decrypt(o,c){const u=o.length,v=u-16;if(u<16)throw new Error("encrypted data must be at least 16 bytes");c?bytes(c,v):c=new Uint8Array(v);const _=o.subarray(0,-16),x=o.subarray(-16),E=computeTag(r,e,t,_,n);if(!equalBytes(x,E))throw new Error("invalid tag");return r(e,t,_,c,1),clean(E),c}}),chacha20poly1305=wrapCipher({blockSize:64,nonceLength:12,tagLength:16},_poly1305_aead(chacha20));function extract(r,e,t){return ahash(r),t===void 0&&(t=new Uint8Array(r.outputLen)),hmac$1(r,toBytes$5(t),toBytes$5(e))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(r,e,t,n=32){if(ahash(r),anumber$1(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const a=Math.ceil(n/r.outputLen);t===void 0&&(t=EMPTY_BUFFER);const o=new Uint8Array(a*r.outputLen),c=hmac$1.create(r,e),u=c._cloneInto(),v=new Uint8Array(c.outputLen);for(let _=0;_<a;_++)HKDF_COUNTER[0]=_+1,u.update(_===0?EMPTY_BUFFER:v).update(t).update(HKDF_COUNTER).digestInto(v),o.set(v,r.outputLen*_),c._cloneInto(u);return c.destroy(),u.destroy(),v.fill(0),HKDF_COUNTER.fill(0),o.slice(0,n)}const pureJsCrypto={hashSHA256(r){return sha256$4(r.subarray())},getHKDF(r,e){const t=extract(sha256$4,e,r),a=expand(sha256$4,t,void 0,96),o=a.subarray(0,32),c=a.subarray(32,64),u=a.subarray(64,96);return[o,c,u]},generateX25519KeyPair(){const r=x25519.utils.randomPrivateKey();return{publicKey:x25519.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:x25519.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return x25519.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return chacha20poly1305(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,a){return chacha20poly1305(n,e,t).decrypt(r.subarray(),a)}},defaultCrypto=pureJsCrypto;function wrapCrypto(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const uint16BEEncode=r=>{const e=allocUnsafe(2);return e[0]=r>>8,e[1]=r,e};uint16BEEncode.bytes=2;const uint16BEDecode=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};uint16BEDecode.bytes=2;function registerMetrics(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function logLocalStaticKeys(r,e){!e.enabled||!DUMP_SESSION_KEYS||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${toString$1(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${toString$1(r.privateKey,"hex")}`)):e("Missing local static keys."))}function logLocalEphemeralKeys(r,e){!e.enabled||!DUMP_SESSION_KEYS||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${toString$1(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${toString$1(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function logRemoteStaticKey(r,e){!e.enabled||!DUMP_SESSION_KEYS||e(r?`REMOTE_STATIC_PUBLIC_KEY ${toString$1(r.subarray(),"hex")}`:"Missing remote static public key.")}function logRemoteEphemeralKey(r,e){!e.enabled||!DUMP_SESSION_KEYS||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${toString$1(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function logCipherState(r,e,t){!t.enabled||!DUMP_SESSION_KEYS||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&toString$1(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&toString$1(e.k,"hex")}`))}class InvalidCryptoExchangeError extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=InvalidCryptoExchangeError.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}const MIN_NONCE=0,MAX_NONCE=4294967295,ERR_MAX_NONCE="Cipherstate has reached maximum n, a new handshake must be performed";class Nonce{n;bytes;view;constructor(e=MIN_NONCE){this.n=e,this.bytes=alloc$1(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>MAX_NONCE)throw new Error(ERR_MAX_NONCE)}}const ZEROLEN=alloc$1(0);class CipherState{k;n;crypto;constructor(e,t=void 0,n=0){this.crypto=e,this.k=t,this.n=new Nonce(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const a=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),a}}class SymmetricState{cs;ck;h;crypto;constructor(e,t){this.crypto=e;const n=fromString(t,"utf-8");this.h=hashProtocolName(e,n),this.ck=this.h,this.cs=new CipherState(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new CipherState(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Uint8ArrayList(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,ZEROLEN);return[new CipherState(this.crypto,e),new CipherState(this.crypto,t)]}}class AbstractHandshakeState{ss;s;e;rs;re;initiator;crypto;constructor(e){const{crypto:t,protocolName:n,prologue:a,initiator:o,s:c,e:u,rs:v,re:_}=e;this.crypto=t,this.ss=new SymmetricState(t,n),this.ss.mixHash(a),this.initiator=o,this.s=c,this.e=u,this.rs=v,this.re=_}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const a=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(a),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class XXHandshakeState extends AbstractHandshakeState{writeMessageA(e){return new Uint8ArrayList(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new Uint8ArrayList(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new Uint8ArrayList(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new InvalidCryptoExchangeError(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new InvalidCryptoExchangeError(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new InvalidCryptoExchangeError(`handshake stage 2 validation fail: ${t.message}`)}}}function hashProtocolName(r,e){if(e.length<=32){const t=alloc$1(32);return t.set(e),t}else return r.hash(e)}var NoiseExtensions;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{if(a.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const o of t.webtransportCerthashes)n.uint32(10),n.bytes(o);a.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const a={webtransportCerthashes:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{a.webtransportCerthashes.push(t.bytes());break}default:{t.skipType(c&7);break}}}return a})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=t=>decodeMessage(t,r.codec())})(NoiseExtensions||(NoiseExtensions={}));var NoiseHandshakePayload;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),NoiseExtensions.codec().encode(t.extensions,n)),a.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const a={identityKey:alloc$1(0),identitySig:alloc$1(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{a.identityKey=t.bytes();break}case 2:{a.identitySig=t.bytes();break}case 4:{a.extensions=NoiseExtensions.codec().decode(t,t.uint32());break}default:{t.skipType(c&7);break}}}return a})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=t=>decodeMessage(t,r.codec())})(NoiseHandshakePayload||(NoiseHandshakePayload={}));async function createHandshakePayload(r,e,t){const n=await r.sign(getSignaturePayload(e));return NoiseHandshakePayload.encode({identityKey:publicKeyToProtobuf(r.publicKey),identitySig:n,extensions:t})}async function decodeHandshakePayload(r,e,t){try{const n=NoiseHandshakePayload.decode(r),a=publicKeyFromProtobuf(n.identityKey);if(t?.equals(a)===!1)throw new Error(`Payload identity key ${a} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const o=getSignaturePayload(e);if(!await a.verify(o,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new UnexpectedPeerError(n.message)}}function getSignaturePayload(r){const e=fromString("noise-libp2p-static-key:");return r instanceof Uint8Array?concat$1([e,r],e.length+r.length):(r.prepend(e),r)}async function performHandshakeInitiator(r,e){const{log:t,connection:n,crypto:a,privateKey:o,prologue:c,s:u,remoteIdentityKey:v,extensions:_}=r,x=await createHandshakePayload(o,u.publicKey,_),E=new XXHandshakeState({crypto:a,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:c,s:u});logLocalStaticKeys(E.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(E.writeMessageA(ZEROLEN),e),t.trace("Stage 0 - Initiator finished sending first message."),logLocalEphemeralKeys(E.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const M=E.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),logRemoteEphemeralKey(E.re,t),logRemoteStaticKey(E.rs,t),t.trace("Initiator going to check remote's signature...");const C=await decodeHandshakePayload(M,E.rs,v);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(E.writeMessageC(x),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[I,D]=E.ss.split();return logCipherState(I,D,t),{payload:C,encrypt:L=>I.encryptWithAd(ZEROLEN,L),decrypt:(L,N)=>D.decryptWithAd(ZEROLEN,L,N)}}async function performHandshakeResponder(r,e){const{log:t,connection:n,crypto:a,privateKey:o,prologue:c,s:u,remoteIdentityKey:v,extensions:_}=r,x=await createHandshakePayload(o,u.publicKey,_),E=new XXHandshakeState({crypto:a,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:c,s:u});logLocalStaticKeys(E.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),E.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),logRemoteEphemeralKey(E.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(E.writeMessageB(x),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),logLocalEphemeralKeys(E.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const M=E.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const C=await decodeHandshakePayload(M,E.rs,v),[I,D]=E.ss.split();return logCipherState(I,D,t),{payload:C,encrypt:L=>D.encryptWithAd(ZEROLEN,L),decrypt:(L,N)=>I.decryptWithAd(ZEROLEN,L,N)}}const CHACHA_TAG_LENGTH=16;function encryptStream(r,e){return async function*(t){for await(const n of t)for(let a=0;a<n.length;a+=NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG){let o=a+NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG;o>n.length&&(o=n.length);let c;n instanceof Uint8Array?c=r.encrypt(n.subarray(a,o)):c=r.encrypt(n.sublist(a,o)),e?.encryptedPackets.increment(),yield new Uint8ArrayList(uint16BEEncode(c.byteLength),c)}}}function decryptStream(r,e){return async function*(t){for await(const n of t)for(let a=0;a<n.length;a+=NOISE_MSG_MAX_LENGTH_BYTES){let o=a+NOISE_MSG_MAX_LENGTH_BYTES;if(o>n.length&&(o=n.length),o-CHACHA_TAG_LENGTH<a)throw new Error("Invalid chunk");const c=n.sublist(a,o),u=n.subarray(a,o-CHACHA_TAG_LENGTH);try{const v=r.decrypt(c,u);e?.decryptedPackets.increment(),yield v}catch(v){throw e?.decryptErrors.increment(),v}}}}class Noise{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){const{staticNoiseKey:n,extensions:a,crypto:o,prologueBytes:c}=t,{metrics:u}=e;this.components=e;const v=o??defaultCrypto;this.crypto=wrapCrypto(v),this.extensions=a,this.metrics=u?registerMetrics(u):void 0,n?this.staticKey=v.generateX25519KeyPairFromSeed(n):this.staticKey=v.generateX25519KeyPair(),this.prologue=c??alloc$1(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[serviceCapabilities]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){const n=lpStream(e,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),a=await this.performHandshakeInitiator(n,this.components.privateKey,t?.remotePeer?.publicKey,t),o=await this.createSecureConnection(n,a);e.source=o.source,e.sink=o.sink;const c=publicKeyFromProtobuf(a.payload.identityKey);return{conn:e,remoteExtensions:a.payload.extensions,remotePeer:peerIdFromPublicKey(c)}}async secureInbound(e,t){const n=lpStream(e,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),a=await this.performHandshakeResponder(n,this.components.privateKey,t?.remotePeer?.publicKey,t),o=await this.createSecureConnection(n,a);e.source=o.source,e.sink=o.sink;const c=publicKeyFromProtobuf(a.payload.identityKey);return{conn:e,remoteExtensions:a.payload.extensions,remotePeer:peerIdFromPublicKey(c)}}async performHandshakeInitiator(e,t,n,a){let o;try{o=await performHandshakeInitiator({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions},a),this.metrics?.xxHandshakeSuccesses.increment()}catch(c){throw this.metrics?.xxHandshakeErrors.increment(),c}return o}async performHandshakeResponder(e,t,n,a){let o;try{o=await performHandshakeResponder({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions},a),this.metrics?.xxHandshakeSuccesses.increment()}catch(c){throw this.metrics?.xxHandshakeErrors.increment(),c}return o}async createSecureConnection(e,t){const[n,a]=duplexPair(),o=e.unwrap();return await pipe(n,encryptStream(t,this.metrics),o,c=>decode(c,{lengthDecoder:uint16BEDecode}),decryptStream(t,this.metrics),n),a}}function noise(r={}){return e=>new Noise(e,r)}function webRTC(r){return e=>new WebRTCTransport(e,r)}var MessageTypes;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(MessageTypes||(MessageTypes={}));const MessageTypeNames=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),InitiatorMessageTypes=Object.freeze({NEW_STREAM:MessageTypes.NEW_STREAM,MESSAGE:MessageTypes.MESSAGE_INITIATOR,CLOSE:MessageTypes.CLOSE_INITIATOR,RESET:MessageTypes.RESET_INITIATOR}),ReceiverMessageTypes=Object.freeze({MESSAGE:MessageTypes.MESSAGE_RECEIVER,CLOSE:MessageTypes.CLOSE_RECEIVER,RESET:MessageTypes.RESET_RECEIVER}),MAX_MSG_SIZE=1<<20,MAX_MSG_QUEUE_SIZE=4<<20;class Decoder{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=MAX_MSG_SIZE,t=MAX_MSG_QUEUE_SIZE){this._buffer=new Uint8ArrayList,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new InvalidMessageError("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(_){if(_.name==="InvalidMessageError")throw _;break}const{id:n,type:a,length:o,offset:c}=this._headerInfo;if(this._buffer.length-c<o)break;const v={id:n,type:a};(a===MessageTypes.NEW_STREAM||a===MessageTypes.MESSAGE_INITIATOR||a===MessageTypes.MESSAGE_RECEIVER)&&(v.data=this._buffer.sublist(c,c+o)),t.push(v),this._buffer.consume(c+o),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=readVarInt(e),{value:a,offset:o}=readVarInt(e,n),c=t&7;if(MessageTypeNames[c]==null)throw new Error(`Invalid type received: ${c}`);if(a>this._maxMessageSize)throw new InvalidMessageError("Message size too large");return{id:t>>3,type:c,offset:n+o,length:a}}}const MSB=128,REST=127;function readVarInt(r,e=0){let t=0,n=0,a=e,o;const c=r.length;do{if(a>=c||n>49)throw e=0,new RangeError("Could not decode varint");o=r.get(a++),t+=n<28?(o&REST)<<n:(o&REST)*Math.pow(2,n),n+=7}while(o>=MSB);return e=a-e,{value:t,offset:e}}const POOL_SIZE=10*1024;class Encoder{_pool;_poolOffset;constructor(){this._pool=allocUnsafe(POOL_SIZE),this._poolOffset=0}write(e,t){const n=this._pool;let a=this._poolOffset;encode$2(e.id<<3|e.type,n,a),a+=encodingLength(e.id<<3|e.type),(e.type===MessageTypes.NEW_STREAM||e.type===MessageTypes.MESSAGE_INITIATOR||e.type===MessageTypes.MESSAGE_RECEIVER)&&e.data!=null?(encode$2(e.data.length,n,a),a+=encodingLength(e.data.length)):(encode$2(0,n,a),a+=encodingLength(0));const o=n.subarray(this._poolOffset,a);POOL_SIZE-a<100?(this._pool=allocUnsafe(POOL_SIZE),this._poolOffset=0):this._poolOffset=a,t.append(o),(e.type===MessageTypes.NEW_STREAM||e.type===MessageTypes.MESSAGE_INITIATOR||e.type===MessageTypes.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}}const encoder=new Encoder;async function*encode(r){for await(const e of r){const t=new Uint8ArrayList;encoder.write(e,t),yield t}}class StreamInputBufferError extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class MplexStream extends AbstractStream{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types=e.direction==="outbound"?InitiatorMessageTypes:ReceiverMessageTypes,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:InitiatorMessageTypes.NEW_STREAM,data:new Uint8ArrayList(fromString(this.name))})}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function createStream(r){const{id:e,name:t,send:n,onEnd:a,type:o="initiator",maxMsgSize:c=MAX_MSG_SIZE}=r;return new MplexStream({id:o==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:o==="initiator"?"outbound":"inbound",maxDataSize:c,onEnd:a,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${o}:${e}`)})}const MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION=1024,MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION=1024,MAX_STREAM_BUFFER_SIZE=1024*1024*4,DISCONNECT_THRESHOLD=5,CLOSE_TIMEOUT=500;function printMessage(r){const e={...r,type:`${MessageTypeNames[r.type]} (${r.type})`};return r.type===MessageTypes.NEW_STREAM&&(e.data=toString$1(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===MessageTypes.MESSAGE_INITIATOR||r.type===MessageTypes.MESSAGE_RECEIVER)&&(e.data=toString$1(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class MplexStreamMuxer{protocol="/mplex/6.7.0";sink;source;log;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;logger;constructor(e,t){t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??CLOSE_TIMEOUT,this.sink=this._createSink(),this._source=pushable({objectMode:!0,onEnd:()=>{for(const n of this._streams.initiators.values())n.destroy();for(const n of this._streams.receivers.values())n.destroy()}}),this.source=pipe(this._source,n=>encode(n)),this.closeController=new AbortController,this.rateLimiter=new RateLimiter({points:t.disconnectThreshold??DISCONNECT_THRESHOLD,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new MuxerClosedError("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){if(this.closeController.signal.aborted)return;const t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async n=>n.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,a=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:a})}_newStream(e){const{id:t,name:n,type:a,registry:o}=e;if(this.log("new %s stream %s",a,t),a==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION))throw new TooManyOutboundProtocolStreamsError("Too many outbound streams open");if(o.has(t))throw new Error(`${a} stream ${t} already exists!`);const v=createStream({id:t,name:n,send:async _=>{this.log.enabled&&this.log.trace("%s stream %s send",a,t,printMessage(_)),this._source.push(_)},type:a,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",a,t,v.protocol),o.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(v)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return o.set(t,v),v}_createSink(){return async t=>{const n=()=>{closeSource(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{const a=new Decoder(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const o of t)for(const c of a.write(o))await this._handleIncoming(c);this._source.end()}catch(a){this.log("error in sink",a),this._source.end(a)}finally{this.closeController.signal.removeEventListener("abort",n)}}}async _handleIncoming(e){const{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",printMessage(e)),e.type===MessageTypes.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION)){this.log("too many inbound streams open"),this._source.push({id:t,type:MessageTypes.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const u=this._newReceiverStream({id:t,name:toString$1(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(u);return}const o=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(o==null){this.log("missing stream %s for message type %s",t,MessageTypeNames[n]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const c=this._init.maxStreamBufferSize??MAX_STREAM_BUFFER_SIZE;try{switch(n){case MessageTypes.MESSAGE_INITIATOR:case MessageTypes.MESSAGE_RECEIVER:if(o.sourceReadableLength()>c)throw this._source.push({id:e.id,type:n===MessageTypes.MESSAGE_INITIATOR?MessageTypes.RESET_RECEIVER:MessageTypes.RESET_INITIATOR}),new StreamInputBufferError("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");o.sourcePush(e.data);break;case MessageTypes.CLOSE_INITIATOR:case MessageTypes.CLOSE_RECEIVER:o.remoteCloseWrite();break;case MessageTypes.RESET_INITIATOR:case MessageTypes.RESET_RECEIVER:o.reset();break;default:this.log("unknown message type %s",n)}}catch(u){this.log.error("error while processing message",u),o.abort(u)}}}class Mplex{protocol="/mplex/6.7.0";_init;components;constructor(e,t={}){this.components=e,this._init=t}[Symbol.toStringTag]="@libp2p/mplex";[serviceCapabilities]=["@libp2p/stream-multiplexing"];createStreamMuxer(e={}){return new MplexStreamMuxer(this.components,{...e,...this._init})}}function mplex(r={}){return e=>new Mplex(e,r)}const DNS4=base("dns4"),DNS6=base("dns6"),DNSADDR=base("dnsaddr"),DNS=or(base("dns"),DNSADDR,DNS4,DNS6),IP=or(base("ip4"),base("ip6")),TCP=or(and(IP,base("tcp")),and(DNS,base("tcp"))),UDP=and(IP,base("udp")),UTP=and(UDP,base("utp")),QUIC=and(UDP,base("quic")),QUICV1=and(UDP,base("quic-v1")),_WebSockets=or(and(TCP,base("ws")),and(DNS,base("ws"))),WebSockets=or(and(_WebSockets,base("p2p")),_WebSockets),_WebSocketsSecure=or(and(TCP,base("wss")),and(DNS,base("wss")),and(TCP,base("tls"),base("ws")),and(DNS,base("tls"),base("ws"))),WebSocketsSecure=or(and(_WebSocketsSecure,base("p2p")),_WebSocketsSecure),HTTP=or(and(TCP,base("http")),and(IP,base("http")),and(DNS,base("http"))),HTTPS=or(and(TCP,base("https")),and(IP,base("https")),and(DNS,base("https"))),_WebRTCDirect=and(UDP,base("webrtc-direct"),base("certhash")),WebRTCDirect=or(and(_WebRTCDirect,base("p2p")),_WebRTCDirect),_WebTransport=and(QUICV1,base("webtransport"),base("certhash"),base("certhash")),WebTransport=or(and(_WebTransport,base("p2p")),_WebTransport),P2PWebRTCStar=or(and(WebSockets,base("p2p-webrtc-star"),base("p2p")),and(WebSocketsSecure,base("p2p-webrtc-star"),base("p2p")),and(WebSockets,base("p2p-webrtc-star")),and(WebSocketsSecure,base("p2p-webrtc-star")));or(and(WebSockets,base("p2p-websocket-star"),base("p2p")),and(WebSocketsSecure,base("p2p-websocket-star"),base("p2p")),and(WebSockets,base("p2p-websocket-star")),and(WebSocketsSecure,base("p2p-websocket-star")));const P2PWebRTCDirect=or(and(HTTP,base("p2p-webrtc-direct"),base("p2p")),and(HTTPS,base("p2p-webrtc-direct"),base("p2p")),and(HTTP,base("p2p-webrtc-direct")),and(HTTPS,base("p2p-webrtc-direct"))),Reliable=or(_WebSockets,_WebSocketsSecure,HTTP,HTTPS,P2PWebRTCStar,P2PWebRTCDirect,TCP,UTP,QUIC,DNS,WebRTCDirect,WebTransport);or(and(Reliable,base("p2p-stardust"),base("p2p")),and(Reliable,base("p2p-stardust")));const _P2P=or(and(Reliable,base("p2p")),P2PWebRTCStar,P2PWebRTCDirect,WebRTCDirect,WebTransport,base("p2p")),_Circuit=or(and(_P2P,base("p2p-circuit"),_P2P),and(_P2P,base("p2p-circuit")),and(base("p2p-circuit"),_P2P),and(Reliable,base("p2p-circuit")),and(base("p2p-circuit"),Reliable),base("p2p-circuit")),CircuitRecursive=()=>or(and(_Circuit,CircuitRecursive),_Circuit),Circuit=CircuitRecursive(),P2P=or(and(Circuit,_P2P,Circuit),and(_P2P,Circuit),and(Circuit,_P2P),Circuit,_P2P);or(and(Circuit,base("webrtc"),base("p2p")),and(Circuit,base("webrtc")),and(Reliable,base("webrtc"),base("p2p")),and(Reliable,base("webrtc")),base("webrtc"));function makeMatchesFunction(r){function e(t){let n;try{n=multiaddr(t)}catch{return!1}const a=r(n.protoNames());return a===null?!1:a===!0||a===!1?a:a.length===0}return e}function and(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(a=>(n=typeof a=="function"?a().partialMatch(t):a.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:makeMatchesFunction(e),partialMatch:e}}function or(...r){function e(n){let a=null;return r.some(o=>{const c=typeof o=="function"?o().partialMatch(n):o.partialMatch(n);return c!=null?(a=c,!0):!1}),a}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:makeMatchesFunction(e),partialMatch:e}}function base(r){const e=r;function t(a){let o;try{o=multiaddr(a)}catch{return!1}const c=o.protoNames();return c.length===1&&c[0]===e}function n(a){return a.length===0?null:a[0]===e?a.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const DEFAULT_BOOTSTRAP_TAG_NAME="bootstrap",DEFAULT_BOOTSTRAP_TAG_VALUE=50,DEFAULT_BOOTSTRAP_DISCOVERY_TIMEOUT=1e3;class Bootstrap extends TypedEventEmitter{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(e,t={list:[]}){if(t.list==null||t.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.log=e.logger.forComponent("libp2p:bootstrap"),this.timeout=t.timeout??DEFAULT_BOOTSTRAP_DISCOVERY_TIMEOUT,this.list=[];for(const n of t.list){if(!P2P.matches(n)){this.log.error("Invalid multiaddr");continue}const a=multiaddr(n),o=a.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const c={id:peerIdFromString$1(o),multiaddrs:[a]};this.list.push(c)}this._init=t}[peerDiscoverySymbol]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[serviceCapabilities]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{this.log.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const e of this.list){if(await this.components.peerStore.merge(e.id,{tags:{[this._init.tagName??DEFAULT_BOOTSTRAP_TAG_NAME]:{value:this._init.tagValue??DEFAULT_BOOTSTRAP_TAG_VALUE,ttl:this._init.tagTTL}},multiaddrs:e.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:e}),this.components.connectionManager.openConnection(e.id).catch(t=>{this.log.error("could not dial bootstrap peer %p",e.id,t)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}function bootstrap(r){return e=>new Bootstrap(e,r)}const second=1e3,minute=60*second,hour=60*minute,MAX_RECORD_AGE=36*hour,PROTOCOL="/ipfs/kad/1.0.0",PROVIDERS_VALIDITY=48*hour,REPROVIDE_THRESHOLD=24*hour,REPROVIDE_CONCURRENCY=10,REPROVIDE_MAX_QUEUE_SIZE=16384,REPROVIDE_INTERVAL=hour,K=20,ALPHA=3,QUERY_SELF_INTERVAL=5*minute,QUERY_SELF_INITIAL_INTERVAL=second,QUERY_SELF_TIMEOUT=5*second,TABLE_REFRESH_INTERVAL=5*minute,TABLE_REFRESH_QUERY_TIMEOUT=30*second,DEFAULT_QUERY_TIMEOUT=180*second,KEEP_ALIVE_TAG=`${KEEP_ALIVE}-kad-dht`;var Record$1;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={key:alloc$1(0),value:alloc$1(0),timeReceived:""},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.key=t.bytes();break}case 2:{o.value=t.bytes();break}case 5:{o.timeReceived=t.string();break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(Record$1||(Record$1={}));function toRFC3339(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),a=String(r.getUTCHours()).padStart(2,"0"),o=String(r.getUTCMinutes()).padStart(2,"0"),c=String(r.getUTCSeconds()).padStart(2,"0"),u=r.getUTCMilliseconds(),v=String(u*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${a}:${o}:${c}.${v}Z`}function parseRFC3339(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),a=parseInt(t[2],10)-1,o=parseInt(t[3],10),c=parseInt(t[4],10),u=parseInt(t[5],10),v=parseInt(t[6],10),_=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,a,o,c,u,v,_))}class Libp2pRecord{key;value;timeReceived;constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return Record$1.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:toRFC3339(this.timeReceived)}}static deserialize(e){const t=Record$1.decode(e);return new Libp2pRecord(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=parseRFC3339(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Libp2pRecord(e.key,e.value,t)}}function isAsyncIterable$1(r){return r[Symbol.asyncIterator]!=null}function map$3(r,e){let t=0;if(isAsyncIterable$1(r))return async function*(){for await(const v of r)yield e(v,t++)}();const n=peekable(r),{value:a,done:o}=n.next();if(o===!0)return function*(){}();const c=e(a,t++);if(typeof c.then=="function")return async function*(){yield await c;for await(const v of n)yield e(v,t++)}();const u=e;return function*(){yield c;for(const v of n)yield u(v,t++)}()}class QueryError extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class QueryAbortedError extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class InvalidRecordError extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class MissingSelectorError extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var Record;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{a.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.key=t.bytes();break}case 2:{o.value=t.bytes();break}case 3:{o.author=t.bytes();break}case 4:{o.signature=t.bytes();break}case 5:{o.timeReceived=t.string();break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(Record||(Record={}));var MessageType;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(MessageType||(MessageType={}));var __MessageTypeValues;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(__MessageTypeValues||(__MessageTypeValues={}));(function(r){r.codec=()=>enumeration(__MessageTypeValues)})(MessageType||(MessageType={}));var ConnectionType;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(ConnectionType||(ConnectionType={}));var __ConnectionTypeValues;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(__ConnectionTypeValues||(__ConnectionTypeValues={}));(function(r){r.codec=()=>enumeration(__ConnectionTypeValues)})(ConnectionType||(ConnectionType={}));var PeerInfo;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{if(a.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const o of t.multiaddrs)n.uint32(18),n.bytes(o);t.connection!=null&&(n.uint32(24),ConnectionType.codec().encode(t.connection,n)),a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={id:alloc$1(0),multiaddrs:[]},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.id=t.bytes();break}case 2:{if(a.limits?.multiaddrs!=null&&o.multiaddrs.length===a.limits.multiaddrs)throw new MaxLengthError('Decode error - map field "multiaddrs" had too many elements');o.multiaddrs.push(t.bytes());break}case 3:{o.connection=ConnectionType.codec().decode(t);break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(PeerInfo||(PeerInfo={}));var Message;(function(r){let e;r.codec=()=>(e==null&&(e=message((t,n,a={})=>{if(a.lengthDelimited!==!1&&n.fork(),t.type!=null&&__MessageTypeValues[t.type]!==0&&(n.uint32(8),MessageType.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const o of t.closer)n.uint32(66),PeerInfo.codec().encode(o,n);if(t.providers!=null)for(const o of t.providers)n.uint32(74),PeerInfo.codec().encode(o,n);a.lengthDelimited!==!1&&n.ldelim()},(t,n,a={})=>{const o={type:MessageType.PUT_VALUE,closer:[],providers:[]},c=n==null?t.len:t.pos+n;for(;t.pos<c;){const u=t.uint32();switch(u>>>3){case 1:{o.type=MessageType.codec().decode(t);break}case 10:{o.clusterLevel=t.int32();break}case 2:{o.key=t.bytes();break}case 3:{o.record=t.bytes();break}case 8:{if(a.limits?.closer!=null&&o.closer.length===a.limits.closer)throw new MaxLengthError('Decode error - map field "closer" had too many elements');o.closer.push(PeerInfo.codec().decode(t,t.uint32(),{limits:a.limits?.closer$}));break}case 9:{if(a.limits?.providers!=null&&o.providers.length===a.limits.providers)throw new MaxLengthError('Decode error - map field "providers" had too many elements');o.providers.push(PeerInfo.codec().decode(t,t.uint32(),{limits:a.limits?.providers$}));break}default:{t.skipType(u&7);break}}}return o})),e),r.encode=t=>encodeMessage(t,r.codec()),r.decode=(t,n)=>decodeMessage(t,r.codec(),n)})(Message||(Message={}));function sendQueryEvent(r,e={}){const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return e.onProgress?.(new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function peerResponseEvent(r,e={}){const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return e.onProgress?.(new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function finalPeerEvent(r,e={}){const t={...r,name:"FINAL_PEER",type:2};return e.onProgress?.(new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function queryErrorEvent(r,e={}){const t={...r,name:"QUERY_ERROR",type:3};return e.onProgress?.(new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function providerEvent(r,e={}){const t={...r,name:"PROVIDER",type:4};return e.onProgress?.(new CustomEvent("kad-dht:query:provider",{detail:t})),t}function valueEvent(r,e={}){const t={...r,name:"VALUE",type:5};return e.onProgress?.(new CustomEvent("kad-dht:query:value",{detail:t})),t}function dialPeerEvent(r,e={}){const t={...r,name:"DIAL_PEER",type:7};return e.onProgress?.(new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function bestRecord(r,e,t){if(t.length===0)throw new InvalidParametersError("No records given");const a=toString$1(e).split("/");if(a.length<3)throw new InvalidParametersError("Record key does not have a selector function");const o=r[a[1].toString()];if(o==null)throw new MissingSelectorError(`No selector function configured for key type "${a[1]}"`);return t.length===1?0:o(e,t)}function publickKey(r,e){return 0}const selectors={pk:publickKey};async function verifyRecord(r,e){const t=e.key,a=toString$1(t).split("/");if(a.length<3)return;const o=r[a[1].toString()];if(o==null)throw new InvalidParametersError(`No validator available for key type "${a[1]}"`);await o(t,e.value)}const validatePublicKeyRecord=async(r,e)=>{if(!(r instanceof Uint8Array))throw new InvalidParametersError('"key" must be a Uint8Array');if(r.byteLength<5)throw new InvalidParametersError("Invalid public key record");if(toString$1(r.subarray(0,4))!=="/pk/")throw new InvalidParametersError("key was not prefixed with /pk/");const n=publicKeyFromProtobuf(e),a=r.slice(4);if(!equals(a,n.toMultihash().bytes))throw new InvalidParametersError("public key does not match passed in key")},validators={pk:validatePublicKeyRecord},PK_PREFIX=fromString("/pk/");function removePrivateAddressesMapper(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const a=isPrivateIp(n);return a==null?!0:!a})}}async function convertBuffer(r){return(await sha256$2.digest(r)).digest}async function convertPeerId(r){return convertBuffer(r.toMultihash().bytes)}function bufferToRecordKey(r,e){return new Key(`${r}/${toString$1(e,"base32")}`,!1)}function keyForPublicKey(r){return concat$1([PK_PREFIX,r.toMultihash().bytes])}function isPublicKeyKey(r){return toString$1(r.subarray(0,4))==="/pk/"}function fromPublicKeyKey(r){const e=decode$8(r.subarray(4));return peerIdFromMultihash(e)}function createPutRecord(r,e){const t=new Date;return new Libp2pRecord(r,e,t).serialize()}const P2P_CIRCUIT_CODE=290,DNS4_CODE=54,DNS6_CODE=55,DNSADDR_CODE=56,IP4_CODE=4,IP6_CODE=41;function multiaddrIsPublic(r){const e=r.stringTuples();for(const t of e)if(t[0]===P2P_CIRCUIT_CODE)return!1;if(e[0][0]===DNS4_CODE||e[0][0]===DNS6_CODE||e[0][0]===DNSADDR_CODE)return!0;if(e[0][0]===IP4_CODE||e[0][0]===IP6_CODE){const t=isPrivateIp(`${e[0][1]}`);return t==null||!t}return!1}function parseProviderKey(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:CID.createV1(code,decode$8(fromString(n,"base32"))),peerId:peerIdFromString$1(t)}}function toProviderKey(r,e,t){const n=typeof e=="string"?e:toString$1(e.multihash.bytes,"base32"),a=[r,n];return t!=null&&a.push(t.toString()),new Key(a.join("/"))}function readProviderTime(r){return new Date(decode$1(r))}function timeOperationGenerator(r,e,t){return async function*(...n){const a=e.queryTime?.timer(t),o=e.errorTime?.timer(t);let c=!1;try{e.queries?.increment({[t]:!0}),yield*r(...n)}catch(u){throw c=!0,o?.(),e.errors?.increment({[t]:!0}),u}finally{e.queries?.decrement({[t]:!0}),c||a?.()}}}function timeOperationMethod(r,e,t){return async function(...n){const a=e?.queryTime?.timer(t),o=e?.errorTime?.timer(t);let c=!1;try{return e.queries?.increment({[t]:!0}),await r(...n)}catch(u){throw c=!0,o?.(),e.errors?.increment({[t]:!0}),u}finally{e.queries?.decrement({[t]:!0}),c||a?.()}}}class ContentFetching{log;components;validators;selectors;peerRouting;queryManager;network;datastorePrefix;constructor(e,t){const{validators:n,selectors:a,peerRouting:o,queryManager:c,network:u,logPrefix:v}=t;this.components=e,this.log=e.logger.forComponent(`${v}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=a,this.peerRouting=o,this.queryManager=c,this.network=u,this.get=e.metrics?.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1})??this.get,this.put=e.metrics?.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2})??this.put}async getLocal(e){this.log("getLocal %b",e);const t=bufferToRecordKey(this.datastorePrefix,e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const a=Libp2pRecord.deserialize(n);return await verifyRecord(this.validators,a),a}async*sendCorrectionRecord(e,t,n,a={}){this.log("sendCorrection for %b",e);const o=createPutRecord(e,n);for(const{value:c,from:u}of t){if(equals(c,n)){this.log("record was ok");continue}if(this.components.peerId.equals(u)){try{const x=bufferToRecordKey(this.datastorePrefix,e);this.log(`Storing corrected record for key ${x.toString()}`),await this.components.datastore.put(x,o.subarray())}catch(x){this.log.error("Failed error correcting self",x)}continue}let v=!1;const _={type:MessageType.PUT_VALUE,key:e,record:o};for await(const x of this.network.sendRequest(u,_,a))x.name==="PEER_RESPONSE"&&x.record!=null&&equals(x.record.value,Libp2pRecord.deserialize(o).value)&&(v=!0),yield x;v||(yield queryErrorEvent({from:u,error:new QueryError("Value not put correctly")},a)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const a=createPutRecord(e,t),o=bufferToRecordKey(this.datastorePrefix,e);this.log(`storing record for key ${o.toString()}`),await this.components.datastore.put(o,a.subarray()),yield*pipe(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),c=>map$3(c,u=>async()=>{if(u.name!=="FINAL_PEER")return[u];const v=[],_={type:MessageType.PUT_VALUE,key:e,record:a};this.log("send put to %p",u.peer.id);for await(const x of this.network.sendRequest(u.peer.id,_,n))v.push(x),x.name==="PEER_RESPONSE"&&(x.record!=null&&equals(x.record.value,Libp2pRecord.deserialize(a).value)||v.push(queryErrorEvent({from:u.peer.id,error:new QueryError("Value not put correctly")},n)));return v}),c=>parallel(c,{ordered:!1,concurrency:ALPHA}),async function*(c){for await(const u of c)yield*u})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const u of this.getMany(e,t))u.name==="VALUE"&&n.push(u),yield u;if(n.length===0)return;const a=n.map(u=>u.value);let o=0;try{o=bestRecord(this.selectors,e,a)}catch(u){if(u.name!=="InvalidParametersError")throw u}const c=a[o];if(this.log("GetValue %b %b",e,c),c==null)throw new NotFoundError$1("Best value was not found");yield*this.sendCorrectionRecord(e,n,c,t),yield n[o]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const o=await this.getLocal(e);yield valueEvent({value:o.value,from:this.components.peerId},t)}catch(o){this.log("error getting local value for %b",e,o)}const n=this,a=async function*({peer:o,signal:c}){for await(const u of n.peerRouting.getValueOrPeers(o,e,{...t,signal:c}))yield u,u.name==="PEER_RESPONSE"&&u.record!=null&&(yield valueEvent({from:o,value:u.record.value},t))};yield*this.queryManager.run(e,a,t)}}function toPbPeerInfo(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function fromPbPeerInfo(r){if(r.id==null)throw new Error("Invalid peer in message");const e=decode$8(r.id);return{id:peerIdFromMultihash(e),multiaddrs:(r.multiaddrs??[]).map(t=>multiaddr(t))}}class ContentRouting{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){const{network:n,peerRouting:a,queryManager:o,routingTable:c,providers:u,logPrefix:v}=t;this.components=e,this.log=e.logger.forComponent(`${v}:content-routing`),this.network=n,this.peerRouting=a,this.queryManager=o,this.routingTable=c,this.providers=u,this.findProviders=e.metrics?.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(_,x)=>(_.name==="PROVIDER"&&(x.providers??=[],x.providers.push(..._.providers.map(E=>E.id.toString()))),x)})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(_,x)=>(_.name==="PEER_RESPONSE"&&_.messageName==="ADD_PROVIDER"&&(x.providers??=[],x.providers.push(_.from.toString())),x)})??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const a=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const o={type:MessageType.ADD_PROVIDER,key:a,providers:[toPbPeerInfo({id:this.components.peerId,multiaddrs:t})]};let c=0;const u=v=>async()=>{if(v.name!=="FINAL_PEER")return[v];const _=[];this.log("putProvider %s to %p",e,v.peer.id);try{this.log("sending provider record for %s to %p",e,v.peer.id);for await(const x of this.network.sendMessage(v.peer.id,o,n))x.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,v.peer.id),c++),_.push(x)}catch(x){this.log.error("error sending provide record to peer %p",v.peer.id,x),_.push(queryErrorEvent({from:v.peer.id,error:x},n))}return _};yield*pipe(this.peerRouting.getClosestPeers(a,n),v=>map$3(v,_=>u(_)),v=>parallel(v,{ordered:!1,concurrency:ALPHA}),async function*(v){for await(const _ of v)yield*_}),this.log("sent provider records to %d peers",c)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let a=0;const o=e.multihash.bytes,c=this;this.log("findProviders %c",e);const u=await this.providers.getProviders(e);if(u.length>0){const x=[];for(const E of u.slice(0,n))try{const M=await this.components.peerStore.get(E);x.push({id:E,multiaddrs:M.addresses.map(({multiaddr:C})=>C)})}catch(M){if(M.name!=="NotFoundError")throw M;this.log("no peer store entry for %p",E)}if(yield peerResponseEvent({from:this.components.peerId,messageType:MessageType.GET_PROVIDERS,providers:x},t),yield providerEvent({from:this.components.peerId,providers:x},t),a+=x.length,a>=n)return}const v=async function*({peer:x,signal:E}){const M={type:MessageType.GET_PROVIDERS,key:o};yield*c.network.sendRequest(x,M,{...t,signal:E})},_=new PeerSet(u);for await(const x of this.queryManager.run(o,v,t))if(yield x,x.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",x.providers.length,e,x.closer.length);const E=[];for(const M of x.providers)_.has(M.id)||(_.add(M.id),E.push(M));if(E.length>0&&(yield providerEvent({from:x.from,providers:E},t),a+=E.length,a>=n))return}}}class Network extends TypedEventEmitter{log;protocol;running;components;timeout;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:network`),this.running=!1,this.protocol=t.protocol,this.timeout=new AdaptiveTimeout({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=e.metrics?.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([n,a],o){return{...o,to:n.toString(),"message type":`${a.type}`}},getAttributesFromYieldedValue:(n,a)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((o,c)=>{a[`providers-${c}`]=o.id.toString()}),n.closer.length>0&&n.closer.forEach((o,c)=>{a[`closer-${c}`]=o.id.toString()})),a)})??this.sendRequest,this.sendMessage=e.metrics?.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([n,a],o){return{...o,to:n.toString(),"message type":`${a.type}`}},getAttributesFromYieldedValue:(n,a)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((o,c)=>{a[`providers-${c}`]=o.id.toString()}),n.closer.length>0&&n.closer.forEach((o,c)=>{a[`closer-${c}`]=o.id.toString()})),a)})??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n={}){if(!this.running)return;const a=t.type;if(a==null)throw new InvalidParametersError("Message type was missing");this.log("sending %s to %p",t.type,e),yield dialPeerEvent({peer:e},n),yield sendQueryEvent({to:e,type:a},n);let o;const c=this.timeout.getTimeoutSignal(n);n={...n,signal:c};try{this.metrics.operations?.increment({[a]:!0}),o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n);const v=await this._writeReadMessage(o,t,n);o.close(n).catch(_=>{this.log.error("error closing stream to %p",e,_),o?.abort(_)}),yield peerResponseEvent({from:e,messageType:v.type,closer:v.closer.map(fromPbPeerInfo),providers:v.providers.map(fromPbPeerInfo),record:v.record==null?void 0:Libp2pRecord.deserialize(v.record)},n)}catch(u){this.metrics.errors?.increment({[a]:!0}),o?.abort(u),n.signal?.aborted!==!0&&this.log.error("could not send %s to %p - %e",t.type,e,u),yield queryErrorEvent({from:e,error:u},n)}finally{this.timeout.cleanUp(c)}}async*sendMessage(e,t,n={}){if(!this.running)return;const a=t.type;if(a==null)throw new InvalidParametersError("Message type was missing");this.log("sending %s to %p",t.type,e),yield dialPeerEvent({peer:e},n),yield sendQueryEvent({to:e,type:a},n);let o;const c=this.timeout.getTimeoutSignal(n);n={...n,signal:c};try{this.metrics.operations?.increment({[a]:!0}),o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n),await this._writeMessage(o,t,n),o.close(n).catch(v=>{this.log.error("error closing stream to %p",e,v),o?.abort(v)}),yield peerResponseEvent({from:e,messageType:a},n)}catch(u){this.metrics.errors?.increment({[a]:!0}),o?.abort(u),yield queryErrorEvent({from:e,error:u},n)}finally{this.timeout.cleanUp(c)}}async _writeMessage(e,t,n){await pbStream(e).write(t,Message,n)}async _writeReadMessage(e,t,n){const a=pbStream(e);await a.write(t,Message,n);const o=await a.read(Message,n);return o.closer.forEach(c=>{this.safeDispatchEvent("peer",{detail:fromPbPeerInfo(c)})}),o.providers.forEach(c=>{this.safeDispatchEvent("peer",{detail:fromPbPeerInfo(c)})}),o}}function xorCompare(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class PeerDistanceList{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await convertPeerId(e.id);this.addWitKadId(e,t)}addWitKadId(e,t){if(this.peerDistances.find(a=>a.peer.id.equals(e.id))!=null)return;const n={peer:e,distance:xor$1(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort((a,o)=>xorCompare(a.distance,o.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await convertPeerId(e),n=xor$1(t,this.originDhtKey),a=this.peerDistances[this.peerDistances.length-1].distance;return xorCompare(n,a)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class PeerRouting{log;routingTable;network;validators;queryManager;peerStore;peerId;constructor(e,t){this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=e.metrics?.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(a){if(a.name!=="NotFoundError")throw a}}if(t==null)try{t=await this.peerStore.get(e)}catch(a){if(a.name!=="NotFoundError")throw a}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(a=>a.multiaddr)}}async*_getValueSingle(e,t,n={}){const a={type:MessageType.GET_VALUE,key:t};yield*this.network.sendRequest(e,a,n)}async*getPublicKeyFromNode(e,t={}){const n=keyForPublicKey(e);for await(const a of this._getValueSingle(e,n,t))if(yield a,a.name==="PEER_RESPONSE"&&a.record!=null){const o=publicKeyFromProtobuf(a.record.value),c=peerIdFromPublicKey(o);if(!c.equals(e))throw new InvalidPublicKeyError("public key does not match id");if(c.publicKey==null)throw new InvalidPublicKeyError("public key missing");yield valueEvent({from:e,value:a.record.value},t)}throw new QueryError(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const a=await this.findPeerLocal(e);if(a!=null){this.log("found local"),yield finalPeerEvent({from:this.peerId,peer:a},t);return}}let n=!1;if(t.useNetwork!==!1){const a=this,o=async function*({peer:c,signal:u}){const v={type:MessageType.FIND_NODE,key:e.toMultihash().bytes};for await(const _ of a.network.sendRequest(c,v,{...t,signal:u}))if(yield _,_.name==="PEER_RESPONSE"){const x=_.closer.find(E=>E.id.equals(e));x!=null&&(yield finalPeerEvent({from:_.from,peer:x},t))}};for await(const c of this.queryManager.run(e.toMultihash().bytes,o,t))c.name==="FINAL_PEER"&&(n=!0),yield c}n||(yield queryErrorEvent({from:this.peerId,error:new NotFoundError$1("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await convertBuffer(e),a=this.routingTable.closestPeers(n),o=this,c=new PeerDistanceList(n,this.routingTable.kBucketSize);await Promise.all(a.map(async v=>{await c.add({id:v,multiaddrs:[]})}));const u=async function*({peer:v,signal:_}){o.log("closerPeersSingle %s from %p",toString$1(e,"base32"),v);const x={type:MessageType.FIND_NODE,key:e};yield*o.network.sendRequest(v,x,{...t,signal:_})};for await(const v of this.queryManager.run(e,u,t))v.name==="PEER_RESPONSE"&&await Promise.all(v.closer.map(async _=>{await c.add(_)})),yield v;this.log("found %d peers close to %b",c.length,e);for(const v of c.peers)yield finalPeerEvent({from:this.peerId,peer:v},t)}async*getValueOrPeers(e,t,n={}){for await(const a of this._getValueSingle(e,t,n)){if(a.name==="PEER_RESPONSE"&&a.record!=null)try{await this._verifyRecordOnline(a.record)}catch{const c="invalid record received, discarded";this.log(c),yield queryErrorEvent({from:a.from,error:new QueryError(c)},n);continue}yield a}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new InvalidRecordError("invalid record received");await verifyRecord(this.validators,new Libp2pRecord(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=[];try{const v=decode$8(e),_=peerIdFromMultihash(v),x=await this.peerStore.get(_);n.push({id:x.id,multiaddrs:x.addresses.map(({multiaddr:E})=>E)})}catch{}const a=await convertBuffer(e),o=this.routingTable.closestPeers(a),c=await convertPeerId(t),u=xor$1(c,a);for(const v of o){const _=await convertPeerId(v),x=xor$1(_,a);if(xorCompare(x,u)===-1)try{const E=await this.peerStore.get(v);n.push({id:v,multiaddrs:E.addresses.map(({multiaddr:M})=>M)})}catch(E){if(E.name!=="NotFoundError")throw E}}return n.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",n.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),n}}class Providers{log;datastore;datastorePrefix;lock;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const n=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{n()}}async removeProvider(e,t){const n=await this.lock.writeLock();try{const a=toProviderKey(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(a)}finally{n()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const n=await this.loadProviders(e);return this.log("got %d providers for %c",n.size,e),[...n.keys()]}finally{t()}}async writeProviderEntry(e,t,n=new Date){const a=toProviderKey(this.datastorePrefix,e,t),o=encode$2(n.getTime());await this.datastore.put(a,o)}async loadProviders(e){const t=new PeerMap,n=toProviderKey(this.datastorePrefix,e);for await(const a of this.datastore.query({prefix:n.toString()})){const{peerId:o}=parseProviderKey(a.key);t.set(o,readProviderTime(a.value))}return t}}async function*queryPath(r){const{key:e,startingPeer:t,ourPeerId:n,signal:a,query:o,alpha:c,pathIndex:u,numPaths:v,queryFuncTimeout:_,log:x,peersSeen:E,connectionManager:M}=r,C=new Queue({concurrency:c,sort:(L,N)=>xorCompare(L.options.distance,N.options.distance)}),I=await convertBuffer(e);function D(L,N){if(L==null)return;E.add(L);const q=xor$1(N,I);C.add(async()=>{const F=[a];_!=null&&F.push(AbortSignal.timeout(_));const U=anySignal(F);setMaxListeners(1/0,U);try{for await(const j of o({...r,key:e,peer:L,signal:U,pathIndex:u,numPaths:v})){if(U.aborted)return;if(j.name==="PEER_RESPONSE")for(const W of j.closer){if(E.has(W.id)){x.trace("already seen %p in query",W.id);continue}if(n.equals(W.id)){x("not querying ourselves");continue}if(!await M.isDialable(W.multiaddrs)){x("not querying undialable peer");continue}const X=await convertPeerId(W.id),J=xor$1(X,I);if(xorCompare(J,q)!==-1){x.trace("skipping %p as they are not closer to %b than %p",W.id,e,L);continue}x.trace("querying closer peer %p",W.id),D(W.id,X)}C.safeDispatchEvent("completed",{detail:j})}}catch(j){if(!a.aborted)return queryErrorEvent({from:L,error:j},r)}finally{U.clear()}},{distance:q}).catch(F=>{x.error(F)})}D(t,await convertPeerId(t));try{for await(const L of C.toGenerator({signal:a}))L!=null&&(yield L)}catch(L){throw a.aborted?new QueryAbortedError("Query aborted"):L}}class QueryManager{disjointPaths;alpha;shutDownController;running;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;constructor(e,t){this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??K,this.alpha=t.alpha??ALPHA,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal),this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal))}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const v=AbortSignal.timeout(DEFAULT_QUERY_TIMEOUT);setMaxListeners(1/0,v),n={...n,signal:v}}const a=new AbortController,o=anySignal([this.shutDownController.signal,a.signal,n.signal]);setMaxListeners(1/0,o,a.signal);const c=this.logger.forComponent(`${this.logPrefix}:query:`+toString$1(e,"base58btc"));let u=!1;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(c("waiting for initial query-self query before continuing"),await raceSignal(this.initialQuerySelfHasRun.promise,o),this.initialQuerySelfHasRun=void 0),c("query:start");const v=await convertBuffer(e),_=this.routingTable.closestPeers(v),x=_.slice(0,Math.min(this.disjointPaths,_.length));if(_.length===0){c.error("Running query with no peers");return}const E=new PeerSet,M=x.map((C,I)=>queryPath({...n,key:e,startingPeer:C,ourPeerId:this.peerId,signal:o,query:t,pathIndex:I,numPaths:x.length,alpha:this.alpha,queryFuncTimeout:n.queryFuncTimeout,log:c,peersSeen:E,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const C of merge$1(...M)){if(C.name==="QUERY_ERROR"&&c.error("query error",C.error),C.name==="PEER_RESPONSE")for(const I of[...C.closer,...C.providers])await this.connectionManager.isDialable(I.multiaddrs)&&await this.routingTable.add(I.id);yield C}u=!0}catch(v){if(!(!this.running&&v.name==="QueryAbortedError"))throw v}finally{u||(c("query exited early"),a.abort()),o.clear(),c("query:done")}}}function isAsyncIterable(r){return r[Symbol.asyncIterator]!=null}function length(r){if(isAsyncIterable(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}class QuerySelf{log;peerId;peerRouting;routingTable;count;interval;initialInterval;queryTimeout;running;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??K,this.interval=t.interval??QUERY_SELF_INTERVAL,this.initialInterval=t.initialInterval??QUERY_SELF_INITIAL_INTERVAL,this.queryTimeout=t.queryTimeout??QUERY_SELF_TIMEOUT,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=timeOperationMethod(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=pDefer(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);setMaxListeners(1/0,n),e.push(n)}const t=anySignal(e);setMaxListeners(1/0,t,this.controller.signal);try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await pEvent(this.routingTable,"peer:add",{signal:t,filter:o=>!this.peerId.equals(o.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),a=await pipe(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),o=>take(o,this.count),async o=>length(o));this.log("self-query found %d peers in %dms",a,Date.now()-n)}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class Reprovider extends TypedEventEmitter{log;reprovideQueue;maxQueueSize;datastore;timeout;reprovideTimeout;running;shutdownController;reprovideThreshold;contentRouting;datastorePrefix;addressManager;validity;interval;lock;peerId;constructor(e,t){super(),this.log=e.logger.forComponent(`${t.logPrefix}:reprovider`),this.peerId=e.peerId,this.reprovideQueue=new Queue({concurrency:t.concurrency??REPROVIDE_CONCURRENCY,metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new AdaptiveTimeout({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=e.datastore,this.addressManager=e.addressManager,this.datastorePrefix=`${t.datastorePrefix}/provider`,this.reprovideThreshold=t.threshold??REPROVIDE_THRESHOLD,this.maxQueueSize=t.maxQueueSize??REPROVIDE_MAX_QUEUE_SIZE,this.validity=t.validity??PROVIDERS_VALIDITY,this.interval=t.interval??REPROVIDE_INTERVAL,this.contentRouting=t.contentRouting,this.lock=t.lock,this.running=!1,this.reprovide=timeOperationMethod(this.reprovide.bind(this),t.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,setMaxListeners(1/0,this.shutdownController.signal),this.timeout=setTimeout(()=>{this.cleanUp().catch(e=>{this.log.error("error running reprovide/cleanup - %e",e)})},this.interval))}stop(){this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),this.shutdownController?.abort()}async cleanUp(){const e=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const t of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:n,peerId:a}=parseProviderKey(t.key),o=readProviderTime(t.value).getTime(),c=o+this.validity,u=Date.now(),v=u>c;this.log.trace("comparing: %d < %d = %s %s",o,u-this.validity,v,v?"(expired)":""),v&&await this.datastore.delete(t.key),this.peerId.equals(a)&&u-c<this.reprovideThreshold&&this.queueReprovide(n).catch(_=>{this.log.error("could not reprovide %c - %e",n,_)})}catch(n){this.log.error("error processing datastore key %s - %e",t.key,n.message)}this.log("reprovide/cleanup successful")}finally{e(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running re-provide - %e",t)})},this.interval))}}async queueReprovide(e){if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",e),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const t=this.reprovideQueue.queue.find(n=>n.options.cid.equals(e));if(t!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",e),t.join();this.log.trace("adding %c to re-provide queue",e),this.reprovideQueue.add(async n=>{if(n.signal?.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",e);const a=this.reprovideTimeout.getTimeoutSignal(n);try{await this.reprovide(n.cid,n)}finally{this.reprovideTimeout.cleanUp(a)}this.log.trace("re-provided %c",e)},{signal:this.shutdownController?.signal,cid:e}).catch(n=>{this.log.error("could not re-provide key %c - %e",e,n)})}async reprovide(e,t){await drain(this.contentRouting.provide(e,this.addressManager.getAddresses(),t))}}const PEER_SET_SIZE=20,REFRESH_INTERVAL=5e3,KAD_CLOSE_TAG_NAME="kad-close",KAD_CLOSE_TAG_VALUE=50;class ClosestPeers{routingTable;components;closestPeers;newPeers;refreshInterval;peerSetSize;timeout;closeTagName;closeTagValue;log;running;constructor(e,t){this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??REFRESH_INTERVAL,this.peerSetSize=t.peerSetSize??PEER_SET_SIZE,this.closeTagName=t.closeTagName??KAD_CLOSE_TAG_NAME,this.closeTagValue=t.closeTagValue??KAD_CLOSE_TAG_VALUE,this.closestPeers=new PeerSet,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await convertPeerId(this.components.peerId);this.newPeers=new PeerDistanceList(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){this.newPeers?.add({id:e.detail,multiaddrs:[]}).catch(t=>{this.log.error("error adding peer to distance list - %e",t)})}async updatePeerTags(){const e=new PeerSet(this.newPeers?.peers.map(a=>a.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async a=>{await this.components.peerStore.merge(a,{tags:{[this.closeTagName]:{value:this.closeTagValue},[KEEP_ALIVE_TAG]:{value:1}}})}),...[...n].map(async a=>{await this.components.peerStore.merge(a,{tags:{[this.closeTagName]:void 0,[KEEP_ALIVE_TAG]:void 0}})})])}}function isLeafBucket(r){return Array.isArray(r?.peers)}class KBucket{root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;lastPingThreshold;ping;verify;onAdd;onRemove;onMove;addingPeerMap;constructor(e){this.prefixLength=e.prefixLength??PREFIX_LENGTH,this.kBucketSize=e.kBucketSize??KBUCKET_SIZE,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??PING_OLD_CONTACT_COUNT,this.lastPingThreshold=e.lastPingThreshold??LAST_PING_THRESHOLD,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new PeerMap,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await convertPeerId(e),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await convertPeerId(e),lastPing:0},a=this.addingPeerMap.get(e);if(a!=null)return a;try{const o=this._add(n,t);this.addingPeerMap.set(e,o),await o}finally{this.addingPeerMap.delete(e)}}async _add(e,t){const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!needsPing(e,this.lastPingThreshold)){n.peers.push(e),await this.onAdd?.(e,n);return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const a=n.peers.filter(c=>!(c.peerId.equals(this.localPeer?.peerId)||c.lastPing>Date.now()-this.lastPingThreshold)).sort((c,u)=>c.lastPing<u.lastPing?-1:c.lastPing>u.lastPing?1:0).slice(0,this.numberOfNodesToPing);let o=!1;for await(const c of this.ping(a,t))o=!0,await this.remove(c.kadId);o&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const n=new PeerDistanceList(e,t);for(const a of this.toIterable())n.addWitKadId({id:a.peerId,multiaddrs:[]},a.kadId);yield*map$3(n.peers,a=>a.id)}count(){function e(t){if(isLeafBucket(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e){const t=this._determineBucket(e),n=this._indexOf(t,e);if(n>-1){const a=t.peers.splice(n,1)[0];await this.onRemove?.(a,t)}}*toIterable(){function*e(t){if(isLeafBucket(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+toString$1(xor$1(e,t),"base16"))}_determineBucket(e){const t=toString$1(e,"base2");function n(a,o=0){return isLeafBucket(a)?a:t[o]==="0"?n(a.left,o+1):n(a.right,o+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>equals(n.kadId,t))}async _split(e){const t={prefix:"0",depth:e.depth+1,peers:[]},n={prefix:"1",depth:e.depth+1,peers:[]};for(const a of e.peers)toString$1(a.kadId,"base2")[e.depth]==="0"?(t.peers.push(a),await this.onMove?.(a,e,t)):(n.peers.push(a),await this.onMove?.(a,e,n));convertToInternalBucket(e,t,n)}}function convertToInternalBucket(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function needsPing(r,e){return r.lastPing<Date.now()-e}const KBUCKET_SIZE=20,PREFIX_LENGTH=8,PING_NEW_CONTACT_CONCURRENCY=20,PING_NEW_CONTACT_MAX_QUEUE_SIZE=100,PING_OLD_CONTACT_COUNT=3,PING_OLD_CONTACT_CONCURRENCY=20,PING_OLD_CONTACT_MAX_QUEUE_SIZE=100,KAD_PEER_TAG_NAME="kad-peer",KAD_PEER_TAG_VALUE=1,LAST_PING_THRESHOLD=6e5,POPULATE_FROM_DATASTORE_ON_START=!0,POPULATE_FROM_DATASTORE_LIMIT=1e3;class RoutingTable extends TypedEventEmitter{kBucketSize;kb;network;closestPeerTagger;log;components;running;pingNewContactTimeout;pingNewContactQueue;pingOldContactTimeout;pingOldContactQueue;populateFromDatastoreOnStart;populateFromDatastoreLimit;protocol;peerTagName;peerTagValue;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.kBucketSize=t.kBucketSize??KBUCKET_SIZE,this.running=!1,this.protocol=t.protocol,this.network=t.network,this.peerTagName=t.peerTagName??KAD_PEER_TAG_NAME,this.peerTagValue=t.peerTagValue??KAD_PEER_TAG_VALUE,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=t.populateFromDatastoreOnStart??POPULATE_FROM_DATASTORE_ON_START,this.populateFromDatastoreLimit=t.populateFromDatastoreLimit??POPULATE_FROM_DATASTORE_LIMIT,this.pingOldContactQueue=new PeerQueue({concurrency:t.pingOldContactConcurrency??PING_OLD_CONTACT_CONCURRENCY,metricName:`${t.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:t.pingOldContactMaxQueueSize??PING_OLD_CONTACT_MAX_QUEUE_SIZE}),this.pingOldContactTimeout=new AdaptiveTimeout({...t.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new PeerQueue({concurrency:t.pingNewContactConcurrency??PING_NEW_CONTACT_CONCURRENCY,metricName:`${t.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:t.pingNewContactMaxQueueSize??PING_NEW_CONTACT_MAX_QUEUE_SIZE}),this.pingNewContactTimeout=new AdaptiveTimeout({...t.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new KBucket({kBucketSize:t.kBucketSize,prefixLength:t.prefixLength,splitThreshold:t.splitThreshold,numberOfOldContactsToPing:t.numberOfOldContactsToPing,lastPingThreshold:t.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new ClosestPeers(this.components,{logPrefix:t.logPrefix,routingTable:this,peerSetSize:t.closestPeerSetSize,refreshInterval:t.closestPeerSetRefreshInterval,closeTagName:t.closeTagName,closeTagValue:t.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${t.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await start(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let e=0;for(const t of await this.components.peerStore.all({filters:[n=>n.protocols.includes(this.protocol)&&n.tags.has(KAD_PEER_TAG_NAME)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(t.id),e++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(t.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",e)}).catch(e=>{this.log.error("error adding peer store peers to the routing table %e",e)})}async stop(){this.running=!1,await stop(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(e,t){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:e.peerId})}async peerRemoved(e,t){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:e.peerId})}async*pingOldContacts(e,t){if(!this.running)return;const n=[];for(const a of e){if(this.kb.get(a.kadId)==null){this.log("asked to ping contact %p that was not in routing table",a.peerId);continue}this.metrics?.kadBucketEvents.increment({ping_old_contact:!0}),n.push(async()=>{const o=this.pingOldContactQueue.find(a.peerId);if(o!=null)return this.log("asked to ping contact %p was already being pinged",a.peerId),await o.join(t)?void 0:a;if(!await this.pingOldContactQueue.add(async u=>{const v=this.pingOldContactTimeout.getTimeoutSignal(),_=anySignal([v,u?.signal]);setMaxListeners(1/0,v,_);try{return await this.pingContact(a,u)}catch{return this.metrics?.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(v),_.clear()}},{peerId:a.peerId,signal:t?.signal}))return a})}for await(const a of parallel(n))a!=null&&(yield a)}async verifyNewContact(e,t){const n=this.pingNewContactTimeout.getTimeoutSignal(),a=anySignal([n,t?.signal]);setMaxListeners(1/0,n,a);try{const o=this.pingNewContactQueue.find(e.peerId);return o!=null?(this.log("joining existing ping to add new peer %p to routing table",e.peerId),await o.join({signal:a})):await this.pingNewContactQueue.add(async c=>(this.metrics?.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",e.peerId),this.pingContact(e,c)),{peerId:e.peerId,signal:a})}catch{return this.log.trace("tried to add peer %p but they were not online",e.peerId),this.metrics?.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(n),a.clear()}}async pingContact(e,t){try{this.log("pinging contact %p",e.peerId);for await(const n of this.network.sendRequest(e.peerId,{type:MessageType.PING},t))if(n.type===EventTypes.PEER_RESPONSE)return n.messageType===MessageType.PING?(this.log("contact %p ping ok",e.peerId),this.safeDispatchEvent("peer:ping",{detail:e.peerId}),!0):!1;return!1}catch(n){return this.log("error pinging old contact %p - %e",e.peerId,n),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(e){const t=await convertPeerId(e);return this.kb.get(t)?.peerId}closestPeer(e){const t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(e,t)]}async add(e,t){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(e,t)}async remove(e){if(this.kb==null)throw new Error("RoutingTable is not started");const t=await convertPeerId(e);await this.kb.remove(t)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let e=0,t=0,n=0,a=20,o=0;function c(u){if(isLeafBucket(u)){u.depth>n&&(n=u.depth),t++,e+=u.peers.length,u.peers.length<a&&(a=u.peers.length),u.peers.length>o&&(o=u.peers.length);return}c(u.left),c(u.right)}c(this.kb.root),this.metrics.routingTableSize.update(e),this.metrics.routingTableKadBucketTotal.update(t),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(e/t)),this.metrics.routingTableKadBucketMinOccupancy.update(a),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(n)}}const GENERATED_PREFIXES=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],MAX_COMMON_PREFIX_LENGTH=15;class RoutingTableRefresh{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e,t){const{peerRouting:n,routingTable:a,refreshInterval:o,refreshQueryTimeout:c,logPrefix:u}=t;this.log=e.logger.forComponent(`${u}:routing-table:refresh`),this.peerRouting=n,this.routingTable=a,this.refreshInterval=o??TABLE_REFRESH_INTERVAL,this.refreshQueryTimeout=c??TABLE_REFRESH_QUERY_TIMEOUT,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(a=>a.toISOString()).join(", ")} ]`),Promise.all(n.map(async(a,o)=>{try{if(await this._refreshCommonPrefixLength(o,a,e),this._numPeersForCpl(t)===0){const c=Math.min(2*(o+1),n.length-1);for(let u=o+1;u<c+1;u++)try{await this._refreshCommonPrefixLength(u,a,e)}catch(v){this.log.error(v)}}}catch(c){this.log.error(c)}})).catch(a=>{this.log.error(a)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(a=>{this.log.error(a)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const a=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,a,this.routingTable.size);const o=AbortSignal.timeout(this.refreshQueryTimeout);setMaxListeners(1/0,o);const c=await length(this.peerRouting.getClosestPeers(a.toMultihash().bytes,{signal:o}));this.log(`found ${c} peers that were close to imaginary peer %p`,a),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,a,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>MAX_COMMON_PREFIX_LENGTH&&(e=MAX_COMMON_PREFIX_LENGTH);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=randomBytes(2),n=(t[1]<<8)+t[0],a=await this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),o=decode$8(a);return peerIdFromMultihash(o)}async _makePeerId(e,t,n){if(n>MAX_COMMON_PREFIX_LENGTH)throw new Error(`Cannot generate peer ID for common prefix length greater than ${MAX_COMMON_PREFIX_LENGTH}`);const c=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,u=65535<<16-(n+1),v=c&u|t&~u,_=GENERATED_PREFIXES[v],x=new ArrayBuffer(34),E=new DataView(x,0,x.byteLength);return E.setUint8(0,sha256$2.code),E.setUint8(1,32),E.setUint32(2,_,!1),new Uint8Array(E.buffer,E.byteOffset,E.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb?.localPeer!=null)for(const{kadId:e}of this.routingTable.kb.toIterable()){const t=xor$1(this.routingTable.kb.localPeer.kadId,e);let n=0;for(const a of t)if(a===0)n++;else break;yield n}}}class AddProviderHandler{peerId;providers;peerStore;log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new InvalidMessageError("Missing key");let n;try{n=CID.decode(t.key)}catch{throw new InvalidMessageError("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async a=>{const o=decode$8(a.id),c=peerIdFromMultihash(o),u=a.multiaddrs.map(v=>multiaddr(v));if(!e.equals(c)){this.log("invalid provider peer %p from %p",a.id,e);return}if(a.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,u),await this.providers.addProvider(n,c),await this.peerStore.merge(c,{multiaddrs:u})}))}}class FindNodeHandler{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(e,t){const{peerRouting:n,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new InvalidMessageError("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getCloserPeersOffline(t.key,e);equals(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(o=>o.decapsulateCode(getProtocol("p2p").code))});const a={type:MessageType.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:o})=>o.length).map(o=>({id:o.id.toMultihash().bytes,multiaddrs:o.multiaddrs.map(c=>c.bytes)})),providers:[]};return a.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),a}}class GetProvidersHandler{peerId;peerRouting;providers;peerStore;peerInfoMapper;log;constructor(e,t){const{peerRouting:n,providers:a,logPrefix:o}=t;this.log=e.logger.forComponent(`${o}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=a,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new InvalidMessageError("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=CID.decode(t.key)}catch{throw new InvalidMessageError("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[a,o]=await Promise.all([all(map$3(await this.providers.getProviders(n),async u=>{const v=await this.peerStore.get(u);return{id:v.id,multiaddrs:v.addresses.map(({multiaddr:x})=>x)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),c={type:MessageType.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:o.map(this.peerInfoMapper).filter(({id:u,multiaddrs:v})=>v.length>0).map(u=>({id:u.id.toMultihash().bytes,multiaddrs:u.multiaddrs.map(v=>v.bytes)})),providers:a.map(this.peerInfoMapper).filter(({id:u,multiaddrs:v})=>v.length>0).map(u=>({id:u.id.toMultihash().bytes,multiaddrs:u.multiaddrs.map(v=>v.bytes)}))};return this.log("got %s providers %s closerPeers",c.providers.length,c.closer.length),c}async _getAddresses(e){return[]}}class GetValueHandler{peerStore;datastore;peerRouting;log;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new InvalidMessageError("Invalid key");const a={type:MessageType.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(isPublicKeyKey(n)){this.log("is public key");const u=fromPublicKeyKey(n);let v;try{const _=await this.peerStore.get(u);if(_.id.publicKey==null)throw new NotFoundError$1("No public key found in key book");v=publicKeyToProtobuf(_.id.publicKey)}catch(_){if(_.name!=="NotFoundError")throw _}if(v!=null)return this.log("returning found public key"),a.record=new Libp2pRecord(n,v,new Date).serialize(),a}const[o,c]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return o!=null&&(this.log("had record for %b in local datastore",n),a.record=o.serialize()),c.length>0&&(this.log("had %s closer peers in routing table",c.length),a.closer=c.map(u=>({id:u.id.toMultihash().bytes,multiaddrs:u.multiaddrs.map(v=>v.bytes)}))),a}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=bufferToRecordKey(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(o){if(o.name==="NotFoundError")return;throw o}const a=Libp2pRecord.deserialize(n);if(a.timeReceived==null||Date.now()-a.timeReceived.getTime()>MAX_RECORD_AGE){await this.datastore.delete(t);return}return a}}class PingHandler{log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class PutValueHandler{components;validators;log;datastorePrefix;constructor(e,t){const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const a=`Empty record from: ${e.toString()}`;throw this.log.error(a),new InvalidMessageError(a)}try{const a=Libp2pRecord.deserialize(t.record);await verifyRecord(this.validators,a),a.timeReceived=new Date;const o=bufferToRecordKey(this.datastorePrefix,a.key);await this.components.datastore.put(o,a.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,o)}catch(a){this.log("did not put record for key %b into datastore %o",n,a)}return t}}class RPC{handlers;routingTable;log;metrics;constructor(e,t){this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[MessageType.GET_VALUE.toString()]:new GetValueHandler(e,t),[MessageType.PUT_VALUE.toString()]:new PutValueHandler(e,t),[MessageType.FIND_NODE.toString()]:new FindNodeHandler(e,t),[MessageType.ADD_PROVIDER.toString()]:new AddProviderHandler(e,t),[MessageType.GET_PROVIDERS.toString()]:new GetProvidersHandler(e,t),[MessageType.PING.toString()]:new PingHandler(e,t)}}async handleMessage(e,t){const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return this.metrics.operations?.increment({[t.type]:!0}),await n.handle(e,t)}catch{this.metrics.errors?.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:n,connection:a}=e,o=a.remotePeer,c=this;await pipe(n,u=>decode(u),async function*(u){for await(const v of u){const _=Message.decode(v);t=_.type,c.log("incoming %s from %p",_.type,o);const x=await c.handleMessage(o,_);x!=null&&(yield Message.encode(x))}},u=>encode$1(u),n)}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}}class TopologyListener extends TypedEventEmitter{log;components;protocol;running;registrarId;constructor(e,t){super();const{protocol:n,logPrefix:a}=t;this.components=e,this.log=e.logger.forComponent(`${a}:topology-listener`),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:e}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class DHTContentRouting{dht;constructor(e){this.dht=e}async provide(e,t={}){await drain(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await drain(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new NotFoundError$1("Could not find value for key")}}class DHTPeerRouting{dht;constructor(e){this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new NotFoundError$1("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const DEFAULT_MAX_INBOUND_STREAMS=32,DEFAULT_MAX_OUTBOUND_STREAMS=64;class KadDHT extends TypedEventEmitter{protocol;routingTable;providers;network;peerRouting;components;log;running;kBucketSize;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;reprovider;constructor(e,t={}){super();const n=t.logPrefix??"libp2p:kad-dht",a=t.datastorePrefix??"/dht",o=t.metricsPrefix??"libp2p_kad_dht",c={queries:e.metrics?.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:e.metrics?.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:e.metrics?.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:e.metrics?.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=e,this.log=e.logger.forComponent(n),this.protocol=t.protocol??PROTOCOL,this.kBucketSize=t.kBucketSize??20,this.clientMode=t.clientMode??!0,this.maxInboundStreams=t.maxInboundStreams??DEFAULT_MAX_INBOUND_STREAMS,this.maxOutboundStreams=t.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS,this.peerInfoMapper=t.peerInfoMapper??removePrivateAddressesMapper;const u=createMortice();this.providers=new Providers(e,{...t.providers,logPrefix:n,datastorePrefix:a,lock:u}),this.validators={...validators,...t.validators},this.selectors={...selectors,...t.selectors},this.network=new Network(e,{protocol:this.protocol,logPrefix:n,metricsPrefix:o}),this.routingTable=new RoutingTable(e,{kBucketSize:t.kBucketSize,pingOldContactTimeout:t.pingOldContactTimeout,pingOldContactConcurrency:t.pingOldContactConcurrency,pingOldContactMaxQueueSize:t.pingOldContactMaxQueueSize,pingNewContactTimeout:t.pingNewContactTimeout,pingNewContactConcurrency:t.pingNewContactConcurrency,pingNewContactMaxQueueSize:t.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:n,metricsPrefix:o,prefixLength:t.prefixLength,splitThreshold:t.kBucketSplitThreshold,network:this.network});const v=pDefer();t.allowQueryWithZeroPeers===!0&&v.resolve(),this.queryManager=new QueryManager(e,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:n,metricsPrefix:o,initialQuerySelfHasRun:v,routingTable:this.routingTable}),this.peerRouting=new PeerRouting(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:n}),this.contentFetching=new ContentFetching(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:n,datastorePrefix:a}),this.contentRouting=new ContentRouting(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:n}),this.routingTableRefresh=new RoutingTableRefresh(e,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:n}),this.rpc=new RPC(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:n,metricsPrefix:o,datastorePrefix:a,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new TopologyListener(e,{protocol:this.protocol,logPrefix:n}),this.querySelf=new QuerySelf(e,{peerRouting:this.peerRouting,interval:t.querySelfInterval,initialInterval:t.initialQuerySelfInterval,logPrefix:n,initialQuerySelfHasRun:v,routingTable:this.routingTable,operationMetrics:c}),this.reprovider=new Reprovider(e,{...t.reprovide,logPrefix:n,metricsPrefix:o,datastorePrefix:a,contentRouting:this.contentRouting,lock:u,operationMetrics:c}),this.network.addEventListener("peer",_=>{const x=_.detail;this.onPeerConnect(x).catch(E=>{this.log.error("could not add %p to routing table",x.id,E)}),this.dispatchEvent(new CustomEvent("peer",{detail:x}))}),this.topologyListener.addEventListener("peer",_=>{const x=_.detail;Promise.resolve().then(async()=>{const E=await this.components.peerStore.get(x),M={id:x,multiaddrs:E.addresses.map(({multiaddr:C})=>C),protocols:E.protocols};await this.onPeerConnect(M)}).catch(E=>{this.log.error("could not add %p to routing table - %e",x,E)})}),this.dhtPeerRouting=new DHTPeerRouting(this),this.dhtContentRouting=new DHTContentRouting(this),t.clientMode==null&&e.events.addEventListener("self:peer:update",_=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const x=_.detail.peer.addresses.some(({multiaddr:M})=>multiaddrIsPublic(M)),E=this.getMode();x&&E==="client"?await this.setMode("server"):E==="server"&&!x&&await this.setMode("client")}).catch(x=>{this.log.error("error setting dht server mode",x)})}),this.get=timeOperationGenerator(this.get.bind(this),c,"GET_VALUE"),this.findProviders=timeOperationGenerator(this.findProviders.bind(this),c,"FIND_PROVIDERS"),this.findPeer=timeOperationGenerator(this.findPeer.bind(this),c,"FIND_PEER"),this.getClosestPeers=timeOperationGenerator(this.getClosestPeers.bind(this),c,"GET_CLOSEST_PEERS"),this.provide=timeOperationGenerator(this.provide.bind(this),c,"PROVIDE"),this.put=timeOperationGenerator(this.put.bind(this),c,"PUT_VALUE")}[Symbol.toStringTag]="@libp2p/kad-dht";[serviceCapabilities]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"];[serviceDependencies]=["@libp2p/identify"];get[contentRoutingSymbol](){return this.dhtContentRouting}get[peerRoutingSymbol](){return this.dhtPeerRouting}get[peerDiscoverySymbol](){return this}async onPeerConnect(e){if(this.log.trace("peer %p connected",e.id),e=this.peerInfoMapper(e),e.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",e.id,e.multiaddrs.map(t=>t.toString()));return}try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(e,t=!1){if(e===this.getMode()&&!t){this.log("already in %s mode",e);return}if(await this.components.registrar.unhandle(this.protocol),e===this.getMode()&&!t){this.log("already in %s mode",e);return}e==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await start(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await start(this.querySelf))}async stop(){this.running=!1,await stop(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async cancelReprovide(e){await this.providers.removeProvider(e,this.components.peerId)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var EventTypes;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(EventTypes||(EventTypes={}));function kadDHT(r={}){return e=>new KadDHT(e,r)}class P2PNetwork extends eventsExports.EventEmitter{constructor(){super(),this.node=null,this.peers=new Map,this.webrtc=new webRTC}async init(){try{this.node=await createLibp2p({transports:[this.webrtc.transport],peerDiscovery:[this.webrtc.discovery,bootstrap({list:["/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa"]})],connectionEncryption:[noise()],streamMuxers:[mplex()],dht:kadDHT(),connectionManager:{minConnections:3,maxConnections:10}}),this.node.connectionManager.on("peer:connect",this.handlePeerConnect.bind(this)),this.node.connectionManager.on("peer:disconnect",this.handlePeerDisconnect.bind(this)),this.node.on("peer:discovery",this.handlePeerDiscovery.bind(this)),await this.node.start(),console.log("Libp2p node started with ID:",this.node.peerId.toString())}catch(e){throw console.error("Failed to initialize P2P network:",e),e}}async handlePeerConnect(e){const t=e.remotePeer.toString();console.log("Connected to peer:",t),this.peers.set(t,e);try{const{stream:n}=await e.newStream("/census-data/1.0.0"),a=n.sink.getReader();for(;;){const{value:o,done:c}=await a.read();if(c)break;const u=JSON.parse(new TextDecoder().decode(o));u.type==="data"&&this.emit("data",u.data)}}catch(n){console.error("Error handling peer connection:",n)}}handlePeerDisconnect(e){const t=e.remotePeer.toString();console.log("Disconnected from peer:",t),this.peers.delete(t)}handlePeerDiscovery(e){console.log("Discovered peer:",e.toString())}async broadcastData(e){const t=JSON.stringify({type:"data",data:e}),n=new TextEncoder;for(const[a,o]of this.peers)try{const{stream:c}=await o.newStream("/census-data/1.0.0");await c.sink.write(n.encode(t)),await c.close()}catch(c){console.error("Error broadcasting to peer:",a,c)}}}const p2pNetwork=new P2PNetwork;var sea={exports:{}};sea.exports;(function(r){(function(){function e(n,a){return a?commonjsRequire(n):n.slice?e[o(n)]:function(c,u){n(c={exports:{}}),e[o(u)]=c.exports};function o(c){return c.split("/").slice(-1).toString().replace(".js","")}}var t=r;e(function(n){typeof self<"u"&&(n.window=self),typeof window<"u"&&(n.window=window);var a=n.window||n,o,c=a.SEA||{};(c.window=n.window)&&(c.window.SEA=c);try{o+""!=typeof t&&(t.exports=c)}catch{}n.exports=c})(e,"./root"),e(function(n){var a=e("./root");try{a.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(e,"./https"),e(function(n){var a;if(a+""==typeof btoa){if(a+""==typeof dist.Buffer)try{commonjsGlobal.Buffer=e("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}commonjsGlobal.btoa=function(o){return dist.Buffer.from(o,"binary").toString("base64")},commonjsGlobal.atob=function(o){return dist.Buffer.from(o,"base64").toString("binary")}}})(e,"./base64"),e(function(n){e("./base64");function a(){}Object.assign(a,{from:Array.from}),a.prototype=Object.create(Array.prototype),a.prototype.toString=function(o,c,u){o=o||"utf8",c=c||0;const v=this.length;if(o==="hex"){const _=new Uint8Array(this);return[...Array((u&&u+1||v)-c).keys()].map(x=>_[x+c].toString(16).padStart(2,"0")).join("")}if(o==="utf8")return Array.from({length:(u||v)-c},(_,x)=>String.fromCharCode(this[x+c])).join("");if(o==="base64")return btoa(this)},n.exports=a})(e,"./array"),e(function(n){e("./base64");var a=e("./array");function o(...c){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),o.from(...c)}o.prototype=Object.create(Array.prototype),Object.assign(o,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const c=arguments[0];let u;if(typeof c=="string"){const _=arguments[1]||"utf8";if(_==="hex"){const x=c.match(/([\da-fA-F]{2})/g).map(E=>parseInt(E,16));if(!x||!x.length)throw new TypeError("Invalid first argument for type 'hex'.");u=a.from(x)}else if(_==="utf8"||_==="binary"){const x=c.length,E=new Uint16Array(x);Array.from({length:x},(M,C)=>E[C]=c.charCodeAt(C)),u=a.from(E)}else if(_==="base64"){const x=atob(c),E=x.length,M=new Uint8Array(E);Array.from({length:E},(C,I)=>M[I]=x.charCodeAt(I)),u=a.from(M)}else _==="binary"?u=a.from(c):console.info("SafeBuffer.from unknown encoding: "+_);return u}if(c.byteLength,c.byteLength?c.byteLength:c.length){let _;return c instanceof ArrayBuffer&&(_=new Uint8Array(c)),a.from(_||c)}},alloc(c,u=0){return a.from(new Uint8Array(Array.from({length:c},()=>u)))},allocUnsafe(c){return a.from(new Uint8Array(Array.from({length:c})))},concat(c){if(!Array.isArray(c))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return a.from(c.reduce((u,v)=>u.concat(Array.from(v)),[]))}}),o.prototype.from=o.from,o.prototype.toString=a.prototype.toString,n.exports=o})(e,"./buffer"),e(function(n){const a=e("./root"),o={Buffer:e("./buffer")};var c={},u;if(JSON.parseAsync=JSON.parseAsync||function(_,x,E){var M;try{x(M,JSON.parse(_,E))}catch(C){x(C)}},JSON.stringifyAsync=JSON.stringifyAsync||function(_,x,E,M){var C;try{x(C,JSON.stringify(_,E,M))}catch(I){x(I)}},o.parse=function(_,x){return new Promise(function(E,M){JSON.parseAsync(_,function(C,I){C?M(C):E(I)},x)})},o.stringify=function(_,x,E){return new Promise(function(M,C){JSON.stringifyAsync(_,function(I,D){I?C(I):M(D)},x,E)})},a.window&&(o.crypto=a.window.crypto||a.window.msCrypto,o.subtle=(o.crypto||c).subtle||(o.crypto||c).webkitSubtle,o.TextEncoder=a.window.TextEncoder,o.TextDecoder=a.window.TextDecoder,o.random=_=>o.Buffer.from(o.crypto.getRandomValues(new Uint8Array(o.Buffer.alloc(_))))),!o.TextDecoder){const{TextEncoder:_,TextDecoder:x}=e((u+""==typeof t?".":"")+"./lib/text-encoding",1);o.TextDecoder=x,o.TextEncoder=_}if(!o.crypto)try{var v=e("crypto",1);Object.assign(o,{crypto:v,random:x=>o.Buffer.from(v.randomBytes(x))});const{Crypto:_}=e("@peculiar/webcrypto",1);o.ossl=o.subtle=new _({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}n.exports=o})(e,"./shim"),e(function(n){var a=e("./root"),o=e("./shim"),c={};c.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},c.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},c.ecdh={name:"ECDH",namedCurve:"P-256"},c.jwk=function(u,v){u=u.split(".");var _=u[0],x=u[1],E={kty:"EC",crv:"P-256",x:_,y:x,ext:!0};return E.key_ops=v?["sign"]:["verify"],v&&(E.d=v),E},c.keyToJwk=function(u){return{kty:"oct",k:u.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},c.recall={validity:12*60*60,hook:function(u){return u}},c.check=function(u){return typeof u=="string"&&u.slice(0,4)==="SEA{"},c.parse=async function(v){try{var _=typeof v=="string";return _&&v.slice(0,4)==="SEA{"&&(v=v.slice(3)),_?await o.parse(v):v}catch{}return v},a.opt=c,n.exports=c})(e,"./settings"),e(function(n){var a=e("./shim");n.exports=async function(o,c){var u=typeof o=="string"?o:await a.stringify(o),v=await a.subtle.digest({name:c||"SHA-256"},new a.TextEncoder().encode(u));return a.Buffer.from(v)}})(e,"./sha256"),e(function(n){const a=e("./shim"),o=a.subtle,c=a.ossl?a.ossl:o,u=v=>c.digest({name:"SHA-1"},new ArrayBuffer(v));n.exports=u})(e,"./sha1"),e(function(n){var a=e("./root"),o=e("./shim"),c=e("./settings"),u=e("./sha256"),v;a.work=a.work||(async(_,x,E,M)=>{try{var C=(x||{}).epub||x;if(M=M||{},C instanceof Function&&(E=C,C=v),_=typeof _=="string"?_:await o.stringify(_),(M.name||"").toLowerCase().slice(0,3)==="sha"){var I=o.Buffer.from(await u(_,M.name),"binary").toString(M.encode||"base64");if(E)try{E(I)}catch(q){console.log(q)}return I}C=C||o.random(9);var D=await(o.ossl||o.subtle).importKey("raw",new o.TextEncoder().encode(_),{name:M.name||"PBKDF2"},!1,["deriveBits"]),L=await(o.ossl||o.subtle).deriveBits({name:M.name||"PBKDF2",iterations:M.iterations||c.pbkdf2.iter,salt:new o.TextEncoder().encode(M.salt||C),hash:M.hash||c.pbkdf2.hash},D,M.length||c.pbkdf2.ks*8);_=o.random(_.length);var N=o.Buffer.from(L,"binary").toString(M.encode||"base64");if(E)try{E(N)}catch(q){console.log(q)}return N}catch(q){if(console.log(q),a.err=q,a.throw)throw q;E&&E();return}}),n.exports=a.work})(e,"./work"),e(function(n){var a=e("./root"),o=e("./shim");e("./settings"),a.name=a.name||(async(c,u)=>{try{if(c)try{c()}catch(v){console.log(v)}return}catch(v){if(console.log(v),a.err=v,a.throw)throw v;c&&c();return}}),a.pair=a.pair||(async(c,u)=>{try{var v=o.ossl||o.subtle,_=await o.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async M=>{var C={};C.priv=(await o.subtle.exportKey("jwk",M.privateKey)).d;var I=await o.subtle.exportKey("jwk",M.publicKey);return C.pub=I.x+"."+I.y,C});try{var x=await v.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async M=>{var C={};C.epriv=(await v.exportKey("jwk",M.privateKey)).d;var I=await v.exportKey("jwk",M.publicKey);return C.epub=I.x+"."+I.y,C})}catch(M){if(a.window)throw M;if(M=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw M}x=x||{};var E={pub:_.pub,priv:_.priv,epub:x.epub,epriv:x.epriv};if(c)try{c(E)}catch(M){console.log(M)}return E}catch(M){if(console.log(M),a.err=M,a.throw)throw M;c&&c();return}}),n.exports=a.pair})(e,"./pair"),e(function(n){var a=e("./root"),o=e("./shim"),c=e("./settings"),u=e("./sha256"),v;a.sign=a.sign||(async(_,x,E,M)=>{try{if(M=M||{},!(x||M).priv){if(!a.I)throw"No signing key.";x=await a.I(null,{what:_,how:"sign",why:M.why})}if(v===_)throw"`undefined` not allowed.";var C=await c.parse(_),I=M.check=M.check||C;if(a.verify&&(a.opt.check(I)||I&&I.s&&I.m)&&v!==await a.verify(I,x)){var U=await c.parse(I);if(M.raw||(U="SEA"+await o.stringify(U)),E)try{E(U)}catch(W){console.log(W)}return U}var D=x.pub,L=x.priv,N=c.jwk(D,L),q=await u(C),F=await(o.ossl||o.subtle).importKey("jwk",N,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(j=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},j,new Uint8Array(q))),U={m:C,s:o.Buffer.from(F,"binary").toString(M.encode||"base64")};if(M.raw||(U="SEA"+await o.stringify(U)),E)try{E(U)}catch(j){console.log(j)}return U}catch(j){if(console.log(j),a.err=j,a.throw)throw j;E&&E();return}}),n.exports=a.sign})(e,"./sign"),e(function(n){var a=e("./root"),o=e("./shim"),c=e("./settings"),u=e("./sha256"),v;a.verify=a.verify||(async(E,M,C,I)=>{try{var D=await c.parse(E);if(M===!1){var L=await c.parse(D.m);if(C)try{C(L)}catch(G){console.log(G)}return L}I=I||{};var N=M.pub||M,q=a.opt.slow_leak?await a.opt.slow_leak(N):await(o.ossl||o.subtle).importKey("jwk",c.jwk(N),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),F=await u(D.m),U,j,W,X;try{if(U=o.Buffer.from(D.s,I.encode||"base64"),j=new Uint8Array(U),W=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},q,j,new Uint8Array(F)),!W)throw"Signature did not match."}catch{if(a.opt.fallback)return await a.opt.fall_verify(E,M,C,I)}var J=W?await c.parse(D.m):v;if(C)try{C(J)}catch(G){console.log(G)}return J}catch(G){if(console.log(G),a.err=G,a.throw)throw G;C&&C();return}}),n.exports=a.verify;var _={};a.opt.slow_leak=E=>{if(_[E])return _[E];var M=c.jwk(E);return _[E]=(o.ossl||o.subtle).importKey("jwk",M,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),_[E]};var x=a.opt;a.opt.fall_verify=async function(E,M,C,I,D){if(D===a.opt.fallback)throw"Signature did not match";D=D||1;var L=E||"";E=a.opt.unpack(E)||E;var N=await c.parse(E),q=M.pub||M,F=await a.opt.slow_leak(q),U=D<=a.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},new o.TextEncoder().encode(await c.parse(N.m)))):await u(N.m),j,W,X;try{if(j=o.Buffer.from(N.s,I.encode||"base64"),W=new Uint8Array(j),X=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},F,W,new Uint8Array(U)),!X)throw"Signature did not match."}catch{try{j=o.Buffer.from(N.s,"utf8"),W=new Uint8Array(j),X=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},F,W,new Uint8Array(U))}catch{if(!X)throw"Signature did not match."}}var J=X?await c.parse(N.m):v;if(x.fall_soul=L["#"],x.fall_key=L["."],x.fall_val=E,x.fall_state=L[">"],C)try{C(J)}catch(G){console.log(G)}return J},a.opt.fallback=2})(e,"./verify"),e(function(n){var a=e("./shim"),o=e("./settings"),c=e("./sha256");const u=async(v,_,x)=>{const E=v+(_||a.random(8)).toString("utf8"),M=a.Buffer.from(await c(E),"binary"),C=o.keyToJwk(M);return await a.subtle.importKey("jwk",C,{name:"AES-GCM"},!1,["encrypt","decrypt"])};n.exports=u})(e,"./aeskey"),e(function(n){var a=e("./root"),o=e("./shim");e("./settings");var c=e("./aeskey"),u;a.encrypt=a.encrypt||(async(v,_,x,E)=>{try{E=E||{};var M=(_||E).epriv||_;if(u===v)throw"`undefined` not allowed.";if(!M){if(!a.I)throw"No encryption key.";_=await a.I(null,{what:v,how:"encrypt",why:E.why}),M=_.epriv||_}var C=typeof v=="string"?v:await o.stringify(v),I={s:o.random(9),iv:o.random(15)},D=await c(M,I.s,E).then(N=>o.subtle.encrypt({name:E.name||"AES-GCM",iv:new Uint8Array(I.iv)},N,new o.TextEncoder().encode(C))),L={ct:o.Buffer.from(D,"binary").toString(E.encode||"base64"),iv:I.iv.toString(E.encode||"base64"),s:I.s.toString(E.encode||"base64")};if(E.raw||(L="SEA"+await o.stringify(L)),x)try{x(L)}catch(N){console.log(N)}return L}catch(N){if(console.log(N),a.err=N,a.throw)throw N;x&&x();return}}),n.exports=a.encrypt})(e,"./encrypt"),e(function(n){var a=e("./root"),o=e("./shim"),c=e("./settings"),u=e("./aeskey");a.decrypt=a.decrypt||(async(v,_,x,E)=>{try{E=E||{};var M=(_||E).epriv||_;if(!M){if(!a.I)throw"No decryption key.";_=await a.I(null,{what:v,how:"decrypt",why:E.why}),M=_.epriv||_}var C=await c.parse(v),I,D,L;try{I=o.Buffer.from(C.s,E.encode||"base64"),D=o.Buffer.from(C.iv,E.encode||"base64"),L=o.Buffer.from(C.ct,E.encode||"base64");var N=await u(M,I,E).then(F=>o.subtle.decrypt({name:E.name||"AES-GCM",iv:new Uint8Array(D),tagLength:128},F,new Uint8Array(L)))}catch{if(E.encode==="utf8")throw"Could not decrypt";if(a.opt.fallback)return E.encode="utf8",await a.decrypt(v,_,x,E)}var q=await c.parse(new o.TextDecoder("utf8").decode(N));if(x)try{x(q)}catch(F){console.log(F)}return q}catch(F){if(console.log(F),a.err=F,a.throw)throw F;x&&x();return}}),n.exports=a.decrypt})(e,"./decrypt"),e(function(n){var a=e("./root"),o=e("./shim");e("./settings"),a.secret=a.secret||(async(u,v,_,x)=>{try{if(x=x||{},!v||!v.epriv||!v.epub){if(!a.I)throw"No secret mix.";v=await a.I(null,{what:u,how:"secret",why:x.why})}var E=u.epub||u,M=v.epub,C=v.epriv,I=o.ossl||o.subtle,D=c(E),L=Object.assign({public:await I.importKey(...D,!0,[])},{name:"ECDH",namedCurve:"P-256"}),N=c(M,C),q=await I.importKey(...N,!1,["deriveBits"]).then(async U=>{var j=await I.deriveBits(L,U,256),W=new Uint8Array(j),X=await I.importKey("raw",W,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return I.exportKey("jwk",X).then(({k:J})=>J)}),F=q;if(_)try{_(F)}catch(U){console.log(U)}return F}catch(U){if(console.log(U),a.err=U,a.throw)throw U;_&&_();return}});var c=(u,v)=>{var[_,x]=u.split("."),E=v?{d:v}:{};return["jwk",Object.assign(E,{x:_,y:x,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};n.exports=a.secret})(e,"./secret"),e(function(n){var a=e("./root");a.certify=a.certify||(async(o,c={},u,v,_={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),o=(()=>{var F=[];if(o){if((typeof o=="string"||Array.isArray(o))&&o.indexOf("*")>-1)return"*";if(typeof o=="string")return o;if(Array.isArray(o)){if(o.length===1&&o[0])return typeof o[0]=="object"&&o[0].pub?o[0].pub:typeof o[0]=="string"?o[0]:null;o.map(U=>{typeof U=="string"?F.push(U):typeof U=="object"&&U.pub&&F.push(U.pub)})}return typeof o=="object"&&o.pub?o.pub:F.length>0?F:null}})(),!o)return console.log("No certificant found.");const E=_.expiry&&(typeof _.expiry=="number"||typeof _.expiry=="string")?parseFloat(_.expiry):null,M=(c||{}).read?c.read:null,C=(c||{}).write?c.write:typeof c=="string"||Array.isArray(c)||c["+"]||c["#"]||c["."]||c["="]||c["*"]||c[">"]||c["<"]?c:null,I=(_||{}).block||(_||{}).blacklist||(_||{}).ban||{},D=I.read&&(typeof I.read=="string"||(I.read||{})["#"])?I.read:null,L=typeof I=="string"?I:I.write&&(typeof I.write=="string"||I.write["#"])?I.write:null;if(!M&&!C)return console.log("No policy found.");const N=JSON.stringify({c:o,...E?{e:E}:{},...M?{r:M}:{},...C?{w:C}:{},...D?{rb:D}:{},...L?{wb:L}:{}});var x=await a.sign(N,u,null,{raw:1});if(_.raw||(x="SEA"+JSON.stringify(x)),v)try{v(x)}catch(F){console.log(F)}return x}catch(E){if(a.err=E,a.throw)throw E;v&&v();return}}),n.exports=a.certify})(e,"./certify"),e(function(n){var a=e("./shim"),o=e("./root");o.work=e("./work"),o.sign=e("./sign"),o.verify=e("./verify"),o.encrypt=e("./encrypt"),o.decrypt=e("./decrypt"),o.certify=e("./certify"),o.random=o.random||a.random,o.Buffer=o.Buffer||e("./buffer"),o.keyid=o.keyid||(async c=>{try{const u=a.Buffer.concat(c.replace(/-/g,"+").replace(/_/g,"/").split(".").map(E=>a.Buffer.from(E,"base64"))),v=a.Buffer.concat([a.Buffer.from([153,u.length/256,u.length%256]),u]),_=await sha1hash(v),x=a.Buffer.from(_,"binary");return x.toString("hex",x.length-8)}catch(u){throw console.log(u),u}}),((o.window||{}).GUN||{}).SEA=o,n.exports=o})(e,"./sea"),e(function(n){var a=e("./sea"),o,c;a.window?o=a.window.GUN||{chain:{}}:o=e((c+""==typeof t?".":"")+"./gun",1),a.GUN=o;function u(_){this._={$:this}}u.prototype=function(){function _(){}return _.prototype=o.chain,new _}(),u.prototype.constructor=u,o.chain.user=function(_){var x=this,M=x.back(-1),E;if(_)return _=a.opt.pub((_._||"")["#"])||_,M.get("~"+_);if(E=M.back("user"))return E;var M=M._,C=M,I=C.opt.uuid||v;return(C=(E=C.user=x.chain(new u))._).opt={},C.opt.uuid=function(D){var L=I(),N=M.user;return!N||!(N=N.is)||!(N=N.pub)||(L="~"+N+"/"+L,D&&D.call&&D(null,L)),L},E};function v(){return o.state().toString(36).replace(".","")}o.User=u,u.GUN=o,u.SEA=o.SEA=a,n.exports=u})(e,"./user"),e(function(n){var a,o=""+a!=typeof GUN?GUN||{chain:{}}:e((""+a==typeof t?".":"")+"./gun",1);o.chain.then=function(c,u){var v=this,_=new Promise(function(x,E){v.once(x,u)});return c?_.then(c):_}})(e,"./then"),e(function(n){var a=e("./user"),o=a.SEA,c=a.GUN,u=function(){};a.prototype.create=function(...v){var _=typeof v[0]=="object"&&(v[0].pub||v[0].epub)?v[0]:typeof v[1]=="object"&&(v[1].pub||v[1].epub)?v[1]:null,x=_&&(_.pub||_.epub)?_.pub:typeof v[0]=="string"?v[0]:null,E=_&&(_.pub||_.epub)?_:x&&typeof v[1]=="string"?v[1]:null,M=v.filter(F=>typeof F=="function")[0]||null,C=v&&v.length>1&&typeof v[v.length-1]=="object"?v[v.length-1]:{},I=this,D=I._,L=I.back(-1);if(M=M||u,C=C||{},C.check!==!1){var N;if(x||(N="No user."),(E||"").length<8&&(N="Password too short!"),N)return M({err:c.log(N)}),I}if(D.ing)return(M||u)({err:c.log("User is already being created or authenticated!"),wait:!0}),I;D.ing=!0;var q={};return q.a=function(F){if(q.pubs=F,F&&!C.already){var U={err:c.log("User already created!")};D.ing=!1,(M||u)(U),I.leave();return}q.salt=String.random(64),o.work(E,q.salt,q.b)},q.b=function(F){q.proof=F,_?q.c(_):o.pair(q.c)},q.c=function(F){var U;q.pair=F||{},(U=D.root.user)&&(U._.sea=F,U.is={pub:F.pub,epub:F.epub,alias:x}),q.data={pub:F.pub},q.d()},q.d=function(){q.data.alias=x,q.e()},q.e=function(){q.data.epub=q.pair.epub,o.encrypt({priv:q.pair.priv,epriv:q.pair.epriv},q.proof,q.f,{raw:1})},q.f=function(F){q.data.auth=JSON.stringify({ek:F,s:q.salt}),q.g(q.data.auth)},q.g=function(F){var U;q.data.auth=q.data.auth||F,L.get(U="~"+q.pair.pub).put(q.data).on(q.h);var j={};j[U]={"#":U},L.get("~@"+x).put(j).get(U).on(q.i)},q.h=function(F,U,j,W){W.off(),q.h.ok=1,q.i()},q.i=function(F,U,j,W){W&&(q.i.ok=1,W.off()),!(!q.h.ok||!q.i.ok)&&(D.ing=!1,M({ok:0,pub:q.pair.pub}),u===M&&(_?I.auth(_):I.auth(x,E)))},L.get("~@"+x).once(q.a),I},a.prototype.leave=function(v,_){var x=this,E=x.back(-1)._.user;if(E&&(delete E.is,delete E._.is,delete E._.sea),o.window)try{var M={};M=o.window.sessionStorage,delete M.recall,delete M.pair}catch{}return x}})(e,"./create"),e(function(n){var a=e("./user"),o=a.SEA,c=a.GUN,u=function(){};a.prototype.auth=function(..._){var x=typeof _[0]=="object"&&(_[0].pub||_[0].epub)?_[0]:typeof _[1]=="object"&&(_[1].pub||_[1].epub)?_[1]:null,E=!x&&typeof _[0]=="string"?_[0]:null,M=(E||x&&!(x.priv&&x.epriv))&&typeof _[1]=="string"?_[1]:null,C=_.filter(j=>typeof j=="function")[0]||null,I=_&&_.length>1&&typeof _[_.length-1]=="object"?_[_.length-1]:{},D=this,L=D._,N=D.back(-1);if(L.ing)return(C||u)({err:c.log("User is already being created or authenticated!"),wait:!0}),D;L.ing=!0;var q={},F,U=9;return q.a=function(j){if(!j)return q.b();if(!j.pub){var W=[];return Object.keys(j).forEach(function(X){X!="_"&&W.push(j[X])}),q.b(W)}if(q.name)return q.f(j);q.c((q.data=j).auth)},q.b=function(j){var W=(q.list=(q.list||[]).concat(j||[])).shift();if(F===W){if(q.name)return q.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(E&&U--){N.get("~@"+E).once(q.a);return}return q.err("Wrong user or password.")}N.get(W).once(q.a)},q.c=function(j){if(F===j)return q.b();if(typeof j=="string")return q.c(v(j));o.work(M,(q.auth=j).s,q.d,q.enc)},q.d=function(j){o.decrypt(q.auth.ek,j,q.e,q.enc)},q.e=function(j){if(F===j)return q.enc?(q.enc=null,q.b()):(q.enc={encode:"utf8"},q.c(q.auth));q.half=j,q.f(q.data)},q.f=function(j){var W=q.half||{},X=q.data||{};q.g(q.lol={pub:j.pub||X.pub,epub:j.epub||X.epub,priv:j.priv||W.priv,epriv:j.epriv||W.epriv})},q.g=function(j){if(!j||!j.pub||!j.epub)return q.b();q.pair=j;var W=N._.user,X=W._;X.tag;var J=X.opt;X=W._=N.get("~"+j.pub)._,X.opt=J,W.is={pub:j.pub,epub:j.epub,alias:E||j.pub},X.sea=q.pair,L.ing=!1;try{M&&F==(v(L.root.graph["~"+j.pub].auth)||"")[":"]&&(I.shuffle=I.change=M)}catch{}if(I.change?q.z():(C||u)(X),o.window&&(D.back("user")._.opt||I).remember)try{var G={};G=o.window.sessionStorage,G.recall=!0,G.pair=JSON.stringify(j)}catch{}try{N._.tag.auth?N._.on("auth",X):setTimeout(function(){N._.on("auth",X)},1)}catch(oe){c.log("Your 'auth' callback crashed with:",oe)}},q.h=function(j){if(!j)return q.b();if(E=j.alias,E||(E=j.alias="~"+x.pub),!j.auth)return q.g(x);x=null,q.c((q.data=j).auth)},q.z=function(){q.salt=String.random(64),o.work(I.change,q.salt,q.y)},q.y=function(j){o.encrypt({priv:q.pair.priv,epriv:q.pair.epriv},j,q.x,{raw:1})},q.x=function(j){q.w(JSON.stringify({ek:j,s:q.salt}))},q.w=function(j){if(I.shuffle){console.log("migrate core account from UTF8 & shuffle");var W={};Object.keys(q.data).forEach(function(X){W[X]=q.data[X]}),delete W._,W.auth=j,N.get("~"+q.pair.pub).put(W)}N.get("~"+q.pair.pub).get("auth").put(j,C||u)},q.err=function(j){var W={err:c.log(j||"User cannot be found!")};L.ing=!1,(C||u)(W)},q.plugin=function(j){if(!(q.name=j))return q.err();var W=[j];j[0]!=="~"&&(W[1]="~"+j,W[2]="~@"+j),q.b(W)},x?x.priv&&x.epriv?q.g(x):N.get("~"+x.pub).once(q.h):E?N.get("~@"+E).once(q.a):!E&&!M&&o.name(q.plugin),D};function v(_){if(typeof _!="string")return _;try{_=JSON.parse(_)}catch{_={}}return _}})(e,"./auth"),e(function(n){var a=e("./user"),o=a.SEA;a.GUN,a.prototype.recall=function(c,u){var v=this,_=v.back(-1);if(c=c||{},c&&c.sessionStorage){if(o.window)try{var x={};x=o.window.sessionStorage,x&&(_._.opt.remember=!0,(v.back("user")._.opt||c).remember=!0,(x.recall||x.pair)&&_.user().auth(JSON.parse(x.pair),u))}catch{}return v}return v}})(e,"./recall"),e(function(n){var a=e("./user"),o=a.SEA,c=a.GUN,u=function(){};a.prototype.pair=function(){var v=this,_;try{_=new Proxy({DANGER:""},{get:function(x,E,M){if(!(!v.is||!(v._||"").sea))return v._.sea[E]}})}catch{}return _},a.prototype.delete=async function(v,_,x){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var E=this;E.back(-1);var M=E.back("user");try{M.auth(v,_,function(C){var I=(M.is||{}).pub;M.map().once(function(){this.put(null)}),M.leave(),(x||u)({ok:0})})}catch(C){c.log("User.delete failed! Error:",C)}return E},a.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const v=this.back(-1);try{return await authRecall(v),v._.user._}catch{const x="No session!";throw c.log(x),{err:x}}},a.prototype.trust=async function(v){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),c.is(v)&&v.get("pub").get((_,x)=>{console.log(_,x)}),v.get("trust").get(path).put(theirPubkey)},a.prototype.grant=function(v,_){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var x=this,E=x.back(-1).user(),M=E._.sea,C="";return x.back(function(I){I.is||(C+=I.get||"")}),async function(){var I,D=await E.get("grant").get(M.pub).get(C).then();D=await o.decrypt(D,M),D||(D=o.random(16).toString(),I=await o.encrypt(D,M),E.get("grant").get(M.pub).get(C).put(I));var L=v.get("pub").then(),N=v.get("epub").then();L=await L,N=await N;var q=await o.secret(N,M);I=await o.encrypt(D,q),E.get("grant").get(L).get(C).put(I,_)}(),x},a.prototype.secret=function(v,_){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var x=this,E=x.back(-1).user(),M=E.pair(),C="";return x.back(function(I){I.is||(C+=I.get||"")}),async function(){var I,D=await E.get("trust").get(M.pub).get(C).then();D=await o.decrypt(D,M),D||(D=o.random(16).toString(),I=await o.encrypt(D,M),E.get("trust").get(M.pub).get(C).put(I)),I=await o.encrypt(v,D),x.put(I,_)}(),x},n.exports=a})(e,"./share"),e(function(n){var a=e("./sea"),o=e("./settings"),c,u=(a.window||"").GUN||e((""+c==typeof t?".":"")+"./gun",1);u.on("opt",function(I){I.sea||(I.sea={own:{}},I.on("put",v,I)),this.to.next(I)});function v(I){var D=this,L=D.as,N=I.put,q=N["#"],F=N["."],U=N[":"],j=N[">"],W=I["#"],X;if(!(!q||!F)){if((I._||"").faith&&(L.opt||"").faith&&typeof I._=="function"){a.opt.pack(N,function(G){a.verify(G,!1,function(oe){N["="]=a.opt.unpack(oe),D.to.next(I)})});return}var J=function(G){L.on("in",{"@":W,err:I.err=G})};if((I._||"").DBG&&((I._||"").DBG.c=+new Date),0<=q.indexOf("<?")&&(X=parseFloat(q.split("<?")[1]||""),X&&j<u.state()-X*1e3)){(X=I._)&&X.stun&&X.stun--;return}if(q==="~@"){v.alias(D,I,U,F,q,L,J);return}if(q.slice(0,2)==="~@"){v.pubs(D,I,U,F,q,L,J);return}if(X=a.opt.pub(q)){v.pub(D,I,U,F,q,L,J,L.user||"",X);return}if(0<=q.indexOf("#")){v.hash(D,I,U,F,q,L,J);return}v.any(D,I,U,F,q,L,J,L.user||"")}}v.hash=function(I,D,L,N,q,F,U){a.work(L,null,function(j){function W(X){let J="";for(let G=0;G<X.length;G++)J+=G-1&1?"":String.fromCharCode(parseInt(X.substring(G-1,G+1),16));return btoa(J)}if(j&&j===N.split("#").slice(-1)[0])return I.to.next(D);if(j&&j===W(N.split("#").slice(-1)[0]))return I.to.next(D);U("Data hash not same as hash!")},{name:"SHA-256"})},v.alias=function(I,D,L,N,q,F,U){if(!L)return U("Data must exist!");if("~@"+N===x(L))return I.to.next(D);U("Alias not same!")},v.pubs=function(I,D,L,N,q,F,U){if(!L)return U("Alias must exist!");if(N===x(L))return I.to.next(D);U("Alias not same!")},v.pub=async function(I,D,L,N,q,F,U,j,W){var X;const J=await o.parse(L)||{},G=(oe,O,l)=>{if(oe.m&&oe.s&&O&&W)return a.verify(oe,W,p=>{if(c!==p&&c!==p.e&&D.put[">"]&&D.put[">"]>parseFloat(p.e))return U("Certificate expired.");if(c!==p&&p.c&&p.w&&(p.c===O||p.c.indexOf("*")>-1)){let S=q.indexOf("/")>-1?q.replace(q.substring(0,q.indexOf("/")+1),""):"";String.match=String.match||u.text.match;const T=Array.isArray(p.w)?p.w:typeof p.w=="object"||typeof p.w=="string"?[p.w]:[];for(const B of T)if(String.match(S,B["#"])&&String.match(N,B["."])||!B["."]&&String.match(S,B["#"])||!B["#"]&&String.match(N,B["."])||String.match(S?S+"/"+N:N,B["#"]||B)){if(B["+"]&&B["+"].indexOf("*")>-1&&S&&S.indexOf(O)==-1&&N.indexOf(O)==-1)return U(`Path "${S}" or key "${N}" must contain string "${O}".`);if(p.wb&&(typeof p.wb=="string"||(p.wb||{})["#"])){var b=I.as.root.$.back(-1);return typeof p.wb=="string"&&p.wb.slice(0,1)!=="~"&&(b=b.get("~"+W)),b.get(p.wb).get(O).once($=>$&&($===1||$===!0)?U(`Certificant ${O} blocked.`):l(p))}return l(p)}return U("Certificate verification fail.")}})};if(N==="pub"&&"~"+W===q)return L===W?I.to.next(D):U("Account not same!");if((X=j.is)&&X.pub&&!J["*"]&&!J["+"]&&(W===X.pub||W!==X.pub&&((D._.msg||{}).opt||{}).cert)){a.opt.pack(D.put,oe=>{a.sign(oe,j._.sea,async function(O){if(c===O)return U(a.err||"Signature fail.");if(D.put[":"]={":":X=a.opt.unpack(O.m),"~":O.s},D.put["="]=X,W===j.is.pub){(X=x(L))&&((F.sea.own[X]=F.sea.own[X]||{})[W]=1),JSON.stringifyAsync(D.put[":"],function(l,p){return l?U(l||"Stringify error."):(D.put[":"]=p,I.to.next(D))});return}if(W!==j.is.pub&&((D._.msg||{}).opt||{}).cert){const l=await o.parse(D._.msg.opt.cert);l&&l.m&&l.s&&G(l,j.is.pub,p=>{D.put[":"]["+"]=l,D.put[":"]["*"]=j.is.pub,JSON.stringifyAsync(D.put[":"],function(b,S){return b?U(b||"Stringify error."):(D.put[":"]=S,I.to.next(D))})})}},{raw:1})});return}a.opt.pack(D.put,oe=>{a.verify(oe,J["*"]||W,function(O){var l;if(O=a.opt.unpack(O),c===O)return U("Unverified data.");if((l=x(O))&&W===a.opt.pub(l)&&((F.sea.own[l]=F.sea.own[l]||{})[W]=1),J["+"]&&J["+"].m&&J["+"].s&&J["*"])G(J["+"],J["*"],p=>(D.put["="]=O,I.to.next(D)));else return D.put["="]=O,I.to.next(D)})})},v.any=function(I,D,L,N,q,F,U,j){if(F.opt.secure)return U("Soul missing public key at '"+N+"'.");F.on("secure",function(W){if(this.off(),!F.opt.secure)return I.to.next(W);U("Data cannot be changed.")}).on.on("secure",D)};var _=u.valid,x=function(I,D){return typeof(D=_(I))=="string"&&D};(u.state||"").ify;var E=/[^\w_-]/;a.opt.pub=function(I){if(I&&(I=I.split("~"),!(!I||!(I=I[1]))&&(I=I.split(E).slice(0,2),!(!I||I.length!=2)&&(I[0]||"")[0]!=="@")))return I=I.slice(0,2).join("."),I},a.opt.stringy=function(I){},a.opt.pack=function(I,D,L,N,q){var F,U;if(a.opt.check(I))return D(I);I&&I["#"]&&I["."]&&I[">"]&&(F=I[":"],U=1),JSON.parseAsync(U?F:I,function(j,W){var X=c!==(W||"")[":"]&&(W||"")["~"];if(!X){D(I);return}D({m:{"#":q||I["#"],".":L||I["."],":":(W||"")[":"],">":I[">"]||u.state.is(N,L)},s:X})})};var M=a.opt;a.opt.unpack=function(I,D,L){var N;if(c!==I){if(I&&c!==(N=I[":"]))return N;if(D=D||M.fall_key,!L&&M.fall_val&&(L={},L[D]=M.fall_val),!(!D||!L)){if(I===L[D]||!a.opt.check(L[D]))return I;var q=L&&L._&&L._["#"]||M.fall_soul,F=u.state.is(L,D)||M.fall_state;if(I&&I.length===4&&q===I[0]&&D===I[1]&&C(F)===C(I[3]))return I[2];if(F<a.opt.shuffle_attack)return I}}},a.opt.shuffle_attack=15463296e5;var C=Math.floor})(e,"./index")})()})(sea);sea.exports;var radix={exports:{}},hasRequiredRadix;function requireRadix(){return hasRequiredRadix||(hasRequiredRadix=1,function(){function r(){var o=function(c,u,v){if(o.unit=0,!v&&n!==u&&(o.last=""+c<o.last?o.last:""+c,delete(o.$||{})[a]),v=v||o.$||(o.$={}),!c&&Object.keys(v).length)return v;c=""+c;for(var _=0,x=c.length-1,E=c[_],M,C;!(M=v[E])&&_<x;)E+=c[++_];if(M)if(_==x){if(n===u)return n===(C=M[""])?M:(o.unit=1)&&C;M[""]=u}else return n!==u&&delete M[a],o(c.slice(++_),u,M||(M={}));else{if(!e(v,function(I,D){var L=0,N="";if((D||"").length)for(;D[L]==c[L];)N+=D[L++];if(N){if(n===u)return L<=x?void 0:((C||(C={}))[D.slice(L)]=I,I);var q={};if(q[D.slice(L)]=I,L=c.slice(L),L===""?q[""]=u:(q[L]={})[""]=u,v[N]=q,r.debug&&""+N=="undefined"){console.log(0,N);debugger}return delete v[D],!0}})){if(n===u)return;if((v[E]||(v[E]={}))[""]=u,r.debug&&""+E=="undefined"){console.log(1,E);debugger}}if(n===u)return C}};return o}if(r.map=function o(c,u,v,_){try{_=_||[];var x=typeof c=="function"?c.$||{}:c;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!x)return;if(typeof x=="string"){if(r.debug)throw["BUG:",c,u,v,_];return}var E=(x[a]||t).sort||(x[a]=function J(){return J.sort=Object.keys(x).sort(),J}()).sort,M;v=v===!0?{branch:!0}:v||{},(M=v.reverse)&&(E=E.slice(0).reverse());for(var C=v.start,I=v.end,D="",L=0,N=E.length;L<N;L++){var q=E[L],F=x[q],U,j,W;if(!(!F||q===""||a===q||q==="undefined")&&(j=_.slice(0),j.push(q),W=j.join(""),!(n!==C&&W<(C||"").slice(0,W.length))&&!(n!==I&&(I||D)<W))){if(M&&(U=o(F,u,v,j),n!==U))return U;if(n!==(U=F[""])){var X=1;if(n!==C&&W<(C||"")&&(X=0),n!==I&&W>(I||D)&&(X=0),X&&(U=u(U,W,q,_),n!==U))return U}else if(v.branch&&(U=u(n,W,q,_),n!==U))return U;if(_=j,!M&&(U=o(F,u,v,_),n!==U))return U;_.pop()}}}catch(J){console.error(J)}},typeof window<"u")window.Radix=r;else try{radix.exports=r}catch{}var e=r.object=function(o,c,u){for(var v in o)if(o.hasOwnProperty(v)&&(u=c(o[v],v))!==n)return u},t={},n,a=""}()),radix.exports}requireRadix();var radisk={exports:{}},yson={exports:{}},hasRequiredYson;function requireYson(){return hasRequiredYson||(hasRequiredYson=1,function(r){(function(){var e={},t,n=setTimeout.turn||typeof setImmediate!=""+t&&setImmediate||setTimeout;e.parseAsync=function(o,c,u,v){if(typeof o!="string"){try{c(t,JSON.parse(o))}catch(E){c(E)}return}var _={i:0,text:o,done:c,l:o.length,up:[]};v=v||1024*32,x();function x(){for(var E=_.text,M=_.i,C=_.l,I=0,D=_.w,L,N;I++<v;){var q=E[M++];if(M>C){_.end=!0;break}if(D){for(M=E.indexOf('"',M-1),q=E[M],N=0;E[M-++N]=="\\";);N=!(N%2),L=L||N,q=='"'&&!N&&(D=t,N=_.s,_.a?(N=E.slice(_.sl,M),(L||1+N.indexOf("\\"))&&(N=JSON.parse('"'+N+'"')),_.at instanceof Array?_.at.push(_.s=N):(_.at||(_.end=I=v,N=t),(_.at||{})[_.s]=_.s=N),_.s=t):(_.s=E.slice(_.sl,M),(L||1+_.s.indexOf("\\"))&&(_.s=JSON.parse('"'+_.s+'"'))),_.a=L=t),++M}else switch(q){case'"':_.sl=M,D=!0;break;case":":_.ai=M,_.a=!0;break;case",":(_.a||_.at instanceof Array)&&(N=E.slice(_.ai,M-1))&&t!==(N=a(N))&&(_.at instanceof Array?_.at.push(N):_.at[_.s]=N),_.a=t,_.at instanceof Array&&(_.a=!0,_.ai=M);break;case"{":_.up.push(_.at||(_.at={})),_.at instanceof Array?_.at.push(_.at={}):t!==(N=_.s)&&(_.at[N]=_.at={}),_.a=t;break;case"}":_.a&&(N=E.slice(_.ai,M-1))&&t!==(N=a(N))&&(_.at instanceof Array?_.at.push(N):(_.at||(_.end=I=v,N=t),(_.at||{})[_.s]=N)),_.a=t,_.at=_.up.pop();break;case"[":t!==(N=_.s)?(_.up.push(_.at),_.at[N]=_.at=[]):_.at||_.up.push(_.at=[]),_.a=!0,_.ai=M;break;case"]":_.a&&(N=E.slice(_.ai,M-1))&&t!==(N=a(N))&&(_.at instanceof Array?_.at.push(N):_.at[_.s]=N),_.a=t,_.at=_.up.pop();break}}if(_.s=t,_.i=M,_.w=D,_.end){if(N=_.at,t===N)try{N=JSON.parse(o)}catch(F){return _.done(F)}_.done(t,N)}else n(x)}};function a(o){var c=parseFloat(o);if(!isNaN(c))return c;if(o=o.trim(),o=="true")return!0;if(o=="false")return!1;if(o=="null")return null}e.stringifyAsync=function(o,c,u,v,_){_=_||{},_.text=_.text||"",_.up=[_.at={d:o}],_.done=c,_.i=0;var x=0;E();function E(){var M=_.at,C=M.d,I="",D;switch(M.i&&M.i-M.j>0&&(I+=","),t!==(D=M.k)&&(I+=JSON.stringify(D)+":"),typeof C){case"boolean":I+=""+C;break;case"string":I+=JSON.stringify(C);break;case"number":I+=isNaN(C)?"null":C;break;case"object":if(!C){I+="null";break}if(C instanceof Array){I+="[",M={i:-1,as:C,up:M,j:0},M.l=C.length,_.up.push(_.at=M);break}if(typeof(C||"").toJSON!="function"){I+="{",M={i:-1,ok:Object.keys(C).sort(),as:C,up:M,j:0},M.l=M.ok.length,_.up.push(_.at=M);break}if(D=C.toJSON()){I+=D;break}case"function":if(M.as instanceof Array){I+="null";break}default:I="",M.j++}for(_.text+=I;1+M.i>=M.l;)_.text+=M.ok?"}":"]",M=_.at=M.up;if(++M.i<M.l){if((D=M.ok)?M.d=M.as[M.k=D[M.i]]:M.d=M.as[M.i],++x<9)return E();x=0,n(E);return}_.done(t,_.text)}},typeof window!=""+t&&(window.YSON=e);try{""+t!="object"&&(r.exports=e)}catch{}typeof JSON!=""+t&&(JSON.parseAsync=e.parseAsync,JSON.stringifyAsync=e.stringifyAsync)})()}(yson)),yson.exports}var radmigtmp,hasRequiredRadmigtmp;function requireRadmigtmp(){return hasRequiredRadmigtmp||(hasRequiredRadmigtmp=1,radmigtmp=function(r){var e=requireRadix();r.find("a",function(){var t=[];e.map(r.list,function(o,c){c.indexOf("%1B")+1&&o&&t.push([c,o])}),t.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var n,a;t.forEach(function(o){n=o[0],a=o[1],r.list(decodeURIComponent(n),a),r.list(n,0)}),n&&r.find.bad(n)})}),radmigtmp}(function(){function r(n){n=n||{},n.log=n.log||console.log,n.file=String(n.file||"radata");var a=(r.has||(r.has={}))[n.file];if(a)return a;n.max=n.max||(n.memory?n.memory*999*999:3e8)*.3,n.until=n.until||n.wait||250,n.batch=n.batch||10*1e3,n.chunk=n.chunk||1024*1024*1,n.code=n.code||{},n.code.from=n.code.from||"!",n.jsonify=!0;function o(L){return encodeURIComponent(L).replace(/\*/g,"%2A")}function c(L){return D!==L&&(!L||typeof L!="object")}var u=""+D==typeof setImmediate?setTimeout:setImmediate,v=setTimeout.turn||u,D,_=t.object,x=0;if(!n.store)return n.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!n.store.put)return n.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!n.store.get)return n.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");n.store.list,""+D!=typeof commonjsRequire&&requireYson();var E=JSON.parseAsync||function(L,N,q){var F;try{N(F,JSON.parse(L,q))}catch(U){N(U)}},M=function(L,N,q,F,U){if(typeof N=="function"){var j=q||{};q=N,M.read(L,q,j,U||F);return}M.save(L,N,q,F,U)};M.save=function(L,N,q,F,U){var j={key:L},W,X;j.find=function(J){var G;if(j.file=J||(J=n.code.from),U&&(U=U[J]=U[J]||{}),U&&(U.sf=U.sf||+new Date),G=M.disk[J]){j.mix(D,G);return}M.parse(J,j.mix,D,U)},j.mix=function(J,G){if(U&&(U.sml=+new Date),U&&(U.sm=U.sm||+new Date),j.err=J||j.err){q(J);return}var oe=j.file=(G||"").file||j.file,O;if(!G&&oe!==n.code.from){M.find.bad(oe),M.save(L,N,q,F);return}if((G=M.disk[oe]||(M.disk[oe]=G||t())).file||(G.file=oe),n.compare&&(N=n.compare(G(L),N,L,oe),D===N)){q(J,-1);return}if((j.disk=G)(L,N),F&&((O=(O=G.tags||(G.tags={}))[F]||(O[F]=M.tags[F]||(M.tags[F]={})))[oe]||(O[oe]=M.one[F]||(M.one[F]=q)),q=null),U&&(U.st=U.st||+new Date),G.Q){q&&G.Q.push(q);return}G.Q=q?[q]:[],G.to=setTimeout(j.write,n.until)},j.write=function(){U&&(U.sto=U.sto||+new Date);var J=W=j.file,G=j.disk;X=j.q=G.Q,j.tags=G.tags,delete G.Q,delete M.disk[J],delete G.tags,M.write(J,G,j.ack,D,U)},j.ack=function(J,G){U&&(U.sa=U.sa||+new Date),U&&(U.sal=X.length);var oe,O;for(var l in M.tags)if(M.tags.hasOwnProperty(l)){var p=M.tags[l];if(!((O=M.disk[W])&&(O=O.tags)&&O[p])){oe=p[W],delete p[W];var b;for(var S in p)if(p.hasOwnProperty(S)){b=!0;break}b||(delete M.tags[p],oe&&oe(J,G))}}!X&&(X="");for(var T=X.length,B=0,$=+new Date;B<T;B++)(oe=X[B])&&oe(J,G);console.STAT&&console.STAT($,+new Date-$,"rad acks",o(j.file)),console.STAT&&console.STAT($,X.length,"rad acks #",o(j.file))},q||(q=function(J,G){}),M.find(L,j.find)},M.disk={},M.one={},M.tags={};var C=0;M.write=function(L,N,q,F,U){if(!N){q("No radix!");return}F=typeof F=="object"?F:{force:F};var j=function(){},W,X;if(j.text="",j.file=L=N.file||(N.file=L),!L){q("What file?");return}if(j.write=function(){var J=N.raw=j.text;M.disk[L=N.file||j.file||L]=N;var G=+new Date;U&&(U.wd=G),M.find.add(L,function(O){if(U&&(U.wa=+new Date),O){q(O);return}n.store.put(o(L),J,function(p,b){U&&(U.wp=+new Date),console.STAT&&console.STAT(G,x=+new Date-G,"wrote disk",JSON.stringify(L),++C,"total all writes."),q(p,b||1),N.Q||delete M.disk[L]})})},j.split=function(){var J=+new Date;U&&(U.wf=J),j.text="",j.count||(j.count=0,t.map(N,function(){j.count++})),U&&(U.wfc=j.count),j.limit=Math.ceil(j.count/2);var G=j.count;return j.count=0,U&&(U.wf1=+new Date),j.sub=t(),t.map(N,j.slice,{reverse:1}),U&&(U.wf2=+new Date),M.write(j.end,j.sub,j.both,F),U&&(U.wf3=+new Date),j.hub=t(),t.map(N,j.stop),U&&(U.wf4=+new Date),M.write(N.file,j.hub,j.both,F),U&&(U.wf5=+new Date),console.STAT&&console.STAT(J,+new Date-J,"rad split",o(N.file),G),!0},j.slice=function(J,G){if(j.sub(j.end=G,J),j.limit<=++j.count)return!0},j.stop=function(J,G){if(G>=j.end)return!0;j.hub(G,J)},j.both=function(J,G){if(U&&(U.wfd=+new Date),X){q(J||X);return}if(W){q(J,G);return}W=!0,X=J},j.each=function(J,G,oe,O){if(D!==J&&j.count++,n.max<=(J||"").length)return q("Data too big!"),!0;var l=r.encode(O.length)+"#"+r.encode(oe)+(D===J?"":":"+r.encode(J))+`
`;if(n.chunk<j.text.length+l.length&&1<j.count&&!F.force)return j.split();j.text+=l},n.jsonify){M.write.jsonify(j,N,q,F,U);return}t.map(N,j.each,!0)||j.write()},M.write.jsonify=function(L,N,q,F,U){var j,W=+new Date;U&&(U.w=W);try{j=JSON.stringify(N.$)}catch{q("Cannot radisk!");return}if(U&&(U.ws=+new Date),console.STAT&&console.STAT(W,+new Date-W,"rad stringified JSON"),n.chunk<j.length&&!F.force){var X=0;if(t.map(N,function(){if(X++)return!0}),X>1)return L.split()}L.text=j,L.write()},M.range=function(L,N){if(!(!L||!N)){if(D===N.start&&D===N.end||c(L))return L;var q=t();return t.map(L,function(F,U){q(U,F)},N),q("")}},function(){M.read=function(L,N,q,F){q=q||{};var U={key:L};U.find=function(j){var W;if(U.file=j||(j=n.code.from),F&&(F=F[j]=F[j]||{}),F&&(F.rf=F.rf||+new Date),W=M.disk[U.file=j]){U.check(D,W);return}M.parse(j,U.check,D,F)},U.get=function(j,W,X){if(F&&(F.rgl=+new Date),F&&(F.rg=F.rg||+new Date),U.err=j||U.err){N(j);return}var J=U.file=(W||"").file||U.file;if(!W&&J!==n.code.from){M.find.bad(J),M.read(L,N,q);return}if(W=M.disk[J]||(M.disk[J]=W),!W){N(J===n.code.from?D:"No file!");return}W.file||(W.file=J);var G=M.range(W(L),q);if(F&&(F.rr=+new Date),q.unit=W.unit,q.chunks=(q.chunks||0)+1,q.parsed=(q.parsed||0)+((X||"").parsed||q.chunks*n.chunk),q.more=1,q.next=D,t.map(M.list,function(p,b){if(!(!p||J===b))return q.next=b,1},q.reverse?{reverse:1,end:J}:{start:J}),F&&(F.rl=+new Date),q.next||(q.more=0),q.next&&(!q.reverse&&(L<q.next&&q.next.indexOf(L)!=0||D!==q.end&&(q.end||"")<q.next)&&(q.more=0),q.reverse&&(L>q.next&&L.indexOf(q.next)!=0||D!==q.start&&(q.start||"")>q.next&&J<=q.start)&&(q.more=0)),!q.more){N(U.err,G,q);return}if(G&&N(U.err,G,q),!(q.parsed>=q.limit)){var oe=+new Date;F&&(F.rm=oe);var O=q.next;u(function(){console.STAT&&console.STAT(oe,+new Date-oe,"rad more"),M.parse(O,U.check)},0)}},U.check=function(j,W,X){if(U.get(j,W,X),!(!W||W.check)){W.check=1;var J=+new Date;(X||(X={})).file||(X.file=U.file),t.map(W,function(G,oe){M.find(oe,function(O){if((O||(O=n.code.from))!==X.file){var l=(""+Math.random()).slice(-3);v(function(){M.save(oe,G,function p(b,S){if(b){M.save(oe,G,p);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",l,o(oe),o(X.file),o(O))})},0)}})}),console.STAT&&console.STAT(J,+new Date-J,"rad check")}},M.find(L||(q.reverse?q.end||"":q.start||""),U.find)}}(),function(){var L=0,N={},q="";M.parse=function(F,U,j,W){var X;if(!F)return U();if(X=N[F]){X.push(U);return}X=N[F]=[U];var J=function(){},G={file:F};(J.disk=t()).file=F,J.read=function(O,l){if(W&&(W.rpg=+new Date),console.STAT&&console.STAT(oe,+new Date-oe,"read disk",JSON.stringify(F),++L,"total all parses."),(J.err=O)||(J.not=!l)){delete N[F],J.map(X,J.ack);return}if(typeof l!="string"){try{n.max<=l.length?J.err="Chunk too big!":l=l.toString()}catch(p){J.err=p}if(J.err){delete N[F],J.map(X,J.ack);return}}if(G.parsed=l.length,W&&(W.rpl=G.parsed),W&&(W.rpa=X.length),oe=+new Date,!(n.jsonify||l[0]==="{")){J.radec(O,l);return}E(l,function(p,b){if(!p){delete N[F],J.disk.$=b,console.STAT&&(x=+new Date-oe)>9&&console.STAT(oe,x,"rad parsed JSON"),W&&(W.rpd=+new Date),J.map(X,J.ack);return}if(l[0]==="{"){delete N[F],J.err="JSON error!",J.map(X,J.ack);return}J.radec(p,l)})},J.map=function(){if(!(!X||!X.length)){for(var O=+new Date,l=J.err,p=J.not?D:J.disk,b=0,S;b<9&&(S=X[b++]);)S(l,p,G);console.STAT&&console.STAT(O,+new Date-O,"rad packs",o(F)),console.STAT&&console.STAT(O,b,"rad packs #",o(F)),(X=X.slice(b)).length&&v(J.map,0)}},J.ack=function(O){if(O){if(J.err||J.not){O(J.err,D,G);return}O(D,J.disk,G)}},J.radec=function(O,l){delete N[F],oe=+new Date;var p=J.split(l),b=[],S,T,B;if(!p||p[1]!==0){J.err="File '"+F+"' does not have root radix! ",J.map(X,J.ack);return}for(;p;)T=B=D,S=p[1],p=J.split(p[2])||"",p[0]=="#"&&(T=p[1],b=b.slice(0,S),S<=b.length&&b.push(T)),p=J.split(p[2])||"",p[0]!=`
`&&((p[0]=="="||p[0]==":")&&(B=p[1]),D!==T&&D!==B&&J.disk(b.join(""),B),p=J.split(p[2]));console.STAT&&console.STAT(oe,+new Date-oe,"parsed RAD"),J.map(X,J.ack)},J.split=function(O){if(O){var l=[],p={},b=-1,S="";if(b=O.indexOf(q),!!O[b])return S=O.slice(0,b),l[0]=S,l[1]=r.decode(O.slice(b),p),l[2]=O.slice(b+p.i),l}},M.disk&&(j||(j=(M.disk[F]||"").raw));var oe=+new Date;if(W&&(W.rp=oe),j)return v(function(){J.read(D,j)},0);n.store.get(o(F),J.read)}}(),function(){var L,N="",q;M.find=function(j,W){if(!L){if(q){q.push([j,W]);return}q=[[j,W]],M.parse(N,F);return}t.map(M.list=L,function(X,J){if(X)return W(J)||!0},{reverse:1,end:j})||W(n.code.from)},M.find.add=function(j,W){var X=L(j);if(X||j===N){W(D,1);return}L(j,1),W.found=(W.found||0)+1,M.write(N,L,function(J,G){if(J){W(J);return}W.found=(W.found||0)-1,W.found===0&&W(D,1)},!0)},M.find.bad=function(j,W){L(j,0),M.write(N,L,W||I)};function F(j,W){if(j){n.log("list",j),setTimeout(function(){M.parse(N,F)},1e3);return}if(W){U(W);return}if(L=L||W||t(),!n.store.list){U(L);return}n.store.list(function(X){if(!X){U(L);return}M.find.add(X,I)})}function U(j,W){L=L||j,L.file=N,W=q,q=null,_(W,function(X){M.find(X[0],X[1])})}}();try{!e.window&&requireRadmigtmp()(M)}catch{}var I=function(){},D;return r.has[n.file]=M,M}if(function(){var n="";r.encode=function(a,o,c){c=c||n;var u=c,v;if(typeof a=="string"){for(var _=a.indexOf(c);_!=-1;)u+=c,_=a.indexOf(c,_+1);return u+'"'+a+c}else{if(a&&a["#"]&&Object.keys(a).length==1)return u+"#"+v+u;if(typeof a=="number")return u+"+"+(a||0)+u;if(a===null)return u+" "+u;if(a===!0)return u+"+"+u;if(a===!1)return u+"-"+u}},r.decode=function(a,o,c){c=c||n;var u="",v=-1,_=0,x,E;if(c===a[0]){for(;c===a[++v];)++_;for(E=a[x=_]||!0;--_>=0;)v=a.indexOf(c,v+1);if(v==-1&&(v=a.length),u=a.slice(x+1,v),o&&(o.i=v+1),E==='"')return u;if(E==="#")return{"#":u};if(E==="+")return u.length===0?!0:parseFloat(u);if(E===" ")return null;if(E==="-")return!1}}}(),typeof window<"u"){var e=window.Gun,t=window.Radix;window.Radisk=r}else{var e=gunExports,t=requireRadix();try{radisk.exports=r}catch{}}r.Radix=t})();var radiskExports=radisk.exports,define_process_env_default={},Gun$1=typeof window<"u"?window.Gun:gunExports;Gun$1.on("create",function(r){Gun$1.TESTING&&(r.opt.file="radatatest"),this.to.next(r);var e=r.opt,t;if(!(e.rad===!1||e.radisk===!1)&&!(t+""!=typeof dist.process&&""+(define_process_env_default||"").RAD=="false")){var n=Gun$1.window&&Gun$1.window.Radisk||radiskExports,a=n.Radix,o=n(e),c="\x1B",u=0;r.on("put",function(_){if(this.to.next(_),!(_._||"").rad){var x=_["#"],E=_.put,M=E["#"],C=E["."],I=E[":"],D=E[">"],L=(_._||"").DBG;L&&(L.sp=L.sp||+new Date);var N=(_._||"").RPS||((_._||"").RPS=+new Date);o(M+c+C,{":":I,">":D},function(q,F){if(L&&(L.spd=L.spd||+new Date),console.STAT&&console.STAT(N,+new Date-N,"put"),q){r.on("in",{"@":x,err:q,DBG:L});return}r.on("in",{"@":x,ok:F,DBG:L})},!1,L&&(L.r=L.r||{})),L&&(L.sps=L.sps||+new Date)}}),r.on("get",function(_){this.to.next(_);var x=_._||"",E=x.DBG=_.DBG;E&&(E.sg=+new Date);var M=_["#"],C=_.get,I=_.get["#"],D=_.get["."]||"",L={},N,q,F,U;if(typeof I=="string"?q=I:I&&(t!==(F=I["*"])&&(L.limit=U=1),t!==I[">"]&&(L.start=I[">"]),t!==I["<"]&&(L.end=I["<"]),q=U?""+F:F||I["="],U=null),q&&!L.limit&&(typeof D=="string"?q=q+c+(L.atom=D):D&&(t!==D[">"]&&(L.start=D[">"],L.limit=1),t!==D["<"]&&(L.end=D["<"],L.limit=1),t!==(F=D["*"])&&(L.limit=U=1),q&&(q=q+c+(U?""+(F||""):F||(L.atom=D["="]||""))))),((F=C["%"])||L.limit)&&(L.limit=F<=(L.pack||1e3*100)?F:1),(D["-"]||(I||{})["-"]||C["-"])&&(L.reverse=!0),(F=(r.next||"")[I])&&F.put){if(L.atom){if(F=(F.next||"")[L.atom],F&&F.root&&F.root.graph&&F.root.graph[I]&&F.root.graph[I][L.atom])return}else if(F&&F.rad)return}var j=Gun$1.state(),W=+new Date,X=0;E&&(E.sgm=W),o(q||"",function(G,oe,O){E&&(E.sgr=+new Date),E&&(E.sgi=O);try{e.store.stats.get.time[v%50]=+new Date-W,++v,e.store.stats.get.count++,G&&(e.store.stats.get.err=G)}catch{}console.STAT&&console.STAT(W,+new Date-W,"got",JSON.stringify(q)),W=+new Date,O=O||"";var l,p;if(O.unit&&oe&&t!==(l=oe[":"])&&t!==(p=oe[">"])){var b=q.split(c),S=b[0],T=b[1];(N=N||{})[S]=Gun$1.state.ify(N[S],T,p,l,S),r.$.get(S).get(T)._.rad=j}else oe&&(typeof oe!="string"&&(L.atom?oe=t:a.map(oe,J,L)),!N&&oe&&J(oe,""),!L.atom&&!D&typeof I=="string"&&!L.limit&&!L.more&&(r.$.get(I)._.rad=j));E&&(E.sgp=+new Date),console.STAT&&(u=+new Date-W)>9&&(console.STAT(W,u,"got prep time"),console.STAT(W,X,"got prep #")),X=0,W=+new Date;var B=function(){};B.faith=!0,B.rad=C,r.on("in",{"@":M,put:N,"%":O.more?1:t,err:G||t,_:B,DBG:E}),console.STAT&&(u=+new Date-W)>9&&console.STAT(W,u,"got emit",Object.keys(N||{}).length),N=t},L,E&&(E.r=E.r||{})),E&&(E.sgd=+new Date),console.STAT&&(u=+new Date-W)>9&&console.STAT(W,u,"get call");function J(G,oe,O,l){if(X++,!!G){oe=(q+oe).split(c);var p=oe.slice(0,1)[0];if(oe=oe.slice(-1)[0],L.limit&&L.limit<=L.count)return!0;var b,S,T=p,B=oe;if(typeof G!="string"){b=G[":"],S=G[">"],(N=N||{})[T]=Gun$1.state.ify(N[T],B,S,b,T),L.count=(L.count||0)+((b||"").length||9);return}L.count=(L.count||0)+G.length;var $=G.lastIndexOf(">"),A=n.decode(G.slice($+1),null,c);G=n.decode(G.slice(0,$),null,c),(N=N||{})[p]=Gun$1.state.ify(N[p],oe,A,G,p)}}}),Gun$1.valid,(e.store||{}).stats={get:{time:{},count:0},put:{time:{},count:0}};var v=0}});var rindexed={exports:{}};(function(){function r(t){t=t||{},t.file=String(t.file||"radata");var n=r[t.file],a=null,o;if(n)return console.log("Warning: reusing same IndexedDB store and options as 1st."),r[t.file];n=r[t.file]=function(){};try{t.indexedDB=t.indexedDB||r.indexedDB||indexedDB}catch{}try{if(!t.indexedDB||location.protocol=="file:"){var c=n.d||(n.d={});return n.put=function(u,v,_){c[u]=v,setTimeout(function(){_(null,1)},250)},n.get=function(u,v){setTimeout(function(){v(null,c[u]||o)},5)},console.log("Warning: No indexedDB exists to persist data to!"),n}}catch{}return n.start=function(){var u=indexedDB.open(t.file,1);u.onupgradeneeded=function(v){v.target.result.createObjectStore(t.file)},u.onsuccess=function(){a=u.result},u.onerror=function(v){console.log(v||1)}},n.start(),n.put=function(u,v,_){if(!a){setTimeout(function(){n.put(u,v,_)},1);return}var x=a.transaction([t.file],"readwrite"),E=x.objectStore(t.file),M=E.put(v,""+u);M.onsuccess=E.onsuccess=x.onsuccess=function(){_(null,1)},M.onabort=E.onabort=x.onabort=function(C){_(C||"put.tx.abort")},M.onerror=E.onerror=x.onerror=function(C){_(C||"put.tx.error")}},n.get=function(u,v){if(!a){setTimeout(function(){n.get(u,v)},9);return}var _=a.transaction([t.file],"readonly"),x=_.objectStore(t.file),E=x.get(""+u);E.onsuccess=function(){v(null,E.result)},E.onabort=function(M){v(M||4)},E.onerror=function(M){v(M||5)}},setInterval(function(){a&&a.close(),a=null,n.start()},1e3*15),n}if(typeof window<"u")(r.window=window).RindexedDB=r,r.indexedDB=window.indexedDB;else try{rindexed.exports=r}catch{}try{var e=r.window.Gun||gunExports;e.on("create",function(t){this.to.next(t),t.opt.store=t.opt.store||r(t.opt)})}catch{}})();const gun=Gun$2({peers:[],localStorage:!0}).on("opt",({url:r,err:e})=>{e?console.error(`Failed to connect to Gun peer at ${r}:`,e):console.log(`Successfully connected to Gun peer at ${r}`)});gun.user().recall({sessionStorage:!0});const STORAGE_KEY="ethnicityFormData",saveFormDataOffline=r=>{try{return localStorage.setItem(STORAGE_KEY,JSON.stringify(r)),!0}catch(e){return console.error("Error saving to localStorage:",e),!1}};function get_each_context(r,e,t){const n=r.slice();return n[32]=e[t],n}function get_each_context_1(r,e,t){const n=r.slice();return n[35]=e[t].key,n[36]=e[t].title,n[37]=e[t].options,n[38]=e[t].isArray,n}function create_each_block_1(r){let e,t;return e=new EthnicitySection({props:{title:r[36],options:r[37],key:r[35],phenotype:r[3],isArray:r[38],selectedValues:r[6][r[35]],otherChecked:r[4][r[35]],otherValue:r[5][r[35]]}}),e.$on("change",r[17]),e.$on("otherChange",r[18]),e.$on("otherValueChange",r[19]),{c(){create_component(e.$$.fragment)},m(n,a){mount_component(e,n,a),t=!0},p(n,a){const o={};a[0]&8&&(o.phenotype=n[3]),a[0]&64&&(o.selectedValues=n[6][n[35]]),a[0]&16&&(o.otherChecked=n[4][n[35]]),a[0]&32&&(o.otherValue=n[5][n[35]]),e.$set(o)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_1$1(r){let e,t,n;return{c(){e=element("div"),t=text(r[7]),attr(e,"class",n="mt-4 p-2 rounded text-center "+(r[7].includes("success")?"bg-green-100 text-green-800":"bg-red-100 text-red-800"))},m(a,o){insert(a,e,o),append(e,t)},p(a,o){o[0]&128&&set_data(t,a[7]),o[0]&128&&n!==(n="mt-4 p-2 rounded text-center "+(a[7].includes("success")?"bg-green-100 text-green-800":"bg-red-100 text-red-800"))&&attr(e,"class",n)},d(a){a&&detach(e)}}}function create_each_block(r){let e,t,n=r[32].timestamp+"",a,o,c=r[32].message+"",u,v,_;return{c(){e=element("div"),t=element("span"),a=text(n),o=space(),u=text(c),v=space(),attr(t,"class","text-xs text-gray-500"),attr(e,"class",_="text-sm "+(r[32].type==="error"?"text-red-600":r[32].type==="success"?"text-green-600":r[32].type==="warning"?"text-yellow-600":"text-gray-600"))},m(x,E){insert(x,e,E),append(e,t),append(t,a),append(e,o),append(e,u),append(e,v)},p(x,E){E[0]&256&&n!==(n=x[32].timestamp+"")&&set_data(a,n),E[0]&256&&c!==(c=x[32].message+"")&&set_data(u,c),E[0]&256&&_!==(_="text-sm "+(x[32].type==="error"?"text-red-600":x[32].type==="success"?"text-green-600":x[32].type==="warning"?"text-yellow-600":"text-gray-600"))&&attr(e,"class",_)},d(x){x&&detach(e)}}}function create_fragment$2(r){let e,t,n,a,o,c,u,v,_,x,E,M=r[1]?"Saving...":"Submit",C,I,D,L,N,q,F,U,j,W,X,J,G,oe,O;o=new ColorPicker({props:{phenotype:r[3]}}),o.$on("change",r[16]);let l=ensure_array_like(r[15]),p=[];for(let $=0;$<l.length;$+=1)p[$]=create_each_block_1(get_each_context_1(r,l,$));const b=$=>transition_out(p[$],1,1,()=>{p[$]=null});let S=r[7]&&create_if_block_1$1(r),T=ensure_array_like(r[8]),B=[];for(let $=0;$<T.length;$+=1)B[$]=create_each_block(get_each_context(r,T,$));return{c(){e=element("form"),t=element("div"),n=element("span"),n.textContent="Phenotype/Skin Color:",a=space(),create_component(o.$$.fragment),c=space(),u=element("div");for(let $=0;$<p.length;$+=1)p[$].c();v=space(),S&&S.c(),_=space(),x=element("div"),E=element("button"),C=text(M),D=space(),L=element("button"),N=text("Cancel"),F=space(),U=element("div"),j=element("h3"),j.textContent="Status Logs",W=space(),X=element("div");for(let $=0;$<B.length;$+=1)B[$].c();J=space(),attr(n,"class","block text-sm font-medium text-gray-700 mb-2"),attr(t,"class","mb-6"),attr(u,"class","space-y-4"),attr(E,"type","submit"),attr(E,"class","flex-1 p-3 rounded text-white transition-opacity hover:opacity-90 shadow disabled:opacity-50"),E.disabled=I=!r[2]||r[1],set_style(E,"background",r[3]),set_style(E,"text-shadow","1px 1px #000"),attr(L,"type","button"),attr(L,"class","flex-1 p-3 rounded text-gray-700 border border-gray-300 hover:bg-gray-50 transition-colors"),L.disabled=q=!r[2]||r[1],attr(x,"class","flex gap-4 mt-6"),attr(j,"class","text-sm font-medium text-gray-700 mb-2"),attr(X,"class","space-y-1 max-h-40 overflow-y-auto"),attr(U,"class","mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200"),attr(e,"class","space-y-6")},m($,A){insert($,e,A),append(e,t),append(t,n),append(t,a),mount_component(o,t,null),append(e,c),append(e,u);for(let g=0;g<p.length;g+=1)p[g]&&p[g].m(u,null);append(e,v),S&&S.m(e,null),append(e,_),append(e,x),append(x,E),append(E,C),append(x,D),append(x,L),append(L,N),append(e,F),append(e,U),append(U,j),append(U,W),append(U,X);for(let g=0;g<B.length;g+=1)B[g]&&B[g].m(X,null);append(e,J),G=!0,oe||(O=[listen(L,"click",function(){is_function(r[0])&&r[0].apply(this,arguments)}),listen(e,"submit",r[20])],oe=!0)},p($,A){r=$;const g={};if(A[0]&8&&(g.phenotype=r[3]),o.$set(g),A[0]&950392){l=ensure_array_like(r[15]);let k;for(k=0;k<l.length;k+=1){const H=get_each_context_1(r,l,k);p[k]?(p[k].p(H,A),transition_in(p[k],1)):(p[k]=create_each_block_1(H),p[k].c(),transition_in(p[k],1),p[k].m(u,null))}for(group_outros(),k=l.length;k<p.length;k+=1)b(k);check_outros()}if(r[7]?S?S.p(r,A):(S=create_if_block_1$1(r),S.c(),S.m(e,_)):S&&(S.d(1),S=null),(!G||A[0]&2)&&M!==(M=r[1]?"Saving...":"Submit")&&set_data(C,M),(!G||A[0]&6&&I!==(I=!r[2]||r[1]))&&(E.disabled=I),A[0]&8&&set_style(E,"background",r[3]),(!G||A[0]&6&&q!==(q=!r[2]||r[1]))&&(L.disabled=q),A[0]&256){T=ensure_array_like(r[8]);let k;for(k=0;k<T.length;k+=1){const H=get_each_context(r,T,k);B[k]?B[k].p(H,A):(B[k]=create_each_block(H),B[k].c(),B[k].m(X,null))}for(;k<B.length;k+=1)B[k].d(1);B.length=T.length}},i($){if(!G){transition_in(o.$$.fragment,$);for(let A=0;A<l.length;A+=1)transition_in(p[A]);G=!0}},o($){transition_out(o.$$.fragment,$),p=p.filter(Boolean);for(let A=0;A<p.length;A+=1)transition_out(p[A]);G=!1},d($){$&&detach(e),destroy_component(o),destroy_each(p,$),S&&S.d(),destroy_each(B,$),oe=!1,run_all(O)}}}function instance$2(r,e,t){let n,a,o,c,u,v,_,x,E,M,C;createEventDispatcher();let{onClose:I=()=>{}}=e;const D=localStorage.getItem("censusUserId");let L=D||crypto.randomUUID();D||localStorage.setItem("censusUserId",L);const N=Object.fromEntries(Object.keys(initialFormData).map(T=>[T,!1])),q=writable({...initialFormData});component_subscribe(r,q,T=>t(6,M=T));const F=writable({...initialOtherValues});component_subscribe(r,F,T=>t(5,E=T));const U=writable({...N});component_subscribe(r,U,T=>t(4,x=T));const j=writable("#888");component_subscribe(r,j,T=>t(3,_=T));let W="",X=[];const J=writable({userId:L,formData:n,otherValues:a,otherChecked:o,phenotype:c});component_subscribe(r,J,T=>t(9,C=T));function G(T,B="info"){const $=new Date().toLocaleTimeString();t(8,X=[...X,{message:T,type:B,timestamp:$}].slice(-8))}const oe=[...Object.entries(ETHNICITY_DATA).map(([T,B])=>({key:T,title:sectionTitles[T],options:B,isArray:!0})),{key:"delineation",title:sectionTitles.delineation,options:DELINEATION_OPTIONS.map(T=>({label:T.label||T,value:T.value||T})),isArray:!0}];function O(T){j.set(T.detail),G(` Selected phenotype: ${T.detail}`,"info")}function l(T){const{key:B,values:$}=T.detail;q.update(A=>({...A,[B]:$})),G(` Updated ${B} section`,"info")}function p(T){const{key:B,checked:$}=T.detail;U.update(A=>({...A,[B]:$})),$||F.update(A=>({...A,[B]:""})),G(`${$?"":""} ${B} other option ${$?"enabled":"disabled"}`,"info")}function b(T){const{key:B,value:$}=T.detail;F.update(A=>({...A,[B]:$})),G(` Updated custom value for ${B}`,"info")}async function S(T){try{if(T.preventDefault(),!u||v)return;t(1,v=!0),t(7,W="Saving...");let B={formData:M,otherValues:E,otherChecked:x,phenotype:_,timestamp:Date.now(),userId:L,version:"0.1.0-alpha"};const $=JSON.stringify(B);console.log("Stringified data before processing:",$);const A=await dataProcessing.processFormData(JSON.parse($).formData,JSON.parse($).otherValues,JSON.parse($).otherChecked,JSON.parse($).phenotype);console.log("processedDataResult in handleSubmit:",A),console.log("Saving processed data to GunDB:",A),await gunDB.put(`${L}-processed`,JSON.stringify(A)),await p2pNetwork.broadcastData(JSON.stringify(A)),saveFormDataOffline(JSON.stringify(A)),t(7,W="Data saved successfully!")}catch(B){console.error("Submission error:",B),t(7,W="Failed to save. Please try again."),G(" Critical save error","error")}finally{t(1,v=!1),setTimeout(()=>{t(7,W=""),I()},2e3)}}return onMount(async()=>{try{G(" Loading saved data...","info");let T=await gunDB.get(`${L}-processed`);if(console.log("savedData type:",typeof T),console.log("savedData raw:",T),T)try{const B=typeof T=="string"?JSON.parse(T):T;console.log("Parsed saved data:",B);let $;if(B.payload&&B.encryptionMetadata){const A=await encryption.decryptData({encrypted:B.payload,iv:B.encryptionMetadata.iv,key:B.encryptionMetadata.key});$=typeof A=="string"?JSON.parse(A):A,console.log("Decrypted and parsed data:",$)}else console.log("No encryption metadata found, using parsed data directly"),$=B;if($&&typeof $=="object"&&"formData"in $&&"otherValues"in $&&"otherChecked"in $&&"phenotype"in $)q.set($.formData||initialFormData),F.set($.otherValues||initialOtherValues),U.set($.otherChecked||N),j.set($.phenotype||"#888"),G(" Successfully loaded saved data","success");else throw console.warn("Invalid data structure:",$),G(" Invalid data structure","warning"),new Error("Invalid data structure")}catch(B){throw console.error("Parse/Decrypt error:",B),G(" Could not parse/decrypt saved data","warning"),B}else G(" No saved data found","info"),q.set(initialFormData),F.set(initialOtherValues),U.set(N),j.set("#888")}catch(T){console.error("Error loading data:",T),G(" Failed to load data","error"),q.set(initialFormData),F.set(initialOtherValues),U.set(N),j.set("#888")}finally{}}),onDestroy(async()=>{}),r.$$set=T=>{"onClose"in T&&t(0,I=T.onClose)},r.$$.update=()=>{r.$$.dirty[0]&64&&t(24,n=M),r.$$.dirty[0]&32&&t(23,a=E),r.$$.dirty[0]&16&&t(22,o=x),r.$$.dirty[0]&8&&t(21,c=_),r.$$.dirty[0]&8&&t(2,u=_!=="#888"),r.$$.dirty[0]&6,r.$$.dirty[0]&31457280&&J.set({userId:L,formData:n,otherValues:a,otherChecked:o,phenotype:c})},t(1,v=!1),[I,v,u,_,x,E,M,W,X,C,q,F,U,j,J,oe,O,l,p,b,S,c,o,a,n]}class EthnicityForm extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{onClose:0},null,[-1,-1])}}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function round(r){return r+.5|0}const lim=(r,e,t)=>Math.max(Math.min(r,t),e);function p2b(r){return lim(round(r*2.55),0,255)}function n2b(r){return lim(round(r*255),0,255)}function b2n(r){return lim(round(r/2.55)/100,0,1)}function n2p(r){return lim(round(r*100),0,100)}const map$1={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},hex=[..."0123456789ABCDEF"],h1=r=>hex[r&15],h2=r=>hex[(r&240)>>4]+hex[r&15],eq=r=>(r&240)>>4===(r&15),isShort=r=>eq(r.r)&&eq(r.g)&&eq(r.b)&&eq(r.a);function hexParse(r){var e=r.length,t;return r[0]==="#"&&(e===4||e===5?t={r:255&map$1[r[1]]*17,g:255&map$1[r[2]]*17,b:255&map$1[r[3]]*17,a:e===5?map$1[r[4]]*17:255}:(e===7||e===9)&&(t={r:map$1[r[1]]<<4|map$1[r[2]],g:map$1[r[3]]<<4|map$1[r[4]],b:map$1[r[5]]<<4|map$1[r[6]],a:e===9?map$1[r[7]]<<4|map$1[r[8]]:255})),t}const alpha=(r,e)=>r<255?e(r):"";function hexString(r){var e=isShort(r)?h1:h2;return r?"#"+e(r.r)+e(r.g)+e(r.b)+alpha(r.a,e):void 0}const HUE_RE=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function hsl2rgbn(r,e,t){const n=e*Math.min(t,1-t),a=(o,c=(o+r/30)%12)=>t-n*Math.max(Math.min(c-3,9-c,1),-1);return[a(0),a(8),a(4)]}function hsv2rgbn(r,e,t){const n=(a,o=(a+r/60)%6)=>t-t*e*Math.max(Math.min(o,4-o,1),0);return[n(5),n(3),n(1)]}function hwb2rgbn(r,e,t){const n=hsl2rgbn(r,1,.5);let a;for(e+t>1&&(a=1/(e+t),e*=a,t*=a),a=0;a<3;a++)n[a]*=1-e-t,n[a]+=e;return n}function hueValue(r,e,t,n,a){return r===a?(e-t)/n+(e<t?6:0):e===a?(t-r)/n+2:(r-e)/n+4}function rgb2hsl(r){const t=r.r/255,n=r.g/255,a=r.b/255,o=Math.max(t,n,a),c=Math.min(t,n,a),u=(o+c)/2;let v,_,x;return o!==c&&(x=o-c,_=u>.5?x/(2-o-c):x/(o+c),v=hueValue(t,n,a,x,o),v=v*60+.5),[v|0,_||0,u]}function calln(r,e,t,n){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,t,n)).map(n2b)}function hsl2rgb(r,e,t){return calln(hsl2rgbn,r,e,t)}function hwb2rgb(r,e,t){return calln(hwb2rgbn,r,e,t)}function hsv2rgb(r,e,t){return calln(hsv2rgbn,r,e,t)}function hue(r){return(r%360+360)%360}function hueParse(r){const e=HUE_RE.exec(r);let t=255,n;if(!e)return;e[5]!==n&&(t=e[6]?p2b(+e[5]):n2b(+e[5]));const a=hue(+e[2]),o=+e[3]/100,c=+e[4]/100;return e[1]==="hwb"?n=hwb2rgb(a,o,c):e[1]==="hsv"?n=hsv2rgb(a,o,c):n=hsl2rgb(a,o,c),{r:n[0],g:n[1],b:n[2],a:t}}function rotate(r,e){var t=rgb2hsl(r);t[0]=hue(t[0]+e),t=hsl2rgb(t),r.r=t[0],r.g=t[1],r.b=t[2]}function hslString(r){if(!r)return;const e=rgb2hsl(r),t=e[0],n=n2p(e[1]),a=n2p(e[2]);return r.a<255?`hsla(${t}, ${n}%, ${a}%, ${b2n(r.a)})`:`hsl(${t}, ${n}%, ${a}%)`}const map$2={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},names$1={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function unpack(){const r={},e=Object.keys(names$1),t=Object.keys(map$2);let n,a,o,c,u;for(n=0;n<e.length;n++){for(c=u=e[n],a=0;a<t.length;a++)o=t[a],u=u.replace(o,map$2[o]);o=parseInt(names$1[c],16),r[u]=[o>>16&255,o>>8&255,o&255]}return r}let names;function nameParse(r){names||(names=unpack(),names.transparent=[0,0,0,0]);const e=names[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const RGB_RE=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function rgbParse(r){const e=RGB_RE.exec(r);let t=255,n,a,o;if(e){if(e[7]!==n){const c=+e[7];t=e[8]?p2b(c):lim(c*255,0,255)}return n=+e[1],a=+e[3],o=+e[5],n=255&(e[2]?p2b(n):lim(n,0,255)),a=255&(e[4]?p2b(a):lim(a,0,255)),o=255&(e[6]?p2b(o):lim(o,0,255)),{r:n,g:a,b:o,a:t}}}function rgbString(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${b2n(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const to=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,from=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function interpolate$1(r,e,t){const n=from(b2n(r.r)),a=from(b2n(r.g)),o=from(b2n(r.b));return{r:n2b(to(n+t*(from(b2n(e.r))-n))),g:n2b(to(a+t*(from(b2n(e.g))-a))),b:n2b(to(o+t*(from(b2n(e.b))-o))),a:r.a+t*(e.a-r.a)}}function modHSL(r,e,t){if(r){let n=rgb2hsl(r);n[e]=Math.max(0,Math.min(n[e]+n[e]*t,e===0?360:1)),n=hsl2rgb(n),r.r=n[0],r.g=n[1],r.b=n[2]}}function clone$1(r,e){return r&&Object.assign(e||{},r)}function fromObject(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=n2b(r[3]))):(e=clone$1(r,{r:0,g:0,b:0,a:1}),e.a=n2b(e.a)),e}function functionParse(r){return r.charAt(0)==="r"?rgbParse(r):hueParse(r)}class Color{constructor(e){if(e instanceof Color)return e;const t=typeof e;let n;t==="object"?n=fromObject(e):t==="string"&&(n=hexParse(e)||nameParse(e)||functionParse(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=clone$1(this._rgb);return e&&(e.a=b2n(e.a)),e}set rgb(e){this._rgb=fromObject(e)}rgbString(){return this._valid?rgbString(this._rgb):void 0}hexString(){return this._valid?hexString(this._rgb):void 0}hslString(){return this._valid?hslString(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,a=e.rgb;let o;const c=t===o?.5:t,u=2*c-1,v=n.a-a.a,_=((u*v===-1?u:(u+v)/(1+u*v))+1)/2;o=1-_,n.r=255&_*n.r+o*a.r+.5,n.g=255&_*n.g+o*a.g+.5,n.b=255&_*n.b+o*a.b+.5,n.a=c*n.a+(1-c)*a.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=interpolate$1(this._rgb,e._rgb,t)),this}clone(){return new Color(this.rgb)}alpha(e){return this._rgb.a=n2b(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=round(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return modHSL(this._rgb,2,e),this}darken(e){return modHSL(this._rgb,2,-e),this}saturate(e){return modHSL(this._rgb,1,e),this}desaturate(e){return modHSL(this._rgb,1,-e),this}rotate(e){return rotate(this._rgb,e),this}}/*!
 * Chart.js v4.4.7
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function noop(){}const uid=(()=>{let r=0;return()=>r++})();function isNullOrUndef(r){return r==null}function isArray(r){if(Array.isArray&&Array.isArray(r))return!0;const e=Object.prototype.toString.call(r);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function isObject(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function isNumberFinite(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function finiteOrDefault(r,e){return isNumberFinite(r)?r:e}function valueOrDefault(r,e){return typeof r>"u"?e:r}const toPercentage=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/e,toDimension=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*e:+r;function callback(r,e,t){if(r&&typeof r.call=="function")return r.apply(t,e)}function each(r,e,t,n){let a,o,c;if(isArray(r))for(o=r.length,a=0;a<o;a++)e.call(t,r[a],a);else if(isObject(r))for(c=Object.keys(r),o=c.length,a=0;a<o;a++)e.call(t,r[c[a]],c[a])}function _elementsEqual(r,e){let t,n,a,o;if(!r||!e||r.length!==e.length)return!1;for(t=0,n=r.length;t<n;++t)if(a=r[t],o=e[t],a.datasetIndex!==o.datasetIndex||a.index!==o.index)return!1;return!0}function clone(r){if(isArray(r))return r.map(clone);if(isObject(r)){const e=Object.create(null),t=Object.keys(r),n=t.length;let a=0;for(;a<n;++a)e[t[a]]=clone(r[t[a]]);return e}return r}function isValidKey(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function _merger(r,e,t,n){if(!isValidKey(r))return;const a=e[r],o=t[r];isObject(a)&&isObject(o)?merge(a,o,n):e[r]=clone(o)}function merge(r,e,t){const n=isArray(e)?e:[e],a=n.length;if(!isObject(r))return r;t=t||{};const o=t.merger||_merger;let c;for(let u=0;u<a;++u){if(c=n[u],!isObject(c))continue;const v=Object.keys(c);for(let _=0,x=v.length;_<x;++_)o(v[_],r,c,t)}return r}function mergeIf(r,e){return merge(r,e,{merger:_mergerIf})}function _mergerIf(r,e,t){if(!isValidKey(r))return;const n=e[r],a=t[r];isObject(n)&&isObject(a)?mergeIf(n,a):Object.prototype.hasOwnProperty.call(e,r)||(e[r]=clone(a))}const keyResolvers={"":r=>r,x:r=>r.x,y:r=>r.y};function _splitKey(r){const e=r.split("."),t=[];let n="";for(const a of e)n+=a,n.endsWith("\\")?n=n.slice(0,-1)+".":(t.push(n),n="");return t}function _getKeyResolver(r){const e=_splitKey(r);return t=>{for(const n of e){if(n==="")break;t=t&&t[n]}return t}}function resolveObjectKey(r,e){return(keyResolvers[e]||(keyResolvers[e]=_getKeyResolver(e)))(r)}function _capitalize(r){return r.charAt(0).toUpperCase()+r.slice(1)}const defined=r=>typeof r<"u",isFunction=r=>typeof r=="function",setsEqual=(r,e)=>{if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;return!0};function _isClickEvent(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}const PI=Math.PI,TAU=2*PI,PITAU=TAU+PI,INFINITY=Number.POSITIVE_INFINITY,RAD_PER_DEG=PI/180,HALF_PI=PI/2,QUARTER_PI=PI/4,TWO_THIRDS_PI=PI*2/3,log10=Math.log10,sign=Math.sign;function almostEquals(r,e,t){return Math.abs(r-e)<t}function niceNum(r){const e=Math.round(r);r=almostEquals(r,e,r/1e3)?e:r;const t=Math.pow(10,Math.floor(log10(r))),n=r/t;return(n<=1?1:n<=2?2:n<=5?5:10)*t}function _factorize(r){const e=[],t=Math.sqrt(r);let n;for(n=1;n<t;n++)r%n===0&&(e.push(n),e.push(r/n));return t===(t|0)&&e.push(t),e.sort((a,o)=>a-o).pop(),e}function isNumber(r){return!isNaN(parseFloat(r))&&isFinite(r)}function almostWhole(r,e){const t=Math.round(r);return t-e<=r&&t+e>=r}function _setMinAndMaxByKey(r,e,t){let n,a,o;for(n=0,a=r.length;n<a;n++)o=r[n][t],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function toRadians(r){return r*(PI/180)}function toDegrees(r){return r*(180/PI)}function _decimalPlaces(r){if(!isNumberFinite(r))return;let e=1,t=0;for(;Math.round(r*e)/e!==r;)e*=10,t++;return t}function getAngleFromPoint(r,e){const t=e.x-r.x,n=e.y-r.y,a=Math.sqrt(t*t+n*n);let o=Math.atan2(n,t);return o<-.5*PI&&(o+=TAU),{angle:o,distance:a}}function distanceBetweenPoints(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function _angleDiff(r,e){return(r-e+PITAU)%TAU-PI}function _normalizeAngle(r){return(r%TAU+TAU)%TAU}function _angleBetween(r,e,t,n){const a=_normalizeAngle(r),o=_normalizeAngle(e),c=_normalizeAngle(t),u=_normalizeAngle(o-a),v=_normalizeAngle(c-a),_=_normalizeAngle(a-o),x=_normalizeAngle(a-c);return a===o||a===c||n&&o===c||u>v&&_<x}function _limitValue(r,e,t){return Math.max(e,Math.min(t,r))}function _int16Range(r){return _limitValue(r,-32768,32767)}function _isBetween(r,e,t,n=1e-6){return r>=Math.min(e,t)-n&&r<=Math.max(e,t)+n}function _lookup(r,e,t){t=t||(c=>r[c]<e);let n=r.length-1,a=0,o;for(;n-a>1;)o=a+n>>1,t(o)?a=o:n=o;return{lo:a,hi:n}}const _lookupByKey=(r,e,t,n)=>_lookup(r,t,n?a=>{const o=r[a][e];return o<t||o===t&&r[a+1][e]===t}:a=>r[a][e]<t),_rlookupByKey=(r,e,t)=>_lookup(r,t,n=>r[n][e]>=t);function _filterBetween(r,e,t){let n=0,a=r.length;for(;n<a&&r[n]<e;)n++;for(;a>n&&r[a-1]>t;)a--;return n>0||a<r.length?r.slice(n,a):r}const arrayEvents=["push","pop","shift","splice","unshift"];function listenArrayEvents(r,e){if(r._chartjs){r._chartjs.listeners.push(e);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),arrayEvents.forEach(t=>{const n="_onData"+_capitalize(t),a=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...o){const c=a.apply(this,o);return r._chartjs.listeners.forEach(u=>{typeof u[n]=="function"&&u[n](...o)}),c}})})}function unlistenArrayEvents(r,e){const t=r._chartjs;if(!t)return;const n=t.listeners,a=n.indexOf(e);a!==-1&&n.splice(a,1),!(n.length>0)&&(arrayEvents.forEach(o=>{delete r[o]}),delete r._chartjs)}function _arrayUnique(r){const e=new Set(r);return e.size===r.length?r:Array.from(e)}const requestAnimFrame=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function throttled(r,e){let t=[],n=!1;return function(...a){t=a,n||(n=!0,requestAnimFrame.call(window,()=>{n=!1,r.apply(e,t)}))}}function debounce(r,e){let t;return function(...n){return e?(clearTimeout(t),t=setTimeout(r,e,n)):r.apply(this,n),e}}const _toLeftRightCenter=r=>r==="start"?"left":r==="end"?"right":"center",_alignStartEnd=(r,e,t)=>r==="start"?e:r==="end"?t:(e+t)/2,_textX=(r,e,t,n)=>r===(n?"left":"right")?t:r==="center"?(e+t)/2:e;function _getStartAndCountOfVisiblePoints(r,e,t){const n=e.length;let a=0,o=n;if(r._sorted){const{iScale:c,_parsed:u}=r,v=c.axis,{min:_,max:x,minDefined:E,maxDefined:M}=c.getUserBounds();E&&(a=_limitValue(Math.min(_lookupByKey(u,v,_).lo,t?n:_lookupByKey(e,v,c.getPixelForValue(_)).lo),0,n-1)),M?o=_limitValue(Math.max(_lookupByKey(u,c.axis,x,!0).hi+1,t?0:_lookupByKey(e,v,c.getPixelForValue(x),!0).hi+1),a,n)-a:o=n-a}return{start:a,count:o}}function _scaleRangesChanged(r){const{xScale:e,yScale:t,_scaleRanges:n}=r,a={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!n)return r._scaleRanges=a,!0;const o=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==t.min||n.ymax!==t.max;return Object.assign(n,a),o}const atEdge=r=>r===0||r===1,elasticIn=(r,e,t)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-e)*TAU/t)),elasticOut=(r,e,t)=>Math.pow(2,-10*r)*Math.sin((r-e)*TAU/t)+1,effects={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*HALF_PI)+1,easeOutSine:r=>Math.sin(r*HALF_PI),easeInOutSine:r=>-.5*(Math.cos(PI*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>atEdge(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>atEdge(r)?r:elasticIn(r,.075,.3),easeOutElastic:r=>atEdge(r)?r:elasticOut(r,.075,.3),easeInOutElastic(r){return atEdge(r)?r:r<.5?.5*elasticIn(r*2,.1125,.45):.5+.5*elasticOut(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let e=1.70158;return(r/=.5)<1?.5*(r*r*(((e*=1.525)+1)*r-e)):.5*((r-=2)*r*(((e*=1.525)+1)*r+e)+2)},easeInBounce:r=>1-effects.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?effects.easeInBounce(r*2)*.5:effects.easeOutBounce(r*2-1)*.5+.5};function isPatternOrGradient(r){if(r&&typeof r=="object"){const e=r.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function color(r){return isPatternOrGradient(r)?r:new Color(r)}function getHoverColor(r){return isPatternOrGradient(r)?r:new Color(r).saturate(.5).darken(.1).hexString()}const numbers=["x","y","borderWidth","radius","tension"],colors=["color","borderColor","backgroundColor"];function applyAnimationsDefaults(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),r.set("animations",{colors:{type:"color",properties:colors},numbers:{type:"number",properties:numbers}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function applyLayoutsDefaults(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const intlCache=new Map;function getNumberFormat(r,e){e=e||{};const t=r+JSON.stringify(e);let n=intlCache.get(t);return n||(n=new Intl.NumberFormat(r,e),intlCache.set(t,n)),n}function formatNumber(r,e,t){return getNumberFormat(e,t).format(r)}const formatters={values(r){return isArray(r)?r:""+r},numeric(r,e,t){if(r===0)return"0";const n=this.chart.options.locale;let a,o=r;if(t.length>1){const _=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(_<1e-4||_>1e15)&&(a="scientific"),o=calculateDelta(r,t)}const c=log10(Math.abs(o)),u=isNaN(c)?1:Math.max(Math.min(-1*Math.floor(c),20),0),v={notation:a,minimumFractionDigits:u,maximumFractionDigits:u};return Object.assign(v,this.options.ticks.format),formatNumber(r,n,v)},logarithmic(r,e,t){if(r===0)return"0";const n=t[e].significand||r/Math.pow(10,Math.floor(log10(r)));return[1,2,3,5,10,15].includes(n)||e>.8*t.length?formatters.numeric.call(this,r,e,t):""}};function calculateDelta(r,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&r!==Math.floor(r)&&(t=r-Math.floor(r)),t}var Ticks={formatters};function applyScaleDefaults(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ticks.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const overrides=Object.create(null),descriptors=Object.create(null);function getScope$1(r,e){if(!e)return r;const t=e.split(".");for(let n=0,a=t.length;n<a;++n){const o=t[n];r=r[o]||(r[o]=Object.create(null))}return r}function set(r,e,t){return typeof e=="string"?merge(getScope$1(r,e),t):merge(getScope$1(r,""),e)}class Defaults{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,a)=>getHoverColor(a.backgroundColor),this.hoverBorderColor=(n,a)=>getHoverColor(a.borderColor),this.hoverColor=(n,a)=>getHoverColor(a.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return set(this,e,t)}get(e){return getScope$1(this,e)}describe(e,t){return set(descriptors,e,t)}override(e,t){return set(overrides,e,t)}route(e,t,n,a){const o=getScope$1(this,e),c=getScope$1(this,n),u="_"+t;Object.defineProperties(o,{[u]:{value:o[t],writable:!0},[t]:{enumerable:!0,get(){const v=this[u],_=c[a];return isObject(v)?Object.assign({},_,v):valueOrDefault(v,_)},set(v){this[u]=v}}})}apply(e){e.forEach(t=>t(this))}}var defaults=new Defaults({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[applyAnimationsDefaults,applyLayoutsDefaults,applyScaleDefaults]);function toFontString(r){return!r||isNullOrUndef(r.size)||isNullOrUndef(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function _measureText(r,e,t,n,a){let o=e[a];return o||(o=e[a]=r.measureText(a).width,t.push(a)),o>n&&(n=o),n}function _longestText(r,e,t,n){n=n||{};let a=n.data=n.data||{},o=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(a=n.data={},o=n.garbageCollect=[],n.font=e),r.save(),r.font=e;let c=0;const u=t.length;let v,_,x,E,M;for(v=0;v<u;v++)if(E=t[v],E!=null&&!isArray(E))c=_measureText(r,a,o,c,E);else if(isArray(E))for(_=0,x=E.length;_<x;_++)M=E[_],M!=null&&!isArray(M)&&(c=_measureText(r,a,o,c,M));r.restore();const C=o.length/2;if(C>t.length){for(v=0;v<C;v++)delete a[o[v]];o.splice(0,C)}return c}function _alignPixel(r,e,t){const n=r.currentDevicePixelRatio,a=t!==0?Math.max(t/2,.5):0;return Math.round((e-a)*n)/n+a}function clearCanvas(r,e){!e&&!r||(e=e||r.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,r.width,r.height),e.restore())}function drawPoint(r,e,t,n){drawPointLegend(r,e,t,n,null)}function drawPointLegend(r,e,t,n,a){let o,c,u,v,_,x,E,M;const C=e.pointStyle,I=e.rotation,D=e.radius;let L=(I||0)*RAD_PER_DEG;if(C&&typeof C=="object"&&(o=C.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){r.save(),r.translate(t,n),r.rotate(L),r.drawImage(C,-C.width/2,-C.height/2,C.width,C.height),r.restore();return}if(!(isNaN(D)||D<=0)){switch(r.beginPath(),C){default:a?r.ellipse(t,n,a/2,D,0,0,TAU):r.arc(t,n,D,0,TAU),r.closePath();break;case"triangle":x=a?a/2:D,r.moveTo(t+Math.sin(L)*x,n-Math.cos(L)*D),L+=TWO_THIRDS_PI,r.lineTo(t+Math.sin(L)*x,n-Math.cos(L)*D),L+=TWO_THIRDS_PI,r.lineTo(t+Math.sin(L)*x,n-Math.cos(L)*D),r.closePath();break;case"rectRounded":_=D*.516,v=D-_,c=Math.cos(L+QUARTER_PI)*v,E=Math.cos(L+QUARTER_PI)*(a?a/2-_:v),u=Math.sin(L+QUARTER_PI)*v,M=Math.sin(L+QUARTER_PI)*(a?a/2-_:v),r.arc(t-E,n-u,_,L-PI,L-HALF_PI),r.arc(t+M,n-c,_,L-HALF_PI,L),r.arc(t+E,n+u,_,L,L+HALF_PI),r.arc(t-M,n+c,_,L+HALF_PI,L+PI),r.closePath();break;case"rect":if(!I){v=Math.SQRT1_2*D,x=a?a/2:v,r.rect(t-x,n-v,2*x,2*v);break}L+=QUARTER_PI;case"rectRot":E=Math.cos(L)*(a?a/2:D),c=Math.cos(L)*D,u=Math.sin(L)*D,M=Math.sin(L)*(a?a/2:D),r.moveTo(t-E,n-u),r.lineTo(t+M,n-c),r.lineTo(t+E,n+u),r.lineTo(t-M,n+c),r.closePath();break;case"crossRot":L+=QUARTER_PI;case"cross":E=Math.cos(L)*(a?a/2:D),c=Math.cos(L)*D,u=Math.sin(L)*D,M=Math.sin(L)*(a?a/2:D),r.moveTo(t-E,n-u),r.lineTo(t+E,n+u),r.moveTo(t+M,n-c),r.lineTo(t-M,n+c);break;case"star":E=Math.cos(L)*(a?a/2:D),c=Math.cos(L)*D,u=Math.sin(L)*D,M=Math.sin(L)*(a?a/2:D),r.moveTo(t-E,n-u),r.lineTo(t+E,n+u),r.moveTo(t+M,n-c),r.lineTo(t-M,n+c),L+=QUARTER_PI,E=Math.cos(L)*(a?a/2:D),c=Math.cos(L)*D,u=Math.sin(L)*D,M=Math.sin(L)*(a?a/2:D),r.moveTo(t-E,n-u),r.lineTo(t+E,n+u),r.moveTo(t+M,n-c),r.lineTo(t-M,n+c);break;case"line":c=a?a/2:Math.cos(L)*D,u=Math.sin(L)*D,r.moveTo(t-c,n-u),r.lineTo(t+c,n+u);break;case"dash":r.moveTo(t,n),r.lineTo(t+Math.cos(L)*(a?a/2:D),n+Math.sin(L)*D);break;case!1:r.closePath();break}r.fill(),e.borderWidth>0&&r.stroke()}}function _isPointInArea(r,e,t){return t=t||.5,!e||r&&r.x>e.left-t&&r.x<e.right+t&&r.y>e.top-t&&r.y<e.bottom+t}function clipArea(r,e){r.save(),r.beginPath(),r.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),r.clip()}function unclipArea(r){r.restore()}function _steppedLineTo(r,e,t,n,a){if(!e)return r.lineTo(t.x,t.y);if(a==="middle"){const o=(e.x+t.x)/2;r.lineTo(o,e.y),r.lineTo(o,t.y)}else a==="after"!=!!n?r.lineTo(e.x,t.y):r.lineTo(t.x,e.y);r.lineTo(t.x,t.y)}function _bezierCurveTo(r,e,t,n){if(!e)return r.lineTo(t.x,t.y);r.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?t.cp2x:t.cp1x,n?t.cp2y:t.cp1y,t.x,t.y)}function setRenderOpts(r,e){e.translation&&r.translate(e.translation[0],e.translation[1]),isNullOrUndef(e.rotation)||r.rotate(e.rotation),e.color&&(r.fillStyle=e.color),e.textAlign&&(r.textAlign=e.textAlign),e.textBaseline&&(r.textBaseline=e.textBaseline)}function decorateText(r,e,t,n,a){if(a.strikethrough||a.underline){const o=r.measureText(n),c=e-o.actualBoundingBoxLeft,u=e+o.actualBoundingBoxRight,v=t-o.actualBoundingBoxAscent,_=t+o.actualBoundingBoxDescent,x=a.strikethrough?(v+_)/2:_;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=a.decorationWidth||2,r.moveTo(c,x),r.lineTo(u,x),r.stroke()}}function drawBackdrop(r,e){const t=r.fillStyle;r.fillStyle=e.color,r.fillRect(e.left,e.top,e.width,e.height),r.fillStyle=t}function renderText(r,e,t,n,a,o={}){const c=isArray(e)?e:[e],u=o.strokeWidth>0&&o.strokeColor!=="";let v,_;for(r.save(),r.font=a.string,setRenderOpts(r,o),v=0;v<c.length;++v)_=c[v],o.backdrop&&drawBackdrop(r,o.backdrop),u&&(o.strokeColor&&(r.strokeStyle=o.strokeColor),isNullOrUndef(o.strokeWidth)||(r.lineWidth=o.strokeWidth),r.strokeText(_,t,n,o.maxWidth)),r.fillText(_,t,n,o.maxWidth),decorateText(r,t,n,_,o),n+=Number(a.lineHeight);r.restore()}function addRoundedRectPath(r,e){const{x:t,y:n,w:a,h:o,radius:c}=e;r.arc(t+c.topLeft,n+c.topLeft,c.topLeft,1.5*PI,PI,!0),r.lineTo(t,n+o-c.bottomLeft),r.arc(t+c.bottomLeft,n+o-c.bottomLeft,c.bottomLeft,PI,HALF_PI,!0),r.lineTo(t+a-c.bottomRight,n+o),r.arc(t+a-c.bottomRight,n+o-c.bottomRight,c.bottomRight,HALF_PI,0,!0),r.lineTo(t+a,n+c.topRight),r.arc(t+a-c.topRight,n+c.topRight,c.topRight,0,-HALF_PI,!0),r.lineTo(t+c.topLeft,n)}const LINE_HEIGHT=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,FONT_STYLE=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function toLineHeight(r,e){const t=(""+r).match(LINE_HEIGHT);if(!t||t[1]==="normal")return e*1.2;switch(r=+t[2],t[3]){case"px":return r;case"%":r/=100;break}return e*r}const numberOrZero=r=>+r||0;function _readValueToProps(r,e){const t={},n=isObject(e),a=n?Object.keys(e):e,o=isObject(r)?n?c=>valueOrDefault(r[c],r[e[c]]):c=>r[c]:()=>r;for(const c of a)t[c]=numberOrZero(o(c));return t}function toTRBL(r){return _readValueToProps(r,{top:"y",right:"x",bottom:"y",left:"x"})}function toTRBLCorners(r){return _readValueToProps(r,["topLeft","topRight","bottomLeft","bottomRight"])}function toPadding(r){const e=toTRBL(r);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function toFont(r,e){r=r||{},e=e||defaults.font;let t=valueOrDefault(r.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let n=valueOrDefault(r.style,e.style);n&&!(""+n).match(FONT_STYLE)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const a={family:valueOrDefault(r.family,e.family),lineHeight:toLineHeight(valueOrDefault(r.lineHeight,e.lineHeight),t),size:t,style:n,weight:valueOrDefault(r.weight,e.weight),string:""};return a.string=toFontString(a),a}function resolve(r,e,t,n){let a,o,c;for(a=0,o=r.length;a<o;++a)if(c=r[a],c!==void 0&&c!==void 0)return c}function _addGrace(r,e,t){const{min:n,max:a}=r,o=toDimension(e,(a-n)/2),c=(u,v)=>t&&u===0?0:u+v;return{min:c(n,-Math.abs(o)),max:c(a,o)}}function createContext(r,e){return Object.assign(Object.create(r),e)}function _createResolver(r,e=[""],t,n,a=()=>r[0]){const o=t||r;typeof n>"u"&&(n=_resolve("_fallback",r));const c={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:o,_fallback:n,_getTarget:a,override:u=>_createResolver([u,...r],e,o,n)};return new Proxy(c,{deleteProperty(u,v){return delete u[v],delete u._keys,delete r[0][v],!0},get(u,v){return _cached(u,v,()=>_resolveWithPrefixes(v,e,r,u))},getOwnPropertyDescriptor(u,v){return Reflect.getOwnPropertyDescriptor(u._scopes[0],v)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(u,v){return getKeysFromAllScopes(u).includes(v)},ownKeys(u){return getKeysFromAllScopes(u)},set(u,v,_){const x=u._storage||(u._storage=a());return u[v]=x[v]=_,delete u._keys,!0}})}function _attachContext(r,e,t,n){const a={_cacheable:!1,_proxy:r,_context:e,_subProxy:t,_stack:new Set,_descriptors:_descriptors(r,n),setContext:o=>_attachContext(r,o,t,n),override:o=>_attachContext(r.override(o),e,t,n)};return new Proxy(a,{deleteProperty(o,c){return delete o[c],delete r[c],!0},get(o,c,u){return _cached(o,c,()=>_resolveWithContext(o,c,u))},getOwnPropertyDescriptor(o,c){return o._descriptors.allKeys?Reflect.has(r,c)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,c)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(o,c){return Reflect.has(r,c)},ownKeys(){return Reflect.ownKeys(r)},set(o,c,u){return r[c]=u,delete o[c],!0}})}function _descriptors(r,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:n=e.indexable,_allKeys:a=e.allKeys}=r;return{allKeys:a,scriptable:t,indexable:n,isScriptable:isFunction(t)?t:()=>t,isIndexable:isFunction(n)?n:()=>n}}const readKey=(r,e)=>r?r+_capitalize(e):e,needsSubResolver=(r,e)=>isObject(e)&&r!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function _cached(r,e,t){if(Object.prototype.hasOwnProperty.call(r,e)||e==="constructor")return r[e];const n=t();return r[e]=n,n}function _resolveWithContext(r,e,t){const{_proxy:n,_context:a,_subProxy:o,_descriptors:c}=r;let u=n[e];return isFunction(u)&&c.isScriptable(e)&&(u=_resolveScriptable(e,u,r,t)),isArray(u)&&u.length&&(u=_resolveArray(e,u,r,c.isIndexable)),needsSubResolver(e,u)&&(u=_attachContext(u,a,o&&o[e],c)),u}function _resolveScriptable(r,e,t,n){const{_proxy:a,_context:o,_subProxy:c,_stack:u}=t;if(u.has(r))throw new Error("Recursion detected: "+Array.from(u).join("->")+"->"+r);u.add(r);let v=e(o,c||n);return u.delete(r),needsSubResolver(r,v)&&(v=createSubResolver(a._scopes,a,r,v)),v}function _resolveArray(r,e,t,n){const{_proxy:a,_context:o,_subProxy:c,_descriptors:u}=t;if(typeof o.index<"u"&&n(r))return e[o.index%e.length];if(isObject(e[0])){const v=e,_=a._scopes.filter(x=>x!==v);e=[];for(const x of v){const E=createSubResolver(_,a,r,x);e.push(_attachContext(E,o,c&&c[r],u))}}return e}function resolveFallback(r,e,t){return isFunction(r)?r(e,t):r}const getScope=(r,e)=>r===!0?e:typeof r=="string"?resolveObjectKey(e,r):void 0;function addScopes(r,e,t,n,a){for(const o of e){const c=getScope(t,o);if(c){r.add(c);const u=resolveFallback(c._fallback,t,a);if(typeof u<"u"&&u!==t&&u!==n)return u}else if(c===!1&&typeof n<"u"&&t!==n)return null}return!1}function createSubResolver(r,e,t,n){const a=e._rootScopes,o=resolveFallback(e._fallback,t,n),c=[...r,...a],u=new Set;u.add(n);let v=addScopesFromKey(u,c,t,o||t,n);return v===null||typeof o<"u"&&o!==t&&(v=addScopesFromKey(u,c,o,v,n),v===null)?!1:_createResolver(Array.from(u),[""],a,o,()=>subGetTarget(e,t,n))}function addScopesFromKey(r,e,t,n,a){for(;t;)t=addScopes(r,e,t,n,a);return t}function subGetTarget(r,e,t){const n=r._getTarget();e in n||(n[e]={});const a=n[e];return isArray(a)&&isObject(t)?t:a||{}}function _resolveWithPrefixes(r,e,t,n){let a;for(const o of e)if(a=_resolve(readKey(o,r),t),typeof a<"u")return needsSubResolver(r,a)?createSubResolver(t,n,r,a):a}function _resolve(r,e){for(const t of e){if(!t)continue;const n=t[r];if(typeof n<"u")return n}}function getKeysFromAllScopes(r){let e=r._keys;return e||(e=r._keys=resolveKeysFromAllScopes(r._scopes)),e}function resolveKeysFromAllScopes(r){const e=new Set;for(const t of r)for(const n of Object.keys(t).filter(a=>!a.startsWith("_")))e.add(n);return Array.from(e)}function _parseObjectDataRadialScale(r,e,t,n){const{iScale:a}=r,{key:o="r"}=this._parsing,c=new Array(n);let u,v,_,x;for(u=0,v=n;u<v;++u)_=u+t,x=e[_],c[u]={r:a.parse(resolveObjectKey(x,o),_)};return c}const EPSILON=Number.EPSILON||1e-14,getPoint=(r,e)=>e<r.length&&!r[e].skip&&r[e],getValueAxis=r=>r==="x"?"y":"x";function splineCurve(r,e,t,n){const a=r.skip?e:r,o=e,c=t.skip?e:t,u=distanceBetweenPoints(o,a),v=distanceBetweenPoints(c,o);let _=u/(u+v),x=v/(u+v);_=isNaN(_)?0:_,x=isNaN(x)?0:x;const E=n*_,M=n*x;return{previous:{x:o.x-E*(c.x-a.x),y:o.y-E*(c.y-a.y)},next:{x:o.x+M*(c.x-a.x),y:o.y+M*(c.y-a.y)}}}function monotoneAdjust(r,e,t){const n=r.length;let a,o,c,u,v,_=getPoint(r,0);for(let x=0;x<n-1;++x)if(v=_,_=getPoint(r,x+1),!(!v||!_)){if(almostEquals(e[x],0,EPSILON)){t[x]=t[x+1]=0;continue}a=t[x]/e[x],o=t[x+1]/e[x],u=Math.pow(a,2)+Math.pow(o,2),!(u<=9)&&(c=3/Math.sqrt(u),t[x]=a*c*e[x],t[x+1]=o*c*e[x])}}function monotoneCompute(r,e,t="x"){const n=getValueAxis(t),a=r.length;let o,c,u,v=getPoint(r,0);for(let _=0;_<a;++_){if(c=u,u=v,v=getPoint(r,_+1),!u)continue;const x=u[t],E=u[n];c&&(o=(x-c[t])/3,u[`cp1${t}`]=x-o,u[`cp1${n}`]=E-o*e[_]),v&&(o=(v[t]-x)/3,u[`cp2${t}`]=x+o,u[`cp2${n}`]=E+o*e[_])}}function splineCurveMonotone(r,e="x"){const t=getValueAxis(e),n=r.length,a=Array(n).fill(0),o=Array(n);let c,u,v,_=getPoint(r,0);for(c=0;c<n;++c)if(u=v,v=_,_=getPoint(r,c+1),!!v){if(_){const x=_[e]-v[e];a[c]=x!==0?(_[t]-v[t])/x:0}o[c]=u?_?sign(a[c-1])!==sign(a[c])?0:(a[c-1]+a[c])/2:a[c-1]:a[c]}monotoneAdjust(r,a,o),monotoneCompute(r,o,e)}function capControlPoint(r,e,t){return Math.max(Math.min(r,t),e)}function capBezierPoints(r,e){let t,n,a,o,c,u=_isPointInArea(r[0],e);for(t=0,n=r.length;t<n;++t)c=o,o=u,u=t<n-1&&_isPointInArea(r[t+1],e),o&&(a=r[t],c&&(a.cp1x=capControlPoint(a.cp1x,e.left,e.right),a.cp1y=capControlPoint(a.cp1y,e.top,e.bottom)),u&&(a.cp2x=capControlPoint(a.cp2x,e.left,e.right),a.cp2y=capControlPoint(a.cp2y,e.top,e.bottom)))}function _updateBezierControlPoints(r,e,t,n,a){let o,c,u,v;if(e.spanGaps&&(r=r.filter(_=>!_.skip)),e.cubicInterpolationMode==="monotone")splineCurveMonotone(r,a);else{let _=n?r[r.length-1]:r[0];for(o=0,c=r.length;o<c;++o)u=r[o],v=splineCurve(_,u,r[Math.min(o+1,c-(n?0:1))%c],e.tension),u.cp1x=v.previous.x,u.cp1y=v.previous.y,u.cp2x=v.next.x,u.cp2y=v.next.y,_=u}e.capBezierPoints&&capBezierPoints(r,t)}function _isDomSupported(){return typeof window<"u"&&typeof document<"u"}function _getParentNode(r){let e=r.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function parseMaxStyle(r,e,t){let n;return typeof r=="string"?(n=parseInt(r,10),r.indexOf("%")!==-1&&(n=n/100*e.parentNode[t])):n=r,n}const getComputedStyle=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function getStyle(r,e){return getComputedStyle(r).getPropertyValue(e)}const positions=["top","right","bottom","left"];function getPositionedStyle(r,e,t){const n={};t=t?"-"+t:"";for(let a=0;a<4;a++){const o=positions[a];n[o]=parseFloat(r[e+"-"+o+t])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const useOffsetPos=(r,e,t)=>(r>0||e>0)&&(!t||!t.shadowRoot);function getCanvasPosition(r,e){const t=r.touches,n=t&&t.length?t[0]:r,{offsetX:a,offsetY:o}=n;let c=!1,u,v;if(useOffsetPos(a,o,r.target))u=a,v=o;else{const _=e.getBoundingClientRect();u=n.clientX-_.left,v=n.clientY-_.top,c=!0}return{x:u,y:v,box:c}}function getRelativePosition(r,e){if("native"in r)return r;const{canvas:t,currentDevicePixelRatio:n}=e,a=getComputedStyle(t),o=a.boxSizing==="border-box",c=getPositionedStyle(a,"padding"),u=getPositionedStyle(a,"border","width"),{x:v,y:_,box:x}=getCanvasPosition(r,t),E=c.left+(x&&u.left),M=c.top+(x&&u.top);let{width:C,height:I}=e;return o&&(C-=c.width+u.width,I-=c.height+u.height),{x:Math.round((v-E)/C*t.width/n),y:Math.round((_-M)/I*t.height/n)}}function getContainerSize(r,e,t){let n,a;if(e===void 0||t===void 0){const o=r&&_getParentNode(r);if(!o)e=r.clientWidth,t=r.clientHeight;else{const c=o.getBoundingClientRect(),u=getComputedStyle(o),v=getPositionedStyle(u,"border","width"),_=getPositionedStyle(u,"padding");e=c.width-_.width-v.width,t=c.height-_.height-v.height,n=parseMaxStyle(u.maxWidth,o,"clientWidth"),a=parseMaxStyle(u.maxHeight,o,"clientHeight")}}return{width:e,height:t,maxWidth:n||INFINITY,maxHeight:a||INFINITY}}const round1=r=>Math.round(r*10)/10;function getMaximumSize(r,e,t,n){const a=getComputedStyle(r),o=getPositionedStyle(a,"margin"),c=parseMaxStyle(a.maxWidth,r,"clientWidth")||INFINITY,u=parseMaxStyle(a.maxHeight,r,"clientHeight")||INFINITY,v=getContainerSize(r,e,t);let{width:_,height:x}=v;if(a.boxSizing==="content-box"){const M=getPositionedStyle(a,"border","width"),C=getPositionedStyle(a,"padding");_-=C.width+M.width,x-=C.height+M.height}return _=Math.max(0,_-o.width),x=Math.max(0,n?_/n:x-o.height),_=round1(Math.min(_,c,v.maxWidth)),x=round1(Math.min(x,u,v.maxHeight)),_&&!x&&(x=round1(_/2)),(e!==void 0||t!==void 0)&&n&&v.height&&x>v.height&&(x=v.height,_=round1(Math.floor(x*n))),{width:_,height:x}}function retinaScale(r,e,t){const n=e||1,a=Math.floor(r.height*n),o=Math.floor(r.width*n);r.height=Math.floor(r.height),r.width=Math.floor(r.width);const c=r.canvas;return c.style&&(t||!c.style.height&&!c.style.width)&&(c.style.height=`${r.height}px`,c.style.width=`${r.width}px`),r.currentDevicePixelRatio!==n||c.height!==a||c.width!==o?(r.currentDevicePixelRatio=n,c.height=a,c.width=o,r.ctx.setTransform(n,0,0,n,0,0),!0):!1}const supportsEventListenerOptions=function(){let r=!1;try{const e={get passive(){return r=!0,!1}};_isDomSupported()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return r}();function readUsedSize(r,e){const t=getStyle(r,e),n=t&&t.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function _pointInLine(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:r.y+t*(e.y-r.y)}}function _steppedInterpolation(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:n==="middle"?t<.5?r.y:e.y:n==="after"?t<1?r.y:e.y:t>0?e.y:r.y}}function _bezierInterpolation(r,e,t,n){const a={x:r.cp2x,y:r.cp2y},o={x:e.cp1x,y:e.cp1y},c=_pointInLine(r,a,t),u=_pointInLine(a,o,t),v=_pointInLine(o,e,t),_=_pointInLine(c,u,t),x=_pointInLine(u,v,t);return _pointInLine(_,x,t)}const getRightToLeftAdapter=function(r,e){return{x(t){return r+r+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,n){return t-n},leftForLtr(t,n){return t-n}}},getLeftToRightAdapter=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,e){return r+e},leftForLtr(r,e){return r}}};function getRtlAdapter(r,e,t){return r?getRightToLeftAdapter(e,t):getLeftToRightAdapter()}function overrideTextDirection(r,e){let t,n;(e==="ltr"||e==="rtl")&&(t=r.canvas.style,n=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),r.prevTextDirection=n)}function restoreTextDirection(r,e){e!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",e[0],e[1]))}function propertyFn(r){return r==="angle"?{between:_angleBetween,compare:_angleDiff,normalize:_normalizeAngle}:{between:_isBetween,compare:(e,t)=>e-t,normalize:e=>e}}function normalizeSegment({start:r,end:e,count:t,loop:n,style:a}){return{start:r%t,end:e%t,loop:n&&(e-r+1)%t===0,style:a}}function getSegment(r,e,t){const{property:n,start:a,end:o}=t,{between:c,normalize:u}=propertyFn(n),v=e.length;let{start:_,end:x,loop:E}=r,M,C;if(E){for(_+=v,x+=v,M=0,C=v;M<C&&c(u(e[_%v][n]),a,o);++M)_--,x--;_%=v,x%=v}return x<_&&(x+=v),{start:_,end:x,loop:E,style:r.style}}function _boundSegment(r,e,t){if(!t)return[r];const{property:n,start:a,end:o}=t,c=e.length,{compare:u,between:v,normalize:_}=propertyFn(n),{start:x,end:E,loop:M,style:C}=getSegment(r,e,t),I=[];let D=!1,L=null,N,q,F;const U=()=>v(a,F,N)&&u(a,F)!==0,j=()=>u(o,N)===0||v(o,F,N),W=()=>D||U(),X=()=>!D||j();for(let J=x,G=x;J<=E;++J)q=e[J%c],!q.skip&&(N=_(q[n]),N!==F&&(D=v(N,a,o),L===null&&W()&&(L=u(N,a)===0?J:G),L!==null&&X()&&(I.push(normalizeSegment({start:L,end:J,loop:M,count:c,style:C})),L=null),G=J,F=N));return L!==null&&I.push(normalizeSegment({start:L,end:E,loop:M,count:c,style:C})),I}function _boundSegments(r,e){const t=[],n=r.segments;for(let a=0;a<n.length;a++){const o=_boundSegment(n[a],r.points,e);o.length&&t.push(...o)}return t}function findStartAndEnd(r,e,t,n){let a=0,o=e-1;if(t&&!n)for(;a<e&&!r[a].skip;)a++;for(;a<e&&r[a].skip;)a++;for(a%=e,t&&(o+=a);o>a&&r[o%e].skip;)o--;return o%=e,{start:a,end:o}}function solidSegments(r,e,t,n){const a=r.length,o=[];let c=e,u=r[e],v;for(v=e+1;v<=t;++v){const _=r[v%a];_.skip||_.stop?u.skip||(n=!1,o.push({start:e%a,end:(v-1)%a,loop:n}),e=c=_.stop?v:null):(c=v,u.skip&&(e=v)),u=_}return c!==null&&o.push({start:e%a,end:c%a,loop:n}),o}function _computeSegments(r,e){const t=r.points,n=r.options.spanGaps,a=t.length;if(!a)return[];const o=!!r._loop,{start:c,end:u}=findStartAndEnd(t,a,o,n);if(n===!0)return splitByStyles(r,[{start:c,end:u,loop:o}],t,e);const v=u<c?u+a:u,_=!!r._fullLoop&&c===0&&u===a-1;return splitByStyles(r,solidSegments(t,c,v,_),t,e)}function splitByStyles(r,e,t,n){return!n||!n.setContext||!t?e:doSplitByStyles(r,e,t,n)}function doSplitByStyles(r,e,t,n){const a=r._chart.getContext(),o=readStyle(r.options),{_datasetIndex:c,options:{spanGaps:u}}=r,v=t.length,_=[];let x=o,E=e[0].start,M=E;function C(I,D,L,N){const q=u?-1:1;if(I!==D){for(I+=v;t[I%v].skip;)I-=q;for(;t[D%v].skip;)D+=q;I%v!==D%v&&(_.push({start:I%v,end:D%v,loop:L,style:N}),x=N,E=D%v)}}for(const I of e){E=u?E:I.start;let D=t[E%v],L;for(M=E+1;M<=I.end;M++){const N=t[M%v];L=readStyle(n.setContext(createContext(a,{type:"segment",p0:D,p1:N,p0DataIndex:(M-1)%v,p1DataIndex:M%v,datasetIndex:c}))),styleChanged(L,x)&&C(E,M-1,I.loop,x),D=N,x=L}E<M-1&&C(E,M-1,I.loop,x)}return _}function readStyle(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function styleChanged(r,e){if(!e)return!1;const t=[],n=function(a,o){return isPatternOrGradient(o)?(t.includes(o)||t.push(o),t.indexOf(o)):o};return JSON.stringify(r,n)!==JSON.stringify(e,n)}/*!
 * Chart.js v4.4.7
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class Animator{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,a){const o=t.listeners[a],c=t.duration;o.forEach(u=>u({chart:e,initial:t.initial,numSteps:c,currentStep:Math.min(n-t.start,c)}))}_refresh(){this._request||(this._running=!0,this._request=requestAnimFrame.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((n,a)=>{if(!n.running||!n.items.length)return;const o=n.items;let c=o.length-1,u=!1,v;for(;c>=0;--c)v=o[c],v._active?(v._total>n.duration&&(n.duration=v._total),v.tick(e),u=!0):(o[c]=o[o.length-1],o.pop());u&&(a.draw(),this._notify(a,n,e,"progress")),o.length||(n.running=!1,this._notify(a,n,e,"complete"),n.initial=!1),t+=o.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((n,a)=>Math.max(n,a._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let a=n.length-1;for(;a>=0;--a)n[a].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var animator=new Animator;const transparent="transparent",interpolators={boolean(r,e,t){return t>.5?e:r},color(r,e,t){const n=color(r||transparent),a=n.valid&&color(e||transparent);return a&&a.valid?a.mix(n,t).hexString():e},number(r,e,t){return r+(e-r)*t}};class Animation{constructor(e,t,n,a){const o=t[n];a=resolve([e.to,a,o,e.from]);const c=resolve([e.from,o,a]);this._active=!0,this._fn=e.fn||interpolators[e.type||typeof c],this._easing=effects[e.easing]||effects.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=c,this._to=a,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const a=this._target[this._prop],o=n-this._start,c=this._duration-o;this._start=n,this._duration=Math.floor(Math.max(c,e.duration)),this._total+=o,this._loop=!!e.loop,this._to=resolve([e.to,t,a,e.from]),this._from=resolve([e.from,a,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,a=this._prop,o=this._from,c=this._loop,u=this._to;let v;if(this._active=o!==u&&(c||t<n),!this._active){this._target[a]=u,this._notify(!0);return}if(t<0){this._target[a]=o;return}v=t/n%2,v=c&&v>1?2-v:v,v=this._easing(Math.min(1,Math.max(0,v))),this._target[a]=this._fn(o,u,v)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let a=0;a<n.length;a++)n[a][t]()}}class Animations{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!isObject(e))return;const t=Object.keys(defaults.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(a=>{const o=e[a];if(!isObject(o))return;const c={};for(const u of t)c[u]=o[u];(isArray(o.properties)&&o.properties||[a]).forEach(u=>{(u===a||!n.has(u))&&n.set(u,c)})})}_animateOptions(e,t){const n=t.options,a=resolveTargetOptions(e,n);if(!a)return[];const o=this._createAnimations(a,n);return n.$shared&&awaitAll(e.options.$animations,n).then(()=>{e.options=n},()=>{}),o}_createAnimations(e,t){const n=this._properties,a=[],o=e.$animations||(e.$animations={}),c=Object.keys(t),u=Date.now();let v;for(v=c.length-1;v>=0;--v){const _=c[v];if(_.charAt(0)==="$")continue;if(_==="options"){a.push(...this._animateOptions(e,t));continue}const x=t[_];let E=o[_];const M=n.get(_);if(E)if(M&&E.active()){E.update(M,x,u);continue}else E.cancel();if(!M||!M.duration){e[_]=x;continue}o[_]=E=new Animation(M,e,_,x),a.push(E)}return a}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const n=this._createAnimations(e,t);if(n.length)return animator.add(this._chart,n),!0}}function awaitAll(r,e){const t=[],n=Object.keys(e);for(let a=0;a<n.length;a++){const o=r[n[a]];o&&o.active()&&t.push(o.wait())}return Promise.all(t)}function resolveTargetOptions(r,e){if(!e)return;let t=r.options;if(!t){r.options=e;return}return t.$shared&&(r.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function scaleClip(r,e){const t=r&&r.options||{},n=t.reverse,a=t.min===void 0?e:0,o=t.max===void 0?e:0;return{start:n?o:a,end:n?a:o}}function defaultClip(r,e,t){if(t===!1)return!1;const n=scaleClip(r,t),a=scaleClip(e,t);return{top:a.end,right:n.end,bottom:a.start,left:n.start}}function toClip(r){let e,t,n,a;return isObject(r)?(e=r.top,t=r.right,n=r.bottom,a=r.left):e=t=n=a=r,{top:e,right:t,bottom:n,left:a,disabled:r===!1}}function getSortedDatasetIndices(r,e){const t=[],n=r._getSortedDatasetMetas(e);let a,o;for(a=0,o=n.length;a<o;++a)t.push(n[a].index);return t}function applyStack(r,e,t,n={}){const a=r.keys,o=n.mode==="single";let c,u,v,_;if(e===null)return;let x=!1;for(c=0,u=a.length;c<u;++c){if(v=+a[c],v===t){if(x=!0,n.all)continue;break}_=r.values[v],isNumberFinite(_)&&(o||e===0||sign(e)===sign(_))&&(e+=_)}return!x&&!n.all?0:e}function convertObjectDataToArray(r,e){const{iScale:t,vScale:n}=e,a=t.axis==="x"?"x":"y",o=n.axis==="x"?"x":"y",c=Object.keys(r),u=new Array(c.length);let v,_,x;for(v=0,_=c.length;v<_;++v)x=c[v],u[v]={[a]:x,[o]:r[x]};return u}function isStacked(r,e){const t=r&&r.options.stacked;return t||t===void 0&&e.stack!==void 0}function getStackKey(r,e,t){return`${r.id}.${e.id}.${t.stack||t.type}`}function getUserBounds(r){const{min:e,max:t,minDefined:n,maxDefined:a}=r.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:a?t:Number.POSITIVE_INFINITY}}function getOrCreateStack(r,e,t){const n=r[e]||(r[e]={});return n[t]||(n[t]={})}function getLastIndexInStack(r,e,t,n){for(const a of e.getMatchingVisibleMetas(n).reverse()){const o=r[a.index];if(t&&o>0||!t&&o<0)return a.index}return null}function updateStacks(r,e){const{chart:t,_cachedMeta:n}=r,a=t._stacks||(t._stacks={}),{iScale:o,vScale:c,index:u}=n,v=o.axis,_=c.axis,x=getStackKey(o,c,n),E=e.length;let M;for(let C=0;C<E;++C){const I=e[C],{[v]:D,[_]:L}=I,N=I._stacks||(I._stacks={});M=N[_]=getOrCreateStack(a,x,D),M[u]=L,M._top=getLastIndexInStack(M,c,!0,n.type),M._bottom=getLastIndexInStack(M,c,!1,n.type);const q=M._visualValues||(M._visualValues={});q[u]=L}}function getFirstScaleId(r,e){const t=r.scales;return Object.keys(t).filter(n=>t[n].axis===e).shift()}function createDatasetContext(r,e){return createContext(r,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function createDataContext(r,e,t){return createContext(r,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function clearStacks(r,e){const t=r.controller.index,n=r.vScale&&r.vScale.axis;if(n){e=e||r._parsed;for(const a of e){const o=a._stacks;if(!o||o[n]===void 0||o[n][t]===void 0)return;delete o[n][t],o[n]._visualValues!==void 0&&o[n]._visualValues[t]!==void 0&&delete o[n]._visualValues[t]}}}const isDirectUpdateMode=r=>r==="reset"||r==="none",cloneIfNotShared=(r,e)=>e?r:Object.assign({},r),createStack=(r,e,t)=>r&&!e.hidden&&e._stacked&&{keys:getSortedDatasetIndices(t,!0),values:null};class DatasetController{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=isStacked(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&clearStacks(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),a=(E,M,C,I)=>E==="x"?M:E==="r"?I:C,o=t.xAxisID=valueOrDefault(n.xAxisID,getFirstScaleId(e,"x")),c=t.yAxisID=valueOrDefault(n.yAxisID,getFirstScaleId(e,"y")),u=t.rAxisID=valueOrDefault(n.rAxisID,getFirstScaleId(e,"r")),v=t.indexAxis,_=t.iAxisID=a(v,o,c,u),x=t.vAxisID=a(v,c,o,u);t.xScale=this.getScaleForId(o),t.yScale=this.getScaleForId(c),t.rScale=this.getScaleForId(u),t.iScale=this.getScaleForId(_),t.vScale=this.getScaleForId(x)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&unlistenArrayEvents(this._data,this),e._stacked&&clearStacks(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(isObject(t)){const a=this._cachedMeta;this._data=convertObjectDataToArray(t,a)}else if(n!==t){if(n){unlistenArrayEvents(n,this);const a=this._cachedMeta;clearStacks(a),a._parsed=[]}t&&Object.isExtensible(t)&&listenArrayEvents(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let a=!1;this._dataCheck();const o=t._stacked;t._stacked=isStacked(t.vScale,t),t.stack!==n.stack&&(a=!0,clearStacks(t),t.stack=n.stack),this._resyncElements(e),(a||o!==t._stacked)&&(updateStacks(this,t._parsed),t._stacked=isStacked(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:a}=this,{iScale:o,_stacked:c}=n,u=o.axis;let v=e===0&&t===a.length?!0:n._sorted,_=e>0&&n._parsed[e-1],x,E,M;if(this._parsing===!1)n._parsed=a,n._sorted=!0,M=a;else{isArray(a[e])?M=this.parseArrayData(n,a,e,t):isObject(a[e])?M=this.parseObjectData(n,a,e,t):M=this.parsePrimitiveData(n,a,e,t);const C=()=>E[u]===null||_&&E[u]<_[u];for(x=0;x<t;++x)n._parsed[x+e]=E=M[x],v&&(C()&&(v=!1),_=E);n._sorted=v}c&&updateStacks(this,M)}parsePrimitiveData(e,t,n,a){const{iScale:o,vScale:c}=e,u=o.axis,v=c.axis,_=o.getLabels(),x=o===c,E=new Array(a);let M,C,I;for(M=0,C=a;M<C;++M)I=M+n,E[M]={[u]:x||o.parse(_[I],I),[v]:c.parse(t[I],I)};return E}parseArrayData(e,t,n,a){const{xScale:o,yScale:c}=e,u=new Array(a);let v,_,x,E;for(v=0,_=a;v<_;++v)x=v+n,E=t[x],u[v]={x:o.parse(E[0],x),y:c.parse(E[1],x)};return u}parseObjectData(e,t,n,a){const{xScale:o,yScale:c}=e,{xAxisKey:u="x",yAxisKey:v="y"}=this._parsing,_=new Array(a);let x,E,M,C;for(x=0,E=a;x<E;++x)M=x+n,C=t[M],_[x]={x:o.parse(resolveObjectKey(C,u),M),y:c.parse(resolveObjectKey(C,v),M)};return _}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const a=this.chart,o=this._cachedMeta,c=t[e.axis],u={keys:getSortedDatasetIndices(a,!0),values:t._stacks[e.axis]._visualValues};return applyStack(u,c,o.index,{mode:n})}updateRangeFromParsed(e,t,n,a){const o=n[t.axis];let c=o===null?NaN:o;const u=a&&n._stacks[t.axis];a&&u&&(a.values=u,c=applyStack(a,o,this._cachedMeta.index)),e.min=Math.min(e.min,c),e.max=Math.max(e.max,c)}getMinMax(e,t){const n=this._cachedMeta,a=n._parsed,o=n._sorted&&e===n.iScale,c=a.length,u=this._getOtherScale(e),v=createStack(t,n,this.chart),_={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:x,max:E}=getUserBounds(u);let M,C;function I(){C=a[M];const D=C[u.axis];return!isNumberFinite(C[e.axis])||x>D||E<D}for(M=0;M<c&&!(!I()&&(this.updateRangeFromParsed(_,e,C,v),o));++M);if(o){for(M=c-1;M>=0;--M)if(!I()){this.updateRangeFromParsed(_,e,C,v);break}}return _}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let a,o,c;for(a=0,o=t.length;a<o;++a)c=t[a][e.axis],isNumberFinite(c)&&n.push(c);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,a=t.vScale,o=this.getParsed(e);return{label:n?""+n.getLabelForValue(o[n.axis]):"",value:a?""+a.getLabelForValue(o[a.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=toClip(valueOrDefault(this.options.clip,defaultClip(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,a=n.data||[],o=t.chartArea,c=[],u=this._drawStart||0,v=this._drawCount||a.length-u,_=this.options.drawActiveElementsOnTop;let x;for(n.dataset&&n.dataset.draw(e,o,u,v),x=u;x<u+v;++x){const E=a[x];E.hidden||(E.active&&_?c.push(E):E.draw(e,o))}for(x=0;x<c.length;++x)c[x].draw(e,o)}getStyle(e,t){const n=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const a=this.getDataset();let o;if(e>=0&&e<this._cachedMeta.data.length){const c=this._cachedMeta.data[e];o=c.$context||(c.$context=createDataContext(this.getContext(),e,c)),o.parsed=this.getParsed(e),o.raw=a.data[e],o.index=o.dataIndex=e}else o=this.$context||(this.$context=createDatasetContext(this.chart.getContext(),this.index)),o.dataset=a,o.index=o.datasetIndex=this.index;return o.active=!!t,o.mode=n,o}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",n){const a=t==="active",o=this._cachedDataOpts,c=e+"-"+t,u=o[c],v=this.enableOptionSharing&&defined(n);if(u)return cloneIfNotShared(u,v);const _=this.chart.config,x=_.datasetElementScopeKeys(this._type,e),E=a?[`${e}Hover`,"hover",e,""]:[e,""],M=_.getOptionScopes(this.getDataset(),x),C=Object.keys(defaults.elements[e]),I=()=>this.getContext(n,a,t),D=_.resolveNamedOptions(M,C,I,E);return D.$shared&&(D.$shared=v,o[c]=Object.freeze(cloneIfNotShared(D,v))),D}_resolveAnimations(e,t,n){const a=this.chart,o=this._cachedDataOpts,c=`animation-${t}`,u=o[c];if(u)return u;let v;if(a.options.animation!==!1){const x=this.chart.config,E=x.datasetAnimationScopeKeys(this._type,t),M=x.getOptionScopes(this.getDataset(),E);v=x.createResolver(M,this.getContext(e,n,t))}const _=new Animations(a,v&&v.animations);return v&&v._cacheable&&(o[c]=Object.freeze(_)),_}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||isDirectUpdateMode(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),a=this._sharedOptions,o=this.getSharedOptions(n),c=this.includeOptions(t,o)||o!==a;return this.updateSharedOptions(o,t,n),{sharedOptions:o,includeOptions:c}}updateElement(e,t,n,a){isDirectUpdateMode(a)?Object.assign(e,n):this._resolveAnimations(t,a).update(e,n)}updateSharedOptions(e,t,n){e&&!isDirectUpdateMode(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,a){e.active=a;const o=this.getStyle(t,a);this._resolveAnimations(t,n,a).update(e,{options:!a&&this.getSharedOptions(o)||o})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[u,v,_]of this._syncList)this[u](v,_);this._syncList=[];const a=n.length,o=t.length,c=Math.min(o,a);c&&this.parse(0,c),o>a?this._insertElements(a,o-a,e):o<a&&this._removeElements(o,a-o)}_insertElements(e,t,n=!0){const a=this._cachedMeta,o=a.data,c=e+t;let u;const v=_=>{for(_.length+=t,u=_.length-1;u>=c;u--)_[u]=_[u-t]};for(v(o),u=e;u<c;++u)o[u]=new this.dataElementType;this._parsing&&v(a._parsed),this.parse(e,t),n&&this.updateElements(o,e,t,"reset")}updateElements(e,t,n,a){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const a=n._parsed.splice(e,t);n._stacked&&clearStacks(n,a)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,a]=e;this[t](n,a)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function getAllScaleValues(r,e){if(!r._cache.$bar){const t=r.getMatchingVisibleMetas(e);let n=[];for(let a=0,o=t.length;a<o;a++)n=n.concat(t[a].controller.getAllParsedValues(r));r._cache.$bar=_arrayUnique(n.sort((a,o)=>a-o))}return r._cache.$bar}function computeMinSampleSize(r){const e=r.iScale,t=getAllScaleValues(e,r.type);let n=e._length,a,o,c,u;const v=()=>{c===32767||c===-32768||(defined(u)&&(n=Math.min(n,Math.abs(c-u)||n)),u=c)};for(a=0,o=t.length;a<o;++a)c=e.getPixelForValue(t[a]),v();for(u=void 0,a=0,o=e.ticks.length;a<o;++a)c=e.getPixelForTick(a),v();return n}function computeFitCategoryTraits(r,e,t,n){const a=t.barThickness;let o,c;return isNullOrUndef(a)?(o=e.min*t.categoryPercentage,c=t.barPercentage):(o=a*n,c=1),{chunk:o/n,ratio:c,start:e.pixels[r]-o/2}}function computeFlexCategoryTraits(r,e,t,n){const a=e.pixels,o=a[r];let c=r>0?a[r-1]:null,u=r<a.length-1?a[r+1]:null;const v=t.categoryPercentage;c===null&&(c=o-(u===null?e.end-e.start:u-o)),u===null&&(u=o+o-c);const _=o-(o-Math.min(c,u))/2*v;return{chunk:Math.abs(u-c)/2*v/n,ratio:t.barPercentage,start:_}}function parseFloatBar(r,e,t,n){const a=t.parse(r[0],n),o=t.parse(r[1],n),c=Math.min(a,o),u=Math.max(a,o);let v=c,_=u;Math.abs(c)>Math.abs(u)&&(v=u,_=c),e[t.axis]=_,e._custom={barStart:v,barEnd:_,start:a,end:o,min:c,max:u}}function parseValue(r,e,t,n){return isArray(r)?parseFloatBar(r,e,t,n):e[t.axis]=t.parse(r,n),e}function parseArrayOrPrimitive(r,e,t,n){const a=r.iScale,o=r.vScale,c=a.getLabels(),u=a===o,v=[];let _,x,E,M;for(_=t,x=t+n;_<x;++_)M=e[_],E={},E[a.axis]=u||a.parse(c[_],_),v.push(parseValue(M,E,o,_));return v}function isFloatBar(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function barSign(r,e,t){return r!==0?sign(r):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function borderProps(r){let e,t,n,a,o;return r.horizontal?(e=r.base>r.x,t="left",n="right"):(e=r.base<r.y,t="bottom",n="top"),e?(a="end",o="start"):(a="start",o="end"),{start:t,end:n,reverse:e,top:a,bottom:o}}function setBorderSkipped(r,e,t,n){let a=e.borderSkipped;const o={};if(!a){r.borderSkipped=o;return}if(a===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:c,end:u,reverse:v,top:_,bottom:x}=borderProps(r);a==="middle"&&t&&(r.enableBorderRadius=!0,(t._top||0)===n?a=_:(t._bottom||0)===n?a=x:(o[parseEdge(x,c,u,v)]=!0,a=_)),o[parseEdge(a,c,u,v)]=!0,r.borderSkipped=o}function parseEdge(r,e,t,n){return n?(r=swap(r,e,t),r=startEnd(r,t,e)):r=startEnd(r,e,t),r}function swap(r,e,t){return r===e?t:r===t?e:r}function startEnd(r,e,t){return r==="start"?e:r==="end"?t:r}function setInflateAmount(r,{inflateAmount:e},t){r.inflateAmount=e==="auto"?t===1?.33:0:e}class BarController extends DatasetController{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,n,a){return parseArrayOrPrimitive(e,t,n,a)}parseArrayData(e,t,n,a){return parseArrayOrPrimitive(e,t,n,a)}parseObjectData(e,t,n,a){const{iScale:o,vScale:c}=e,{xAxisKey:u="x",yAxisKey:v="y"}=this._parsing,_=o.axis==="x"?u:v,x=c.axis==="x"?u:v,E=[];let M,C,I,D;for(M=n,C=n+a;M<C;++M)D=t[M],I={},I[o.axis]=o.parse(resolveObjectKey(D,_),M),E.push(parseValue(resolveObjectKey(D,x),I,c,M));return E}updateRangeFromParsed(e,t,n,a){super.updateRangeFromParsed(e,t,n,a);const o=n._custom;o&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,o.min),e.max=Math.max(e.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:a}=t,o=this.getParsed(e),c=o._custom,u=isFloatBar(c)?"["+c.start+", "+c.end+"]":""+a.getLabelForValue(o[a.axis]);return{label:""+n.getLabelForValue(o[n.axis]),value:u}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,a){const o=a==="reset",{index:c,_cachedMeta:{vScale:u}}=this,v=u.getBasePixel(),_=u.isHorizontal(),x=this._getRuler(),{sharedOptions:E,includeOptions:M}=this._getSharedOptions(t,a);for(let C=t;C<t+n;C++){const I=this.getParsed(C),D=o||isNullOrUndef(I[u.axis])?{base:v,head:v}:this._calculateBarValuePixels(C),L=this._calculateBarIndexPixels(C,x),N=(I._stacks||{})[u.axis],q={horizontal:_,base:D.base,enableBorderRadius:!N||isFloatBar(I._custom)||c===N._top||c===N._bottom,x:_?D.head:L.center,y:_?L.center:D.head,height:_?L.size:Math.abs(D.size),width:_?Math.abs(D.size):L.size};M&&(q.options=E||this.resolveDataElementOptions(C,e[C].active?"active":a));const F=q.options||e[C].options;setBorderSkipped(q,F,N,c),setInflateAmount(q,F,x.ratio),this.updateElement(e[C],C,q,a)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,a=n.getMatchingVisibleMetas(this._type).filter(x=>x.controller.options.grouped),o=n.options.stacked,c=[],u=this._cachedMeta.controller.getParsed(t),v=u&&u[n.axis],_=x=>{const E=x._parsed.find(C=>C[n.axis]===v),M=E&&E[x.vScale.axis];if(isNullOrUndef(M)||isNaN(M))return!0};for(const x of a)if(!(t!==void 0&&_(x))&&((o===!1||c.indexOf(x.stack)===-1||o===void 0&&x.stack===void 0)&&c.push(x.stack),x.index===e))break;return c.length||c.push(void 0),c}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,n){const a=this._getStacks(e,n),o=t!==void 0?a.indexOf(t):-1;return o===-1?a.length-1:o}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,a=[];let o,c;for(o=0,c=t.data.length;o<c;++o)a.push(n.getPixelForValue(this.getParsed(o)[n.axis],o));const u=e.barThickness;return{min:u||computeMinSampleSize(t),pixels:a,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:u?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n,index:a},options:{base:o,minBarLength:c}}=this,u=o||0,v=this.getParsed(e),_=v._custom,x=isFloatBar(_);let E=v[t.axis],M=0,C=n?this.applyStack(t,v,n):E,I,D;C!==E&&(M=C-E,C=E),x&&(E=_.barStart,C=_.barEnd-_.barStart,E!==0&&sign(E)!==sign(_.barEnd)&&(M=0),M+=E);const L=!isNullOrUndef(o)&&!x?o:M;let N=t.getPixelForValue(L);if(this.chart.getDataVisibility(e)?I=t.getPixelForValue(M+C):I=N,D=I-N,Math.abs(D)<c){D=barSign(D,t,u)*c,E===u&&(N-=D/2);const q=t.getPixelForDecimal(0),F=t.getPixelForDecimal(1),U=Math.min(q,F),j=Math.max(q,F);N=Math.max(Math.min(N,j),U),I=N+D,n&&!x&&(v._stacks[t.axis]._visualValues[a]=t.getValueForPixel(I)-t.getValueForPixel(N))}if(N===t.getPixelForValue(u)){const q=sign(D)*t.getLineWidthForValue(u)/2;N+=q,D-=q}return{size:D,base:N,head:I,center:I+D/2}}_calculateBarIndexPixels(e,t){const n=t.scale,a=this.options,o=a.skipNull,c=valueOrDefault(a.maxBarThickness,1/0);let u,v;if(t.grouped){const _=o?this._getStackCount(e):t.stackCount,x=a.barThickness==="flex"?computeFlexCategoryTraits(e,t,a,_):computeFitCategoryTraits(e,t,a,_),E=this._getStackIndex(this.index,this._cachedMeta.stack,o?e:void 0);u=x.start+x.chunk*E+x.chunk/2,v=Math.min(c,x.chunk*x.ratio)}else u=n.getPixelForValue(this.getParsed(e)[n.axis],e),v=Math.min(c,t.min*t.ratio);return{base:u-v/2,head:u+v/2,center:u,size:v}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,a=n.length;let o=0;for(;o<a;++o)this.getParsed(o)[t.axis]!==null&&!n[o].hidden&&n[o].draw(this._ctx)}}class BubbleController extends DatasetController{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,n,a){const o=super.parsePrimitiveData(e,t,n,a);for(let c=0;c<o.length;c++)o[c]._custom=this.resolveDataElementOptions(c+n).radius;return o}parseArrayData(e,t,n,a){const o=super.parseArrayData(e,t,n,a);for(let c=0;c<o.length;c++){const u=t[n+c];o[c]._custom=valueOrDefault(u[2],this.resolveDataElementOptions(c+n).radius)}return o}parseObjectData(e,t,n,a){const o=super.parseObjectData(e,t,n,a);for(let c=0;c<o.length;c++){const u=t[n+c];o[c]._custom=valueOrDefault(u&&u.r&&+u.r,this.resolveDataElementOptions(c+n).radius)}return o}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:a,yScale:o}=t,c=this.getParsed(e),u=a.getLabelForValue(c.x),v=o.getLabelForValue(c.y),_=c._custom;return{label:n[e]||"",value:"("+u+", "+v+(_?", "+_:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,n,a){const o=a==="reset",{iScale:c,vScale:u}=this._cachedMeta,{sharedOptions:v,includeOptions:_}=this._getSharedOptions(t,a),x=c.axis,E=u.axis;for(let M=t;M<t+n;M++){const C=e[M],I=!o&&this.getParsed(M),D={},L=D[x]=o?c.getPixelForDecimal(.5):c.getPixelForValue(I[x]),N=D[E]=o?u.getBasePixel():u.getPixelForValue(I[E]);D.skip=isNaN(L)||isNaN(N),_&&(D.options=v||this.resolveDataElementOptions(M,C.active?"active":a),o&&(D.options.radius=0)),this.updateElement(C,M,D,a)}}resolveDataElementOptions(e,t){const n=this.getParsed(e);let a=super.resolveDataElementOptions(e,t);a.$shared&&(a=Object.assign({},a,{$shared:!1}));const o=a.radius;return t!=="active"&&(a.radius=0),a.radius+=valueOrDefault(n&&n._custom,o),a}}function getRatioAndOffset(r,e,t){let n=1,a=1,o=0,c=0;if(e<TAU){const u=r,v=u+e,_=Math.cos(u),x=Math.sin(u),E=Math.cos(v),M=Math.sin(v),C=(F,U,j)=>_angleBetween(F,u,v,!0)?1:Math.max(U,U*t,j,j*t),I=(F,U,j)=>_angleBetween(F,u,v,!0)?-1:Math.min(U,U*t,j,j*t),D=C(0,_,E),L=C(HALF_PI,x,M),N=I(PI,_,E),q=I(PI+HALF_PI,x,M);n=(D-N)/2,a=(L-q)/2,o=-(D+N)/2,c=-(L+q)/2}return{ratioX:n,ratioY:a,offsetX:o,offsetY:c}}class DoughnutController extends DatasetController{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:a}}=e.legend.options;return t.labels.map((o,c)=>{const v=e.getDatasetMeta(0).controller.getStyle(c);return{text:o,fillStyle:v.backgroundColor,strokeStyle:v.borderColor,fontColor:a,lineWidth:v.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(c),index:c}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const n=this.getDataset().data,a=this._cachedMeta;if(this._parsing===!1)a._parsed=n;else{let o=v=>+n[v];if(isObject(n[e])){const{key:v="value"}=this._parsing;o=_=>+resolveObjectKey(n[_],v)}let c,u;for(c=e,u=e+t;c<u;++c)a._parsed[c]=o(c)}}_getRotation(){return toRadians(this.options.rotation-90)}_getCircumference(){return toRadians(this.options.circumference)}_getRotationExtents(){let e=TAU,t=-TAU;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const a=this.chart.getDatasetMeta(n).controller,o=a._getRotation(),c=a._getCircumference();e=Math.min(e,o),t=Math.max(t,o+c)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:n}=t,a=this._cachedMeta,o=a.data,c=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,u=Math.max((Math.min(n.width,n.height)-c)/2,0),v=Math.min(toPercentage(this.options.cutout,u),1),_=this._getRingWeight(this.index),{circumference:x,rotation:E}=this._getRotationExtents(),{ratioX:M,ratioY:C,offsetX:I,offsetY:D}=getRatioAndOffset(E,x,v),L=(n.width-c)/M,N=(n.height-c)/C,q=Math.max(Math.min(L,N)/2,0),F=toDimension(this.options.radius,q),U=Math.max(F*v,0),j=(F-U)/this._getVisibleDatasetWeightTotal();this.offsetX=I*F,this.offsetY=D*F,a.total=this.calculateTotal(),this.outerRadius=F-j*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-j*_,0),this.updateElements(o,0,o.length,e)}_circumference(e,t){const n=this.options,a=this._cachedMeta,o=this._getCircumference();return t&&n.animation.animateRotate||!this.chart.getDataVisibility(e)||a._parsed[e]===null||a.data[e].hidden?0:this.calculateCircumference(a._parsed[e]*o/TAU)}updateElements(e,t,n,a){const o=a==="reset",c=this.chart,u=c.chartArea,_=c.options.animation,x=(u.left+u.right)/2,E=(u.top+u.bottom)/2,M=o&&_.animateScale,C=M?0:this.innerRadius,I=M?0:this.outerRadius,{sharedOptions:D,includeOptions:L}=this._getSharedOptions(t,a);let N=this._getRotation(),q;for(q=0;q<t;++q)N+=this._circumference(q,o);for(q=t;q<t+n;++q){const F=this._circumference(q,o),U=e[q],j={x:x+this.offsetX,y:E+this.offsetY,startAngle:N,endAngle:N+F,circumference:F,outerRadius:I,innerRadius:C};L&&(j.options=D||this.resolveDataElementOptions(q,U.active?"active":a)),N+=F,this.updateElement(U,q,j,a)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let n=0,a;for(a=0;a<t.length;a++){const o=e._parsed[a];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(a)&&!t[a].hidden&&(n+=Math.abs(o))}return n}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?TAU*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,a=n.data.labels||[],o=formatNumber(t._parsed[e],n.options.locale);return{label:a[e]||"",value:o}}getMaxBorderWidth(e){let t=0;const n=this.chart;let a,o,c,u,v;if(!e){for(a=0,o=n.data.datasets.length;a<o;++a)if(n.isDatasetVisible(a)){c=n.getDatasetMeta(a),e=c.data,u=c.controller;break}}if(!e)return 0;for(a=0,o=e.length;a<o;++a)v=u.resolveDataElementOptions(a),v.borderAlign!=="inner"&&(t=Math.max(t,v.borderWidth||0,v.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let n=0,a=e.length;n<a;++n){const o=this.resolveDataElementOptions(n);t=Math.max(t,o.offset||0,o.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let n=0;n<e;++n)this.chart.isDatasetVisible(n)&&(t+=this._getRingWeight(n));return t}_getRingWeight(e){return Math.max(valueOrDefault(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class LineController extends DatasetController{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:a=[],_dataset:o}=t,c=this.chart._animationsDisabled;let{start:u,count:v}=_getStartAndCountOfVisiblePoints(t,a,c);this._drawStart=u,this._drawCount=v,_scaleRangesChanged(t)&&(u=0,v=a.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!o._decimated,n.points=a;const _=this.resolveDatasetElementOptions(e);this.options.showLine||(_.borderWidth=0),_.segment=this.options.segment,this.updateElement(n,void 0,{animated:!c,options:_},e),this.updateElements(a,u,v,e)}updateElements(e,t,n,a){const o=a==="reset",{iScale:c,vScale:u,_stacked:v,_dataset:_}=this._cachedMeta,{sharedOptions:x,includeOptions:E}=this._getSharedOptions(t,a),M=c.axis,C=u.axis,{spanGaps:I,segment:D}=this.options,L=isNumber(I)?I:Number.POSITIVE_INFINITY,N=this.chart._animationsDisabled||o||a==="none",q=t+n,F=e.length;let U=t>0&&this.getParsed(t-1);for(let j=0;j<F;++j){const W=e[j],X=N?W:{};if(j<t||j>=q){X.skip=!0;continue}const J=this.getParsed(j),G=isNullOrUndef(J[C]),oe=X[M]=c.getPixelForValue(J[M],j),O=X[C]=o||G?u.getBasePixel():u.getPixelForValue(v?this.applyStack(u,J,v):J[C],j);X.skip=isNaN(oe)||isNaN(O)||G,X.stop=j>0&&Math.abs(J[M]-U[M])>L,D&&(X.parsed=J,X.raw=_.data[j]),E&&(X.options=x||this.resolveDataElementOptions(j,W.active?"active":a)),N||this.updateElement(W,j,X,a),U=J}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,a=e.data||[];if(!a.length)return n;const o=a[0].size(this.resolveDataElementOptions(0)),c=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(n,o,c)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}class PolarAreaController extends DatasetController{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:a}}=e.legend.options;return t.labels.map((o,c)=>{const v=e.getDatasetMeta(0).controller.getStyle(c);return{text:o,fillStyle:v.backgroundColor,strokeStyle:v.borderColor,fontColor:a,lineWidth:v.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(c),index:c}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,a=n.data.labels||[],o=formatNumber(t._parsed[e].r,n.options.locale);return{label:a[e]||"",value:o}}parseObjectData(e,t,n,a){return _parseObjectDataRadialScale.bind(this)(e,t,n,a)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((n,a)=>{const o=this.getParsed(a).r;!isNaN(o)&&this.chart.getDataVisibility(a)&&(o<t.min&&(t.min=o),o>t.max&&(t.max=o))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,n=e.options,a=Math.min(t.right-t.left,t.bottom-t.top),o=Math.max(a/2,0),c=Math.max(n.cutoutPercentage?o/100*n.cutoutPercentage:1,0),u=(o-c)/e.getVisibleDatasetCount();this.outerRadius=o-u*this.index,this.innerRadius=this.outerRadius-u}updateElements(e,t,n,a){const o=a==="reset",c=this.chart,v=c.options.animation,_=this._cachedMeta.rScale,x=_.xCenter,E=_.yCenter,M=_.getIndexAngle(0)-.5*PI;let C=M,I;const D=360/this.countVisibleElements();for(I=0;I<t;++I)C+=this._computeAngle(I,a,D);for(I=t;I<t+n;I++){const L=e[I];let N=C,q=C+this._computeAngle(I,a,D),F=c.getDataVisibility(I)?_.getDistanceFromCenterForValue(this.getParsed(I).r):0;C=q,o&&(v.animateScale&&(F=0),v.animateRotate&&(N=q=M));const U={x,y:E,innerRadius:0,outerRadius:F,startAngle:N,endAngle:q,options:this.resolveDataElementOptions(I,L.active?"active":a)};this.updateElement(L,I,U,a)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((n,a)=>{!isNaN(this.getParsed(a).r)&&this.chart.getDataVisibility(a)&&t++}),t}_computeAngle(e,t,n){return this.chart.getDataVisibility(e)?toRadians(this.resolveDataElementOptions(e,t).angle||n):0}}class PieController extends DoughnutController{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class RadarController extends DatasetController{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const t=this._cachedMeta.vScale,n=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(n[t.axis])}}parseObjectData(e,t,n,a){return _parseObjectDataRadialScale.bind(this)(e,t,n,a)}update(e){const t=this._cachedMeta,n=t.dataset,a=t.data||[],o=t.iScale.getLabels();if(n.points=a,e!=="resize"){const c=this.resolveDatasetElementOptions(e);this.options.showLine||(c.borderWidth=0);const u={_loop:!0,_fullLoop:o.length===a.length,options:c};this.updateElement(n,void 0,u,e)}this.updateElements(a,0,a.length,e)}updateElements(e,t,n,a){const o=this._cachedMeta.rScale,c=a==="reset";for(let u=t;u<t+n;u++){const v=e[u],_=this.resolveDataElementOptions(u,v.active?"active":a),x=o.getPointPositionForValue(u,this.getParsed(u).r),E=c?o.xCenter:x.x,M=c?o.yCenter:x.y,C={x:E,y:M,angle:x.angle,skip:isNaN(E)||isNaN(M),options:_};this.updateElement(v,u,C,a)}}}class ScatterController extends DatasetController{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:a,yScale:o}=t,c=this.getParsed(e),u=a.getLabelForValue(c.x),v=o.getLabelForValue(c.y);return{label:n[e]||"",value:"("+u+", "+v+")"}}update(e){const t=this._cachedMeta,{data:n=[]}=t,a=this.chart._animationsDisabled;let{start:o,count:c}=_getStartAndCountOfVisiblePoints(t,n,a);if(this._drawStart=o,this._drawCount=c,_scaleRangesChanged(t)&&(o=0,c=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:u,_dataset:v}=t;u._chart=this.chart,u._datasetIndex=this.index,u._decimated=!!v._decimated,u.points=n;const _=this.resolveDatasetElementOptions(e);_.segment=this.options.segment,this.updateElement(u,void 0,{animated:!a,options:_},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(n,o,c,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,n,a){const o=a==="reset",{iScale:c,vScale:u,_stacked:v,_dataset:_}=this._cachedMeta,x=this.resolveDataElementOptions(t,a),E=this.getSharedOptions(x),M=this.includeOptions(a,E),C=c.axis,I=u.axis,{spanGaps:D,segment:L}=this.options,N=isNumber(D)?D:Number.POSITIVE_INFINITY,q=this.chart._animationsDisabled||o||a==="none";let F=t>0&&this.getParsed(t-1);for(let U=t;U<t+n;++U){const j=e[U],W=this.getParsed(U),X=q?j:{},J=isNullOrUndef(W[I]),G=X[C]=c.getPixelForValue(W[C],U),oe=X[I]=o||J?u.getBasePixel():u.getPixelForValue(v?this.applyStack(u,W,v):W[I],U);X.skip=isNaN(G)||isNaN(oe)||J,X.stop=U>0&&Math.abs(W[C]-F[C])>N,L&&(X.parsed=W,X.raw=_.data[U]),M&&(X.options=E||this.resolveDataElementOptions(U,j.active?"active":a)),q||this.updateElement(j,U,X,a),F=W}this.updateSharedOptions(E,a,x)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let u=0;for(let v=t.length-1;v>=0;--v)u=Math.max(u,t[v].size(this.resolveDataElementOptions(v))/2);return u>0&&u}const n=e.dataset,a=n.options&&n.options.borderWidth||0;if(!t.length)return a;const o=t[0].size(this.resolveDataElementOptions(0)),c=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(a,o,c)/2}}var controllers=Object.freeze({__proto__:null,BarController,BubbleController,DoughnutController,LineController,PieController,PolarAreaController,RadarController,ScatterController});function abstract(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class DateAdapterBase{static override(e){Object.assign(DateAdapterBase.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return abstract()}parse(){return abstract()}format(){return abstract()}add(){return abstract()}diff(){return abstract()}startOf(){return abstract()}endOf(){return abstract()}}var adapters={_date:DateAdapterBase};function binarySearch(r,e,t,n){const{controller:a,data:o,_sorted:c}=r,u=a._cachedMeta.iScale;if(u&&e===u.axis&&e!=="r"&&c&&o.length){const v=u._reversePixels?_rlookupByKey:_lookupByKey;if(n){if(a._sharedOptions){const _=o[0],x=typeof _.getRange=="function"&&_.getRange(e);if(x){const E=v(o,e,t-x),M=v(o,e,t+x);return{lo:E.lo,hi:M.hi}}}}else return v(o,e,t)}return{lo:0,hi:o.length-1}}function evaluateInteractionItems(r,e,t,n,a){const o=r.getSortedVisibleDatasetMetas(),c=t[e];for(let u=0,v=o.length;u<v;++u){const{index:_,data:x}=o[u],{lo:E,hi:M}=binarySearch(o[u],e,c,a);for(let C=E;C<=M;++C){const I=x[C];I.skip||n(I,_,C)}}}function getDistanceMetricForAxis(r){const e=r.indexOf("x")!==-1,t=r.indexOf("y")!==-1;return function(n,a){const o=e?Math.abs(n.x-a.x):0,c=t?Math.abs(n.y-a.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(c,2))}}function getIntersectItems(r,e,t,n,a){const o=[];return!a&&!r.isPointInArea(e)||evaluateInteractionItems(r,t,e,function(u,v,_){!a&&!_isPointInArea(u,r.chartArea,0)||u.inRange(e.x,e.y,n)&&o.push({element:u,datasetIndex:v,index:_})},!0),o}function getNearestRadialItems(r,e,t,n){let a=[];function o(c,u,v){const{startAngle:_,endAngle:x}=c.getProps(["startAngle","endAngle"],n),{angle:E}=getAngleFromPoint(c,{x:e.x,y:e.y});_angleBetween(E,_,x)&&a.push({element:c,datasetIndex:u,index:v})}return evaluateInteractionItems(r,t,e,o),a}function getNearestCartesianItems(r,e,t,n,a,o){let c=[];const u=getDistanceMetricForAxis(t);let v=Number.POSITIVE_INFINITY;function _(x,E,M){const C=x.inRange(e.x,e.y,a);if(n&&!C)return;const I=x.getCenterPoint(a);if(!(!!o||r.isPointInArea(I))&&!C)return;const L=u(e,I);L<v?(c=[{element:x,datasetIndex:E,index:M}],v=L):L===v&&c.push({element:x,datasetIndex:E,index:M})}return evaluateInteractionItems(r,t,e,_),c}function getNearestItems(r,e,t,n,a,o){return!o&&!r.isPointInArea(e)?[]:t==="r"&&!n?getNearestRadialItems(r,e,t,a):getNearestCartesianItems(r,e,t,n,a,o)}function getAxisItems(r,e,t,n,a){const o=[],c=t==="x"?"inXRange":"inYRange";let u=!1;return evaluateInteractionItems(r,t,e,(v,_,x)=>{v[c]&&v[c](e[t],a)&&(o.push({element:v,datasetIndex:_,index:x}),u=u||v.inRange(e.x,e.y,a))}),n&&!u?[]:o}var Interaction={modes:{index(r,e,t,n){const a=getRelativePosition(e,r),o=t.axis||"x",c=t.includeInvisible||!1,u=t.intersect?getIntersectItems(r,a,o,n,c):getNearestItems(r,a,o,!1,n,c),v=[];return u.length?(r.getSortedVisibleDatasetMetas().forEach(_=>{const x=u[0].index,E=_.data[x];E&&!E.skip&&v.push({element:E,datasetIndex:_.index,index:x})}),v):[]},dataset(r,e,t,n){const a=getRelativePosition(e,r),o=t.axis||"xy",c=t.includeInvisible||!1;let u=t.intersect?getIntersectItems(r,a,o,n,c):getNearestItems(r,a,o,!1,n,c);if(u.length>0){const v=u[0].datasetIndex,_=r.getDatasetMeta(v).data;u=[];for(let x=0;x<_.length;++x)u.push({element:_[x],datasetIndex:v,index:x})}return u},point(r,e,t,n){const a=getRelativePosition(e,r),o=t.axis||"xy",c=t.includeInvisible||!1;return getIntersectItems(r,a,o,n,c)},nearest(r,e,t,n){const a=getRelativePosition(e,r),o=t.axis||"xy",c=t.includeInvisible||!1;return getNearestItems(r,a,o,t.intersect,n,c)},x(r,e,t,n){const a=getRelativePosition(e,r);return getAxisItems(r,a,"x",t.intersect,n)},y(r,e,t,n){const a=getRelativePosition(e,r);return getAxisItems(r,a,"y",t.intersect,n)}}};const STATIC_POSITIONS=["left","top","right","bottom"];function filterByPosition(r,e){return r.filter(t=>t.pos===e)}function filterDynamicPositionByAxis(r,e){return r.filter(t=>STATIC_POSITIONS.indexOf(t.pos)===-1&&t.box.axis===e)}function sortByWeight(r,e){return r.sort((t,n)=>{const a=e?n:t,o=e?t:n;return a.weight===o.weight?a.index-o.index:a.weight-o.weight})}function wrapBoxes(r){const e=[];let t,n,a,o,c,u;for(t=0,n=(r||[]).length;t<n;++t)a=r[t],{position:o,options:{stack:c,stackWeight:u=1}}=a,e.push({index:t,box:a,pos:o,horizontal:a.isHorizontal(),weight:a.weight,stack:c&&o+c,stackWeight:u});return e}function buildStacks(r){const e={};for(const t of r){const{stack:n,pos:a,stackWeight:o}=t;if(!n||!STATIC_POSITIONS.includes(a))continue;const c=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});c.count++,c.weight+=o}return e}function setLayoutDims(r,e){const t=buildStacks(r),{vBoxMaxWidth:n,hBoxMaxHeight:a}=e;let o,c,u;for(o=0,c=r.length;o<c;++o){u=r[o];const{fullSize:v}=u.box,_=t[u.stack],x=_&&u.stackWeight/_.weight;u.horizontal?(u.width=x?x*n:v&&e.availableWidth,u.height=a):(u.width=n,u.height=x?x*a:v&&e.availableHeight)}return t}function buildLayoutBoxes(r){const e=wrapBoxes(r),t=sortByWeight(e.filter(_=>_.box.fullSize),!0),n=sortByWeight(filterByPosition(e,"left"),!0),a=sortByWeight(filterByPosition(e,"right")),o=sortByWeight(filterByPosition(e,"top"),!0),c=sortByWeight(filterByPosition(e,"bottom")),u=filterDynamicPositionByAxis(e,"x"),v=filterDynamicPositionByAxis(e,"y");return{fullSize:t,leftAndTop:n.concat(o),rightAndBottom:a.concat(v).concat(c).concat(u),chartArea:filterByPosition(e,"chartArea"),vertical:n.concat(a).concat(v),horizontal:o.concat(c).concat(u)}}function getCombinedMax(r,e,t,n){return Math.max(r[t],e[t])+Math.max(r[n],e[n])}function updateMaxPadding(r,e){r.top=Math.max(r.top,e.top),r.left=Math.max(r.left,e.left),r.bottom=Math.max(r.bottom,e.bottom),r.right=Math.max(r.right,e.right)}function updateDims(r,e,t,n){const{pos:a,box:o}=t,c=r.maxPadding;if(!isObject(a)){t.size&&(r[a]-=t.size);const E=n[t.stack]||{size:0,count:1};E.size=Math.max(E.size,t.horizontal?o.height:o.width),t.size=E.size/E.count,r[a]+=t.size}o.getPadding&&updateMaxPadding(c,o.getPadding());const u=Math.max(0,e.outerWidth-getCombinedMax(c,r,"left","right")),v=Math.max(0,e.outerHeight-getCombinedMax(c,r,"top","bottom")),_=u!==r.w,x=v!==r.h;return r.w=u,r.h=v,t.horizontal?{same:_,other:x}:{same:x,other:_}}function handleMaxPadding(r){const e=r.maxPadding;function t(n){const a=Math.max(e[n]-r[n],0);return r[n]+=a,a}r.y+=t("top"),r.x+=t("left"),t("right"),t("bottom")}function getMargins(r,e){const t=e.maxPadding;function n(a){const o={left:0,top:0,right:0,bottom:0};return a.forEach(c=>{o[c]=Math.max(e[c],t[c])}),o}return n(r?["left","right"]:["top","bottom"])}function fitBoxes(r,e,t,n){const a=[];let o,c,u,v,_,x;for(o=0,c=r.length,_=0;o<c;++o){u=r[o],v=u.box,v.update(u.width||e.w,u.height||e.h,getMargins(u.horizontal,e));const{same:E,other:M}=updateDims(e,t,u,n);_|=E&&a.length,x=x||M,v.fullSize||a.push(u)}return _&&fitBoxes(a,e,t,n)||x}function setBoxDims(r,e,t,n,a){r.top=t,r.left=e,r.right=e+n,r.bottom=t+a,r.width=n,r.height=a}function placeBoxes(r,e,t,n){const a=t.padding;let{x:o,y:c}=e;for(const u of r){const v=u.box,_=n[u.stack]||{placed:0,weight:1},x=u.stackWeight/_.weight||1;if(u.horizontal){const E=e.w*x,M=_.size||v.height;defined(_.start)&&(c=_.start),v.fullSize?setBoxDims(v,a.left,c,t.outerWidth-a.right-a.left,M):setBoxDims(v,e.left+_.placed,c,E,M),_.start=c,_.placed+=E,c=v.bottom}else{const E=e.h*x,M=_.size||v.width;defined(_.start)&&(o=_.start),v.fullSize?setBoxDims(v,o,a.top,M,t.outerHeight-a.bottom-a.top):setBoxDims(v,o,e.top+_.placed,M,E),_.start=o,_.placed+=E,o=v.right}}e.x=o,e.y=c}var layouts={addBox(r,e){r.boxes||(r.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},r.boxes.push(e)},removeBox(r,e){const t=r.boxes?r.boxes.indexOf(e):-1;t!==-1&&r.boxes.splice(t,1)},configure(r,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(r,e,t,n){if(!r)return;const a=toPadding(r.options.layout.padding),o=Math.max(e-a.width,0),c=Math.max(t-a.height,0),u=buildLayoutBoxes(r.boxes),v=u.vertical,_=u.horizontal;each(r.boxes,D=>{typeof D.beforeLayout=="function"&&D.beforeLayout()});const x=v.reduce((D,L)=>L.box.options&&L.box.options.display===!1?D:D+1,0)||1,E=Object.freeze({outerWidth:e,outerHeight:t,padding:a,availableWidth:o,availableHeight:c,vBoxMaxWidth:o/2/x,hBoxMaxHeight:c/2}),M=Object.assign({},a);updateMaxPadding(M,toPadding(n));const C=Object.assign({maxPadding:M,w:o,h:c,x:a.left,y:a.top},a),I=setLayoutDims(v.concat(_),E);fitBoxes(u.fullSize,C,E,I),fitBoxes(v,C,E,I),fitBoxes(_,C,E,I)&&fitBoxes(v,C,E,I),handleMaxPadding(C),placeBoxes(u.leftAndTop,C,E,I),C.x+=C.w,C.y+=C.h,placeBoxes(u.rightAndBottom,C,E,I),r.chartArea={left:C.left,top:C.top,right:C.left+C.w,bottom:C.top+C.h,height:C.h,width:C.w},each(u.chartArea,D=>{const L=D.box;Object.assign(L,r.chartArea),L.update(C.w,C.h,{left:0,top:0,right:0,bottom:0})})}};class BasePlatform{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,a){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,a?Math.floor(t/a):n)}}isAttached(e){return!0}updateConfig(e){}}class BasicPlatform extends BasePlatform{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const EXPANDO_KEY="$chartjs",EVENT_TYPES={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},isNullOrEmpty=r=>r===null||r==="";function initCanvas(r,e){const t=r.style,n=r.getAttribute("height"),a=r.getAttribute("width");if(r[EXPANDO_KEY]={initial:{height:n,width:a,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",isNullOrEmpty(a)){const o=readUsedSize(r,"width");o!==void 0&&(r.width=o)}if(isNullOrEmpty(n))if(r.style.height==="")r.height=r.width/(e||2);else{const o=readUsedSize(r,"height");o!==void 0&&(r.height=o)}return r}const eventListenerOptions=supportsEventListenerOptions?{passive:!0}:!1;function addListener(r,e,t){r&&r.addEventListener(e,t,eventListenerOptions)}function removeListener(r,e,t){r&&r.canvas&&r.canvas.removeEventListener(e,t,eventListenerOptions)}function fromNativeEvent(r,e){const t=EVENT_TYPES[r.type]||r.type,{x:n,y:a}=getRelativePosition(r,e);return{type:t,chart:e,native:r,x:n!==void 0?n:null,y:a!==void 0?a:null}}function nodeListContains(r,e){for(const t of r)if(t===e||t.contains(e))return!0}function createAttachObserver(r,e,t){const n=r.canvas,a=new MutationObserver(o=>{let c=!1;for(const u of o)c=c||nodeListContains(u.addedNodes,n),c=c&&!nodeListContains(u.removedNodes,n);c&&t()});return a.observe(document,{childList:!0,subtree:!0}),a}function createDetachObserver(r,e,t){const n=r.canvas,a=new MutationObserver(o=>{let c=!1;for(const u of o)c=c||nodeListContains(u.removedNodes,n),c=c&&!nodeListContains(u.addedNodes,n);c&&t()});return a.observe(document,{childList:!0,subtree:!0}),a}const drpListeningCharts=new Map;let oldDevicePixelRatio=0;function onWindowResize(){const r=window.devicePixelRatio;r!==oldDevicePixelRatio&&(oldDevicePixelRatio=r,drpListeningCharts.forEach((e,t)=>{t.currentDevicePixelRatio!==r&&e()}))}function listenDevicePixelRatioChanges(r,e){drpListeningCharts.size||window.addEventListener("resize",onWindowResize),drpListeningCharts.set(r,e)}function unlistenDevicePixelRatioChanges(r){drpListeningCharts.delete(r),drpListeningCharts.size||window.removeEventListener("resize",onWindowResize)}function createResizeObserver(r,e,t){const n=r.canvas,a=n&&_getParentNode(n);if(!a)return;const o=throttled((u,v)=>{const _=a.clientWidth;t(u,v),_<a.clientWidth&&t()},window),c=new ResizeObserver(u=>{const v=u[0],_=v.contentRect.width,x=v.contentRect.height;_===0&&x===0||o(_,x)});return c.observe(a),listenDevicePixelRatioChanges(r,o),c}function releaseObserver(r,e,t){t&&t.disconnect(),e==="resize"&&unlistenDevicePixelRatioChanges(r)}function createProxyAndListen(r,e,t){const n=r.canvas,a=throttled(o=>{r.ctx!==null&&t(fromNativeEvent(o,r))},r);return addListener(n,e,a),a}class DomPlatform extends BasePlatform{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(initCanvas(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[EXPANDO_KEY])return!1;const n=t[EXPANDO_KEY].initial;["height","width"].forEach(o=>{const c=n[o];isNullOrUndef(c)?t.removeAttribute(o):t.setAttribute(o,c)});const a=n.style||{};return Object.keys(a).forEach(o=>{t.style[o]=a[o]}),t.width=t.width,delete t[EXPANDO_KEY],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const a=e.$proxies||(e.$proxies={}),c={attach:createAttachObserver,detach:createDetachObserver,resize:createResizeObserver}[t]||createProxyAndListen;a[t]=c(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),a=n[t];if(!a)return;({attach:releaseObserver,detach:releaseObserver,resize:releaseObserver}[t]||removeListener)(e,t,a),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,a){return getMaximumSize(e,t,n,a)}isAttached(e){const t=e&&_getParentNode(e);return!!(t&&t.isConnected)}}function _detectPlatform(r){return!_isDomSupported()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?BasicPlatform:DomPlatform}class Element{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return isNumber(this.x)&&isNumber(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const a={};return e.forEach(o=>{a[o]=n[o]&&n[o].active()?n[o]._to:this[o]}),a}}function autoSkip(r,e){const t=r.options.ticks,n=determineMaxTicks(r),a=Math.min(t.maxTicksLimit||n,n),o=t.major.enabled?getMajorIndices(e):[],c=o.length,u=o[0],v=o[c-1],_=[];if(c>a)return skipMajors(e,_,o,c/a),_;const x=calculateSpacing(o,e,a);if(c>0){let E,M;const C=c>1?Math.round((v-u)/(c-1)):null;for(skip(e,_,x,isNullOrUndef(C)?0:u-C,u),E=0,M=c-1;E<M;E++)skip(e,_,x,o[E],o[E+1]);return skip(e,_,x,v,isNullOrUndef(C)?e.length:v+C),_}return skip(e,_,x),_}function determineMaxTicks(r){const e=r.options.offset,t=r._tickSize(),n=r._length/t+(e?0:1),a=r._maxLength/t;return Math.floor(Math.min(n,a))}function calculateSpacing(r,e,t){const n=getEvenSpacing(r),a=e.length/t;if(!n)return Math.max(a,1);const o=_factorize(n);for(let c=0,u=o.length-1;c<u;c++){const v=o[c];if(v>a)return v}return Math.max(a,1)}function getMajorIndices(r){const e=[];let t,n;for(t=0,n=r.length;t<n;t++)r[t].major&&e.push(t);return e}function skipMajors(r,e,t,n){let a=0,o=t[0],c;for(n=Math.ceil(n),c=0;c<r.length;c++)c===o&&(e.push(r[c]),a++,o=t[a*n])}function skip(r,e,t,n,a){const o=valueOrDefault(n,0),c=Math.min(valueOrDefault(a,r.length),r.length);let u=0,v,_,x;for(t=Math.ceil(t),a&&(v=a-n,t=v/Math.floor(v/t)),x=o;x<0;)u++,x=Math.round(o+u*t);for(_=Math.max(o,0);_<c;_++)_===x&&(e.push(r[_]),u++,x=Math.round(o+u*t))}function getEvenSpacing(r){const e=r.length;let t,n;if(e<2)return!1;for(n=r[0],t=1;t<e;++t)if(r[t]-r[t-1]!==n)return!1;return n}const reverseAlign=r=>r==="left"?"right":r==="right"?"left":r,offsetFromEdge=(r,e,t)=>e==="top"||e==="left"?r[e]+t:r[e]-t,getTicksLimit=(r,e)=>Math.min(e||r,r);function sample(r,e){const t=[],n=r.length/e,a=r.length;let o=0;for(;o<a;o+=n)t.push(r[Math.floor(o)]);return t}function getPixelForGridLine(r,e,t){const n=r.ticks.length,a=Math.min(e,n-1),o=r._startPixel,c=r._endPixel,u=1e-6;let v=r.getPixelForTick(a),_;if(!(t&&(n===1?_=Math.max(v-o,c-v):e===0?_=(r.getPixelForTick(1)-v)/2:_=(v-r.getPixelForTick(a-1))/2,v+=a<e?_:-_,v<o-u||v>c+u)))return v}function garbageCollect(r,e){each(r,t=>{const n=t.gc,a=n.length/2;let o;if(a>e){for(o=0;o<a;++o)delete t.data[n[o]];n.splice(0,a)}})}function getTickMarkLength(r){return r.drawTicks?r.tickLength:0}function getTitleHeight(r,e){if(!r.display)return 0;const t=toFont(r.font,e),n=toPadding(r.padding);return(isArray(r.text)?r.text.length:1)*t.lineHeight+n.height}function createScaleContext(r,e){return createContext(r,{scale:e,type:"scale"})}function createTickContext(r,e,t){return createContext(r,{tick:t,index:e,type:"tick"})}function titleAlign(r,e,t){let n=_toLeftRightCenter(r);return(t&&e!=="right"||!t&&e==="right")&&(n=reverseAlign(n)),n}function titleArgs(r,e,t,n){const{top:a,left:o,bottom:c,right:u,chart:v}=r,{chartArea:_,scales:x}=v;let E=0,M,C,I;const D=c-a,L=u-o;if(r.isHorizontal()){if(C=_alignStartEnd(n,o,u),isObject(t)){const N=Object.keys(t)[0],q=t[N];I=x[N].getPixelForValue(q)+D-e}else t==="center"?I=(_.bottom+_.top)/2+D-e:I=offsetFromEdge(r,t,e);M=u-o}else{if(isObject(t)){const N=Object.keys(t)[0],q=t[N];C=x[N].getPixelForValue(q)-L+e}else t==="center"?C=(_.left+_.right)/2-L+e:C=offsetFromEdge(r,t,e);I=_alignStartEnd(n,c,a),E=t==="left"?-HALF_PI:HALF_PI}return{titleX:C,titleY:I,maxWidth:M,rotation:E}}class Scale extends Element{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:a}=this;return e=finiteOrDefault(e,Number.POSITIVE_INFINITY),t=finiteOrDefault(t,Number.NEGATIVE_INFINITY),n=finiteOrDefault(n,Number.POSITIVE_INFINITY),a=finiteOrDefault(a,Number.NEGATIVE_INFINITY),{min:finiteOrDefault(e,n),max:finiteOrDefault(t,a),minDefined:isNumberFinite(e),maxDefined:isNumberFinite(t)}}getMinMax(e){let{min:t,max:n,minDefined:a,maxDefined:o}=this.getUserBounds(),c;if(a&&o)return{min:t,max:n};const u=this.getMatchingVisibleMetas();for(let v=0,_=u.length;v<_;++v)c=u[v].controller.getMinMax(this,e),a||(t=Math.min(t,c.min)),o||(n=Math.max(n,c.max));return t=o&&t>n?n:t,n=a&&t>n?t:n,{min:finiteOrDefault(t,finiteOrDefault(n,t)),max:finiteOrDefault(n,finiteOrDefault(t,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){callback(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:a,grace:o,ticks:c}=this.options,u=c.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=_addGrace(this,o,a),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const v=u<this.ticks.length;this._convertTicksToLabels(v?sample(this.ticks,u):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),c.display&&(c.autoSkip||c.source==="auto")&&(this.ticks=autoSkip(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),v&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,n;this.isHorizontal()?(t=this.left,n=this.right):(t=this.top,n=this.bottom,e=!e),this._startPixel=t,this._endPixel=n,this._reversePixels=e,this._length=n-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){callback(this.options.afterUpdate,[this])}beforeSetDimensions(){callback(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){callback(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),callback(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){callback(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,a,o;for(n=0,a=e.length;n<a;n++)o=e[n],o.label=callback(t.callback,[o.value,n,e],this)}afterTickToLabelConversion(){callback(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){callback(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=getTicksLimit(this.ticks.length,e.ticks.maxTicksLimit),a=t.minRotation||0,o=t.maxRotation;let c=a,u,v,_;if(!this._isVisible()||!t.display||a>=o||n<=1||!this.isHorizontal()){this.labelRotation=a;return}const x=this._getLabelSizes(),E=x.widest.width,M=x.highest.height,C=_limitValue(this.chart.width-E,0,this.maxWidth);u=e.offset?this.maxWidth/n:C/(n-1),E+6>u&&(u=C/(n-(e.offset?.5:1)),v=this.maxHeight-getTickMarkLength(e.grid)-t.padding-getTitleHeight(e.title,this.chart.options.font),_=Math.sqrt(E*E+M*M),c=toDegrees(Math.min(Math.asin(_limitValue((x.highest.height+6)/u,-1,1)),Math.asin(_limitValue(v/_,-1,1))-Math.asin(_limitValue(M/_,-1,1)))),c=Math.max(a,Math.min(o,c))),this.labelRotation=c}afterCalculateLabelRotation(){callback(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){callback(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:a,grid:o}}=this,c=this._isVisible(),u=this.isHorizontal();if(c){const v=getTitleHeight(a,t.options.font);if(u?(e.width=this.maxWidth,e.height=getTickMarkLength(o)+v):(e.height=this.maxHeight,e.width=getTickMarkLength(o)+v),n.display&&this.ticks.length){const{first:_,last:x,widest:E,highest:M}=this._getLabelSizes(),C=n.padding*2,I=toRadians(this.labelRotation),D=Math.cos(I),L=Math.sin(I);if(u){const N=n.mirror?0:L*E.width+D*M.height;e.height=Math.min(this.maxHeight,e.height+N+C)}else{const N=n.mirror?0:D*E.width+L*M.height;e.width=Math.min(this.maxWidth,e.width+N+C)}this._calculatePadding(_,x,L,D)}}this._handleMargins(),u?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,a){const{ticks:{align:o,padding:c},position:u}=this.options,v=this.labelRotation!==0,_=u!=="top"&&this.axis==="x";if(this.isHorizontal()){const x=this.getPixelForTick(0)-this.left,E=this.right-this.getPixelForTick(this.ticks.length-1);let M=0,C=0;v?_?(M=a*e.width,C=n*t.height):(M=n*e.height,C=a*t.width):o==="start"?C=t.width:o==="end"?M=e.width:o!=="inner"&&(M=e.width/2,C=t.width/2),this.paddingLeft=Math.max((M-x+c)*this.width/(this.width-x),0),this.paddingRight=Math.max((C-E+c)*this.width/(this.width-E),0)}else{let x=t.height/2,E=e.height/2;o==="start"?(x=0,E=e.height):o==="end"&&(x=t.height,E=0),this.paddingTop=x+c,this.paddingBottom=E+c}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){callback(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,n;for(t=0,n=e.length;t<n;t++)isNullOrUndef(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=sample(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:a,_longestTextCache:o}=this,c=[],u=[],v=Math.floor(t/getTicksLimit(t,n));let _=0,x=0,E,M,C,I,D,L,N,q,F,U,j;for(E=0;E<t;E+=v){if(I=e[E].label,D=this._resolveTickFontOptions(E),a.font=L=D.string,N=o[L]=o[L]||{data:{},gc:[]},q=D.lineHeight,F=U=0,!isNullOrUndef(I)&&!isArray(I))F=_measureText(a,N.data,N.gc,F,I),U=q;else if(isArray(I))for(M=0,C=I.length;M<C;++M)j=I[M],!isNullOrUndef(j)&&!isArray(j)&&(F=_measureText(a,N.data,N.gc,F,j),U+=q);c.push(F),u.push(U),_=Math.max(F,_),x=Math.max(U,x)}garbageCollect(o,t);const W=c.indexOf(_),X=u.indexOf(x),J=G=>({width:c[G]||0,height:u[G]||0});return{first:J(0),last:J(t-1),widest:J(W),highest:J(X),widths:c,heights:u}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return _int16Range(this._alignToPixels?_alignPixel(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=createTickContext(this.getContext(),e,n))}return this.$context||(this.$context=createScaleContext(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=toRadians(this.labelRotation),n=Math.abs(Math.cos(t)),a=Math.abs(Math.sin(t)),o=this._getLabelSizes(),c=e.autoSkipPadding||0,u=o?o.widest.width+c:0,v=o?o.highest.height+c:0;return this.isHorizontal()?v*n>u*a?u/n:v/a:v*a<u*n?v/n:u/a}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,a=this.options,{grid:o,position:c,border:u}=a,v=o.offset,_=this.isHorizontal(),E=this.ticks.length+(v?1:0),M=getTickMarkLength(o),C=[],I=u.setContext(this.getContext()),D=I.display?I.width:0,L=D/2,N=function(T){return _alignPixel(n,T,D)};let q,F,U,j,W,X,J,G,oe,O,l,p;if(c==="top")q=N(this.bottom),X=this.bottom-M,G=q-L,O=N(e.top)+L,p=e.bottom;else if(c==="bottom")q=N(this.top),O=e.top,p=N(e.bottom)-L,X=q+L,G=this.top+M;else if(c==="left")q=N(this.right),W=this.right-M,J=q-L,oe=N(e.left)+L,l=e.right;else if(c==="right")q=N(this.left),oe=e.left,l=N(e.right)-L,W=q+L,J=this.left+M;else if(t==="x"){if(c==="center")q=N((e.top+e.bottom)/2+.5);else if(isObject(c)){const T=Object.keys(c)[0],B=c[T];q=N(this.chart.scales[T].getPixelForValue(B))}O=e.top,p=e.bottom,X=q+L,G=X+M}else if(t==="y"){if(c==="center")q=N((e.left+e.right)/2);else if(isObject(c)){const T=Object.keys(c)[0],B=c[T];q=N(this.chart.scales[T].getPixelForValue(B))}W=q-L,J=W-M,oe=e.left,l=e.right}const b=valueOrDefault(a.ticks.maxTicksLimit,E),S=Math.max(1,Math.ceil(E/b));for(F=0;F<E;F+=S){const T=this.getContext(F),B=o.setContext(T),$=u.setContext(T),A=B.lineWidth,g=B.color,k=$.dash||[],H=$.dashOffset,z=B.tickWidth,Q=B.tickColor,ie=B.tickBorderDash||[],ne=B.tickBorderDashOffset;U=getPixelForGridLine(this,F,v),U!==void 0&&(j=_alignPixel(n,U,A),_?W=J=oe=l=j:X=G=O=p=j,C.push({tx1:W,ty1:X,tx2:J,ty2:G,x1:oe,y1:O,x2:l,y2:p,width:A,color:g,borderDash:k,borderDashOffset:H,tickWidth:z,tickColor:Q,tickBorderDash:ie,tickBorderDashOffset:ne}))}return this._ticksLength=E,this._borderValue=q,C}_computeLabelItems(e){const t=this.axis,n=this.options,{position:a,ticks:o}=n,c=this.isHorizontal(),u=this.ticks,{align:v,crossAlign:_,padding:x,mirror:E}=o,M=getTickMarkLength(n.grid),C=M+x,I=E?-x:C,D=-toRadians(this.labelRotation),L=[];let N,q,F,U,j,W,X,J,G,oe,O,l,p="middle";if(a==="top")W=this.bottom-I,X=this._getXAxisLabelAlignment();else if(a==="bottom")W=this.top+I,X=this._getXAxisLabelAlignment();else if(a==="left"){const S=this._getYAxisLabelAlignment(M);X=S.textAlign,j=S.x}else if(a==="right"){const S=this._getYAxisLabelAlignment(M);X=S.textAlign,j=S.x}else if(t==="x"){if(a==="center")W=(e.top+e.bottom)/2+C;else if(isObject(a)){const S=Object.keys(a)[0],T=a[S];W=this.chart.scales[S].getPixelForValue(T)+C}X=this._getXAxisLabelAlignment()}else if(t==="y"){if(a==="center")j=(e.left+e.right)/2-C;else if(isObject(a)){const S=Object.keys(a)[0],T=a[S];j=this.chart.scales[S].getPixelForValue(T)}X=this._getYAxisLabelAlignment(M).textAlign}t==="y"&&(v==="start"?p="top":v==="end"&&(p="bottom"));const b=this._getLabelSizes();for(N=0,q=u.length;N<q;++N){F=u[N],U=F.label;const S=o.setContext(this.getContext(N));J=this.getPixelForTick(N)+o.labelOffset,G=this._resolveTickFontOptions(N),oe=G.lineHeight,O=isArray(U)?U.length:1;const T=O/2,B=S.color,$=S.textStrokeColor,A=S.textStrokeWidth;let g=X;c?(j=J,X==="inner"&&(N===q-1?g=this.options.reverse?"left":"right":N===0?g=this.options.reverse?"right":"left":g="center"),a==="top"?_==="near"||D!==0?l=-O*oe+oe/2:_==="center"?l=-b.highest.height/2-T*oe+oe:l=-b.highest.height+oe/2:_==="near"||D!==0?l=oe/2:_==="center"?l=b.highest.height/2-T*oe:l=b.highest.height-O*oe,E&&(l*=-1),D!==0&&!S.showLabelBackdrop&&(j+=oe/2*Math.sin(D))):(W=J,l=(1-O)*oe/2);let k;if(S.showLabelBackdrop){const H=toPadding(S.backdropPadding),z=b.heights[N],Q=b.widths[N];let ie=l-H.top,ne=0-H.left;switch(p){case"middle":ie-=z/2;break;case"bottom":ie-=z;break}switch(X){case"center":ne-=Q/2;break;case"right":ne-=Q;break;case"inner":N===q-1?ne-=Q:N>0&&(ne-=Q/2);break}k={left:ne,top:ie,width:Q+H.width,height:z+H.height,color:S.backdropColor}}L.push({label:U,font:G,textOffset:l,options:{rotation:D,color:B,strokeColor:$,strokeWidth:A,textAlign:g,textBaseline:p,translation:[j,W],backdrop:k}})}return L}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-toRadians(this.labelRotation))return e==="top"?"left":"right";let a="center";return t.align==="start"?a="left":t.align==="end"?a="right":t.align==="inner"&&(a="inner"),a}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:a,padding:o}}=this.options,c=this._getLabelSizes(),u=e+o,v=c.widest.width;let _,x;return t==="left"?a?(x=this.right+o,n==="near"?_="left":n==="center"?(_="center",x+=v/2):(_="right",x+=v)):(x=this.right-u,n==="near"?_="right":n==="center"?(_="center",x-=v/2):(_="left",x=this.left)):t==="right"?a?(x=this.left+o,n==="near"?_="right":n==="center"?(_="center",x-=v/2):(_="left",x-=v)):(x=this.left+u,n==="near"?_="left":n==="center"?(_="center",x+=v/2):(_="right",x=this.right)):_="right",{textAlign:_,x}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:a,width:o,height:c}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,a,o,c),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const a=this.ticks.findIndex(o=>o.value===e);return a>=0?t.setContext(this.getContext(a)).lineWidth:0}drawGrid(e){const t=this.options.grid,n=this.ctx,a=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let o,c;const u=(v,_,x)=>{!x.width||!x.color||(n.save(),n.lineWidth=x.width,n.strokeStyle=x.color,n.setLineDash(x.borderDash||[]),n.lineDashOffset=x.borderDashOffset,n.beginPath(),n.moveTo(v.x,v.y),n.lineTo(_.x,_.y),n.stroke(),n.restore())};if(t.display)for(o=0,c=a.length;o<c;++o){const v=a[o];t.drawOnChartArea&&u({x:v.x1,y:v.y1},{x:v.x2,y:v.y2},v),t.drawTicks&&u({x:v.tx1,y:v.ty1},{x:v.tx2,y:v.ty2},{color:v.tickColor,width:v.tickWidth,borderDash:v.tickBorderDash,borderDashOffset:v.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:a}}=this,o=n.setContext(this.getContext()),c=n.display?o.width:0;if(!c)return;const u=a.setContext(this.getContext(0)).lineWidth,v=this._borderValue;let _,x,E,M;this.isHorizontal()?(_=_alignPixel(e,this.left,c)-c/2,x=_alignPixel(e,this.right,u)+u/2,E=M=v):(E=_alignPixel(e,this.top,c)-c/2,M=_alignPixel(e,this.bottom,u)+u/2,_=x=v),t.save(),t.lineWidth=o.width,t.strokeStyle=o.color,t.beginPath(),t.moveTo(_,E),t.lineTo(x,M),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const n=this.ctx,a=this._computeLabelArea();a&&clipArea(n,a);const o=this.getLabelItems(e);for(const c of o){const u=c.options,v=c.font,_=c.label,x=c.textOffset;renderText(n,_,0,x,v,u)}a&&unclipArea(n)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:a}}=this;if(!n.display)return;const o=toFont(n.font),c=toPadding(n.padding),u=n.align;let v=o.lineHeight/2;t==="bottom"||t==="center"||isObject(t)?(v+=c.bottom,isArray(n.text)&&(v+=o.lineHeight*(n.text.length-1))):v+=c.top;const{titleX:_,titleY:x,maxWidth:E,rotation:M}=titleArgs(this,v,t,u);renderText(e,n.text,0,0,o,{color:n.color,maxWidth:E,rotation:M,textAlign:titleAlign(u,t,a),textBaseline:"middle",translation:[_,x]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=valueOrDefault(e.grid&&e.grid.z,-1),a=valueOrDefault(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Scale.prototype.draw?[{z:t,draw:o=>{this.draw(o)}}]:[{z:n,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:a,draw:()=>{this.drawBorder()}},{z:t,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",a=[];let o,c;for(o=0,c=t.length;o<c;++o){const u=t[o];u[n]===this.id&&(!e||u.type===e)&&a.push(u)}return a}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return toFont(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class TypedRegistry{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;isIChartComponent(t)&&(n=this.register(t));const a=this.items,o=e.id,c=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+e);return o in a||(a[o]=e,registerDefaults(e,c,n),this.override&&defaults.override(e.id,e.overrides)),c}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,a=this.scope;n in t&&delete t[n],a&&n in defaults[a]&&(delete defaults[a][n],this.override&&delete overrides[n])}}function registerDefaults(r,e,t){const n=merge(Object.create(null),[t?defaults.get(t):{},defaults.get(e),r.defaults]);defaults.set(e,n),r.defaultRoutes&&routeDefaults(e,r.defaultRoutes),r.descriptors&&defaults.describe(e,r.descriptors)}function routeDefaults(r,e){Object.keys(e).forEach(t=>{const n=t.split("."),a=n.pop(),o=[r].concat(n).join("."),c=e[t].split("."),u=c.pop(),v=c.join(".");defaults.route(o,a,v,u)})}function isIChartComponent(r){return"id"in r&&"defaults"in r}class Registry{constructor(){this.controllers=new TypedRegistry(DatasetController,"datasets",!0),this.elements=new TypedRegistry(Element,"elements"),this.plugins=new TypedRegistry(Object,"plugins"),this.scales=new TypedRegistry(Scale,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,n){[...t].forEach(a=>{const o=n||this._getRegistryForType(a);n||o.isForType(a)||o===this.plugins&&a.id?this._exec(e,o,a):each(a,c=>{const u=n||this._getRegistryForType(c);this._exec(e,u,c)})})}_exec(e,t,n){const a=_capitalize(e);callback(n["before"+a],[],n),t[e](n),callback(n["after"+a],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const a=t.get(e);if(a===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return a}}var registry=new Registry;class PluginService{constructor(){this._init=[]}notify(e,t,n,a){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const o=a?this._descriptors(e).filter(a):this._descriptors(e),c=this._notify(o,e,t,n);return t==="afterDestroy"&&(this._notify(o,e,"stop"),this._notify(this._init,e,"uninstall")),c}_notify(e,t,n,a){a=a||{};for(const o of e){const c=o.plugin,u=c[n],v=[t,a,o.options];if(callback(u,v,c)===!1&&a.cancelable)return!1}return!0}invalidate(){isNullOrUndef(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,a=valueOrDefault(n.options&&n.options.plugins,{}),o=allPlugins(n);return a===!1&&!t?[]:createDescriptors(e,o,a,t)}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,a=(o,c)=>o.filter(u=>!c.some(v=>u.plugin.id===v.plugin.id));this._notify(a(t,n),e,"stop"),this._notify(a(n,t),e,"start")}}function allPlugins(r){const e={},t=[],n=Object.keys(registry.plugins.items);for(let o=0;o<n.length;o++)t.push(registry.getPlugin(n[o]));const a=r.plugins||[];for(let o=0;o<a.length;o++){const c=a[o];t.indexOf(c)===-1&&(t.push(c),e[c.id]=!0)}return{plugins:t,localIds:e}}function getOpts(r,e){return!e&&r===!1?null:r===!0?{}:r}function createDescriptors(r,{plugins:e,localIds:t},n,a){const o=[],c=r.getContext();for(const u of e){const v=u.id,_=getOpts(n[v],a);_!==null&&o.push({plugin:u,options:pluginOpts(r.config,{plugin:u,local:t[v]},_,c)})}return o}function pluginOpts(r,{plugin:e,local:t},n,a){const o=r.pluginScopeKeys(e),c=r.getOptionScopes(n,o);return t&&e.defaults&&c.push(e.defaults),r.createResolver(c,a,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function getIndexAxis(r,e){const t=defaults.datasets[r]||{};return((e.datasets||{})[r]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function getAxisFromDefaultScaleID(r,e){let t=r;return r==="_index_"?t=e:r==="_value_"&&(t=e==="x"?"y":"x"),t}function getDefaultScaleIDFromAxis(r,e){return r===e?"_index_":"_value_"}function idMatchesAxis(r){if(r==="x"||r==="y"||r==="r")return r}function axisFromPosition(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function determineAxis(r,...e){if(idMatchesAxis(r))return r;for(const t of e){const n=t.axis||axisFromPosition(t.position)||r.length>1&&idMatchesAxis(r[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function getAxisFromDataset(r,e,t){if(t[e+"AxisID"]===r)return{axis:e}}function retrieveAxisFromDatasets(r,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(n=>n.xAxisID===r||n.yAxisID===r);if(t.length)return getAxisFromDataset(r,"x",t[0])||getAxisFromDataset(r,"y",t[0])}return{}}function mergeScaleConfig(r,e){const t=overrides[r.type]||{scales:{}},n=e.scales||{},a=getIndexAxis(r.type,e),o=Object.create(null);return Object.keys(n).forEach(c=>{const u=n[c];if(!isObject(u))return console.error(`Invalid scale configuration for scale: ${c}`);if(u._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${c}`);const v=determineAxis(c,u,retrieveAxisFromDatasets(c,r),defaults.scales[u.type]),_=getDefaultScaleIDFromAxis(v,a),x=t.scales||{};o[c]=mergeIf(Object.create(null),[{axis:v},u,x[v],x[_]])}),r.data.datasets.forEach(c=>{const u=c.type||r.type,v=c.indexAxis||getIndexAxis(u,e),x=(overrides[u]||{}).scales||{};Object.keys(x).forEach(E=>{const M=getAxisFromDefaultScaleID(E,v),C=c[M+"AxisID"]||M;o[C]=o[C]||Object.create(null),mergeIf(o[C],[{axis:M},n[C],x[E]])})}),Object.keys(o).forEach(c=>{const u=o[c];mergeIf(u,[defaults.scales[u.type],defaults.scale])}),o}function initOptions(r){const e=r.options||(r.options={});e.plugins=valueOrDefault(e.plugins,{}),e.scales=mergeScaleConfig(r,e)}function initData(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function initConfig(r){return r=r||{},r.data=initData(r.data),initOptions(r),r}const keyCache=new Map,keysCached=new Set;function cachedKeys(r,e){let t=keyCache.get(r);return t||(t=e(),keyCache.set(r,t),keysCached.add(t)),t}const addIfFound=(r,e,t)=>{const n=resolveObjectKey(e,t);n!==void 0&&r.add(n)};class Config{constructor(e){this._config=initConfig(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=initData(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),initOptions(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return cachedKeys(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return cachedKeys(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return cachedKeys(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return cachedKeys(`${n}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let a=n.get(e);return(!a||t)&&(a=new Map,n.set(e,a)),a}getOptionScopes(e,t,n){const{options:a,type:o}=this,c=this._cachedScopes(e,n),u=c.get(t);if(u)return u;const v=new Set;t.forEach(x=>{e&&(v.add(e),x.forEach(E=>addIfFound(v,e,E))),x.forEach(E=>addIfFound(v,a,E)),x.forEach(E=>addIfFound(v,overrides[o]||{},E)),x.forEach(E=>addIfFound(v,defaults,E)),x.forEach(E=>addIfFound(v,descriptors,E))});const _=Array.from(v);return _.length===0&&_.push(Object.create(null)),keysCached.has(t)&&c.set(t,_),_}chartOptionScopes(){const{options:e,type:t}=this;return[e,overrides[t]||{},defaults.datasets[t]||{},{type:t},defaults,descriptors]}resolveNamedOptions(e,t,n,a=[""]){const o={$shared:!0},{resolver:c,subPrefixes:u}=getResolver(this._resolverCache,e,a);let v=c;if(needContext(c,t)){o.$shared=!1,n=isFunction(n)?n():n;const _=this.createResolver(e,n,u);v=_attachContext(c,n,_)}for(const _ of t)o[_]=v[_];return o}createResolver(e,t,n=[""],a){const{resolver:o}=getResolver(this._resolverCache,e,n);return isObject(t)?_attachContext(o,t,void 0,a):o}}function getResolver(r,e,t){let n=r.get(e);n||(n=new Map,r.set(e,n));const a=t.join();let o=n.get(a);return o||(o={resolver:_createResolver(e,t),subPrefixes:t.filter(u=>!u.toLowerCase().includes("hover"))},n.set(a,o)),o}const hasFunction=r=>isObject(r)&&Object.getOwnPropertyNames(r).some(e=>isFunction(r[e]));function needContext(r,e){const{isScriptable:t,isIndexable:n}=_descriptors(r);for(const a of e){const o=t(a),c=n(a),u=(c||o)&&r[a];if(o&&(isFunction(u)||hasFunction(u))||c&&isArray(u))return!0}return!1}var version="4.4.7";const KNOWN_POSITIONS=["top","bottom","left","right","chartArea"];function positionIsHorizontal(r,e){return r==="top"||r==="bottom"||KNOWN_POSITIONS.indexOf(r)===-1&&e==="x"}function compare2Level(r,e){return function(t,n){return t[r]===n[r]?t[e]-n[e]:t[r]-n[r]}}function onAnimationsComplete(r){const e=r.chart,t=e.options.animation;e.notifyPlugins("afterRender"),callback(t&&t.onComplete,[r],e)}function onAnimationProgress(r){const e=r.chart,t=e.options.animation;callback(t&&t.onProgress,[r],e)}function getCanvas(r){return _isDomSupported()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}const instances={},getChart=r=>{const e=getCanvas(r);return Object.values(instances).filter(t=>t.canvas===e).pop()};function moveNumericKeys(r,e,t){const n=Object.keys(r);for(const a of n){const o=+a;if(o>=e){const c=r[a];delete r[a],(t>0||o>e)&&(r[o+t]=c)}}}function determineLastEvent(r,e,t,n){return!t||r.type==="mouseout"?null:n?e:r}function getSizeForArea(r,e,t){return r.options.clip?r[t]:e[t]}function getDatasetArea(r,e){const{xScale:t,yScale:n}=r;return t&&n?{left:getSizeForArea(t,e,"left"),right:getSizeForArea(t,e,"right"),top:getSizeForArea(n,e,"top"),bottom:getSizeForArea(n,e,"bottom")}:e}class Chart{static defaults=defaults;static instances=instances;static overrides=overrides;static registry=registry;static version=version;static getChart=getChart;static register(...e){registry.add(...e),invalidatePlugins()}static unregister(...e){registry.remove(...e),invalidatePlugins()}constructor(e,t){const n=this.config=new Config(t),a=getCanvas(e),o=getChart(a);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const c=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||_detectPlatform(a)),this.platform.updateConfig(n);const u=this.platform.acquireContext(a,c.aspectRatio),v=u&&u.canvas,_=v&&v.height,x=v&&v.width;if(this.id=uid(),this.ctx=u,this.canvas=v,this.width=x,this.height=_,this._options=c,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new PluginService,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=debounce(E=>this.update(E),c.resizeDelay||0),this._dataChanges=[],instances[this.id]=this,!u||!v){console.error("Failed to create chart: can't acquire context from the given item");return}animator.listen(this,"complete",onAnimationsComplete),animator.listen(this,"progress",onAnimationProgress),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:a,_aspectRatio:o}=this;return isNullOrUndef(e)?t&&o?o:a?n/a:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return registry}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():retinaScale(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return clearCanvas(this.canvas,this.ctx),this}stop(){return animator.stop(this),this}resize(e,t){animator.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,a=this.canvas,o=n.maintainAspectRatio&&this.aspectRatio,c=this.platform.getMaximumSize(a,e,t,o),u=n.devicePixelRatio||this.platform.getDevicePixelRatio(),v=this.width?"resize":"attach";this.width=c.width,this.height=c.height,this._aspectRatio=this.aspectRatio,retinaScale(this,u,!0)&&(this.notifyPlugins("resize",{size:c}),callback(n.onResize,[this,c],this),this.attached&&this._doResize(v)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};each(t,(n,a)=>{n.id=a})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,a=Object.keys(n).reduce((c,u)=>(c[u]=!1,c),{});let o=[];t&&(o=o.concat(Object.keys(t).map(c=>{const u=t[c],v=determineAxis(c,u),_=v==="r",x=v==="x";return{options:u,dposition:_?"chartArea":x?"bottom":"left",dtype:_?"radialLinear":x?"category":"linear"}}))),each(o,c=>{const u=c.options,v=u.id,_=determineAxis(v,u),x=valueOrDefault(u.type,c.dtype);(u.position===void 0||positionIsHorizontal(u.position,_)!==positionIsHorizontal(c.dposition))&&(u.position=c.dposition),a[v]=!0;let E=null;if(v in n&&n[v].type===x)E=n[v];else{const M=registry.getScale(x);E=new M({id:v,type:x,ctx:this.ctx,chart:this}),n[E.id]=E}E.init(u,e)}),each(a,(c,u)=>{c||delete n[u]}),each(n,c=>{layouts.configure(this,c,c.options),layouts.addBox(this,c)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((a,o)=>a.index-o.index),n>t){for(let a=t;a<n;++a)this._destroyDatasetMeta(a);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(compare2Level("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((n,a)=>{t.filter(o=>o===n._dataset).length===0&&this._destroyDatasetMeta(a)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,a;for(this._removeUnreferencedMetasets(),n=0,a=t.length;n<a;n++){const o=t[n];let c=this.getDatasetMeta(n);const u=o.type||this.config.type;if(c.type&&c.type!==u&&(this._destroyDatasetMeta(n),c=this.getDatasetMeta(n)),c.type=u,c.indexAxis=o.indexAxis||getIndexAxis(u,this.options),c.order=o.order||0,c.index=n,c.label=""+o.label,c.visible=this.isDatasetVisible(n),c.controller)c.controller.updateIndex(n),c.controller.linkScales();else{const v=registry.getController(u),{datasetElementType:_,dataElementType:x}=defaults.datasets[u];Object.assign(v,{dataElementType:registry.getElement(x),datasetElementType:_&&registry.getElement(_)}),c.controller=new v(this,n),e.push(c.controller)}}return this._updateMetasets(),e}_resetElements(){each(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),a=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let c=0;for(let _=0,x=this.data.datasets.length;_<x;_++){const{controller:E}=this.getDatasetMeta(_),M=!a&&o.indexOf(E)===-1;E.buildOrUpdateElements(M),c=Math.max(+E.getMaxOverflow(),c)}c=this._minPadding=n.layout.autoPadding?c:0,this._updateLayout(c),a||each(o,_=>{_.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(compare2Level("z","_idx"));const{_active:u,_lastEvent:v}=this;v?this._eventHandler(v,!0):u.length&&this._updateHoverStyles(u,u,!0),this.render()}_updateScales(){each(this.scales,e=>{layouts.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!setsEqual(t,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:a,count:o}of t){const c=n==="_removeElements"?-o:o;moveNumericKeys(e,a,c)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=o=>new Set(e.filter(c=>c[0]===o).map((c,u)=>u+","+c.splice(1).join(","))),a=n(0);for(let o=1;o<t;o++)if(!setsEqual(a,n(o)))return;return Array.from(a).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;layouts.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],each(this.boxes,a=>{n&&a.position==="chartArea"||(a.configure&&a.configure(),this._layers.push(...a._layers()))},this),this._layers.forEach((a,o)=>{a._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,n=this.data.datasets.length;t<n;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,isFunction(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),a={meta:n,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",a)!==!1&&(n.controller._update(t),a.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",a))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(animator.has(this)?this.attached&&!animator.running(this)&&animator.start(this):(this.draw(),onAnimationsComplete({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:n,height:a}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(n,a)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let a,o;for(a=0,o=t.length;a<o;++a){const c=t[a];(!e||c.visible)&&n.push(c)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n=e._clip,a=!n.disabled,o=getDatasetArea(e,this.chartArea),c={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",c)!==!1&&(a&&clipArea(t,{left:n.left===!1?0:o.left-n.left,right:n.right===!1?this.width:o.right+n.right,top:n.top===!1?0:o.top-n.top,bottom:n.bottom===!1?this.height:o.bottom+n.bottom}),e.controller.draw(),a&&unclipArea(t),c.cancelable=!1,this.notifyPlugins("afterDatasetDraw",c))}isPointInArea(e){return _isPointInArea(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,a){const o=Interaction.modes[t];return typeof o=="function"?o(this,e,n,a):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let a=n.filter(o=>o&&o._dataset===t).pop();return a||(a={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(a)),a}getContext(){return this.$context||(this.$context=createContext(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!t.hidden}setDatasetVisibility(e,t){const n=this.getDatasetMeta(e);n.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const a=n?"show":"hide",o=this.getDatasetMeta(e),c=o.controller._resolveAnimations(void 0,a);defined(t)?(o.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),c.update(o,{visible:n}),this.update(u=>u.datasetIndex===e?a:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),animator.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),clearCanvas(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete instances[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(o,c)=>{t.addEventListener(this,o,c),e[o]=c},a=(o,c,u)=>{o.offsetX=c,o.offsetY=u,this._eventHandler(o)};each(this.options.events,o=>n(o,a))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(v,_)=>{t.addEventListener(this,v,_),e[v]=_},a=(v,_)=>{e[v]&&(t.removeEventListener(this,v,_),delete e[v])},o=(v,_)=>{this.canvas&&this.resize(v,_)};let c;const u=()=>{a("attach",u),this.attached=!0,this.resize(),n("resize",o),n("detach",c)};c=()=>{this.attached=!1,a("resize",o),this._stop(),this._resize(0,0),n("attach",u)},t.isAttached(this.canvas)?u():c()}unbindEvents(){each(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},each(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const a=n?"set":"remove";let o,c,u,v;for(t==="dataset"&&(o=this.getDatasetMeta(e[0].datasetIndex),o.controller["_"+a+"DatasetHoverStyle"]()),u=0,v=e.length;u<v;++u){c=e[u];const _=c&&this.getDatasetMeta(c.datasetIndex).controller;_&&_[a+"HoverStyle"](c.element,c.datasetIndex,c.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(({datasetIndex:o,index:c})=>{const u=this.getDatasetMeta(o);if(!u)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:u.data[c],index:c}});!_elementsEqual(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,n){const a=this.options.hover,o=(v,_)=>v.filter(x=>!_.some(E=>x.datasetIndex===E.datasetIndex&&x.index===E.index)),c=o(t,e),u=n?e:o(e,t);c.length&&this.updateHoverStyle(c,a.mode,!1),u.length&&a.mode&&this.updateHoverStyle(u,a.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},a=c=>(c.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,a)===!1)return;const o=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,a),(o||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:a=[],options:o}=this,c=t,u=this._getActiveElements(e,a,n,c),v=_isClickEvent(e),_=determineLastEvent(e,this._lastEvent,n,v);n&&(this._lastEvent=null,callback(o.onHover,[e,u,this],this),v&&callback(o.onClick,[e,u,this],this));const x=!_elementsEqual(u,a);return(x||t)&&(this._active=u,this._updateHoverStyles(u,a,t)),this._lastEvent=_,x}_getActiveElements(e,t,n,a){if(e.type==="mouseout")return[];if(!n)return t;const o=this.options.hover;return this.getElementsAtEventForMode(e,o.mode,o,a)}}function invalidatePlugins(){return each(Chart.instances,r=>r._plugins.invalidate())}function clipArc(r,e,t){const{startAngle:n,pixelMargin:a,x:o,y:c,outerRadius:u,innerRadius:v}=e;let _=a/u;r.beginPath(),r.arc(o,c,u,n-_,t+_),v>a?(_=a/v,r.arc(o,c,v,t+_,n-_,!0)):r.arc(o,c,a,t+HALF_PI,n-HALF_PI),r.closePath(),r.clip()}function toRadiusCorners(r){return _readValueToProps(r,["outerStart","outerEnd","innerStart","innerEnd"])}function parseBorderRadius$1(r,e,t,n){const a=toRadiusCorners(r.options.borderRadius),o=(t-e)/2,c=Math.min(o,n*e/2),u=v=>{const _=(t-Math.min(o,v))*n/2;return _limitValue(v,0,Math.min(o,_))};return{outerStart:u(a.outerStart),outerEnd:u(a.outerEnd),innerStart:_limitValue(a.innerStart,0,c),innerEnd:_limitValue(a.innerEnd,0,c)}}function rThetaToXY(r,e,t,n){return{x:t+r*Math.cos(e),y:n+r*Math.sin(e)}}function pathArc(r,e,t,n,a,o){const{x:c,y:u,startAngle:v,pixelMargin:_,innerRadius:x}=e,E=Math.max(e.outerRadius+n+t-_,0),M=x>0?x+n+t+_:0;let C=0;const I=a-v;if(n){const S=x>0?x-n:0,T=E>0?E-n:0,B=(S+T)/2,$=B!==0?I*B/(B+n):I;C=(I-$)/2}const D=Math.max(.001,I*E-t/PI)/E,L=(I-D)/2,N=v+L+C,q=a-L-C,{outerStart:F,outerEnd:U,innerStart:j,innerEnd:W}=parseBorderRadius$1(e,M,E,q-N),X=E-F,J=E-U,G=N+F/X,oe=q-U/J,O=M+j,l=M+W,p=N+j/O,b=q-W/l;if(r.beginPath(),o){const S=(G+oe)/2;if(r.arc(c,u,E,G,S),r.arc(c,u,E,S,oe),U>0){const A=rThetaToXY(J,oe,c,u);r.arc(A.x,A.y,U,oe,q+HALF_PI)}const T=rThetaToXY(l,q,c,u);if(r.lineTo(T.x,T.y),W>0){const A=rThetaToXY(l,b,c,u);r.arc(A.x,A.y,W,q+HALF_PI,b+Math.PI)}const B=(q-W/M+(N+j/M))/2;if(r.arc(c,u,M,q-W/M,B,!0),r.arc(c,u,M,B,N+j/M,!0),j>0){const A=rThetaToXY(O,p,c,u);r.arc(A.x,A.y,j,p+Math.PI,N-HALF_PI)}const $=rThetaToXY(X,N,c,u);if(r.lineTo($.x,$.y),F>0){const A=rThetaToXY(X,G,c,u);r.arc(A.x,A.y,F,N-HALF_PI,G)}}else{r.moveTo(c,u);const S=Math.cos(G)*E+c,T=Math.sin(G)*E+u;r.lineTo(S,T);const B=Math.cos(oe)*E+c,$=Math.sin(oe)*E+u;r.lineTo(B,$)}r.closePath()}function drawArc(r,e,t,n,a){const{fullCircles:o,startAngle:c,circumference:u}=e;let v=e.endAngle;if(o){pathArc(r,e,t,n,v,a);for(let _=0;_<o;++_)r.fill();isNaN(u)||(v=c+(u%TAU||TAU))}return pathArc(r,e,t,n,v,a),r.fill(),v}function drawBorder(r,e,t,n,a){const{fullCircles:o,startAngle:c,circumference:u,options:v}=e,{borderWidth:_,borderJoinStyle:x,borderDash:E,borderDashOffset:M}=v,C=v.borderAlign==="inner";if(!_)return;r.setLineDash(E||[]),r.lineDashOffset=M,C?(r.lineWidth=_*2,r.lineJoin=x||"round"):(r.lineWidth=_,r.lineJoin=x||"bevel");let I=e.endAngle;if(o){pathArc(r,e,t,n,I,a);for(let D=0;D<o;++D)r.stroke();isNaN(u)||(I=c+(u%TAU||TAU))}C&&clipArc(r,e,I),o||(pathArc(r,e,t,n,I,a),r.stroke())}class ArcElement extends Element{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,n){const a=this.getProps(["x","y"],n),{angle:o,distance:c}=getAngleFromPoint(a,{x:e,y:t}),{startAngle:u,endAngle:v,innerRadius:_,outerRadius:x,circumference:E}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),M=(this.options.spacing+this.options.borderWidth)/2,C=valueOrDefault(E,v-u),I=_angleBetween(o,u,v)&&u!==v,D=C>=TAU||I,L=_isBetween(c,_+M,x+M);return D&&L}getCenterPoint(e){const{x:t,y:n,startAngle:a,endAngle:o,innerRadius:c,outerRadius:u}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:v,spacing:_}=this.options,x=(a+o)/2,E=(c+u+_+v)/2;return{x:t+Math.cos(x)*E,y:n+Math.sin(x)*E}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:n}=this,a=(t.offset||0)/4,o=(t.spacing||0)/2,c=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=n>TAU?Math.floor(n/TAU):0,n===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const u=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(u)*a,Math.sin(u)*a);const v=1-Math.sin(Math.min(PI,n||0)),_=a*v;e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,drawArc(e,this,_,o,c),drawBorder(e,this,_,o,c),e.restore()}}function setStyle(r,e,t=e){r.lineCap=valueOrDefault(t.borderCapStyle,e.borderCapStyle),r.setLineDash(valueOrDefault(t.borderDash,e.borderDash)),r.lineDashOffset=valueOrDefault(t.borderDashOffset,e.borderDashOffset),r.lineJoin=valueOrDefault(t.borderJoinStyle,e.borderJoinStyle),r.lineWidth=valueOrDefault(t.borderWidth,e.borderWidth),r.strokeStyle=valueOrDefault(t.borderColor,e.borderColor)}function lineTo(r,e,t){r.lineTo(t.x,t.y)}function getLineMethod(r){return r.stepped?_steppedLineTo:r.tension||r.cubicInterpolationMode==="monotone"?_bezierCurveTo:lineTo}function pathVars(r,e,t={}){const n=r.length,{start:a=0,end:o=n-1}=t,{start:c,end:u}=e,v=Math.max(a,c),_=Math.min(o,u),x=a<c&&o<c||a>u&&o>u;return{count:n,start:v,loop:e.loop,ilen:_<v&&!x?n+_-v:_-v}}function pathSegment(r,e,t,n){const{points:a,options:o}=e,{count:c,start:u,loop:v,ilen:_}=pathVars(a,t,n),x=getLineMethod(o);let{move:E=!0,reverse:M}=n||{},C,I,D;for(C=0;C<=_;++C)I=a[(u+(M?_-C:C))%c],!I.skip&&(E?(r.moveTo(I.x,I.y),E=!1):x(r,D,I,M,o.stepped),D=I);return v&&(I=a[(u+(M?_:0))%c],x(r,D,I,M,o.stepped)),!!v}function fastPathSegment(r,e,t,n){const a=e.points,{count:o,start:c,ilen:u}=pathVars(a,t,n),{move:v=!0,reverse:_}=n||{};let x=0,E=0,M,C,I,D,L,N;const q=U=>(c+(_?u-U:U))%o,F=()=>{D!==L&&(r.lineTo(x,L),r.lineTo(x,D),r.lineTo(x,N))};for(v&&(C=a[q(0)],r.moveTo(C.x,C.y)),M=0;M<=u;++M){if(C=a[q(M)],C.skip)continue;const U=C.x,j=C.y,W=U|0;W===I?(j<D?D=j:j>L&&(L=j),x=(E*x+U)/++E):(F(),r.lineTo(U,j),I=W,E=0,D=L=j),N=j}F()}function _getSegmentMethod(r){const e=r.options,t=e.borderDash&&e.borderDash.length;return!r._decimated&&!r._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?fastPathSegment:pathSegment}function _getInterpolationMethod(r){return r.stepped?_steppedInterpolation:r.tension||r.cubicInterpolationMode==="monotone"?_bezierInterpolation:_pointInLine}function strokePathWithCache(r,e,t,n){let a=e._path;a||(a=e._path=new Path2D,e.path(a,t,n)&&a.closePath()),setStyle(r,e.options),r.stroke(a)}function strokePathDirect(r,e,t,n){const{segments:a,options:o}=e,c=_getSegmentMethod(e);for(const u of a)setStyle(r,o,u.style),r.beginPath(),c(r,e,u,{start:t,end:t+n-1})&&r.closePath(),r.stroke()}const usePath2D=typeof Path2D=="function";function draw(r,e,t,n){usePath2D&&!e.options.segment?strokePathWithCache(r,e,t,n):strokePathDirect(r,e,t,n)}class LineElement extends Element{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||n.cubicInterpolationMode==="monotone")&&!n.stepped&&!this._pointsUpdated){const a=n.spanGaps?this._loop:this._fullLoop;_updateBezierControlPoints(this._points,n,e,a,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=_computeSegments(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,a=e[t],o=this.points,c=_boundSegments(this,{property:t,start:a,end:a});if(!c.length)return;const u=[],v=_getInterpolationMethod(n);let _,x;for(_=0,x=c.length;_<x;++_){const{start:E,end:M}=c[_],C=o[E],I=o[M];if(C===I){u.push(C);continue}const D=Math.abs((a-C[t])/(I[t]-C[t])),L=v(C,I,D,n.stepped);L[t]=e[t],u.push(L)}return u.length===1?u[0]:u}pathSegment(e,t,n){return _getSegmentMethod(this)(e,this,t,n)}path(e,t,n){const a=this.segments,o=_getSegmentMethod(this);let c=this._loop;t=t||0,n=n||this.points.length-t;for(const u of a)c&=o(e,this,u,{start:t,end:t+n-1});return!!c}draw(e,t,n,a){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(e.save(),draw(e,this,n,a),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function inRange$1(r,e,t,n){const a=r.options,{[t]:o}=r.getProps([t],n);return Math.abs(e-o)<a.radius+a.hitRadius}class PointElement extends Element{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,n){const a=this.options,{x:o,y:c}=this.getProps(["x","y"],n);return Math.pow(e-o,2)+Math.pow(t-c,2)<Math.pow(a.hitRadius+a.radius,2)}inXRange(e,t){return inRange$1(this,e,"x",t)}inYRange(e,t){return inRange$1(this,e,"y",t)}getCenterPoint(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}size(e){e=e||this.options||{};let t=e.radius||0;t=Math.max(t,t&&e.hoverRadius||0);const n=t&&e.borderWidth||0;return(t+n)*2}draw(e,t){const n=this.options;this.skip||n.radius<.1||!_isPointInArea(this,t,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,drawPoint(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function getBarBounds(r,e){const{x:t,y:n,base:a,width:o,height:c}=r.getProps(["x","y","base","width","height"],e);let u,v,_,x,E;return r.horizontal?(E=c/2,u=Math.min(t,a),v=Math.max(t,a),_=n-E,x=n+E):(E=o/2,u=t-E,v=t+E,_=Math.min(n,a),x=Math.max(n,a)),{left:u,top:_,right:v,bottom:x}}function skipOrLimit(r,e,t,n){return r?0:_limitValue(e,t,n)}function parseBorderWidth(r,e,t){const n=r.options.borderWidth,a=r.borderSkipped,o=toTRBL(n);return{t:skipOrLimit(a.top,o.top,0,t),r:skipOrLimit(a.right,o.right,0,e),b:skipOrLimit(a.bottom,o.bottom,0,t),l:skipOrLimit(a.left,o.left,0,e)}}function parseBorderRadius(r,e,t){const{enableBorderRadius:n}=r.getProps(["enableBorderRadius"]),a=r.options.borderRadius,o=toTRBLCorners(a),c=Math.min(e,t),u=r.borderSkipped,v=n||isObject(a);return{topLeft:skipOrLimit(!v||u.top||u.left,o.topLeft,0,c),topRight:skipOrLimit(!v||u.top||u.right,o.topRight,0,c),bottomLeft:skipOrLimit(!v||u.bottom||u.left,o.bottomLeft,0,c),bottomRight:skipOrLimit(!v||u.bottom||u.right,o.bottomRight,0,c)}}function boundingRects(r){const e=getBarBounds(r),t=e.right-e.left,n=e.bottom-e.top,a=parseBorderWidth(r,t/2,n/2),o=parseBorderRadius(r,t/2,n/2);return{outer:{x:e.left,y:e.top,w:t,h:n,radius:o},inner:{x:e.left+a.l,y:e.top+a.t,w:t-a.l-a.r,h:n-a.t-a.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(a.t,a.l)),topRight:Math.max(0,o.topRight-Math.max(a.t,a.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(a.b,a.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(a.b,a.r))}}}}function inRange(r,e,t,n){const a=e===null,o=t===null,u=r&&!(a&&o)&&getBarBounds(r,n);return u&&(a||_isBetween(e,u.left,u.right))&&(o||_isBetween(t,u.top,u.bottom))}function hasRadius(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function addNormalRectPath(r,e){r.rect(e.x,e.y,e.w,e.h)}function inflateRect(r,e,t={}){const n=r.x!==t.x?-e:0,a=r.y!==t.y?-e:0,o=(r.x+r.w!==t.x+t.w?e:0)-n,c=(r.y+r.h!==t.y+t.h?e:0)-a;return{x:r.x+n,y:r.y+a,w:r.w+o,h:r.h+c,radius:r.radius}}class BarElement extends Element{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:a}}=this,{inner:o,outer:c}=boundingRects(this),u=hasRadius(c.radius)?addRoundedRectPath:addNormalRectPath;e.save(),(c.w!==o.w||c.h!==o.h)&&(e.beginPath(),u(e,inflateRect(c,t,o)),e.clip(),u(e,inflateRect(o,-t,c)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),u(e,inflateRect(o,t)),e.fillStyle=a,e.fill(),e.restore()}inRange(e,t,n){return inRange(this,e,t,n)}inXRange(e,t){return inRange(this,e,null,t)}inYRange(e,t){return inRange(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:a,horizontal:o}=this.getProps(["x","y","base","horizontal"],e);return{x:o?(t+a)/2:t,y:o?n:(n+a)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}var elements=Object.freeze({__proto__:null,ArcElement,BarElement,LineElement,PointElement});const BORDER_COLORS=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],BACKGROUND_COLORS=BORDER_COLORS.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function getBorderColor(r){return BORDER_COLORS[r%BORDER_COLORS.length]}function getBackgroundColor(r){return BACKGROUND_COLORS[r%BACKGROUND_COLORS.length]}function colorizeDefaultDataset(r,e){return r.borderColor=getBorderColor(e),r.backgroundColor=getBackgroundColor(e),++e}function colorizeDoughnutDataset(r,e){return r.backgroundColor=r.data.map(()=>getBorderColor(e++)),e}function colorizePolarAreaDataset(r,e){return r.backgroundColor=r.data.map(()=>getBackgroundColor(e++)),e}function getColorizer(r){let e=0;return(t,n)=>{const a=r.getDatasetMeta(n).controller;a instanceof DoughnutController?e=colorizeDoughnutDataset(t,e):a instanceof PolarAreaController?e=colorizePolarAreaDataset(t,e):a&&(e=colorizeDefaultDataset(t,e))}}function containsColorsDefinitions(r){let e;for(e in r)if(r[e].borderColor||r[e].backgroundColor)return!0;return!1}function containsColorsDefinition(r){return r&&(r.borderColor||r.backgroundColor)}function containsDefaultColorsDefenitions(){return defaults.borderColor!=="rgba(0,0,0,0.1)"||defaults.backgroundColor!=="rgba(0,0,0,0.1)"}var plugin_colors={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,e,t){if(!t.enabled)return;const{data:{datasets:n},options:a}=r.config,{elements:o}=a,c=containsColorsDefinitions(n)||containsColorsDefinition(a)||o&&containsColorsDefinitions(o)||containsDefaultColorsDefenitions();if(!t.forceOverride&&c)return;const u=getColorizer(r);n.forEach(u)}};function lttbDecimation(r,e,t,n,a){const o=a.samples||n;if(o>=t)return r.slice(e,e+t);const c=[],u=(t-2)/(o-2);let v=0;const _=e+t-1;let x=e,E,M,C,I,D;for(c[v++]=r[x],E=0;E<o-2;E++){let L=0,N=0,q;const F=Math.floor((E+1)*u)+1+e,U=Math.min(Math.floor((E+2)*u)+1,t)+e,j=U-F;for(q=F;q<U;q++)L+=r[q].x,N+=r[q].y;L/=j,N/=j;const W=Math.floor(E*u)+1+e,X=Math.min(Math.floor((E+1)*u)+1,t)+e,{x:J,y:G}=r[x];for(C=I=-1,q=W;q<X;q++)I=.5*Math.abs((J-L)*(r[q].y-G)-(J-r[q].x)*(N-G)),I>C&&(C=I,M=r[q],D=q);c[v++]=M,x=D}return c[v++]=r[_],c}function minMaxDecimation(r,e,t,n){let a=0,o=0,c,u,v,_,x,E,M,C,I,D;const L=[],N=e+t-1,q=r[e].x,U=r[N].x-q;for(c=e;c<e+t;++c){u=r[c],v=(u.x-q)/U*n,_=u.y;const j=v|0;if(j===x)_<I?(I=_,E=c):_>D&&(D=_,M=c),a=(o*a+u.x)/++o;else{const W=c-1;if(!isNullOrUndef(E)&&!isNullOrUndef(M)){const X=Math.min(E,M),J=Math.max(E,M);X!==C&&X!==W&&L.push({...r[X],x:a}),J!==C&&J!==W&&L.push({...r[J],x:a})}c>0&&W!==C&&L.push(r[W]),L.push(u),x=j,o=0,I=D=_,E=M=C=c}}return L}function cleanDecimatedDataset(r){if(r._decimated){const e=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function cleanDecimatedData(r){r.data.datasets.forEach(e=>{cleanDecimatedDataset(e)})}function getStartAndCountOfVisiblePointsSimplified(r,e){const t=e.length;let n=0,a;const{iScale:o}=r,{min:c,max:u,minDefined:v,maxDefined:_}=o.getUserBounds();return v&&(n=_limitValue(_lookupByKey(e,o.axis,c).lo,0,t-1)),_?a=_limitValue(_lookupByKey(e,o.axis,u).hi+1,n,t)-n:a=t-n,{start:n,count:a}}var plugin_decimation={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,e,t)=>{if(!t.enabled){cleanDecimatedData(r);return}const n=r.width;r.data.datasets.forEach((a,o)=>{const{_data:c,indexAxis:u}=a,v=r.getDatasetMeta(o),_=c||a.data;if(resolve([u,r.options.indexAxis])==="y"||!v.controller.supportsDecimation)return;const x=r.scales[v.xAxisID];if(x.type!=="linear"&&x.type!=="time"||r.options.parsing)return;let{start:E,count:M}=getStartAndCountOfVisiblePointsSimplified(v,_);const C=t.threshold||4*n;if(M<=C){cleanDecimatedDataset(a);return}isNullOrUndef(c)&&(a._data=_,delete a.data,Object.defineProperty(a,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(D){this._data=D}}));let I;switch(t.algorithm){case"lttb":I=lttbDecimation(_,E,M,n,t);break;case"min-max":I=minMaxDecimation(_,E,M,n);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}a._decimated=I})},destroy(r){cleanDecimatedData(r)}};function _segments(r,e,t){const n=r.segments,a=r.points,o=e.points,c=[];for(const u of n){let{start:v,end:_}=u;_=_findSegmentEnd(v,_,a);const x=_getBounds(t,a[v],a[_],u.loop);if(!e.segments){c.push({source:u,target:x,start:a[v],end:a[_]});continue}const E=_boundSegments(e,x);for(const M of E){const C=_getBounds(t,o[M.start],o[M.end],M.loop),I=_boundSegment(u,a,C);for(const D of I)c.push({source:D,target:M,start:{[t]:_getEdge(x,C,"start",Math.max)},end:{[t]:_getEdge(x,C,"end",Math.min)}})}}return c}function _getBounds(r,e,t,n){if(n)return;let a=e[r],o=t[r];return r==="angle"&&(a=_normalizeAngle(a),o=_normalizeAngle(o)),{property:r,start:a,end:o}}function _pointsFromSegments(r,e){const{x:t=null,y:n=null}=r||{},a=e.points,o=[];return e.segments.forEach(({start:c,end:u})=>{u=_findSegmentEnd(c,u,a);const v=a[c],_=a[u];n!==null?(o.push({x:v.x,y:n}),o.push({x:_.x,y:n})):t!==null&&(o.push({x:t,y:v.y}),o.push({x:t,y:_.y}))}),o}function _findSegmentEnd(r,e,t){for(;e>r;e--){const n=t[e];if(!isNaN(n.x)&&!isNaN(n.y))break}return e}function _getEdge(r,e,t,n){return r&&e?n(r[t],e[t]):r?r[t]:e?e[t]:0}function _createBoundaryLine(r,e){let t=[],n=!1;return isArray(r)?(n=!0,t=r):t=_pointsFromSegments(r,e),t.length?new LineElement({points:t,options:{tension:0},_loop:n,_fullLoop:n}):null}function _shouldApplyFill(r){return r&&r.fill!==!1}function _resolveTarget(r,e,t){let a=r[e].fill;const o=[e];let c;if(!t)return a;for(;a!==!1&&o.indexOf(a)===-1;){if(!isNumberFinite(a))return a;if(c=r[a],!c)return!1;if(c.visible)return a;o.push(a),a=c.fill}return!1}function _decodeFill(r,e,t){const n=parseFillOption(r);if(isObject(n))return isNaN(n.value)?!1:n;let a=parseFloat(n);return isNumberFinite(a)&&Math.floor(a)===a?decodeTargetIndex(n[0],e,a,t):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function decodeTargetIndex(r,e,t,n){return(r==="-"||r==="+")&&(t=e+t),t===e||t<0||t>=n?!1:t}function _getTargetPixel(r,e){let t=null;return r==="start"?t=e.bottom:r==="end"?t=e.top:isObject(r)?t=e.getPixelForValue(r.value):e.getBasePixel&&(t=e.getBasePixel()),t}function _getTargetValue(r,e,t){let n;return r==="start"?n=t:r==="end"?n=e.options.reverse?e.min:e.max:isObject(r)?n=r.value:n=e.getBaseValue(),n}function parseFillOption(r){const e=r.options,t=e.fill;let n=valueOrDefault(t&&t.target,t);return n===void 0&&(n=!!e.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function _buildStackLine(r){const{scale:e,index:t,line:n}=r,a=[],o=n.segments,c=n.points,u=getLinesBelow(e,t);u.push(_createBoundaryLine({x:null,y:e.bottom},n));for(let v=0;v<o.length;v++){const _=o[v];for(let x=_.start;x<=_.end;x++)addPointsBelow(a,c[x],u)}return new LineElement({points:a,options:{}})}function getLinesBelow(r,e){const t=[],n=r.getMatchingVisibleMetas("line");for(let a=0;a<n.length;a++){const o=n[a];if(o.index===e)break;o.hidden||t.unshift(o.dataset)}return t}function addPointsBelow(r,e,t){const n=[];for(let a=0;a<t.length;a++){const o=t[a],{first:c,last:u,point:v}=findPoint(o,e,"x");if(!(!v||c&&u)){if(c)n.unshift(v);else if(r.push(v),!u)break}}r.push(...n)}function findPoint(r,e,t){const n=r.interpolate(e,t);if(!n)return{};const a=n[t],o=r.segments,c=r.points;let u=!1,v=!1;for(let _=0;_<o.length;_++){const x=o[_],E=c[x.start][t],M=c[x.end][t];if(_isBetween(a,E,M)){u=a===E,v=a===M;break}}return{first:u,last:v,point:n}}class simpleArc{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){const{x:a,y:o,radius:c}=this;return t=t||{start:0,end:TAU},e.arc(a,o,c,t.end,t.start,!0),!n.bounds}interpolate(e){const{x:t,y:n,radius:a}=this,o=e.angle;return{x:t+Math.cos(o)*a,y:n+Math.sin(o)*a,angle:o}}}function _getTarget(r){const{chart:e,fill:t,line:n}=r;if(isNumberFinite(t))return getLineByIndex(e,t);if(t==="stack")return _buildStackLine(r);if(t==="shape")return!0;const a=computeBoundary(r);return a instanceof simpleArc?a:_createBoundaryLine(a,n)}function getLineByIndex(r,e){const t=r.getDatasetMeta(e);return t&&r.isDatasetVisible(e)?t.dataset:null}function computeBoundary(r){return(r.scale||{}).getPointPositionForValue?computeCircularBoundary(r):computeLinearBoundary(r)}function computeLinearBoundary(r){const{scale:e={},fill:t}=r,n=_getTargetPixel(t,e);if(isNumberFinite(n)){const a=e.isHorizontal();return{x:a?n:null,y:a?null:n}}return null}function computeCircularBoundary(r){const{scale:e,fill:t}=r,n=e.options,a=e.getLabels().length,o=n.reverse?e.max:e.min,c=_getTargetValue(t,e,o),u=[];if(n.grid.circular){const v=e.getPointPositionForValue(0,o);return new simpleArc({x:v.x,y:v.y,radius:e.getDistanceFromCenterForValue(c)})}for(let v=0;v<a;++v)u.push(e.getPointPositionForValue(v,c));return u}function _drawfill(r,e,t){const n=_getTarget(e),{line:a,scale:o,axis:c}=e,u=a.options,v=u.fill,_=u.backgroundColor,{above:x=_,below:E=_}=v||{};n&&a.points.length&&(clipArea(r,t),doFill(r,{line:a,target:n,above:x,below:E,area:t,scale:o,axis:c}),unclipArea(r))}function doFill(r,e){const{line:t,target:n,above:a,below:o,area:c,scale:u}=e,v=t._loop?"angle":e.axis;r.save(),v==="x"&&o!==a&&(clipVertical(r,n,c.top),fill(r,{line:t,target:n,color:a,scale:u,property:v}),r.restore(),r.save(),clipVertical(r,n,c.bottom)),fill(r,{line:t,target:n,color:o,scale:u,property:v}),r.restore()}function clipVertical(r,e,t){const{segments:n,points:a}=e;let o=!0,c=!1;r.beginPath();for(const u of n){const{start:v,end:_}=u,x=a[v],E=a[_findSegmentEnd(v,_,a)];o?(r.moveTo(x.x,x.y),o=!1):(r.lineTo(x.x,t),r.lineTo(x.x,x.y)),c=!!e.pathSegment(r,u,{move:c}),c?r.closePath():r.lineTo(E.x,t)}r.lineTo(e.first().x,t),r.closePath(),r.clip()}function fill(r,e){const{line:t,target:n,property:a,color:o,scale:c}=e,u=_segments(t,n,a);for(const{source:v,target:_,start:x,end:E}of u){const{style:{backgroundColor:M=o}={}}=v,C=n!==!0;r.save(),r.fillStyle=M,clipBounds(r,c,C&&_getBounds(a,x,E)),r.beginPath();const I=!!t.pathSegment(r,v);let D;if(C){I?r.closePath():interpolatedLineTo(r,n,E,a);const L=!!n.pathSegment(r,_,{move:I,reverse:!0});D=I&&L,D||interpolatedLineTo(r,n,x,a)}r.closePath(),r.fill(D?"evenodd":"nonzero"),r.restore()}}function clipBounds(r,e,t){const{top:n,bottom:a}=e.chart.chartArea,{property:o,start:c,end:u}=t||{};o==="x"&&(r.beginPath(),r.rect(c,n,u-c,a-n),r.clip())}function interpolatedLineTo(r,e,t,n){const a=e.interpolate(t,n);a&&r.lineTo(a.x,a.y)}var index={id:"filler",afterDatasetsUpdate(r,e,t){const n=(r.data.datasets||[]).length,a=[];let o,c,u,v;for(c=0;c<n;++c)o=r.getDatasetMeta(c),u=o.dataset,v=null,u&&u.options&&u instanceof LineElement&&(v={visible:r.isDatasetVisible(c),index:c,fill:_decodeFill(u,c,n),chart:r,axis:o.controller.options.indexAxis,scale:o.vScale,line:u}),o.$filler=v,a.push(v);for(c=0;c<n;++c)v=a[c],!(!v||v.fill===!1)&&(v.fill=_resolveTarget(a,c,t.propagate))},beforeDraw(r,e,t){const n=t.drawTime==="beforeDraw",a=r.getSortedVisibleDatasetMetas(),o=r.chartArea;for(let c=a.length-1;c>=0;--c){const u=a[c].$filler;u&&(u.line.updateControlPoints(o,u.axis),n&&u.fill&&_drawfill(r.ctx,u,o))}},beforeDatasetsDraw(r,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const n=r.getSortedVisibleDatasetMetas();for(let a=n.length-1;a>=0;--a){const o=n[a].$filler;_shouldApplyFill(o)&&_drawfill(r.ctx,o,r.chartArea)}},beforeDatasetDraw(r,e,t){const n=e.meta.$filler;!_shouldApplyFill(n)||t.drawTime!=="beforeDatasetDraw"||_drawfill(r.ctx,n,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const getBoxSize=(r,e)=>{let{boxHeight:t=e,boxWidth:n=e}=r;return r.usePointStyle&&(t=Math.min(t,e),n=r.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:t,itemHeight:Math.max(e,t)}},itemsEqual=(r,e)=>r!==null&&e!==null&&r.datasetIndex===e.datasetIndex&&r.index===e.index;class Legend extends Element{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=callback(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(n=>e.filter(n,this.chart.data))),e.sort&&(t=t.sort((n,a)=>e.sort(n,a,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const n=e.labels,a=toFont(n.font),o=a.size,c=this._computeTitleHeight(),{boxWidth:u,itemHeight:v}=getBoxSize(n,o);let _,x;t.font=a.string,this.isHorizontal()?(_=this.maxWidth,x=this._fitRows(c,o,u,v)+10):(x=this.maxHeight,_=this._fitCols(c,a,u,v)+10),this.width=Math.min(_,e.maxWidth||this.maxWidth),this.height=Math.min(x,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,a){const{ctx:o,maxWidth:c,options:{labels:{padding:u}}}=this,v=this.legendHitBoxes=[],_=this.lineWidths=[0],x=a+u;let E=e;o.textAlign="left",o.textBaseline="middle";let M=-1,C=-x;return this.legendItems.forEach((I,D)=>{const L=n+t/2+o.measureText(I.text).width;(D===0||_[_.length-1]+L+2*u>c)&&(E+=x,_[_.length-(D>0?0:1)]=0,C+=x,M++),v[D]={left:0,top:C,row:M,width:L,height:a},_[_.length-1]+=L+u}),E}_fitCols(e,t,n,a){const{ctx:o,maxHeight:c,options:{labels:{padding:u}}}=this,v=this.legendHitBoxes=[],_=this.columnSizes=[],x=c-e;let E=u,M=0,C=0,I=0,D=0;return this.legendItems.forEach((L,N)=>{const{itemWidth:q,itemHeight:F}=calculateItemSize(n,t,o,L,a);N>0&&C+F+2*u>x&&(E+=M+u,_.push({width:M,height:C}),I+=M+u,D++,M=C=0),v[N]={left:I,top:C,col:D,width:q,height:F},M=Math.max(M,q),C+=F+u}),E+=M,_.push({width:M,height:C}),E}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:a},rtl:o}}=this,c=getRtlAdapter(o,this.left,this.width);if(this.isHorizontal()){let u=0,v=_alignStartEnd(n,this.left+a,this.right-this.lineWidths[u]);for(const _ of t)u!==_.row&&(u=_.row,v=_alignStartEnd(n,this.left+a,this.right-this.lineWidths[u])),_.top+=this.top+e+a,_.left=c.leftForLtr(c.x(v),_.width),v+=_.width+a}else{let u=0,v=_alignStartEnd(n,this.top+e+a,this.bottom-this.columnSizes[u].height);for(const _ of t)_.col!==u&&(u=_.col,v=_alignStartEnd(n,this.top+e+a,this.bottom-this.columnSizes[u].height)),_.top=v,_.left+=this.left+a,_.left=c.leftForLtr(c.x(_.left),_.width),v+=_.height+a}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;clipArea(e,this),this._draw(),unclipArea(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:a}=this,{align:o,labels:c}=e,u=defaults.color,v=getRtlAdapter(e.rtl,this.left,this.width),_=toFont(c.font),{padding:x}=c,E=_.size,M=E/2;let C;this.drawTitle(),a.textAlign=v.textAlign("left"),a.textBaseline="middle",a.lineWidth=.5,a.font=_.string;const{boxWidth:I,boxHeight:D,itemHeight:L}=getBoxSize(c,E),N=function(W,X,J){if(isNaN(I)||I<=0||isNaN(D)||D<0)return;a.save();const G=valueOrDefault(J.lineWidth,1);if(a.fillStyle=valueOrDefault(J.fillStyle,u),a.lineCap=valueOrDefault(J.lineCap,"butt"),a.lineDashOffset=valueOrDefault(J.lineDashOffset,0),a.lineJoin=valueOrDefault(J.lineJoin,"miter"),a.lineWidth=G,a.strokeStyle=valueOrDefault(J.strokeStyle,u),a.setLineDash(valueOrDefault(J.lineDash,[])),c.usePointStyle){const oe={radius:D*Math.SQRT2/2,pointStyle:J.pointStyle,rotation:J.rotation,borderWidth:G},O=v.xPlus(W,I/2),l=X+M;drawPointLegend(a,oe,O,l,c.pointStyleWidth&&I)}else{const oe=X+Math.max((E-D)/2,0),O=v.leftForLtr(W,I),l=toTRBLCorners(J.borderRadius);a.beginPath(),Object.values(l).some(p=>p!==0)?addRoundedRectPath(a,{x:O,y:oe,w:I,h:D,radius:l}):a.rect(O,oe,I,D),a.fill(),G!==0&&a.stroke()}a.restore()},q=function(W,X,J){renderText(a,J.text,W,X+L/2,_,{strikethrough:J.hidden,textAlign:v.textAlign(J.textAlign)})},F=this.isHorizontal(),U=this._computeTitleHeight();F?C={x:_alignStartEnd(o,this.left+x,this.right-n[0]),y:this.top+x+U,line:0}:C={x:this.left+x,y:_alignStartEnd(o,this.top+U+x,this.bottom-t[0].height),line:0},overrideTextDirection(this.ctx,e.textDirection);const j=L+x;this.legendItems.forEach((W,X)=>{a.strokeStyle=W.fontColor,a.fillStyle=W.fontColor;const J=a.measureText(W.text).width,G=v.textAlign(W.textAlign||(W.textAlign=c.textAlign)),oe=I+M+J;let O=C.x,l=C.y;v.setWidth(this.width),F?X>0&&O+oe+x>this.right&&(l=C.y+=j,C.line++,O=C.x=_alignStartEnd(o,this.left+x,this.right-n[C.line])):X>0&&l+j>this.bottom&&(O=C.x=O+t[C.line].width+x,C.line++,l=C.y=_alignStartEnd(o,this.top+U+x,this.bottom-t[C.line].height));const p=v.x(O);if(N(p,l,W),O=_textX(G,O+I+M,F?O+oe:this.right,e.rtl),q(v.x(O),l,W),F)C.x+=oe+x;else if(typeof W.text!="string"){const b=_.lineHeight;C.y+=calculateLegendItemHeight(W,b)+x}else C.y+=j}),restoreTextDirection(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=toFont(t.font),a=toPadding(t.padding);if(!t.display)return;const o=getRtlAdapter(e.rtl,this.left,this.width),c=this.ctx,u=t.position,v=n.size/2,_=a.top+v;let x,E=this.left,M=this.width;if(this.isHorizontal())M=Math.max(...this.lineWidths),x=this.top+_,E=_alignStartEnd(e.align,E,this.right-M);else{const I=this.columnSizes.reduce((D,L)=>Math.max(D,L.height),0);x=_+_alignStartEnd(e.align,this.top,this.bottom-I-e.labels.padding-this._computeTitleHeight())}const C=_alignStartEnd(u,E,E+M);c.textAlign=o.textAlign(_toLeftRightCenter(u)),c.textBaseline="middle",c.strokeStyle=t.color,c.fillStyle=t.color,c.font=n.string,renderText(c,t.text,C,x,n)}_computeTitleHeight(){const e=this.options.title,t=toFont(e.font),n=toPadding(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,a,o;if(_isBetween(e,this.left,this.right)&&_isBetween(t,this.top,this.bottom)){for(o=this.legendHitBoxes,n=0;n<o.length;++n)if(a=o[n],_isBetween(e,a.left,a.left+a.width)&&_isBetween(t,a.top,a.top+a.height))return this.legendItems[n]}return null}handleEvent(e){const t=this.options;if(!isListened(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const a=this._hoveredItem,o=itemsEqual(a,n);a&&!o&&callback(t.onLeave,[e,a,this],this),this._hoveredItem=n,n&&!o&&callback(t.onHover,[e,n,this],this)}else n&&callback(t.onClick,[e,n,this],this)}}function calculateItemSize(r,e,t,n,a){const o=calculateItemWidth(n,r,e,t),c=calculateItemHeight(a,n,e.lineHeight);return{itemWidth:o,itemHeight:c}}function calculateItemWidth(r,e,t,n){let a=r.text;return a&&typeof a!="string"&&(a=a.reduce((o,c)=>o.length>c.length?o:c)),e+t.size/2+n.measureText(a).width}function calculateItemHeight(r,e,t){let n=r;return typeof e.text!="string"&&(n=calculateLegendItemHeight(e,t)),n}function calculateLegendItemHeight(r,e){const t=r.text?r.text.length:0;return e*t}function isListened(r,e){return!!((r==="mousemove"||r==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(r==="click"||r==="mouseup"))}var plugin_legend={id:"legend",_element:Legend,start(r,e,t){const n=r.legend=new Legend({ctx:r.ctx,options:t,chart:r});layouts.configure(r,n,t),layouts.addBox(r,n)},stop(r){layouts.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,e,t){const n=r.legend;layouts.configure(r,n,t),n.options=t},afterUpdate(r){const e=r.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(r,e){e.replay||r.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,e,t){const n=e.datasetIndex,a=t.chart;a.isDatasetVisible(n)?(a.hide(n),e.hidden=!0):(a.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){const e=r.data.datasets,{labels:{usePointStyle:t,pointStyle:n,textAlign:a,color:o,useBorderRadius:c,borderRadius:u}}=r.legend.options;return r._getSortedDatasetMetas().map(v=>{const _=v.controller.getStyle(t?0:void 0),x=toPadding(_.borderWidth);return{text:e[v.index].label,fillStyle:_.backgroundColor,fontColor:o,hidden:!v.visible,lineCap:_.borderCapStyle,lineDash:_.borderDash,lineDashOffset:_.borderDashOffset,lineJoin:_.borderJoinStyle,lineWidth:(x.width+x.height)/4,strokeStyle:_.borderColor,pointStyle:n||_.pointStyle,rotation:_.rotation,textAlign:a||_.textAlign,borderRadius:c&&(u||_.borderRadius),datasetIndex:v.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}};class Title extends Element{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const a=isArray(n.text)?n.text.length:1;this._padding=toPadding(n.padding);const o=a*toFont(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:n,bottom:a,right:o,options:c}=this,u=c.align;let v=0,_,x,E;return this.isHorizontal()?(x=_alignStartEnd(u,n,o),E=t+e,_=o-n):(c.position==="left"?(x=n+e,E=_alignStartEnd(u,a,t),v=PI*-.5):(x=o-e,E=_alignStartEnd(u,t,a),v=PI*.5),_=a-t),{titleX:x,titleY:E,maxWidth:_,rotation:v}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=toFont(t.font),o=n.lineHeight/2+this._padding.top,{titleX:c,titleY:u,maxWidth:v,rotation:_}=this._drawArgs(o);renderText(e,t.text,0,0,n,{color:t.color,maxWidth:v,rotation:_,textAlign:_toLeftRightCenter(t.align),textBaseline:"middle",translation:[c,u]})}}function createTitle(r,e){const t=new Title({ctx:r.ctx,options:e,chart:r});layouts.configure(r,t,e),layouts.addBox(r,t),r.titleBlock=t}var plugin_title={id:"title",_element:Title,start(r,e,t){createTitle(r,t)},stop(r){const e=r.titleBlock;layouts.removeBox(r,e),delete r.titleBlock},beforeUpdate(r,e,t){const n=r.titleBlock;layouts.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const map=new WeakMap;var plugin_subtitle={id:"subtitle",start(r,e,t){const n=new Title({ctx:r.ctx,options:t,chart:r});layouts.configure(r,n,t),layouts.addBox(r,n),map.set(r,n)},stop(r){layouts.removeBox(r,map.get(r)),map.delete(r)},beforeUpdate(r,e,t){const n=map.get(r);layouts.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const positioners={average(r){if(!r.length)return!1;let e,t,n=new Set,a=0,o=0;for(e=0,t=r.length;e<t;++e){const u=r[e].element;if(u&&u.hasValue()){const v=u.tooltipPosition();n.add(v.x),a+=v.y,++o}}return o===0||n.size===0?!1:{x:[...n].reduce((u,v)=>u+v)/n.size,y:a/o}},nearest(r,e){if(!r.length)return!1;let t=e.x,n=e.y,a=Number.POSITIVE_INFINITY,o,c,u;for(o=0,c=r.length;o<c;++o){const v=r[o].element;if(v&&v.hasValue()){const _=v.getCenterPoint(),x=distanceBetweenPoints(e,_);x<a&&(a=x,u=v)}}if(u){const v=u.tooltipPosition();t=v.x,n=v.y}return{x:t,y:n}}};function pushOrConcat(r,e){return e&&(isArray(e)?Array.prototype.push.apply(r,e):r.push(e)),r}function splitNewlines(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function createTooltipItem(r,e){const{element:t,datasetIndex:n,index:a}=e,o=r.getDatasetMeta(n).controller,{label:c,value:u}=o.getLabelAndValue(a);return{chart:r,label:c,parsed:o.getParsed(a),raw:r.data.datasets[n].data[a],formattedValue:u,dataset:o.getDataset(),dataIndex:a,datasetIndex:n,element:t}}function getTooltipSize(r,e){const t=r.chart.ctx,{body:n,footer:a,title:o}=r,{boxWidth:c,boxHeight:u}=e,v=toFont(e.bodyFont),_=toFont(e.titleFont),x=toFont(e.footerFont),E=o.length,M=a.length,C=n.length,I=toPadding(e.padding);let D=I.height,L=0,N=n.reduce((U,j)=>U+j.before.length+j.lines.length+j.after.length,0);if(N+=r.beforeBody.length+r.afterBody.length,E&&(D+=E*_.lineHeight+(E-1)*e.titleSpacing+e.titleMarginBottom),N){const U=e.displayColors?Math.max(u,v.lineHeight):v.lineHeight;D+=C*U+(N-C)*v.lineHeight+(N-1)*e.bodySpacing}M&&(D+=e.footerMarginTop+M*x.lineHeight+(M-1)*e.footerSpacing);let q=0;const F=function(U){L=Math.max(L,t.measureText(U).width+q)};return t.save(),t.font=_.string,each(r.title,F),t.font=v.string,each(r.beforeBody.concat(r.afterBody),F),q=e.displayColors?c+2+e.boxPadding:0,each(n,U=>{each(U.before,F),each(U.lines,F),each(U.after,F)}),q=0,t.font=x.string,each(r.footer,F),t.restore(),L+=I.width,{width:L,height:D}}function determineYAlign(r,e){const{y:t,height:n}=e;return t<n/2?"top":t>r.height-n/2?"bottom":"center"}function doesNotFitWithAlign(r,e,t,n){const{x:a,width:o}=n,c=t.caretSize+t.caretPadding;if(r==="left"&&a+o+c>e.width||r==="right"&&a-o-c<0)return!0}function determineXAlign(r,e,t,n){const{x:a,width:o}=t,{width:c,chartArea:{left:u,right:v}}=r;let _="center";return n==="center"?_=a<=(u+v)/2?"left":"right":a<=o/2?_="left":a>=c-o/2&&(_="right"),doesNotFitWithAlign(_,r,e,t)&&(_="center"),_}function determineAlignment(r,e,t){const n=t.yAlign||e.yAlign||determineYAlign(r,t);return{xAlign:t.xAlign||e.xAlign||determineXAlign(r,e,t,n),yAlign:n}}function alignX(r,e){let{x:t,width:n}=r;return e==="right"?t-=n:e==="center"&&(t-=n/2),t}function alignY(r,e,t){let{y:n,height:a}=r;return e==="top"?n+=t:e==="bottom"?n-=a+t:n-=a/2,n}function getBackgroundPoint(r,e,t,n){const{caretSize:a,caretPadding:o,cornerRadius:c}=r,{xAlign:u,yAlign:v}=t,_=a+o,{topLeft:x,topRight:E,bottomLeft:M,bottomRight:C}=toTRBLCorners(c);let I=alignX(e,u);const D=alignY(e,v,_);return v==="center"?u==="left"?I+=_:u==="right"&&(I-=_):u==="left"?I-=Math.max(x,M)+a:u==="right"&&(I+=Math.max(E,C)+a),{x:_limitValue(I,0,n.width-e.width),y:_limitValue(D,0,n.height-e.height)}}function getAlignedX(r,e,t){const n=toPadding(t.padding);return e==="center"?r.x+r.width/2:e==="right"?r.x+r.width-n.right:r.x+n.left}function getBeforeAfterBodyLines(r){return pushOrConcat([],splitNewlines(r))}function createTooltipContext(r,e,t){return createContext(r,{tooltip:e,tooltipItems:t,type:"tooltip"})}function overrideCallbacks(r,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?r.override(t):r}const defaultCallbacks={beforeTitle:noop,title(r){if(r.length>0){const e=r[0],t=e.chart.data.labels,n=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return t[e.dataIndex]}return""},afterTitle:noop,beforeBody:noop,beforeLabel:noop,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let e=r.dataset.label||"";e&&(e+=": ");const t=r.formattedValue;return isNullOrUndef(t)||(e+=t),e},labelColor(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){const t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:noop,afterBody:noop,beforeFooter:noop,footer:noop,afterFooter:noop};function invokeCallbackWithFallback(r,e,t,n){const a=r[e].call(t,n);return typeof a>"u"?defaultCallbacks[e].call(t,n):a}class Tooltip extends Element{static positioners=positioners;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),a=n.enabled&&t.options.animation&&n.animations,o=new Animations(this.chart,a);return a._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=createTooltipContext(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:n}=t,a=invokeCallbackWithFallback(n,"beforeTitle",this,e),o=invokeCallbackWithFallback(n,"title",this,e),c=invokeCallbackWithFallback(n,"afterTitle",this,e);let u=[];return u=pushOrConcat(u,splitNewlines(a)),u=pushOrConcat(u,splitNewlines(o)),u=pushOrConcat(u,splitNewlines(c)),u}getBeforeBody(e,t){return getBeforeAfterBodyLines(invokeCallbackWithFallback(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,a=[];return each(e,o=>{const c={before:[],lines:[],after:[]},u=overrideCallbacks(n,o);pushOrConcat(c.before,splitNewlines(invokeCallbackWithFallback(u,"beforeLabel",this,o))),pushOrConcat(c.lines,invokeCallbackWithFallback(u,"label",this,o)),pushOrConcat(c.after,splitNewlines(invokeCallbackWithFallback(u,"afterLabel",this,o))),a.push(c)}),a}getAfterBody(e,t){return getBeforeAfterBodyLines(invokeCallbackWithFallback(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,a=invokeCallbackWithFallback(n,"beforeFooter",this,e),o=invokeCallbackWithFallback(n,"footer",this,e),c=invokeCallbackWithFallback(n,"afterFooter",this,e);let u=[];return u=pushOrConcat(u,splitNewlines(a)),u=pushOrConcat(u,splitNewlines(o)),u=pushOrConcat(u,splitNewlines(c)),u}_createItems(e){const t=this._active,n=this.chart.data,a=[],o=[],c=[];let u=[],v,_;for(v=0,_=t.length;v<_;++v)u.push(createTooltipItem(this.chart,t[v]));return e.filter&&(u=u.filter((x,E,M)=>e.filter(x,E,M,n))),e.itemSort&&(u=u.sort((x,E)=>e.itemSort(x,E,n))),each(u,x=>{const E=overrideCallbacks(e.callbacks,x);a.push(invokeCallbackWithFallback(E,"labelColor",this,x)),o.push(invokeCallbackWithFallback(E,"labelPointStyle",this,x)),c.push(invokeCallbackWithFallback(E,"labelTextColor",this,x))}),this.labelColors=a,this.labelPointStyles=o,this.labelTextColors=c,this.dataPoints=u,u}update(e,t){const n=this.options.setContext(this.getContext()),a=this._active;let o,c=[];if(!a.length)this.opacity!==0&&(o={opacity:0});else{const u=positioners[n.position].call(this,a,this._eventPosition);c=this._createItems(n),this.title=this.getTitle(c,n),this.beforeBody=this.getBeforeBody(c,n),this.body=this.getBody(c,n),this.afterBody=this.getAfterBody(c,n),this.footer=this.getFooter(c,n);const v=this._size=getTooltipSize(this,n),_=Object.assign({},u,v),x=determineAlignment(this.chart,n,_),E=getBackgroundPoint(n,_,x,this.chart);this.xAlign=x.xAlign,this.yAlign=x.yAlign,o={opacity:1,x:E.x,y:E.y,width:v.width,height:v.height,caretX:u.x,caretY:u.y}}this._tooltipItems=c,this.$context=void 0,o&&this._resolveAnimations().update(this,o),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,a){const o=this.getCaretPosition(e,n,a);t.lineTo(o.x1,o.y1),t.lineTo(o.x2,o.y2),t.lineTo(o.x3,o.y3)}getCaretPosition(e,t,n){const{xAlign:a,yAlign:o}=this,{caretSize:c,cornerRadius:u}=n,{topLeft:v,topRight:_,bottomLeft:x,bottomRight:E}=toTRBLCorners(u),{x:M,y:C}=e,{width:I,height:D}=t;let L,N,q,F,U,j;return o==="center"?(U=C+D/2,a==="left"?(L=M,N=L-c,F=U+c,j=U-c):(L=M+I,N=L+c,F=U-c,j=U+c),q=L):(a==="left"?N=M+Math.max(v,x)+c:a==="right"?N=M+I-Math.max(_,E)-c:N=this.caretX,o==="top"?(F=C,U=F-c,L=N-c,q=N+c):(F=C+D,U=F+c,L=N+c,q=N-c),j=F),{x1:L,x2:N,x3:q,y1:F,y2:U,y3:j}}drawTitle(e,t,n){const a=this.title,o=a.length;let c,u,v;if(o){const _=getRtlAdapter(n.rtl,this.x,this.width);for(e.x=getAlignedX(this,n.titleAlign,n),t.textAlign=_.textAlign(n.titleAlign),t.textBaseline="middle",c=toFont(n.titleFont),u=n.titleSpacing,t.fillStyle=n.titleColor,t.font=c.string,v=0;v<o;++v)t.fillText(a[v],_.x(e.x),e.y+c.lineHeight/2),e.y+=c.lineHeight+u,v+1===o&&(e.y+=n.titleMarginBottom-u)}}_drawColorBox(e,t,n,a,o){const c=this.labelColors[n],u=this.labelPointStyles[n],{boxHeight:v,boxWidth:_}=o,x=toFont(o.bodyFont),E=getAlignedX(this,"left",o),M=a.x(E),C=v<x.lineHeight?(x.lineHeight-v)/2:0,I=t.y+C;if(o.usePointStyle){const D={radius:Math.min(_,v)/2,pointStyle:u.pointStyle,rotation:u.rotation,borderWidth:1},L=a.leftForLtr(M,_)+_/2,N=I+v/2;e.strokeStyle=o.multiKeyBackground,e.fillStyle=o.multiKeyBackground,drawPoint(e,D,L,N),e.strokeStyle=c.borderColor,e.fillStyle=c.backgroundColor,drawPoint(e,D,L,N)}else{e.lineWidth=isObject(c.borderWidth)?Math.max(...Object.values(c.borderWidth)):c.borderWidth||1,e.strokeStyle=c.borderColor,e.setLineDash(c.borderDash||[]),e.lineDashOffset=c.borderDashOffset||0;const D=a.leftForLtr(M,_),L=a.leftForLtr(a.xPlus(M,1),_-2),N=toTRBLCorners(c.borderRadius);Object.values(N).some(q=>q!==0)?(e.beginPath(),e.fillStyle=o.multiKeyBackground,addRoundedRectPath(e,{x:D,y:I,w:_,h:v,radius:N}),e.fill(),e.stroke(),e.fillStyle=c.backgroundColor,e.beginPath(),addRoundedRectPath(e,{x:L,y:I+1,w:_-2,h:v-2,radius:N}),e.fill()):(e.fillStyle=o.multiKeyBackground,e.fillRect(D,I,_,v),e.strokeRect(D,I,_,v),e.fillStyle=c.backgroundColor,e.fillRect(L,I+1,_-2,v-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:a}=this,{bodySpacing:o,bodyAlign:c,displayColors:u,boxHeight:v,boxWidth:_,boxPadding:x}=n,E=toFont(n.bodyFont);let M=E.lineHeight,C=0;const I=getRtlAdapter(n.rtl,this.x,this.width),D=function(J){t.fillText(J,I.x(e.x+C),e.y+M/2),e.y+=M+o},L=I.textAlign(c);let N,q,F,U,j,W,X;for(t.textAlign=c,t.textBaseline="middle",t.font=E.string,e.x=getAlignedX(this,L,n),t.fillStyle=n.bodyColor,each(this.beforeBody,D),C=u&&L!=="right"?c==="center"?_/2+x:_+2+x:0,U=0,W=a.length;U<W;++U){for(N=a[U],q=this.labelTextColors[U],t.fillStyle=q,each(N.before,D),F=N.lines,u&&F.length&&(this._drawColorBox(t,e,U,I,n),M=Math.max(E.lineHeight,v)),j=0,X=F.length;j<X;++j)D(F[j]),M=E.lineHeight;each(N.after,D)}C=0,M=E.lineHeight,each(this.afterBody,D),e.y-=o}drawFooter(e,t,n){const a=this.footer,o=a.length;let c,u;if(o){const v=getRtlAdapter(n.rtl,this.x,this.width);for(e.x=getAlignedX(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=v.textAlign(n.footerAlign),t.textBaseline="middle",c=toFont(n.footerFont),t.fillStyle=n.footerColor,t.font=c.string,u=0;u<o;++u)t.fillText(a[u],v.x(e.x),e.y+c.lineHeight/2),e.y+=c.lineHeight+n.footerSpacing}}drawBackground(e,t,n,a){const{xAlign:o,yAlign:c}=this,{x:u,y:v}=e,{width:_,height:x}=n,{topLeft:E,topRight:M,bottomLeft:C,bottomRight:I}=toTRBLCorners(a.cornerRadius);t.fillStyle=a.backgroundColor,t.strokeStyle=a.borderColor,t.lineWidth=a.borderWidth,t.beginPath(),t.moveTo(u+E,v),c==="top"&&this.drawCaret(e,t,n,a),t.lineTo(u+_-M,v),t.quadraticCurveTo(u+_,v,u+_,v+M),c==="center"&&o==="right"&&this.drawCaret(e,t,n,a),t.lineTo(u+_,v+x-I),t.quadraticCurveTo(u+_,v+x,u+_-I,v+x),c==="bottom"&&this.drawCaret(e,t,n,a),t.lineTo(u+C,v+x),t.quadraticCurveTo(u,v+x,u,v+x-C),c==="center"&&o==="left"&&this.drawCaret(e,t,n,a),t.lineTo(u,v+E),t.quadraticCurveTo(u,v,u+E,v),t.closePath(),t.fill(),a.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,a=n&&n.x,o=n&&n.y;if(a||o){const c=positioners[e.position].call(this,this._active,this._eventPosition);if(!c)return;const u=this._size=getTooltipSize(this,e),v=Object.assign({},c,this._size),_=determineAlignment(t,e,v),x=getBackgroundPoint(e,v,_,t);(a._to!==x.x||o._to!==x.y)&&(this.xAlign=_.xAlign,this.yAlign=_.yAlign,this.width=u.width,this.height=u.height,this.caretX=c.x,this.caretY=c.y,this._resolveAnimations().update(this,x))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const a={width:this.width,height:this.height},o={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const c=toPadding(t.padding),u=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&u&&(e.save(),e.globalAlpha=n,this.drawBackground(o,e,a,t),overrideTextDirection(e,t.textDirection),o.y+=c.top,this.drawTitle(o,e,t),this.drawBody(o,e,t),this.drawFooter(o,e,t),restoreTextDirection(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,a=e.map(({datasetIndex:u,index:v})=>{const _=this.chart.getDatasetMeta(u);if(!_)throw new Error("Cannot find a dataset at index "+u);return{datasetIndex:u,element:_.data[v],index:v}}),o=!_elementsEqual(n,a),c=this._positionChanged(a,t);(o||c)&&(this._active=a,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,n=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const a=this.options,o=this._active||[],c=this._getActiveElements(e,o,t,n),u=this._positionChanged(c,e),v=t||!_elementsEqual(c,o)||u;return v&&(this._active=c,(a.enabled||a.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),v}_getActiveElements(e,t,n,a){const o=this.options;if(e.type==="mouseout")return[];if(!a)return t.filter(u=>this.chart.data.datasets[u.datasetIndex]&&this.chart.getDatasetMeta(u.datasetIndex).controller.getParsed(u.index)!==void 0);const c=this.chart.getElementsAtEventForMode(e,o.mode,o,n);return o.reverse&&c.reverse(),c}_positionChanged(e,t){const{caretX:n,caretY:a,options:o}=this,c=positioners[o.position].call(this,e,t);return c!==!1&&(n!==c.x||a!==c.y)}}var plugin_tooltip={id:"tooltip",_element:Tooltip,positioners,afterInit(r,e,t){t&&(r.tooltip=new Tooltip({chart:r,options:t}))},beforeUpdate(r,e,t){r.tooltip&&r.tooltip.initialize(t)},reset(r,e,t){r.tooltip&&r.tooltip.initialize(t)},afterDraw(r){const e=r.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(r.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",t)}},afterEvent(r,e){if(r.tooltip){const t=e.replay;r.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,e)=>e.bodyFont.size,boxWidth:(r,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:defaultCallbacks},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},plugins=Object.freeze({__proto__:null,Colors:plugin_colors,Decimation:plugin_decimation,Filler:index,Legend:plugin_legend,SubTitle:plugin_subtitle,Title:plugin_title,Tooltip:plugin_tooltip});const addIfString=(r,e,t,n)=>(typeof e=="string"?(t=r.push(e)-1,n.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function findOrAddLabel(r,e,t,n){const a=r.indexOf(e);if(a===-1)return addIfString(r,e,t,n);const o=r.lastIndexOf(e);return a!==o?t:a}const validIndex=(r,e)=>r===null?null:_limitValue(Math.round(r),0,e);function _getLabelForValue(r){const e=this.getLabels();return r>=0&&r<e.length?e[r]:r}class CategoryScale extends Scale{static id="category";static defaults={ticks:{callback:_getLabelForValue}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const n=this.getLabels();for(const{index:a,label:o}of t)n[a]===o&&n.splice(a,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(isNullOrUndef(e))return null;const n=this.getLabels();return t=isFinite(t)&&n[t]===e?t:findOrAddLabel(n,e,valueOrDefault(t,e),this._addedLabels),validIndex(t,n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:a}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),t||(a=this.getLabels().length-1)),this.min=n,this.max=a}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,a=[];let o=this.getLabels();o=e===0&&t===o.length-1?o:o.slice(e,t+1),this._valueRange=Math.max(o.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let c=e;c<=t;c++)a.push({value:c});return a}getLabelForValue(e){return _getLabelForValue.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function generateTicks$1(r,e){const t=[],{bounds:a,step:o,min:c,max:u,precision:v,count:_,maxTicks:x,maxDigits:E,includeBounds:M}=r,C=o||1,I=x-1,{min:D,max:L}=e,N=!isNullOrUndef(c),q=!isNullOrUndef(u),F=!isNullOrUndef(_),U=(L-D)/(E+1);let j=niceNum((L-D)/I/C)*C,W,X,J,G;if(j<1e-14&&!N&&!q)return[{value:D},{value:L}];G=Math.ceil(L/j)-Math.floor(D/j),G>I&&(j=niceNum(G*j/I/C)*C),isNullOrUndef(v)||(W=Math.pow(10,v),j=Math.ceil(j*W)/W),a==="ticks"?(X=Math.floor(D/j)*j,J=Math.ceil(L/j)*j):(X=D,J=L),N&&q&&o&&almostWhole((u-c)/o,j/1e3)?(G=Math.round(Math.min((u-c)/j,x)),j=(u-c)/G,X=c,J=u):F?(X=N?c:X,J=q?u:J,G=_-1,j=(J-X)/G):(G=(J-X)/j,almostEquals(G,Math.round(G),j/1e3)?G=Math.round(G):G=Math.ceil(G));const oe=Math.max(_decimalPlaces(j),_decimalPlaces(X));W=Math.pow(10,isNullOrUndef(v)?oe:v),X=Math.round(X*W)/W,J=Math.round(J*W)/W;let O=0;for(N&&(M&&X!==c?(t.push({value:c}),X<c&&O++,almostEquals(Math.round((X+O*j)*W)/W,c,relativeLabelSize(c,U,r))&&O++):X<c&&O++);O<G;++O){const l=Math.round((X+O*j)*W)/W;if(q&&l>u)break;t.push({value:l})}return q&&M&&J!==u?t.length&&almostEquals(t[t.length-1].value,u,relativeLabelSize(u,U,r))?t[t.length-1].value=u:t.push({value:u}):(!q||J===u)&&t.push({value:J}),t}function relativeLabelSize(r,e,{horizontal:t,minRotation:n}){const a=toRadians(n),o=(t?Math.sin(a):Math.cos(a))||.001,c=.75*e*(""+r).length;return Math.min(e/o,c)}class LinearScaleBase extends Scale{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return isNullOrUndef(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:a,max:o}=this;const c=v=>a=t?a:v,u=v=>o=n?o:v;if(e){const v=sign(a),_=sign(o);v<0&&_<0?u(0):v>0&&_>0&&c(0)}if(a===o){let v=o===0?1:Math.abs(o*.05);u(o+v),e||c(a-v)}this.min=a,this.max=o}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:n}=e,a;return n?(a=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,a>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${a} ticks. Limiting to 1000.`),a=1e3)):(a=this.computeTickLimit(),t=t||11),t&&(a=Math.min(t,a)),a}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const a={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},o=this._range||this,c=generateTicks$1(a,o);return e.bounds==="ticks"&&_setMinAndMaxByKey(c,this,"value"),e.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const a=(n-t)/Math.max(e.length-1,1)/2;t-=a,n+=a}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return formatNumber(e,this.chart.options.locale,this.options.ticks.format)}}class LinearScale extends LinearScaleBase{static id="linear";static defaults={ticks:{callback:Ticks.formatters.numeric}};determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=isNumberFinite(e)?e:0,this.max=isNumberFinite(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=toRadians(this.options.ticks.minRotation),a=(e?Math.sin(n):Math.cos(n))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,o.lineHeight/a))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const log10Floor=r=>Math.floor(log10(r)),changeExponent=(r,e)=>Math.pow(10,log10Floor(r)+e);function isMajor(r){return r/Math.pow(10,log10Floor(r))===1}function steps(r,e,t){const n=Math.pow(10,t),a=Math.floor(r/n);return Math.ceil(e/n)-a}function startExp(r,e){const t=e-r;let n=log10Floor(t);for(;steps(r,e,n)>10;)n++;for(;steps(r,e,n)<10;)n--;return Math.min(n,log10Floor(r))}function generateTicks(r,{min:e,max:t}){e=finiteOrDefault(r.min,e);const n=[],a=log10Floor(e);let o=startExp(e,t),c=o<0?Math.pow(10,Math.abs(o)):1;const u=Math.pow(10,o),v=a>o?Math.pow(10,a):0,_=Math.round((e-v)*c)/c,x=Math.floor((e-v)/u/10)*u*10;let E=Math.floor((_-x)/Math.pow(10,o)),M=finiteOrDefault(r.min,Math.round((v+x+E*Math.pow(10,o))*c)/c);for(;M<t;)n.push({value:M,major:isMajor(M),significand:E}),E>=10?E=E<15?15:20:E++,E>=20&&(o++,E=2,c=o>=0?1:c),M=Math.round((v+x+E*Math.pow(10,o))*c)/c;const C=finiteOrDefault(r.max,M);return n.push({value:C,major:isMajor(C),significand:E}),n}class LogarithmicScale extends Scale{static id="logarithmic";static defaults={ticks:{callback:Ticks.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const n=LinearScaleBase.prototype.parse.apply(this,[e,t]);if(n===0){this._zero=!0;return}return isNumberFinite(n)&&n>0?n:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=isNumberFinite(e)?Math.max(0,e):null,this.max=isNumberFinite(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!isNumberFinite(this._userMin)&&(this.min=e===changeExponent(this.min,0)?changeExponent(this.min,-1):changeExponent(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let n=this.min,a=this.max;const o=u=>n=e?n:u,c=u=>a=t?a:u;n===a&&(n<=0?(o(1),c(10)):(o(changeExponent(n,-1)),c(changeExponent(a,1)))),n<=0&&o(changeExponent(a,-1)),a<=0&&c(changeExponent(n,1)),this.min=n,this.max=a}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},n=generateTicks(t,this);return e.bounds==="ticks"&&_setMinAndMaxByKey(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":formatNumber(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=log10(e),this._valueRange=log10(this.max)-log10(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(log10(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function getTickBackdropHeight(r){const e=r.ticks;if(e.display&&r.display){const t=toPadding(e.backdropPadding);return valueOrDefault(e.font&&e.font.size,defaults.font.size)+t.height}return 0}function measureLabelSize(r,e,t){return t=isArray(t)?t:[t],{w:_longestText(r,e.string,t),h:t.length*e.lineHeight}}function determineLimits(r,e,t,n,a){return r===n||r===a?{start:e-t/2,end:e+t/2}:r<n||r>a?{start:e-t,end:e}:{start:e,end:e+t}}function fitWithPointLabels(r){const e={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},t=Object.assign({},e),n=[],a=[],o=r._pointLabels.length,c=r.options.pointLabels,u=c.centerPointLabels?PI/o:0;for(let v=0;v<o;v++){const _=c.setContext(r.getPointLabelContext(v));a[v]=_.padding;const x=r.getPointPosition(v,r.drawingArea+a[v],u),E=toFont(_.font),M=measureLabelSize(r.ctx,E,r._pointLabels[v]);n[v]=M;const C=_normalizeAngle(r.getIndexAngle(v)+u),I=Math.round(toDegrees(C)),D=determineLimits(I,x.x,M.w,0,180),L=determineLimits(I,x.y,M.h,90,270);updateLimits(t,e,C,D,L)}r.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),r._pointLabelItems=buildPointLabelItems(r,n,a)}function updateLimits(r,e,t,n,a){const o=Math.abs(Math.sin(t)),c=Math.abs(Math.cos(t));let u=0,v=0;n.start<e.l?(u=(e.l-n.start)/o,r.l=Math.min(r.l,e.l-u)):n.end>e.r&&(u=(n.end-e.r)/o,r.r=Math.max(r.r,e.r+u)),a.start<e.t?(v=(e.t-a.start)/c,r.t=Math.min(r.t,e.t-v)):a.end>e.b&&(v=(a.end-e.b)/c,r.b=Math.max(r.b,e.b+v))}function createPointLabelItem(r,e,t){const n=r.drawingArea,{extra:a,additionalAngle:o,padding:c,size:u}=t,v=r.getPointPosition(e,n+a+c,o),_=Math.round(toDegrees(_normalizeAngle(v.angle+HALF_PI))),x=yForAngle(v.y,u.h,_),E=getTextAlignForAngle(_),M=leftForTextAlign(v.x,u.w,E);return{visible:!0,x:v.x,y:x,textAlign:E,left:M,top:x,right:M+u.w,bottom:x+u.h}}function isNotOverlapped(r,e){if(!e)return!0;const{left:t,top:n,right:a,bottom:o}=r;return!(_isPointInArea({x:t,y:n},e)||_isPointInArea({x:t,y:o},e)||_isPointInArea({x:a,y:n},e)||_isPointInArea({x:a,y:o},e))}function buildPointLabelItems(r,e,t){const n=[],a=r._pointLabels.length,o=r.options,{centerPointLabels:c,display:u}=o.pointLabels,v={extra:getTickBackdropHeight(o)/2,additionalAngle:c?PI/a:0};let _;for(let x=0;x<a;x++){v.padding=t[x],v.size=e[x];const E=createPointLabelItem(r,x,v);n.push(E),u==="auto"&&(E.visible=isNotOverlapped(E,_),E.visible&&(_=E))}return n}function getTextAlignForAngle(r){return r===0||r===180?"center":r<180?"left":"right"}function leftForTextAlign(r,e,t){return t==="right"?r-=e:t==="center"&&(r-=e/2),r}function yForAngle(r,e,t){return t===90||t===270?r-=e/2:(t>270||t<90)&&(r-=e),r}function drawPointLabelBox(r,e,t){const{left:n,top:a,right:o,bottom:c}=t,{backdropColor:u}=e;if(!isNullOrUndef(u)){const v=toTRBLCorners(e.borderRadius),_=toPadding(e.backdropPadding);r.fillStyle=u;const x=n-_.left,E=a-_.top,M=o-n+_.width,C=c-a+_.height;Object.values(v).some(I=>I!==0)?(r.beginPath(),addRoundedRectPath(r,{x,y:E,w:M,h:C,radius:v}),r.fill()):r.fillRect(x,E,M,C)}}function drawPointLabels(r,e){const{ctx:t,options:{pointLabels:n}}=r;for(let a=e-1;a>=0;a--){const o=r._pointLabelItems[a];if(!o.visible)continue;const c=n.setContext(r.getPointLabelContext(a));drawPointLabelBox(t,c,o);const u=toFont(c.font),{x:v,y:_,textAlign:x}=o;renderText(t,r._pointLabels[a],v,_+u.lineHeight/2,u,{color:c.color,textAlign:x,textBaseline:"middle"})}}function pathRadiusLine(r,e,t,n){const{ctx:a}=r;if(t)a.arc(r.xCenter,r.yCenter,e,0,TAU);else{let o=r.getPointPosition(0,e);a.moveTo(o.x,o.y);for(let c=1;c<n;c++)o=r.getPointPosition(c,e),a.lineTo(o.x,o.y)}}function drawRadiusLine(r,e,t,n,a){const o=r.ctx,c=e.circular,{color:u,lineWidth:v}=e;!c&&!n||!u||!v||t<0||(o.save(),o.strokeStyle=u,o.lineWidth=v,o.setLineDash(a.dash||[]),o.lineDashOffset=a.dashOffset,o.beginPath(),pathRadiusLine(r,t,c,n),o.closePath(),o.stroke(),o.restore())}function createPointLabelContext(r,e,t){return createContext(r,{label:t,index:e,type:"pointLabel"})}class RadialLinearScale extends LinearScaleBase{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ticks.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=toPadding(getTickBackdropHeight(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=isNumberFinite(e)&&!isNaN(e)?e:0,this.max=isNumberFinite(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/getTickBackdropHeight(this.options))}generateTickLabels(e){LinearScaleBase.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,n)=>{const a=callback(this.options.pointLabels.callback,[t,n],this);return a||a===0?a:""}).filter((t,n)=>this.chart.getDataVisibility(n))}fit(){const e=this.options;e.display&&e.pointLabels.display?fitWithPointLabels(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,a){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-a)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,a))}getIndexAngle(e){const t=TAU/(this._pointLabels.length||1),n=this.options.startAngle||0;return _normalizeAngle(e*t+toRadians(n))}getDistanceFromCenterForValue(e){if(isNullOrUndef(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(isNullOrUndef(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const n=t[e];return createPointLabelContext(this.getContext(),e,n)}}getPointPosition(e,t,n=0){const a=this.getIndexAngle(e)-HALF_PI+n;return{x:Math.cos(a)*t+this.xCenter,y:Math.sin(a)*t+this.yCenter,angle:a}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:n,right:a,bottom:o}=this._pointLabelItems[e];return{left:t,top:n,right:a,bottom:o}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const n=this.ctx;n.save(),n.beginPath(),pathRadiusLine(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:n,grid:a,border:o}=t,c=this._pointLabels.length;let u,v,_;if(t.pointLabels.display&&drawPointLabels(this,c),a.display&&this.ticks.forEach((x,E)=>{if(E!==0||E===0&&this.min<0){v=this.getDistanceFromCenterForValue(x.value);const M=this.getContext(E),C=a.setContext(M),I=o.setContext(M);drawRadiusLine(this,C,v,c,I)}}),n.display){for(e.save(),u=c-1;u>=0;u--){const x=n.setContext(this.getPointLabelContext(u)),{color:E,lineWidth:M}=x;!M||!E||(e.lineWidth=M,e.strokeStyle=E,e.setLineDash(x.borderDash),e.lineDashOffset=x.borderDashOffset,v=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),_=this.getPointPosition(u,v),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(_.x,_.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;const a=this.getIndexAngle(0);let o,c;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(a),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((u,v)=>{if(v===0&&this.min>=0&&!t.reverse)return;const _=n.setContext(this.getContext(v)),x=toFont(_.font);if(o=this.getDistanceFromCenterForValue(this.ticks[v].value),_.showLabelBackdrop){e.font=x.string,c=e.measureText(u.label).width,e.fillStyle=_.backdropColor;const E=toPadding(_.backdropPadding);e.fillRect(-c/2-E.left,-o-x.size/2-E.top,c+E.width,x.size+E.height)}renderText(e,u.label,0,-o,x,{color:_.color,strokeColor:_.textStrokeColor,strokeWidth:_.textStrokeWidth})}),e.restore()}drawTitle(){}}const INTERVALS={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},UNITS=Object.keys(INTERVALS);function sorter(r,e){return r-e}function parse(r,e){if(isNullOrUndef(e))return null;const t=r._adapter,{parser:n,round:a,isoWeekday:o}=r._parseOpts;let c=e;return typeof n=="function"&&(c=n(c)),isNumberFinite(c)||(c=typeof n=="string"?t.parse(c,n):t.parse(c)),c===null?null:(a&&(c=a==="week"&&(isNumber(o)||o===!0)?t.startOf(c,"isoWeek",o):t.startOf(c,a)),+c)}function determineUnitForAutoTicks(r,e,t,n){const a=UNITS.length;for(let o=UNITS.indexOf(r);o<a-1;++o){const c=INTERVALS[UNITS[o]],u=c.steps?c.steps:Number.MAX_SAFE_INTEGER;if(c.common&&Math.ceil((t-e)/(u*c.size))<=n)return UNITS[o]}return UNITS[a-1]}function determineUnitForFormatting(r,e,t,n,a){for(let o=UNITS.length-1;o>=UNITS.indexOf(t);o--){const c=UNITS[o];if(INTERVALS[c].common&&r._adapter.diff(a,n,c)>=e-1)return c}return UNITS[t?UNITS.indexOf(t):0]}function determineMajorUnit(r){for(let e=UNITS.indexOf(r)+1,t=UNITS.length;e<t;++e)if(INTERVALS[UNITS[e]].common)return UNITS[e]}function addTick(r,e,t){if(!t)r[e]=!0;else if(t.length){const{lo:n,hi:a}=_lookup(t,e),o=t[n]>=e?t[n]:t[a];r[o]=!0}}function setMajorTicks(r,e,t,n){const a=r._adapter,o=+a.startOf(e[0].value,n),c=e[e.length-1].value;let u,v;for(u=o;u<=c;u=+a.add(u,1,n))v=t[u],v>=0&&(e[v].major=!0);return e}function ticksFromTimestamps(r,e,t){const n=[],a={},o=e.length;let c,u;for(c=0;c<o;++c)u=e[c],a[u]=c,n.push({value:u,major:!1});return o===0||!t?n:setMajorTicks(r,n,a,t)}class TimeScale extends Scale{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const n=e.time||(e.time={}),a=this._adapter=new adapters._date(e.adapters.date);a.init(t),mergeIf(n.displayFormats,a.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:parse(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:a,max:o,minDefined:c,maxDefined:u}=this.getUserBounds();function v(_){!c&&!isNaN(_.min)&&(a=Math.min(a,_.min)),!u&&!isNaN(_.max)&&(o=Math.max(o,_.max))}(!c||!u)&&(v(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&v(this.getMinMax(!1))),a=isNumberFinite(a)&&!isNaN(a)?a:+t.startOf(Date.now(),n),o=isNumberFinite(o)&&!isNaN(o)?o:+t.endOf(Date.now(),n)+1,this.min=Math.min(a,o-1),this.max=Math.max(a+1,o)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,a=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&a.length&&(this.min=this._userMin||a[0],this.max=this._userMax||a[a.length-1]);const o=this.min,c=this.max,u=_filterBetween(a,o,c);return this._unit=t.unit||(n.autoSkip?determineUnitForAutoTicks(t.minUnit,this.min,this.max,this._getLabelCapacity(o)):determineUnitForFormatting(this,u.length,t.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:determineMajorUnit(this._unit),this.initOffsets(a),e.reverse&&u.reverse(),ticksFromTimestamps(this,u,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,n=0,a,o;this.options.offset&&e.length&&(a=this.getDecimalForValue(e[0]),e.length===1?t=1-a:t=(this.getDecimalForValue(e[1])-a)/2,o=this.getDecimalForValue(e[e.length-1]),e.length===1?n=o:n=(o-this.getDecimalForValue(e[e.length-2]))/2);const c=e.length<3?.5:.25;t=_limitValue(t,0,c),n=_limitValue(n,0,c),this._offsets={start:t,end:n,factor:1/(t+1+n)}}_generate(){const e=this._adapter,t=this.min,n=this.max,a=this.options,o=a.time,c=o.unit||determineUnitForAutoTicks(o.minUnit,t,n,this._getLabelCapacity(t)),u=valueOrDefault(a.ticks.stepSize,1),v=c==="week"?o.isoWeekday:!1,_=isNumber(v)||v===!0,x={};let E=t,M,C;if(_&&(E=+e.startOf(E,"isoWeek",v)),E=+e.startOf(E,_?"day":c),e.diff(n,t,c)>1e5*u)throw new Error(t+" and "+n+" are too far apart with stepSize of "+u+" "+c);const I=a.ticks.source==="data"&&this.getDataTimestamps();for(M=E,C=0;M<n;M=+e.add(M,u,c),C++)addTick(x,M,I);return(M===n||a.bounds==="ticks"||C===1)&&addTick(x,M,I),Object.keys(x).sort(sorter).map(D=>+D)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const a=this.options.time.displayFormats,o=this._unit,c=t||a[o];return this._adapter.format(e,c)}_tickFormatFunction(e,t,n,a){const o=this.options,c=o.ticks.callback;if(c)return callback(c,[e,t,n],this);const u=o.time.displayFormats,v=this._unit,_=this._majorUnit,x=v&&u[v],E=_&&u[_],M=n[t],C=_&&E&&M&&M.major;return this._adapter.format(e,a||(C?E:x))}generateTickLabels(e){let t,n,a;for(t=0,n=e.length;t<n;++t)a=e[t],a.label=this._tickFormatFunction(a.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,a=toRadians(this.isHorizontal()?t.maxRotation:t.minRotation),o=Math.cos(a),c=Math.sin(a),u=this._resolveTickFontOptions(0).size;return{w:n*o+u*c,h:n*c+u*o}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,a=n[t.unit]||n.millisecond,o=this._tickFormatFunction(e,0,ticksFromTimestamps(this,[e],this._majorUnit),a),c=this._getLabelSize(o),u=Math.floor(this.isHorizontal()?this.width/c.w:this.height/c.h)-1;return u>0?u:1}getDataTimestamps(){let e=this._cache.data||[],t,n;if(e.length)return e;const a=this.getMatchingVisibleMetas();if(this._normalized&&a.length)return this._cache.data=a[0].controller.getAllParsedValues(this);for(t=0,n=a.length;t<n;++t)e=e.concat(a[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const a=this.getLabels();for(t=0,n=a.length;t<n;++t)e.push(parse(this,a[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return _arrayUnique(e.sort(sorter))}}function interpolate(r,e,t){let n=0,a=r.length-1,o,c,u,v;t?(e>=r[n].pos&&e<=r[a].pos&&({lo:n,hi:a}=_lookupByKey(r,"pos",e)),{pos:o,time:u}=r[n],{pos:c,time:v}=r[a]):(e>=r[n].time&&e<=r[a].time&&({lo:n,hi:a}=_lookupByKey(r,"time",e)),{time:o,pos:u}=r[n],{time:c,pos:v}=r[a]);const _=c-o;return _?u+(v-u)*(e-o)/_:u}class TimeSeriesScale extends TimeScale{static id="timeseries";static defaults=TimeScale.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=interpolate(t,this.min),this._tableRange=interpolate(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,a=[],o=[];let c,u,v,_,x;for(c=0,u=e.length;c<u;++c)_=e[c],_>=t&&_<=n&&a.push(_);if(a.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(c=0,u=a.length;c<u;++c)x=a[c+1],v=a[c-1],_=a[c],Math.round((x+v)/2)!==_&&o.push({time:_,pos:c/(u-1)});return o}_generate(){const e=this.min,t=this.max;let n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(t)||n.length===1)&&n.push(t),n.sort((a,o)=>a-o)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return t.length&&n.length?e=this.normalize(t.concat(n)):e=t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(interpolate(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return interpolate(this._table,n*this._tableRange+this._minPos,!0)}}var scales=Object.freeze({__proto__:null,CategoryScale,LinearScale,LogarithmicScale,RadialLinearScale,TimeScale,TimeSeriesScale});const registerables=[controllers,elements,plugins,scales];function create_fragment$1(r){let e,t,n;return{c(){e=element("div"),e.innerHTML='<canvas id="delineationChart"></canvas>',t=space(),n=empty(),attr(e,"class","relative h-[400px]")},m(a,o){insert(a,e,o),insert(a,t,o),insert(a,n,o)},p(a,[o]){},i:noop$3,o:noop$3,d(a){a&&(detach(e),detach(t),detach(n))}}}function parseMultipleJSON(r){try{let e=r;for(;typeof e=="string";)e=JSON.parse(e),console.log("Parsed layer:",typeof e);return e}catch(e){return console.error("Parse error:",e),null}}function instance$1(r,e,t){Chart.register(...registerables);let n,a={labels:DELINEATION_OPTIONS.map(x=>x.label),datasets:[{label:"Votes",data:Array(DELINEATION_OPTIONS.length).fill(0),backgroundColor:"#888",borderColor:"#888",borderWidth:1}]},o={},c=0;onMount(async()=>{const x=document.getElementById("delineationChart");n=new Chart(x,{type:"bar",data:a,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}}),await u()});async function u(){try{console.log("Starting data load..."),gunDB.censusData.on(async x=>{const E={};if(!x)return;const M=Object.keys(x).filter(D=>D!=="_");console.log("Processing users:",M);for(const D of M){const L=D.replace("-processed","");console.log(`
Processing user:`,L);let N=x[D];if(!N)continue;const q=parseMultipleJSON(N);if(q){console.log("Data structure:",q);try{if(q.signature?.payload){let F=parseMultipleJSON(q.signature.payload);console.log("Form data:",F),F?.formData?.delineation&&(E[L]=F,console.log("Successfully extracted delineation:",F.formData.delineation))}else if(q.payload&&q.encryptionMetadata){const F=await encryption.decryptData({encrypted:q.payload,iv:q.encryptionMetadata.iv,key:q.encryptionMetadata.key}),U=parseMultipleJSON(F);U?.formData?.delineation&&(U[L]=U)}}catch(F){console.error("Processing error:",F)}}}const C=Object.keys(E).length;if(console.log(`
=== Processing Summary ===`),console.log(`Found ${C} valid users`),C>0){const D=Object.keys(E)[0];console.log("Sample data:",{userId:D,delineation:E[D].formData.delineation})}const I=await v(E);_(I)})}catch(x){console.error("Load error:",x)}}async function v(x){console.log(`
=== Starting Aggregation ===`);const E=Object.fromEntries(DELINEATION_OPTIONS.map(C=>[String(C.value),0]));if(!x)return{counts:E,userCount:0};const M=Object.keys(x);c=M.length,console.log(`Processing ${c} users for aggregation`);for(const C of M){const I=x[C];if(console.log(`
Processing user ${C}`),!I?.formData?.delineation){console.warn("No delineation data found");continue}const D=I.formData.delineation;if(console.log("Found delineations:",D),Array.isArray(D))for(const L of D){const N=String(L);N in E&&(E[N]++,console.log(`Counted value: ${N}`))}}return console.log(`
Final counts:`,E),{counts:E,userCount:c}}function _({counts:x,userCount:E}){if(!n)return;const M=DELINEATION_OPTIONS.map(C=>{const I=x[String(C.value)]||0;return console.log(`${C.label}: ${I}`),I});a.datasets[0].data=M,t(0,o={...x,userCount:E}),n.update()}return[o]}class DelineationGraph extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{})}}function create_else_block(r){let e,t,n,a,o,c,u,v,_,x=r[0]&&create_if_block_2(r),E=r[1]&&create_if_block_1(r);return{c(){e=element("main"),t=element("button"),t.textContent="Open Census Form",n=space(),a=element("button"),a.textContent="View Collective Preferences",o=space(),x&&x.c(),c=space(),E&&E.c(),attr(t,"class","px-6 py-3 bg-sky-800 text-white rounded-lg shadow-lg hover:bg-sky-900 transition-colors mr-4"),attr(a,"class","px-6 py-3 bg-sky-800 text-white rounded-lg shadow-lg hover:bg-sky-900 transition-colors"),attr(e,"class","min-h-screen bg-gray-100 flex items-center justify-center p-4")},m(M,C){insert(M,e,C),append(e,t),append(e,n),append(e,a),append(e,o),x&&x.m(e,null),append(e,c),E&&E.m(e,null),u=!0,v||(_=[listen(t,"click",r[3]),listen(a,"click",r[4])],v=!0)},p(M,C){M[0]?x?(x.p(M,C),C&1&&transition_in(x,1)):(x=create_if_block_2(M),x.c(),transition_in(x,1),x.m(e,c)):x&&(group_outros(),transition_out(x,1,1,()=>{x=null}),check_outros()),M[1]?E?(E.p(M,C),C&2&&transition_in(E,1)):(E=create_if_block_1(M),E.c(),transition_in(E,1),E.m(e,null)):E&&(group_outros(),transition_out(E,1,1,()=>{E=null}),check_outros())},i(M){u||(transition_in(x),transition_in(E),u=!0)},o(M){transition_out(x),transition_out(E),u=!1},d(M){M&&detach(e),x&&x.d(),E&&E.d(),v=!1,run_all(_)}}}function create_if_block(r){let e;return{c(){e=element("div"),e.innerHTML='<div class="text-gray-600">Loading...</div>',attr(e,"class","min-h-screen bg-gray-100 flex items-center justify-center p-4")},m(t,n){insert(t,e,n)},p:noop$3,i:noop$3,o:noop$3,d(t){t&&detach(e)}}}function create_if_block_2(r){let e,t,n,a,o,c,u,v,_,x,E;return v=new EthnicityForm({props:{onClose:r[6]}}),{c(){e=element("div"),t=element("div"),n=element("button"),n.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',a=space(),o=element("div"),c=element("h2"),c.textContent="Census Form",u=space(),create_component(v.$$.fragment),attr(n,"class","absolute top-4 right-4 text-gray-500 hover:text-gray-700"),attr(c,"class","text-2xl font-bold mb-4 text-gray-800"),attr(o,"class","p-6"),attr(t,"class","bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto relative"),attr(e,"class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50")},m(M,C){insert(M,e,C),append(e,t),append(t,n),append(t,a),append(t,o),append(o,c),append(o,u),mount_component(v,o,null),_=!0,x||(E=listen(n,"click",r[5]),x=!0)},p(M,C){const I={};C&1&&(I.onClose=M[6]),v.$set(I)},i(M){_||(transition_in(v.$$.fragment,M),_=!0)},o(M){transition_out(v.$$.fragment,M),_=!1},d(M){M&&detach(e),destroy_component(v),x=!1,E()}}}function create_if_block_1(r){let e,t,n,a,o,c,u,v,_,x,E;return v=new DelineationGraph({}),{c(){e=element("div"),t=element("div"),n=element("button"),n.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',a=space(),o=element("div"),c=element("h2"),c.textContent="Collective Preferences",u=space(),create_component(v.$$.fragment),attr(n,"class","absolute top-4 right-4 text-gray-500 hover:text-gray-700"),attr(c,"class","text-2xl font-bold mb-4 text-gray-800"),attr(o,"class","p-6"),attr(t,"class","bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto relative"),attr(e,"class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50")},m(M,C){insert(M,e,C),append(e,t),append(t,n),append(t,a),append(t,o),append(o,c),append(o,u),mount_component(v,o,null),_=!0,x||(E=listen(n,"click",r[7]),x=!0)},p:noop$3,i(M){_||(transition_in(v.$$.fragment,M),_=!0)},o(M){transition_out(v.$$.fragment,M),_=!1},d(M){M&&detach(e),destroy_component(v),x=!1,E()}}}function create_fragment(r){let e,t,n,a;const o=[create_if_block,create_else_block],c=[];function u(v,_){return v[2]?0:1}return e=u(r),t=c[e]=o[e](r),{c(){t.c(),n=empty()},m(v,_){c[e].m(v,_),insert(v,n,_),a=!0},p(v,[_]){let x=e;e=u(v),e===x?c[e].p(v,_):(group_outros(),transition_out(c[x],1,1,()=>{c[x]=null}),check_outros(),t=c[e],t?t.p(v,_):(t=c[e]=o[e](v),t.c()),transition_in(t,1),t.m(n.parentNode,n))},i(v){a||(transition_in(t),a=!0)},o(v){transition_out(t),a=!1},d(v){v&&detach(n),c[e].d(v)}}}function instance(r,e,t){let n=!1,a=!1,o=!0;return onMount(()=>{console.log("App mounted"),t(2,o=!1)}),[n,a,o,()=>t(0,n=!0),()=>t(1,a=!0),()=>t(0,n=!1),()=>t(0,n=!1),()=>t(1,a=!1)]}class App extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}new App({target:document.getElementById("app")});
